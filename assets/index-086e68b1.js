(function(){const Q=document.createElement("link").relList;if(Q&&Q.supports&&Q.supports("modulepreload"))return;for(const Te of document.querySelectorAll('link[rel="modulepreload"]'))xe(Te);new MutationObserver(Te=>{for(const Ne of Te)if(Ne.type==="childList")for(const Z of Ne.addedNodes)Z.tagName==="LINK"&&Z.rel==="modulepreload"&&xe(Z)}).observe(document,{childList:!0,subtree:!0});function ue(Te){const Ne={};return Te.integrity&&(Ne.integrity=Te.integrity),Te.referrerPolicy&&(Ne.referrerPolicy=Te.referrerPolicy),Te.crossOrigin==="use-credentials"?Ne.credentials="include":Te.crossOrigin==="anonymous"?Ne.credentials="omit":Ne.credentials="same-origin",Ne}function xe(Te){if(Te.ep)return;Te.ep=!0;const Ne=ue(Te);fetch(Te.href,Ne)}})();function XE(T,Q){const ue=Object.create(null),xe=T.split(",");for(let Te=0;Te<xe.length;Te++)ue[xe[Te]]=!0;return Q?Te=>!!ue[Te.toLowerCase()]:Te=>!!ue[Te]}const OK="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",GK=XE(OK);function B_(T){return!!T||T===""}function QE(T){if(Kr(T)){const Q={};for(let ue=0;ue<T.length;ue++){const xe=T[ue],Te=Xo(xe)?zK(xe):QE(xe);if(Te)for(const Ne in Te)Q[Ne]=Te[Ne]}return Q}else{if(Xo(T))return T;if(Qa(T))return T}}const UK=/;(?![^(]*\))/g,VK=/:(.+)/;function zK(T){const Q={};return T.split(UK).forEach(ue=>{if(ue){const xe=ue.split(VK);xe.length>1&&(Q[xe[0].trim()]=xe[1].trim())}}),Q}function ZE(T){let Q="";if(Xo(T))Q=T;else if(Kr(T))for(let ue=0;ue<T.length;ue++){const xe=ZE(T[ue]);xe&&(Q+=xe+" ")}else if(Qa(T))for(const ue in T)T[ue]&&(Q+=ue+" ");return Q.trim()}const WK=T=>Xo(T)?T:T==null?"":Kr(T)||Qa(T)&&(T.toString===N_||!qr(T.toString))?JSON.stringify(T,k_,2):String(T),k_=(T,Q)=>Q&&Q.__v_isRef?k_(T,Q.value):xg(Q)?{[`Map(${Q.size})`]:[...Q.entries()].reduce((ue,[xe,Te])=>(ue[`${xe} =>`]=Te,ue),{})}:L_(Q)?{[`Set(${Q.size})`]:[...Q.values()]}:Qa(Q)&&!Kr(Q)&&!F_(Q)?String(Q):Q,pa={},bg=[],xu=()=>{},HK=()=>!1,KK=/^on[^a-z]/,db=T=>KK.test(T),$E=T=>T.startsWith("onUpdate:"),hl=Object.assign,jE=(T,Q)=>{const ue=T.indexOf(Q);ue>-1&&T.splice(ue,1)},XK=Object.prototype.hasOwnProperty,Cs=(T,Q)=>XK.call(T,Q),Kr=Array.isArray,xg=T=>pb(T)==="[object Map]",L_=T=>pb(T)==="[object Set]",qr=T=>typeof T=="function",Xo=T=>typeof T=="string",YE=T=>typeof T=="symbol",Qa=T=>T!==null&&typeof T=="object",D_=T=>Qa(T)&&qr(T.then)&&qr(T.catch),N_=Object.prototype.toString,pb=T=>N_.call(T),QK=T=>pb(T).slice(8,-1),F_=T=>pb(T)==="[object Object]",JE=T=>Xo(T)&&T!=="NaN"&&T[0]!=="-"&&""+parseInt(T,10)===T,nb=XE(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),fb=T=>{const Q=Object.create(null);return ue=>Q[ue]||(Q[ue]=T(ue))},ZK=/-(\w)/g,Eg=fb(T=>T.replace(ZK,(Q,ue)=>ue?ue.toUpperCase():"")),$K=/\B([A-Z])/g,Tg=fb(T=>T.replace($K,"-$1").toLowerCase()),P_=fb(T=>T.charAt(0).toUpperCase()+T.slice(1)),wE=fb(T=>T?`on${P_(T)}`:""),QA=(T,Q)=>!Object.is(T,Q),EE=(T,Q)=>{for(let ue=0;ue<T.length;ue++)T[ue](Q)},sb=(T,Q,ue)=>{Object.defineProperty(T,Q,{configurable:!0,enumerable:!1,value:ue})},jK=T=>{const Q=parseFloat(T);return isNaN(Q)?T:Q};let e_;const YK=()=>e_||(e_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let nh;class O_{constructor(Q=!1){this.active=!0,this.effects=[],this.cleanups=[],!Q&&nh&&(this.parent=nh,this.index=(nh.scopes||(nh.scopes=[])).push(this)-1)}run(Q){if(this.active){const ue=nh;try{return nh=this,Q()}finally{nh=ue}}}on(){nh=this}off(){nh=this.parent}stop(Q){if(this.active){let ue,xe;for(ue=0,xe=this.effects.length;ue<xe;ue++)this.effects[ue].stop();for(ue=0,xe=this.cleanups.length;ue<xe;ue++)this.cleanups[ue]();if(this.scopes)for(ue=0,xe=this.scopes.length;ue<xe;ue++)this.scopes[ue].stop(!0);if(this.parent&&!Q){const Te=this.parent.scopes.pop();Te&&Te!==this&&(this.parent.scopes[this.index]=Te,Te.index=this.index)}this.active=!1}}}function JK(T){return new O_(T)}function qK(T,Q=nh){Q&&Q.active&&Q.effects.push(T)}const qE=T=>{const Q=new Set(T);return Q.w=0,Q.n=0,Q},G_=T=>(T.w&op)>0,U_=T=>(T.n&op)>0,eX=({deps:T})=>{if(T.length)for(let Q=0;Q<T.length;Q++)T[Q].w|=op},tX=T=>{const{deps:Q}=T;if(Q.length){let ue=0;for(let xe=0;xe<Q.length;xe++){const Te=Q[xe];G_(Te)&&!U_(Te)?Te.delete(T):Q[ue++]=Te,Te.w&=~op,Te.n&=~op}Q.length=ue}},BE=new WeakMap;let HA=0,op=1;const kE=30;let yu;const bf=Symbol(""),LE=Symbol("");class eI{constructor(Q,ue=null,xe){this.fn=Q,this.scheduler=ue,this.active=!0,this.deps=[],this.parent=void 0,qK(this,xe)}run(){if(!this.active)return this.fn();let Q=yu,ue=rp;for(;Q;){if(Q===this)return;Q=Q.parent}try{return this.parent=yu,yu=this,rp=!0,op=1<<++HA,HA<=kE?eX(this):t_(this),this.fn()}finally{HA<=kE&&tX(this),op=1<<--HA,yu=this.parent,rp=ue,this.parent=void 0,this.deferStop&&this.stop()}}stop(){yu===this?this.deferStop=!0:this.active&&(t_(this),this.onStop&&this.onStop(),this.active=!1)}}function t_(T){const{deps:Q}=T;if(Q.length){for(let ue=0;ue<Q.length;ue++)Q[ue].delete(T);Q.length=0}}let rp=!0;const V_=[];function Mg(){V_.push(rp),rp=!1}function _g(){const T=V_.pop();rp=T===void 0?!0:T}function pc(T,Q,ue){if(rp&&yu){let xe=BE.get(T);xe||BE.set(T,xe=new Map);let Te=xe.get(ue);Te||xe.set(ue,Te=qE()),z_(Te)}}function z_(T,Q){let ue=!1;HA<=kE?U_(T)||(T.n|=op,ue=!G_(T)):ue=!T.has(yu),ue&&(T.add(yu),yu.deps.push(T))}function td(T,Q,ue,xe,Te,Ne){const Z=BE.get(T);if(!Z)return;let te=[];if(Q==="clear")te=[...Z.values()];else if(ue==="length"&&Kr(T))Z.forEach((E,B)=>{(B==="length"||B>=xe)&&te.push(E)});else switch(ue!==void 0&&te.push(Z.get(ue)),Q){case"add":Kr(T)?JE(ue)&&te.push(Z.get("length")):(te.push(Z.get(bf)),xg(T)&&te.push(Z.get(LE)));break;case"delete":Kr(T)||(te.push(Z.get(bf)),xg(T)&&te.push(Z.get(LE)));break;case"set":xg(T)&&te.push(Z.get(bf));break}if(te.length===1)te[0]&&DE(te[0]);else{const E=[];for(const B of te)B&&E.push(...B);DE(qE(E))}}function DE(T,Q){const ue=Kr(T)?T:[...T];for(const xe of ue)xe.computed&&n_(xe);for(const xe of ue)xe.computed||n_(xe)}function n_(T,Q){(T!==yu||T.allowRecurse)&&(T.scheduler?T.scheduler():T.run())}const nX=XE("__proto__,__v_isRef,__isVue"),W_=new Set(Object.getOwnPropertyNames(Symbol).filter(T=>T!=="arguments"&&T!=="caller").map(T=>Symbol[T]).filter(YE)),iX=tI(),rX=tI(!1,!0),sX=tI(!0),i_=aX();function aX(){const T={};return["includes","indexOf","lastIndexOf"].forEach(Q=>{T[Q]=function(...ue){const xe=Ls(this);for(let Ne=0,Z=this.length;Ne<Z;Ne++)pc(xe,"get",Ne+"");const Te=xe[Q](...ue);return Te===-1||Te===!1?xe[Q](...ue.map(Ls)):Te}}),["push","pop","shift","unshift","splice"].forEach(Q=>{T[Q]=function(...ue){Mg();const xe=Ls(this)[Q].apply(this,ue);return _g(),xe}}),T}function tI(T=!1,Q=!1){return function(xe,Te,Ne){if(Te==="__v_isReactive")return!T;if(Te==="__v_isReadonly")return T;if(Te==="__v_isShallow")return Q;if(Te==="__v_raw"&&Ne===(T?Q?CX:Z_:Q?Q_:X_).get(xe))return xe;const Z=Kr(xe);if(!T&&Z&&Cs(i_,Te))return Reflect.get(i_,Te,Ne);const te=Reflect.get(xe,Te,Ne);return(YE(Te)?W_.has(Te):nX(Te))||(T||pc(xe,"get",Te),Q)?te:ul(te)?Z&&JE(Te)?te:te.value:Qa(te)?T?$_(te):rI(te):te}}const oX=H_(),lX=H_(!0);function H_(T=!1){return function(ue,xe,Te,Ne){let Z=ue[xe];if(Ig(Z)&&ul(Z)&&!ul(Te))return!1;if(!T&&(!ab(Te)&&!Ig(Te)&&(Z=Ls(Z),Te=Ls(Te)),!Kr(ue)&&ul(Z)&&!ul(Te)))return Z.value=Te,!0;const te=Kr(ue)&&JE(xe)?Number(xe)<ue.length:Cs(ue,xe),E=Reflect.set(ue,xe,Te,Ne);return ue===Ls(Ne)&&(te?QA(Te,Z)&&td(ue,"set",xe,Te):td(ue,"add",xe,Te)),E}}function cX(T,Q){const ue=Cs(T,Q);T[Q];const xe=Reflect.deleteProperty(T,Q);return xe&&ue&&td(T,"delete",Q,void 0),xe}function uX(T,Q){const ue=Reflect.has(T,Q);return(!YE(Q)||!W_.has(Q))&&pc(T,"has",Q),ue}function hX(T){return pc(T,"iterate",Kr(T)?"length":bf),Reflect.ownKeys(T)}const K_={get:iX,set:oX,deleteProperty:cX,has:uX,ownKeys:hX},dX={get:sX,set(T,Q){return!0},deleteProperty(T,Q){return!0}},pX=hl({},K_,{get:rX,set:lX}),nI=T=>T,mb=T=>Reflect.getPrototypeOf(T);function Yy(T,Q,ue=!1,xe=!1){T=T.__v_raw;const Te=Ls(T),Ne=Ls(Q);ue||(Q!==Ne&&pc(Te,"get",Q),pc(Te,"get",Ne));const{has:Z}=mb(Te),te=xe?nI:ue?oI:ZA;if(Z.call(Te,Q))return te(T.get(Q));if(Z.call(Te,Ne))return te(T.get(Ne));T!==Te&&T.get(Q)}function Jy(T,Q=!1){const ue=this.__v_raw,xe=Ls(ue),Te=Ls(T);return Q||(T!==Te&&pc(xe,"has",T),pc(xe,"has",Te)),T===Te?ue.has(T):ue.has(T)||ue.has(Te)}function qy(T,Q=!1){return T=T.__v_raw,!Q&&pc(Ls(T),"iterate",bf),Reflect.get(T,"size",T)}function r_(T){T=Ls(T);const Q=Ls(this);return mb(Q).has.call(Q,T)||(Q.add(T),td(Q,"add",T,T)),this}function s_(T,Q){Q=Ls(Q);const ue=Ls(this),{has:xe,get:Te}=mb(ue);let Ne=xe.call(ue,T);Ne||(T=Ls(T),Ne=xe.call(ue,T));const Z=Te.call(ue,T);return ue.set(T,Q),Ne?QA(Q,Z)&&td(ue,"set",T,Q):td(ue,"add",T,Q),this}function a_(T){const Q=Ls(this),{has:ue,get:xe}=mb(Q);let Te=ue.call(Q,T);Te||(T=Ls(T),Te=ue.call(Q,T)),xe&&xe.call(Q,T);const Ne=Q.delete(T);return Te&&td(Q,"delete",T,void 0),Ne}function o_(){const T=Ls(this),Q=T.size!==0,ue=T.clear();return Q&&td(T,"clear",void 0,void 0),ue}function eb(T,Q){return function(xe,Te){const Ne=this,Z=Ne.__v_raw,te=Ls(Z),E=Q?nI:T?oI:ZA;return!T&&pc(te,"iterate",bf),Z.forEach((B,H)=>xe.call(Te,E(B),E(H),Ne))}}function tb(T,Q,ue){return function(...xe){const Te=this.__v_raw,Ne=Ls(Te),Z=xg(Ne),te=T==="entries"||T===Symbol.iterator&&Z,E=T==="keys"&&Z,B=Te[T](...xe),H=ue?nI:Q?oI:ZA;return!Q&&pc(Ne,"iterate",E?LE:bf),{next(){const{value:C,done:F}=B.next();return F?{value:C,done:F}:{value:te?[H(C[0]),H(C[1])]:H(C),done:F}},[Symbol.iterator](){return this}}}}function np(T){return function(...Q){return T==="delete"?!1:this}}function fX(){const T={get(Ne){return Yy(this,Ne)},get size(){return qy(this)},has:Jy,add:r_,set:s_,delete:a_,clear:o_,forEach:eb(!1,!1)},Q={get(Ne){return Yy(this,Ne,!1,!0)},get size(){return qy(this)},has:Jy,add:r_,set:s_,delete:a_,clear:o_,forEach:eb(!1,!0)},ue={get(Ne){return Yy(this,Ne,!0)},get size(){return qy(this,!0)},has(Ne){return Jy.call(this,Ne,!0)},add:np("add"),set:np("set"),delete:np("delete"),clear:np("clear"),forEach:eb(!0,!1)},xe={get(Ne){return Yy(this,Ne,!0,!0)},get size(){return qy(this,!0)},has(Ne){return Jy.call(this,Ne,!0)},add:np("add"),set:np("set"),delete:np("delete"),clear:np("clear"),forEach:eb(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(Ne=>{T[Ne]=tb(Ne,!1,!1),ue[Ne]=tb(Ne,!0,!1),Q[Ne]=tb(Ne,!1,!0),xe[Ne]=tb(Ne,!0,!0)}),[T,ue,Q,xe]}const[mX,gX,AX,vX]=fX();function iI(T,Q){const ue=Q?T?vX:AX:T?gX:mX;return(xe,Te,Ne)=>Te==="__v_isReactive"?!T:Te==="__v_isReadonly"?T:Te==="__v_raw"?xe:Reflect.get(Cs(ue,Te)&&Te in xe?ue:xe,Te,Ne)}const yX={get:iI(!1,!1)},bX={get:iI(!1,!0)},xX={get:iI(!0,!1)},X_=new WeakMap,Q_=new WeakMap,Z_=new WeakMap,CX=new WeakMap;function wX(T){switch(T){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function EX(T){return T.__v_skip||!Object.isExtensible(T)?0:wX(QK(T))}function rI(T){return Ig(T)?T:sI(T,!1,K_,yX,X_)}function IX(T){return sI(T,!1,pX,bX,Q_)}function $_(T){return sI(T,!0,dX,xX,Z_)}function sI(T,Q,ue,xe,Te){if(!Qa(T)||T.__v_raw&&!(Q&&T.__v_isReactive))return T;const Ne=Te.get(T);if(Ne)return Ne;const Z=EX(T);if(Z===0)return T;const te=new Proxy(T,Z===2?xe:ue);return Te.set(T,te),te}function Cg(T){return Ig(T)?Cg(T.__v_raw):!!(T&&T.__v_isReactive)}function Ig(T){return!!(T&&T.__v_isReadonly)}function ab(T){return!!(T&&T.__v_isShallow)}function j_(T){return Cg(T)||Ig(T)}function Ls(T){const Q=T&&T.__v_raw;return Q?Ls(Q):T}function aI(T){return sb(T,"__v_skip",!0),T}const ZA=T=>Qa(T)?rI(T):T,oI=T=>Qa(T)?$_(T):T;function Y_(T){rp&&yu&&(T=Ls(T),z_(T.dep||(T.dep=qE())))}function J_(T,Q){T=Ls(T),T.dep&&DE(T.dep)}function ul(T){return!!(T&&T.__v_isRef===!0)}function ob(T){return SX(T,!1)}function SX(T,Q){return ul(T)?T:new TX(T,Q)}class TX{constructor(Q,ue){this.__v_isShallow=ue,this.dep=void 0,this.__v_isRef=!0,this._rawValue=ue?Q:Ls(Q),this._value=ue?Q:ZA(Q)}get value(){return Y_(this),this._value}set value(Q){const ue=this.__v_isShallow||ab(Q)||Ig(Q);Q=ue?Q:Ls(Q),QA(Q,this._rawValue)&&(this._rawValue=Q,this._value=ue?Q:ZA(Q),J_(this))}}function MX(T){return ul(T)?T.value:T}const _X={get:(T,Q,ue)=>MX(Reflect.get(T,Q,ue)),set:(T,Q,ue,xe)=>{const Te=T[Q];return ul(Te)&&!ul(ue)?(Te.value=ue,!0):Reflect.set(T,Q,ue,xe)}};function q_(T){return Cg(T)?T:new Proxy(T,_X)}var eR;class RX{constructor(Q,ue,xe,Te){this._setter=ue,this.dep=void 0,this.__v_isRef=!0,this[eR]=!1,this._dirty=!0,this.effect=new eI(Q,()=>{this._dirty||(this._dirty=!0,J_(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!Te,this.__v_isReadonly=xe}get value(){const Q=Ls(this);return Y_(Q),(Q._dirty||!Q._cacheable)&&(Q._dirty=!1,Q._value=Q.effect.run()),Q._value}set value(Q){this._setter(Q)}}eR="__v_isReadonly";function BX(T,Q,ue=!1){let xe,Te;const Ne=qr(T);return Ne?(xe=T,Te=xu):(xe=T.get,Te=T.set),new RX(xe,Te,Ne||!Te,ue)}function sp(T,Q,ue,xe){let Te;try{Te=xe?T(...xe):T()}catch(Ne){gb(Ne,Q,ue)}return Te}function Pc(T,Q,ue,xe){if(qr(T)){const Ne=sp(T,Q,ue,xe);return Ne&&D_(Ne)&&Ne.catch(Z=>{gb(Z,Q,ue)}),Ne}const Te=[];for(let Ne=0;Ne<T.length;Ne++)Te.push(Pc(T[Ne],Q,ue,xe));return Te}function gb(T,Q,ue,xe=!0){const Te=Q?Q.vnode:null;if(Q){let Ne=Q.parent;const Z=Q.proxy,te=ue;for(;Ne;){const B=Ne.ec;if(B){for(let H=0;H<B.length;H++)if(B[H](T,Z,te)===!1)return}Ne=Ne.parent}const E=Q.appContext.config.errorHandler;if(E){sp(E,null,10,[T,Z,te]);return}}kX(T,ue,Te,xe)}function kX(T,Q,ue,xe=!0){console.error(T)}let lb=!1,NE=!1;const cl=[];let sh=0;const wg=[];let qh=null,Af=0;const tR=Promise.resolve();let lI=null;function LX(T){const Q=lI||tR;return T?Q.then(this?T.bind(this):T):Q}function DX(T){let Q=sh+1,ue=cl.length;for(;Q<ue;){const xe=Q+ue>>>1;$A(cl[xe])<T?Q=xe+1:ue=xe}return Q}function cI(T){(!cl.length||!cl.includes(T,lb&&T.allowRecurse?sh+1:sh))&&(T.id==null?cl.push(T):cl.splice(DX(T.id),0,T),nR())}function nR(){!lb&&!NE&&(NE=!0,lI=tR.then(rR))}function NX(T){const Q=cl.indexOf(T);Q>sh&&cl.splice(Q,1)}function FX(T){Kr(T)?wg.push(...T):(!qh||!qh.includes(T,T.allowRecurse?Af+1:Af))&&wg.push(T),nR()}function l_(T,Q=sh){for(;Q<cl.length;Q++){const ue=cl[Q];ue&&ue.pre&&(cl.splice(Q,1),Q--,ue())}}function iR(T){if(wg.length){const Q=[...new Set(wg)];if(wg.length=0,qh){qh.push(...Q);return}for(qh=Q,qh.sort((ue,xe)=>$A(ue)-$A(xe)),Af=0;Af<qh.length;Af++)qh[Af]();qh=null,Af=0}}const $A=T=>T.id==null?1/0:T.id,PX=(T,Q)=>{const ue=$A(T)-$A(Q);if(ue===0){if(T.pre&&!Q.pre)return-1;if(Q.pre&&!T.pre)return 1}return ue};function rR(T){NE=!1,lb=!0,cl.sort(PX);const Q=xu;try{for(sh=0;sh<cl.length;sh++){const ue=cl[sh];ue&&ue.active!==!1&&sp(ue,null,14)}}finally{sh=0,cl.length=0,iR(),lb=!1,lI=null,(cl.length||wg.length)&&rR()}}function OX(T,Q,...ue){if(T.isUnmounted)return;const xe=T.vnode.props||pa;let Te=ue;const Ne=Q.startsWith("update:"),Z=Ne&&Q.slice(7);if(Z&&Z in xe){const H=`${Z==="modelValue"?"model":Z}Modifiers`,{number:C,trim:F}=xe[H]||pa;F&&(Te=ue.map(L=>L.trim())),C&&(Te=ue.map(jK))}let te,E=xe[te=wE(Q)]||xe[te=wE(Eg(Q))];!E&&Ne&&(E=xe[te=wE(Tg(Q))]),E&&Pc(E,T,6,Te);const B=xe[te+"Once"];if(B){if(!T.emitted)T.emitted={};else if(T.emitted[te])return;T.emitted[te]=!0,Pc(B,T,6,Te)}}function sR(T,Q,ue=!1){const xe=Q.emitsCache,Te=xe.get(T);if(Te!==void 0)return Te;const Ne=T.emits;let Z={},te=!1;if(!qr(T)){const E=B=>{const H=sR(B,Q,!0);H&&(te=!0,hl(Z,H))};!ue&&Q.mixins.length&&Q.mixins.forEach(E),T.extends&&E(T.extends),T.mixins&&T.mixins.forEach(E)}return!Ne&&!te?(Qa(T)&&xe.set(T,null),null):(Kr(Ne)?Ne.forEach(E=>Z[E]=null):hl(Z,Ne),Qa(T)&&xe.set(T,Z),Z)}function Ab(T,Q){return!T||!db(Q)?!1:(Q=Q.slice(2).replace(/Once$/,""),Cs(T,Q[0].toLowerCase()+Q.slice(1))||Cs(T,Tg(Q))||Cs(T,Q))}let ah=null,aR=null;function cb(T){const Q=ah;return ah=T,aR=T&&T.type.__scopeId||null,Q}function GX(T,Q=ah,ue){if(!Q||T._n)return T;const xe=(...Te)=>{xe._d&&v_(-1);const Ne=cb(Q),Z=T(...Te);return cb(Ne),xe._d&&v_(1),Z};return xe._n=!0,xe._c=!0,xe._d=!0,xe}function IE(T){const{type:Q,vnode:ue,proxy:xe,withProxy:Te,props:Ne,propsOptions:[Z],slots:te,attrs:E,emit:B,render:H,renderCache:C,data:F,setupState:L,ctx:M,inheritAttrs:b}=T;let S,I;const O=cb(T);try{if(ue.shapeFlag&4){const D=Te||xe;S=rh(H.call(D,D,C,Ne,L,F,M)),I=E}else{const D=Q;S=rh(D.length>1?D(Ne,{attrs:E,slots:te,emit:B}):D(Ne,null)),I=Q.props?E:UX(E)}}catch(D){KA.length=0,gb(D,T,1),S=ap(ed)}let _=S;if(I&&b!==!1){const D=Object.keys(I),{shapeFlag:V}=_;D.length&&V&7&&(Z&&D.some($E)&&(I=VX(I,Z)),_=lp(_,I))}return ue.dirs&&(_=lp(_),_.dirs=_.dirs?_.dirs.concat(ue.dirs):ue.dirs),ue.transition&&(_.transition=ue.transition),S=_,cb(O),S}const UX=T=>{let Q;for(const ue in T)(ue==="class"||ue==="style"||db(ue))&&((Q||(Q={}))[ue]=T[ue]);return Q},VX=(T,Q)=>{const ue={};for(const xe in T)(!$E(xe)||!(xe.slice(9)in Q))&&(ue[xe]=T[xe]);return ue};function zX(T,Q,ue){const{props:xe,children:Te,component:Ne}=T,{props:Z,children:te,patchFlag:E}=Q,B=Ne.emitsOptions;if(Q.dirs||Q.transition)return!0;if(ue&&E>=0){if(E&1024)return!0;if(E&16)return xe?c_(xe,Z,B):!!Z;if(E&8){const H=Q.dynamicProps;for(let C=0;C<H.length;C++){const F=H[C];if(Z[F]!==xe[F]&&!Ab(B,F))return!0}}}else return(Te||te)&&(!te||!te.$stable)?!0:xe===Z?!1:xe?Z?c_(xe,Z,B):!0:!!Z;return!1}function c_(T,Q,ue){const xe=Object.keys(Q);if(xe.length!==Object.keys(T).length)return!0;for(let Te=0;Te<xe.length;Te++){const Ne=xe[Te];if(Q[Ne]!==T[Ne]&&!Ab(ue,Ne))return!0}return!1}function WX({vnode:T,parent:Q},ue){for(;Q&&Q.subTree===T;)(T=Q.vnode).el=ue,Q=Q.parent}const HX=T=>T.__isSuspense;function KX(T,Q){Q&&Q.pendingBranch?Kr(T)?Q.effects.push(...T):Q.effects.push(T):FX(T)}function XX(T,Q){if(Ko){let ue=Ko.provides;const xe=Ko.parent&&Ko.parent.provides;xe===ue&&(ue=Ko.provides=Object.create(xe)),ue[T]=Q}}function SE(T,Q,ue=!1){const xe=Ko||ah;if(xe){const Te=xe.parent==null?xe.vnode.appContext&&xe.vnode.appContext.provides:xe.parent.provides;if(Te&&T in Te)return Te[T];if(arguments.length>1)return ue&&qr(Q)?Q.call(xe.proxy):Q}}const u_={};function TE(T,Q,ue){return oR(T,Q,ue)}function oR(T,Q,{immediate:ue,deep:xe,flush:Te,onTrack:Ne,onTrigger:Z}=pa){const te=Ko;let E,B=!1,H=!1;if(ul(T)?(E=()=>T.value,B=ab(T)):Cg(T)?(E=()=>T,xe=!0):Kr(T)?(H=!0,B=T.some(I=>Cg(I)||ab(I)),E=()=>T.map(I=>{if(ul(I))return I.value;if(Cg(I))return vg(I);if(qr(I))return sp(I,te,2)})):qr(T)?Q?E=()=>sp(T,te,2):E=()=>{if(!(te&&te.isUnmounted))return C&&C(),Pc(T,te,3,[F])}:E=xu,Q&&xe){const I=E;E=()=>vg(I())}let C,F=I=>{C=S.onStop=()=>{sp(I,te,4)}};if(YA)return F=xu,Q?ue&&Pc(Q,te,3,[E(),H?[]:void 0,F]):E(),xu;let L=H?[]:u_;const M=()=>{if(S.active)if(Q){const I=S.run();(xe||B||(H?I.some((O,_)=>QA(O,L[_])):QA(I,L)))&&(C&&C(),Pc(Q,te,3,[I,L===u_?void 0:L,F]),L=I)}else S.run()};M.allowRecurse=!!Q;let b;Te==="sync"?b=M:Te==="post"?b=()=>Zl(M,te&&te.suspense):(M.pre=!0,te&&(M.id=te.uid),b=()=>cI(M));const S=new eI(E,b);return Q?ue?M():L=S.run():Te==="post"?Zl(S.run.bind(S),te&&te.suspense):S.run(),()=>{S.stop(),te&&te.scope&&jE(te.scope.effects,S)}}function QX(T,Q,ue){const xe=this.proxy,Te=Xo(T)?T.includes(".")?lR(xe,T):()=>xe[T]:T.bind(xe,xe);let Ne;qr(Q)?Ne=Q:(Ne=Q.handler,ue=Q);const Z=Ko;Sg(this);const te=oR(Te,Ne.bind(xe),ue);return Z?Sg(Z):xf(),te}function lR(T,Q){const ue=Q.split(".");return()=>{let xe=T;for(let Te=0;Te<ue.length&&xe;Te++)xe=xe[ue[Te]];return xe}}function vg(T,Q){if(!Qa(T)||T.__v_skip||(Q=Q||new Set,Q.has(T)))return T;if(Q.add(T),ul(T))vg(T.value,Q);else if(Kr(T))for(let ue=0;ue<T.length;ue++)vg(T[ue],Q);else if(L_(T)||xg(T))T.forEach(ue=>{vg(ue,Q)});else if(F_(T))for(const ue in T)vg(T[ue],Q);return T}function ZX(){const T={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return dR(()=>{T.isMounted=!0}),pR(()=>{T.isUnmounting=!0}),T}const Fc=[Function,Array],$X={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Fc,onEnter:Fc,onAfterEnter:Fc,onEnterCancelled:Fc,onBeforeLeave:Fc,onLeave:Fc,onAfterLeave:Fc,onLeaveCancelled:Fc,onBeforeAppear:Fc,onAppear:Fc,onAfterAppear:Fc,onAppearCancelled:Fc},setup(T,{slots:Q}){const ue=NQ(),xe=ZX();let Te;return()=>{const Ne=Q.default&&uR(Q.default(),!0);if(!Ne||!Ne.length)return;let Z=Ne[0];if(Ne.length>1){for(const b of Ne)if(b.type!==ed){Z=b;break}}const te=Ls(T),{mode:E}=te;if(xe.isLeaving)return ME(Z);const B=h_(Z);if(!B)return ME(Z);const H=FE(B,te,xe,ue);PE(B,H);const C=ue.subTree,F=C&&h_(C);let L=!1;const{getTransitionKey:M}=B.type;if(M){const b=M();Te===void 0?Te=b:b!==Te&&(Te=b,L=!0)}if(F&&F.type!==ed&&(!vf(B,F)||L)){const b=FE(F,te,xe,ue);if(PE(F,b),E==="out-in")return xe.isLeaving=!0,b.afterLeave=()=>{xe.isLeaving=!1,ue.update()},ME(Z);E==="in-out"&&B.type!==ed&&(b.delayLeave=(S,I,O)=>{const _=cR(xe,F);_[String(F.key)]=F,S._leaveCb=()=>{I(),S._leaveCb=void 0,delete H.delayedLeave},H.delayedLeave=O})}return Z}}},jX=$X;function cR(T,Q){const{leavingVNodes:ue}=T;let xe=ue.get(Q.type);return xe||(xe=Object.create(null),ue.set(Q.type,xe)),xe}function FE(T,Q,ue,xe){const{appear:Te,mode:Ne,persisted:Z=!1,onBeforeEnter:te,onEnter:E,onAfterEnter:B,onEnterCancelled:H,onBeforeLeave:C,onLeave:F,onAfterLeave:L,onLeaveCancelled:M,onBeforeAppear:b,onAppear:S,onAfterAppear:I,onAppearCancelled:O}=Q,_=String(T.key),D=cR(ue,T),V=(W,U)=>{W&&Pc(W,xe,9,U)},J=(W,U)=>{const q=U[1];V(W,U),Kr(W)?W.every(oe=>oe.length<=1)&&q():W.length<=1&&q()},Y={mode:Ne,persisted:Z,beforeEnter(W){let U=te;if(!ue.isMounted)if(Te)U=b||te;else return;W._leaveCb&&W._leaveCb(!0);const q=D[_];q&&vf(T,q)&&q.el._leaveCb&&q.el._leaveCb(),V(U,[W])},enter(W){let U=E,q=B,oe=H;if(!ue.isMounted)if(Te)U=S||E,q=I||B,oe=O||H;else return;let ve=!1;const Ae=W._enterCb=Se=>{ve||(ve=!0,Se?V(oe,[W]):V(q,[W]),Y.delayedLeave&&Y.delayedLeave(),W._enterCb=void 0)};U?J(U,[W,Ae]):Ae()},leave(W,U){const q=String(T.key);if(W._enterCb&&W._enterCb(!0),ue.isUnmounting)return U();V(C,[W]);let oe=!1;const ve=W._leaveCb=Ae=>{oe||(oe=!0,U(),Ae?V(M,[W]):V(L,[W]),W._leaveCb=void 0,D[q]===T&&delete D[q])};D[q]=T,F?J(F,[W,ve]):ve()},clone(W){return FE(W,Q,ue,xe)}};return Y}function ME(T){if(vb(T))return T=lp(T),T.children=null,T}function h_(T){return vb(T)?T.children?T.children[0]:void 0:T}function PE(T,Q){T.shapeFlag&6&&T.component?PE(T.component.subTree,Q):T.shapeFlag&128?(T.ssContent.transition=Q.clone(T.ssContent),T.ssFallback.transition=Q.clone(T.ssFallback)):T.transition=Q}function uR(T,Q=!1,ue){let xe=[],Te=0;for(let Ne=0;Ne<T.length;Ne++){let Z=T[Ne];const te=ue==null?Z.key:String(ue)+String(Z.key!=null?Z.key:Ne);Z.type===ih?(Z.patchFlag&128&&Te++,xe=xe.concat(uR(Z.children,Q,te))):(Q||Z.type!==ed)&&xe.push(te!=null?lp(Z,{key:te}):Z)}if(Te>1)for(let Ne=0;Ne<xe.length;Ne++)xe[Ne].patchFlag=-2;return xe}const ib=T=>!!T.type.__asyncLoader,vb=T=>T.type.__isKeepAlive;function YX(T,Q){hR(T,"a",Q)}function JX(T,Q){hR(T,"da",Q)}function hR(T,Q,ue=Ko){const xe=T.__wdc||(T.__wdc=()=>{let Te=ue;for(;Te;){if(Te.isDeactivated)return;Te=Te.parent}return T()});if(yb(Q,xe,ue),ue){let Te=ue.parent;for(;Te&&Te.parent;)vb(Te.parent.vnode)&&qX(xe,Q,ue,Te),Te=Te.parent}}function qX(T,Q,ue,xe){const Te=yb(Q,T,xe,!0);fR(()=>{jE(xe[Q],Te)},ue)}function yb(T,Q,ue=Ko,xe=!1){if(ue){const Te=ue[T]||(ue[T]=[]),Ne=Q.__weh||(Q.__weh=(...Z)=>{if(ue.isUnmounted)return;Mg(),Sg(ue);const te=Pc(Q,ue,T,Z);return xf(),_g(),te});return xe?Te.unshift(Ne):Te.push(Ne),Ne}}const nd=T=>(Q,ue=Ko)=>(!YA||T==="sp")&&yb(T,Q,ue),eQ=nd("bm"),dR=nd("m"),tQ=nd("bu"),nQ=nd("u"),pR=nd("bum"),fR=nd("um"),iQ=nd("sp"),rQ=nd("rtg"),sQ=nd("rtc");function aQ(T,Q=Ko){yb("ec",T,Q)}function ff(T,Q,ue,xe){const Te=T.dirs,Ne=Q&&Q.dirs;for(let Z=0;Z<Te.length;Z++){const te=Te[Z];Ne&&(te.oldValue=Ne[Z].value);let E=te.dir[xe];E&&(Mg(),Pc(E,ue,8,[T.el,te,T,Q]),_g())}}const oQ=Symbol(),OE=T=>T?TR(T)?pI(T)||T.proxy:OE(T.parent):null,ub=hl(Object.create(null),{$:T=>T,$el:T=>T.vnode.el,$data:T=>T.data,$props:T=>T.props,$attrs:T=>T.attrs,$slots:T=>T.slots,$refs:T=>T.refs,$parent:T=>OE(T.parent),$root:T=>OE(T.root),$emit:T=>T.emit,$options:T=>gR(T),$forceUpdate:T=>T.f||(T.f=()=>cI(T.update)),$nextTick:T=>T.n||(T.n=LX.bind(T.proxy)),$watch:T=>QX.bind(T)}),lQ={get({_:T},Q){const{ctx:ue,setupState:xe,data:Te,props:Ne,accessCache:Z,type:te,appContext:E}=T;let B;if(Q[0]!=="$"){const L=Z[Q];if(L!==void 0)switch(L){case 1:return xe[Q];case 2:return Te[Q];case 4:return ue[Q];case 3:return Ne[Q]}else{if(xe!==pa&&Cs(xe,Q))return Z[Q]=1,xe[Q];if(Te!==pa&&Cs(Te,Q))return Z[Q]=2,Te[Q];if((B=T.propsOptions[0])&&Cs(B,Q))return Z[Q]=3,Ne[Q];if(ue!==pa&&Cs(ue,Q))return Z[Q]=4,ue[Q];GE&&(Z[Q]=0)}}const H=ub[Q];let C,F;if(H)return Q==="$attrs"&&pc(T,"get",Q),H(T);if((C=te.__cssModules)&&(C=C[Q]))return C;if(ue!==pa&&Cs(ue,Q))return Z[Q]=4,ue[Q];if(F=E.config.globalProperties,Cs(F,Q))return F[Q]},set({_:T},Q,ue){const{data:xe,setupState:Te,ctx:Ne}=T;return Te!==pa&&Cs(Te,Q)?(Te[Q]=ue,!0):xe!==pa&&Cs(xe,Q)?(xe[Q]=ue,!0):Cs(T.props,Q)||Q[0]==="$"&&Q.slice(1)in T?!1:(Ne[Q]=ue,!0)},has({_:{data:T,setupState:Q,accessCache:ue,ctx:xe,appContext:Te,propsOptions:Ne}},Z){let te;return!!ue[Z]||T!==pa&&Cs(T,Z)||Q!==pa&&Cs(Q,Z)||(te=Ne[0])&&Cs(te,Z)||Cs(xe,Z)||Cs(ub,Z)||Cs(Te.config.globalProperties,Z)},defineProperty(T,Q,ue){return ue.get!=null?T._.accessCache[Q]=0:Cs(ue,"value")&&this.set(T,Q,ue.value,null),Reflect.defineProperty(T,Q,ue)}};let GE=!0;function cQ(T){const Q=gR(T),ue=T.proxy,xe=T.ctx;GE=!1,Q.beforeCreate&&d_(Q.beforeCreate,T,"bc");const{data:Te,computed:Ne,methods:Z,watch:te,provide:E,inject:B,created:H,beforeMount:C,mounted:F,beforeUpdate:L,updated:M,activated:b,deactivated:S,beforeDestroy:I,beforeUnmount:O,destroyed:_,unmounted:D,render:V,renderTracked:J,renderTriggered:Y,errorCaptured:W,serverPrefetch:U,expose:q,inheritAttrs:oe,components:ve,directives:Ae,filters:Se}=Q;if(B&&uQ(B,xe,null,T.appContext.config.unwrapInjectedRef),Z)for(const pe in Z){const we=Z[pe];qr(we)&&(xe[pe]=we.bind(ue))}if(Te){const pe=Te.call(ue,ue);Qa(pe)&&(T.data=rI(pe))}if(GE=!0,Ne)for(const pe in Ne){const we=Ne[pe],he=qr(we)?we.bind(ue,ue):qr(we.get)?we.get.bind(ue,ue):xu,Pe=!qr(we)&&qr(we.set)?we.set.bind(ue):xu,Ve=VQ({get:he,set:Pe});Object.defineProperty(xe,pe,{enumerable:!0,configurable:!0,get:()=>Ve.value,set:ze=>Ve.value=ze})}if(te)for(const pe in te)mR(te[pe],xe,ue,pe);if(E){const pe=qr(E)?E.call(ue):E;Reflect.ownKeys(pe).forEach(we=>{XX(we,pe[we])})}H&&d_(H,T,"c");function de(pe,we){Kr(we)?we.forEach(he=>pe(he.bind(ue))):we&&pe(we.bind(ue))}if(de(eQ,C),de(dR,F),de(tQ,L),de(nQ,M),de(YX,b),de(JX,S),de(aQ,W),de(sQ,J),de(rQ,Y),de(pR,O),de(fR,D),de(iQ,U),Kr(q))if(q.length){const pe=T.exposed||(T.exposed={});q.forEach(we=>{Object.defineProperty(pe,we,{get:()=>ue[we],set:he=>ue[we]=he})})}else T.exposed||(T.exposed={});V&&T.render===xu&&(T.render=V),oe!=null&&(T.inheritAttrs=oe),ve&&(T.components=ve),Ae&&(T.directives=Ae)}function uQ(T,Q,ue=xu,xe=!1){Kr(T)&&(T=UE(T));for(const Te in T){const Ne=T[Te];let Z;Qa(Ne)?"default"in Ne?Z=SE(Ne.from||Te,Ne.default,!0):Z=SE(Ne.from||Te):Z=SE(Ne),ul(Z)&&xe?Object.defineProperty(Q,Te,{enumerable:!0,configurable:!0,get:()=>Z.value,set:te=>Z.value=te}):Q[Te]=Z}}function d_(T,Q,ue){Pc(Kr(T)?T.map(xe=>xe.bind(Q.proxy)):T.bind(Q.proxy),Q,ue)}function mR(T,Q,ue,xe){const Te=xe.includes(".")?lR(ue,xe):()=>ue[xe];if(Xo(T)){const Ne=Q[T];qr(Ne)&&TE(Te,Ne)}else if(qr(T))TE(Te,T.bind(ue));else if(Qa(T))if(Kr(T))T.forEach(Ne=>mR(Ne,Q,ue,xe));else{const Ne=qr(T.handler)?T.handler.bind(ue):Q[T.handler];qr(Ne)&&TE(Te,Ne,T)}}function gR(T){const Q=T.type,{mixins:ue,extends:xe}=Q,{mixins:Te,optionsCache:Ne,config:{optionMergeStrategies:Z}}=T.appContext,te=Ne.get(Q);let E;return te?E=te:!Te.length&&!ue&&!xe?E=Q:(E={},Te.length&&Te.forEach(B=>hb(E,B,Z,!0)),hb(E,Q,Z)),Qa(Q)&&Ne.set(Q,E),E}function hb(T,Q,ue,xe=!1){const{mixins:Te,extends:Ne}=Q;Ne&&hb(T,Ne,ue,!0),Te&&Te.forEach(Z=>hb(T,Z,ue,!0));for(const Z in Q)if(!(xe&&Z==="expose")){const te=hQ[Z]||ue&&ue[Z];T[Z]=te?te(T[Z],Q[Z]):Q[Z]}return T}const hQ={data:p_,props:gf,emits:gf,methods:gf,computed:gf,beforeCreate:Sl,created:Sl,beforeMount:Sl,mounted:Sl,beforeUpdate:Sl,updated:Sl,beforeDestroy:Sl,beforeUnmount:Sl,destroyed:Sl,unmounted:Sl,activated:Sl,deactivated:Sl,errorCaptured:Sl,serverPrefetch:Sl,components:gf,directives:gf,watch:pQ,provide:p_,inject:dQ};function p_(T,Q){return Q?T?function(){return hl(qr(T)?T.call(this,this):T,qr(Q)?Q.call(this,this):Q)}:Q:T}function dQ(T,Q){return gf(UE(T),UE(Q))}function UE(T){if(Kr(T)){const Q={};for(let ue=0;ue<T.length;ue++)Q[T[ue]]=T[ue];return Q}return T}function Sl(T,Q){return T?[...new Set([].concat(T,Q))]:Q}function gf(T,Q){return T?hl(hl(Object.create(null),T),Q):Q}function pQ(T,Q){if(!T)return Q;if(!Q)return T;const ue=hl(Object.create(null),T);for(const xe in Q)ue[xe]=Sl(T[xe],Q[xe]);return ue}function fQ(T,Q,ue,xe=!1){const Te={},Ne={};sb(Ne,bb,1),T.propsDefaults=Object.create(null),AR(T,Q,Te,Ne);for(const Z in T.propsOptions[0])Z in Te||(Te[Z]=void 0);ue?T.props=xe?Te:IX(Te):T.type.props?T.props=Te:T.props=Ne,T.attrs=Ne}function mQ(T,Q,ue,xe){const{props:Te,attrs:Ne,vnode:{patchFlag:Z}}=T,te=Ls(Te),[E]=T.propsOptions;let B=!1;if((xe||Z>0)&&!(Z&16)){if(Z&8){const H=T.vnode.dynamicProps;for(let C=0;C<H.length;C++){let F=H[C];if(Ab(T.emitsOptions,F))continue;const L=Q[F];if(E)if(Cs(Ne,F))L!==Ne[F]&&(Ne[F]=L,B=!0);else{const M=Eg(F);Te[M]=VE(E,te,M,L,T,!1)}else L!==Ne[F]&&(Ne[F]=L,B=!0)}}}else{AR(T,Q,Te,Ne)&&(B=!0);let H;for(const C in te)(!Q||!Cs(Q,C)&&((H=Tg(C))===C||!Cs(Q,H)))&&(E?ue&&(ue[C]!==void 0||ue[H]!==void 0)&&(Te[C]=VE(E,te,C,void 0,T,!0)):delete Te[C]);if(Ne!==te)for(const C in Ne)(!Q||!Cs(Q,C))&&(delete Ne[C],B=!0)}B&&td(T,"set","$attrs")}function AR(T,Q,ue,xe){const[Te,Ne]=T.propsOptions;let Z=!1,te;if(Q)for(let E in Q){if(nb(E))continue;const B=Q[E];let H;Te&&Cs(Te,H=Eg(E))?!Ne||!Ne.includes(H)?ue[H]=B:(te||(te={}))[H]=B:Ab(T.emitsOptions,E)||(!(E in xe)||B!==xe[E])&&(xe[E]=B,Z=!0)}if(Ne){const E=Ls(ue),B=te||pa;for(let H=0;H<Ne.length;H++){const C=Ne[H];ue[C]=VE(Te,E,C,B[C],T,!Cs(B,C))}}return Z}function VE(T,Q,ue,xe,Te,Ne){const Z=T[ue];if(Z!=null){const te=Cs(Z,"default");if(te&&xe===void 0){const E=Z.default;if(Z.type!==Function&&qr(E)){const{propsDefaults:B}=Te;ue in B?xe=B[ue]:(Sg(Te),xe=B[ue]=E.call(null,Q),xf())}else xe=E}Z[0]&&(Ne&&!te?xe=!1:Z[1]&&(xe===""||xe===Tg(ue))&&(xe=!0))}return xe}function vR(T,Q,ue=!1){const xe=Q.propsCache,Te=xe.get(T);if(Te)return Te;const Ne=T.props,Z={},te=[];let E=!1;if(!qr(T)){const H=C=>{E=!0;const[F,L]=vR(C,Q,!0);hl(Z,F),L&&te.push(...L)};!ue&&Q.mixins.length&&Q.mixins.forEach(H),T.extends&&H(T.extends),T.mixins&&T.mixins.forEach(H)}if(!Ne&&!E)return Qa(T)&&xe.set(T,bg),bg;if(Kr(Ne))for(let H=0;H<Ne.length;H++){const C=Eg(Ne[H]);f_(C)&&(Z[C]=pa)}else if(Ne)for(const H in Ne){const C=Eg(H);if(f_(C)){const F=Ne[H],L=Z[C]=Kr(F)||qr(F)?{type:F}:F;if(L){const M=A_(Boolean,L.type),b=A_(String,L.type);L[0]=M>-1,L[1]=b<0||M<b,(M>-1||Cs(L,"default"))&&te.push(C)}}}const B=[Z,te];return Qa(T)&&xe.set(T,B),B}function f_(T){return T[0]!=="$"}function m_(T){const Q=T&&T.toString().match(/^\s*function (\w+)/);return Q?Q[1]:T===null?"null":""}function g_(T,Q){return m_(T)===m_(Q)}function A_(T,Q){return Kr(Q)?Q.findIndex(ue=>g_(ue,T)):qr(Q)&&g_(Q,T)?0:-1}const yR=T=>T[0]==="_"||T==="$stable",uI=T=>Kr(T)?T.map(rh):[rh(T)],gQ=(T,Q,ue)=>{if(Q._n)return Q;const xe=GX((...Te)=>uI(Q(...Te)),ue);return xe._c=!1,xe},bR=(T,Q,ue)=>{const xe=T._ctx;for(const Te in T){if(yR(Te))continue;const Ne=T[Te];if(qr(Ne))Q[Te]=gQ(Te,Ne,xe);else if(Ne!=null){const Z=uI(Ne);Q[Te]=()=>Z}}},xR=(T,Q)=>{const ue=uI(Q);T.slots.default=()=>ue},AQ=(T,Q)=>{if(T.vnode.shapeFlag&32){const ue=Q._;ue?(T.slots=Ls(Q),sb(Q,"_",ue)):bR(Q,T.slots={})}else T.slots={},Q&&xR(T,Q);sb(T.slots,bb,1)},vQ=(T,Q,ue)=>{const{vnode:xe,slots:Te}=T;let Ne=!0,Z=pa;if(xe.shapeFlag&32){const te=Q._;te?ue&&te===1?Ne=!1:(hl(Te,Q),!ue&&te===1&&delete Te._):(Ne=!Q.$stable,bR(Q,Te)),Z=Q}else Q&&(xR(T,Q),Z={default:1});if(Ne)for(const te in Te)!yR(te)&&!(te in Z)&&delete Te[te]};function CR(){return{app:null,config:{isNativeTag:HK,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let yQ=0;function bQ(T,Q){return function(xe,Te=null){qr(xe)||(xe=Object.assign({},xe)),Te!=null&&!Qa(Te)&&(Te=null);const Ne=CR(),Z=new Set;let te=!1;const E=Ne.app={_uid:yQ++,_component:xe,_props:Te,_container:null,_context:Ne,_instance:null,version:zQ,get config(){return Ne.config},set config(B){},use(B,...H){return Z.has(B)||(B&&qr(B.install)?(Z.add(B),B.install(E,...H)):qr(B)&&(Z.add(B),B(E,...H))),E},mixin(B){return Ne.mixins.includes(B)||Ne.mixins.push(B),E},component(B,H){return H?(Ne.components[B]=H,E):Ne.components[B]},directive(B,H){return H?(Ne.directives[B]=H,E):Ne.directives[B]},mount(B,H,C){if(!te){const F=ap(xe,Te);return F.appContext=Ne,H&&Q?Q(F,B):T(F,B,C),te=!0,E._container=B,B.__vue_app__=E,pI(F.component)||F.component.proxy}},unmount(){te&&(T(null,E._container),delete E._container.__vue_app__)},provide(B,H){return Ne.provides[B]=H,E}};return E}}function zE(T,Q,ue,xe,Te=!1){if(Kr(T)){T.forEach((F,L)=>zE(F,Q&&(Kr(Q)?Q[L]:Q),ue,xe,Te));return}if(ib(xe)&&!Te)return;const Ne=xe.shapeFlag&4?pI(xe.component)||xe.component.proxy:xe.el,Z=Te?null:Ne,{i:te,r:E}=T,B=Q&&Q.r,H=te.refs===pa?te.refs={}:te.refs,C=te.setupState;if(B!=null&&B!==E&&(Xo(B)?(H[B]=null,Cs(C,B)&&(C[B]=null)):ul(B)&&(B.value=null)),qr(E))sp(E,te,12,[Z,H]);else{const F=Xo(E),L=ul(E);if(F||L){const M=()=>{if(T.f){const b=F?H[E]:E.value;Te?Kr(b)&&jE(b,Ne):Kr(b)?b.includes(Ne)||b.push(Ne):F?(H[E]=[Ne],Cs(C,E)&&(C[E]=H[E])):(E.value=[Ne],T.k&&(H[T.k]=E.value))}else F?(H[E]=Z,Cs(C,E)&&(C[E]=Z)):L&&(E.value=Z,T.k&&(H[T.k]=Z))};Z?(M.id=-1,Zl(M,ue)):M()}}}const Zl=KX;function xQ(T){return CQ(T)}function CQ(T,Q){const ue=YK();ue.__VUE__=!0;const{insert:xe,remove:Te,patchProp:Ne,createElement:Z,createText:te,createComment:E,setText:B,setElementText:H,parentNode:C,nextSibling:F,setScopeId:L=xu,cloneNode:M,insertStaticContent:b}=T,S=(nt,dt,Ot,$t=null,Ye=null,mn=null,Pn=!1,wn=null,Dn=!!dt.dynamicChildren)=>{if(nt===dt)return;nt&&!vf(nt,dt)&&($t=Jn(nt),et(nt,Ye,mn,!0),nt=null),dt.patchFlag===-2&&(Dn=!1,dt.dynamicChildren=null);const{type:gn,ref:ui,shapeFlag:Nt}=dt;switch(gn){case hI:I(nt,dt,Ot,$t);break;case ed:O(nt,dt,Ot,$t);break;case _E:nt==null&&_(dt,Ot,$t,Pn);break;case ih:Ae(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn);break;default:Nt&1?J(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn):Nt&6?Se(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn):(Nt&64||Nt&128)&&gn.process(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn,Wn)}ui!=null&&Ye&&zE(ui,nt&&nt.ref,mn,dt||nt,!dt)},I=(nt,dt,Ot,$t)=>{if(nt==null)xe(dt.el=te(dt.children),Ot,$t);else{const Ye=dt.el=nt.el;dt.children!==nt.children&&B(Ye,dt.children)}},O=(nt,dt,Ot,$t)=>{nt==null?xe(dt.el=E(dt.children||""),Ot,$t):dt.el=nt.el},_=(nt,dt,Ot,$t)=>{[nt.el,nt.anchor]=b(nt.children,dt,Ot,$t,nt.el,nt.anchor)},D=({el:nt,anchor:dt},Ot,$t)=>{let Ye;for(;nt&&nt!==dt;)Ye=F(nt),xe(nt,Ot,$t),nt=Ye;xe(dt,Ot,$t)},V=({el:nt,anchor:dt})=>{let Ot;for(;nt&&nt!==dt;)Ot=F(nt),Te(nt),nt=Ot;Te(dt)},J=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn)=>{Pn=Pn||dt.type==="svg",nt==null?Y(dt,Ot,$t,Ye,mn,Pn,wn,Dn):q(nt,dt,Ye,mn,Pn,wn,Dn)},Y=(nt,dt,Ot,$t,Ye,mn,Pn,wn)=>{let Dn,gn;const{type:ui,props:Nt,shapeFlag:De,transition:Re,patchFlag:We,dirs:Oe}=nt;if(nt.el&&M!==void 0&&We===-1)Dn=nt.el=M(nt.el);else{if(Dn=nt.el=Z(nt.type,mn,Nt&&Nt.is,Nt),De&8?H(Dn,nt.children):De&16&&U(nt.children,Dn,null,$t,Ye,mn&&ui!=="foreignObject",Pn,wn),Oe&&ff(nt,null,$t,"created"),Nt){for(const Ke in Nt)Ke!=="value"&&!nb(Ke)&&Ne(Dn,Ke,null,Nt[Ke],mn,nt.children,$t,Ye,cn);"value"in Nt&&Ne(Dn,"value",null,Nt.value),(gn=Nt.onVnodeBeforeMount)&&th(gn,$t,nt)}W(Dn,nt,nt.scopeId,Pn,$t)}Oe&&ff(nt,null,$t,"beforeMount");const Qe=(!Ye||Ye&&!Ye.pendingBranch)&&Re&&!Re.persisted;Qe&&Re.beforeEnter(Dn),xe(Dn,dt,Ot),((gn=Nt&&Nt.onVnodeMounted)||Qe||Oe)&&Zl(()=>{gn&&th(gn,$t,nt),Qe&&Re.enter(Dn),Oe&&ff(nt,null,$t,"mounted")},Ye)},W=(nt,dt,Ot,$t,Ye)=>{if(Ot&&L(nt,Ot),$t)for(let mn=0;mn<$t.length;mn++)L(nt,$t[mn]);if(Ye){let mn=Ye.subTree;if(dt===mn){const Pn=Ye.vnode;W(nt,Pn,Pn.scopeId,Pn.slotScopeIds,Ye.parent)}}},U=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn=0)=>{for(let gn=Dn;gn<nt.length;gn++){const ui=nt[gn]=wn?ip(nt[gn]):rh(nt[gn]);S(null,ui,dt,Ot,$t,Ye,mn,Pn,wn)}},q=(nt,dt,Ot,$t,Ye,mn,Pn)=>{const wn=dt.el=nt.el;let{patchFlag:Dn,dynamicChildren:gn,dirs:ui}=dt;Dn|=nt.patchFlag&16;const Nt=nt.props||pa,De=dt.props||pa;let Re;Ot&&mf(Ot,!1),(Re=De.onVnodeBeforeUpdate)&&th(Re,Ot,dt,nt),ui&&ff(dt,nt,Ot,"beforeUpdate"),Ot&&mf(Ot,!0);const We=Ye&&dt.type!=="foreignObject";if(gn?oe(nt.dynamicChildren,gn,wn,Ot,$t,We,mn):Pn||he(nt,dt,wn,null,Ot,$t,We,mn,!1),Dn>0){if(Dn&16)ve(wn,dt,Nt,De,Ot,$t,Ye);else if(Dn&2&&Nt.class!==De.class&&Ne(wn,"class",null,De.class,Ye),Dn&4&&Ne(wn,"style",Nt.style,De.style,Ye),Dn&8){const Oe=dt.dynamicProps;for(let Qe=0;Qe<Oe.length;Qe++){const Ke=Oe[Qe],vt=Nt[Ke],ct=De[Ke];(ct!==vt||Ke==="value")&&Ne(wn,Ke,vt,ct,Ye,nt.children,Ot,$t,cn)}}Dn&1&&nt.children!==dt.children&&H(wn,dt.children)}else!Pn&&gn==null&&ve(wn,dt,Nt,De,Ot,$t,Ye);((Re=De.onVnodeUpdated)||ui)&&Zl(()=>{Re&&th(Re,Ot,dt,nt),ui&&ff(dt,nt,Ot,"updated")},$t)},oe=(nt,dt,Ot,$t,Ye,mn,Pn)=>{for(let wn=0;wn<dt.length;wn++){const Dn=nt[wn],gn=dt[wn],ui=Dn.el&&(Dn.type===ih||!vf(Dn,gn)||Dn.shapeFlag&70)?C(Dn.el):Ot;S(Dn,gn,ui,null,$t,Ye,mn,Pn,!0)}},ve=(nt,dt,Ot,$t,Ye,mn,Pn)=>{if(Ot!==$t){for(const wn in $t){if(nb(wn))continue;const Dn=$t[wn],gn=Ot[wn];Dn!==gn&&wn!=="value"&&Ne(nt,wn,gn,Dn,Pn,dt.children,Ye,mn,cn)}if(Ot!==pa)for(const wn in Ot)!nb(wn)&&!(wn in $t)&&Ne(nt,wn,Ot[wn],null,Pn,dt.children,Ye,mn,cn);"value"in $t&&Ne(nt,"value",Ot.value,$t.value)}},Ae=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn)=>{const gn=dt.el=nt?nt.el:te(""),ui=dt.anchor=nt?nt.anchor:te("");let{patchFlag:Nt,dynamicChildren:De,slotScopeIds:Re}=dt;Re&&(wn=wn?wn.concat(Re):Re),nt==null?(xe(gn,Ot,$t),xe(ui,Ot,$t),U(dt.children,Ot,ui,Ye,mn,Pn,wn,Dn)):Nt>0&&Nt&64&&De&&nt.dynamicChildren?(oe(nt.dynamicChildren,De,Ot,Ye,mn,Pn,wn),(dt.key!=null||Ye&&dt===Ye.subTree)&&wR(nt,dt,!0)):he(nt,dt,Ot,ui,Ye,mn,Pn,wn,Dn)},Se=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn)=>{dt.slotScopeIds=wn,nt==null?dt.shapeFlag&512?Ye.ctx.activate(dt,Ot,$t,Pn,Dn):Ie(dt,Ot,$t,Ye,mn,Pn,Dn):de(nt,dt,Dn)},Ie=(nt,dt,Ot,$t,Ye,mn,Pn)=>{const wn=nt.component=DQ(nt,$t,Ye);if(vb(nt)&&(wn.ctx.renderer=Wn),FQ(wn),wn.asyncDep){if(Ye&&Ye.registerDep(wn,pe),!nt.el){const Dn=wn.subTree=ap(ed);O(null,Dn,dt,Ot)}return}pe(wn,nt,dt,Ot,Ye,mn,Pn)},de=(nt,dt,Ot)=>{const $t=dt.component=nt.component;if(zX(nt,dt,Ot))if($t.asyncDep&&!$t.asyncResolved){we($t,dt,Ot);return}else $t.next=dt,NX($t.update),$t.update();else dt.el=nt.el,$t.vnode=dt},pe=(nt,dt,Ot,$t,Ye,mn,Pn)=>{const wn=()=>{if(nt.isMounted){let{next:ui,bu:Nt,u:De,parent:Re,vnode:We}=nt,Oe=ui,Qe;mf(nt,!1),ui?(ui.el=We.el,we(nt,ui,Pn)):ui=We,Nt&&EE(Nt),(Qe=ui.props&&ui.props.onVnodeBeforeUpdate)&&th(Qe,Re,ui,We),mf(nt,!0);const Ke=IE(nt),vt=nt.subTree;nt.subTree=Ke,S(vt,Ke,C(vt.el),Jn(vt),nt,Ye,mn),ui.el=Ke.el,Oe===null&&WX(nt,Ke.el),De&&Zl(De,Ye),(Qe=ui.props&&ui.props.onVnodeUpdated)&&Zl(()=>th(Qe,Re,ui,We),Ye)}else{let ui;const{el:Nt,props:De}=dt,{bm:Re,m:We,parent:Oe}=nt,Qe=ib(dt);if(mf(nt,!1),Re&&EE(Re),!Qe&&(ui=De&&De.onVnodeBeforeMount)&&th(ui,Oe,dt),mf(nt,!0),Nt&&ai){const Ke=()=>{nt.subTree=IE(nt),ai(Nt,nt.subTree,nt,Ye,null)};Qe?dt.type.__asyncLoader().then(()=>!nt.isUnmounted&&Ke()):Ke()}else{const Ke=nt.subTree=IE(nt);S(null,Ke,Ot,$t,nt,Ye,mn),dt.el=Ke.el}if(We&&Zl(We,Ye),!Qe&&(ui=De&&De.onVnodeMounted)){const Ke=dt;Zl(()=>th(ui,Oe,Ke),Ye)}(dt.shapeFlag&256||Oe&&ib(Oe.vnode)&&Oe.vnode.shapeFlag&256)&&nt.a&&Zl(nt.a,Ye),nt.isMounted=!0,dt=Ot=$t=null}},Dn=nt.effect=new eI(wn,()=>cI(gn),nt.scope),gn=nt.update=()=>Dn.run();gn.id=nt.uid,mf(nt,!0),gn()},we=(nt,dt,Ot)=>{dt.component=nt;const $t=nt.vnode.props;nt.vnode=dt,nt.next=null,mQ(nt,dt.props,$t,Ot),vQ(nt,dt.children,Ot),Mg(),l_(),_g()},he=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn=!1)=>{const gn=nt&&nt.children,ui=nt?nt.shapeFlag:0,Nt=dt.children,{patchFlag:De,shapeFlag:Re}=dt;if(De>0){if(De&128){Ve(gn,Nt,Ot,$t,Ye,mn,Pn,wn,Dn);return}else if(De&256){Pe(gn,Nt,Ot,$t,Ye,mn,Pn,wn,Dn);return}}Re&8?(ui&16&&cn(gn,Ye,mn),Nt!==gn&&H(Ot,Nt)):ui&16?Re&16?Ve(gn,Nt,Ot,$t,Ye,mn,Pn,wn,Dn):cn(gn,Ye,mn,!0):(ui&8&&H(Ot,""),Re&16&&U(Nt,Ot,$t,Ye,mn,Pn,wn,Dn))},Pe=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn)=>{nt=nt||bg,dt=dt||bg;const gn=nt.length,ui=dt.length,Nt=Math.min(gn,ui);let De;for(De=0;De<Nt;De++){const Re=dt[De]=Dn?ip(dt[De]):rh(dt[De]);S(nt[De],Re,Ot,null,Ye,mn,Pn,wn,Dn)}gn>ui?cn(nt,Ye,mn,!0,!1,Nt):U(dt,Ot,$t,Ye,mn,Pn,wn,Dn,Nt)},Ve=(nt,dt,Ot,$t,Ye,mn,Pn,wn,Dn)=>{let gn=0;const ui=dt.length;let Nt=nt.length-1,De=ui-1;for(;gn<=Nt&&gn<=De;){const Re=nt[gn],We=dt[gn]=Dn?ip(dt[gn]):rh(dt[gn]);if(vf(Re,We))S(Re,We,Ot,null,Ye,mn,Pn,wn,Dn);else break;gn++}for(;gn<=Nt&&gn<=De;){const Re=nt[Nt],We=dt[De]=Dn?ip(dt[De]):rh(dt[De]);if(vf(Re,We))S(Re,We,Ot,null,Ye,mn,Pn,wn,Dn);else break;Nt--,De--}if(gn>Nt){if(gn<=De){const Re=De+1,We=Re<ui?dt[Re].el:$t;for(;gn<=De;)S(null,dt[gn]=Dn?ip(dt[gn]):rh(dt[gn]),Ot,We,Ye,mn,Pn,wn,Dn),gn++}}else if(gn>De)for(;gn<=Nt;)et(nt[gn],Ye,mn,!0),gn++;else{const Re=gn,We=gn,Oe=new Map;for(gn=We;gn<=De;gn++){const ee=dt[gn]=Dn?ip(dt[gn]):rh(dt[gn]);ee.key!=null&&Oe.set(ee.key,gn)}let Qe,Ke=0;const vt=De-We+1;let ct=!1,Ct=0;const Yt=new Array(vt);for(gn=0;gn<vt;gn++)Yt[gn]=0;for(gn=Re;gn<=Nt;gn++){const ee=nt[gn];if(Ke>=vt){et(ee,Ye,mn,!0);continue}let ae;if(ee.key!=null)ae=Oe.get(ee.key);else for(Qe=We;Qe<=De;Qe++)if(Yt[Qe-We]===0&&vf(ee,dt[Qe])){ae=Qe;break}ae===void 0?et(ee,Ye,mn,!0):(Yt[ae-We]=gn+1,ae>=Ct?Ct=ae:ct=!0,S(ee,dt[ae],Ot,null,Ye,mn,Pn,wn,Dn),Ke++)}const me=ct?wQ(Yt):bg;for(Qe=me.length-1,gn=vt-1;gn>=0;gn--){const ee=We+gn,ae=dt[ee],Ue=ee+1<ui?dt[ee+1].el:$t;Yt[gn]===0?S(null,ae,Ot,Ue,Ye,mn,Pn,wn,Dn):ct&&(Qe<0||gn!==me[Qe]?ze(ae,Ot,Ue,2):Qe--)}}},ze=(nt,dt,Ot,$t,Ye=null)=>{const{el:mn,type:Pn,transition:wn,children:Dn,shapeFlag:gn}=nt;if(gn&6){ze(nt.component.subTree,dt,Ot,$t);return}if(gn&128){nt.suspense.move(dt,Ot,$t);return}if(gn&64){Pn.move(nt,dt,Ot,Wn);return}if(Pn===ih){xe(mn,dt,Ot);for(let Nt=0;Nt<Dn.length;Nt++)ze(Dn[Nt],dt,Ot,$t);xe(nt.anchor,dt,Ot);return}if(Pn===_E){D(nt,dt,Ot);return}if($t!==2&&gn&1&&wn)if($t===0)wn.beforeEnter(mn),xe(mn,dt,Ot),Zl(()=>wn.enter(mn),Ye);else{const{leave:Nt,delayLeave:De,afterLeave:Re}=wn,We=()=>xe(mn,dt,Ot),Oe=()=>{Nt(mn,()=>{We(),Re&&Re()})};De?De(mn,We,Oe):Oe()}else xe(mn,dt,Ot)},et=(nt,dt,Ot,$t=!1,Ye=!1)=>{const{type:mn,props:Pn,ref:wn,children:Dn,dynamicChildren:gn,shapeFlag:ui,patchFlag:Nt,dirs:De}=nt;if(wn!=null&&zE(wn,null,Ot,nt,!0),ui&256){dt.ctx.deactivate(nt);return}const Re=ui&1&&De,We=!ib(nt);let Oe;if(We&&(Oe=Pn&&Pn.onVnodeBeforeUnmount)&&th(Oe,dt,nt),ui&6)fn(nt.component,Ot,$t);else{if(ui&128){nt.suspense.unmount(Ot,$t);return}Re&&ff(nt,null,dt,"beforeUnmount"),ui&64?nt.type.remove(nt,dt,Ot,Ye,Wn,$t):gn&&(mn!==ih||Nt>0&&Nt&64)?cn(gn,dt,Ot,!1,!0):(mn===ih&&Nt&384||!Ye&&ui&16)&&cn(Dn,dt,Ot),$t&&Tt(nt)}(We&&(Oe=Pn&&Pn.onVnodeUnmounted)||Re)&&Zl(()=>{Oe&&th(Oe,dt,nt),Re&&ff(nt,null,dt,"unmounted")},Ot)},Tt=nt=>{const{type:dt,el:Ot,anchor:$t,transition:Ye}=nt;if(dt===ih){Rt(Ot,$t);return}if(dt===_E){V(nt);return}const mn=()=>{Te(Ot),Ye&&!Ye.persisted&&Ye.afterLeave&&Ye.afterLeave()};if(nt.shapeFlag&1&&Ye&&!Ye.persisted){const{leave:Pn,delayLeave:wn}=Ye,Dn=()=>Pn(Ot,mn);wn?wn(nt.el,mn,Dn):Dn()}else mn()},Rt=(nt,dt)=>{let Ot;for(;nt!==dt;)Ot=F(nt),Te(nt),nt=Ot;Te(dt)},fn=(nt,dt,Ot)=>{const{bum:$t,scope:Ye,update:mn,subTree:Pn,um:wn}=nt;$t&&EE($t),Ye.stop(),mn&&(mn.active=!1,et(Pn,nt,dt,Ot)),wn&&Zl(wn,dt),Zl(()=>{nt.isUnmounted=!0},dt),dt&&dt.pendingBranch&&!dt.isUnmounted&&nt.asyncDep&&!nt.asyncResolved&&nt.suspenseId===dt.pendingId&&(dt.deps--,dt.deps===0&&dt.resolve())},cn=(nt,dt,Ot,$t=!1,Ye=!1,mn=0)=>{for(let Pn=mn;Pn<nt.length;Pn++)et(nt[Pn],dt,Ot,$t,Ye)},Jn=nt=>nt.shapeFlag&6?Jn(nt.component.subTree):nt.shapeFlag&128?nt.suspense.next():F(nt.anchor||nt.el),yn=(nt,dt,Ot)=>{nt==null?dt._vnode&&et(dt._vnode,null,null,!0):S(dt._vnode||null,nt,dt,null,null,null,Ot),l_(),iR(),dt._vnode=nt},Wn={p:S,um:et,m:ze,r:Tt,mt:Ie,mc:U,pc:he,pbc:oe,n:Jn,o:T};let gi,ai;return Q&&([gi,ai]=Q(Wn)),{render:yn,hydrate:gi,createApp:bQ(yn,gi)}}function mf({effect:T,update:Q},ue){T.allowRecurse=Q.allowRecurse=ue}function wR(T,Q,ue=!1){const xe=T.children,Te=Q.children;if(Kr(xe)&&Kr(Te))for(let Ne=0;Ne<xe.length;Ne++){const Z=xe[Ne];let te=Te[Ne];te.shapeFlag&1&&!te.dynamicChildren&&((te.patchFlag<=0||te.patchFlag===32)&&(te=Te[Ne]=ip(Te[Ne]),te.el=Z.el),ue||wR(Z,te))}}function wQ(T){const Q=T.slice(),ue=[0];let xe,Te,Ne,Z,te;const E=T.length;for(xe=0;xe<E;xe++){const B=T[xe];if(B!==0){if(Te=ue[ue.length-1],T[Te]<B){Q[xe]=Te,ue.push(xe);continue}for(Ne=0,Z=ue.length-1;Ne<Z;)te=Ne+Z>>1,T[ue[te]]<B?Ne=te+1:Z=te;B<T[ue[Ne]]&&(Ne>0&&(Q[xe]=ue[Ne-1]),ue[Ne]=xe)}}for(Ne=ue.length,Z=ue[Ne-1];Ne-- >0;)ue[Ne]=Z,Z=Q[Z];return ue}const EQ=T=>T.__isTeleport,ih=Symbol(void 0),hI=Symbol(void 0),ed=Symbol(void 0),_E=Symbol(void 0),KA=[];let bu=null;function ER(T=!1){KA.push(bu=T?null:[])}function IQ(){KA.pop(),bu=KA[KA.length-1]||null}let jA=1;function v_(T){jA+=T}function SQ(T){return T.dynamicChildren=jA>0?bu||bg:null,IQ(),jA>0&&bu&&bu.push(T),T}function IR(T,Q,ue,xe,Te,Ne){return SQ(Oc(T,Q,ue,xe,Te,Ne,!0))}function TQ(T){return T?T.__v_isVNode===!0:!1}function vf(T,Q){return T.type===Q.type&&T.key===Q.key}const bb="__vInternal",SR=({key:T})=>T??null,rb=({ref:T,ref_key:Q,ref_for:ue})=>T!=null?Xo(T)||ul(T)||qr(T)?{i:ah,r:T,k:Q,f:!!ue}:T:null;function Oc(T,Q=null,ue=null,xe=0,Te=null,Ne=T===ih?0:1,Z=!1,te=!1){const E={__v_isVNode:!0,__v_skip:!0,type:T,props:Q,key:Q&&SR(Q),ref:Q&&rb(Q),scopeId:aR,slotScopeIds:null,children:ue,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:Ne,patchFlag:xe,dynamicProps:Te,dynamicChildren:null,appContext:null};return te?(dI(E,ue),Ne&128&&T.normalize(E)):ue&&(E.shapeFlag|=Xo(ue)?8:16),jA>0&&!Z&&bu&&(E.patchFlag>0||Ne&6)&&E.patchFlag!==32&&bu.push(E),E}const ap=MQ;function MQ(T,Q=null,ue=null,xe=0,Te=null,Ne=!1){if((!T||T===oQ)&&(T=ed),TQ(T)){const te=lp(T,Q,!0);return ue&&dI(te,ue),jA>0&&!Ne&&bu&&(te.shapeFlag&6?bu[bu.indexOf(T)]=te:bu.push(te)),te.patchFlag|=-2,te}if(UQ(T)&&(T=T.__vccOpts),Q){Q=_Q(Q);let{class:te,style:E}=Q;te&&!Xo(te)&&(Q.class=ZE(te)),Qa(E)&&(j_(E)&&!Kr(E)&&(E=hl({},E)),Q.style=QE(E))}const Z=Xo(T)?1:HX(T)?128:EQ(T)?64:Qa(T)?4:qr(T)?2:0;return Oc(T,Q,ue,xe,Te,Z,Ne,!0)}function _Q(T){return T?j_(T)||bb in T?hl({},T):T:null}function lp(T,Q,ue=!1){const{props:xe,ref:Te,patchFlag:Ne,children:Z}=T,te=Q?BQ(xe||{},Q):xe;return{__v_isVNode:!0,__v_skip:!0,type:T.type,props:te,key:te&&SR(te),ref:Q&&Q.ref?ue&&Te?Kr(Te)?Te.concat(rb(Q)):[Te,rb(Q)]:rb(Q):Te,scopeId:T.scopeId,slotScopeIds:T.slotScopeIds,children:Z,target:T.target,targetAnchor:T.targetAnchor,staticCount:T.staticCount,shapeFlag:T.shapeFlag,patchFlag:Q&&T.type!==ih?Ne===-1?16:Ne|16:Ne,dynamicProps:T.dynamicProps,dynamicChildren:T.dynamicChildren,appContext:T.appContext,dirs:T.dirs,transition:T.transition,component:T.component,suspense:T.suspense,ssContent:T.ssContent&&lp(T.ssContent),ssFallback:T.ssFallback&&lp(T.ssFallback),el:T.el,anchor:T.anchor}}function RQ(T=" ",Q=0){return ap(hI,null,T,Q)}function rh(T){return T==null||typeof T=="boolean"?ap(ed):Kr(T)?ap(ih,null,T.slice()):typeof T=="object"?ip(T):ap(hI,null,String(T))}function ip(T){return T.el===null||T.memo?T:lp(T)}function dI(T,Q){let ue=0;const{shapeFlag:xe}=T;if(Q==null)Q=null;else if(Kr(Q))ue=16;else if(typeof Q=="object")if(xe&65){const Te=Q.default;Te&&(Te._c&&(Te._d=!1),dI(T,Te()),Te._c&&(Te._d=!0));return}else{ue=32;const Te=Q._;!Te&&!(bb in Q)?Q._ctx=ah:Te===3&&ah&&(ah.slots._===1?Q._=1:(Q._=2,T.patchFlag|=1024))}else qr(Q)?(Q={default:Q,_ctx:ah},ue=32):(Q=String(Q),xe&64?(ue=16,Q=[RQ(Q)]):ue=8);T.children=Q,T.shapeFlag|=ue}function BQ(...T){const Q={};for(let ue=0;ue<T.length;ue++){const xe=T[ue];for(const Te in xe)if(Te==="class")Q.class!==xe.class&&(Q.class=ZE([Q.class,xe.class]));else if(Te==="style")Q.style=QE([Q.style,xe.style]);else if(db(Te)){const Ne=Q[Te],Z=xe[Te];Z&&Ne!==Z&&!(Kr(Ne)&&Ne.includes(Z))&&(Q[Te]=Ne?[].concat(Ne,Z):Z)}else Te!==""&&(Q[Te]=xe[Te])}return Q}function th(T,Q,ue,xe=null){Pc(T,Q,7,[ue,xe])}const kQ=CR();let LQ=0;function DQ(T,Q,ue){const xe=T.type,Te=(Q?Q.appContext:T.appContext)||kQ,Ne={uid:LQ++,vnode:T,type:xe,parent:Q,appContext:Te,root:null,next:null,subTree:null,effect:null,update:null,scope:new O_(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:Q?Q.provides:Object.create(Te.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:vR(xe,Te),emitsOptions:sR(xe,Te),emit:null,emitted:null,propsDefaults:pa,inheritAttrs:xe.inheritAttrs,ctx:pa,data:pa,props:pa,attrs:pa,slots:pa,refs:pa,setupState:pa,setupContext:null,suspense:ue,suspenseId:ue?ue.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return Ne.ctx={_:Ne},Ne.root=Q?Q.root:Ne,Ne.emit=OX.bind(null,Ne),T.ce&&T.ce(Ne),Ne}let Ko=null;const NQ=()=>Ko||ah,Sg=T=>{Ko=T,T.scope.on()},xf=()=>{Ko&&Ko.scope.off(),Ko=null};function TR(T){return T.vnode.shapeFlag&4}let YA=!1;function FQ(T,Q=!1){YA=Q;const{props:ue,children:xe}=T.vnode,Te=TR(T);fQ(T,ue,Te,Q),AQ(T,xe);const Ne=Te?PQ(T,Q):void 0;return YA=!1,Ne}function PQ(T,Q){const ue=T.type;T.accessCache=Object.create(null),T.proxy=aI(new Proxy(T.ctx,lQ));const{setup:xe}=ue;if(xe){const Te=T.setupContext=xe.length>1?GQ(T):null;Sg(T),Mg();const Ne=sp(xe,T,0,[T.props,Te]);if(_g(),xf(),D_(Ne)){if(Ne.then(xf,xf),Q)return Ne.then(Z=>{y_(T,Z,Q)}).catch(Z=>{gb(Z,T,0)});T.asyncDep=Ne}else y_(T,Ne,Q)}else MR(T,Q)}function y_(T,Q,ue){qr(Q)?T.type.__ssrInlineRender?T.ssrRender=Q:T.render=Q:Qa(Q)&&(T.setupState=q_(Q)),MR(T,ue)}let b_;function MR(T,Q,ue){const xe=T.type;if(!T.render){if(!Q&&b_&&!xe.render){const Te=xe.template;if(Te){const{isCustomElement:Ne,compilerOptions:Z}=T.appContext.config,{delimiters:te,compilerOptions:E}=xe,B=hl(hl({isCustomElement:Ne,delimiters:te},Z),E);xe.render=b_(Te,B)}}T.render=xe.render||xu}Sg(T),Mg(),cQ(T),_g(),xf()}function OQ(T){return new Proxy(T.attrs,{get(Q,ue){return pc(T,"get","$attrs"),Q[ue]}})}function GQ(T){const Q=xe=>{T.exposed=xe||{}};let ue;return{get attrs(){return ue||(ue=OQ(T))},slots:T.slots,emit:T.emit,expose:Q}}function pI(T){if(T.exposed)return T.exposeProxy||(T.exposeProxy=new Proxy(q_(aI(T.exposed)),{get(Q,ue){if(ue in Q)return Q[ue];if(ue in ub)return ub[ue](T)}}))}function UQ(T){return qr(T)&&"__vccOpts"in T}const VQ=(T,Q)=>BX(T,Q,YA),zQ="3.2.38",WQ="http://www.w3.org/2000/svg",yf=typeof document<"u"?document:null,x_=yf&&yf.createElement("template"),HQ={insert:(T,Q,ue)=>{Q.insertBefore(T,ue||null)},remove:T=>{const Q=T.parentNode;Q&&Q.removeChild(T)},createElement:(T,Q,ue,xe)=>{const Te=Q?yf.createElementNS(WQ,T):yf.createElement(T,ue?{is:ue}:void 0);return T==="select"&&xe&&xe.multiple!=null&&Te.setAttribute("multiple",xe.multiple),Te},createText:T=>yf.createTextNode(T),createComment:T=>yf.createComment(T),setText:(T,Q)=>{T.nodeValue=Q},setElementText:(T,Q)=>{T.textContent=Q},parentNode:T=>T.parentNode,nextSibling:T=>T.nextSibling,querySelector:T=>yf.querySelector(T),setScopeId(T,Q){T.setAttribute(Q,"")},cloneNode(T){const Q=T.cloneNode(!0);return"_value"in T&&(Q._value=T._value),Q},insertStaticContent(T,Q,ue,xe,Te,Ne){const Z=ue?ue.previousSibling:Q.lastChild;if(Te&&(Te===Ne||Te.nextSibling))for(;Q.insertBefore(Te.cloneNode(!0),ue),!(Te===Ne||!(Te=Te.nextSibling)););else{x_.innerHTML=xe?`<svg>${T}</svg>`:T;const te=x_.content;if(xe){const E=te.firstChild;for(;E.firstChild;)te.appendChild(E.firstChild);te.removeChild(E)}Q.insertBefore(te,ue)}return[Z?Z.nextSibling:Q.firstChild,ue?ue.previousSibling:Q.lastChild]}};function KQ(T,Q,ue){const xe=T._vtc;xe&&(Q=(Q?[Q,...xe]:[...xe]).join(" ")),Q==null?T.removeAttribute("class"):ue?T.setAttribute("class",Q):T.className=Q}function XQ(T,Q,ue){const xe=T.style,Te=Xo(ue);if(ue&&!Te){for(const Ne in ue)WE(xe,Ne,ue[Ne]);if(Q&&!Xo(Q))for(const Ne in Q)ue[Ne]==null&&WE(xe,Ne,"")}else{const Ne=xe.display;Te?Q!==ue&&(xe.cssText=ue):Q&&T.removeAttribute("style"),"_vod"in T&&(xe.display=Ne)}}const C_=/\s*!important$/;function WE(T,Q,ue){if(Kr(ue))ue.forEach(xe=>WE(T,Q,xe));else if(ue==null&&(ue=""),Q.startsWith("--"))T.setProperty(Q,ue);else{const xe=QQ(T,Q);C_.test(ue)?T.setProperty(Tg(xe),ue.replace(C_,""),"important"):T[xe]=ue}}const w_=["Webkit","Moz","ms"],RE={};function QQ(T,Q){const ue=RE[Q];if(ue)return ue;let xe=Eg(Q);if(xe!=="filter"&&xe in T)return RE[Q]=xe;xe=P_(xe);for(let Te=0;Te<w_.length;Te++){const Ne=w_[Te]+xe;if(Ne in T)return RE[Q]=Ne}return Q}const E_="http://www.w3.org/1999/xlink";function ZQ(T,Q,ue,xe,Te){if(xe&&Q.startsWith("xlink:"))ue==null?T.removeAttributeNS(E_,Q.slice(6,Q.length)):T.setAttributeNS(E_,Q,ue);else{const Ne=GK(Q);ue==null||Ne&&!B_(ue)?T.removeAttribute(Q):T.setAttribute(Q,Ne?"":ue)}}function $Q(T,Q,ue,xe,Te,Ne,Z){if(Q==="innerHTML"||Q==="textContent"){xe&&Z(xe,Te,Ne),T[Q]=ue??"";return}if(Q==="value"&&T.tagName!=="PROGRESS"&&!T.tagName.includes("-")){T._value=ue;const E=ue??"";(T.value!==E||T.tagName==="OPTION")&&(T.value=E),ue==null&&T.removeAttribute(Q);return}let te=!1;if(ue===""||ue==null){const E=typeof T[Q];E==="boolean"?ue=B_(ue):ue==null&&E==="string"?(ue="",te=!0):E==="number"&&(ue=0,te=!0)}try{T[Q]=ue}catch{}te&&T.removeAttribute(Q)}const[_R,jQ]=(()=>{let T=Date.now,Q=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(T=performance.now.bind(performance));const ue=navigator.userAgent.match(/firefox\/(\d+)/i);Q=!!(ue&&Number(ue[1])<=53)}return[T,Q]})();let HE=0;const YQ=Promise.resolve(),JQ=()=>{HE=0},qQ=()=>HE||(YQ.then(JQ),HE=_R());function eZ(T,Q,ue,xe){T.addEventListener(Q,ue,xe)}function tZ(T,Q,ue,xe){T.removeEventListener(Q,ue,xe)}function nZ(T,Q,ue,xe,Te=null){const Ne=T._vei||(T._vei={}),Z=Ne[Q];if(xe&&Z)Z.value=xe;else{const[te,E]=iZ(Q);if(xe){const B=Ne[Q]=rZ(xe,Te);eZ(T,te,B,E)}else Z&&(tZ(T,te,Z,E),Ne[Q]=void 0)}}const I_=/(?:Once|Passive|Capture)$/;function iZ(T){let Q;if(I_.test(T)){Q={};let xe;for(;xe=T.match(I_);)T=T.slice(0,T.length-xe[0].length),Q[xe[0].toLowerCase()]=!0}return[T[2]===":"?T.slice(3):Tg(T.slice(2)),Q]}function rZ(T,Q){const ue=xe=>{const Te=xe.timeStamp||_R();(jQ||Te>=ue.attached-1)&&Pc(sZ(xe,ue.value),Q,5,[xe])};return ue.value=T,ue.attached=qQ(),ue}function sZ(T,Q){if(Kr(Q)){const ue=T.stopImmediatePropagation;return T.stopImmediatePropagation=()=>{ue.call(T),T._stopped=!0},Q.map(xe=>Te=>!Te._stopped&&xe&&xe(Te))}else return Q}const S_=/^on[a-z]/,aZ=(T,Q,ue,xe,Te=!1,Ne,Z,te,E)=>{Q==="class"?KQ(T,xe,Te):Q==="style"?XQ(T,ue,xe):db(Q)?$E(Q)||nZ(T,Q,ue,xe,Z):(Q[0]==="."?(Q=Q.slice(1),!0):Q[0]==="^"?(Q=Q.slice(1),!1):oZ(T,Q,xe,Te))?$Q(T,Q,xe,Ne,Z,te,E):(Q==="true-value"?T._trueValue=xe:Q==="false-value"&&(T._falseValue=xe),ZQ(T,Q,xe,Te))};function oZ(T,Q,ue,xe){return xe?!!(Q==="innerHTML"||Q==="textContent"||Q in T&&S_.test(Q)&&qr(ue)):Q==="spellcheck"||Q==="draggable"||Q==="translate"||Q==="form"||Q==="list"&&T.tagName==="INPUT"||Q==="type"&&T.tagName==="TEXTAREA"||S_.test(Q)&&Xo(ue)?!1:Q in T}const lZ={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};jX.props;const cZ=hl({patchProp:aZ},HQ);let T_;function uZ(){return T_||(T_=xQ(cZ))}const hZ=(...T)=>{const Q=uZ().createApp(...T),{mount:ue}=Q;return Q.mount=xe=>{const Te=dZ(xe);if(!Te)return;const Ne=Q._component;!qr(Ne)&&!Ne.render&&!Ne.template&&(Ne.template=Te.innerHTML),Te.innerHTML="";const Z=ue(Te,!1,Te instanceof SVGElement);return Te instanceof Element&&(Te.removeAttribute("v-cloak"),Te.setAttribute("data-v-app","")),Z},Q};function dZ(T){return Xo(T)?document.querySelector(T):T}var pZ=!1;/*!
  * pinia v2.0.21
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const fZ=Symbol();var M_;(function(T){T.direct="direct",T.patchObject="patch object",T.patchFunction="patch function"})(M_||(M_={}));function mZ(){const T=JK(!0),Q=T.run(()=>ob({}));let ue=[],xe=[];const Te=aI({install(Ne){Te._a=Ne,Ne.provide(fZ,Te),Ne.config.globalProperties.$pinia=Te,xe.forEach(Z=>ue.push(Z)),xe=[]},use(Ne){return!this._a&&!pZ?xe.push(Ne):ue.push(Ne),this},_p:ue,_a:null,_e:T,_s:new Map,state:Q});return Te}var yg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gZ(T){if(T.__esModule)return T;var Q=T.default;if(typeof Q=="function"){var ue=function xe(){if(this instanceof xe){var Te=[null];Te.push.apply(Te,arguments);var Ne=Function.bind.apply(Q,Te);return new Ne}return Q.apply(this,arguments)};ue.prototype=Q.prototype}else ue={};return Object.defineProperty(ue,"__esModule",{value:!0}),Object.keys(T).forEach(function(xe){var Te=Object.getOwnPropertyDescriptor(T,xe);Object.defineProperty(ue,xe,Te.get?Te:{enumerable:!0,get:function(){return T[xe]}})}),ue}var __={},AZ={get exports(){return __},set exports(T){__=T}};(function(T,Q){(function(xe,Te){T.exports=Te()})(self,()=>(()=>{var ue={"./node_modules/@ungap/custom-elements/index.js":()=>{/*! (c) Andrea Giammarchi @webreflection ISC */(function(){var Z=function(ti,hn){var On=function(Gi){for(var nr=0,cr=Gi.length;nr<cr;nr++)Oi(Gi[nr])},Oi=function(Gi){var nr=Gi.target,cr=Gi.attributeName,Xr=Gi.oldValue;nr.attributeChangedCallback(cr,Xr,nr.getAttribute(cr))};return function(Yn,Gi){var nr=Yn.constructor.observedAttributes;return nr&&ti(Gi).then(function(){new hn(On).observe(Yn,{attributes:!0,attributeOldValue:!0,attributeFilter:nr});for(var cr=0,Xr=nr.length;cr<Xr;cr++)Yn.hasAttribute(nr[cr])&&Oi({target:Yn,attributeName:nr[cr],oldValue:null})}),Yn}};function te(ti,hn){if(ti){if(typeof ti=="string")return E(ti,hn);var On=Object.prototype.toString.call(ti).slice(8,-1);if(On==="Object"&&ti.constructor&&(On=ti.constructor.name),On==="Map"||On==="Set")return Array.from(ti);if(On==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(On))return E(ti,hn)}}function E(ti,hn){(hn==null||hn>ti.length)&&(hn=ti.length);for(var On=0,Oi=new Array(hn);On<hn;On++)Oi[On]=ti[On];return Oi}function B(ti,hn){var On=typeof Symbol<"u"&&ti[Symbol.iterator]||ti["@@iterator"];if(!On){if(Array.isArray(ti)||(On=te(ti))||hn&&ti&&typeof ti.length=="number"){On&&(ti=On);var Oi=0,Yn=function(){};return{s:Yn,n:function(){return Oi>=ti.length?{done:!0}:{done:!1,value:ti[Oi++]}},e:function(Xr){throw Xr},f:Yn}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Gi=!0,nr=!1,cr;return{s:function(){On=On.call(ti)},n:function(){var Xr=On.next();return Gi=Xr.done,Xr},e:function(Xr){nr=!0,cr=Xr},f:function(){try{!Gi&&On.return!=null&&On.return()}finally{if(nr)throw cr}}}}/*! (c) Andrea Giammarchi - ISC */var H=!0,C=!1,F="querySelectorAll",L=function(hn){var On=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document,Oi=arguments.length>2&&arguments[2]!==void 0?arguments[2]:MutationObserver,Yn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:["*"],Gi=function Xr(Fr,$r,ws,vr,As,vs){var Ge=B(Fr),st;try{for(Ge.s();!(st=Ge.n()).done;){var wt=st.value;(vs||F in wt)&&(As?ws.has(wt)||(ws.add(wt),vr.delete(wt),hn(wt,As)):vr.has(wt)||(vr.add(wt),ws.delete(wt),hn(wt,As)),vs||Xr(wt[F]($r),$r,ws,vr,As,H))}}catch(en){Ge.e(en)}finally{Ge.f()}},nr=new Oi(function(Xr){if(Yn.length){var Fr=Yn.join(","),$r=new Set,ws=new Set,vr=B(Xr),As;try{for(vr.s();!(As=vr.n()).done;){var vs=As.value,Ge=vs.addedNodes,st=vs.removedNodes;Gi(st,Fr,$r,ws,C,C),Gi(Ge,Fr,$r,ws,H,C)}}catch(wt){vr.e(wt)}finally{vr.f()}}}),cr=nr.observe;return(nr.observe=function(Xr){return cr.call(nr,Xr,{subtree:H,childList:H})})(On),nr},M="querySelectorAll",b=self,S=b.document,I=b.Element,O=b.MutationObserver,_=b.Set,D=b.WeakMap,V=function(hn){return M in hn},J=[].filter,Y=function(ti){var hn=new D,On=function(vr){for(var As=0,vs=vr.length;As<vs;As++)hn.delete(vr[As])},Oi=function(){for(var vr=Fr.takeRecords(),As=0,vs=vr.length;As<vs;As++)nr(J.call(vr[As].removedNodes,V),!1),nr(J.call(vr[As].addedNodes,V),!0)},Yn=function(vr){return vr.matches||vr.webkitMatchesSelector||vr.msMatchesSelector},Gi=function(vr,As){var vs;if(As)for(var Ge,st=Yn(vr),wt=0,en=cr.length;wt<en;wt++)st.call(vr,Ge=cr[wt])&&(hn.has(vr)||hn.set(vr,new _),vs=hn.get(vr),vs.has(Ge)||(vs.add(Ge),ti.handle(vr,As,Ge)));else hn.has(vr)&&(vs=hn.get(vr),hn.delete(vr),vs.forEach(function(Xt){ti.handle(vr,As,Xt)}))},nr=function(vr){for(var As=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,vs=0,Ge=vr.length;vs<Ge;vs++)Gi(vr[vs],As)},cr=ti.query,Xr=ti.root||S,Fr=L(Gi,Xr,O,cr),$r=I.prototype.attachShadow;return $r&&(I.prototype.attachShadow=function(ws){var vr=$r.call(this,ws);return Fr.observe(vr),vr}),cr.length&&nr(Xr[M](cr)),{drop:On,flush:Oi,observer:Fr,parse:nr}},W=self,U=W.document,q=W.Map,oe=W.MutationObserver,ve=W.Object,Ae=W.Set,Se=W.WeakMap,Ie=W.Element,de=W.HTMLElement,pe=W.Node,we=W.Error,he=W.TypeError,Pe=W.Reflect,Ve=ve.defineProperty,ze=ve.keys,et=ve.getOwnPropertyNames,Tt=ve.setPrototypeOf,Rt=!self.customElements,fn=function(hn){for(var On=ze(hn),Oi=[],Yn=On.length,Gi=0;Gi<Yn;Gi++)Oi[Gi]=hn[On[Gi]],delete hn[On[Gi]];return function(){for(var nr=0;nr<Yn;nr++)hn[On[nr]]=Oi[nr]}};if(Rt){var cn=function(){var hn=this.constructor;if(!yn.has(hn))throw new he("Illegal constructor");var On=yn.get(hn);if(Ye)return Pn(Ye,On);var Oi=Jn.call(U,On);return Pn(Tt(Oi,hn.prototype),On)},Jn=U.createElement,yn=new q,Wn=new q,gi=new q,ai=new q,nt=[],dt=function(hn,On,Oi){var Yn=gi.get(Oi);if(On&&!Yn.isPrototypeOf(hn)){var Gi=fn(hn);Ye=Tt(hn,Yn);try{new Yn.constructor}finally{Ye=null,Gi()}}var nr="".concat(On?"":"dis","connectedCallback");nr in Yn&&hn[nr]()},Ot=Y({query:nt,handle:dt}),$t=Ot.parse,Ye=null,mn=function(hn){if(!Wn.has(hn)){var On,Oi=new Promise(function(Yn){On=Yn});Wn.set(hn,{$:Oi,_:On})}return Wn.get(hn).$},Pn=Z(mn,oe);Ve(self,"customElements",{configurable:!0,value:{define:function(hn,On){if(ai.has(hn))throw new we('the name "'.concat(hn,'" has already been used with this registry'));yn.set(On,hn),gi.set(hn,On.prototype),ai.set(hn,On),nt.push(hn),mn(hn).then(function(){$t(U.querySelectorAll(hn))}),Wn.get(hn)._(On)},get:function(hn){return ai.get(hn)},whenDefined:mn}}),Ve(cn.prototype=de.prototype,"constructor",{value:cn}),Ve(self,"HTMLElement",{configurable:!0,value:cn}),Ve(U,"createElement",{configurable:!0,value:function(hn,On){var Oi=On&&On.is,Yn=Oi?ai.get(Oi):ai.get(hn);return Yn?new Yn:Jn.call(U,hn)}}),"isConnected"in pe.prototype||Ve(pe.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(Rt=!self.customElements.get("extends-li"),Rt)try{var wn=function ti(){return self.Reflect.construct(HTMLLIElement,[],ti)};wn.prototype=HTMLLIElement.prototype;var Dn="extends-li";self.customElements.define("extends-li",wn,{extends:"li"}),Rt=U.createElement("li",{is:Dn}).outerHTML.indexOf(Dn)<0;var gn=self.customElements,ui=gn.get,Nt=gn.whenDefined;Ve(self.customElements,"whenDefined",{configurable:!0,value:function(hn){var On=this;return Nt.call(this,hn).then(function(Oi){return Oi||ui.call(On,hn)})}})}catch{}if(Rt){var De=function(hn){var On=Ct.get(hn);ri(On.querySelectorAll(this),hn.isConnected)},Re=self.customElements,We=U.createElement,Oe=Re.define,Qe=Re.get,Ke=Re.upgrade,vt=Pe||{construct:function(hn){return hn.call(this)}},ct=vt.construct,Ct=new Se,Yt=new Ae,me=new q,ee=new q,ae=new q,Ue=new q,ht=[],ft=[],Ft=function(hn){return Ue.get(hn)||Qe.call(Re,hn)},hi=function(hn,On,Oi){var Yn=ae.get(Oi);if(On&&!Yn.isPrototypeOf(hn)){var Gi=fn(hn);Dr=Tt(hn,Yn);try{new Yn.constructor}finally{Dr=null,Gi()}}var nr="".concat(On?"":"dis","connectedCallback");nr in Yn&&hn[nr]()},bi=Y({query:ft,handle:hi}),ri=bi.parse,Ai=Y({query:ht,handle:function(hn,On){Ct.has(hn)&&(On?Yt.add(hn):Yt.delete(hn),ft.length&&De.call(ft,hn))}}),lr=Ai.parse,_s=Ie.prototype.attachShadow;_s&&(Ie.prototype.attachShadow=function(ti){var hn=_s.call(this,ti);return Ct.set(this,hn),hn});var Fs=function(hn){if(!ee.has(hn)){var On,Oi=new Promise(function(Yn){On=Yn});ee.set(hn,{$:Oi,_:On})}return ee.get(hn).$},Vs=Z(Fs,oe),Dr=null;et(self).filter(function(ti){return/^HTML.*Element$/.test(ti)}).forEach(function(ti){var hn=self[ti];function On(){var Oi=this.constructor;if(!me.has(Oi))throw new he("Illegal constructor");var Yn=me.get(Oi),Gi=Yn.is,nr=Yn.tag;if(Gi){if(Dr)return Vs(Dr,Gi);var cr=We.call(U,nr);return cr.setAttribute("is",Gi),Vs(Tt(cr,Oi.prototype),Gi)}else return ct.call(this,hn,[],Oi)}Ve(On.prototype=hn.prototype,"constructor",{value:On}),Ve(self,ti,{value:On})}),Ve(U,"createElement",{configurable:!0,value:function(hn,On){var Oi=On&&On.is;if(Oi){var Yn=Ue.get(Oi);if(Yn&&me.get(Yn).tag===hn)return new Yn}var Gi=We.call(U,hn);return Oi&&Gi.setAttribute("is",Oi),Gi}}),Ve(Re,"get",{configurable:!0,value:Ft}),Ve(Re,"whenDefined",{configurable:!0,value:Fs}),Ve(Re,"upgrade",{configurable:!0,value:function(hn){var On=hn.getAttribute("is");if(On){var Oi=Ue.get(On);if(Oi){Vs(Tt(hn,Oi.prototype),On);return}}Ke.call(Re,hn)}}),Ve(Re,"define",{configurable:!0,value:function(hn,On,Oi){if(Ft(hn))throw new we("'".concat(hn,"' has already been defined as a custom element"));var Yn,Gi=Oi&&Oi.extends;me.set(On,Gi?{is:hn,tag:Gi}:{is:"",tag:hn}),Gi?(Yn="".concat(Gi,'[is="').concat(hn,'"]'),ae.set(Yn,On.prototype),Ue.set(hn,On),ft.push(Yn)):(Oe.apply(Re,arguments),ht.push(Yn=hn)),Fs(hn).then(function(){Gi?(ri(U.querySelectorAll(Yn)),Yt.forEach(De,[Yn])):lr(U.querySelectorAll(Yn))}),ee.get(hn)._(On)}})}})()},"./node_modules/an-array/index.js":Z=>{var te=Object.prototype.toString;Z.exports=E;function E(B){return B.BYTES_PER_ELEMENT&&te.call(B.buffer)==="[object ArrayBuffer]"||Array.isArray(B)}},"./node_modules/as-number/index.js":Z=>{Z.exports=function(E,B){return typeof E=="number"?E:typeof B=="number"?B:0}},"./node_modules/base64-js/index.js":(Z,te)=>{te.byteLength=b,te.toByteArray=I,te.fromByteArray=D;for(var E=[],B=[],H=typeof Uint8Array<"u"?Uint8Array:Array,C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=0,L=C.length;F<L;++F)E[F]=C[F],B[C.charCodeAt(F)]=F;B["-".charCodeAt(0)]=62,B["_".charCodeAt(0)]=63;function M(V){var J=V.length;if(J%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Y=V.indexOf("=");Y===-1&&(Y=J);var W=Y===J?0:4-Y%4;return[Y,W]}function b(V){var J=M(V),Y=J[0],W=J[1];return(Y+W)*3/4-W}function S(V,J,Y){return(J+Y)*3/4-Y}function I(V){var J,Y=M(V),W=Y[0],U=Y[1],q=new H(S(V,W,U)),oe=0,ve=U>0?W-4:W,Ae;for(Ae=0;Ae<ve;Ae+=4)J=B[V.charCodeAt(Ae)]<<18|B[V.charCodeAt(Ae+1)]<<12|B[V.charCodeAt(Ae+2)]<<6|B[V.charCodeAt(Ae+3)],q[oe++]=J>>16&255,q[oe++]=J>>8&255,q[oe++]=J&255;return U===2&&(J=B[V.charCodeAt(Ae)]<<2|B[V.charCodeAt(Ae+1)]>>4,q[oe++]=J&255),U===1&&(J=B[V.charCodeAt(Ae)]<<10|B[V.charCodeAt(Ae+1)]<<4|B[V.charCodeAt(Ae+2)]>>2,q[oe++]=J>>8&255,q[oe++]=J&255),q}function O(V){return E[V>>18&63]+E[V>>12&63]+E[V>>6&63]+E[V&63]}function _(V,J,Y){for(var W,U=[],q=J;q<Y;q+=3)W=(V[q]<<16&16711680)+(V[q+1]<<8&65280)+(V[q+2]&255),U.push(O(W));return U.join("")}function D(V){for(var J,Y=V.length,W=Y%3,U=[],q=16383,oe=0,ve=Y-W;oe<ve;oe+=q)U.push(_(V,oe,oe+q>ve?ve:oe+q));return W===1?(J=V[Y-1],U.push(E[J>>2]+E[J<<4&63]+"==")):W===2&&(J=(V[Y-2]<<8)+V[Y-1],U.push(E[J>>10]+E[J>>4&63]+E[J<<2&63]+"=")),U.join("")}},"./node_modules/buffer-equal/index.js":(Z,te,E)=>{var B=E("./node_modules/buffer/index.js").Buffer;Z.exports=function(H,C){if(B.isBuffer(H)&&B.isBuffer(C)){if(typeof H.equals=="function")return H.equals(C);if(H.length!==C.length)return!1;for(var F=0;F<H.length;F++)if(H[F]!==C[F])return!1;return!0}}},"./node_modules/buffer/index.js":(Z,te,E)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const B=E("./node_modules/base64-js/index.js"),H=E("./node_modules/ieee754/index.js"),C=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;te.Buffer=b,te.SlowBuffer=q,te.INSPECT_MAX_BYTES=50;const F=2147483647;te.kMaxLength=F,b.TYPED_ARRAY_SUPPORT=L(),!b.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function L(){try{const me=new Uint8Array(1),ee={foo:function(){return 42}};return Object.setPrototypeOf(ee,Uint8Array.prototype),Object.setPrototypeOf(me,ee),me.foo()===42}catch{return!1}}Object.defineProperty(b.prototype,"parent",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.buffer}}),Object.defineProperty(b.prototype,"offset",{enumerable:!0,get:function(){if(b.isBuffer(this))return this.byteOffset}});function M(me){if(me>F)throw new RangeError('The value "'+me+'" is invalid for option "size"');const ee=new Uint8Array(me);return Object.setPrototypeOf(ee,b.prototype),ee}function b(me,ee,ae){if(typeof me=="number"){if(typeof ee=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(me)}return S(me,ee,ae)}b.poolSize=8192;function S(me,ee,ae){if(typeof me=="string")return D(me,ee);if(ArrayBuffer.isView(me))return J(me);if(me==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof me);if(Ke(me,ArrayBuffer)||me&&Ke(me.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ke(me,SharedArrayBuffer)||me&&Ke(me.buffer,SharedArrayBuffer)))return Y(me,ee,ae);if(typeof me=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Ue=me.valueOf&&me.valueOf();if(Ue!=null&&Ue!==me)return b.from(Ue,ee,ae);const ht=W(me);if(ht)return ht;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof me[Symbol.toPrimitive]=="function")return b.from(me[Symbol.toPrimitive]("string"),ee,ae);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof me)}b.from=function(me,ee,ae){return S(me,ee,ae)},Object.setPrototypeOf(b.prototype,Uint8Array.prototype),Object.setPrototypeOf(b,Uint8Array);function I(me){if(typeof me!="number")throw new TypeError('"size" argument must be of type number');if(me<0)throw new RangeError('The value "'+me+'" is invalid for option "size"')}function O(me,ee,ae){return I(me),me<=0?M(me):ee!==void 0?typeof ae=="string"?M(me).fill(ee,ae):M(me).fill(ee):M(me)}b.alloc=function(me,ee,ae){return O(me,ee,ae)};function _(me){return I(me),M(me<0?0:U(me)|0)}b.allocUnsafe=function(me){return _(me)},b.allocUnsafeSlow=function(me){return _(me)};function D(me,ee){if((typeof ee!="string"||ee==="")&&(ee="utf8"),!b.isEncoding(ee))throw new TypeError("Unknown encoding: "+ee);const ae=oe(me,ee)|0;let Ue=M(ae);const ht=Ue.write(me,ee);return ht!==ae&&(Ue=Ue.slice(0,ht)),Ue}function V(me){const ee=me.length<0?0:U(me.length)|0,ae=M(ee);for(let Ue=0;Ue<ee;Ue+=1)ae[Ue]=me[Ue]&255;return ae}function J(me){if(Ke(me,Uint8Array)){const ee=new Uint8Array(me);return Y(ee.buffer,ee.byteOffset,ee.byteLength)}return V(me)}function Y(me,ee,ae){if(ee<0||me.byteLength<ee)throw new RangeError('"offset" is outside of buffer bounds');if(me.byteLength<ee+(ae||0))throw new RangeError('"length" is outside of buffer bounds');let Ue;return ee===void 0&&ae===void 0?Ue=new Uint8Array(me):ae===void 0?Ue=new Uint8Array(me,ee):Ue=new Uint8Array(me,ee,ae),Object.setPrototypeOf(Ue,b.prototype),Ue}function W(me){if(b.isBuffer(me)){const ee=U(me.length)|0,ae=M(ee);return ae.length===0||me.copy(ae,0,0,ee),ae}if(me.length!==void 0)return typeof me.length!="number"||vt(me.length)?M(0):V(me);if(me.type==="Buffer"&&Array.isArray(me.data))return V(me.data)}function U(me){if(me>=F)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+F.toString(16)+" bytes");return me|0}function q(me){return+me!=me&&(me=0),b.alloc(+me)}b.isBuffer=function(ee){return ee!=null&&ee._isBuffer===!0&&ee!==b.prototype},b.compare=function(ee,ae){if(Ke(ee,Uint8Array)&&(ee=b.from(ee,ee.offset,ee.byteLength)),Ke(ae,Uint8Array)&&(ae=b.from(ae,ae.offset,ae.byteLength)),!b.isBuffer(ee)||!b.isBuffer(ae))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ee===ae)return 0;let Ue=ee.length,ht=ae.length;for(let ft=0,Ft=Math.min(Ue,ht);ft<Ft;++ft)if(ee[ft]!==ae[ft]){Ue=ee[ft],ht=ae[ft];break}return Ue<ht?-1:ht<Ue?1:0},b.isEncoding=function(ee){switch(String(ee).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.concat=function(ee,ae){if(!Array.isArray(ee))throw new TypeError('"list" argument must be an Array of Buffers');if(ee.length===0)return b.alloc(0);let Ue;if(ae===void 0)for(ae=0,Ue=0;Ue<ee.length;++Ue)ae+=ee[Ue].length;const ht=b.allocUnsafe(ae);let ft=0;for(Ue=0;Ue<ee.length;++Ue){let Ft=ee[Ue];if(Ke(Ft,Uint8Array))ft+Ft.length>ht.length?(b.isBuffer(Ft)||(Ft=b.from(Ft)),Ft.copy(ht,ft)):Uint8Array.prototype.set.call(ht,Ft,ft);else if(b.isBuffer(Ft))Ft.copy(ht,ft);else throw new TypeError('"list" argument must be an Array of Buffers');ft+=Ft.length}return ht};function oe(me,ee){if(b.isBuffer(me))return me.length;if(ArrayBuffer.isView(me)||Ke(me,ArrayBuffer))return me.byteLength;if(typeof me!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof me);const ae=me.length,Ue=arguments.length>2&&arguments[2]===!0;if(!Ue&&ae===0)return 0;let ht=!1;for(;;)switch(ee){case"ascii":case"latin1":case"binary":return ae;case"utf8":case"utf-8":return De(me).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ae*2;case"hex":return ae>>>1;case"base64":return Oe(me).length;default:if(ht)return Ue?-1:De(me).length;ee=(""+ee).toLowerCase(),ht=!0}}b.byteLength=oe;function ve(me,ee,ae){let Ue=!1;if((ee===void 0||ee<0)&&(ee=0),ee>this.length||((ae===void 0||ae>this.length)&&(ae=this.length),ae<=0)||(ae>>>=0,ee>>>=0,ae<=ee))return"";for(me||(me="utf8");;)switch(me){case"hex":return cn(this,ee,ae);case"utf8":case"utf-8":return ze(this,ee,ae);case"ascii":return Rt(this,ee,ae);case"latin1":case"binary":return fn(this,ee,ae);case"base64":return Ve(this,ee,ae);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Jn(this,ee,ae);default:if(Ue)throw new TypeError("Unknown encoding: "+me);me=(me+"").toLowerCase(),Ue=!0}}b.prototype._isBuffer=!0;function Ae(me,ee,ae){const Ue=me[ee];me[ee]=me[ae],me[ae]=Ue}b.prototype.swap16=function(){const ee=this.length;if(ee%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let ae=0;ae<ee;ae+=2)Ae(this,ae,ae+1);return this},b.prototype.swap32=function(){const ee=this.length;if(ee%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let ae=0;ae<ee;ae+=4)Ae(this,ae,ae+3),Ae(this,ae+1,ae+2);return this},b.prototype.swap64=function(){const ee=this.length;if(ee%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let ae=0;ae<ee;ae+=8)Ae(this,ae,ae+7),Ae(this,ae+1,ae+6),Ae(this,ae+2,ae+5),Ae(this,ae+3,ae+4);return this},b.prototype.toString=function(){const ee=this.length;return ee===0?"":arguments.length===0?ze(this,0,ee):ve.apply(this,arguments)},b.prototype.toLocaleString=b.prototype.toString,b.prototype.equals=function(ee){if(!b.isBuffer(ee))throw new TypeError("Argument must be a Buffer");return this===ee?!0:b.compare(this,ee)===0},b.prototype.inspect=function(){let ee="";const ae=te.INSPECT_MAX_BYTES;return ee=this.toString("hex",0,ae).replace(/(.{2})/g,"$1 ").trim(),this.length>ae&&(ee+=" ... "),"<Buffer "+ee+">"},C&&(b.prototype[C]=b.prototype.inspect),b.prototype.compare=function(ee,ae,Ue,ht,ft){if(Ke(ee,Uint8Array)&&(ee=b.from(ee,ee.offset,ee.byteLength)),!b.isBuffer(ee))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ee);if(ae===void 0&&(ae=0),Ue===void 0&&(Ue=ee?ee.length:0),ht===void 0&&(ht=0),ft===void 0&&(ft=this.length),ae<0||Ue>ee.length||ht<0||ft>this.length)throw new RangeError("out of range index");if(ht>=ft&&ae>=Ue)return 0;if(ht>=ft)return-1;if(ae>=Ue)return 1;if(ae>>>=0,Ue>>>=0,ht>>>=0,ft>>>=0,this===ee)return 0;let Ft=ft-ht,hi=Ue-ae;const bi=Math.min(Ft,hi),ri=this.slice(ht,ft),Ai=ee.slice(ae,Ue);for(let lr=0;lr<bi;++lr)if(ri[lr]!==Ai[lr]){Ft=ri[lr],hi=Ai[lr];break}return Ft<hi?-1:hi<Ft?1:0};function Se(me,ee,ae,Ue,ht){if(me.length===0)return-1;if(typeof ae=="string"?(Ue=ae,ae=0):ae>2147483647?ae=2147483647:ae<-2147483648&&(ae=-2147483648),ae=+ae,vt(ae)&&(ae=ht?0:me.length-1),ae<0&&(ae=me.length+ae),ae>=me.length){if(ht)return-1;ae=me.length-1}else if(ae<0)if(ht)ae=0;else return-1;if(typeof ee=="string"&&(ee=b.from(ee,Ue)),b.isBuffer(ee))return ee.length===0?-1:Ie(me,ee,ae,Ue,ht);if(typeof ee=="number")return ee=ee&255,typeof Uint8Array.prototype.indexOf=="function"?ht?Uint8Array.prototype.indexOf.call(me,ee,ae):Uint8Array.prototype.lastIndexOf.call(me,ee,ae):Ie(me,[ee],ae,Ue,ht);throw new TypeError("val must be string, number or Buffer")}function Ie(me,ee,ae,Ue,ht){let ft=1,Ft=me.length,hi=ee.length;if(Ue!==void 0&&(Ue=String(Ue).toLowerCase(),Ue==="ucs2"||Ue==="ucs-2"||Ue==="utf16le"||Ue==="utf-16le")){if(me.length<2||ee.length<2)return-1;ft=2,Ft/=2,hi/=2,ae/=2}function bi(Ai,lr){return ft===1?Ai[lr]:Ai.readUInt16BE(lr*ft)}let ri;if(ht){let Ai=-1;for(ri=ae;ri<Ft;ri++)if(bi(me,ri)===bi(ee,Ai===-1?0:ri-Ai)){if(Ai===-1&&(Ai=ri),ri-Ai+1===hi)return Ai*ft}else Ai!==-1&&(ri-=ri-Ai),Ai=-1}else for(ae+hi>Ft&&(ae=Ft-hi),ri=ae;ri>=0;ri--){let Ai=!0;for(let lr=0;lr<hi;lr++)if(bi(me,ri+lr)!==bi(ee,lr)){Ai=!1;break}if(Ai)return ri}return-1}b.prototype.includes=function(ee,ae,Ue){return this.indexOf(ee,ae,Ue)!==-1},b.prototype.indexOf=function(ee,ae,Ue){return Se(this,ee,ae,Ue,!0)},b.prototype.lastIndexOf=function(ee,ae,Ue){return Se(this,ee,ae,Ue,!1)};function de(me,ee,ae,Ue){ae=Number(ae)||0;const ht=me.length-ae;Ue?(Ue=Number(Ue),Ue>ht&&(Ue=ht)):Ue=ht;const ft=ee.length;Ue>ft/2&&(Ue=ft/2);let Ft;for(Ft=0;Ft<Ue;++Ft){const hi=parseInt(ee.substr(Ft*2,2),16);if(vt(hi))return Ft;me[ae+Ft]=hi}return Ft}function pe(me,ee,ae,Ue){return Qe(De(ee,me.length-ae),me,ae,Ue)}function we(me,ee,ae,Ue){return Qe(Re(ee),me,ae,Ue)}function he(me,ee,ae,Ue){return Qe(Oe(ee),me,ae,Ue)}function Pe(me,ee,ae,Ue){return Qe(We(ee,me.length-ae),me,ae,Ue)}b.prototype.write=function(ee,ae,Ue,ht){if(ae===void 0)ht="utf8",Ue=this.length,ae=0;else if(Ue===void 0&&typeof ae=="string")ht=ae,Ue=this.length,ae=0;else if(isFinite(ae))ae=ae>>>0,isFinite(Ue)?(Ue=Ue>>>0,ht===void 0&&(ht="utf8")):(ht=Ue,Ue=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ft=this.length-ae;if((Ue===void 0||Ue>ft)&&(Ue=ft),ee.length>0&&(Ue<0||ae<0)||ae>this.length)throw new RangeError("Attempt to write outside buffer bounds");ht||(ht="utf8");let Ft=!1;for(;;)switch(ht){case"hex":return de(this,ee,ae,Ue);case"utf8":case"utf-8":return pe(this,ee,ae,Ue);case"ascii":case"latin1":case"binary":return we(this,ee,ae,Ue);case"base64":return he(this,ee,ae,Ue);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pe(this,ee,ae,Ue);default:if(Ft)throw new TypeError("Unknown encoding: "+ht);ht=(""+ht).toLowerCase(),Ft=!0}},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ve(me,ee,ae){return ee===0&&ae===me.length?B.fromByteArray(me):B.fromByteArray(me.slice(ee,ae))}function ze(me,ee,ae){ae=Math.min(me.length,ae);const Ue=[];let ht=ee;for(;ht<ae;){const ft=me[ht];let Ft=null,hi=ft>239?4:ft>223?3:ft>191?2:1;if(ht+hi<=ae){let bi,ri,Ai,lr;switch(hi){case 1:ft<128&&(Ft=ft);break;case 2:bi=me[ht+1],(bi&192)===128&&(lr=(ft&31)<<6|bi&63,lr>127&&(Ft=lr));break;case 3:bi=me[ht+1],ri=me[ht+2],(bi&192)===128&&(ri&192)===128&&(lr=(ft&15)<<12|(bi&63)<<6|ri&63,lr>2047&&(lr<55296||lr>57343)&&(Ft=lr));break;case 4:bi=me[ht+1],ri=me[ht+2],Ai=me[ht+3],(bi&192)===128&&(ri&192)===128&&(Ai&192)===128&&(lr=(ft&15)<<18|(bi&63)<<12|(ri&63)<<6|Ai&63,lr>65535&&lr<1114112&&(Ft=lr))}}Ft===null?(Ft=65533,hi=1):Ft>65535&&(Ft-=65536,Ue.push(Ft>>>10&1023|55296),Ft=56320|Ft&1023),Ue.push(Ft),ht+=hi}return Tt(Ue)}const et=4096;function Tt(me){const ee=me.length;if(ee<=et)return String.fromCharCode.apply(String,me);let ae="",Ue=0;for(;Ue<ee;)ae+=String.fromCharCode.apply(String,me.slice(Ue,Ue+=et));return ae}function Rt(me,ee,ae){let Ue="";ae=Math.min(me.length,ae);for(let ht=ee;ht<ae;++ht)Ue+=String.fromCharCode(me[ht]&127);return Ue}function fn(me,ee,ae){let Ue="";ae=Math.min(me.length,ae);for(let ht=ee;ht<ae;++ht)Ue+=String.fromCharCode(me[ht]);return Ue}function cn(me,ee,ae){const Ue=me.length;(!ee||ee<0)&&(ee=0),(!ae||ae<0||ae>Ue)&&(ae=Ue);let ht="";for(let ft=ee;ft<ae;++ft)ht+=ct[me[ft]];return ht}function Jn(me,ee,ae){const Ue=me.slice(ee,ae);let ht="";for(let ft=0;ft<Ue.length-1;ft+=2)ht+=String.fromCharCode(Ue[ft]+Ue[ft+1]*256);return ht}b.prototype.slice=function(ee,ae){const Ue=this.length;ee=~~ee,ae=ae===void 0?Ue:~~ae,ee<0?(ee+=Ue,ee<0&&(ee=0)):ee>Ue&&(ee=Ue),ae<0?(ae+=Ue,ae<0&&(ae=0)):ae>Ue&&(ae=Ue),ae<ee&&(ae=ee);const ht=this.subarray(ee,ae);return Object.setPrototypeOf(ht,b.prototype),ht};function yn(me,ee,ae){if(me%1!==0||me<0)throw new RangeError("offset is not uint");if(me+ee>ae)throw new RangeError("Trying to access beyond buffer length")}b.prototype.readUintLE=b.prototype.readUIntLE=function(ee,ae,Ue){ee=ee>>>0,ae=ae>>>0,Ue||yn(ee,ae,this.length);let ht=this[ee],ft=1,Ft=0;for(;++Ft<ae&&(ft*=256);)ht+=this[ee+Ft]*ft;return ht},b.prototype.readUintBE=b.prototype.readUIntBE=function(ee,ae,Ue){ee=ee>>>0,ae=ae>>>0,Ue||yn(ee,ae,this.length);let ht=this[ee+--ae],ft=1;for(;ae>0&&(ft*=256);)ht+=this[ee+--ae]*ft;return ht},b.prototype.readUint8=b.prototype.readUInt8=function(ee,ae){return ee=ee>>>0,ae||yn(ee,1,this.length),this[ee]},b.prototype.readUint16LE=b.prototype.readUInt16LE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,2,this.length),this[ee]|this[ee+1]<<8},b.prototype.readUint16BE=b.prototype.readUInt16BE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,2,this.length),this[ee]<<8|this[ee+1]},b.prototype.readUint32LE=b.prototype.readUInt32LE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),(this[ee]|this[ee+1]<<8|this[ee+2]<<16)+this[ee+3]*16777216},b.prototype.readUint32BE=b.prototype.readUInt32BE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),this[ee]*16777216+(this[ee+1]<<16|this[ee+2]<<8|this[ee+3])},b.prototype.readBigUInt64LE=Ct(function(ee){ee=ee>>>0,Dn(ee,"offset");const ae=this[ee],Ue=this[ee+7];(ae===void 0||Ue===void 0)&&gn(ee,this.length-8);const ht=ae+this[++ee]*2**8+this[++ee]*2**16+this[++ee]*2**24,ft=this[++ee]+this[++ee]*2**8+this[++ee]*2**16+Ue*2**24;return BigInt(ht)+(BigInt(ft)<<BigInt(32))}),b.prototype.readBigUInt64BE=Ct(function(ee){ee=ee>>>0,Dn(ee,"offset");const ae=this[ee],Ue=this[ee+7];(ae===void 0||Ue===void 0)&&gn(ee,this.length-8);const ht=ae*2**24+this[++ee]*2**16+this[++ee]*2**8+this[++ee],ft=this[++ee]*2**24+this[++ee]*2**16+this[++ee]*2**8+Ue;return(BigInt(ht)<<BigInt(32))+BigInt(ft)}),b.prototype.readIntLE=function(ee,ae,Ue){ee=ee>>>0,ae=ae>>>0,Ue||yn(ee,ae,this.length);let ht=this[ee],ft=1,Ft=0;for(;++Ft<ae&&(ft*=256);)ht+=this[ee+Ft]*ft;return ft*=128,ht>=ft&&(ht-=Math.pow(2,8*ae)),ht},b.prototype.readIntBE=function(ee,ae,Ue){ee=ee>>>0,ae=ae>>>0,Ue||yn(ee,ae,this.length);let ht=ae,ft=1,Ft=this[ee+--ht];for(;ht>0&&(ft*=256);)Ft+=this[ee+--ht]*ft;return ft*=128,Ft>=ft&&(Ft-=Math.pow(2,8*ae)),Ft},b.prototype.readInt8=function(ee,ae){return ee=ee>>>0,ae||yn(ee,1,this.length),this[ee]&128?(255-this[ee]+1)*-1:this[ee]},b.prototype.readInt16LE=function(ee,ae){ee=ee>>>0,ae||yn(ee,2,this.length);const Ue=this[ee]|this[ee+1]<<8;return Ue&32768?Ue|4294901760:Ue},b.prototype.readInt16BE=function(ee,ae){ee=ee>>>0,ae||yn(ee,2,this.length);const Ue=this[ee+1]|this[ee]<<8;return Ue&32768?Ue|4294901760:Ue},b.prototype.readInt32LE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),this[ee]|this[ee+1]<<8|this[ee+2]<<16|this[ee+3]<<24},b.prototype.readInt32BE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),this[ee]<<24|this[ee+1]<<16|this[ee+2]<<8|this[ee+3]},b.prototype.readBigInt64LE=Ct(function(ee){ee=ee>>>0,Dn(ee,"offset");const ae=this[ee],Ue=this[ee+7];(ae===void 0||Ue===void 0)&&gn(ee,this.length-8);const ht=this[ee+4]+this[ee+5]*2**8+this[ee+6]*2**16+(Ue<<24);return(BigInt(ht)<<BigInt(32))+BigInt(ae+this[++ee]*256+this[++ee]*65536+this[++ee]*16777216)}),b.prototype.readBigInt64BE=Ct(function(ee){ee=ee>>>0,Dn(ee,"offset");const ae=this[ee],Ue=this[ee+7];(ae===void 0||Ue===void 0)&&gn(ee,this.length-8);const ht=(ae<<24)+this[++ee]*2**16+this[++ee]*2**8+this[++ee];return(BigInt(ht)<<BigInt(32))+BigInt(this[++ee]*16777216+this[++ee]*65536+this[++ee]*256+Ue)}),b.prototype.readFloatLE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),H.read(this,ee,!0,23,4)},b.prototype.readFloatBE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,4,this.length),H.read(this,ee,!1,23,4)},b.prototype.readDoubleLE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,8,this.length),H.read(this,ee,!0,52,8)},b.prototype.readDoubleBE=function(ee,ae){return ee=ee>>>0,ae||yn(ee,8,this.length),H.read(this,ee,!1,52,8)};function Wn(me,ee,ae,Ue,ht,ft){if(!b.isBuffer(me))throw new TypeError('"buffer" argument must be a Buffer instance');if(ee>ht||ee<ft)throw new RangeError('"value" argument is out of bounds');if(ae+Ue>me.length)throw new RangeError("Index out of range")}b.prototype.writeUintLE=b.prototype.writeUIntLE=function(ee,ae,Ue,ht){if(ee=+ee,ae=ae>>>0,Ue=Ue>>>0,!ht){const hi=Math.pow(2,8*Ue)-1;Wn(this,ee,ae,Ue,hi,0)}let ft=1,Ft=0;for(this[ae]=ee&255;++Ft<Ue&&(ft*=256);)this[ae+Ft]=ee/ft&255;return ae+Ue},b.prototype.writeUintBE=b.prototype.writeUIntBE=function(ee,ae,Ue,ht){if(ee=+ee,ae=ae>>>0,Ue=Ue>>>0,!ht){const hi=Math.pow(2,8*Ue)-1;Wn(this,ee,ae,Ue,hi,0)}let ft=Ue-1,Ft=1;for(this[ae+ft]=ee&255;--ft>=0&&(Ft*=256);)this[ae+ft]=ee/Ft&255;return ae+Ue},b.prototype.writeUint8=b.prototype.writeUInt8=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,1,255,0),this[ae]=ee&255,ae+1},b.prototype.writeUint16LE=b.prototype.writeUInt16LE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,2,65535,0),this[ae]=ee&255,this[ae+1]=ee>>>8,ae+2},b.prototype.writeUint16BE=b.prototype.writeUInt16BE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,2,65535,0),this[ae]=ee>>>8,this[ae+1]=ee&255,ae+2},b.prototype.writeUint32LE=b.prototype.writeUInt32LE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,4,4294967295,0),this[ae+3]=ee>>>24,this[ae+2]=ee>>>16,this[ae+1]=ee>>>8,this[ae]=ee&255,ae+4},b.prototype.writeUint32BE=b.prototype.writeUInt32BE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,4,4294967295,0),this[ae]=ee>>>24,this[ae+1]=ee>>>16,this[ae+2]=ee>>>8,this[ae+3]=ee&255,ae+4};function gi(me,ee,ae,Ue,ht){wn(ee,Ue,ht,me,ae,7);let ft=Number(ee&BigInt(4294967295));me[ae++]=ft,ft=ft>>8,me[ae++]=ft,ft=ft>>8,me[ae++]=ft,ft=ft>>8,me[ae++]=ft;let Ft=Number(ee>>BigInt(32)&BigInt(4294967295));return me[ae++]=Ft,Ft=Ft>>8,me[ae++]=Ft,Ft=Ft>>8,me[ae++]=Ft,Ft=Ft>>8,me[ae++]=Ft,ae}function ai(me,ee,ae,Ue,ht){wn(ee,Ue,ht,me,ae,7);let ft=Number(ee&BigInt(4294967295));me[ae+7]=ft,ft=ft>>8,me[ae+6]=ft,ft=ft>>8,me[ae+5]=ft,ft=ft>>8,me[ae+4]=ft;let Ft=Number(ee>>BigInt(32)&BigInt(4294967295));return me[ae+3]=Ft,Ft=Ft>>8,me[ae+2]=Ft,Ft=Ft>>8,me[ae+1]=Ft,Ft=Ft>>8,me[ae]=Ft,ae+8}b.prototype.writeBigUInt64LE=Ct(function(ee,ae=0){return gi(this,ee,ae,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeBigUInt64BE=Ct(function(ee,ae=0){return ai(this,ee,ae,BigInt(0),BigInt("0xffffffffffffffff"))}),b.prototype.writeIntLE=function(ee,ae,Ue,ht){if(ee=+ee,ae=ae>>>0,!ht){const bi=Math.pow(2,8*Ue-1);Wn(this,ee,ae,Ue,bi-1,-bi)}let ft=0,Ft=1,hi=0;for(this[ae]=ee&255;++ft<Ue&&(Ft*=256);)ee<0&&hi===0&&this[ae+ft-1]!==0&&(hi=1),this[ae+ft]=(ee/Ft>>0)-hi&255;return ae+Ue},b.prototype.writeIntBE=function(ee,ae,Ue,ht){if(ee=+ee,ae=ae>>>0,!ht){const bi=Math.pow(2,8*Ue-1);Wn(this,ee,ae,Ue,bi-1,-bi)}let ft=Ue-1,Ft=1,hi=0;for(this[ae+ft]=ee&255;--ft>=0&&(Ft*=256);)ee<0&&hi===0&&this[ae+ft+1]!==0&&(hi=1),this[ae+ft]=(ee/Ft>>0)-hi&255;return ae+Ue},b.prototype.writeInt8=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,1,127,-128),ee<0&&(ee=255+ee+1),this[ae]=ee&255,ae+1},b.prototype.writeInt16LE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,2,32767,-32768),this[ae]=ee&255,this[ae+1]=ee>>>8,ae+2},b.prototype.writeInt16BE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,2,32767,-32768),this[ae]=ee>>>8,this[ae+1]=ee&255,ae+2},b.prototype.writeInt32LE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,4,2147483647,-2147483648),this[ae]=ee&255,this[ae+1]=ee>>>8,this[ae+2]=ee>>>16,this[ae+3]=ee>>>24,ae+4},b.prototype.writeInt32BE=function(ee,ae,Ue){return ee=+ee,ae=ae>>>0,Ue||Wn(this,ee,ae,4,2147483647,-2147483648),ee<0&&(ee=4294967295+ee+1),this[ae]=ee>>>24,this[ae+1]=ee>>>16,this[ae+2]=ee>>>8,this[ae+3]=ee&255,ae+4},b.prototype.writeBigInt64LE=Ct(function(ee,ae=0){return gi(this,ee,ae,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),b.prototype.writeBigInt64BE=Ct(function(ee,ae=0){return ai(this,ee,ae,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function nt(me,ee,ae,Ue,ht,ft){if(ae+Ue>me.length)throw new RangeError("Index out of range");if(ae<0)throw new RangeError("Index out of range")}function dt(me,ee,ae,Ue,ht){return ee=+ee,ae=ae>>>0,ht||nt(me,ee,ae,4),H.write(me,ee,ae,Ue,23,4),ae+4}b.prototype.writeFloatLE=function(ee,ae,Ue){return dt(this,ee,ae,!0,Ue)},b.prototype.writeFloatBE=function(ee,ae,Ue){return dt(this,ee,ae,!1,Ue)};function Ot(me,ee,ae,Ue,ht){return ee=+ee,ae=ae>>>0,ht||nt(me,ee,ae,8),H.write(me,ee,ae,Ue,52,8),ae+8}b.prototype.writeDoubleLE=function(ee,ae,Ue){return Ot(this,ee,ae,!0,Ue)},b.prototype.writeDoubleBE=function(ee,ae,Ue){return Ot(this,ee,ae,!1,Ue)},b.prototype.copy=function(ee,ae,Ue,ht){if(!b.isBuffer(ee))throw new TypeError("argument should be a Buffer");if(Ue||(Ue=0),!ht&&ht!==0&&(ht=this.length),ae>=ee.length&&(ae=ee.length),ae||(ae=0),ht>0&&ht<Ue&&(ht=Ue),ht===Ue||ee.length===0||this.length===0)return 0;if(ae<0)throw new RangeError("targetStart out of bounds");if(Ue<0||Ue>=this.length)throw new RangeError("Index out of range");if(ht<0)throw new RangeError("sourceEnd out of bounds");ht>this.length&&(ht=this.length),ee.length-ae<ht-Ue&&(ht=ee.length-ae+Ue);const ft=ht-Ue;return this===ee&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(ae,Ue,ht):Uint8Array.prototype.set.call(ee,this.subarray(Ue,ht),ae),ft},b.prototype.fill=function(ee,ae,Ue,ht){if(typeof ee=="string"){if(typeof ae=="string"?(ht=ae,ae=0,Ue=this.length):typeof Ue=="string"&&(ht=Ue,Ue=this.length),ht!==void 0&&typeof ht!="string")throw new TypeError("encoding must be a string");if(typeof ht=="string"&&!b.isEncoding(ht))throw new TypeError("Unknown encoding: "+ht);if(ee.length===1){const Ft=ee.charCodeAt(0);(ht==="utf8"&&Ft<128||ht==="latin1")&&(ee=Ft)}}else typeof ee=="number"?ee=ee&255:typeof ee=="boolean"&&(ee=Number(ee));if(ae<0||this.length<ae||this.length<Ue)throw new RangeError("Out of range index");if(Ue<=ae)return this;ae=ae>>>0,Ue=Ue===void 0?this.length:Ue>>>0,ee||(ee=0);let ft;if(typeof ee=="number")for(ft=ae;ft<Ue;++ft)this[ft]=ee;else{const Ft=b.isBuffer(ee)?ee:b.from(ee,ht),hi=Ft.length;if(hi===0)throw new TypeError('The value "'+ee+'" is invalid for argument "value"');for(ft=0;ft<Ue-ae;++ft)this[ft+ae]=Ft[ft%hi]}return this};const $t={};function Ye(me,ee,ae){$t[me]=class extends ae{constructor(){super(),Object.defineProperty(this,"message",{value:ee.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${me}]`,this.stack,delete this.name}get code(){return me}set code(ht){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ht,writable:!0})}toString(){return`${this.name} [${me}]: ${this.message}`}}}Ye("ERR_BUFFER_OUT_OF_BOUNDS",function(me){return me?`${me} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ye("ERR_INVALID_ARG_TYPE",function(me,ee){return`The "${me}" argument must be of type number. Received type ${typeof ee}`},TypeError),Ye("ERR_OUT_OF_RANGE",function(me,ee,ae){let Ue=`The value of "${me}" is out of range.`,ht=ae;return Number.isInteger(ae)&&Math.abs(ae)>4294967296?ht=mn(String(ae)):typeof ae=="bigint"&&(ht=String(ae),(ae>BigInt(2)**BigInt(32)||ae<-(BigInt(2)**BigInt(32)))&&(ht=mn(ht)),ht+="n"),Ue+=` It must be ${ee}. Received ${ht}`,Ue},RangeError);function mn(me){let ee="",ae=me.length;const Ue=me[0]==="-"?1:0;for(;ae>=Ue+4;ae-=3)ee=`_${me.slice(ae-3,ae)}${ee}`;return`${me.slice(0,ae)}${ee}`}function Pn(me,ee,ae){Dn(ee,"offset"),(me[ee]===void 0||me[ee+ae]===void 0)&&gn(ee,me.length-(ae+1))}function wn(me,ee,ae,Ue,ht,ft){if(me>ae||me<ee){const Ft=typeof ee=="bigint"?"n":"";let hi;throw ft>3?ee===0||ee===BigInt(0)?hi=`>= 0${Ft} and < 2${Ft} ** ${(ft+1)*8}${Ft}`:hi=`>= -(2${Ft} ** ${(ft+1)*8-1}${Ft}) and < 2 ** ${(ft+1)*8-1}${Ft}`:hi=`>= ${ee}${Ft} and <= ${ae}${Ft}`,new $t.ERR_OUT_OF_RANGE("value",hi,me)}Pn(Ue,ht,ft)}function Dn(me,ee){if(typeof me!="number")throw new $t.ERR_INVALID_ARG_TYPE(ee,"number",me)}function gn(me,ee,ae){throw Math.floor(me)!==me?(Dn(me,ae),new $t.ERR_OUT_OF_RANGE(ae||"offset","an integer",me)):ee<0?new $t.ERR_BUFFER_OUT_OF_BOUNDS:new $t.ERR_OUT_OF_RANGE(ae||"offset",`>= ${ae?1:0} and <= ${ee}`,me)}const ui=/[^+/0-9A-Za-z-_]/g;function Nt(me){if(me=me.split("=")[0],me=me.trim().replace(ui,""),me.length<2)return"";for(;me.length%4!==0;)me=me+"=";return me}function De(me,ee){ee=ee||1/0;let ae;const Ue=me.length;let ht=null;const ft=[];for(let Ft=0;Ft<Ue;++Ft){if(ae=me.charCodeAt(Ft),ae>55295&&ae<57344){if(!ht){if(ae>56319){(ee-=3)>-1&&ft.push(239,191,189);continue}else if(Ft+1===Ue){(ee-=3)>-1&&ft.push(239,191,189);continue}ht=ae;continue}if(ae<56320){(ee-=3)>-1&&ft.push(239,191,189),ht=ae;continue}ae=(ht-55296<<10|ae-56320)+65536}else ht&&(ee-=3)>-1&&ft.push(239,191,189);if(ht=null,ae<128){if((ee-=1)<0)break;ft.push(ae)}else if(ae<2048){if((ee-=2)<0)break;ft.push(ae>>6|192,ae&63|128)}else if(ae<65536){if((ee-=3)<0)break;ft.push(ae>>12|224,ae>>6&63|128,ae&63|128)}else if(ae<1114112){if((ee-=4)<0)break;ft.push(ae>>18|240,ae>>12&63|128,ae>>6&63|128,ae&63|128)}else throw new Error("Invalid code point")}return ft}function Re(me){const ee=[];for(let ae=0;ae<me.length;++ae)ee.push(me.charCodeAt(ae)&255);return ee}function We(me,ee){let ae,Ue,ht;const ft=[];for(let Ft=0;Ft<me.length&&!((ee-=2)<0);++Ft)ae=me.charCodeAt(Ft),Ue=ae>>8,ht=ae%256,ft.push(ht),ft.push(Ue);return ft}function Oe(me){return B.toByteArray(Nt(me))}function Qe(me,ee,ae,Ue){let ht;for(ht=0;ht<Ue&&!(ht+ae>=ee.length||ht>=me.length);++ht)ee[ht+ae]=me[ht];return ht}function Ke(me,ee){return me instanceof ee||me!=null&&me.constructor!=null&&me.constructor.name!=null&&me.constructor.name===ee.name}function vt(me){return me!==me}const ct=function(){const me="0123456789abcdef",ee=new Array(256);for(let ae=0;ae<16;++ae){const Ue=ae*16;for(let ht=0;ht<16;++ht)ee[Ue+ht]=me[ae]+me[ht]}return ee}();function Ct(me){return typeof BigInt>"u"?Yt:me}function Yt(){throw new Error("BigInt not supported")}},"./node_modules/css-loader/dist/runtime/api.js":Z=>{Z.exports=function(te){var E=[];return E.toString=function(){return this.map(function(H){var C="",F=typeof H[5]<"u";return H[4]&&(C+="@supports (".concat(H[4],") {")),H[2]&&(C+="@media ".concat(H[2]," {")),F&&(C+="@layer".concat(H[5].length>0?" ".concat(H[5]):""," {")),C+=te(H),F&&(C+="}"),H[2]&&(C+="}"),H[4]&&(C+="}"),C}).join("")},E.i=function(H,C,F,L,M){typeof H=="string"&&(H=[[null,H,void 0]]);var b={};if(F)for(var S=0;S<this.length;S++){var I=this[S][0];I!=null&&(b[I]=!0)}for(var O=0;O<H.length;O++){var _=[].concat(H[O]);F&&b[_[0]]||(typeof M<"u"&&(typeof _[5]>"u"||(_[1]="@layer".concat(_[5].length>0?" ".concat(_[5]):""," {").concat(_[1],"}")),_[5]=M),C&&(_[2]&&(_[1]="@media ".concat(_[2]," {").concat(_[1],"}")),_[2]=C),L&&(_[4]?(_[1]="@supports (".concat(_[4],") {").concat(_[1],"}"),_[4]=L):_[4]="".concat(L)),E.push(_))}},E}},"./node_modules/css-loader/dist/runtime/getUrl.js":Z=>{Z.exports=function(te,E){return E||(E={}),te&&(te=String(te.__esModule?te.default:te),/^['"].*['"]$/.test(te)&&(te=te.slice(1,-1)),E.hash&&(te+=E.hash),/["'() \t\n]|(%20)/.test(te)||E.needQuotes?'"'.concat(te.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):te)}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":Z=>{Z.exports=function(te){var E=te[1],B=te[3];if(!B)return E;if(typeof btoa=="function"){var H=btoa(unescape(encodeURIComponent(JSON.stringify(B)))),C="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(H),F="/*# ".concat(C," */");return[E].concat([F]).join(`
`)}return[E].join(`
`)}},"./node_modules/custom-event-polyfill/polyfill.js":()=>{(function(){if(!(typeof window>"u"))try{var Z=new window.CustomEvent("test",{cancelable:!0});if(Z.preventDefault(),Z.defaultPrevented!==!0)throw new Error("Could not prevent default")}catch{var te=function(B,H){var C,F;return H=H||{},H.bubbles=!!H.bubbles,H.cancelable=!!H.cancelable,C=document.createEvent("CustomEvent"),C.initCustomEvent(B,H.bubbles,H.cancelable,H.detail),F=C.preventDefault,C.preventDefault=function(){F.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch{this.defaultPrevented=!0}},C};te.prototype=window.Event.prototype,window.CustomEvent=te}})()},"./node_modules/debug/browser.js":(Z,te,E)=>{te=Z.exports=E("./node_modules/debug/debug.js"),te.log=C,te.formatArgs=H,te.save=F,te.load=L,te.useColors=B,te.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:M(),te.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function B(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}te.formatters.j=function(b){return JSON.stringify(b)};function H(){var b=arguments,S=this.useColors;if(b[0]=(S?"%c":"")+this.namespace+(S?" %c":" ")+b[0]+(S?"%c ":" "),!S)return b;var I="color: "+this.color;b=[b[0],I,"color: inherit"].concat(Array.prototype.slice.call(b,1));var O=0,_=0;return b[0].replace(/%[a-z%]/g,function(D){D!=="%%"&&(O++,D==="%c"&&(_=O))}),b.splice(_,0,I),b}function C(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function F(b){try{b==null?te.storage.removeItem("debug"):te.storage.debug=b}catch{}}function L(){var b;try{b=te.storage.debug}catch{}return b}te.enable(L());function M(){try{return window.localStorage}catch{}}},"./node_modules/debug/debug.js":(Z,te)=>{te=Z.exports=H,te.coerce=M,te.disable=F,te.enable=C,te.enabled=L,te.names=[],te.skips=[],te.formatters={};var E=0;function B(){return te.colors[E++%te.colors.length]}function H(b){function S(){}S.enabled=!1;function I(){var _=I;_.useColors==null&&(_.useColors=te.useColors()),_.color==null&&_.useColors&&(_.color=B());var D=Array.prototype.slice.call(arguments);D[0]=te.coerce(D[0]),typeof D[0]!="string"&&(D=["%o"].concat(D));var V=0;D[0]=D[0].replace(/%([a-z%])/g,function(Y,W){if(Y==="%%")return Y;V++;var U=te.formatters[W];if(typeof U=="function"){var q=D[V];Y=U.call(_,q),D.splice(V,1),V--}return Y}),typeof te.formatArgs=="function"&&(D=te.formatArgs.apply(_,D));var J=I.log||te.log||console.log.bind(console);J.apply(_,D)}I.enabled=!0;var O=te.enabled(b)?I:S;return O.namespace=b,O}function C(b){te.save(b);for(var S=(b||"").split(/[\s,]+/),I=S.length,O=0;O<I;O++)S[O]&&(b=S[O].replace(/\*/g,".*?"),b[0]==="-"?te.skips.push(new RegExp("^"+b.substr(1)+"$")):te.names.push(new RegExp("^"+b+"$")))}function F(){te.enable("")}function L(b){var S,I;for(S=0,I=te.skips.length;S<I;S++)if(te.skips[S].test(b))return!1;for(S=0,I=te.names.length;S<I;S++)if(te.names[S].test(b))return!0;return!1}function M(b){return b instanceof Error?b.stack||b.message:b}},"./node_modules/deep-assign/index.js":(Z,te,E)=>{var B=E("./node_modules/is-obj/index.js"),H=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;function F(b){if(b==null)throw new TypeError("Sources cannot be null or undefined");return Object(b)}function L(b,S,I){var O=S[I];if(O!=null){if(H.call(b,I)&&(b[I]===void 0||b[I]===null))throw new TypeError("Cannot convert undefined or null to object ("+I+")");!H.call(b,I)||!B(O)?b[I]=O:b[I]=M(Object(b[I]),S[I])}}function M(b,S){if(b===S)return b;S=Object(S);for(var I in S)H.call(S,I)&&L(b,S,I);if(Object.getOwnPropertySymbols)for(var O=Object.getOwnPropertySymbols(S),_=0;_<O.length;_++)C.call(S,O[_])&&L(b,S,O[_]);return b}Z.exports=function(S){S=F(S);for(var I=1;I<arguments.length;I++)M(S,arguments[I]);return S}},"./node_modules/dtype/index.js":Z=>{Z.exports=function(te){switch(te){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},"./node_modules/flatten-vertex-data/index.js":(Z,te,E)=>{var B=E("./node_modules/dtype/index.js");Z.exports=H;function H(C,F,L){if(!C)throw new TypeError("must specify data as first parameter");if(L=+(L||0)|0,Array.isArray(C)&&C[0]&&typeof C[0][0]=="number"){var M=C[0].length,b=C.length*M,S,I,O,_;(!F||typeof F=="string")&&(F=new(B(F||"float32"))(b+L));var D=F.length-L;if(b!==D)throw new Error("source length "+b+" ("+M+"x"+C.length+") does not match destination length "+D);for(S=0,O=L;S<C.length;S++)for(I=0;I<M;I++)F[O++]=C[S][I]===null?NaN:C[S][I]}else if(!F||typeof F=="string"){var V=B(F||"float32");if(Array.isArray(C)||F==="array")for(F=new V(C.length+L),S=0,O=L,_=F.length;O<_;O++,S++)F[O]=C[S]===null?NaN:C[S];else L===0?F=new V(C):(F=new V(C.length+L),F.set(C,L))}else F.set(C,L);return F}},"./node_modules/global/window.js":(Z,te,E)=>{var B;typeof window<"u"?B=window:typeof E.g<"u"?B=E.g:typeof self<"u"?B=self:B={},Z.exports=B},"./node_modules/ieee754/index.js":(Z,te)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */te.read=function(E,B,H,C,F){var L,M,b=F*8-C-1,S=(1<<b)-1,I=S>>1,O=-7,_=H?F-1:0,D=H?-1:1,V=E[B+_];for(_+=D,L=V&(1<<-O)-1,V>>=-O,O+=b;O>0;L=L*256+E[B+_],_+=D,O-=8);for(M=L&(1<<-O)-1,L>>=-O,O+=C;O>0;M=M*256+E[B+_],_+=D,O-=8);if(L===0)L=1-I;else{if(L===S)return M?NaN:(V?-1:1)*(1/0);M=M+Math.pow(2,C),L=L-I}return(V?-1:1)*M*Math.pow(2,L-C)},te.write=function(E,B,H,C,F,L){var M,b,S,I=L*8-F-1,O=(1<<I)-1,_=O>>1,D=F===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=C?0:L-1,J=C?1:-1,Y=B<0||B===0&&1/B<0?1:0;for(B=Math.abs(B),isNaN(B)||B===1/0?(b=isNaN(B)?1:0,M=O):(M=Math.floor(Math.log(B)/Math.LN2),B*(S=Math.pow(2,-M))<1&&(M--,S*=2),M+_>=1?B+=D/S:B+=D*Math.pow(2,1-_),B*S>=2&&(M++,S/=2),M+_>=O?(b=0,M=O):M+_>=1?(b=(B*S-1)*Math.pow(2,F),M=M+_):(b=B*Math.pow(2,_-1)*Math.pow(2,F),M=0));F>=8;E[H+V]=b&255,V+=J,b/=256,F-=8);for(M=M<<F|b,I+=F;I>0;E[H+V]=M&255,V+=J,M/=256,I-=8);E[H+V-J]|=Y*128}},"./node_modules/inherits/inherits_browser.js":Z=>{typeof Object.create=="function"?Z.exports=function(E,B){B&&(E.super_=B,E.prototype=Object.create(B.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}))}:Z.exports=function(E,B){if(B){E.super_=B;var H=function(){};H.prototype=B.prototype,E.prototype=new H,E.prototype.constructor=E}}},"./node_modules/is-buffer/index.js":Z=>{/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */Z.exports=function(B){return B!=null&&(te(B)||E(B)||!!B._isBuffer)};function te(B){return!!B.constructor&&typeof B.constructor.isBuffer=="function"&&B.constructor.isBuffer(B)}function E(B){return typeof B.readFloatLE=="function"&&typeof B.slice=="function"&&te(B.slice(0,0))}},"./node_modules/is-function/index.js":Z=>{Z.exports=E;var te=Object.prototype.toString;function E(B){if(!B)return!1;var H=te.call(B);return H==="[object Function]"||typeof B=="function"&&H!=="[object RegExp]"||typeof window<"u"&&(B===window.setTimeout||B===window.alert||B===window.confirm||B===window.prompt)}},"./node_modules/is-obj/index.js":Z=>{Z.exports=function(te){var E=typeof te;return te!==null&&(E==="object"||E==="function")}},"./node_modules/layout-bmfont-text/index.js":(Z,te,E)=>{var B=E("./node_modules/word-wrapper/index.js"),H=E("./node_modules/xtend/immutable.js"),C=E("./node_modules/as-number/index.js"),F=["x","e","a","o","n","s","r","c","u","m","v","w","z"],L=["m","w"],M=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],b="	".charCodeAt(0),S=" ".charCodeAt(0),I=0,O=1,_=2;Z.exports=function(Ie){return new D(Ie)};function D(Se){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(Se)}D.prototype.update=function(Se){if(Se=H({measure:this._measure},Se),this._opt=Se,this._opt.tabSize=C(this._opt.tabSize,4),!Se.font)throw new Error("must provide a valid bitmap font");var Ie=this.glyphs,de=Se.text||"",pe=Se.font;this._setupSpaceGlyphs(pe);var we=B.lines(de,Se),he=Se.width||0;Ie.length=0;var Pe=we.reduce(function(Wn,gi){return Math.max(Wn,gi.width,he)},0),Ve=0,ze=0,et=C(Se.lineHeight,pe.common.lineHeight),Tt=pe.common.base,Rt=et-Tt,fn=Se.letterSpacing||0,cn=et*we.length-Rt,Jn=ve(this._opt.align);ze-=cn,this._width=Pe,this._height=cn,this._descender=et-Tt,this._baseline=Tt,this._xHeight=W(pe),this._capHeight=q(pe),this._lineHeight=et,this._ascender=et-Rt-this._xHeight;var yn=this;we.forEach(function(Wn,gi){for(var ai=Wn.start,nt=Wn.end,dt=Wn.width,Ot,$t=ai;$t<nt;$t++){var Ye=de.charCodeAt($t),mn=yn.getGlyph(pe,Ye);if(mn){Ot&&(Ve+=oe(pe,Ot.id,mn.id));var Pn=Ve;Jn===O?Pn+=(Pe-dt)/2:Jn===_&&(Pn+=Pe-dt),Ie.push({position:[Pn,ze],data:mn,index:$t,line:gi}),Ve+=mn.xadvance+fn,Ot=mn}}ze+=et,Ve=0}),this._linesTotal=we.length},D.prototype._setupSpaceGlyphs=function(Se){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!(!Se.chars||Se.chars.length===0)){var Ie=Y(Se,S)||U(Se)||Se.chars[0],de=this._opt.tabSize*Ie.xadvance;this._fallbackSpaceGlyph=Ie,this._fallbackTabGlyph=H(Ie,{x:0,y:0,xadvance:de,id:b,xoffset:0,yoffset:0,width:0,height:0})}},D.prototype.getGlyph=function(Se,Ie){var de=Y(Se,Ie);return de||(Ie===b?this._fallbackTabGlyph:Ie===S?this._fallbackSpaceGlyph:null)},D.prototype.computeMetrics=function(Se,Ie,de,pe){var we=this._opt.letterSpacing||0,he=this._opt.font,Pe=0,Ve=0,ze=0,et,Tt;if(!he.chars||he.chars.length===0)return{start:Ie,end:Ie,width:0};de=Math.min(Se.length,de);for(var Rt=Ie;Rt<de;Rt++){var fn=Se.charCodeAt(Rt),et=this.getGlyph(he,fn);if(et){et.xoffset;var cn=Tt?oe(he,Tt.id,et.id):0;Pe+=cn;var Jn=Pe+et.xadvance+we,yn=Pe+et.width;if(yn>=pe||Jn>=pe)break;Pe=Jn,Ve=yn,Tt=et}ze++}return Tt&&(Ve+=Tt.xoffset),{start:Ie,end:Ie+ze,width:Ve}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(V);function V(Se){Object.defineProperty(D.prototype,Se,{get:J(Se),configurable:!0})}function J(Se){return new Function(["return function "+Se+"() {","  return this._"+Se,"}"].join(`
`))()}function Y(Se,Ie){if(!Se.chars||Se.chars.length===0)return null;var de=Ae(Se.chars,Ie);return de>=0?Se.chars[de]:null}function W(Se){for(var Ie=0;Ie<F.length;Ie++){var de=F[Ie].charCodeAt(0),pe=Ae(Se.chars,de);if(pe>=0)return Se.chars[pe].height}return 0}function U(Se){for(var Ie=0;Ie<L.length;Ie++){var de=L[Ie].charCodeAt(0),pe=Ae(Se.chars,de);if(pe>=0)return Se.chars[pe]}return 0}function q(Se){for(var Ie=0;Ie<M.length;Ie++){var de=M[Ie].charCodeAt(0),pe=Ae(Se.chars,de);if(pe>=0)return Se.chars[pe].height}return 0}function oe(Se,Ie,de){if(!Se.kernings||Se.kernings.length===0)return 0;for(var pe=Se.kernings,we=0;we<pe.length;we++){var he=pe[we];if(he.first===Ie&&he.second===de)return he.amount}return 0}function ve(Se){return Se==="center"?O:Se==="right"?_:I}function Ae(Se,Ie,de){de=de||0;for(var pe=de;pe<Se.length;pe++)if(Se[pe].id===Ie)return pe;return-1}},"./node_modules/load-bmfont/browser.js":(Z,te,E)=>{var B=E("./node_modules/buffer/index.js").Buffer,H=E("./node_modules/xhr/index.js"),C=function(){},F=E("./node_modules/parse-bmfont-ascii/index.js"),L=E("./node_modules/parse-bmfont-xml/lib/browser.js"),M=E("./node_modules/parse-bmfont-binary/index.js"),b=E("./node_modules/load-bmfont/lib/is-binary.js"),S=E("./node_modules/xtend/immutable.js"),I=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();Z.exports=function(D,V){V=typeof V=="function"?V:C,typeof D=="string"?D={uri:D}:D||(D={});var J=D.binary;J&&(D=_(D)),H(D,function(Y,W,U){if(Y)return V(Y);if(!/^2/.test(W.statusCode))return V(new Error("http status code: "+W.statusCode));if(!U)return V(new Error("no body result"));var q=!1;if(O(U)){var oe=new Uint8Array(U);U=B.from(oe,"binary")}b(U)&&(q=!0,typeof U=="string"&&(U=B.from(U,"binary"))),q||(B.isBuffer(U)&&(U=U.toString(D.encoding)),U=U.trim());var ve;try{var Ae=W.headers["content-type"];q?ve=M(U):/json/.test(Ae)||U.charAt(0)==="{"?ve=JSON.parse(U):/xml/.test(Ae)||U.charAt(0)==="<"?ve=L(U):ve=F(U)}catch(Se){V(new Error("error parsing font "+Se.message)),V=C}V(null,ve)})};function O(D){var V=Object.prototype.toString;return V.call(D)==="[object ArrayBuffer]"}function _(D){if(I)return S(D,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var V=new self.XMLHttpRequest;return V.overrideMimeType("text/plain; charset=x-user-defined"),S({xhr:V},D)}},"./node_modules/load-bmfont/lib/is-binary.js":(Z,te,E)=>{var B=E("./node_modules/buffer/index.js").Buffer,H=E("./node_modules/buffer-equal/index.js"),C=B.from([66,77,70,3]);Z.exports=function(F){return typeof F=="string"?F.substring(0,3)==="BMF":F.length>4&&H(F.slice(0,4),C)}},"./node_modules/object-assign/index.js":Z=>{/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var te=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;function H(F){if(F==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(F)}function C(){try{if(!Object.assign)return!1;var F=new String("abc");if(F[5]="de",Object.getOwnPropertyNames(F)[0]==="5")return!1;for(var L={},M=0;M<10;M++)L["_"+String.fromCharCode(M)]=M;var b=Object.getOwnPropertyNames(L).map(function(I){return L[I]});if(b.join("")!=="0123456789")return!1;var S={};return"abcdefghijklmnopqrst".split("").forEach(function(I){S[I]=I}),Object.keys(Object.assign({},S)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}Z.exports=C()?Object.assign:function(F,L){for(var M,b=H(F),S,I=1;I<arguments.length;I++){M=Object(arguments[I]);for(var O in M)E.call(M,O)&&(b[O]=M[O]);if(te){S=te(M);for(var _=0;_<S.length;_++)B.call(M,S[_])&&(b[S[_]]=M[S[_]])}}return b}},"./node_modules/parse-bmfont-ascii/index.js":Z=>{Z.exports=function(C){if(!C)throw new Error("no data provided");C=C.toString().trim();var F={pages:[],chars:[],kernings:[]},L=C.split(/\r\n?|\n/g);if(L.length===0)throw new Error("no data in BMFont file");for(var M=0;M<L.length;M++){var b=te(L[M],M);if(b)if(b.key==="page"){if(typeof b.data.id!="number")throw new Error("malformed file at line "+M+" -- needs page id=N");if(typeof b.data.file!="string")throw new Error("malformed file at line "+M+' -- needs page file="path"');F.pages[b.data.id]=b.data.file}else b.key==="chars"||b.key==="kernings"||(b.key==="char"?F.chars.push(b.data):b.key==="kerning"?F.kernings.push(b.data):F[b.key]=b.data)}return F};function te(H,C){if(H=H.replace(/\t+/g," ").trim(),!H)return null;var F=H.indexOf(" ");if(F===-1)throw new Error("no named row at line "+C);var L=H.substring(0,F);H=H.substring(F+1),H=H.replace(/letter=[\'\"]\S+[\'\"]/gi,""),H=H.split("="),H=H.map(function(O){return O.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var M=[],b=0;b<H.length;b++){var S=H[b];b===0?M.push({key:S[0],data:""}):b===H.length-1?M[M.length-1].data=E(S[0]):(M[M.length-1].data=E(S[0]),M.push({key:S[1],data:""}))}var I={key:L,data:{}};return M.forEach(function(O){I.data[O.key]=O.data}),I}function E(H){return!H||H.length===0?"":H.indexOf('"')===0||H.indexOf("'")===0?H.substring(1,H.length-1):H.indexOf(",")!==-1?B(H):parseInt(H,10)}function B(H){return H.split(",").map(function(C){return parseInt(C,10)})}},"./node_modules/parse-bmfont-binary/index.js":Z=>{var te=[66,77,70];Z.exports=function(I){if(I.length<6)throw new Error("invalid buffer length for BMFont");var O=te.every(function(Y,W){return I.readUInt8(W)===Y});if(!O)throw new Error("BMFont missing BMF byte header");var _=3,D=I.readUInt8(_++);if(D>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var V={kernings:[],chars:[]},J=0;J<5;J++)_+=E(V,I,_);return V};function E(S,I,O){if(O>I.length-1)return 0;var _=I.readUInt8(O++),D=I.readInt32LE(O);switch(O+=4,_){case 1:S.info=B(I,O);break;case 2:S.common=H(I,O);break;case 3:S.pages=C(I,O,D);break;case 4:S.chars=F(I,O,D);break;case 5:S.kernings=L(I,O,D);break}return 5+D}function B(S,I){var O={};O.size=S.readInt16LE(I);var _=S.readUInt8(I+2);return O.smooth=_>>7&1,O.unicode=_>>6&1,O.italic=_>>5&1,O.bold=_>>4&1,_>>3&1&&(O.fixedHeight=1),O.charset=S.readUInt8(I+3)||"",O.stretchH=S.readUInt16LE(I+4),O.aa=S.readUInt8(I+6),O.padding=[S.readInt8(I+7),S.readInt8(I+8),S.readInt8(I+9),S.readInt8(I+10)],O.spacing=[S.readInt8(I+11),S.readInt8(I+12)],O.outline=S.readUInt8(I+13),O.face=b(S,I+14),O}function H(S,I){var O={};return O.lineHeight=S.readUInt16LE(I),O.base=S.readUInt16LE(I+2),O.scaleW=S.readUInt16LE(I+4),O.scaleH=S.readUInt16LE(I+6),O.pages=S.readUInt16LE(I+8),S.readUInt8(I+10),O.packed=0,O.alphaChnl=S.readUInt8(I+11),O.redChnl=S.readUInt8(I+12),O.greenChnl=S.readUInt8(I+13),O.blueChnl=S.readUInt8(I+14),O}function C(S,I,O){for(var _=[],D=M(S,I),V=D.length+1,J=O/V,Y=0;Y<J;Y++)_[Y]=S.slice(I,I+D.length).toString("utf8"),I+=V;return _}function F(S,I,O){for(var _=[],D=O/20,V=0;V<D;V++){var J={},Y=V*20;J.id=S.readUInt32LE(I+0+Y),J.x=S.readUInt16LE(I+4+Y),J.y=S.readUInt16LE(I+6+Y),J.width=S.readUInt16LE(I+8+Y),J.height=S.readUInt16LE(I+10+Y),J.xoffset=S.readInt16LE(I+12+Y),J.yoffset=S.readInt16LE(I+14+Y),J.xadvance=S.readInt16LE(I+16+Y),J.page=S.readUInt8(I+18+Y),J.chnl=S.readUInt8(I+19+Y),_[V]=J}return _}function L(S,I,O){for(var _=[],D=O/10,V=0;V<D;V++){var J={},Y=V*10;J.first=S.readUInt32LE(I+0+Y),J.second=S.readUInt32LE(I+4+Y),J.amount=S.readInt16LE(I+8+Y),_[V]=J}return _}function M(S,I){for(var O=I;O<S.length&&S[O]!==0;O++);return S.slice(I,O)}function b(S,I){return M(S,I).toString("utf8")}},"./node_modules/parse-bmfont-xml/lib/browser.js":(Z,te,E)=>{var B=E("./node_modules/parse-bmfont-xml/lib/parse-attribs.js"),H=E("./node_modules/xml-parse-from-string/index.js"),C={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};Z.exports=function(S){S=S.toString();var I=H(S),O={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(U){var q=I.getElementsByTagName(U)[0];q&&(O[U]=B(F(q)))});var _=I.getElementsByTagName("pages")[0];if(!_)throw new Error("malformed file -- no <pages> element");for(var D=_.getElementsByTagName("page"),V=0;V<D.length;V++){var J=D[V],Y=parseInt(J.getAttribute("id"),10),W=J.getAttribute("file");if(isNaN(Y))throw new Error('malformed file -- page "id" attribute is NaN');if(!W)throw new Error('malformed file -- needs page "file" attribute');O.pages[parseInt(Y,10)]=W}return["chars","kernings"].forEach(function(U){var q=I.getElementsByTagName(U)[0];if(q)for(var oe=U.substring(0,U.length-1),ve=q.getElementsByTagName(oe),Ae=0;Ae<ve.length;Ae++){var Se=ve[Ae];O[U].push(B(F(Se)))}}),O};function F(b){var S=L(b);return S.reduce(function(I,O){var _=M(O.nodeName);return I[_]=O.nodeValue,I},{})}function L(b){for(var S=[],I=0;I<b.attributes.length;I++)S.push(b.attributes[I]);return S}function M(b){return C[b.toLowerCase()]||b}},"./node_modules/parse-bmfont-xml/lib/parse-attribs.js":Z=>{var te="chasrset";Z.exports=function(H){te in H&&(H.charset=H[te],delete H[te]);for(var C in H)C==="face"||C==="charset"||(C==="padding"||C==="spacing"?H[C]=E(H[C]):H[C]=parseInt(H[C],10));return H};function E(B){return B.split(",").map(function(H){return parseInt(H,10)})}},"./node_modules/parse-headers/parse-headers.js":Z=>{var te=function(B){return B.replace(/^\s+|\s+$/g,"")},E=function(B){return Object.prototype.toString.call(B)==="[object Array]"};Z.exports=function(B){if(!B)return{};for(var H={},C=te(B).split(`
`),F=0;F<C.length;F++){var L=C[F],M=L.indexOf(":"),b=te(L.slice(0,M)).toLowerCase(),S=te(L.slice(M+1));typeof H[b]>"u"?H[b]=S:E(H[b])?H[b].push(S):H[b]=[H[b],S]}return H}},"./node_modules/present/lib/present-browser.js":(Z,te,E)=>{var B=E.g.performance||{},H=function(){for(var C=["now","webkitNow","msNow","mozNow","oNow"];C.length;){var F=C.shift();if(F in B)return B[F].bind(B)}var L=Date.now||function(){return new Date().getTime()},M=(B.timing||{}).navigationStart||L();return function(){return L()-M}}();H.performanceNow=B.now,H.noConflict=function(){B.now=H.performanceNow},H.conflict=function(){B.now=H},H.conflict(),Z.exports=H},"./node_modules/process/browser.js":Z=>{var te=Z.exports={},E,B;function H(){throw new Error("setTimeout has not been defined")}function C(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?E=setTimeout:E=H}catch{E=H}try{typeof clearTimeout=="function"?B=clearTimeout:B=C}catch{B=C}})();function F(J){if(E===setTimeout)return setTimeout(J,0);if((E===H||!E)&&setTimeout)return E=setTimeout,setTimeout(J,0);try{return E(J,0)}catch{try{return E.call(null,J,0)}catch{return E.call(this,J,0)}}}function L(J){if(B===clearTimeout)return clearTimeout(J);if((B===C||!B)&&clearTimeout)return B=clearTimeout,clearTimeout(J);try{return B(J)}catch{try{return B.call(null,J)}catch{return B.call(this,J)}}}var M=[],b=!1,S,I=-1;function O(){!b||!S||(b=!1,S.length?M=S.concat(M):I=-1,M.length&&_())}function _(){if(!b){var J=F(O);b=!0;for(var Y=M.length;Y;){for(S=M,M=[];++I<Y;)S&&S[I].run();I=-1,Y=M.length}S=null,b=!1,L(J)}}te.nextTick=function(J){var Y=new Array(arguments.length-1);if(arguments.length>1)for(var W=1;W<arguments.length;W++)Y[W-1]=arguments[W];M.push(new D(J,Y)),M.length===1&&!b&&F(_)};function D(J,Y){this.fun=J,this.array=Y}D.prototype.run=function(){this.fun.apply(null,this.array)},te.title="browser",te.browser=!0,te.env={},te.argv=[],te.version="",te.versions={};function V(){}te.on=V,te.addListener=V,te.once=V,te.off=V,te.removeListener=V,te.removeAllListeners=V,te.emit=V,te.prependListener=V,te.prependOnceListener=V,te.listeners=function(J){return[]},te.binding=function(J){throw new Error("process.binding is not supported")},te.cwd=function(){return"/"},te.chdir=function(J){throw new Error("process.chdir is not supported")},te.umask=function(){return 0}},"./node_modules/promise-polyfill/Promise.js":function(Z){(function(te){var E=setTimeout,B=typeof setImmediate=="function"&&setImmediate||function(_){E(_,1)};function H(_,D){return function(){_.apply(D,arguments)}}var C=Array.isArray||function(_){return Object.prototype.toString.call(_)==="[object Array]"};function F(_){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof _!="function")throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],O(_,H(M,this),H(b,this))}function L(_){var D=this;if(this._state===null){this._deferreds.push(_);return}B(function(){var V=D._state?_.onFulfilled:_.onRejected;if(V===null){(D._state?_.resolve:_.reject)(D._value);return}var J;try{J=V(D._value)}catch(Y){_.reject(Y);return}_.resolve(J)})}function M(_){try{if(_===this)throw new TypeError("A promise cannot be resolved with itself.");if(_&&(typeof _=="object"||typeof _=="function")){var D=_.then;if(typeof D=="function"){O(H(D,_),H(M,this),H(b,this));return}}this._state=!0,this._value=_,S.call(this)}catch(V){b.call(this,V)}}function b(_){this._state=!1,this._value=_,S.call(this)}function S(){for(var _=0,D=this._deferreds.length;_<D;_++)L.call(this,this._deferreds[_]);this._deferreds=null}function I(_,D,V,J){this.onFulfilled=typeof _=="function"?_:null,this.onRejected=typeof D=="function"?D:null,this.resolve=V,this.reject=J}function O(_,D,V){var J=!1;try{_(function(Y){J||(J=!0,D(Y))},function(Y){J||(J=!0,V(Y))})}catch(Y){if(J)return;J=!0,V(Y)}}F.prototype.catch=function(_){return this.then(null,_)},F.prototype.then=function(_,D){var V=this;return new F(function(J,Y){L.call(V,new I(_,D,J,Y))})},F.all=function(){var _=Array.prototype.slice.call(arguments.length===1&&C(arguments[0])?arguments[0]:arguments);return new F(function(D,V){if(_.length===0)return D([]);var J=_.length;function Y(U,q){try{if(q&&(typeof q=="object"||typeof q=="function")){var oe=q.then;if(typeof oe=="function"){oe.call(q,function(ve){Y(U,ve)},V);return}}_[U]=q,--J===0&&D(_)}catch(ve){V(ve)}}for(var W=0;W<_.length;W++)Y(W,_[W])})},F.resolve=function(_){return _&&typeof _=="object"&&_.constructor===F?_:new F(function(D){D(_)})},F.reject=function(_){return new F(function(D,V){V(_)})},F.race=function(_){return new F(function(D,V){for(var J=0,Y=_.length;J<Y;J++)_[J].then(D,V)})},F._setImmediateFn=function(D){B=D},Z.exports?Z.exports=F:te.Promise||(te.Promise=F)})(this)},"./node_modules/quad-indices/index.js":(Z,te,E)=>{var B=E("./node_modules/dtype/index.js"),H=E("./node_modules/an-array/index.js"),C=E("./node_modules/is-buffer/index.js"),F=[0,2,3],L=[2,1,3];Z.exports=function(b,S){(!b||!(H(b)||C(b)))&&(S=b||{},b=null),typeof S=="number"?S={count:S}:S=S||{};for(var I=typeof S.type=="string"?S.type:"uint16",O=typeof S.count=="number"?S.count:1,_=S.start||0,D=S.clockwise!==!1?F:L,V=D[0],J=D[1],Y=D[2],W=O*6,U=b||new(B(I))(W),q=0,oe=0;q<W;q+=6,oe+=4){var ve=q+_;U[ve+0]=oe+0,U[ve+1]=oe+1,U[ve+2]=oe+2,U[ve+3]=oe+V,U[ve+4]=oe+J,U[ve+5]=oe+Y}return U}},"./node_modules/super-animejs/lib/anime.es.js":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>vs});var B={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},H={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},C=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],F={CSS:{},springs:{}};function L(Ge,st,wt){return Math.min(Math.max(Ge,st),wt)}function M(Ge,st){return Ge.indexOf(st)>-1}function b(Ge,st){return Ge.apply(null,st)}var S=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,I=/^rgb/,O=/^hsl/,_={arr:function(Ge){return Array.isArray(Ge)},obj:function(Ge){return M(Object.prototype.toString.call(Ge),"Object")},pth:function(Ge){return _.obj(Ge)&&Ge.hasOwnProperty("totalLength")},svg:function(Ge){return Ge instanceof SVGElement},inp:function(Ge){return Ge instanceof HTMLInputElement},dom:function(Ge){return Ge.nodeType||_.svg(Ge)},str:function(Ge){return typeof Ge=="string"},fnc:function(Ge){return typeof Ge=="function"},und:function(Ge){return typeof Ge>"u"},hex:function(Ge){return S.test(Ge)},rgb:function(Ge){return I.test(Ge)},hsl:function(Ge){return O.test(Ge)},col:function(Ge){return _.hex(Ge)||_.rgb(Ge)||_.hsl(Ge)},key:function(Ge){return!B.hasOwnProperty(Ge)&&!H.hasOwnProperty(Ge)&&Ge!=="targets"&&Ge!=="keyframes"}},D=/\(([^)]+)\)/;function V(Ge){var st=D.exec(Ge);return st?st[1].split(",").map(function(wt){return parseFloat(wt)}):[]}function J(Ge,st){var wt=V(Ge),en=L(_.und(wt[0])?1:wt[0],.1,100),Xt=L(_.und(wt[1])?100:wt[1],.1,100),En=L(_.und(wt[2])?10:wt[2],.1,100),Fn=L(_.und(wt[3])?0:wt[3],.1,100),Ci=Math.sqrt(Xt/en),vi=En/(2*Math.sqrt(Xt*en)),An=vi<1?Ci*Math.sqrt(1-vi*vi):0,Ui=1,Hi=vi<1?(vi*Ci+-Fn)/An:-Fn+Ci;function ir(Tr){var pr=st?st*Tr/1e3:Tr;return vi<1?pr=Math.exp(-pr*vi*Ci)*(Ui*Math.cos(An*pr)+Hi*Math.sin(An*pr)):pr=(Ui+Hi*pr)*Math.exp(-pr*Ci),Tr===0||Tr===1?Tr:1-pr}function us(){var Tr=F.springs[Ge];if(Tr)return Tr;for(var pr=1/6,Pr=0,Rs=0;;)if(Pr+=pr,ir(Pr)===1){if(Rs++,Rs>=16)break}else Rs=0;var fa=Pr*pr*1e3;return F.springs[Ge]=fa,fa}return st?ir:us}function Y(Ge,st){Ge===void 0&&(Ge=1),st===void 0&&(st=.5);var wt=L(Ge,1,10),en=L(st,.1,2);return function(Xt){return Xt===0||Xt===1?Xt:-wt*Math.pow(2,10*(Xt-1))*Math.sin((Xt-1-en/(Math.PI*2)*Math.asin(1/wt))*(Math.PI*2)/en)}}function W(Ge){return Ge===void 0&&(Ge=10),function(st){return Math.round(st*Ge)*(1/Ge)}}var U=function(){var Ge=11,st=1/(Ge-1);function wt(Ui,Hi){return 1-3*Hi+3*Ui}function en(Ui,Hi){return 3*Hi-6*Ui}function Xt(Ui){return 3*Ui}function En(Ui,Hi,ir){return((wt(Hi,ir)*Ui+en(Hi,ir))*Ui+Xt(Hi))*Ui}function Fn(Ui,Hi,ir){return 3*wt(Hi,ir)*Ui*Ui+2*en(Hi,ir)*Ui+Xt(Hi)}function Ci(Ui,Hi,ir,us,Tr){var pr,Pr,Rs=0;do Pr=Hi+(ir-Hi)/2,pr=En(Pr,us,Tr)-Ui,pr>0?ir=Pr:Hi=Pr;while(Math.abs(pr)>1e-7&&++Rs<10);return Pr}function vi(Ui,Hi,ir,us){for(var Tr=0;Tr<4;++Tr){var pr=Fn(Hi,ir,us);if(pr===0)return Hi;var Pr=En(Hi,ir,us)-Ui;Hi-=Pr/pr}return Hi}function An(Ui,Hi,ir,us){if(!(0<=Ui&&Ui<=1&&0<=ir&&ir<=1))return;var Tr=new Float32Array(Ge);if(Ui!==Hi||ir!==us)for(var pr=0;pr<Ge;++pr)Tr[pr]=En(pr*st,Ui,ir);function Pr(Rs){for(var fa=0,di=1,Cr=Ge-1;di!==Cr&&Tr[di]<=Rs;++di)fa+=st;--di;var zs=(Rs-Tr[di])/(Tr[di+1]-Tr[di]),zr=fa+zs*st,ie=Fn(zr,Ui,ir);return ie>=.001?vi(Rs,zr,Ui,ir):ie===0?zr:Ci(Rs,fa,fa+st,Ui,ir)}return function(Rs){return Ui===Hi&&ir===us||Rs===0||Rs===1?Rs:En(Pr(Rs),Hi,us)}}return An}(),q=function(){var Ge=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],st={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],Y],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(Fn,Ci){return function(vi){return 1-Y(Fn,Ci)(1-vi)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(Fn,Ci){return function(vi){return vi<.5?Y(Fn,Ci)(vi*2)/2:1-Y(Fn,Ci)(vi*-2+2)/2}}]},wt={linear:[.25,.25,.75,.75]};for(var en in st)for(var Xt=0,En=st[en].length;Xt<En;Xt++)wt["ease"+en+Ge[Xt]]=st[en][Xt];return wt}();function oe(Ge,st){if(_.fnc(Ge))return Ge;var wt=Ge.split("(")[0],en=q[wt],Xt=V(Ge);switch(wt){case"spring":return J(Ge,st);case"cubicBezier":return b(U,Xt);case"steps":return b(W,Xt);default:return _.fnc(en)?b(en,Xt):b(U,en)}}function ve(Ge){try{var st=document.querySelectorAll(Ge);return st}catch{return}}var Ae=[];function Se(Ge,st){for(var wt=Ae,en=Ge.length,Xt=arguments.length>=2?arguments[1]:void 0,En=0;En<en;En++)if(En in Ge){var Fn=Ge[En];st.call(Xt,Fn,En,Ge)&&wt.push(Fn)}return Ae=Ge,Ae.length=0,wt}function Ie(Ge,st){st||(st=[]);for(var wt=0,en=Ge.length;wt<en;wt++){var Xt=Ge[wt];Array.isArray(Xt)?Ie(Xt,st):st.push(Xt)}return st}function de(Ge){return _.arr(Ge)?Ge:(_.str(Ge)&&(Ge=ve(Ge)||Ge),Ge instanceof NodeList||Ge instanceof HTMLCollection?[].slice.call(Ge):[Ge])}function pe(Ge,st){return Ge.some(function(wt){return wt===st})}function we(Ge){var st={};for(var wt in Ge)st[wt]=Ge[wt];return st}function he(Ge,st){var wt=we(Ge);for(var en in Ge)wt[en]=st.hasOwnProperty(en)?st[en]:Ge[en];return wt}function Pe(Ge,st){var wt=we(Ge);for(var en in st)wt[en]=_.und(Ge[en])?st[en]:Ge[en];return wt}var Ve=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g;function ze(Ge){var st=Ve.exec(Ge);return st?"rgba("+st[1]+",1)":Ge}var et=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Tt=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;function Rt(Ge){var st=Ge.replace(et,function(Fn,Ci,vi,An){return Ci+Ci+vi+vi+An+An}),wt=Tt.exec(st),en=parseInt(wt[1],16),Xt=parseInt(wt[2],16),En=parseInt(wt[3],16);return"rgba("+en+","+Xt+","+En+",1)"}var fn=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,cn=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g;function Jn(Ge){var st=fn.exec(Ge)||cn.exec(Ge),wt=parseInt(st[1],10)/360,en=parseInt(st[2],10)/100,Xt=parseInt(st[3],10)/100,En=st[4]||1;function Fn(ir,us,Tr){return Tr<0&&(Tr+=1),Tr>1&&(Tr-=1),Tr<.16666666666666666?ir+(us-ir)*6*Tr:Tr<.5?us:Tr<.6666666666666666?ir+(us-ir)*(.6666666666666666-Tr)*6:ir}var Ci,vi,An;if(en==0)Ci=vi=An=Xt;else{var Ui=Xt<.5?Xt*(1+en):Xt+en-Xt*en,Hi=2*Xt-Ui;Ci=Fn(Hi,Ui,wt+.3333333333333333),vi=Fn(Hi,Ui,wt),An=Fn(Hi,Ui,wt-.3333333333333333)}return"rgba("+Ci*255+","+vi*255+","+An*255+","+En+")"}function yn(Ge){if(_.rgb(Ge))return ze(Ge);if(_.hex(Ge))return Rt(Ge);if(_.hsl(Ge))return Jn(Ge)}var Wn=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function gi(Ge){var st=Wn.exec(Ge);if(st)return st[2]}function ai(Ge){if(M(Ge,"translate")||Ge==="perspective")return"px";if(M(Ge,"rotate")||M(Ge,"skew"))return"deg"}function nt(Ge,st){return _.fnc(Ge)?Ge(st.target,st.id,st.total):Ge}function dt(Ge,st){return Ge.getAttribute(st)}function Ot(Ge,st,wt){var en=gi(st);if(pe([wt,"deg","rad","turn"],en))return st;var Xt=F.CSS[st+wt];if(!_.und(Xt))return Xt;var En=100,Fn=document.createElement(Ge.tagName),Ci=Ge.parentNode&&Ge.parentNode!==document?Ge.parentNode:document.body;Ci.appendChild(Fn),Fn.style.position="absolute",Fn.style.width=En+wt;var vi=En/Fn.offsetWidth;Ci.removeChild(Fn);var An=vi*parseFloat(st);return F.CSS[st+wt]=An,An}function $t(Ge,st,wt){if(st in Ge.style){var en=st.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Xt=Ge.style[st]||getComputedStyle(Ge).getPropertyValue(en)||"0";return wt?Ot(Ge,Xt,wt):Xt}}function Ye(Ge,st){if(_.dom(Ge)&&!_.inp(Ge)&&(dt(Ge,st)||_.svg(Ge)&&Ge[st]))return"attribute";if(_.dom(Ge)&&pe(C,st))return"transform";if(_.dom(Ge)&&st!=="transform"&&$t(Ge,st))return"css";if(Ge[st]!=null)return"object"}var mn=/(\w+)\(([^)]*)\)/g;function Pn(Ge){if(_.dom(Ge)){for(var st=Ge.style.transform||"",wt=new Map,en;en=mn.exec(st);)wt.set(en[1],en[2]);return wt}}function wn(Ge,st,wt,en){var Xt=M(st,"scale")?1:0+ai(st),En=Pn(Ge).get(st)||Xt;return wt&&(wt.transforms.list.set(st,En),wt.transforms.last=st),en?Ot(Ge,En,en):En}function Dn(Ge,st,wt,en){switch(Ye(Ge,st)){case"transform":return wn(Ge,st,en,wt);case"css":return $t(Ge,st,wt);case"attribute":return dt(Ge,st);default:return Ge[st]||0}}var gn=/^(\*=|\+=|-=)/;function ui(Ge,st){var wt=gn.exec(Ge);if(!wt)return Ge;var en=gi(Ge)||0,Xt=parseFloat(st),En=parseFloat(Ge.replace(wt[0],""));switch(wt[0][0]){case"+":return Xt+En+en;case"-":return Xt-En+en;case"*":return Xt*En+en}}var Nt=/\s/g;function De(Ge,st){if(_.col(Ge))return yn(Ge);var wt=gi(Ge),en=wt?Ge.substr(0,Ge.length-wt.length):Ge;return st&&!Nt.test(Ge)?en+st:en}function Re(Ge,st){return Math.sqrt(Math.pow(st.x-Ge.x,2)+Math.pow(st.y-Ge.y,2))}function We(Ge){return Math.PI*2*dt(Ge,"r")}function Oe(Ge){return dt(Ge,"width")*2+dt(Ge,"height")*2}function Qe(Ge){return Re({x:dt(Ge,"x1"),y:dt(Ge,"y1")},{x:dt(Ge,"x2"),y:dt(Ge,"y2")})}function Ke(Ge){for(var st=Ge.points,wt=0,en,Xt=0;Xt<st.numberOfItems;Xt++){var En=st.getItem(Xt);Xt>0&&(wt+=Re(en,En)),en=En}return wt}function vt(Ge){var st=Ge.points;return Ke(Ge)+Re(st.getItem(st.numberOfItems-1),st.getItem(0))}function ct(Ge){if(Ge.getTotalLength)return Ge.getTotalLength();switch(Ge.tagName.toLowerCase()){case"circle":return We(Ge);case"rect":return Oe(Ge);case"line":return Qe(Ge);case"polyline":return Ke(Ge);case"polygon":return vt(Ge)}}function Ct(Ge){var st=ct(Ge);return Ge.setAttribute("stroke-dasharray",st),st}function Yt(Ge){for(var st=Ge.parentNode;_.svg(st)&&(st=st.parentNode,!!_.svg(st.parentNode)););return st}function me(Ge,st){var wt=st||{},en=wt.el||Yt(Ge),Xt=en.getBoundingClientRect(),En=dt(en,"viewBox"),Fn=Xt.width,Ci=Xt.height,vi=wt.viewBox||(En?En.split(" "):[0,0,Fn,Ci]);return{el:en,viewBox:vi,x:vi[0]/1,y:vi[1]/1,w:Fn/vi[2],h:Ci/vi[3]}}function ee(Ge,st){var wt=_.str(Ge)?ve(Ge)[0]:Ge,en=st||100;return function(Xt){return{property:Xt,el:wt,svg:me(wt),totalLength:ct(wt)*(en/100)}}}function ae(Ge,st){function wt(Ci){Ci===void 0&&(Ci=0);var vi=st+Ci>=1?st+Ci:0;return Ge.el.getPointAtLength(vi)}var en=me(Ge.el,Ge.svg),Xt=wt(),En=wt(-1),Fn=wt(1);switch(Ge.property){case"x":return(Xt.x-en.x)*en.w;case"y":return(Xt.y-en.y)*en.h;case"angle":return Math.atan2(Fn.y-En.y,Fn.x-En.x)*180/Math.PI}}var Ue=/-?\d*\.?\d+/g;function ht(Ge,st){var wt=De(_.pth(Ge)?Ge.totalLength:Ge,st)+"";return{original:wt,numbers:wt.match(Ue)?wt.match(Ue).map(Number):[0],strings:_.str(Ge)||st?wt.split(Ue):[]}}function ft(Ge){var st=Ge?Ie(_.arr(Ge)?Ge.map(de):de(Ge)):[];return Se(st,function(wt,en,Xt){return Xt.indexOf(wt)===en})}function Ft(Ge){var st=ft(Ge);return st.map(function(wt,en){return{target:wt,id:en,total:st.length,transforms:{list:Pn(wt)}}})}var hi=/^spring/;function bi(Ge,st){var wt=we(st);if(hi.test(wt.easing)&&(wt.duration=J(wt.easing)),_.arr(Ge)){var en=Ge.length,Xt=en===2&&!_.obj(Ge[0]);Xt?Ge={value:Ge}:_.fnc(st.duration)||(wt.duration=st.duration/en)}var En=_.arr(Ge)?Ge:[Ge];return En.map(function(Fn,Ci){var vi=_.obj(Fn)&&!_.pth(Fn)?Fn:{value:Fn};return _.und(vi.delay)&&(vi.delay=Ci?0:st.delay),_.und(vi.endDelay)&&(vi.endDelay=Ci===En.length-1?st.endDelay:0),vi}).map(function(Fn){return Pe(Fn,wt)})}function ri(Ge){for(var st=Se(Ie(Ge.map(function(En){return Object.keys(En)})),function(En){return _.key(En)}).reduce(function(En,Fn){return En.indexOf(Fn)<0&&En.push(Fn),En},[]),wt={},en=function(En){var Fn=st[En];wt[Fn]=Ge.map(function(Ci){var vi={};for(var An in Ci)_.key(An)?An==Fn&&(vi.value=Ci[An]):vi[An]=Ci[An];return vi})},Xt=0;Xt<st.length;Xt++)en(Xt);return wt}function Ai(Ge,st){var wt=[],en=st.keyframes;en&&(st=Pe(ri(en),st));for(var Xt in st)_.key(Xt)&&wt.push({name:Xt,tweens:bi(st[Xt],Ge)});return wt}function lr(Ge,st){var wt={};for(var en in Ge){var Xt=nt(Ge[en],st);_.arr(Xt)&&(Xt=Xt.map(function(En){return nt(En,st)}),Xt.length===1&&(Xt=Xt[0])),wt[en]=Xt}return wt.duration=parseFloat(wt.duration),wt.delay=parseFloat(wt.delay),wt}function _s(Ge,st){var wt;return Ge.tweens.map(function(en){var Xt=lr(en,st),En=Xt.value,Fn=_.arr(En)?En[1]:En,Ci=gi(Fn),vi=Dn(st.target,Ge.name,Ci,st),An=wt?wt.to.original:vi,Ui=_.arr(En)?En[0]:An,Hi=gi(Ui)||gi(vi),ir=Ci||Hi;return _.und(Fn)&&(Fn=An),Xt.from=ht(Ui,ir),Xt.to=ht(ui(Fn,Ui),ir),Xt.start=wt?wt.end:0,Xt.end=Xt.start+Xt.delay+Xt.duration+Xt.endDelay,Xt.easing=oe(Xt.easing,Xt.duration),Xt.isPath=_.pth(En),Xt.isColor=_.col(Xt.from.original),Xt.isColor&&(Xt.round=1),wt=Xt,Xt})}var Fs={css:function(Ge,st,wt){return Ge.style[st]=wt},attribute:function(Ge,st,wt){return Ge.setAttribute(st,wt)},object:function(Ge,st,wt){return Ge[st]=wt},transform:function(Ge,st,wt,en,Xt){if(en.list.set(st,wt),st===en.last||Xt){var En="";en.list.forEach(function(Fn,Ci){En+=Ci+"("+Fn+") "}),Ge.style.transform=En}}};function Vs(Ge,st){for(var wt=Ft(Ge),en=0,Xt=wt.length;en<Xt;en++){var En=wt[en];for(var Fn in st){var Ci=nt(st[Fn],En),vi=En.target,An=gi(Ci),Ui=Dn(vi,Fn,An,En),Hi=An||gi(Ui),ir=ui(De(Ci,Hi),Ui),us=Ye(vi,Fn);Fs[us](vi,Fn,ir,En.transforms,!0)}}}function Dr(Ge,st){var wt=Ye(Ge.target,st.name);if(wt){var en=_s(st,Ge),Xt=en[en.length-1];return{type:wt,property:st.name,animatable:Ge,tweens:en,duration:Xt.end,delay:en[0].delay,endDelay:Xt.endDelay}}}function ti(Ge,st){return Se(Ie(Ge.map(function(wt){return st.map(function(en){return Dr(wt,en)})})),function(wt){return!_.und(wt)})}function hn(Ge,st){var wt=Ge.length,en=function(En){return En.timelineOffset?En.timelineOffset:0},Xt={};return Xt.duration=wt?Math.max.apply(Math,Ge.map(function(En){return en(En)+En.duration})):st.duration,Xt.delay=wt?Math.min.apply(Math,Ge.map(function(En){return en(En)+En.delay})):st.delay,Xt.endDelay=wt?Xt.duration-Math.max.apply(Math,Ge.map(function(En){return en(En)+En.duration-En.endDelay})):st.endDelay,Xt}var On=0;function Oi(Ge){var st=he(B,Ge),wt=he(H,Ge),en=Ai(wt,Ge),Xt=Ft(Ge.targets),En=ti(Xt,en),Fn=hn(En,wt),Ci=On;return On++,Pe(st,{id:Ci,children:[],animatables:Xt,animations:En,duration:Fn.duration,delay:Fn.delay,endDelay:Fn.endDelay})}var Yn=[],Gi=[],nr,cr=function(){function Ge(){nr=requestAnimationFrame(st)}function st(wt){var en=Yn.length;if(en){for(var Xt=0;Xt<en;){var En=Yn[Xt];if(!En.paused)En.tick(wt);else{var Fn=Yn.indexOf(En);Fn>-1&&(Yn.splice(Fn,1),en=Yn.length)}Xt++}Ge()}else nr=cancelAnimationFrame(nr)}return Ge}();function Xr(){if(document.hidden){for(var Ge=0,st=Yn.length;Ge<st;Ge++)activeInstance[Ge].pause();Gi=Yn.slice(0),Yn=[]}else for(var wt=0,en=Gi.length;wt<en;wt++)Gi[wt].play()}document.addEventListener("visibilitychange",Xr);function Fr(Ge){Ge===void 0&&(Ge={});var st=0,wt=0,en=0,Xt,En=0,Fn=null;function Ci(){return window.Promise&&new Promise(function(di){return Fn=di})}var vi=Ci(),An=Oi(Ge);function Ui(){An.reversed=!An.reversed;for(var di=0,Cr=Xt.length;di<Cr;di++)Xt[di].reversed=An.reversed}function Hi(di){return An.reversed?An.duration-di:di}function ir(){st=0,wt=Hi(An.currentTime)*(1/Fr.speed)}function us(di,Cr){Cr&&Cr.seek(di-Cr.timelineOffset)}function Tr(di){if(An.reversePlayback)for(var zs=En;zs--;)us(di,Xt[zs]);else for(var Cr=0;Cr<En;Cr++)us(di,Xt[Cr])}function pr(di){for(var Cr=0,zs=An.animations,zr=zs.length;Cr<zr;){var ie=zs[Cr],ce=ie.animatable,Ce=ie.tweens,_e=Ce.length-1,Xe=Ce[_e];_e&&(Xe=Se(Ce,function(gr){return di<gr.end})[0]||Xe);for(var At=L(di-Xe.start-Xe.delay,0,Xe.duration)/Xe.duration,It=isNaN(At)?1:Xe.easing(At),Sn=Xe.to.strings,vn=Xe.round,Lt=[],rn=Xe.to.numbers.length,Bn=void 0,fi=0;fi<rn;fi++){var Ii=void 0,Vi=Xe.to.numbers[fi],br=Xe.from.numbers[fi]||0;Xe.isPath?Ii=ae(Xe.value,It*Vi):Ii=br+It*(Vi-br),vn&&(Xe.isColor&&fi>2||(Ii=Math.round(Ii*vn)/vn)),Lt.push(Ii)}var ur=Sn.length;if(!ur)Bn=Lt[0];else{Bn=Sn[0];for(var er=0;er<ur;er++){Sn[er];var ys=Sn[er+1],Qr=Lt[er];isNaN(Qr)||(ys?Bn+=Qr+ys:Bn+=Qr+" ")}}Fs[ie.type](ce.target,ie.property,Bn,ce.transforms),ie.currentValue=Bn,Cr++}}function Pr(di){An[di]&&!An.passThrough&&An[di](An)}function Rs(){An.remaining&&An.remaining!==!0&&An.remaining--}function fa(di){var Cr=An.duration,zs=An.delay,zr=Cr-An.endDelay,ie=Hi(di);An.progress=L(ie/Cr*100,0,100),An.reversePlayback=ie<An.currentTime,Xt&&Tr(ie),!An.began&&An.currentTime>0&&(An.began=!0,Pr("begin"),Pr("loopBegin")),ie<=zs&&An.currentTime!==0&&pr(0),(ie>=zr&&An.currentTime!==Cr||!Cr)&&pr(Cr),ie>zs&&ie<zr?(An.changeBegan||(An.changeBegan=!0,An.changeCompleted=!1,Pr("changeBegin")),Pr("change"),pr(ie)):An.changeBegan&&(An.changeCompleted=!0,An.changeBegan=!1,Pr("changeComplete")),An.currentTime=L(ie,0,Cr),An.began&&Pr("update"),di>=Cr&&(wt=0,Rs(),An.remaining?(st=en,Pr("loopComplete"),Pr("loopBegin"),An.direction==="alternate"&&Ui()):(An.paused=!0,An.completed||(An.completed=!0,Pr("loopComplete"),Pr("complete"),"Promise"in window&&(Fn(),vi=Ci()))))}return An.reset=function(){var di=An.direction;An.passThrough=!1,An.currentTime=0,An.progress=0,An.paused=!0,An.began=!1,An.changeBegan=!1,An.completed=!1,An.changeCompleted=!1,An.reversePlayback=!1,An.reversed=di==="reverse",An.remaining=An.loop,Xt=An.children,En=Xt.length;for(var Cr=En;Cr--;)An.children[Cr].reset();(An.reversed&&An.loop!==!0||di==="alternate"&&An.loop===1)&&An.remaining++,pr(0)},An.set=function(di,Cr){return Vs(di,Cr),An},An.tick=function(di){en=di,st||(st=en),fa((en+(wt-st))*Fr.speed)},An.seek=function(di){fa(Hi(di))},An.pause=function(){An.paused=!0,ir()},An.play=function(){An.paused&&(An.paused=!1,Yn.push(An),ir(),nr||cr())},An.reverse=function(){Ui(),ir()},An.restart=function(){An.reset(),An.play()},An.finished=vi,An.reset(),An.autoplay&&An.play(),An}function $r(Ge,st){for(var wt=st.length;wt--;)pe(Ge,st[wt].animatable.target)&&st.splice(wt,1)}function ws(Ge){for(var st=ft(Ge),wt=Yn.length;wt--;){var en=Yn[wt],Xt=en.animations,En=en.children;$r(st,Xt);for(var Fn=En.length;Fn--;){var Ci=En[Fn],vi=Ci.animations;$r(st,vi),!vi.length&&!Ci.children.length&&En.splice(Fn,1)}!Xt.length&&!En.length&&en.pause()}}function vr(Ge,st){st===void 0&&(st={});var wt=st.direction||"normal",en=st.easing?oe(st.easing):null,Xt=st.grid,En=st.axis,Fn=st.from||0,Ci=Fn==="first",vi=Fn==="center",An=Fn==="last",Ui=_.arr(Ge),Hi=parseFloat(Ui?Ge[0]:Ge),ir=Ui?parseFloat(Ge[1]):0,us=gi(Ui?Ge[1]:Ge)||0,Tr=st.start||0+(Ui?Hi:0),pr=[],Pr=0;return function(Rs,fa,di){if(Ci&&(Fn=0),vi&&(Fn=(di-1)/2),An&&(Fn=di-1),!pr.length){for(var Cr=0;Cr<di;Cr++){if(!Xt)pr.push(Math.abs(Fn-Cr));else{var zs=vi?(Xt[0]-1)/2:Fn%Xt[0],zr=vi?(Xt[1]-1)/2:Math.floor(Fn/Xt[0]),ie=Cr%Xt[0],ce=Math.floor(Cr/Xt[0]),Ce=zs-ie,_e=zr-ce,Xe=Math.sqrt(Ce*Ce+_e*_e);En==="x"&&(Xe=-Ce),En==="y"&&(Xe=-_e),pr.push(Xe)}Pr=Math.max.apply(Math,pr)}en&&(pr=pr.map(function(It){return en(It/Pr)*Pr})),wt==="reverse"&&(pr=pr.map(function(It){return En?It<0?It*-1:-It:Math.abs(Pr-It)}))}var At=Ui?(ir-Hi)/Pr:Hi;return Tr+At*(Math.round(pr[fa]*100)/100)+us}}function As(Ge){Ge===void 0&&(Ge={});var st=Fr(Ge);return st.duration=0,st.add=function(wt,en){var Xt=Yn.indexOf(st),En=st.children;Xt>-1&&Yn.splice(Xt,1);function Fn(ir){ir.passThrough=!0}for(var Ci=0;Ci<En.length;Ci++)Fn(En[Ci]);var vi=Pe(wt,he(H,Ge));vi.targets=vi.targets||Ge.targets;var An=st.duration;vi.autoplay=!1,vi.direction=st.direction,vi.timelineOffset=_.und(en)?An:ui(en,An),Fn(st),st.seek(vi.timelineOffset);var Ui=Fr(vi);Fn(Ui),En.push(Ui);var Hi=hn(En,Ge);return st.delay=Hi.delay,st.endDelay=Hi.endDelay,st.duration=Hi.duration,st.seek(0),st.reset(),st.autoplay&&st.play(),st},st}Fr.version="3.0.0",Fr.speed=1,Fr.running=Yn,Fr.remove=ws,Fr.get=Dn,Fr.set=Vs,Fr.convertPx=Ot,Fr.path=ee,Fr.setDashoffset=Ct,Fr.stagger=vr,Fr.timeline=As,Fr.easing=oe,Fr.penner=q,Fr.random=function(Ge,st){return Math.floor(Math.random()*(st-Ge+1))+Ge};const vs=Fr},"./node_modules/three-bmfont-text/index.js":(Z,te,E)=>{var B=E("./node_modules/layout-bmfont-text/index.js");E("./node_modules/inherits/inherits_browser.js");var H=E("./node_modules/quad-indices/index.js"),C=E("./node_modules/three-buffer-vertex-data/index.js"),F=E("./node_modules/object-assign/index.js"),L=E("./node_modules/three-bmfont-text/lib/vertices.js"),M=E("./node_modules/three-bmfont-text/lib/utils.js");Z.exports=function(I){return new b(I)};class b extends THREE.BufferGeometry{constructor(I){super(),typeof I=="string"&&(I={text:I}),this._opt=F({},I),I&&this.update(I)}update(I){if(typeof I=="string"&&(I={text:I}),I=F({},this._opt,I),!I.font)throw new TypeError("must specify a { font } in options");this.layout=B(I);var O=I.flipY!==!1,_=I.font,D=_.common.scaleW,V=_.common.scaleH,J=this.layout.glyphs.filter(function(oe){var ve=oe.data;return ve.width*ve.height>0});this.visibleGlyphs=J;var Y=L.positions(J),W=L.uvs(J,D,V,O),U=H({clockwise:!0,type:"uint16",count:J.length});if(C.index(this,U,1,"uint16"),C.attr(this,"position",Y,2),C.attr(this,"uv",W,2),!I.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(I.multipage){var q=L.pages(J);C.attr(this,"page",q,1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var I=this.attributes.position.array,O=this.attributes.position.itemSize;if(!I||!O||I.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}M.computeSphere(I,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var I=this.boundingBox,O=this.attributes.position.array,_=this.attributes.position.itemSize;if(!O||!_||O.length<2){I.makeEmpty();return}M.computeBox(O,I)}}},"./node_modules/three-bmfont-text/lib/utils.js":Z=>{var te=2,E={min:[0,0],max:[0,0]};function B(H){var C=H.length/te;E.min[0]=H[0],E.min[1]=H[1],E.max[0]=H[0],E.max[1]=H[1];for(var F=0;F<C;F++){var L=H[F*te+0],M=H[F*te+1];E.min[0]=Math.min(L,E.min[0]),E.min[1]=Math.min(M,E.min[1]),E.max[0]=Math.max(L,E.max[0]),E.max[1]=Math.max(M,E.max[1])}}Z.exports.computeBox=function(H,C){B(H),C.min.set(E.min[0],E.min[1],0),C.max.set(E.max[0],E.max[1],0)},Z.exports.computeSphere=function(H,C){B(H);var F=E.min[0],L=E.min[1],M=E.max[0],b=E.max[1],S=M-F,I=b-L,O=Math.sqrt(S*S+I*I);C.center.set(F+S/2,L+I/2,0),C.radius=O/2}},"./node_modules/three-bmfont-text/lib/vertices.js":Z=>{Z.exports.pages=function(E){var B=new Float32Array(E.length*4*1),H=0;return E.forEach(function(C){var F=C.data.page||0;B[H++]=F,B[H++]=F,B[H++]=F,B[H++]=F}),B},Z.exports.uvs=function(E,B,H,C){var F=new Float32Array(E.length*4*2),L=0;return E.forEach(function(M){var b=M.data,S=b.x+b.width,I=b.y+b.height,O=b.x/B,_=b.y/H,D=S/B,V=I/H;C&&(_=(H-b.y)/H,V=(H-I)/H),F[L++]=O,F[L++]=_,F[L++]=O,F[L++]=V,F[L++]=D,F[L++]=V,F[L++]=D,F[L++]=_}),F},Z.exports.positions=function(E){var B=new Float32Array(E.length*4*2),H=0;return E.forEach(function(C){var F=C.data,L=C.position[0]+F.xoffset,M=C.position[1]+F.yoffset,b=F.width,S=F.height;B[H++]=L,B[H++]=M,B[H++]=L,B[H++]=M+S,B[H++]=L+b,B[H++]=M+S,B[H++]=L+b,B[H++]=M}),B}},"./node_modules/three-buffer-vertex-data/index.js":(Z,te,E)=>{var B=E("./node_modules/flatten-vertex-data/index.js");Z.exports.attr=C,Z.exports.index=H;function H(L,M,b,S){typeof b!="number"&&(b=1),typeof S!="string"&&(S="uint16");var I=!L.index&&typeof L.setIndex!="function",O=I?L.getAttribute("index"):L.index,_=F(O,M,b,S);_&&(I?L.addAttribute("index",_):L.index=_)}function C(L,M,b,S,I){if(typeof S!="number"&&(S=3),typeof I!="string"&&(I="float32"),Array.isArray(b)&&Array.isArray(b[0])&&b[0].length!==S)throw new Error("Nested vertex array has unexpected size; expected "+S+" but found "+b[0].length);var O=L.getAttribute(M),_=F(O,b,S,I);L.setAttribute(M,_)}function F(L,M,b,S){return M=M||[],M=B(M,S),L=new THREE.BufferAttribute(M,b),L.itemSize=b,L.needsUpdate=!0,L}},"./node_modules/webvr-polyfill/build/webvr-polyfill.js":function(Z,te,E){/**
 * @license
 * webvr-polyfill
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * webvr-polyfill-dpdb 
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(B,H){Z.exports=H()})(this,function(){var B=typeof window<"u"?window:typeof E.g<"u"?E.g:typeof self<"u"?self:{};function H(Y){return Y&&Y.__esModule&&Object.prototype.hasOwnProperty.call(Y,"default")?Y.default:Y}function C(Y,W){return W={exports:{}},Y(W,W.exports),W.exports}var F=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},L=function(W,U){for(var q=0,oe=W.length;q<oe;q++)U[q]=W[q]},M=function(W,U){for(var q in U)U.hasOwnProperty(q)&&(W[q]=U[q]);return W},b=C(function(Y,W){/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(U,q){Y.exports=q()})(B,function(){var U=function(ie,ce){if(!(ie instanceof ce))throw new TypeError("Cannot call a class as a function")},q=function(){function ie(ce,Ce){for(var _e=0;_e<Ce.length;_e++){var Xe=Ce[_e];Xe.enumerable=Xe.enumerable||!1,Xe.configurable=!0,"value"in Xe&&(Xe.writable=!0),Object.defineProperty(ce,Xe.key,Xe)}}return function(ce,Ce,_e){return Ce&&ie(ce.prototype,Ce),_e&&ie(ce,_e),ce}}(),oe=function(){function ie(ce,Ce){var _e=[],Xe=!0,At=!1,It=void 0;try{for(var Sn=ce[Symbol.iterator](),vn;!(Xe=(vn=Sn.next()).done)&&(_e.push(vn.value),!(Ce&&_e.length===Ce));Xe=!0);}catch(Lt){At=!0,It=Lt}finally{try{!Xe&&Sn.return&&Sn.return()}finally{if(At)throw It}}return _e}return function(ce,Ce){if(Array.isArray(ce))return ce;if(Symbol.iterator in Object(ce))return ie(ce,Ce);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ve=.001,Ae=1,Se=function(ce,Ce){return"data:"+ce+","+encodeURIComponent(Ce)},Ie=function(ce,Ce,_e){return ce+(Ce-ce)*_e},de=function(){var ie=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return ie}}(),pe=function(){var ie=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return ie}}(),we=function(){var ie=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return ie}}(),he=function(){var ie=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return ie}}(),Pe=function(){var ie=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),ce=ie?parseInt(ie[1],10):null;return function(){return ce}}(),Ve=function(){var ie=!1;return ie=de()&&we()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return ie}}(),ze=function(){var ie=!1;if(Pe()===65){var ce=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(ce){var Ce=ce[1].split("."),_e=oe(Ce,4);_e[0],_e[1];var Xe=_e[2],At=_e[3];ie=parseInt(Xe,10)===3325&&parseInt(At,10)<148}}return function(){return ie}}(),et=function(){var ie=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return ie}}(),Tt=function(){var ce=window.orientation==90||window.orientation==-90;return et()?!ce:ce},Rt=function(ce){return!(isNaN(ce)||ce<=ve||ce>Ae)},fn=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},cn=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Jn=function(ce){if(pe())return!1;if(ce.requestFullscreen)ce.requestFullscreen();else if(ce.webkitRequestFullscreen)ce.webkitRequestFullscreen();else if(ce.mozRequestFullScreen)ce.mozRequestFullScreen();else if(ce.msRequestFullscreen)ce.msRequestFullscreen();else return!1;return!0},yn=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},Wn=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},gi=function(ce,Ce,_e,Xe){var At=ce.createShader(ce.VERTEX_SHADER);ce.shaderSource(At,Ce),ce.compileShader(At);var It=ce.createShader(ce.FRAGMENT_SHADER);ce.shaderSource(It,_e),ce.compileShader(It);var Sn=ce.createProgram();ce.attachShader(Sn,At),ce.attachShader(Sn,It);for(var vn in Xe)ce.bindAttribLocation(Sn,Xe[vn],vn);return ce.linkProgram(Sn),ce.deleteShader(At),ce.deleteShader(It),Sn},ai=function(ce,Ce){for(var _e={},Xe=ce.getProgramParameter(Ce,ce.ACTIVE_UNIFORMS),At="",It=0;It<Xe;It++){var Sn=ce.getActiveUniform(Ce,It);At=Sn.name.replace("[0]",""),_e[At]=ce.getUniformLocation(Ce,At)}return _e},nt=function(ce,Ce,_e,Xe,At,It,Sn){var vn=1/(Ce-_e),Lt=1/(Xe-At),rn=1/(It-Sn);return ce[0]=-2*vn,ce[1]=0,ce[2]=0,ce[3]=0,ce[4]=0,ce[5]=-2*Lt,ce[6]=0,ce[7]=0,ce[8]=0,ce[9]=0,ce[10]=2*rn,ce[11]=0,ce[12]=(Ce+_e)*vn,ce[13]=(At+Xe)*Lt,ce[14]=(Sn+It)*rn,ce[15]=1,ce},dt=function(){var ce=!1;return function(Ce){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(Ce)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Ce.substr(0,4)))&&(ce=!0)}(navigator.userAgent||navigator.vendor||window.opera),ce},Ot=function(ce,Ce){for(var _e in Ce)Ce.hasOwnProperty(_e)&&(ce[_e]=Ce[_e]);return ce},$t=function(ce){if(de()){var Ce=ce.style.width,_e=ce.style.height;ce.style.width=parseInt(Ce)+1+"px",ce.style.height=parseInt(_e)+"px",setTimeout(function(){ce.style.width=Ce,ce.style.height=_e},100)}window.canvas=ce},Ye=function(){var ie=Math.PI/180,ce=Math.PI*.25;function Ce(Lt,rn,Bn,fi){var Ii=Math.tan(rn?rn.upDegrees*ie:ce),Vi=Math.tan(rn?rn.downDegrees*ie:ce),br=Math.tan(rn?rn.leftDegrees*ie:ce),ur=Math.tan(rn?rn.rightDegrees*ie:ce),er=2/(br+ur),ys=2/(Ii+Vi);return Lt[0]=er,Lt[1]=0,Lt[2]=0,Lt[3]=0,Lt[4]=0,Lt[5]=ys,Lt[6]=0,Lt[7]=0,Lt[8]=-((br-ur)*er*.5),Lt[9]=(Ii-Vi)*ys*.5,Lt[10]=fi/(Bn-fi),Lt[11]=-1,Lt[12]=0,Lt[13]=0,Lt[14]=fi*Bn/(Bn-fi),Lt[15]=0,Lt}function _e(Lt,rn,Bn){var fi=rn[0],Ii=rn[1],Vi=rn[2],br=rn[3],ur=fi+fi,er=Ii+Ii,ys=Vi+Vi,Qr=fi*ur,gr=fi*er,Is=fi*ys,Ys=Ii*er,Ps=Ii*ys,Ua=Vi*ys,Va=br*ur,Bs=br*er,no=br*ys;return Lt[0]=1-(Ys+Ua),Lt[1]=gr+no,Lt[2]=Is-Bs,Lt[3]=0,Lt[4]=gr-no,Lt[5]=1-(Qr+Ua),Lt[6]=Ps+Va,Lt[7]=0,Lt[8]=Is+Bs,Lt[9]=Ps-Va,Lt[10]=1-(Qr+Ys),Lt[11]=0,Lt[12]=Bn[0],Lt[13]=Bn[1],Lt[14]=Bn[2],Lt[15]=1,Lt}function Xe(Lt,rn,Bn){var fi=Bn[0],Ii=Bn[1],Vi=Bn[2],br,ur,er,ys,Qr,gr,Is,Ys,Ps,Ua,Va,Bs;return rn===Lt?(Lt[12]=rn[0]*fi+rn[4]*Ii+rn[8]*Vi+rn[12],Lt[13]=rn[1]*fi+rn[5]*Ii+rn[9]*Vi+rn[13],Lt[14]=rn[2]*fi+rn[6]*Ii+rn[10]*Vi+rn[14],Lt[15]=rn[3]*fi+rn[7]*Ii+rn[11]*Vi+rn[15]):(br=rn[0],ur=rn[1],er=rn[2],ys=rn[3],Qr=rn[4],gr=rn[5],Is=rn[6],Ys=rn[7],Ps=rn[8],Ua=rn[9],Va=rn[10],Bs=rn[11],Lt[0]=br,Lt[1]=ur,Lt[2]=er,Lt[3]=ys,Lt[4]=Qr,Lt[5]=gr,Lt[6]=Is,Lt[7]=Ys,Lt[8]=Ps,Lt[9]=Ua,Lt[10]=Va,Lt[11]=Bs,Lt[12]=br*fi+Qr*Ii+Ps*Vi+rn[12],Lt[13]=ur*fi+gr*Ii+Ua*Vi+rn[13],Lt[14]=er*fi+Is*Ii+Va*Vi+rn[14],Lt[15]=ys*fi+Ys*Ii+Bs*Vi+rn[15]),Lt}function At(Lt,rn){var Bn=rn[0],fi=rn[1],Ii=rn[2],Vi=rn[3],br=rn[4],ur=rn[5],er=rn[6],ys=rn[7],Qr=rn[8],gr=rn[9],Is=rn[10],Ys=rn[11],Ps=rn[12],Ua=rn[13],Va=rn[14],Bs=rn[15],no=Bn*ur-fi*br,Tl=Bn*er-Ii*br,Fo=Bn*ys-Vi*br,dl=fi*er-Ii*ur,Ml=fi*ys-Vi*ur,pl=Ii*ys-Vi*er,fc=Qr*Ua-gr*Ps,fl=Qr*Va-Is*Ps,_l=Qr*Bs-Ys*Ps,Rl=gr*Va-Is*Ua,$l=gr*Bs-Ys*Ua,jl=Is*Bs-Ys*Va,Js=no*jl-Tl*$l+Fo*Rl+dl*_l-Ml*fl+pl*fc;return Js?(Js=1/Js,Lt[0]=(ur*jl-er*$l+ys*Rl)*Js,Lt[1]=(Ii*$l-fi*jl-Vi*Rl)*Js,Lt[2]=(Ua*pl-Va*Ml+Bs*dl)*Js,Lt[3]=(Is*Ml-gr*pl-Ys*dl)*Js,Lt[4]=(er*_l-br*jl-ys*fl)*Js,Lt[5]=(Bn*jl-Ii*_l+Vi*fl)*Js,Lt[6]=(Va*Fo-Ps*pl-Bs*Tl)*Js,Lt[7]=(Qr*pl-Is*Fo+Ys*Tl)*Js,Lt[8]=(br*$l-ur*_l+ys*fc)*Js,Lt[9]=(fi*_l-Bn*$l-Vi*fc)*Js,Lt[10]=(Ps*Ml-Ua*Fo+Bs*no)*Js,Lt[11]=(gr*Fo-Qr*Ml-Ys*no)*Js,Lt[12]=(ur*fl-br*Rl-er*fc)*Js,Lt[13]=(Bn*Rl-fi*fl+Ii*fc)*Js,Lt[14]=(Ua*Tl-Ps*dl-Va*no)*Js,Lt[15]=(Qr*dl-gr*Tl+Is*no)*Js,Lt):null}var It=new Float32Array([0,0,0,1]),Sn=new Float32Array([0,0,0]);function vn(Lt,rn,Bn,fi,Ii,Vi){Ce(Lt,fi||null,Vi.depthNear,Vi.depthFar);var br=Bn.orientation||It,ur=Bn.position||Sn;_e(rn,br,ur),Ii&&Xe(rn,rn,Ii),At(rn,rn)}return function(Lt,rn,Bn){return!Lt||!rn?!1:(Lt.pose=rn,Lt.timestamp=rn.timestamp,vn(Lt.leftProjectionMatrix,Lt.leftViewMatrix,rn,Bn._getFieldOfView("left"),Bn._getEyeOffset("left"),Bn),vn(Lt.rightProjectionMatrix,Lt.rightViewMatrix,rn,Bn._getFieldOfView("right"),Bn._getEyeOffset("right"),Bn),!0)}}(),mn=function(){var ce=window.self!==window.top,Ce=Pn(document.referrer),_e=Pn(window.location.href);return ce&&Ce!==_e},Pn=function(ce){var Ce,_e=ce.indexOf("://");_e!==-1?Ce=_e+3:Ce=0;var Xe=ce.indexOf("/",Ce);return Xe===-1&&(Xe=ce.length),ce.substring(0,Xe)},wn=function(ce){if(ce.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var Ce=2*Math.acos(ce.w);return Ce},Dn=function(){var ie={};return function(ce,Ce){ie[ce]===void 0&&(console.warn("webvr-polyfill: "+Ce),ie[ce]=!0)}}(),gn=function(ce,Ce){var _e=Ce?"Please use "+Ce+" instead.":"";Dn(ce,ce+" has been deprecated. This may not work on native WebVR displays. "+_e)};function ui(ie,ce,Ce){if(!ce){Ce(ie);return}for(var _e=[],Xe=null,At=0;At<ce.length;++At){var It=ce[At];switch(It){case ie.TEXTURE_BINDING_2D:case ie.TEXTURE_BINDING_CUBE_MAP:var Sn=ce[++At];if(Sn<ie.TEXTURE0||Sn>ie.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),_e.push(null,null);break}Xe||(Xe=ie.getParameter(ie.ACTIVE_TEXTURE)),ie.activeTexture(Sn),_e.push(ie.getParameter(It),null);break;case ie.ACTIVE_TEXTURE:Xe=ie.getParameter(ie.ACTIVE_TEXTURE),_e.push(null);break;default:_e.push(ie.getParameter(It));break}}Ce(ie);for(var At=0;At<ce.length;++At){var It=ce[At],vn=_e[At];switch(It){case ie.ACTIVE_TEXTURE:break;case ie.ARRAY_BUFFER_BINDING:ie.bindBuffer(ie.ARRAY_BUFFER,vn);break;case ie.COLOR_CLEAR_VALUE:ie.clearColor(vn[0],vn[1],vn[2],vn[3]);break;case ie.COLOR_WRITEMASK:ie.colorMask(vn[0],vn[1],vn[2],vn[3]);break;case ie.CURRENT_PROGRAM:ie.useProgram(vn);break;case ie.ELEMENT_ARRAY_BUFFER_BINDING:ie.bindBuffer(ie.ELEMENT_ARRAY_BUFFER,vn);break;case ie.FRAMEBUFFER_BINDING:ie.bindFramebuffer(ie.FRAMEBUFFER,vn);break;case ie.RENDERBUFFER_BINDING:ie.bindRenderbuffer(ie.RENDERBUFFER,vn);break;case ie.TEXTURE_BINDING_2D:var Sn=ce[++At];if(Sn<ie.TEXTURE0||Sn>ie.TEXTURE31)break;ie.activeTexture(Sn),ie.bindTexture(ie.TEXTURE_2D,vn);break;case ie.TEXTURE_BINDING_CUBE_MAP:var Sn=ce[++At];if(Sn<ie.TEXTURE0||Sn>ie.TEXTURE31)break;ie.activeTexture(Sn),ie.bindTexture(ie.TEXTURE_CUBE_MAP,vn);break;case ie.VIEWPORT:ie.viewport(vn[0],vn[1],vn[2],vn[3]);break;case ie.BLEND:case ie.CULL_FACE:case ie.DEPTH_TEST:case ie.SCISSOR_TEST:case ie.STENCIL_TEST:vn?ie.enable(It):ie.disable(It);break;default:console.log("No GL restore behavior for 0x"+It.toString(16));break}Xe&&ie.activeTexture(Xe)}}var Nt=ui,De=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Re=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function We(ie,ce,Ce,_e){this.gl=ie,this.cardboardUI=ce,this.bufferScale=Ce,this.dirtySubmitFrameBindings=_e,this.ctxAttribs=ie.getContextAttributes(),this.instanceExt=ie.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=ie.drawingBufferWidth,this.bufferHeight=ie.drawingBufferHeight,this.realBindFramebuffer=ie.bindFramebuffer,this.realEnable=ie.enable,this.realDisable=ie.disable,this.realColorMask=ie.colorMask,this.realClearColor=ie.clearColor,this.realViewport=ie.viewport,de()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(ie.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(ie.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=gi(ie,De,Re,this.attribs),this.uniforms=ai(ie,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=ie.createBuffer(),this.indexBuffer=ie.createBuffer(),this.indexCount=0,this.renderTarget=ie.createTexture(),this.framebuffer=ie.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=ie.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=ie.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=ie.createRenderbuffer()),this.patch(),this.onResize()}We.prototype.destroy=function(){var ie=this.gl;this.unpatch(),ie.deleteProgram(this.program),ie.deleteBuffer(this.vertexBuffer),ie.deleteBuffer(this.indexBuffer),ie.deleteTexture(this.renderTarget),ie.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&ie.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&ie.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&ie.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},We.prototype.onResize=function(){var ie=this.gl,ce=this,Ce=[ie.RENDERBUFFER_BINDING,ie.TEXTURE_BINDING_2D,ie.TEXTURE0];Nt(ie,Ce,function(_e){ce.realBindFramebuffer.call(_e,_e.FRAMEBUFFER,null),ce.scissorTest&&ce.realDisable.call(_e,_e.SCISSOR_TEST),ce.realColorMask.call(_e,!0,!0,!0,!0),ce.realViewport.call(_e,0,0,_e.drawingBufferWidth,_e.drawingBufferHeight),ce.realClearColor.call(_e,0,0,0,1),_e.clear(_e.COLOR_BUFFER_BIT),ce.realBindFramebuffer.call(_e,_e.FRAMEBUFFER,ce.framebuffer),_e.bindTexture(_e.TEXTURE_2D,ce.renderTarget),_e.texImage2D(_e.TEXTURE_2D,0,ce.ctxAttribs.alpha?_e.RGBA:_e.RGB,ce.bufferWidth,ce.bufferHeight,0,ce.ctxAttribs.alpha?_e.RGBA:_e.RGB,_e.UNSIGNED_BYTE,null),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_2D,ce.renderTarget,0),ce.ctxAttribs.depth&&ce.ctxAttribs.stencil?(_e.bindRenderbuffer(_e.RENDERBUFFER,ce.depthStencilBuffer),_e.renderbufferStorage(_e.RENDERBUFFER,_e.DEPTH_STENCIL,ce.bufferWidth,ce.bufferHeight),_e.framebufferRenderbuffer(_e.FRAMEBUFFER,_e.DEPTH_STENCIL_ATTACHMENT,_e.RENDERBUFFER,ce.depthStencilBuffer)):ce.ctxAttribs.depth?(_e.bindRenderbuffer(_e.RENDERBUFFER,ce.depthBuffer),_e.renderbufferStorage(_e.RENDERBUFFER,_e.DEPTH_COMPONENT16,ce.bufferWidth,ce.bufferHeight),_e.framebufferRenderbuffer(_e.FRAMEBUFFER,_e.DEPTH_ATTACHMENT,_e.RENDERBUFFER,ce.depthBuffer)):ce.ctxAttribs.stencil&&(_e.bindRenderbuffer(_e.RENDERBUFFER,ce.stencilBuffer),_e.renderbufferStorage(_e.RENDERBUFFER,_e.STENCIL_INDEX8,ce.bufferWidth,ce.bufferHeight),_e.framebufferRenderbuffer(_e.FRAMEBUFFER,_e.STENCIL_ATTACHMENT,_e.RENDERBUFFER,ce.stencilBuffer)),!_e.checkFramebufferStatus(_e.FRAMEBUFFER)===_e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),ce.realBindFramebuffer.call(_e,_e.FRAMEBUFFER,ce.lastBoundFramebuffer),ce.scissorTest&&ce.realEnable.call(_e,_e.SCISSOR_TEST),ce.realColorMask.apply(_e,ce.colorMask),ce.realViewport.apply(_e,ce.viewport),ce.realClearColor.apply(_e,ce.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},We.prototype.patch=function(){if(!this.isPatched){var ie=this,ce=this.gl.canvas,Ce=this.gl;de()||(ce.width=fn()*this.bufferScale,ce.height=cn()*this.bufferScale,Object.defineProperty(ce,"width",{configurable:!0,enumerable:!0,get:function(){return ie.bufferWidth},set:function(Xe){ie.bufferWidth=Xe,ie.realCanvasWidth.set.call(ce,Xe),ie.onResize()}}),Object.defineProperty(ce,"height",{configurable:!0,enumerable:!0,get:function(){return ie.bufferHeight},set:function(Xe){ie.bufferHeight=Xe,ie.realCanvasHeight.set.call(ce,Xe),ie.onResize()}})),this.lastBoundFramebuffer=Ce.getParameter(Ce.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(Ce.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(_e,Xe){ie.lastBoundFramebuffer=Xe||ie.framebuffer,ie.realBindFramebuffer.call(Ce,_e,ie.lastBoundFramebuffer)},this.cullFace=Ce.getParameter(Ce.CULL_FACE),this.depthTest=Ce.getParameter(Ce.DEPTH_TEST),this.blend=Ce.getParameter(Ce.BLEND),this.scissorTest=Ce.getParameter(Ce.SCISSOR_TEST),this.stencilTest=Ce.getParameter(Ce.STENCIL_TEST),Ce.enable=function(_e){switch(_e){case Ce.CULL_FACE:ie.cullFace=!0;break;case Ce.DEPTH_TEST:ie.depthTest=!0;break;case Ce.BLEND:ie.blend=!0;break;case Ce.SCISSOR_TEST:ie.scissorTest=!0;break;case Ce.STENCIL_TEST:ie.stencilTest=!0;break}ie.realEnable.call(Ce,_e)},Ce.disable=function(_e){switch(_e){case Ce.CULL_FACE:ie.cullFace=!1;break;case Ce.DEPTH_TEST:ie.depthTest=!1;break;case Ce.BLEND:ie.blend=!1;break;case Ce.SCISSOR_TEST:ie.scissorTest=!1;break;case Ce.STENCIL_TEST:ie.stencilTest=!1;break}ie.realDisable.call(Ce,_e)},this.colorMask=Ce.getParameter(Ce.COLOR_WRITEMASK),Ce.colorMask=function(_e,Xe,At,It){ie.colorMask[0]=_e,ie.colorMask[1]=Xe,ie.colorMask[2]=At,ie.colorMask[3]=It,ie.realColorMask.call(Ce,_e,Xe,At,It)},this.clearColor=Ce.getParameter(Ce.COLOR_CLEAR_VALUE),Ce.clearColor=function(_e,Xe,At,It){ie.clearColor[0]=_e,ie.clearColor[1]=Xe,ie.clearColor[2]=At,ie.clearColor[3]=It,ie.realClearColor.call(Ce,_e,Xe,At,It)},this.viewport=Ce.getParameter(Ce.VIEWPORT),Ce.viewport=function(_e,Xe,At,It){ie.viewport[0]=_e,ie.viewport[1]=Xe,ie.viewport[2]=At,ie.viewport[3]=It,ie.realViewport.call(Ce,_e,Xe,At,It)},this.isPatched=!0,$t(ce)}},We.prototype.unpatch=function(){if(this.isPatched){var ie=this.gl,ce=this.gl.canvas;de()||(Object.defineProperty(ce,"width",this.realCanvasWidth),Object.defineProperty(ce,"height",this.realCanvasHeight)),ce.width=this.bufferWidth,ce.height=this.bufferHeight,ie.bindFramebuffer=this.realBindFramebuffer,ie.enable=this.realEnable,ie.disable=this.realDisable,ie.colorMask=this.realColorMask,ie.clearColor=this.realClearColor,ie.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&ie.bindFramebuffer(ie.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){$t(ce)},1)}},We.prototype.setTextureBounds=function(ie,ce){ie||(ie=[0,0,.5,1]),ce||(ce=[.5,0,.5,1]),this.viewportOffsetScale[0]=ie[0],this.viewportOffsetScale[1]=ie[1],this.viewportOffsetScale[2]=ie[2],this.viewportOffsetScale[3]=ie[3],this.viewportOffsetScale[4]=ce[0],this.viewportOffsetScale[5]=ce[1],this.viewportOffsetScale[6]=ce[2],this.viewportOffsetScale[7]=ce[3]},We.prototype.submitFrame=function(){var ie=this.gl,ce=this,Ce=[];if(this.dirtySubmitFrameBindings||Ce.push(ie.CURRENT_PROGRAM,ie.ARRAY_BUFFER_BINDING,ie.ELEMENT_ARRAY_BUFFER_BINDING,ie.TEXTURE_BINDING_2D,ie.TEXTURE0),Nt(ie,Ce,function(Xe){ce.realBindFramebuffer.call(Xe,Xe.FRAMEBUFFER,null);var At=0,It=0;ce.instanceExt&&(At=Xe.getVertexAttrib(ce.attribs.position,ce.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),It=Xe.getVertexAttrib(ce.attribs.texCoord,ce.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),ce.cullFace&&ce.realDisable.call(Xe,Xe.CULL_FACE),ce.depthTest&&ce.realDisable.call(Xe,Xe.DEPTH_TEST),ce.blend&&ce.realDisable.call(Xe,Xe.BLEND),ce.scissorTest&&ce.realDisable.call(Xe,Xe.SCISSOR_TEST),ce.stencilTest&&ce.realDisable.call(Xe,Xe.STENCIL_TEST),ce.realColorMask.call(Xe,!0,!0,!0,!0),ce.realViewport.call(Xe,0,0,Xe.drawingBufferWidth,Xe.drawingBufferHeight),(ce.ctxAttribs.alpha||de())&&(ce.realClearColor.call(Xe,0,0,0,1),Xe.clear(Xe.COLOR_BUFFER_BIT)),Xe.useProgram(ce.program),Xe.bindBuffer(Xe.ELEMENT_ARRAY_BUFFER,ce.indexBuffer),Xe.bindBuffer(Xe.ARRAY_BUFFER,ce.vertexBuffer),Xe.enableVertexAttribArray(ce.attribs.position),Xe.enableVertexAttribArray(ce.attribs.texCoord),Xe.vertexAttribPointer(ce.attribs.position,2,Xe.FLOAT,!1,20,0),Xe.vertexAttribPointer(ce.attribs.texCoord,3,Xe.FLOAT,!1,20,8),ce.instanceExt&&(At!=0&&ce.instanceExt.vertexAttribDivisorANGLE(ce.attribs.position,0),It!=0&&ce.instanceExt.vertexAttribDivisorANGLE(ce.attribs.texCoord,0)),Xe.activeTexture(Xe.TEXTURE0),Xe.uniform1i(ce.uniforms.diffuse,0),Xe.bindTexture(Xe.TEXTURE_2D,ce.renderTarget),Xe.uniform4fv(ce.uniforms.viewportOffsetScale,ce.viewportOffsetScale),Xe.drawElements(Xe.TRIANGLES,ce.indexCount,Xe.UNSIGNED_SHORT,0),ce.cardboardUI&&ce.cardboardUI.renderNoState(),ce.realBindFramebuffer.call(ce.gl,Xe.FRAMEBUFFER,ce.framebuffer),ce.ctxAttribs.preserveDrawingBuffer||(ce.realClearColor.call(Xe,0,0,0,0),Xe.clear(Xe.COLOR_BUFFER_BIT)),ce.dirtySubmitFrameBindings||ce.realBindFramebuffer.call(Xe,Xe.FRAMEBUFFER,ce.lastBoundFramebuffer),ce.cullFace&&ce.realEnable.call(Xe,Xe.CULL_FACE),ce.depthTest&&ce.realEnable.call(Xe,Xe.DEPTH_TEST),ce.blend&&ce.realEnable.call(Xe,Xe.BLEND),ce.scissorTest&&ce.realEnable.call(Xe,Xe.SCISSOR_TEST),ce.stencilTest&&ce.realEnable.call(Xe,Xe.STENCIL_TEST),ce.realColorMask.apply(Xe,ce.colorMask),ce.realViewport.apply(Xe,ce.viewport),(ce.ctxAttribs.alpha||!ce.ctxAttribs.preserveDrawingBuffer)&&ce.realClearColor.apply(Xe,ce.clearColor),ce.instanceExt&&(At!=0&&ce.instanceExt.vertexAttribDivisorANGLE(ce.attribs.position,At),It!=0&&ce.instanceExt.vertexAttribDivisorANGLE(ce.attribs.texCoord,It))}),de()){var _e=ie.canvas;(_e.width!=ce.bufferWidth||_e.height!=ce.bufferHeight)&&(ce.bufferWidth=_e.width,ce.bufferHeight=_e.height,ce.onResize())}},We.prototype.updateDeviceInfo=function(ie){var ce=this.gl,Ce=this,_e=[ce.ARRAY_BUFFER_BINDING,ce.ELEMENT_ARRAY_BUFFER_BINDING];Nt(ce,_e,function(Xe){var At=Ce.computeMeshVertices_(Ce.meshWidth,Ce.meshHeight,ie);if(Xe.bindBuffer(Xe.ARRAY_BUFFER,Ce.vertexBuffer),Xe.bufferData(Xe.ARRAY_BUFFER,At,Xe.STATIC_DRAW),!Ce.indexCount){var It=Ce.computeMeshIndices_(Ce.meshWidth,Ce.meshHeight);Xe.bindBuffer(Xe.ELEMENT_ARRAY_BUFFER,Ce.indexBuffer),Xe.bufferData(Xe.ELEMENT_ARRAY_BUFFER,It,Xe.STATIC_DRAW),Ce.indexCount=It.length}})},We.prototype.computeMeshVertices_=function(ie,ce,Ce){for(var _e=new Float32Array(2*ie*ce*5),Xe=Ce.getLeftEyeVisibleTanAngles(),At=Ce.getLeftEyeNoLensTanAngles(),It=Ce.getLeftEyeVisibleScreenRect(At),Sn=0,vn=0;vn<2;vn++){for(var Lt=0;Lt<ce;Lt++)for(var rn=0;rn<ie;rn++,Sn++){var Bn=rn/(ie-1),fi=Lt/(ce-1),Ii=Bn,Vi=fi,br=Ie(Xe[0],Xe[2],Bn),ur=Ie(Xe[3],Xe[1],fi),er=Math.sqrt(br*br+ur*ur),ys=Ce.distortion.distortInverse(er),Qr=br*ys/er,gr=ur*ys/er;Bn=(Qr-At[0])/(At[2]-At[0]),fi=(gr-At[3])/(At[1]-At[3]),Bn=(It.x+Bn*It.width-.5)*2,fi=(It.y+fi*It.height-.5)*2,_e[Sn*5+0]=Bn,_e[Sn*5+1]=fi,_e[Sn*5+2]=Ii,_e[Sn*5+3]=Vi,_e[Sn*5+4]=vn}var Is=Xe[2]-Xe[0];Xe[0]=-(Is+Xe[0]),Xe[2]=Is-Xe[2],Is=At[2]-At[0],At[0]=-(Is+At[0]),At[2]=Is-At[2],It.x=1-(It.x+It.width)}return _e},We.prototype.computeMeshIndices_=function(ie,ce){for(var Ce=new Uint16Array(2*(ie-1)*(ce-1)*6),_e=ie/2,Xe=ce/2,At=0,It=0,Sn=0;Sn<2;Sn++)for(var vn=0;vn<ce;vn++)for(var Lt=0;Lt<ie;Lt++,At++)Lt==0||vn==0||(Lt<=_e==vn<=Xe?(Ce[It++]=At,Ce[It++]=At-ie-1,Ce[It++]=At-ie,Ce[It++]=At-ie-1,Ce[It++]=At,Ce[It++]=At-1):(Ce[It++]=At-1,Ce[It++]=At-ie,Ce[It++]=At,Ce[It++]=At-ie,Ce[It++]=At-1,Ce[It++]=At-ie-1));return Ce},We.prototype.getOwnPropertyDescriptor_=function(ie,ce){var Ce=Object.getOwnPropertyDescriptor(ie,ce);return(Ce.get===void 0||Ce.set===void 0)&&(Ce.configurable=!0,Ce.enumerable=!0,Ce.get=function(){return this.getAttribute(ce)},Ce.set=function(_e){this.setAttribute(ce,_e)}),Ce};var Oe=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Qe=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Ke=Math.PI/180,vt=60,ct=12,Ct=20,Yt=1,me=.75,ee=.3125,ae=4,Ue=28,ht=1.5;function ft(ie){this.gl=ie,this.attribs={position:0},this.program=gi(ie,Oe,Qe,this.attribs),this.uniforms=ai(ie,this.program),this.vertexBuffer=ie.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}ft.prototype.destroy=function(){var ie=this.gl;this.listener&&ie.canvas.removeEventListener("click",this.listener,!1),ie.deleteProgram(this.program),ie.deleteBuffer(this.vertexBuffer)},ft.prototype.listen=function(ie,ce){var Ce=this.gl.canvas;this.listener=function(_e){var Xe=Ce.clientWidth/2,At=Ue*ht;_e.clientX>Xe-At&&_e.clientX<Xe+At&&_e.clientY>Ce.clientHeight-At?ie(_e):_e.clientX<At&&_e.clientY<At&&ce(_e)},Ce.addEventListener("click",this.listener,!1)},ft.prototype.onResize=function(){var ie=this.gl,ce=this,Ce=[ie.ARRAY_BUFFER_BINDING];Nt(ie,Ce,function(_e){var Xe=[],At=_e.drawingBufferWidth/2,It=Math.max(screen.width,screen.height)*window.devicePixelRatio,Sn=_e.drawingBufferWidth/It,vn=Sn*window.devicePixelRatio,Lt=ae*vn/2,rn=Ue*ht*vn,Bn=Ue*vn/2,fi=(Ue*ht-Ue)*vn;Xe.push(At-Lt,rn),Xe.push(At-Lt,_e.drawingBufferHeight),Xe.push(At+Lt,rn),Xe.push(At+Lt,_e.drawingBufferHeight),ce.gearOffset=Xe.length/2;function Ii(ys,Qr){var gr=(90-ys)*Ke,Is=Math.cos(gr),Ys=Math.sin(gr);Xe.push(ee*Is*Bn+At,ee*Ys*Bn+Bn),Xe.push(Qr*Is*Bn+At,Qr*Ys*Bn+Bn)}for(var Vi=0;Vi<=6;Vi++){var br=Vi*vt;Ii(br,Yt),Ii(br+ct,Yt),Ii(br+Ct,me),Ii(br+(vt-Ct),me),Ii(br+(vt-ct),Yt)}ce.gearVertexCount=Xe.length/2-ce.gearOffset,ce.arrowOffset=Xe.length/2;function ur(ys,Qr){Xe.push(fi+ys,_e.drawingBufferHeight-fi-Qr)}var er=Lt/Math.sin(45*Ke);ur(0,Bn),ur(Bn,0),ur(Bn+er,er),ur(er,Bn+er),ur(er,Bn-er),ur(0,Bn),ur(Bn,Bn*2),ur(Bn+er,Bn*2-er),ur(er,Bn-er),ur(0,Bn),ur(er,Bn-Lt),ur(Ue*vn,Bn-Lt),ur(er,Bn+Lt),ur(Ue*vn,Bn+Lt),ce.arrowVertexCount=Xe.length/2-ce.arrowOffset,_e.bindBuffer(_e.ARRAY_BUFFER,ce.vertexBuffer),_e.bufferData(_e.ARRAY_BUFFER,new Float32Array(Xe),_e.STATIC_DRAW)})},ft.prototype.render=function(){var ie=this.gl,ce=this,Ce=[ie.CULL_FACE,ie.DEPTH_TEST,ie.BLEND,ie.SCISSOR_TEST,ie.STENCIL_TEST,ie.COLOR_WRITEMASK,ie.VIEWPORT,ie.CURRENT_PROGRAM,ie.ARRAY_BUFFER_BINDING];Nt(ie,Ce,function(_e){_e.disable(_e.CULL_FACE),_e.disable(_e.DEPTH_TEST),_e.disable(_e.BLEND),_e.disable(_e.SCISSOR_TEST),_e.disable(_e.STENCIL_TEST),_e.colorMask(!0,!0,!0,!0),_e.viewport(0,0,_e.drawingBufferWidth,_e.drawingBufferHeight),ce.renderNoState()})},ft.prototype.renderNoState=function(){var ie=this.gl;ie.useProgram(this.program),ie.bindBuffer(ie.ARRAY_BUFFER,this.vertexBuffer),ie.enableVertexAttribArray(this.attribs.position),ie.vertexAttribPointer(this.attribs.position,2,ie.FLOAT,!1,8,0),ie.uniform4f(this.uniforms.color,1,1,1,1),nt(this.projMat,0,ie.drawingBufferWidth,0,ie.drawingBufferHeight,.1,1024),ie.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),ie.drawArrays(ie.TRIANGLE_STRIP,0,4),ie.drawArrays(ie.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),ie.drawArrays(ie.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ft(ie){this.coefficients=ie}Ft.prototype.distortInverse=function(ie){for(var ce=0,Ce=1,_e=ie-this.distort(ce);Math.abs(Ce-ce)>1e-4;){var Xe=ie-this.distort(Ce),At=Ce-Xe*((Ce-ce)/(Xe-_e));ce=Ce,Ce=At,_e=Xe}return Ce},Ft.prototype.distort=function(ie){for(var ce=ie*ie,Ce=0,_e=0;_e<this.coefficients.length;_e++)Ce=ce*(Ce+this.coefficients[_e]);return(Ce+1)*ie};var hi=Math.PI/180,bi=180/Math.PI,ri=function(ce,Ce,_e){this.x=ce||0,this.y=Ce||0,this.z=_e||0};ri.prototype={constructor:ri,set:function(ce,Ce,_e){return this.x=ce,this.y=Ce,this.z=_e,this},copy:function(ce){return this.x=ce.x,this.y=ce.y,this.z=ce.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var ce=this.length();if(ce!==0){var Ce=1/ce;this.multiplyScalar(Ce)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(ce){this.x*=ce,this.y*=ce,this.z*=ce},applyQuaternion:function(ce){var Ce=this.x,_e=this.y,Xe=this.z,At=ce.x,It=ce.y,Sn=ce.z,vn=ce.w,Lt=vn*Ce+It*Xe-Sn*_e,rn=vn*_e+Sn*Ce-At*Xe,Bn=vn*Xe+At*_e-It*Ce,fi=-At*Ce-It*_e-Sn*Xe;return this.x=Lt*vn+fi*-At+rn*-Sn-Bn*-It,this.y=rn*vn+fi*-It+Bn*-At-Lt*-Sn,this.z=Bn*vn+fi*-Sn+Lt*-It-rn*-At,this},dot:function(ce){return this.x*ce.x+this.y*ce.y+this.z*ce.z},crossVectors:function(ce,Ce){var _e=ce.x,Xe=ce.y,At=ce.z,It=Ce.x,Sn=Ce.y,vn=Ce.z;return this.x=Xe*vn-At*Sn,this.y=At*It-_e*vn,this.z=_e*Sn-Xe*It,this}};var Ai=function(ce,Ce,_e,Xe){this.x=ce||0,this.y=Ce||0,this.z=_e||0,this.w=Xe!==void 0?Xe:1};Ai.prototype={constructor:Ai,set:function(ce,Ce,_e,Xe){return this.x=ce,this.y=Ce,this.z=_e,this.w=Xe,this},copy:function(ce){return this.x=ce.x,this.y=ce.y,this.z=ce.z,this.w=ce.w,this},setFromEulerXYZ:function(ce,Ce,_e){var Xe=Math.cos(ce/2),At=Math.cos(Ce/2),It=Math.cos(_e/2),Sn=Math.sin(ce/2),vn=Math.sin(Ce/2),Lt=Math.sin(_e/2);return this.x=Sn*At*It+Xe*vn*Lt,this.y=Xe*vn*It-Sn*At*Lt,this.z=Xe*At*Lt+Sn*vn*It,this.w=Xe*At*It-Sn*vn*Lt,this},setFromEulerYXZ:function(ce,Ce,_e){var Xe=Math.cos(ce/2),At=Math.cos(Ce/2),It=Math.cos(_e/2),Sn=Math.sin(ce/2),vn=Math.sin(Ce/2),Lt=Math.sin(_e/2);return this.x=Sn*At*It+Xe*vn*Lt,this.y=Xe*vn*It-Sn*At*Lt,this.z=Xe*At*Lt-Sn*vn*It,this.w=Xe*At*It+Sn*vn*Lt,this},setFromAxisAngle:function(ce,Ce){var _e=Ce/2,Xe=Math.sin(_e);return this.x=ce.x*Xe,this.y=ce.y*Xe,this.z=ce.z*Xe,this.w=Math.cos(_e),this},multiply:function(ce){return this.multiplyQuaternions(this,ce)},multiplyQuaternions:function(ce,Ce){var _e=ce.x,Xe=ce.y,At=ce.z,It=ce.w,Sn=Ce.x,vn=Ce.y,Lt=Ce.z,rn=Ce.w;return this.x=_e*rn+It*Sn+Xe*Lt-At*vn,this.y=Xe*rn+It*vn+At*Sn-_e*Lt,this.z=At*rn+It*Lt+_e*vn-Xe*Sn,this.w=It*rn-_e*Sn-Xe*vn-At*Lt,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var ce=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return ce===0?(this.x=0,this.y=0,this.z=0,this.w=1):(ce=1/ce,this.x=this.x*ce,this.y=this.y*ce,this.z=this.z*ce,this.w=this.w*ce),this},slerp:function(ce,Ce){if(Ce===0)return this;if(Ce===1)return this.copy(ce);var _e=this.x,Xe=this.y,At=this.z,It=this.w,Sn=It*ce.w+_e*ce.x+Xe*ce.y+At*ce.z;if(Sn<0?(this.w=-ce.w,this.x=-ce.x,this.y=-ce.y,this.z=-ce.z,Sn=-Sn):this.copy(ce),Sn>=1)return this.w=It,this.x=_e,this.y=Xe,this.z=At,this;var vn=Math.acos(Sn),Lt=Math.sqrt(1-Sn*Sn);if(Math.abs(Lt)<.001)return this.w=.5*(It+this.w),this.x=.5*(_e+this.x),this.y=.5*(Xe+this.y),this.z=.5*(At+this.z),this;var rn=Math.sin((1-Ce)*vn)/Lt,Bn=Math.sin(Ce*vn)/Lt;return this.w=It*rn+this.w*Bn,this.x=_e*rn+this.x*Bn,this.y=Xe*rn+this.y*Bn,this.z=At*rn+this.z*Bn,this},setFromUnitVectors:function(){var ie,ce,Ce=1e-6;return function(_e,Xe){return ie===void 0&&(ie=new ri),ce=_e.dot(Xe)+1,ce<Ce?(ce=0,Math.abs(_e.x)>Math.abs(_e.z)?ie.set(-_e.y,_e.x,0):ie.set(0,-_e.z,_e.y)):ie.crossVectors(_e,Xe),this.x=ie.x,this.y=ie.y,this.z=ie.z,this.w=ce,this.normalize(),this}}()};function lr(ie){this.width=ie.width||fn(),this.height=ie.height||cn(),this.widthMeters=ie.widthMeters,this.heightMeters=ie.heightMeters,this.bevelMeters=ie.bevelMeters}var _s=new lr({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Fs=new lr({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Vs={CardboardV1:new ti({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new ti({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Dr(ie,ce){this.viewer=Vs.CardboardV2,this.updateDeviceParams(ie),this.distortion=new Ft(this.viewer.distortionCoefficients);for(var Ce=0;Ce<ce.length;Ce++){var _e=ce[Ce];Vs[_e.id]=new ti(_e)}}Dr.prototype.updateDeviceParams=function(ie){this.device=this.determineDevice_(ie)||this.device},Dr.prototype.getDevice=function(){return this.device},Dr.prototype.setViewer=function(ie){this.viewer=ie,this.distortion=new Ft(this.viewer.distortionCoefficients)},Dr.prototype.determineDevice_=function(ie){if(!ie)return de()?(console.warn("Using fallback iOS device measurements."),Fs):(console.warn("Using fallback Android device measurements."),_s);var ce=.0254,Ce=ce/ie.xdpi,_e=ce/ie.ydpi,Xe=fn(),At=cn();return new lr({widthMeters:Ce*Xe,heightMeters:_e*At,bevelMeters:ie.bevelMm*.001})},Dr.prototype.getDistortedFieldOfViewLeftEye=function(){var ie=this.viewer,ce=this.device,Ce=this.distortion,_e=ie.screenLensDistance,Xe=(ce.widthMeters-ie.interLensDistance)/2,At=ie.interLensDistance/2,It=ie.baselineLensDistance-ce.bevelMeters,Sn=ce.heightMeters-It,vn=bi*Math.atan(Ce.distort(Xe/_e)),Lt=bi*Math.atan(Ce.distort(At/_e)),rn=bi*Math.atan(Ce.distort(It/_e)),Bn=bi*Math.atan(Ce.distort(Sn/_e));return{leftDegrees:Math.min(vn,ie.fov),rightDegrees:Math.min(Lt,ie.fov),downDegrees:Math.min(rn,ie.fov),upDegrees:Math.min(Bn,ie.fov)}},Dr.prototype.getLeftEyeVisibleTanAngles=function(){var ie=this.viewer,ce=this.device,Ce=this.distortion,_e=Math.tan(-hi*ie.fov),Xe=Math.tan(hi*ie.fov),At=Math.tan(hi*ie.fov),It=Math.tan(-hi*ie.fov),Sn=ce.widthMeters/4,vn=ce.heightMeters/2,Lt=ie.baselineLensDistance-ce.bevelMeters-vn,rn=ie.interLensDistance/2-Sn,Bn=-Lt,fi=ie.screenLensDistance,Ii=Ce.distort((rn-Sn)/fi),Vi=Ce.distort((Bn+vn)/fi),br=Ce.distort((rn+Sn)/fi),ur=Ce.distort((Bn-vn)/fi),er=new Float32Array(4);return er[0]=Math.max(_e,Ii),er[1]=Math.min(Xe,Vi),er[2]=Math.min(At,br),er[3]=Math.max(It,ur),er},Dr.prototype.getLeftEyeNoLensTanAngles=function(){var ie=this.viewer,ce=this.device,Ce=this.distortion,_e=new Float32Array(4),Xe=Ce.distortInverse(Math.tan(-hi*ie.fov)),At=Ce.distortInverse(Math.tan(hi*ie.fov)),It=Ce.distortInverse(Math.tan(hi*ie.fov)),Sn=Ce.distortInverse(Math.tan(-hi*ie.fov)),vn=ce.widthMeters/4,Lt=ce.heightMeters/2,rn=ie.baselineLensDistance-ce.bevelMeters-Lt,Bn=ie.interLensDistance/2-vn,fi=-rn,Ii=ie.screenLensDistance,Vi=(Bn-vn)/Ii,br=(fi+Lt)/Ii,ur=(Bn+vn)/Ii,er=(fi-Lt)/Ii;return _e[0]=Math.max(Xe,Vi),_e[1]=Math.min(At,br),_e[2]=Math.min(It,ur),_e[3]=Math.max(Sn,er),_e},Dr.prototype.getLeftEyeVisibleScreenRect=function(ie){var ce=this.viewer,Ce=this.device,_e=ce.screenLensDistance,Xe=(Ce.widthMeters-ce.interLensDistance)/2,At=ce.baselineLensDistance-Ce.bevelMeters,It=(ie[0]*_e+Xe)/Ce.widthMeters,Sn=(ie[1]*_e+At)/Ce.heightMeters,vn=(ie[2]*_e+Xe)/Ce.widthMeters,Lt=(ie[3]*_e+At)/Ce.heightMeters;return{x:It,y:Lt,width:vn-It,height:Sn-Lt}},Dr.prototype.getFieldOfViewLeftEye=function(ie){return ie?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Dr.prototype.getFieldOfViewRightEye=function(ie){var ce=this.getFieldOfViewLeftEye(ie);return{leftDegrees:ce.rightDegrees,rightDegrees:ce.leftDegrees,upDegrees:ce.upDegrees,downDegrees:ce.downDegrees}},Dr.prototype.getUndistortedFieldOfViewLeftEye=function(){var ie=this.getUndistortedParams_();return{leftDegrees:bi*Math.atan(ie.outerDist),rightDegrees:bi*Math.atan(ie.innerDist),downDegrees:bi*Math.atan(ie.bottomDist),upDegrees:bi*Math.atan(ie.topDist)}},Dr.prototype.getUndistortedViewportLeftEye=function(){var ie=this.getUndistortedParams_(),ce=this.viewer,Ce=this.device,_e=ce.screenLensDistance,Xe=Ce.widthMeters/_e,At=Ce.heightMeters/_e,It=Ce.width/Xe,Sn=Ce.height/At,vn=Math.round((ie.eyePosX-ie.outerDist)*It),Lt=Math.round((ie.eyePosY-ie.bottomDist)*Sn);return{x:vn,y:Lt,width:Math.round((ie.eyePosX+ie.innerDist)*It)-vn,height:Math.round((ie.eyePosY+ie.topDist)*Sn)-Lt}},Dr.prototype.getUndistortedParams_=function(){var ie=this.viewer,ce=this.device,Ce=this.distortion,_e=ie.screenLensDistance,Xe=ie.interLensDistance/2/_e,At=ce.widthMeters/_e,It=ce.heightMeters/_e,Sn=At/2-Xe,vn=(ie.baselineLensDistance-ce.bevelMeters)/_e,Lt=ie.fov,rn=Ce.distortInverse(Math.tan(hi*Lt)),Bn=Math.min(Sn,rn),fi=Math.min(Xe,rn),Ii=Math.min(vn,rn),Vi=Math.min(It-vn,rn);return{outerDist:Bn,innerDist:fi,topDist:Vi,bottomDist:Ii,eyePosX:Sn,eyePosY:vn}};function ti(ie){this.id=ie.id,this.label=ie.label,this.fov=ie.fov,this.interLensDistance=ie.interLensDistance,this.baselineLensDistance=ie.baselineLensDistance,this.screenLensDistance=ie.screenLensDistance,this.distortionCoefficients=ie.distortionCoefficients,this.inverseCoefficients=ie.inverseCoefficients}Dr.Viewers=Vs;var hn=1,On="2019-11-09T17:36:14Z",Oi=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Yn={format:hn,last_updated:On,devices:Oi};function Gi(ie,ce){if(this.dpdb=Yn,this.recalculateDeviceParams_(),ie){this.onDeviceParamsUpdated=ce;var Ce=new XMLHttpRequest,_e=this;Ce.open("GET",ie,!0),Ce.addEventListener("load",function(){_e.loading=!1,Ce.status>=200&&Ce.status<=299?(_e.dpdb=JSON.parse(Ce.response),_e.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),Ce.send()}}Gi.prototype.getDeviceParams=function(){return this.deviceParams},Gi.prototype.recalculateDeviceParams_=function(){var ie=this.calcDeviceParams_();ie?(this.deviceParams=ie,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Gi.prototype.calcDeviceParams_=function(){var ie=this.dpdb;if(!ie)return console.error("DPDB not available."),null;if(ie.format!=1)return console.error("DPDB has unexpected format version."),null;if(!ie.devices||!ie.devices.length)return console.error("DPDB does not have a devices section."),null;var ce=navigator.userAgent||navigator.vendor||window.opera,Ce=fn(),_e=cn();if(!ie.devices)return console.error("DPDB has no devices section."),null;for(var Xe=0;Xe<ie.devices.length;Xe++){var At=ie.devices[Xe];if(!At.rules){console.warn("Device["+Xe+"] has no rules section.");continue}if(At.type!="ios"&&At.type!="android"){console.warn("Device["+Xe+"] has invalid type.");continue}if(de()==(At.type=="ios")){for(var It=!1,Sn=0;Sn<At.rules.length;Sn++){var vn=At.rules[Sn];if(this.ruleMatches_(vn,ce,Ce,_e)){It=!0;break}}if(It){var Lt=At.dpi[0]||At.dpi,rn=At.dpi[1]||At.dpi;return new nr({xdpi:Lt,ydpi:rn,bevelMm:At.bw})}}}return console.warn("No DPDB device match."),null},Gi.prototype.ruleMatches_=function(ie,ce,Ce,_e){if(!ie.ua&&!ie.res||(ie.ua&&ie.ua.substring(0,2)==="SM"&&(ie.ua=ie.ua.substring(0,7)),ie.ua&&ce.indexOf(ie.ua)<0))return!1;if(ie.res){if(!ie.res[0]||!ie.res[1])return!1;var Xe=ie.res[0],At=ie.res[1];if(Math.min(Ce,_e)!=Math.min(Xe,At)||Math.max(Ce,_e)!=Math.max(Xe,At))return!1}return!0};function nr(ie){this.xdpi=ie.xdpi,this.ydpi=ie.ydpi,this.bevelMm=ie.bevelMm}function cr(ie,ce){this.set(ie,ce)}cr.prototype.set=function(ie,ce){this.sample=ie,this.timestampS=ce},cr.prototype.copy=function(ie){this.set(ie.sample,ie.timestampS)};function Xr(ie,ce){this.kFilter=ie,this.isDebug=ce,this.currentAccelMeasurement=new cr,this.currentGyroMeasurement=new cr,this.previousGyroMeasurement=new cr,de()?this.filterQ=new Ai(-1,0,0,1):this.filterQ=new Ai(1,0,0,1),this.previousFilterQ=new Ai,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Ai,this.isOrientationInitialized=!1,this.estimatedGravity=new ri,this.measuredGravity=new ri,this.gyroIntegralQ=new Ai}Xr.prototype.addAccelMeasurement=function(ie,ce){this.currentAccelMeasurement.set(ie,ce)},Xr.prototype.addGyroMeasurement=function(ie,ce){this.currentGyroMeasurement.set(ie,ce);var Ce=ce-this.previousGyroMeasurement.timestampS;Rt(Ce)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Xr.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var ie=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,ce=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,ie);this.gyroIntegralQ.multiply(ce),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(ce);var Ce=new Ai;Ce.copy(this.filterQ),Ce.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(Ce),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var _e=new Ai;_e.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),_e.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",bi*wn(_e),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var Xe=new Ai;Xe.copy(this.filterQ),Xe.multiply(_e),this.filterQ.slerp(Xe,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Xr.prototype.getOrientation=function(){return this.filterQ},Xr.prototype.accelToQuaternion_=function(ie){var ce=new ri;ce.copy(ie),ce.normalize();var Ce=new Ai;return Ce.setFromUnitVectors(new ri(0,0,-1),ce),Ce.inverse(),Ce},Xr.prototype.gyroToQuaternionDelta_=function(ie,ce){var Ce=new Ai,_e=new ri;return _e.copy(ie),_e.normalize(),Ce.setFromAxisAngle(_e,ie.length()*ce),Ce};function Fr(ie,ce){this.predictionTimeS=ie,this.isDebug=ce,this.previousQ=new Ai,this.previousTimestampS=null,this.deltaQ=new Ai,this.outQ=new Ai}Fr.prototype.getPrediction=function(ie,ce,Ce){if(!this.previousTimestampS)return this.previousQ.copy(ie),this.previousTimestampS=Ce,ie;var _e=new ri;_e.copy(ce),_e.normalize();var Xe=ce.length();if(Xe<hi*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(bi*Xe).toFixed(1)),this.outQ.copy(ie),this.previousQ.copy(ie),this.outQ;var At=Xe*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(_e,At),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(ie),this.previousTimestampS=Ce,this.outQ};function $r(ie,ce,Ce,_e){this.yawOnly=Ce,this.accelerometer=new ri,this.gyroscope=new ri,this.filter=new Xr(ie,_e),this.posePredictor=new Fr(ce,_e),this.isFirefoxAndroid=he(),this.isIOS=de();var Xe=Pe();this.isDeviceMotionInRadians=!this.isIOS&&Xe&&Xe<66,this.isWithoutDeviceMotion=ze()||Ve(),this.filterToWorldQ=new Ai,de()?this.filterToWorldQ.setFromAxisAngle(new ri(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ri(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Ai,this.worldToScreenQ=new Ai,this.originalPoseAdjustQ=new Ai,this.originalPoseAdjustQ.setFromAxisAngle(new ri(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),Tt()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Ai,this.orientationOut_=new Float32Array(4),this.start()}$r.prototype.getPosition=function(){return null},$r.prototype.getOrientation=function(){var ie=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var Xe=new Ai().setFromAxisAngle(new ri(0,0,-1),0),At=new Ai;return window.orientation===-90?At.setFromAxisAngle(new ri(0,1,0),Math.PI/-2):At.setFromAxisAngle(new ri(0,1,0),Math.PI/2),Xe.multiply(At)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var Xe=new Ai;return Xe.setFromAxisAngle(new ri(1,0,0),-Math.PI/2),Xe}(),ie=this._deviceOrientationQ;var Ce=new Ai;return Ce.copy(ie),Ce.multiply(this.deviceOrientationFilterToWorldQ),Ce.multiply(this.resetQ),Ce.multiply(this.worldToScreenQ),Ce.multiplyQuaternions(this.deviceOrientationFixQ,Ce),this.yawOnly&&(Ce.x=0,Ce.z=0,Ce.normalize()),this.orientationOut_[0]=Ce.x,this.orientationOut_[1]=Ce.y,this.orientationOut_[2]=Ce.z,this.orientationOut_[3]=Ce.w,this.orientationOut_}else{var ce=this.filter.getOrientation();ie=this.posePredictor.getPrediction(ce,this.gyroscope,this.previousTimestampS)}var Ce=new Ai;return Ce.copy(this.filterToWorldQ),Ce.multiply(this.resetQ),Ce.multiply(ie),Ce.multiply(this.worldToScreenQ),this.yawOnly&&(Ce.x=0,Ce.z=0,Ce.normalize()),this.orientationOut_[0]=Ce.x,this.orientationOut_[1]=Ce.y,this.orientationOut_[2]=Ce.z,this.orientationOut_[3]=Ce.w,this.orientationOut_},$r.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),Tt()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},$r.prototype.onDeviceOrientation_=function(ie){this._deviceOrientationQ=this._deviceOrientationQ||new Ai;var ce=ie.alpha,Ce=ie.beta,_e=ie.gamma;ce=(ce||0)*Math.PI/180,Ce=(Ce||0)*Math.PI/180,_e=(_e||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(Ce,ce,-_e)},$r.prototype.onDeviceMotion_=function(ie){this.updateDeviceMotion_(ie)},$r.prototype.updateDeviceMotion_=function(ie){var ce=ie.accelerationIncludingGravity,Ce=ie.rotationRate,_e=ie.timeStamp/1e3,Xe=_e-this.previousTimestampS;if(Xe<0){Dn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=_e;return}else if(Xe<=ve||Xe>Ae){Dn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=_e;return}this.accelerometer.set(-ce.x,-ce.y,-ce.z),Ce&&(et()?this.gyroscope.set(-Ce.beta,Ce.alpha,Ce.gamma):this.gyroscope.set(Ce.alpha,Ce.beta,Ce.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,_e)),this.filter.addAccelMeasurement(this.accelerometer,_e),this.previousTimestampS=_e},$r.prototype.onOrientationChange_=function(ie){this.setScreenTransform_()},$r.prototype.onMessage_=function(ie){var ce=ie.data;if(!(!ce||!ce.type)){var Ce=ce.type.toLowerCase();Ce==="devicemotion"&&this.updateDeviceMotion_(ce.deviceMotionEvent)}},$r.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ri(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ri(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},$r.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),de()&&mn()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},$r.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ws=60,vr=new ri(1,0,0),As=new ri(0,0,1),vs=new Ai;vs.setFromAxisAngle(vr,-Math.PI/2),vs.multiply(new Ai().setFromAxisAngle(As,Math.PI/2));var Ge=function(){function ie(ce){U(this,ie),this.config=ce,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Ai,this._outQ=new Ai,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return q(ie,[{key:"init",value:function(){var Ce=null;try{Ce=new RelativeOrientationSensor({frequency:ws,referenceFrame:"screen"}),Ce.addEventListener("error",this._onSensorError)}catch(_e){this.errors.push(_e),_e.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):_e.name==="ReferenceError"?this.useDeviceMotion():console.error(_e)}Ce&&(this.api="sensor",this.sensor=Ce,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new $r(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var Ce=this.sensor.quaternion;this._sensorQ.set(Ce[0],Ce[1],Ce[2],Ce[3]);var _e=this._outQ;return _e.copy(vs),_e.multiply(this._sensorQ),this.config.YAW_ONLY&&(_e.x=_e.z=0,_e.normalize()),this._out[0]=_e.x,this._out[1]=_e.y,this._out[2]=_e.z,this._out[3]=_e.w,this._out}},{key:"_onSensorError",value:function(Ce){this.errors.push(Ce.error),Ce.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):Ce.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(Ce.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),ie}(),st="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function wt(){this.loadIcon_();var ie=document.createElement("div"),It=ie.style;It.position="fixed",It.top=0,It.right=0,It.bottom=0,It.left=0,It.backgroundColor="gray",It.fontFamily="sans-serif",It.zIndex=1e6;var ce=document.createElement("img");ce.src=this.icon;var It=ce.style;It.marginLeft="25%",It.marginTop="25%",It.width="50%",ie.appendChild(ce);var Ce=document.createElement("div"),It=Ce.style;It.textAlign="center",It.fontSize="16px",It.lineHeight="24px",It.margin="24px 25%",It.width="50%",Ce.innerHTML="Place your phone into your Cardboard viewer.",ie.appendChild(Ce);var _e=document.createElement("div"),It=_e.style;It.backgroundColor="#CFD8DC",It.position="fixed",It.bottom=0,It.width="100%",It.height="48px",It.padding="14px 24px",It.boxSizing="border-box",It.color="#656A6B",ie.appendChild(_e);var Xe=document.createElement("div");Xe.style.float="left",Xe.innerHTML="No Cardboard viewer?";var At=document.createElement("a");At.href="https://www.google.com/get/cardboard/get-cardboard/",At.innerHTML="get one",At.target="_blank";var It=At.style;It.float="right",It.fontWeight=600,It.textTransform="uppercase",It.borderLeft="1px solid gray",It.paddingLeft="24px",It.textDecoration="none",It.color="#656A6B",_e.appendChild(Xe),_e.appendChild(At),this.overlay=ie,this.text=Ce,this.hide()}wt.prototype.show=function(ie){!ie&&!this.overlay.parentElement?document.body.appendChild(this.overlay):ie&&(this.overlay.parentElement&&this.overlay.parentElement!=ie&&this.overlay.parentElement.removeChild(this.overlay),ie.appendChild(this.overlay)),this.overlay.style.display="block";var ce=this.overlay.querySelector("img"),Ce=ce.style;Tt()?(Ce.width="20%",Ce.marginLeft="40%",Ce.marginTop="3%"):(Ce.width="50%",Ce.marginLeft="25%",Ce.marginTop="25%")},wt.prototype.hide=function(){this.overlay.style.display="none"},wt.prototype.showTemporarily=function(ie,ce){this.show(ce),this.timer=setTimeout(this.hide.bind(this),ie)},wt.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},wt.prototype.update=function(){this.disableShowTemporarily(),!Tt()&&dt()?this.show():this.hide()},wt.prototype.loadIcon_=function(){this.icon=Se("image/svg+xml",st)};var en="CardboardV1",Xt="WEBVR_CARDBOARD_VIEWER",En="webvr-polyfill-viewer-selector";function Fn(ie){try{this.selectedKey=localStorage.getItem(Xt)}catch(ce){console.error("Failed to load viewer profile: %s",ce)}this.selectedKey||(this.selectedKey=ie||en),this.dialog=this.createDialog_(Dr.Viewers),this.root=null,this.onChangeCallbacks_=[]}Fn.prototype.show=function(ie){this.root=ie,ie.appendChild(this.dialog);var ce=this.dialog.querySelector("#"+this.selectedKey);ce.checked=!0,this.dialog.style.display="block"},Fn.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Fn.prototype.getCurrentViewer=function(){return Dr.Viewers[this.selectedKey]},Fn.prototype.getSelectedKey_=function(){var ie=this.dialog.querySelector("input[name=field]:checked");return ie?ie.id:null},Fn.prototype.onChange=function(ie){this.onChangeCallbacks_.push(ie)},Fn.prototype.fireOnChange_=function(ie){for(var ce=0;ce<this.onChangeCallbacks_.length;ce++)this.onChangeCallbacks_[ce](ie)},Fn.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Dr.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Dr.Viewers[this.selectedKey]);try{localStorage.setItem(Xt,this.selectedKey)}catch(ie){console.error("Failed to save viewer profile: %s",ie)}this.hide()},Fn.prototype.createDialog_=function(ie){var ce=document.createElement("div");ce.classList.add(En),ce.style.display="none";var Ce=document.createElement("div"),At=Ce.style;At.position="fixed",At.left=0,At.top=0,At.width="100%",At.height="100%",At.background="rgba(0, 0, 0, 0.3)",Ce.addEventListener("click",this.hide.bind(this));var _e=280,Xe=document.createElement("div"),At=Xe.style;At.boxSizing="border-box",At.position="fixed",At.top="24px",At.left="50%",At.marginLeft=-_e/2+"px",At.width=_e+"px",At.padding="24px",At.overflow="hidden",At.background="#fafafa",At.fontFamily="'Roboto', sans-serif",At.boxShadow="0px 5px 20px #666",Xe.appendChild(this.createH1_("Select your viewer"));for(var It in ie)Xe.appendChild(this.createChoice_(It,ie[It].label));return Xe.appendChild(this.createButton_("Save",this.onSave_.bind(this))),ce.appendChild(Ce),ce.appendChild(Xe),ce},Fn.prototype.createH1_=function(ie){var ce=document.createElement("h1"),Ce=ce.style;return Ce.color="black",Ce.fontSize="20px",Ce.fontWeight="bold",Ce.marginTop=0,Ce.marginBottom="24px",ce.innerHTML=ie,ce},Fn.prototype.createChoice_=function(ie,ce){var Ce=document.createElement("div");Ce.style.marginTop="8px",Ce.style.color="black";var _e=document.createElement("input");_e.style.fontSize="30px",_e.setAttribute("id",ie),_e.setAttribute("type","radio"),_e.setAttribute("value",ie),_e.setAttribute("name","field");var Xe=document.createElement("label");return Xe.style.marginLeft="4px",Xe.setAttribute("for",ie),Xe.innerHTML=ce,Ce.appendChild(_e),Ce.appendChild(Xe),Ce},Fn.prototype.createButton_=function(ie,ce){var Ce=document.createElement("button");Ce.innerHTML=ie;var _e=Ce.style;return _e.float="right",_e.textTransform="uppercase",_e.color="#1094f7",_e.fontSize="14px",_e.letterSpacing=0,_e.border=0,_e.background="none",_e.marginTop="16px",Ce.addEventListener("click",ce),Ce};var Ci=typeof window<"u"?window:typeof B<"u"?B:typeof self<"u"?self:{};function vi(ie){return ie&&ie.__esModule&&Object.prototype.hasOwnProperty.call(ie,"default")?ie.default:ie}function An(ie,ce){return ce={exports:{}},ie(ce,ce.exports),ce.exports}var Ui=An(function(ie,ce){(function(_e,Xe){ie.exports=Xe()})(Ci,function(){return function(Ce){var _e={};function Xe(At){if(_e[At])return _e[At].exports;var It=_e[At]={i:At,l:!1,exports:{}};return Ce[At].call(It.exports,It,It.exports,Xe),It.l=!0,It.exports}return Xe.m=Ce,Xe.c=_e,Xe.d=function(At,It,Sn){Xe.o(At,It)||Object.defineProperty(At,It,{configurable:!1,enumerable:!0,get:Sn})},Xe.n=function(At){var It=At&&At.__esModule?function(){return At.default}:function(){return At};return Xe.d(It,"a",It),It},Xe.o=function(At,It){return Object.prototype.hasOwnProperty.call(At,It)},Xe.p="",Xe(Xe.s=0)}([function(Ce,_e,Xe){var At=function(){function rn(Bn,fi){for(var Ii=0;Ii<fi.length;Ii++){var Vi=fi[Ii];Vi.enumerable=Vi.enumerable||!1,Vi.configurable=!0,"value"in Vi&&(Vi.writable=!0),Object.defineProperty(Bn,Vi.key,Vi)}}return function(Bn,fi,Ii){return fi&&rn(Bn.prototype,fi),Ii&&rn(Bn,Ii),Bn}}();function It(rn,Bn){if(!(rn instanceof Bn))throw new TypeError("Cannot call a class as a function")}var Sn=Xe(1),vn=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,Lt=function(){function rn(){It(this,rn),vn?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",Sn),this.noSleepVideo.addEventListener("timeupdate",function(Bn){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return At(rn,[{key:"enable",value:function(){vn?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){vn?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),rn}();Ce.exports=Lt},function(Ce,_e,Xe){Ce.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Hi=vi(Ui),ir=1e3,us=[0,0,.5,1],Tr=[.5,0,.5,1],pr=window.requestAnimationFrame,Pr=window.cancelAnimationFrame;function Rs(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function fa(ie){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:ie.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:ie.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:ie.canPresent},maxLayers:{writable:!1,enumerable:!0,value:ie.maxLayers},hasOrientation:{enumerable:!0,get:function(){return gn("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),ie.hasOrientation}}})}function di(ie){ie=ie||{};var ce="wakelock"in ie?ie.wakelock:!0;this.isPolyfilled=!0,this.displayId=ir++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return gn("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new fa({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,ce&&dt()&&(this.wakelock_=new Hi)}di.prototype.getFrameData=function(ie){return Ye(ie,this._getPose(),this)},di.prototype.getPose=function(){return gn("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},di.prototype.resetPose=function(){return gn("VRDisplay.prototype.resetPose"),this._resetPose()},di.prototype.getImmediatePose=function(){return gn("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},di.prototype.requestAnimationFrame=function(ie){return pr(ie)},di.prototype.cancelAnimationFrame=function(ie){return Pr(ie)},di.prototype.wrapForFullscreen=function(ie){if(de())return ie;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var ce=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",ce.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==ie)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=ie,this.originalParent_=ie.parentElement,this.originalParent_||document.body.appendChild(ie),!this.fullscreenWrapper_.parentElement){var Ce=this.fullscreenElement_.parentElement;Ce.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),Ce.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var _e=this;function Xe(){if(_e.fullscreenElement_){var At=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];_e.fullscreenElement_.setAttribute("style",At.join("; ")+";")}}return Xe(),this.fullscreenWrapper_},di.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var ie=this.fullscreenElement_;this.fullscreenElementCachedStyle_?ie.setAttribute("style",this.fullscreenElementCachedStyle_):ie.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var ce=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(ie),this.originalParent_===ce?ce.insertBefore(ie,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(ie),ce.removeChild(this.fullscreenWrapper_),ie}},di.prototype.requestPresent=function(ie){var ce=this.isPresenting,Ce=this;return ie instanceof Array||(gn("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),ie=[ie]),new Promise(function(_e,Xe){if(!Ce.capabilities.canPresent){Xe(new Error("VRDisplay is not capable of presenting."));return}if(ie.length==0||ie.length>Ce.capabilities.maxLayers){Xe(new Error("Invalid number of layers."));return}var At=ie[0];if(!At.source){_e();return}var It=At.leftBounds||us,Sn=At.rightBounds||Tr;if(ce){var vn=Ce.layer_;vn.source!==At.source&&(vn.source=At.source);for(var Lt=0;Lt<4;Lt++)vn.leftBounds[Lt]=It[Lt],vn.rightBounds[Lt]=Sn[Lt];Ce.wrapForFullscreen(Ce.layer_.source),Ce.updatePresent_(),_e();return}if(Ce.layer_={predistorted:At.predistorted,source:At.source,leftBounds:It.slice(0),rightBounds:Sn.slice(0)},Ce.waitingForPresent_=!1,Ce.layer_&&Ce.layer_.source){var rn=Ce.wrapForFullscreen(Ce.layer_.source),Bn=function(){var Vi=Wn();Ce.isPresenting=rn===Vi,Ce.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(br){console.error("screen.orientation.lock() failed due to",br.message)}),Ce.waitingForPresent_=!1,Ce.beginPresent_(),_e()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),Ce.removeFullscreenWrapper(),Ce.disableWakeLock(),Ce.endPresent_(),Ce.removeFullscreenListeners_()),Ce.fireVRDisplayPresentChange_()},fi=function(){Ce.waitingForPresent_&&(Ce.removeFullscreenWrapper(),Ce.removeFullscreenListeners_(),Ce.disableWakeLock(),Ce.waitingForPresent_=!1,Ce.isPresenting=!1,Xe(new Error("Unable to present.")))};Ce.addFullscreenListeners_(rn,Bn,fi),Jn(rn)?(Ce.enableWakeLock(),Ce.waitingForPresent_=!0):(de()||pe())&&(Ce.enableWakeLock(),Ce.isPresenting=!0,Ce.beginPresent_(),Ce.fireVRDisplayPresentChange_(),_e())}!Ce.waitingForPresent_&&!de()&&(yn(),Xe(new Error("Unable to present.")))})},di.prototype.exitPresent=function(){var ie=this.isPresenting,ce=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(Ce,_e){ie?(!yn()&&de()&&(ce.endPresent_(),ce.fireVRDisplayPresentChange_()),pe()&&(ce.removeFullscreenWrapper(),ce.removeFullscreenListeners_(),ce.endPresent_(),ce.fireVRDisplayPresentChange_()),Ce()):_e(new Error("Was not presenting to VRDisplay."))})},di.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},di.prototype.fireVRDisplayPresentChange_=function(){var ie=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(ie)},di.prototype.fireVRDisplayConnect_=function(){var ie=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(ie)},di.prototype.addFullscreenListeners_=function(ie,ce,Ce){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=ie,this.fullscreenChangeHandler_=ce,this.fullscreenErrorHandler_=Ce,ce&&(document.fullscreenEnabled?ie.addEventListener("fullscreenchange",ce,!1):document.webkitFullscreenEnabled?ie.addEventListener("webkitfullscreenchange",ce,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",ce,!1):document.msFullscreenEnabled&&ie.addEventListener("msfullscreenchange",ce,!1)),Ce&&(document.fullscreenEnabled?ie.addEventListener("fullscreenerror",Ce,!1):document.webkitFullscreenEnabled?ie.addEventListener("webkitfullscreenerror",Ce,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",Ce,!1):document.msFullscreenEnabled&&ie.addEventListener("msfullscreenerror",Ce,!1))},di.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var ie=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var ce=this.fullscreenChangeHandler_;ie.removeEventListener("fullscreenchange",ce,!1),ie.removeEventListener("webkitfullscreenchange",ce,!1),document.removeEventListener("mozfullscreenchange",ce,!1),ie.removeEventListener("msfullscreenchange",ce,!1)}if(this.fullscreenErrorHandler_){var Ce=this.fullscreenErrorHandler_;ie.removeEventListener("fullscreenerror",Ce,!1),ie.removeEventListener("webkitfullscreenerror",Ce,!1),document.removeEventListener("mozfullscreenerror",Ce,!1),ie.removeEventListener("msfullscreenerror",Ce,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},di.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},di.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},di.prototype.beginPresent_=function(){},di.prototype.endPresent_=function(){},di.prototype.submitFrame=function(ie){},di.prototype.getEyeParameters=function(ie){return null};var Cr={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},zs={LEFT:"left",RIGHT:"right"};function zr(ie){var ce=Ot({},Cr);ie=Ot(ce,ie||{}),di.call(this,{wakelock:ie.MOBILE_WAKE_LOCK}),this.config=ie,this.displayName="Cardboard VRDisplay",this.capabilities=new fa({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Ge(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Gi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Dr(this.dpdb_.getDeviceParams(),ie.ADDITIONAL_VIEWERS),this.viewerSelector_=new Fn(ie.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new wt),de()&&window.addEventListener("resize",this.onResize_.bind(this))}return zr.prototype=Object.create(di.prototype),zr.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},zr.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},zr.prototype._getFieldOfView=function(ie){var ce;if(ie==zs.LEFT)ce=this.deviceInfo_.getFieldOfViewLeftEye();else if(ie==zs.RIGHT)ce=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",ie),null;return ce},zr.prototype._getEyeOffset=function(ie){var ce;if(ie==zs.LEFT)ce=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(ie==zs.RIGHT)ce=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",ie),null;return ce},zr.prototype.getEyeParameters=function(ie){var ce=this._getEyeOffset(ie),Ce=this._getFieldOfView(ie),_e={offset:ce,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(_e,"fieldOfView",{enumerable:!0,get:function(){return gn("VRFieldOfView","VRFrameData's projection matrices"),Ce}}),_e},zr.prototype.onDeviceParamsUpdated_=function(ie){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(ie),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},zr.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},zr.prototype.beginPresent_=function(){var ie=this.layer_.source.getContext("webgl");ie||(ie=this.layer_.source.getContext("experimental-webgl")),ie||(ie=this.layer_.source.getContext("webgl2")),ie&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(ie.canvas.width=fn()*this.bufferScale_,ie.canvas.height=cn()*this.bufferScale_,this.cardboardUI_=new ft(ie)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ft(ie)),this.distorter_=new We(ie,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(ce){this.viewerSelector_.show(this.layer_.source.parentElement),ce.stopPropagation(),ce.preventDefault()}.bind(this),function(ce){this.exitPresent(),ce.stopPropagation(),ce.preventDefault()}.bind(this)),this.rotateInstructions_&&(Tt()&&dt()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},zr.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},zr.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},zr.prototype.submitFrame=function(ie){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var ce=this.layer_.source.getContext("webgl");ce||(ce=this.layer_.source.getContext("experimental-webgl")),ce||(ce=this.layer_.source.getContext("webgl2"));var Ce=ce.canvas;(Ce.width!=this.lastWidth||Ce.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=Ce.width,this.lastHeight=Ce.height,this.cardboardUI_.render()}},zr.prototype.onOrientationChange_=function(ie){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},zr.prototype.onResize_=function(ie){if(this.layer_){var ce=this.layer_.source.getContext("webgl");ce||(ce=this.layer_.source.getContext("experimental-webgl")),ce||(ce=this.layer_.source.getContext("webgl2"));var Ce=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];ce.canvas.setAttribute("style",Ce.join("; ")+";"),$t(ce.canvas)}},zr.prototype.onViewerChanged_=function(ie){this.deviceInfo_.setViewer(ie),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},zr.prototype.fireVRDisplayDeviceParamsChange_=function(){var ie=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(ie)},zr.VRFrameData=Rs,zr.VRDisplay=di,zr})}),S=H(b),I="0.10.12",O={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function _(Y){this.config=M(M({},O),Y),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&F())&&(this.enable(),this.getVRDisplays().then(function(W){W&&W[0]&&W[0].fireVRDisplayConnect_&&W[0].fireVRDisplayConnect_()}))}_.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(F()){var Y=new S({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(Y)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},_.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var Y=this.native.VRFrameData,W=new this.native.VRFrameData,U=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(q){if(q instanceof Y){U.call(this,q);return}U.call(this,W),q.pose=W.pose,L(W.leftProjectionMatrix,q.leftProjectionMatrix),L(W.rightProjectionMatrix,q.rightProjectionMatrix),L(W.leftViewMatrix,q.leftViewMatrix),L(W.rightViewMatrix,q.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=S.VRDisplay,window.VRFrameData=S.VRFrameData},_.prototype.getVRDisplays=function(){var Y=this;return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(function(W){return W.length>0?W:Y.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},_.version=I,_.VRFrameData=S.VRFrameData,_.VRDisplay=S.VRDisplay;var D=Object.freeze({default:_}),V=D&&_||D;typeof B<"u"&&B.window&&(B.document||(B.document=B.window.document),B.navigator||(B.navigator=B.window.navigator));var J=V;return J})},"./node_modules/word-wrapper/index.js":Z=>{var te=/\n/,E=`
`,B=/\s/;Z.exports=function(b,S){var I=Z.exports.lines(b,S);return I.map(function(O){return b.substring(O.start,O.end)}).join(`
`)},Z.exports.lines=function(S,I){if(I=I||{},I.width===0&&I.mode!=="nowrap")return[];S=S||"";var O=typeof I.width=="number"?I.width:Number.MAX_VALUE,_=Math.max(0,I.start||0),D=typeof I.end=="number"?I.end:S.length,V=I.mode,J=I.measure||M;return V==="pre"?F(J,S,_,D,O):L(J,S,_,D,O,V)};function H(b,S,I,O){var _=b.indexOf(S,I);return _===-1||_>O?O:_}function C(b){return B.test(b)}function F(b,S,I,O,_){for(var D=[],V=I,J=I;J<O&&J<S.length;J++){var Y=S.charAt(J),W=te.test(Y);if(W||J===O-1){var U=W?J:J+1,q=b(S,V,U,_);D.push(q),V=J+1}}return D}function L(b,S,I,O,_,D){var V=[],J=_;for(D==="nowrap"&&(J=Number.MAX_VALUE);I<O&&I<S.length;){for(var Y=H(S,E,I,O);I<Y&&C(S.charAt(I));)I++;var W=b(S,I,Y,J),U=I+(W.end-W.start),q=U+E.length;if(U<Y){for(;U>I&&!C(S.charAt(U));)U--;if(U===I)q>I+E.length&&q--,U=q;else for(q=U;U>I&&C(S.charAt(U-E.length));)U--}if(U>=I){var oe=b(S,I,U,J);V.push(oe)}I=q}return V}function M(b,S,I,O){var _=Math.min(O,I-S);return{start:S,end:S+_}}},"./node_modules/xhr/index.js":(Z,te,E)=>{var B=E("./node_modules/global/window.js"),H=E("./node_modules/is-function/index.js"),C=E("./node_modules/parse-headers/parse-headers.js"),F=E("./node_modules/xtend/immutable.js");Z.exports=S,Z.exports.default=S,S.XMLHttpRequest=B.XMLHttpRequest||_,S.XDomainRequest="withCredentials"in new S.XMLHttpRequest?S.XMLHttpRequest:B.XDomainRequest,L(["get","put","post","patch","head","delete"],function(D){S[D==="delete"?"del":D]=function(V,J,Y){return J=b(V,J,Y),J.method=D.toUpperCase(),I(J)}});function L(D,V){for(var J=0;J<D.length;J++)V(D[J])}function M(D){for(var V in D)if(D.hasOwnProperty(V))return!1;return!0}function b(D,V,J){var Y=D;return H(V)?(J=V,typeof D=="string"&&(Y={uri:D})):Y=F(V,{uri:D}),Y.callback=J,Y}function S(D,V,J){return V=b(D,V,J),I(V)}function I(D){if(typeof D.callback>"u")throw new Error("callback argument missing");var V=!1,J=function(et,Tt,Rt){V||(V=!0,D.callback(et,Tt,Rt))};function Y(){oe.readyState===4&&setTimeout(q,0)}function W(){var ze=void 0;if(oe.response?ze=oe.response:ze=oe.responseText||O(oe),he)try{ze=JSON.parse(ze)}catch{}return ze}function U(ze){return clearTimeout(Pe),ze instanceof Error||(ze=new Error(""+(ze||"Unknown XMLHttpRequest Error"))),ze.statusCode=0,J(ze,Ve)}function q(){if(!Ae){var ze;clearTimeout(Pe),D.useXDR&&oe.status===void 0?ze=200:ze=oe.status===1223?204:oe.status;var et=Ve,Tt=null;return ze!==0?(et={body:W(),statusCode:ze,method:Ie,headers:{},url:Se,rawRequest:oe},oe.getAllResponseHeaders&&(et.headers=C(oe.getAllResponseHeaders()))):Tt=new Error("Internal XMLHttpRequest Error"),J(Tt,et,et.body)}}var oe=D.xhr||null;oe||(D.cors||D.useXDR?oe=new S.XDomainRequest:oe=new S.XMLHttpRequest);var ve,Ae,Se=oe.url=D.uri||D.url,Ie=oe.method=D.method||"GET",de=D.body||D.data,pe=oe.headers=D.headers||{},we=!!D.sync,he=!1,Pe,Ve={body:void 0,headers:{},statusCode:0,method:Ie,url:Se,rawRequest:oe};if("json"in D&&D.json!==!1&&(he=!0,pe.accept||pe.Accept||(pe.Accept="application/json"),Ie!=="GET"&&Ie!=="HEAD"&&(pe["content-type"]||pe["Content-Type"]||(pe["Content-Type"]="application/json"),de=JSON.stringify(D.json===!0?de:D.json))),oe.onreadystatechange=Y,oe.onload=q,oe.onerror=U,oe.onprogress=function(){},oe.onabort=function(){Ae=!0},oe.ontimeout=U,oe.open(Ie,Se,!we,D.username,D.password),we||(oe.withCredentials=!!D.withCredentials),!we&&D.timeout>0&&(Pe=setTimeout(function(){if(!Ae){Ae=!0,oe.abort("timeout");var ze=new Error("XMLHttpRequest timeout");ze.code="ETIMEDOUT",U(ze)}},D.timeout)),oe.setRequestHeader)for(ve in pe)pe.hasOwnProperty(ve)&&oe.setRequestHeader(ve,pe[ve]);else if(D.headers&&!M(D.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in D&&(oe.responseType=D.responseType),"beforeSend"in D&&typeof D.beforeSend=="function"&&D.beforeSend(oe),oe.send(de||null),oe}function O(D){try{if(D.responseType==="document")return D.responseXML;var V=D.responseXML&&D.responseXML.documentElement.nodeName==="parsererror";if(D.responseType===""&&!V)return D.responseXML}catch{}return null}function _(){}},"./node_modules/xml-parse-from-string/index.js":Z=>{Z.exports=function(){return typeof self.DOMParser<"u"?function(E){var B=new self.DOMParser;return B.parseFromString(E,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(E){var B=new self.ActiveXObject("Microsoft.XMLDOM");return B.async="false",B.loadXML(E),B}:function(E){var B=document.createElement("div");return B.innerHTML=E,B}}()},"./node_modules/xtend/immutable.js":Z=>{Z.exports=E;var te=Object.prototype.hasOwnProperty;function E(){for(var B={},H=0;H<arguments.length;H++){var C=arguments[H];for(var F in C)te.call(C,F)&&(B[F]=C[F])}return B}},"./src/components/animation.js":(Z,te,E)=>{var B=E("./node_modules/super-animejs/lib/anime.es.js").default,H=E("./src/core/component.js").components,C=E("./src/core/component.js").registerComponent,F=E("./src/lib/three.js"),L=E("./src/utils/index.js"),M=new F.Color,b=new F.Color,S=L.entity.getComponentProperty,I=L.entity.setComponentProperty,O={},_="color",D="position",V="rotation",J="scale",Y="components",W="object3D";Z.exports.Component=C("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(pe){return pe===!0||pe==="true"?!0:pe===!1||pe==="false"?!1:parseInt(pe,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var pe=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){pe.animationIsPlaying=!1,pe.el.emit("animationcomplete",pe.eventDetail,!1),pe.id&&pe.el.emit("animationcomplete__"+pe.id,pe.eventDetail,!1)}}},update:function(pe){var we=this.config,he=this.data;this.animationIsPlaying=!1,this.data.enabled&&he.property&&(we.autoplay=!1,we.direction=he.dir,we.duration=he.dur,we.easing=he.easing,we.elasticity=he.elasticity,we.loop=he.loop,we.round=he.round,this.createAndStartAnimation())},tick:function(pe,we){this.animationIsPlaying&&(this.time+=we,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var pe=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=B(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!(!pe.autoplay||pe.startEvents&&pe.startEvents.length)){if(pe.delay){setTimeout(this.beginAnimation,pe.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=B(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var pe=this.config,we=this.data,he=this.el,Pe,Ve,ze;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){Pe=we.from===""?Ae(he,we.property):we.from,ze=we.to,this.setColorConfig(Pe,ze),Pe=this.fromColor,ze=this.toColor,this.targetsArray.length=0,this.targetsArray.push(Pe),pe.targets=this.targetsArray;for(Ve in ze)pe[Ve]=ze[Ve];pe.update=function(){var et={};return function(Tt){var Rt;Rt=Tt.animatables[0].target,!(Rt.r===et.r&&Rt.g===et.g&&Rt.b===et.b)&&Se(he,we.property,Rt,we.type)}}()}},updateConfigForDefault:function(){var pe=this.config,we=this.data,he=this.el,Pe,Ve,ze,et;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(we.from===""?Pe=de(we)?Ae(he,we.property):S(he,we.property):Pe=we.from,et=we.to,ze=!isNaN(Pe||et),ze?(Pe=parseFloat(Pe),et=parseFloat(et)):(Pe=Pe&&Pe.toString(),et=et&&et.toString()),Ve=we.to==="true"||we.to==="false"||we.to===!0||we.to===!1,Ve&&(Pe=we.from==="true"||we.from===!0?1:0,et=we.to==="true"||we.to===!0?1:0),this.targets.aframeProperty=Pe,pe.targets=this.targets,pe.aframeProperty=et,pe.update=function(){var Tt;return function(Rt){var fn;fn=Rt.animatables[0].target.aframeProperty,fn!==Tt&&(Tt=fn,Ve&&(fn=fn>=1),de(we)?Se(he,we.property,fn,we.type):I(he,we.property,fn))}}())},updateConfigForVector:function(){var pe=this.config,we=this.data,he=this.el,Pe,Ve,ze;Ve=we.from!==""?L.coordinates.parse(we.from):S(he,we.property),ze=L.coordinates.parse(we.to),we.property===V&&(q(Ve),q(ze)),this.targetsArray.length=0,this.targetsArray.push(Ve),pe.targets=this.targetsArray;for(Pe in ze)pe[Pe]=ze[Pe];if(we.property===D||we.property===V||we.property===J){pe.update=function(){var et={};return function(Tt){var Rt=Tt.animatables[0].target;we.property===J&&(Rt.x=Math.max(1e-4,Rt.x),Rt.y=Math.max(1e-4,Rt.y),Rt.z=Math.max(1e-4,Rt.z)),!(Rt.x===et.x&&Rt.y===et.y&&Rt.z===et.z)&&(et.x=Rt.x,et.y=Rt.y,et.z=Rt.z,he.object3D[we.property].set(Rt.x,Rt.y,Rt.z))}}();return}pe.update=function(){var et={};return function(Tt){var Rt=Tt.animatables[0].target;Rt.x===et.x&&Rt.y===et.y&&Rt.z===et.z||(et.x=Rt.x,et.y=Rt.y,et.z=Rt.z,I(he,we.property,Rt))}}()},updateConfig:function(){var pe;pe=U(this.el,this.data.property),de(this.data)&&this.data.type===_?this.updateConfigForRawColor():pe==="vec2"||pe==="vec3"||pe==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(pe){var we,he=this.data,Pe=this.el,Ve=this;return he.from!==""||!he.property.startsWith(Y)||(we=Ie(he.property)[1],Pe.components[we])?!1:(Pe.addEventListener("componentinitialized",function ze(et){et.detail.name===we&&(pe(),Ve.animation=B(Ve.config),Pe.removeEventListener("componentinitialized",ze))}),!0)},stopRelatedAnimations:function(){var pe,we;for(we in this.el.components)pe=this.el.components[we],we!==this.attrName&&pe.name==="animation"&&pe.animationIsPlaying&&pe.data.property===this.data.property&&(pe.animationIsPlaying=!1)},addEventListeners:function(){var pe=this.data,we=this.el;oe(we,pe.startEvents,this.onStartEvent),oe(we,pe.pauseEvents,this.pauseAnimation),oe(we,pe.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var pe=this.data,we=this.el;ve(we,pe.startEvents,this.onStartEvent),ve(we,pe.pauseEvents,this.pauseAnimation),ve(we,pe.resumeEvents,this.resumeAnimation)},setColorConfig:function(pe,we){M.set(pe),b.set(we),pe=this.fromColor,we=this.toColor,pe.r=M.r,pe.g=M.g,pe.b=M.b,we.r=b.r,we.g=b.g,we.b=b.b}});function U(pe,we){var he,Pe,Ve,ze;return Ve=we.split("."),Pe=Ve[0],ze=Ve[1],he=pe.components[Pe]||H[Pe],!he||ze&&!he.schema[ze]?null:ze?he.schema[ze].type:he.schema.type}function q(pe){pe.x=F.MathUtils.degToRad(pe.x),pe.y=F.MathUtils.degToRad(pe.y),pe.z=F.MathUtils.degToRad(pe.z)}function oe(pe,we,he){var Pe;for(Pe=0;Pe<we.length;Pe++)pe.addEventListener(we[Pe],he)}function ve(pe,we,he){var Pe;for(Pe=0;Pe<we.length;Pe++)pe.removeEventListener(we[Pe],he)}function Ae(pe,we){var he,Pe,Ve;for(Pe=Ie(we),Ve=pe,he=0;he<Pe.length;he++)Ve=Ve[Pe[he]];if(Ve===void 0)throw console.log(pe),new Error("[animation] property ("+we+") could not be found");return Ve}function Se(pe,we,he,Pe){var Ve,ze,et,Tt;for(we.startsWith("object3D.rotation")&&(he=F.MathUtils.degToRad(he)),ze=Ie(we),Tt=pe,Ve=0;Ve<ze.length-1;Ve++)Tt=Tt[ze[Ve]];if(et=ze[ze.length-1],Pe===_){"r"in Tt[et]?(Tt[et].r=he.r,Tt[et].g=he.g,Tt[et].b=he.b):(Tt[et].x=he.r,Tt[et].y=he.g,Tt[et].z=he.b);return}Tt[et]=he}function Ie(pe){return pe in O||(O[pe]=pe.split(".")),O[pe]}function de(pe){return pe.isRawProperty||pe.property.startsWith(Y)||pe.property.startsWith(W)}},"./src/components/camera.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js");Z.exports.Component=B("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var C,F=this.el;C=this.camera=new H.PerspectiveCamera,F.setObject3D("camera",C)},update:function(C){var F=this.data,L=this.camera;L.aspect=F.aspect||window.innerWidth/window.innerHeight,L.far=F.far,L.fov=F.fov,L.near=F.near,L.zoom=F.zoom,L.updateProjectionMatrix(),this.updateActiveCamera(C),this.updateSpectatorCamera(C)},updateActiveCamera:function(C){var F=this.data,L=this.el,M=this.system;C&&C.active===F.active||F.spectator||(F.active&&M.activeCameraEl!==L?M.setActiveCamera(L):!F.active&&M.activeCameraEl===L&&M.disableActiveCamera())},updateSpectatorCamera:function(C){var F=this.data,L=this.el,M=this.system;C&&C.spectator===F.spectator||(F.spectator&&M.spectatorCameraEl!==L?M.setSpectatorCamera(L):!F.spectator&&M.spectatorCameraEl===L&&M.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},"./src/components/cursor.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/index.js"),C=H.bind,F={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},L={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},M={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},b={DOWN:["selectstart"],UP:["selectend"]},S="a-mouse-cursor-hover";Z.exports.Component=B("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:H.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},multiple:!0,init:function(){var I=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=H.debounce(function(){I.canvasBounds=I.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=C(this.onCursorDown,this),this.onCursorUp=C(this.onCursorUp,this),this.onIntersection=C(this.onIntersection,this),this.onIntersectionCleared=C(this.onIntersectionCleared,this),this.onMouseMove=C(this.onMouseMove,this),this.onEnterVR=C(this.onEnterVR,this)},update:function(I){this.data.rayOrigin!==I.rayOrigin&&this.updateMouseEventListeners()},tick:function(){var I=this.el.sceneEl.frame,O=this.activeXRInput;this.data.rayOrigin==="xrselect"&&I&&O&&this.onMouseMove({frame:I,inputSource:O,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var I=this.el;I.removeState(L.HOVERING),I.removeState(L.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(L.HOVERED),this.removeEventListeners()},addEventListeners:function(){var I,O=this.data,_=this.el,D=this;function V(){I=_.sceneEl.canvas,!(O.downEvents.length||O.upEvents.length)&&(M.DOWN.forEach(function(J){I.addEventListener(J,D.onCursorDown)}),M.UP.forEach(function(J){I.addEventListener(J,D.onCursorUp)}))}I=_.sceneEl.canvas,I?V():_.sceneEl.addEventListener("render-target-loaded",V),O.downEvents.forEach(function(J){_.addEventListener(J,D.onCursorDown)}),O.upEvents.forEach(function(J){_.addEventListener(J,D.onCursorUp)}),_.addEventListener("raycaster-intersection",this.onIntersection),_.addEventListener("raycaster-closest-entity-changed",this.onIntersection),_.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),_.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),_.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var I,O=this.data,_=this.el,D=this;I=_.sceneEl.canvas,I&&!O.downEvents.length&&!O.upEvents.length&&(M.DOWN.forEach(function(V){I.removeEventListener(V,D.onCursorDown)}),M.UP.forEach(function(V){I.removeEventListener(V,D.onCursorUp)})),O.downEvents.forEach(function(V){_.removeEventListener(V,D.onCursorDown)}),O.upEvents.forEach(function(V){_.removeEventListener(V,D.onCursorUp)}),_.removeEventListener("raycaster-intersection",this.onIntersection),_.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),I.removeEventListener("mousemove",this.onMouseMove),I.removeEventListener("touchstart",this.onMouseMove),I.removeEventListener("touchmove",this.onMouseMove),_.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),_.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var I,O=this.el;I=O.sceneEl.canvas,I.removeEventListener("mousemove",this.onMouseMove),I.removeEventListener("touchmove",this.onMouseMove),O.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(I.addEventListener("mousemove",this.onMouseMove,!1),I.addEventListener("touchmove",this.onMouseMove,!1),O.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:function(){var I=new THREE.Vector3,O=new THREE.Vector2,_=new THREE.Vector3,D={origin:_,direction:I};return function(V){var J=this.canvasBounds,Y=this.el.sceneEl.camera,W,U,q,oe,ve,Ae,Se,Ie;Y.parent.updateMatrixWorld(),V.type==="touchmove"||V.type==="touchstart"?U=V.touches.item(0):U=V,W=U.clientX-J.left,q=U.clientY-J.top,O.x=W/J.width*2-1,O.y=-(q/J.height)*2+1,this.data.rayOrigin==="xrselect"&&(V.type==="selectstart"||V.type==="fakeselectevent")?(oe=V.frame,ve=V.inputSource,Ae=this.el.renderer.xr.getReferenceSpace(),Se=oe.getPose(ve.targetRaySpace,Ae),Ie=Se.transform,I.set(0,0,-1),I.applyQuaternion(Ie.orientation),_.copy(Ie.position)):V.type==="fakeselectout"?(I.set(0,1,0),_.set(0,9999,0)):Y&&Y.isPerspectiveCamera?(_.setFromMatrixPosition(Y.matrixWorld),I.set(O.x,O.y,.5).unproject(Y).sub(_).normalize()):Y&&Y.isOrthographicCamera?(_.set(O.x,O.y,(Y.near+Y.far)/(Y.near-Y.far)).unproject(Y),I.set(0,0,-1).transformDirection(Y.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+Y.type),this.el.setAttribute("raycaster",D),V.type==="touchmove"&&V.preventDefault()}}(),onCursorDown:function(I){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&I.type==="touchstart"&&(this.onMouseMove(I),this.el.components.raycaster.checkIntersections(),I.preventDefault()),this.data.rayOrigin==="xrselect"&&I.type==="selectstart"&&(this.activeXRInput=I.inputSource,this.onMouseMove(I),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit(F.MOUSEDOWN,I),this.cursorDownEl=this.intersectedEl},onCursorUp:function(I){if(this.isCursorDown){this.isCursorDown=!1;var O=this.data;this.twoWayEmit(F.MOUSEUP,I),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(F.MOUSEUP,this.intersectedEventDetail)),(!O.fuse||O.rayOrigin==="mouse"||O.rayOrigin==="xrselect")&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(F.CLICK,I),O.rayOrigin==="xrselect"&&this.activeXRInput===I.inputSource&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,I.type==="touchend"&&I.preventDefault()}},onIntersection:function(I){var O,_=this.el,D,V,J;D=I.detail.els[0]===_?1:0,J=I.detail.intersections[D],V=I.detail.els[D],V&&this.intersectedEl!==V&&(this.intersectedEl&&(O=this.el.components.raycaster.getIntersection(this.intersectedEl),O&&O.distance<=J.distance)||(this.clearCurrentIntersection(!0),this.setIntersection(V,J)))},onIntersectionCleared:function(I){var O=I.detail.clearedEls;O.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var I=this.el.sceneEl.xrSession,O=this;I&&this.data.rayOrigin!=="mouse"&&(b.DOWN.forEach(function(_){I.addEventListener(_,O.onCursorDown)}),b.UP.forEach(function(_){I.addEventListener(_,O.onCursorUp)}))},setIntersection:function(I,O){var _=this.el,D=this.data,V=this;this.intersectedEl!==I&&(this.intersectedEl=I,_.addState(L.HOVERING),I.addState(L.HOVERED),this.twoWayEmit(F.MOUSEENTER),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(S),!(D.fuseTimeout===0||!D.fuse||D.rayOrigin==="xrselect"||D.rayOrigin==="mouse")&&(_.addState(L.FUSING),this.twoWayEmit(F.FUSING),this.fuseTimeout=setTimeout(function(){_.removeState(L.FUSING),V.twoWayEmit(F.CLICK)},D.fuseTimeout)))},clearCurrentIntersection:function(I){var O,_,D,V=this.el;this.intersectedEl&&(this.intersectedEl.removeState(L.HOVERED),V.removeState(L.HOVERING),V.removeState(L.FUSING),this.twoWayEmit(F.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(S),this.intersectedEl=null,clearTimeout(this.fuseTimeout),I!==!0&&(D=this.el.components.raycaster.intersections,D.length!==0&&(O=D[0].object.el===V?1:0,_=D[O],_&&this.setIntersection(_.object.el,_))))},twoWayEmit:function(I,O){var _=this.el,D=this.intersectedEl,V;function J(Y,W){O instanceof MouseEvent?Y.mouseEvent=O:typeof TouchEvent<"u"&&O instanceof TouchEvent&&(Y.touchEvent=O)}V=this.el.components.raycaster.getIntersection(D),this.eventDetail.intersectedEl=D,this.eventDetail.intersection=V,J(this.eventDetail),_.emit(I,this.eventDetail),D&&(this.intersectedEventDetail.intersection=V,J(this.intersectedEventDetail),D.emit(I,this.intersectedEventDetail))}})},"./src/components/daydream-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b="https://cdn.aframe.io/controllers/google/",S=b+"vr_controller_daydream.obj",I=b+"vr_controller_daydream.mtl",O=E("./src/utils/index.js").device.isWebXRAvailable,_="google-daydream",D="Daydream Controller",V=O?_:D,J={axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},Y={axes:{touchpad:[0,1]},buttons:["none","none","touchpad","menu","system"]},W=O?Y:J;Z.exports.Component=B("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:W,bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var U=this;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(q){M(q.detail.id,"down",U)},this.onButtonUp=function(q){M(q.detail.id,"up",U)},this.onButtonTouchStart=function(q){M(q.detail.id,"touchstart",U)},this.onButtonTouchEnd=function(q){M(q.detail.id,"touchend",U)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var U=this.el;U.addEventListener("buttonchanged",this.onButtonChanged),U.addEventListener("buttondown",this.onButtonDown),U.addEventListener("buttonup",this.onButtonUp),U.addEventListener("touchstart",this.onButtonTouchStart),U.addEventListener("touchend",this.onButtonTouchEnd),U.addEventListener("model-loaded",this.onModelLoaded),U.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var U=this.el;U.removeEventListener("buttonchanged",this.onButtonChanged),U.removeEventListener("buttondown",this.onButtonDown),U.removeEventListener("buttonup",this.onButtonUp),U.removeEventListener("touchstart",this.onButtonTouchStart),U.removeEventListener("touchend",this.onButtonTouchEnd),U.removeEventListener("model-loaded",this.onModelLoaded),U.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){F(this,V,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var U=this.el,q=this.data;U.setAttribute("tracked-controls",{armModel:q.armModel,hand:q.hand,idPrefix:V,id:V,orientationOffset:q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:S,mtl:I})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(U){var q=U.detail.model,oe;this.data.model&&(oe=this.buttonMeshes={},oe.menu=q.getObjectByName("AppButton_AppButton_Cylinder.004"),oe.system=q.getObjectByName("HomeButton_HomeButton_Cylinder.005"),oe.trackpad=q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),oe.touchpad=q.getObjectByName("TouchPad_TouchPad_Cylinder.003"),q.position.set(0,0,-.04))},onAxisMoved:function(U){L(this,this.mapping.axes,U)},onButtonChanged:function(U){var q=this.mapping.buttons[U.detail.id];q&&this.el.emit(q+"changed",U.detail.state)},updateModel:function(U,q){this.data.model&&this.updateButtonModel(U,q)},updateButtonModel:function(U,q){var oe=this.buttonMeshes;if(!(!oe||!oe[U])){var ve;switch(q){case"down":ve=this.data.buttonHighlightColor;break;case"touchstart":ve=this.data.buttonTouchedColor;break;default:ve=this.data.buttonColor}oe[U].material.color.set(ve)}}})},"./src/components/gearvr-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b=E("./src/utils/index.js").device.isWebXRAvailable,S="https://cdn.aframe.io/controllers/samsung/",I=S+"gear_vr_controller.obj",O=S+"gear_vr_controller.mtl",_="samsung-gearvr",D="Gear VR",V=b?_:D,J={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},Y={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},W=b?Y:J;Z.exports.Component=B("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:W,bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var U=this;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(q){M(q.detail.id,"down",U)},this.onButtonUp=function(q){M(q.detail.id,"up",U)},this.onButtonTouchStart=function(q){M(q.detail.id,"touchstart",U)},this.onButtonTouchEnd=function(q){M(q.detail.id,"touchend",U)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var U=this.el;U.addEventListener("buttonchanged",this.onButtonChanged),U.addEventListener("buttondown",this.onButtonDown),U.addEventListener("buttonup",this.onButtonUp),U.addEventListener("touchstart",this.onButtonTouchStart),U.addEventListener("touchend",this.onButtonTouchEnd),U.addEventListener("model-loaded",this.onModelLoaded),U.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var U=this.el;U.removeEventListener("buttonchanged",this.onButtonChanged),U.removeEventListener("buttondown",this.onButtonDown),U.removeEventListener("buttonup",this.onButtonUp),U.removeEventListener("touchstart",this.onButtonTouchStart),U.removeEventListener("touchend",this.onButtonTouchEnd),U.removeEventListener("model-loaded",this.onModelLoaded),U.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){F(this,V,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var U=this.el,q=this.data;U.setAttribute("tracked-controls",{armModel:q.armModel,hand:q.hand,idPrefix:V,id:V,orientationOffset:q.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:I,mtl:O})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(U){var q=U.detail.model,oe;this.data.model&&(oe=this.buttonMeshes={},oe.trigger=q.children[2],oe.trackpad=q.children[1],oe.touchpad=q.children[1])},onButtonChanged:function(U){var q=this.mapping.buttons[U.detail.id];q&&this.el.emit(q+"changed",U.detail.state)},onAxisMoved:function(U){L(this,this.mapping.axes,U)},updateModel:function(U,q){this.data.model&&this.updateButtonModel(U,q)},updateButtonModel:function(U,q){var oe=this.buttonMeshes;if(!(!oe||!oe[U])){var ve;switch(q){case"down":ve=this.data.buttonHighlightColor;break;case"touchstart":ve=this.data.buttonTouchedColor;break;default:ve=this.data.buttonColor}oe[U].material.color.set(ve)}}})},"./src/components/generic-tracked-controller-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b="generic",S={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]};Z.exports.Component=B("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},mapping:S,bindMethods:function(){this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var I=this;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(O){M(O.detail.id,"down",I)},this.onButtonUp=function(O){M(O.detail.id,"up",I)},this.onButtonTouchStart=function(O){M(O.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(O){M(O.detail.id,"touchend",I)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods(),this.el.addEventListener("controllerconnected",function(O){O.detail.name!==I.name&&(I.wasControllerConnected=!0,I.removeEventListeners(),I.removeControllersUpdateListener())})},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var I=this.data,O=I.hand?I.hand:void 0;F(this,b,{hand:O,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,O=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}I.setAttribute("tracked-controls",{hand:O.hand,idPrefix:b,orientationOffset:O.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(I){var O=this.mapping.buttons[I.detail.id];O&&this.el.emit(O+"changed",I.detail.state)},onAxisMoved:function(I){L(this,this.mapping.axes,I)},initDefaultModel:function(){var I=this.modelEl=document.createElement("a-entity");I.setAttribute("geometry",{primitive:"sphere",radius:.03}),I.setAttribute("material",{color:this.data.color}),this.el.appendChild(I)}})},"./src/components/geometry.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").geometries,H=E("./src/core/geometry.js").geometryNames,C=E("./src/core/component.js").registerComponent,F=E("./src/lib/three.js"),L=new F.BufferGeometry;Z.exports.Component=C("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:H,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(M){var b=this.data,S=this.el,I,O=this.system;this.geometry&&(O.unuseGeometry(M),this.geometry=null),this.geometry=O.getOrCreateGeometry(b),I=S.getObject3D("mesh"),I?I.geometry=this.geometry:(I=new F.Mesh,I.geometry=this.geometry,this.el.getAttribute("material")||(I.material=new F.MeshStandardMaterial({color:Math.random()*16777215,metalness:0,roughness:.5})),S.setObject3D("mesh",I))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=L,this.geometry=null},updateSchema:function(M){var b=this.oldData&&this.oldData.primitive,S=M.primitive,I=B[S]&&B[S].schema;if(!I)throw new Error("Unknown geometry schema `"+S+"`");b&&b===S||this.extendSchema(I)}})},"./src/components/gltf-model.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=C.debug("components:gltf-model:warn");Z.exports.Component=B("gltf-model",{schema:{type:"model"},init:function(){var L=this,M=this.system.getDRACOLoader(),b=this.system.getMeshoptDecoder(),S=this.system.getKTX2Loader();this.model=null,this.loader=new H.GLTFLoader,M&&this.loader.setDRACOLoader(M),b?this.ready=b.then(function(I){L.loader.setMeshoptDecoder(I)}):this.ready=Promise.resolve(),S&&this.loader.setKTX2Loader(S)},update:function(){var L=this,M=this.el,b=this.data;b&&(this.remove(),this.ready.then(function(){L.loader.load(b,function(I){L.model=I.scene||I.scenes[0],L.model.animations=I.animations,M.setObject3D("mesh",L.model),M.emit("model-loaded",{format:"gltf",model:L.model})},void 0,function(I){var O=I&&I.message?I.message:"Failed to load glTF model";F(O),M.emit("model-error",{format:"gltf",src:b})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},"./src/components/hand-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H={toonLeft:"https://cdn.aframe.io/controllers/hands/leftHand.glb",toonRight:"https://cdn.aframe.io/controllers/hands/rightHand.glb",lowPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandLow.glb",lowPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandLow.glb",highPolyLeft:"https://cdn.aframe.io/controllers/hands/leftHandHigh.glb",highPolyRight:"https://cdn.aframe.io/controllers/hands/rightHandHigh.glb"},C={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},F={};F[C.fist]="grip",F[C.thumbUp]="pistol",F[C.point]="pointing",Z.exports.Component=B("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},init:function(){var b=this,S=this.el;this.gesture=C.open,this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){b.handleButton("grip","down")},this.onGripUp=function(){b.handleButton("grip","up")},this.onTrackpadDown=function(){b.handleButton("trackpad","down")},this.onTrackpadUp=function(){b.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){b.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){b.handleButton("trackpad","touchend")},this.onTriggerDown=function(){b.handleButton("trigger","down")},this.onTriggerUp=function(){b.handleButton("trigger","up")},this.onTriggerTouchStart=function(){b.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){b.handleButton("trigger","touchend")},this.onGripTouchStart=function(){b.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){b.handleButton("grip","touchend")},this.onThumbstickDown=function(){b.handleButton("thumbstick","down")},this.onThumbstickUp=function(){b.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){b.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){b.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){b.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){b.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){b.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){b.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),S.addEventListener("controllerconnected",this.onControllerConnected),S.addEventListener("controllerdisconnected",this.onControllerDisconnected),S.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(b,S){var I=this.el.getObject3D("mesh");!I||!I.mixer||I.mixer.update(S/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var b=this.el;b.addEventListener("gripdown",this.onGripDown),b.addEventListener("gripup",this.onGripUp),b.addEventListener("trackpaddown",this.onTrackpadDown),b.addEventListener("trackpadup",this.onTrackpadUp),b.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),b.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),b.addEventListener("triggerdown",this.onTriggerDown),b.addEventListener("triggerup",this.onTriggerUp),b.addEventListener("triggertouchstart",this.onTriggerTouchStart),b.addEventListener("triggertouchend",this.onTriggerTouchEnd),b.addEventListener("griptouchstart",this.onGripTouchStart),b.addEventListener("griptouchend",this.onGripTouchEnd),b.addEventListener("thumbstickdown",this.onThumbstickDown),b.addEventListener("thumbstickup",this.onThumbstickUp),b.addEventListener("abuttontouchstart",this.onAorXTouchStart),b.addEventListener("abuttontouchend",this.onAorXTouchEnd),b.addEventListener("bbuttontouchstart",this.onBorYTouchStart),b.addEventListener("bbuttontouchend",this.onBorYTouchEnd),b.addEventListener("xbuttontouchstart",this.onAorXTouchStart),b.addEventListener("xbuttontouchend",this.onAorXTouchEnd),b.addEventListener("ybuttontouchstart",this.onBorYTouchStart),b.addEventListener("ybuttontouchend",this.onBorYTouchEnd),b.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),b.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var b=this.el;b.removeEventListener("gripdown",this.onGripDown),b.removeEventListener("gripup",this.onGripUp),b.removeEventListener("trackpaddown",this.onTrackpadDown),b.removeEventListener("trackpadup",this.onTrackpadUp),b.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),b.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),b.removeEventListener("triggerdown",this.onTriggerDown),b.removeEventListener("triggerup",this.onTriggerUp),b.removeEventListener("triggertouchstart",this.onTriggerTouchStart),b.removeEventListener("triggertouchend",this.onTriggerTouchEnd),b.removeEventListener("griptouchstart",this.onGripTouchStart),b.removeEventListener("griptouchend",this.onGripTouchEnd),b.removeEventListener("thumbstickdown",this.onThumbstickDown),b.removeEventListener("thumbstickup",this.onThumbstickUp),b.removeEventListener("abuttontouchstart",this.onAorXTouchStart),b.removeEventListener("abuttontouchend",this.onAorXTouchEnd),b.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),b.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),b.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),b.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),b.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),b.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),b.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),b.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(b){var S,I=this.el,O=this.data.hand,_=this.data.handModelStyle,D=this.data.color,V=this;if(S={hand:O,model:!1},O!==b){var J=H[_+O.charAt(0).toUpperCase()+O.slice(1)];this.loader.load(J,function(Y){var W=Y.scene.children[0],U=O==="left"?Math.PI/2:-Math.PI/2;W.mixer=new THREE.AnimationMixer(W),V.clips=Y.animations,I.setObject3D("mesh",W);var q=W.children[1].material;q.color=new THREE.Color(D),W.position.set(0,0,0),W.rotation.set(0,0,U),I.setAttribute("magicleap-controls",S),I.setAttribute("vive-controls",S),I.setAttribute("oculus-touch-controls",S),I.setAttribute("windows-motion-controls",S),I.setAttribute("hp-mixed-reality-controls",S)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(b,S){var I,O=S==="down",_=S==="touchstart";if(S.indexOf("touch")===0){if(_===this.touchedButtons[b])return;this.touchedButtons[b]=_}else{if(O===this.pressedButtons[b])return;this.pressedButtons[b]=O}I=this.gesture,this.gesture=this.determineGesture(),this.gesture!==I&&(this.animateGesture(this.gesture,I),this.emitGestureEvents(this.gesture,I))},determineGesture:function(){var b,S=this.pressedButtons.grip,I=this.pressedButtons.surface||this.touchedButtons.surface,O=this.pressedButtons.trackpad||this.touchedButtons.trackpad,_=this.pressedButtons.trigger||this.touchedButtons.trigger,D=this.touchedButtons.AorX||this.touchedButtons.BorY,V=M(this.el.components["tracked-controls"]);return V?S||_?b=C.fist:O&&(b=C.point):S?I||D||O?b=_?C.fist:C.point:b=_?C.thumbUp:C.pointThumb:_&&(b=C.hold),b},getClip:function(b){var S,I;for(I=0;I<this.clips.length;I++)if(S=this.clips[I],S.name===b)return S},animateGesture:function(b,S){if(b){this.playAnimation(b||C.open,S,!1);return}this.playAnimation(S,S,!0)},emitGestureEvents:function(b,S){var I=this.el,O;S!==b&&(O=L(S,!1),O&&I.emit(O),O=L(b,!0),O&&I.emit(O))},playAnimation:function(b,S,I){var O,_,D=this.el.getObject3D("mesh"),V;if(D){if(D.mixer.stopAllAction(),O=this.getClip(b),V=D.mixer.clipAction(O),V.clampWhenFinished=!0,V.loop=THREE.LoopRepeat,V.repetitions=0,V.timeScale=I?-1:1,V.time=I?O.duration:0,V.weight=1,!S||b===S){D.mixer.stopAllAction(),V.play();return}O=this.getClip(S),_=D.mixer.clipAction(O),_.weight=.15,_.play(),V.play(),_.crossFadeTo(V,.15,!0)}}});function L(b,S){var I;if(b){if(I=F[b],I==="grip")return I+(S?"close":"open");if(I==="point")return I+(S?"up":"down");if(I==="pointing"||I==="pistol")return I+(S?"start":"end")}}function M(b){var S=b&&b.controller,I=S&&(S.id&&S.id.indexOf("OpenVR ")===0||S.profiles&&S.profiles[0]&&S.profiles[0]==="htc-vive");return I}},"./src/components/hand-tracking-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L="https://cdn.aframe.io/controllers/oculus-hands/v4/left.glb",M="https://cdn.aframe.io/controllers/oculus-hands/v4/right.glb",b=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],S=.015,I=.03,O=.5;Z.exports.Component=B("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"}},bindMethods:function(){this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var _=0;_<this.jointEls.length;++_)this.jointEls[_].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var _=0;_<this.jointEls.length;++_)this.jointEls[_].object3D.visible=!1},init:function(){var _=this.el.sceneEl,D=_.getAttribute("webxr").optionalFeatures;D.push("hand-tracking"),_.setAttribute("webxr",{optionalFeatures:D}),this.onModelLoaded=this.onModelLoaded.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3},this.indexTipPosition=new THREE.Vector3,this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace)},updateReferenceSpace:function(){var _=this,D=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,!!D){var V=_.el.sceneEl.systems.webxr.sessionReferenceSpaceType;D.requestReferenceSpace(V).then(function(J){_.referenceSpace=J.getOffsetReferenceSpace(new XRRigidTransform({x:0,y:1.5,z:0}))}).catch(function(J){throw _.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(V,"tracked-controls-webxr uses reference space "+V),J})}},checkIfControllerPresent:function(){var _=this.data,D=_.hand?_.hand:void 0;F(this,"",{hand:D,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var _=this.el.sceneEl,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,V=_.frame,J=this.el.components["tracked-controls-webxr"];!D||!V||!J||D.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),V.getJointPose&&this.updateHandModel(),this.detectGesture())},updateHandModel:function(){this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(_){for(var D=this.bones,V=0;V<D.length;V++)if(D[V].name===_)return D[V];return null},updateHandMeshModel:function(){var _=this.el.sceneEl.frame,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,V=this.referenceSpace;if(!(!D||!this.mesh||!V)){this.mesh.visible=!1;for(var J of D.hand.values()){var Y,W,U;W=_.getJointPose(J,V),Y=this.getBone(J.jointName),Y!=null&&W&&(U=W.transform,this.mesh.visible=!0,Y.position.copy(U.position),Y.quaternion.copy(U.orientation))}}},updateHandDotsModel:function(){var _=this.el.sceneEl.frame,D=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,V=this.el.components["tracked-controls-webxr"],J=V.system.referenceSpace,Y,W,U,q=0;for(var oe of D.hand.values())Y=this.jointEls[q++],W=Y.object3D,U=_.getJointPose(oe,J),Y.object3D.visible=!!U,U&&(W.matrix.elements=U.transform.matrix,W.matrix.decompose(W.position,W.rotation,W.scale),Y.setAttribute("scale",{x:U.radius,y:U.radius,z:U.radius}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var _=new THREE.Vector3;return function(){var D=this.el.sceneEl.frame,V=this.indexTipPosition,J=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,Y=this.el.components["tracked-controls-webxr"],W=this.referenceSpace||Y.system.referenceSpace,U=J.hand.get("index-finger-tip"),q=J.hand.get("thumb-tip");if(!(!U||!q)){var oe=D.getJointPose(U,W),ve=D.getJointPose(q,W);if(!(!oe||!ve)){_.copy(ve.transform.position),V.copy(oe.transform.position);var Ae=V.distanceTo(_);Ae<S&&this.isPinched===!1&&(this.isPinched=!0,this.pinchEventDetail.position.copy(V).lerp(_,O),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchstarted",this.pinchEventDetail)),Ae>I&&this.isPinched===!0&&(this.isPinched=!1,this.pinchEventDetail.position.copy(V).lerp(_,O),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchended",this.pinchEventDetail)),this.isPinched&&(this.pinchEventDetail.position.copy(V).lerp(_,O),this.pinchEventDetail.position.y+=1.5,this.el.emit("pinchmoved",this.pinchEventDetail)),V.y+=1.5}}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var _=this.el,D=this.data;_.setAttribute("tracked-controls",{hand:D.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var _;this.checkIfControllerPresent(),_=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,this.el.getObject3D("mesh")&&(!_||!_.hand||!_.hand[0])&&(this.el.getObject3D("mesh").visible=!1)},initDefaultModel:function(){this.el.getObject3D("mesh")||(this.data.modelStyle==="dots"&&this.initDotsModel(),this.data.modelStyle==="mesh"&&this.initMeshHandModel())},initDotsModel:function(){if(this.jointEls.length===0)for(var _=0;_<b.length;++_){var D=this.jointEl=document.createElement("a-entity");D.setAttribute("geometry",{primitive:"sphere",radius:1}),D.setAttribute("material",{color:this.data.modelColor}),D.object3D.visible=!1,this.el.appendChild(D),this.jointEls.push(D)}},initMeshHandModel:function(){var _=this.data.hand==="left"?L:M;this.el.setAttribute("gltf-model",_)},onModelLoaded:function(){var _=this.mesh=this.el.getObject3D("mesh").children[0],D=this.skinnedMesh=_.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=D.skeleton.bones,this.el.removeObject3D("mesh"),_.position.set(0,1.5,0),_.rotation.set(0,0,0),D.frustumCulled=!1,D.material=new THREE.MeshStandardMaterial({skinning:!0,color:this.data.modelColor}),this.el.setObject3D("mesh",_))}})},"./src/components/hide-on-enter-ar.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("hide-on-enter-ar",{init:function(){var H=this;this.el.sceneEl.addEventListener("enter-vr",function(){H.el.sceneEl.is("ar-mode")&&(H.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){H.el.object3D.visible=!0})}})},"./src/components/hp-mixed-reality-controls.js":(Z,te,E)=>{var B=E("./src/utils/bind.js"),H=E("./src/core/component.js").registerComponent,C=E("./src/lib/three.js"),F=E("./src/utils/tracked-controls.js"),L=F.checkControllerPresentAndSetup,M=F.emitIfAxesChanged,b=F.onButtonEvent,S="hp-mixed-reality",I="https://cdn.aframe.io/controllers/hp/mixed-reality/",O={x:0,y:0,z:.06},_={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},D={left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}};Z.exports.Component=H("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:D,init:function(){var V=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=B(this.onButtonChanged,this),this.onButtonDown=function(J){b(J.detail.id,"down",V,V.data.hand)},this.onButtonUp=function(J){b(J.detail.id,"up",V,V.data.hand)},this.onButtonTouchEnd=function(J){b(J.detail.id,"touchend",V,V.data.hand)},this.onButtonTouchStart=function(J){b(J.detail.id,"touchstart",V,V.data.hand)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var V=this.data;this.controllerIndex=V.hand==="right"?0:V.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=B(this.onModelLoaded,this),this.onControllersUpdate=B(this.onControllersUpdate,this),this.checkIfControllerPresent=B(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=B(this.removeControllersUpdateListener,this),this.onAxisMoved=B(this.onAxisMoved,this)},addEventListeners:function(){var V=this.el;V.addEventListener("buttonchanged",this.onButtonChanged),V.addEventListener("buttondown",this.onButtonDown),V.addEventListener("buttonup",this.onButtonUp),V.addEventListener("touchstart",this.onButtonTouchStart),V.addEventListener("touchend",this.onButtonTouchEnd),V.addEventListener("axismove",this.onAxisMoved),V.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var V=this.el;V.removeEventListener("buttonchanged",this.onButtonChanged),V.removeEventListener("buttondown",this.onButtonDown),V.removeEventListener("buttonup",this.onButtonUp),V.removeEventListener("touchstart",this.onButtonTouchStart),V.removeEventListener("touchend",this.onButtonTouchEnd),V.removeEventListener("axismove",this.onAxisMoved),V.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var V=this.data;L(this,S,{index:this.controllerIndex,hand:V.hand})},injectTrackedControls:function(){var V=this.el,J=this.data;V.setAttribute("tracked-controls",{idPrefix:S,hand:J.hand,controller:this.controllerIndex,orientationOffset:J.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",I+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(V){var J=this.mapping[this.data.hand].buttons[V.detail.id],Y;J&&(J==="trigger"&&(Y=V.detail.state.value,console.log("analog value of trigger press: "+Y)),this.el.emit(J+"changed",V.detail.state))},onModelLoaded:function(V){var J=V.detail.model;this.data.model&&(J.position.copy(O),J.rotation.copy(_),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new C.Vector3(0,0,0)}))},onAxisMoved:function(V){M(this,this.mapping.axes,V)}})},"./src/components/index.js":(Z,te,E)=>{E("./src/components/animation.js"),E("./src/components/camera.js"),E("./src/components/cursor.js"),E("./src/components/daydream-controls.js"),E("./src/components/gearvr-controls.js"),E("./src/components/geometry.js"),E("./src/components/generic-tracked-controller-controls.js"),E("./src/components/gltf-model.js"),E("./src/components/hand-tracking-controls.js"),E("./src/components/hand-controls.js"),E("./src/components/hide-on-enter-ar.js"),E("./src/components/hp-mixed-reality-controls.js"),E("./src/components/layer.js"),E("./src/components/laser-controls.js"),E("./src/components/light.js"),E("./src/components/line.js"),E("./src/components/link.js"),E("./src/components/look-controls.js"),E("./src/components/magicleap-controls.js"),E("./src/components/material.js"),E("./src/components/obj-model.js"),E("./src/components/oculus-go-controls.js"),E("./src/components/oculus-touch-controls.js"),E("./src/components/position.js"),E("./src/components/raycaster.js"),E("./src/components/rotation.js"),E("./src/components/scale.js"),E("./src/components/shadow.js"),E("./src/components/sound.js"),E("./src/components/text.js"),E("./src/components/tracked-controls.js"),E("./src/components/tracked-controls-webvr.js"),E("./src/components/tracked-controls-webxr.js"),E("./src/components/visible.js"),E("./src/components/valve-index-controls.js"),E("./src/components/vive-controls.js"),E("./src/components/vive-focus-controls.js"),E("./src/components/wasd-controls.js"),E("./src/components/windows-motion-controls.js"),E("./src/components/scene/ar-hit-test.js"),E("./src/components/scene/background.js"),E("./src/components/scene/debug.js"),E("./src/components/scene/device-orientation-permission-ui.js"),E("./src/components/scene/embedded.js"),E("./src/components/scene/inspector.js"),E("./src/components/scene/fog.js"),E("./src/components/scene/keyboard-shortcuts.js"),E("./src/components/scene/pool.js"),E("./src/components/scene/reflection.js"),E("./src/components/scene/screenshot.js"),E("./src/components/scene/stats.js"),E("./src/components/scene/vr-mode-ui.js")},"./src/components/laser-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/index.js");B("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var C=this.config,F=this.data,L=this.el,M=this,b={hand:F.hand,model:F.model};L.setAttribute("daydream-controls",b),L.setAttribute("gearvr-controls",b),L.setAttribute("hp-mixed-reality-controls",b),L.setAttribute("magicleap-controls",b),L.setAttribute("oculus-go-controls",b),L.setAttribute("oculus-touch-controls",b),L.setAttribute("valve-index-controls",b),L.setAttribute("vive-controls",b),L.setAttribute("vive-focus-controls",b),L.setAttribute("windows-motion-controls",b),L.setAttribute("generic-tracked-controller-controls",{hand:b.hand}),L.addEventListener("controllerconnected",S),L.addEventListener("controllerdisconnected",I),L.addEventListener("controllermodelready",function(O){S(O),M.modelReady=!0});function S(O){var _=C[O.detail.name];if(_){var D=H.extend({showLine:!0},_.raycaster||{});O.detail.rayOrigin&&(D.origin=O.detail.rayOrigin.origin,D.direction=O.detail.rayOrigin.direction,D.showLine=!0),O.detail.rayOrigin||!M.modelReady?L.setAttribute("raycaster",D):L.setAttribute("raycaster","showLine",!0),L.setAttribute("cursor",H.extend({fuse:!1},_.cursor))}}function I(){L.setAttribute("raycaster","showLine",!1)}},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"gearvr-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:.001,z:0}}},"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},"./src/components/layer.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/index.js"),C=H.debug("components:layer:warn");Z.exports.Component=B("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var L=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=L.createFramebuffer();var M=this.el.sceneEl.getAttribute("webxr").requiredFeatures;M.push("layers"),this.el.sceneEl.getAttribute("webxr","requiredFeatures",M),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(L){this.data.src!==L.src&&this.updateSrc()},updateSrc:function(){var L=this.data.type;if(this.texture=void 0,L==="quad"){this.loadQuadImage();return}if(L==="monocubemap"||L==="stereocubemap"){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var L,M=this.xrGLFactory,b=this.el.sceneEl.frame,S=this.data.src,I=this.data.type;this.visibilityChanged=!1,this.layer&&(I!=="monocubemap"&&I!=="stereocubemap"||(S.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,I==="monocubemap"?(L=M.getSubImage(this.layer,b),this.loadCubeMapImage(L.colorTexture,S,0)):(L=M.getSubImage(this.layer,b,"left"),this.loadCubeMapImage(L.colorTexture,S,0),L=M.getSubImage(this.layer,b,"right"),this.loadCubeMapImage(L.colorTexture,S,6))))},loadQuadImage:function(){var L=this.data.src,M=this;this.el.sceneEl.systems.material.loadTexture(L,{src:L},function(S){M.el.sceneEl.renderer.initTexture(S),M.texture=S,L.tagName==="VIDEO"&&setTimeout(function(){M.textureIsVideo=!0},1e3),M.layer&&(M.layer.height=M.data.height/2||M.texture.image.height/1e3,M.layer.width=M.data.width/2||M.texture.image.width/1e3,M.needsRedraw=!0),M.updateQuadPanel()})},preGenerateCubeMapTextures:function(L,M){this.data.type==="monocubemap"?this.generateCubeMapTextures(L,0,M):(this.generateCubeMapTextures(L,0,M),this.generateCubeMapTextures(L,6,M))},generateCubeMapTextures:function(L,M,b){for(var S=this.data,I=this.cubeFaceSize,O=Math.min(L.width,L.height),_=[],D,V,J=0;J<6;J++){var Y=document.createElement("CANVAS");Y.width=Y.height=I;var W=Y.getContext("2d");S.rotateCubemap&&(J===2||J===3)&&(W.save(),W.translate(I,I),W.rotate(Math.PI)),W.drawImage(L,(J+M)*O,0,O,O,0,0,I,I),W.restore(),b&&b(),_.push(Y)}return S.rotateCubemap&&(D=_[0],V=_[1],_[0]=V,_[1]=D,D=_[4],V=_[5],_[4]=V,_[5]=D),b&&b(),_},loadCubeMapImage:function(L,M,b){var S=this.el.sceneEl.renderer.getContext(),I;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,!1),S.bindTexture(S.TEXTURE_CUBE_MAP,L),!M.complete||this.loadingScreen?I=this.loadingScreenImages:I=this.generateCubeMapTextures(M,b);var O=0;I.forEach(function(_,D){S.texSubImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+D,0,0,0,S.RGBA,S.UNSIGNED_BYTE,_),O=S.getError()}),O!==0&&console.log("renderingError, WebGL Error Code: "+O),S.bindTexture(S.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&(!this.layer&&this.el.sceneEl.is("vr-mode")&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),!(!this.needsRedraw&&!this.layer.needsRedraw&&!this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var L=this,M=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(b){L.visibilityChanged=b.session.visibilityState!=="hidden"},M==="quad"){this.initQuadLayer();return}if(M==="monocubemap"||M==="stereocubemap"){this.initCubeMapLayer();return}},initQuadLayer:function(){var L=this.el.sceneEl,M=L.renderer.getContext(),b=this.xrGLFactory=new XRWebGLBinding(L.xrSession,M);this.texture&&(this.layer=b.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),L.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var L=this.data.src,M=this.el.sceneEl,b=M.renderer.getContext(),S=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),I=this.cubeFaceSize=Math.min(S,Math.min(L.width,L.height)),O=this.xrGLFactory=new XRWebGLBinding(M.xrSession,b);this.layer=O.createCubeLayer({space:this.referenceSpace,viewPixelWidth:I,viewPixelHeight:I,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),M.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var L=this.cubeFaceSize,M=this.loadingScreenImages=[],b=0;b<6;b++){var S=document.createElement("CANVAS");S.width=S.height=L;var I=S.getContext("2d");S.width=S.height=L,I.fillStyle="black",I.fillRect(0,0,L,L),b!==2&&b!==3&&(I.translate(L,0),I.scale(-1,1),I.fillStyle="white",I.font="30px Arial",I.fillText("Loading",L/2,L/2)),M.push(S)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(L){this.layerEnabled=L,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var L=this.quadPanelEl;this.quadPanelEl||(L=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(L)),L.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),L.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var L=this.el.sceneEl,M=this.el.sceneEl.renderer.getContext(),b=this.xrGLFactory.getSubImage(this.layer,L.frame),S=L.renderer.properties.get(this.texture).__webglTexture,I=M.getParameter(M.FRAMEBUFFER_BINDING);M.viewport(b.viewport.x,b.viewport.y,b.viewport.width,b.viewport.height),M.bindFramebuffer(M.FRAMEBUFFER,this.frameBuffer),M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,b.colorTexture,0),F(M,S,b,this.data.src),M.bindFramebuffer(M.FRAMEBUFFER,I)},updateTransform:function(){var L=this.el,M=this.position,b=this.quaternion;L.object3D.updateMatrixWorld(),M.setFromMatrixPosition(L.object3D.matrixWorld),b.setFromRotationMatrix(L.object3D.matrixWorld),this.layerEnabled||M.set(0,0,1e8),this.layer.transform=new XRRigidTransform(M,b)},onEnterVR:function(){var L=this.el.sceneEl,M=L.xrSession;if(!L.hasWebXR||!XRWebGLBinding||!M){C("The layer component requires WebXR and the layers API enabled");return}M.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.needsRedraw=!0,this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(L){this.referenceSpace=L}});function F(L,M,b,S){var I=L.createFramebuffer();let O=b.viewport.x,_=b.viewport.y,D=b.viewport.x+b.viewport.width,V=b.viewport.y+b.viewport.height;S.tagName==="VIDEO"&&(L.bindTexture(L.TEXTURE_2D,M),L.texSubImage2D(L.TEXTURE_2D,0,0,0,S.width,S.height,L.RGB,L.UNSIGNED_BYTE,S)),L.bindFramebuffer(L.READ_FRAMEBUFFER,I),L.framebufferTexture2D(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,M,0),L.readBuffer(L.COLOR_ATTACHMENT0),L.blitFramebuffer(0,0,S.width,S.height,O,_,D,V,L.COLOR_BUFFER_BIT,L.NEAREST),L.bindFramebuffer(L.READ_FRAMEBUFFER,null),L.deleteFramebuffer(I)}},"./src/components/light.js":(Z,te,E)=>{var B=E("./src/utils/bind.js"),H=E("./src/utils/index.js"),C=H.diff,F=E("./src/utils/debug.js"),L=E("./src/core/component.js").registerComponent,M=E("./src/lib/three.js"),b=E("./src/utils/math.js"),S=M.MathUtils.degToRad,I=F("components:light:warn"),O=new M.CubeTextureLoader,_={};Z.exports.Component=L("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var D=this.el;this.light=null,this.defaultTarget=null,this.rendererSystem=this.el.sceneEl.systems.renderer,this.system.registerLight(D)},update:function(D){var V=this.data,J=C(V,D),Y=this.light,W=this.rendererSystem,U=this;if(Y&&!("type"in J)){var q=!1;Object.keys(J).forEach(function(oe){var ve=V[oe];switch(oe){case"color":{Y.color.set(ve),W.applyColorCorrection(Y.color);break}case"groundColor":{Y.groundColor.set(ve),W.applyColorCorrection(Y.groundColor);break}case"angle":{Y.angle=S(ve);break}case"target":{ve===null?(V.type==="spot"||V.type==="directional")&&(Y.target=U.defaultTarget):ve.hasLoaded?U.onSetTarget(ve,Y):ve.addEventListener("loaded",B(U.onSetTarget,U,ve,Y));break}case"envMap":U.updateProbeMap(V,Y);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":q||(U.updateShadow(),q=!0);break;case"shadowCameraAutomatic":V.shadowCameraAutomatic?U.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(V.shadowCameraAutomatic)):U.shadowCameraAutomaticEls=[];break;default:Y[oe]=ve}});return}this.setLight(this.data),this.updateShadow()},tick:function(){var D=new M.Box3,V=new M.Vector3,J=new M.Vector3,Y=new M.Matrix4,W=new M.Sphere,U=new M.Vector3;return function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof M.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var q=this.light.shadow.camera;q.getWorldDirection(V),q.getWorldPosition(J),Y.copy(q.matrixWorld),Y.invert(),q.near=1,q.left=1e5,q.right=-1e5,q.top=-1e5,q.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(oe){D.setFromObject(oe.object3D),D.getBoundingSphere(W);var ve=b.distanceOfPointFromPlane(J,V,W.center),Ae=b.nearestPointInPlane(J,V,W.center,U),Se=Ae.applyMatrix4(Y);q.near=Math.min(-ve-W.radius-1,q.near),q.left=Math.min(-W.radius+Se.x,q.left),q.right=Math.max(W.radius+Se.x,q.right),q.top=Math.max(W.radius+Se.y,q.top),q.bottom=Math.min(-W.radius+Se.y,q.bottom)}),q.updateProjectionMatrix()}}}(),setLight:function(D){var V=this.el,J=this.getLight(D);J&&(this.light&&V.removeObject3D("light"),this.light=J,this.light.el=V,V.setObject3D("light",this.light),(D.type==="spot"||D.type==="directional"||D.type==="hemisphere")&&V.getObject3D("light").translateY(-1),D.type==="spot"&&(V.setObject3D("light-target",this.defaultTarget),V.getObject3D("light-target").position.set(0,0,-1)),D.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(D.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var D=this.el,V=this.data,J=this.light;J.castShadow=V.castShadow;var Y=D.getObject3D("cameraHelper");if(V.shadowCameraVisible&&!Y?D.setObject3D("cameraHelper",new M.CameraHelper(J.shadow.camera)):!V.shadowCameraVisible&&Y&&D.removeObject3D("cameraHelper"),!V.castShadow)return J;J.shadow.bias=V.shadowBias,J.shadow.radius=V.shadowRadius,J.shadow.mapSize.height=V.shadowMapHeight,J.shadow.mapSize.width=V.shadowMapWidth,J.shadow.camera.near=V.shadowCameraNear,J.shadow.camera.far=V.shadowCameraFar,J.shadow.camera instanceof M.OrthographicCamera?(J.shadow.camera.top=V.shadowCameraTop,J.shadow.camera.right=V.shadowCameraRight,J.shadow.camera.bottom=V.shadowCameraBottom,J.shadow.camera.left=V.shadowCameraLeft):J.shadow.camera.fov=V.shadowCameraFov,J.shadow.camera.updateProjectionMatrix(),Y&&Y.update()},getLight:function(D){var V=D.angle,J=new M.Color(D.color);this.rendererSystem.applyColorCorrection(J),J=J.getHex();var Y=D.decay,W=D.distance,U=new M.Color(D.groundColor);this.rendererSystem.applyColorCorrection(U),U=U.getHex();var q=D.intensity,oe=D.type,ve=D.target,Ae=null;switch(oe.toLowerCase()){case"ambient":return new M.AmbientLight(J,q);case"directional":return Ae=new M.DirectionalLight(J,q),this.defaultTarget=Ae.target,ve&&(ve.hasLoaded?this.onSetTarget(ve,Ae):ve.addEventListener("loaded",B(this.onSetTarget,this,ve,Ae))),Ae;case"hemisphere":return new M.HemisphereLight(J,U,q);case"point":return new M.PointLight(J,q,W,Y);case"spot":return Ae=new M.SpotLight(J,q,W,S(V),D.penumbra,Y),this.defaultTarget=Ae.target,ve&&(ve.hasLoaded?this.onSetTarget(ve,Ae):ve.addEventListener("loaded",B(this.onSetTarget,this,ve,Ae))),Ae;case"probe":return Ae=new M.LightProbe,this.updateProbeMap(D,Ae),Ae;default:I("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",oe)}},updateProbeMap:function(D,V){D.envMap||V.copy(new M.LightProbe),_[D.envMap]instanceof window.Promise&&_[D.envMap].then(function(J){V.copy(J)}),_[D.envMap]instanceof M.LightProbe&&V.copy(_[D.envMap]),_[D.envMap]=new window.Promise(function(J){H.srcLoader.validateCubemapSrc(D.envMap,function(W){O.load(W,function(U){var q=M.LightProbeGenerator.fromCubeTexture(U);_[D.envMap]=q,V.copy(q)})})})},onSetTarget:function(D,V){V.target=D.object3D},remove:function(){var D=this.el;D.removeObject3D("light"),D.getObject3D("cameraHelper")&&D.removeObject3D("cameraHelper")}})},"./src/components/line.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var C=this.data,F,L;this.rendererSystem=this.el.sceneEl.systems.renderer,L=this.material=new THREE.LineBasicMaterial({color:C.color,opacity:C.opacity,transparent:C.opacity<1,visible:C.visible}),F=this.geometry=new THREE.BufferGeometry,F.setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.rendererSystem.applyColorCorrection(L.color),this.line=new THREE.Line(F,L),this.el.setObject3D(this.attrName,this.line)},update:function(C){var F=this.data,L=this.geometry,M=!1,b=this.material,S=L.attributes.position.array;H(F.start,C.start)||(S[0]=F.start.x,S[1]=F.start.y,S[2]=F.start.z,M=!0),H(F.end,C.end)||(S[3]=F.end.x,S[4]=F.end.y,S[5]=F.end.z,M=!0),M&&(L.attributes.position.needsUpdate=!0,L.computeBoundingSphere()),b.color.setStyle(F.color),this.rendererSystem.applyColorCorrection(b.color),b.opacity=F.opacity,b.transparent=F.opacity<1,b.visible=F.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}});function H(C,F){return!C||!F?!1:C.x===F.x&&C.y===F.y&&C.z===F.z}},"./src/components/link.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/core/shader.js").registerShader,C=E("./src/lib/three.js");Z.exports.Component=B("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new C.Quaternion,this.hiddenEls=[]},update:function(F){var L=this.data,M=this.el,b,S;L.visualAspectEnabled&&(this.initVisualAspect(),b=L.highlighted?L.highlightedColor:L.backgroundColor,S=L.highlighted?L.highlightedColor:L.borderColor,M.setAttribute("material","backgroundColor",b),M.setAttribute("material","strokeColor",S),L.on!==F.on&&this.updateEventListener(),F.peekMode!==void 0&&L.peekMode!==F.peekMode&&this.updatePeekMode(),!(!L.image||F.image===L.image)&&M.setAttribute("material","pano",typeof L.image=="string"?L.image:L.image.src))},updatePeekMode:function(){var F=this.el,L=this.sphereEl;this.data.peekMode?(this.hideAll(),F.getObject3D("mesh").visible=!1,L.setAttribute("visible",!0)):(this.showAll(),F.getObject3D("mesh").visible=!0,L.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var F=this.el;F.isPlaying&&(this.removeEventListener(),F.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var F=this.data.on;F&&this.el.removeEventListener(F,this.navigate)},initVisualAspect:function(){var F=this.el,L,M,b;!this.data.visualAspectEnabled||this.visualAspectInitialized||(b=this.textEl=this.textEl||document.createElement("a-entity"),M=this.sphereEl=this.sphereEl||document.createElement("a-entity"),L=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),F.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),F.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),b.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),b.setAttribute("position","0 1.5 0"),F.appendChild(b),L.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),L.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),L.setAttribute("rotation","0 180 0"),L.setAttribute("position","0 0 0"),L.setAttribute("visible",!1),F.appendChild(L),M.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),M.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),M.setAttribute("visible",!1),F.appendChild(M),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var F=new C.Vector3,L=new C.Vector3,M=new C.Quaternion,b=new C.Vector3;return function(){var S=this.el,I=S.object3D,O=S.sceneEl.camera,_,D,V=this.textEl;if(this.data.visualAspectEnabled)if(I.updateMatrixWorld(),O.parent.updateMatrixWorld(),O.updateMatrixWorld(),I.matrix.decompose(L,M,b),L.setFromMatrixPosition(I.matrixWorld),F.setFromMatrixPosition(O.matrixWorld),D=L.distanceTo(F),D>20)this.previousQuaternion||(this.quaternionClone.copy(M),this.previousQuaternion=this.quaternionClone),I.lookAt(F);else{if(_=this.calculateCameraPortalOrientation(),D<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;V.setAttribute("text","width",1.5),_<=0?(V.setAttribute("position","0 0 0.75"),V.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(V.setAttribute("position","0 0 -0.75"),V.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),S.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=_}else _<=0?V.setAttribute("rotation","0 180 0"):V.setAttribute("rotation","0 0 0"),V.setAttribute("text","width",5),V.setAttribute("position","0 1.5 0"),S.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(I.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var F=this.el,L=this.hiddenEls,M=this;L.length>0||F.sceneEl.object3D.traverse(function(b){b&&b.el&&b.el.hasAttribute("link-controls")||!b.el||b===F.sceneEl.object3D||b.el===F||b.el===M.sphereEl||b.el===F.sceneEl.cameraEl||b.el.getAttribute("visible")===!1||b.el===M.textEl||b.el===M.semiSphereEl||(b.el.setAttribute("visible",!1),L.push(b.el))})},showAll:function(){this.hiddenEls.forEach(function(F){F.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var F=new C.Matrix4,L=new C.Vector3,M=new C.Vector3(0,0,1),b=new C.Vector3(0,0,0);return function(){var S=this.el,I=S.sceneEl.camera;return L.set(0,0,0),M.set(0,0,1),b.set(0,0,0),S.object3D.matrixWorld.extractRotation(F),M.applyMatrix4(F),S.object3D.updateMatrixWorld(),S.object3D.localToWorld(b),I.parent.parent.updateMatrixWorld(),I.parent.updateMatrixWorld(),I.updateMatrixWorld(),I.localToWorld(L),L.sub(b).normalize(),M.normalize(),Math.sign(M.dot(L))}}(),remove:function(){this.removeEventListener()}}),H("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join(`
`)})},"./src/components/look-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=C.bind,L=Math.PI/2;Z.exports.Component=B("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new H.Vector3,this.hmdQuaternion=new H.Quaternion,this.magicWindowAbsoluteEuler=new H.Euler,this.magicWindowDeltaEuler=new H.Euler,this.position=new H.Vector3,this.magicWindowObject=new H.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new H.Vector3,rotation:new H.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var M,b=this.data;(C.device.isMobile()||C.device.isMobileDeviceRequestingDesktopSite())&&(M=this.magicWindowControls=new H.DeviceOrientationControls(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(M.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?M.enabled=b.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){M.enabled=b.magicWindowTrackingEnabled})))},update:function(M){var b=this.data;b.enabled!==M.enabled&&this.updateGrabCursor(b.enabled),M&&!b.magicWindowTrackingEnabled&&M.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=b.magicWindowTrackingEnabled),M&&!b.pointerLockEnabled!==M.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(M){var b=this.data;b.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=F(this.onMouseDown,this),this.onMouseMove=F(this.onMouseMove,this),this.onMouseUp=F(this.onMouseUp,this),this.onTouchStart=F(this.onTouchStart,this),this.onTouchMove=F(this.onTouchMove,this),this.onTouchEnd=F(this.onTouchEnd,this),this.onEnterVR=F(this.onEnterVR,this),this.onExitVR=F(this.onExitVR,this),this.onPointerLockChange=F(this.onPointerLockChange,this),this.onPointerLockError=F(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new H.Object3D,this.yawObject=new H.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var M=this.el.sceneEl,b=M.canvas;if(!b){M.addEventListener("render-target-loaded",F(this.addEventListeners,this));return}b.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),b.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),M.addEventListener("enter-vr",this.onEnterVR),M.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var M=this.el.sceneEl,b=M&&M.canvas;b&&(b.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),b.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),M.removeEventListener("enter-vr",this.onEnterVR),M.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var M=this.el.object3D,b=this.pitchObject,S=this.yawObject,I=this.el.sceneEl;(I.is("vr-mode")||I.is("ar-mode"))&&I.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),M.rotation.x=this.magicWindowDeltaEuler.x+b.rotation.x,M.rotation.y=this.magicWindowDeltaEuler.y+S.rotation.y,M.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var M=this.magicWindowAbsoluteEuler,b=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),M.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),!this.previousMagicWindowYaw&&M.y!==0&&(this.previousMagicWindowYaw=M.y),this.previousMagicWindowYaw&&(b.x=M.x,b.y+=M.y-this.previousMagicWindowYaw,b.z=M.z,this.previousMagicWindowYaw=M.y))},onMouseMove:function(M){var b,S,I,O=this.pitchObject,_=this.previousMouseEvent,D=this.yawObject;!this.data.enabled||!this.mouseDown&&!this.pointerLocked||(this.pointerLocked?(S=M.movementX||M.mozMovementX||0,I=M.movementY||M.mozMovementY||0):(S=M.screenX-_.screenX,I=M.screenY-_.screenY),this.previousMouseEvent.screenX=M.screenX,this.previousMouseEvent.screenY=M.screenY,b=this.data.reverseMouseDrag?1:-1,D.rotation.y+=S*.002*b,O.rotation.x+=I*.002*b,O.rotation.x=Math.max(-L,Math.min(L,O.rotation.x)))},onMouseDown:function(M){var b=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(b.is("vr-mode")||b.is("ar-mode"))&&b.checkHeadsetConnected())&&M.button===0){var S=b&&b.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=M.screenX,this.previousMouseEvent.screenY=M.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(S.requestPointerLock?S.requestPointerLock():S.mozRequestPointerLock&&S.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(M){M.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:M.touches[0].pageX,y:M.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(M){var b,S=this.el.sceneEl.canvas,I,O=this.yawObject;!this.touchStarted||!this.data.touchEnabled||(I=2*Math.PI*(M.touches[0].pageX-this.touchStart.x)/S.clientWidth,b=this.data.reverseTouchDrag?1:-1,O.rotation.y-=I*.5*b,this.touchStart={x:M.touches[0].pageX,y:M.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var M=this.el.sceneEl;M.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),M.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(M){var b=this.el.sceneEl;function S(){b.canvas.classList.add("a-grab-cursor")}function I(){b.canvas.classList.remove("a-grab-cursor")}if(!b.canvas){M?b.addEventListener("render-target-loaded",S):b.addEventListener("render-target-loaded",I);return}if(M){S();return}I()},saveCameraPose:function(){var M=this.el;this.savedPose.position.copy(M.object3D.position),this.savedPose.rotation.copy(M.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var M=this.el,b=this.savedPose;this.hasSavedPose&&(M.object3D.position.copy(b.position),M.object3D.rotation.copy(b.rotation),this.hasSavedPose=!1)}})},"./src/components/magicleap-controls.js":(Z,te,E)=>{var B=E("./src/utils/bind.js"),H=E("./src/core/component.js").registerComponent,C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b="magicleap",S="-one",I=b+S,O="https://cdn.aframe.io/controllers/magicleap/magicleap-one-controller.glb",_={axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]};Z.exports.Component=H("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:_,init:function(){var D=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=B(this.onButtonChanged,this),this.onButtonDown=function(V){M(V.detail.id,"down",D)},this.onButtonUp=function(V){M(V.detail.id,"up",D)},this.onButtonTouchEnd=function(V){M(V.detail.id,"touchend",D)},this.onButtonTouchStart=function(V){M(V.detail.id,"touchstart",D)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var D=this.data;this.controllerIndex=D.hand==="right"?0:D.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=B(this.onModelLoaded,this),this.onControllersUpdate=B(this.onControllersUpdate,this),this.checkIfControllerPresent=B(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=B(this.removeControllersUpdateListener,this),this.onAxisMoved=B(this.onAxisMoved,this)},addEventListeners:function(){var D=this.el;D.addEventListener("buttonchanged",this.onButtonChanged),D.addEventListener("buttondown",this.onButtonDown),D.addEventListener("buttonup",this.onButtonUp),D.addEventListener("touchstart",this.onButtonTouchStart),D.addEventListener("touchend",this.onButtonTouchEnd),D.addEventListener("axismove",this.onAxisMoved),D.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var D=this.el;D.removeEventListener("buttonchanged",this.onButtonChanged),D.removeEventListener("buttondown",this.onButtonDown),D.removeEventListener("buttonup",this.onButtonUp),D.removeEventListener("touchstart",this.onButtonTouchStart),D.removeEventListener("touchend",this.onButtonTouchEnd),D.removeEventListener("axismove",this.onAxisMoved),D.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var D=this.data;F(this,I,{index:this.controllerIndex,hand:D.hand})},injectTrackedControls:function(){var D=this.el,V=this.data;D.setAttribute("tracked-controls",{idPrefix:I,hand:V.hand,controller:this.controllerIndex,orientationOffset:V.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",O)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(D){var V=this.mapping.buttons[D.detail.id],J;V&&(V==="trigger"&&(J=D.detail.state.value,console.log("analog value of trigger press: "+J)),this.el.emit(V+"changed",D.detail.state))},onModelLoaded:function(D){var V=D.detail.model;V.scale.set(.01,.01,.01)},onAxisMoved:function(D){L(this,this.mapping.axes,D)},updateModel:function(D,V){},setButtonColor:function(D,V){}})},"./src/components/material.js":(Z,te,E)=>{var B=E("./src/utils/index.js"),H=E("./src/core/component.js"),C=E("./src/lib/three.js"),F=E("./src/core/shader.js"),L=B.debug("components:material:error"),M=H.registerComponent,b=F.shaders,S=F.shaderNames;Z.exports.Component=M("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:S,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0}},init:function(){this.material=null},update:function(V){var J=this.data;(!this.shader||J.shader!==V.shader)&&this.updateShader(J.shader),this.shader.update(this.data),this.updateMaterial(V)},updateSchema:function(V){var J,Y,W,U;Y=V&&V.shader,J=this.oldData&&this.oldData.shader,U=Y||J,W=b[U]&&b[U].schema,W||L("Unknown shader schema "+U),!(J&&Y===J)&&(this.extendSchema(W),this.updateBehavior())},updateBehavior:function(){var V,J=this.el.sceneEl,Y=this.schema,W=this,U;function q(oe,ve){var Ae;for(Ae in U)U[Ae]=oe;W.shader.update(U)}this.tick=void 0,U={};for(V in Y)Y[V].type==="time"&&(this.tick=q,U[V]=!0);J&&(this.tick?J.addBehavior(this):J.removeBehavior(this))},updateShader:function(V){var J=this.data,Y=b[V]&&b[V].Shader,W;if(!Y)throw new Error("Unknown shader "+V);W=this.shader=new Y,W.el=this.el,W.init(J),this.setMaterial(W.material),this.updateSchema(J)},updateMaterial:function(V){var J=this.data,Y=this.material,W;Y.alphaTest=J.alphaTest,Y.depthTest=J.depthTest!==!1,Y.depthWrite=J.depthWrite!==!1,Y.opacity=J.opacity,Y.flatShading=J.flatShading,Y.side=I(J.side),Y.transparent=J.transparent!==!1||J.opacity<1,Y.vertexColors=O(J.vertexColors),Y.visible=J.visible,Y.blending=_(J.blending),Y.dithering=J.dithering;for(W in V)break;W&&(V.alphaTest!==J.alphaTest||V.side!==J.side||V.vertexColors!==J.vertexColors)&&(Y.needsUpdate=!0)},remove:function(){var V=new C.MeshBasicMaterial,J=this.material,Y=this.el.getObject3D("mesh");Y&&(Y.material=V),D(J,this.system)},setMaterial:function(V){var J=this.el,Y,W=this.system;this.material&&D(this.material,W),this.material=V,W.registerMaterial(V),Y=J.getObject3D("mesh"),Y?Y.material=V:J.addEventListener("object3dset",function U(q){q.detail.type!=="mesh"||q.target!==J||(J.getObject3D("mesh").material=V,J.removeEventListener("object3dset",U))})}});function I(V){switch(V){case"back":return C.BackSide;case"double":return C.DoubleSide;default:return C.FrontSide}}function O(V){switch(V){case"face":return C.FaceColors;case"vertex":return C.VertexColors;default:return C.NoColors}}function _(V){switch(V){case"none":return C.NoBlending;case"additive":return C.AdditiveBlending;case"subtractive":return C.SubtractiveBlending;case"multiply":return C.MultiplyBlending;default:return C.NormalBlending}}function D(V,J){V.dispose(),J.unregisterMaterial(V)}},"./src/components/obj-model.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=E("./src/core/component.js").registerComponent,C=E("./src/lib/three.js"),F=B("components:obj-model:warn");Z.exports.Component=H("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var L=this;this.model=null,this.objLoader=new C.OBJLoader,this.mtlLoader=new C.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(M){L.model&&M.detail.name==="material"&&L.applyMaterial()})},update:function(){var L=this.data;L.obj&&(this.resetMesh(),this.loadObj(L.obj,L.mtl))},remove:function(){this.model&&this.resetMesh()},resetMesh:function(){this.el.removeObject3D("mesh")},loadObj:function(L,M){var b=this,S=this.el,I=this.mtlLoader,O=this.objLoader,_=this.el.sceneEl.systems.renderer,D=M.substr(0,M.lastIndexOf("/")+1);if(M){S.hasAttribute("material")&&F("Material component properties are ignored when a .MTL is provided"),I.setResourcePath(D),I.load(M,function(V){V.preload(),O.setMaterials(V),O.load(L,function(J){b.model=J,b.model.traverse(function(Y){if(Y.isMesh){var W=Y.material;W.color&&_.applyColorCorrection(W.color),W.map&&_.applyColorCorrection(W.map),W.emissive&&_.applyColorCorrection(W.emissive),W.emissiveMap&&_.applyColorCorrection(W.emissiveMap)}}),S.setObject3D("mesh",J),S.emit("model-loaded",{format:"obj",model:J})})});return}O.load(L,function(J){b.model=J,b.applyMaterial(),S.setObject3D("mesh",J),S.emit("model-loaded",{format:"obj",model:J})})},applyMaterial:function(){var L=this.el.components.material;L&&this.model.traverse(function(M){M instanceof C.Mesh&&(M.material=L.material)})}})},"./src/components/oculus-go-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b=E("./src/utils/index.js").device.isWebXRAvailable,S="oculus-go",I="Oculus Go",O="https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf",_=b?S:I,D={axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},V={axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},J=b?V:D;Z.exports.Component=B("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:J,bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var Y=this;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(W){M(W.detail.id,"down",Y)},this.onButtonUp=function(W){M(W.detail.id,"up",Y)},this.onButtonTouchStart=function(W){M(W.detail.id,"touchstart",Y)},this.onButtonTouchEnd=function(W){M(W.detail.id,"touchend",Y)},this.controllerPresent=!1,this.lastControllerCheck=0,this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},addEventListeners:function(){var Y=this.el;Y.addEventListener("buttonchanged",this.onButtonChanged),Y.addEventListener("buttondown",this.onButtonDown),Y.addEventListener("buttonup",this.onButtonUp),Y.addEventListener("touchstart",this.onButtonTouchStart),Y.addEventListener("touchend",this.onButtonTouchEnd),Y.addEventListener("model-loaded",this.onModelLoaded),Y.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Y=this.el;Y.removeEventListener("buttonchanged",this.onButtonChanged),Y.removeEventListener("buttondown",this.onButtonDown),Y.removeEventListener("buttonup",this.onButtonUp),Y.removeEventListener("touchstart",this.onButtonTouchStart),Y.removeEventListener("touchend",this.onButtonTouchEnd),Y.removeEventListener("model-loaded",this.onModelLoaded),Y.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){F(this,_,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var Y=this.el,W=this.data;Y.setAttribute("tracked-controls",{armModel:W.armModel,hand:W.hand,idPrefix:_,orientationOffset:W.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",O)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(Y){var W=Y.detail.model,U;this.data.model&&(U=this.buttonMeshes={},U.trigger=W.getObjectByName("oculus_go_button_trigger"),U.trackpad=W.getObjectByName("oculus_go_touchpad"),U.touchpad=W.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(Y){var W=this.mapping.buttons[Y.detail.id];W&&this.el.emit(W+"changed",Y.detail.state)},onAxisMoved:function(Y){L(this,this.mapping.axes,Y)},updateModel:function(Y,W){this.data.model&&this.updateButtonModel(Y,W)},updateButtonModel:function(Y,W){var U=this.buttonMeshes;if(!(!U||!U[Y])){var q,oe;switch(W){case"down":q=this.data.buttonHighlightColor;break;case"touchstart":q=this.data.buttonTouchedColor;break;default:q=this.data.buttonColor}oe=U[Y],oe.material.color.set(q),this.rendererSystem.applyColorCorrection(oe.material.color)}}})},"./src/components/oculus-touch-controls.js":(Z,te,E)=>{var B=E("./src/utils/bind.js"),H=E("./src/core/component.js").registerComponent,C=E("./src/lib/three.js"),F=E("./src/utils/tracked-controls.js"),L=F.checkControllerPresentAndSetup,M=F.emitIfAxesChanged,b=F.onButtonEvent,S=E("./src/utils/index.js").device.isWebXRAvailable,I="oculus-touch",O="Oculus Touch",_=S?I:O,D="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",V="https://cdn.aframe.io/controllers/meta/",J={left:{modelUrl:D+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new C.Vector3(-.005,.003,-.055),modelPivotRotation:new C.Euler(0,0,0)},right:{modelUrl:D+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new C.Vector3(.005,.003,-.055),modelPivotRotation:new C.Euler(0,0,0)}},Y={left:{modelUrl:D+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new C.Vector3(-.005,.036,-.037),modelPivotRotation:new C.Euler(Math.PI/4.5,0,0)},right:{modelUrl:D+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new C.Vector3(.005,.036,-.037),modelPivotRotation:new C.Euler(Math.PI/4.5,0,0)}},W=S?Y:J,U="oculus-touch",q={"oculus-touch":W,"oculus-touch-v2":{left:{modelUrl:D+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new C.Vector3(0,-.007,-.021),modelPivotRotation:new C.Euler(-Math.PI/4,0,0)},right:{modelUrl:D+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new C.Vector3(0,-.007,-.021),modelPivotRotation:new C.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:D+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new C.Vector3(0,0,0),modelPivotRotation:new C.Euler(0,0,0)},right:{modelUrl:D+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new C.Vector3(0,0,0),modelPivotRotation:new C.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:V+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new C.Vector3(0,0,0),modelPivotRotation:new C.Euler(0,0,0)},right:{modelUrl:V+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new C.Vector3(0,0,0),modelPivotRotation:new C.Euler(0,0,0)}}},oe={left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},ve={left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},Ae=S?ve:oe;Z.exports.Component=H("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:Ae,bindMethods:function(){this.onButtonChanged=B(this.onButtonChanged,this),this.onThumbstickMoved=B(this.onThumbstickMoved,this),this.onModelLoaded=B(this.onModelLoaded,this),this.onControllersUpdate=B(this.onControllersUpdate,this),this.checkIfControllerPresent=B(this.checkIfControllerPresent,this),this.onAxisMoved=B(this.onAxisMoved,this)},init:function(){var Ie=this;this.onButtonDown=function(de){b(de.detail.id,"down",Ie,Ie.data.hand)},this.onButtonUp=function(de){b(de.detail.id,"up",Ie,Ie.data.hand)},this.onButtonTouchStart=function(de){b(de.detail.id,"touchstart",Ie,Ie.data.hand)},this.onButtonTouchEnd=function(de){b(de.detail.id,"touchend",Ie,Ie.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods(),this.triggerEuler=new C.Euler},addEventListeners:function(){var Ie=this.el;Ie.addEventListener("buttonchanged",this.onButtonChanged),Ie.addEventListener("buttondown",this.onButtonDown),Ie.addEventListener("buttonup",this.onButtonUp),Ie.addEventListener("touchstart",this.onButtonTouchStart),Ie.addEventListener("touchend",this.onButtonTouchEnd),Ie.addEventListener("axismove",this.onAxisMoved),Ie.addEventListener("model-loaded",this.onModelLoaded),Ie.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var Ie=this.el;Ie.removeEventListener("buttonchanged",this.onButtonChanged),Ie.removeEventListener("buttondown",this.onButtonDown),Ie.removeEventListener("buttonup",this.onButtonUp),Ie.removeEventListener("touchstart",this.onButtonTouchStart),Ie.removeEventListener("touchend",this.onButtonTouchEnd),Ie.removeEventListener("axismove",this.onAxisMoved),Ie.removeEventListener("model-loaded",this.onModelLoaded),Ie.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){L(this,_,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(Ie){var de=this.data,pe;if(de.model){if(this.displayModel=q[de.controllerType]||q[U],de.controllerType==="auto"){var we=this.el.sceneEl.systems["tracked-controls-webvr"];if(we&&we.vrDisplay){var he=we.vrDisplay.displayName;/^Oculus Quest$/.test(he)&&(this.displayModel=q["oculus-touch-v2"])}else{pe=U;for(var Pe=Object.keys(q),Ve=0;Ve<Ie.profiles.length;Ve++)if(Pe.indexOf(Ie.profiles[Ve])!==-1){pe=Ie.profiles[Ve];break}this.displayModel=q[pe]}}var ze=this.displayModel[de.hand].modelUrl;this.isOculusTouchV3=this.displayModel===q["oculus-touch-v3"],this.el.setAttribute("gltf-model",ze)}},injectTrackedControls:function(Ie){var de=this.data,pe=I,we=de.hand==="right"?"Oculus Touch (Right)":"Oculus Touch (Left)",he=S?pe:we;this.el.setAttribute("tracked-controls",{id:he,hand:de.hand,orientationOffset:de.orientationOffset,handTrackingEnabled:!1,iterateControllerProfiles:!0,space:"gripSpace"}),this.loadModel(Ie)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(Ie){var de=this.mapping[this.data.hand].buttons[Ie.detail.id];if(de){if(this.isOculusTouchV3)this.onButtonChangedV3(Ie);else{var pe=this.buttonMeshes,we;(de==="trigger"||de==="grip")&&(we=Ie.detail.state.value),pe&&(de==="trigger"&&pe.trigger&&(pe.trigger.rotation.x=this.originalXRotationTrigger-we*(Math.PI/26)),de==="grip"&&pe.grip&&(we*=this.data.hand==="left"?-1:1,pe.grip.position.x=this.originalXPositionGrip+we*.004))}this.el.emit(de+"changed",Ie.detail.state)}},clickButtons:["xbutton","ybutton","abutton","bbutton","thumbstick"],onButtonChangedV3:function(Ie){var de=this.mapping[this.data.hand].buttons[Ie.detail.id],pe=this.buttonObjects,we;we=Ie.detail.state.value,we*=this.data.hand==="left"?-1:1,de==="trigger"?(this.triggerEuler.copy(this.buttonRanges.trigger.min.rotation),this.triggerEuler.x+=we*this.buttonRanges.trigger.diff.x,this.triggerEuler.y+=we*this.buttonRanges.trigger.diff.y,this.triggerEuler.z+=we*this.buttonRanges.trigger.diff.z,pe.trigger.setRotationFromEuler(this.triggerEuler)):de==="grip"?pe.grip.position.x=pe.grip.minX+we*.004:this.clickButtons.includes(de)&&(pe[de].position.y=we===0?this.buttonRanges[de].unpressedY:this.buttonRanges[de].pressedY)},onModelLoaded:function(Ie){if(this.data.model){if(this.isOculusTouchV3)this.onOculusTouchV3ModelLoaded(Ie);else{var de=this.controllerObject3D=Ie.detail.model,pe;pe=this.buttonMeshes={},pe.grip=de.getObjectByName("buttonHand"),this.originalXPositionGrip=pe.grip&&pe.grip.position.x,pe.trigger=de.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=pe.trigger&&pe.trigger.rotation.x,pe.thumbstick=de.getObjectByName("stick"),pe.xbutton=de.getObjectByName("buttonX"),pe.abutton=de.getObjectByName("buttonA"),pe.ybutton=de.getObjectByName("buttonY"),pe.bbutton=de.getObjectByName("buttonB")}for(var we in this.buttonMeshes)this.buttonMeshes[we]&&Se(this.buttonMeshes[we]);this.applyOffset(Ie.detail.model),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(Ie){Ie.position.copy(this.displayModel[this.data.hand].modelPivotOffset),Ie.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onOculusTouchV3ModelLoaded:function(Ie){var de=this.controllerObject3D=Ie.detail.model,pe=this.buttonObjects={},we=this.buttonMeshes={},he=this.buttonRanges={};we.grip=de.getObjectByName("squeeze"),pe.grip=de.getObjectByName("xr_standard_squeeze_pressed_value"),he.grip={min:de.getObjectByName("xr_standard_squeeze_pressed_min"),max:de.getObjectByName("xr_standard_squeeze_pressed_max")},pe.grip.minX=pe.grip.position.x,we.thumbstick=de.getObjectByName("thumbstick"),pe.thumbstick=de.getObjectByName("xr_standard_thumbstick_pressed_value"),he.thumbstick={min:de.getObjectByName("xr_standard_thumbstick_pressed_min"),max:de.getObjectByName("xr_standard_thumbstick_pressed_max"),originalRotation:this.buttonObjects.thumbstick.rotation.clone()},he.thumbstick.pressedY=pe.thumbstick.position.y,he.thumbstick.unpressedY=he.thumbstick.pressedY+Math.abs(he.thumbstick.max.position.y)-Math.abs(he.thumbstick.min.position.y),we.trigger=de.getObjectByName("trigger"),pe.trigger=de.getObjectByName("xr_standard_trigger_pressed_value"),he.trigger={min:de.getObjectByName("xr_standard_trigger_pressed_min"),max:de.getObjectByName("xr_standard_trigger_pressed_max")},he.trigger.diff={x:Math.abs(he.trigger.max.rotation.x)-Math.abs(he.trigger.min.rotation.x),y:Math.abs(he.trigger.max.rotation.y)-Math.abs(he.trigger.min.rotation.y),z:Math.abs(he.trigger.max.rotation.z)-Math.abs(he.trigger.min.rotation.z)};var Pe=this.data.hand==="left"?"x":"a",Ve=this.data.hand==="left"?"y":"b",ze=Pe+"button",et=Ve+"button";we[ze]=de.getObjectByName(Pe+"_button"),pe[ze]=de.getObjectByName(Pe+"_button_pressed_value"),he[ze]={min:de.getObjectByName(Pe+"_button_pressed_min"),max:de.getObjectByName(Pe+"_button_pressed_max")},we[et]=de.getObjectByName(Ve+"_button"),pe[et]=de.getObjectByName(Ve+"_button_pressed_value"),he[et]={min:de.getObjectByName(Ve+"_button_pressed_min"),max:de.getObjectByName(Ve+"_button_pressed_max")},he[ze].unpressedY=pe[ze].position.y,he[ze].pressedY=he[ze].unpressedY+Math.abs(he[ze].max.position.y)-Math.abs(he[ze].min.position.y),he[et].unpressedY=pe[et].position.y,he[et].pressedY=he[et].unpressedY-Math.abs(he[et].max.position.y)+Math.abs(he[et].min.position.y)},onAxisMoved:function(Ie){M(this,this.mapping[this.data.hand].axes,Ie)},onThumbstickMoved:function(Ie){if(!(!this.isOculusTouchV3||!this.buttonMeshes||!this.buttonMeshes.thumbstick))for(var de in Ie.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[de]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[de]]-Math.PI/8*Ie.detail[de]*(de==="y"||this.data.hand==="right"?-1:1)},axisMap:{y:"x",x:"z"},updateModel:function(Ie,de){this.data.model&&this.updateButtonModel(Ie,de)},updateButtonModel:function(Ie,de){var pe,we=de==="up"||de==="touchend"?this.buttonMeshes[Ie].originalColor||this.data.buttonColor:de==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,he=this.buttonMeshes;he&&he[Ie]&&(pe=he[Ie],pe.material.color.set(we),this.rendererSystem.applyColorCorrection(pe.material.color))}});function Se(Ie){Ie.traverse(function(de){if(de.type!=="Mesh")return;let pe=de.material.clone();Ie.originalColor=de.material.color,de.material.dispose(),de.material=pe})}},"./src/components/position.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("position",{schema:{type:"vec3"},update:function(){var H=this.el.object3D,C=this.data;H.position.set(C.x,C.y,C.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},"./src/components/raycaster.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=C.debug("components:raycaster:warn"),L=/^[\w\s-.,[\]#]*$/,M={childList:!0,attributes:!0,subtree:!0},b={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};Z.exports.Component=B("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new H.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new H.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new H.Vector3,this.otherLineEndVec3=new H.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(I){var O=this.data,_=this.el,D=this.raycaster;D.far=O.far,D.near=O.near,O.showLine&&(O.far!==I.far||O.origin!==I.origin||O.direction!==I.direction||!I.showLine)&&(this.unitLineEndVec3.copy(O.origin).add(O.direction).normalize(),this.drawLine()),!O.showLine&&I.showLine&&_.removeAttribute("line"),O.objects!==I.objects&&!L.test(O.objects)&&F('[raycaster] Selector "'+O.objects+'" may not update automatically with DOM changes.'),O.objects||F('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),O.autoRefresh!==I.autoRefresh&&_.isPlaying&&(O.autoRefresh?this.addEventListeners():this.removeEventListeners()),I.enabled&&!O.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,M),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var I=this.data,O;O=I.objects?this.el.sceneEl.querySelectorAll(I.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(O),this.dirty=!1},tock:function(I){var O=this.data,_=this.prevCheckTime;O.enabled&&(_&&I-_<O.interval||(this.prevCheckTime=I,this.checkIntersections()))},checkIntersections:function(){var I=this.clearedIntersectedEls,O=this.el,_=this.data,D,V=this.intersectedEls,J,Y=this.intersections,W=this.newIntersectedEls,U=this.newIntersections,q=this.prevIntersectedEls,oe=this.rawIntersections;for(this.dirty&&this.refreshObjects(),S(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),oe.length=0,this.raycaster.intersectObjects(this.objects,!0,oe),Y.length=0,V.length=0,D=0;D<oe.length;D++)J=oe[D],!(_.showLine&&J.object===O.getObject3D("line"))&&J.object.el&&(Y.push(J),V.push(J.object.el));for(U.length=0,W.length=0,D=0;D<Y.length;D++)q.indexOf(Y[D].object.el)===-1&&(U.push(Y[D]),W.push(Y[D].object.el));for(I.length=0,D=0;D<q.length;D++)V.indexOf(q[D])===-1&&(q[D].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail),I.push(q[D]));for(I.length&&O.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail),D=0;D<W.length;D++)W[D].emit(b.INTERSECT,this.intersectedDetail);U.length&&(this.intersectionDetail.els=W,this.intersectionDetail.intersections=U,O.emit(b.INTERSECTION,this.intersectionDetail)),(q.length===0&&Y.length>0||q.length>0&&Y.length===0||q.length&&Y.length&&q[0]!==Y[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=Y,O.emit(b.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),_.showLine&&setTimeout(this.updateLine)},updateLine:function(){var I=this.el,O=this.intersections,_;O.length&&(O[0].object.el===I&&O[1]?_=O[1].distance:_=O[0].distance),this.drawLine(_)},getIntersection:function(I){var O,_;for(O=0;O<this.intersections.length;O++)if(_=this.intersections[O],_.object.el===I)return _;return null},updateOriginDirection:function(){var I=new H.Vector3,O=new H.Vector3;return function(){var D=this.el,V=this.data;if(V.useWorldCoordinates){this.raycaster.set(V.origin,V.direction);return}D.object3D.updateMatrixWorld(),O.setFromMatrixPosition(D.object3D.matrixWorld),(V.origin.x!==0||V.origin.y!==0||V.origin.z!==0)&&(O=D.object3D.localToWorld(O.copy(V.origin))),I.copy(V.direction).transformDirection(D.object3D.matrixWorld).normalize(),this.raycaster.set(O,I)}}(),drawLine:function(I){var O=this.data,_=this.el,D;D=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,I===void 0&&(I=O.far===1/0?1e3:O.far),this.lineData.start=O.origin,this.lineData.end=D.copy(this.unitLineEndVec3).multiplyScalar(I),this.lineData.color=O.lineColor,this.lineData.opacity=O.lineOpacity,_.setAttribute("line",this.lineData)},flattenObject3DMaps:function(I){var O,_,D=this.objects,V=this.el.sceneEl.object3D;function J(W){return W.parent?J(W.parent):W===V}for(D.length=0,_=0;_<I.length;_++){var Y=I[_];if(Y.isEntity&&Y.object3D&&J(Y.object3D))for(O in Y.object3DMap)D.push(Y.getObject3D(O))}return D},clearAllIntersections:function(){var I;for(I=0;I<this.intersectedEls.length;I++)this.intersectedEls[I].emit(b.INTERSECT_CLEAR,this.intersectedClearedDetail);S(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(b.INTERSECTION_CLEAR,this.intersectionClearedDetail)}});function S(I,O){var _;for(I.length=O.length,_=0;_<O.length;_++)I[_]=O[_]}},"./src/components/rotation.js":(Z,te,E)=>{var B=E("./src/lib/three.js").MathUtils.degToRad,H=E("./src/core/component.js").registerComponent;Z.exports.Component=H("rotation",{schema:{type:"vec3"},update:function(){var C=this.data,F=this.el.object3D;F.rotation.set(B(C.x),B(C.y),B(C.z)),F.rotation.order="YXZ"},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},"./src/components/scale.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=1e-5;Z.exports.Component=B("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var C=this.data,F=this.el.object3D,L=C.x===0?H:C.x,M=C.y===0?H:C.y,b=C.z===0?H:C.z;F.scale.set(L,M,b)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},"./src/components/scene/ar-hit-test.js":(Z,te,E)=>{var B="data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",H=E("./src/core/component.js").registerComponent,C=E("./src/lib/three.js"),F=21,L=function(){var I=new C.Quaternion,O=new C.Vector3;function _(D,V,J){V.position.copy(D.transform.position),V.quaternion.copy(D.transform.orientation),O.copy(J),I.copy(D.transform.orientation),O.applyQuaternion(I),V.position.sub(O)}return _}();L.tempFakePose={transform:{orientation:new C.Quaternion,position:new C.Vector3}};function M(I,O){this.renderer=I,this.xrHitTestSource=null,I.xr.addEventListener("sessionend",function(){this.xrHitTestSource=null}.bind(this)),I.xr.addEventListener("sessionstart",function(){this.sessionStart(O)}.bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(O)}M.prototype.previousFrameAnchors=new Set,M.prototype.anchorToObject3D=new Map;function b(I){console.warn(I.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}M.prototype.sessionStart=function(O){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){b({message:"No requestHitTestSource on the session."});return}O.space?this.session.requestHitTestSource(O).then(function(_){this.xrHitTestSource=_}.bind(this)).catch(b):O.profile&&this.session.requestHitTestSourceForTransientInput(O).then(function(_){this.xrHitTestSource=_,this.transient=!0}.bind(this)).catch(b)},M.prototype.anchorFromLastHitTestResult=function(I,O){var _=this.lastHitTest;if(_){var D={object3D:I,offset:O};Array.from(this.anchorToObject3D.entries()).forEach(function(V){var J=V[1].object3D,Y=V[0];J===I&&(this.anchorToObject3D.delete(Y),Y.delete())}.bind(this)),_.createAnchor&&_.createAnchor().then(function(V){this.anchorToObject3D.set(V,D)}.bind(this)).catch(function(V){console.warn(V.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},M.prototype.doHit=function(O){if(this.renderer.xr.isPresenting){var _=this.renderer.xr.getReferenceSpace(),D=O.getViewerPose(_),V,J;if(this.xrHitTestSource&&D)return this.transient?(V=O.getHitTestResultsForTransientInput(this.xrHitTestSource),V.length>0?(J=V[0].results,J.length>0?(this.lastHitTest=J[0],J[0].getPose(_)):!1):!1):(V=O.getHitTestResults(this.xrHitTestSource),V.length>0?(this.lastHitTest=V[0],V[0].getPose(_)):!1)}},M.updateAnchorPoses=function(I,O){var _=I.trackedAnchors||M.prototype.previousFrameAnchors;M.prototype.previousFrameAnchors.forEach(function(D){_.has(D)||M.prototype.anchorToObject3D.delete(D)}),_.forEach(function(D){var V,J,Y,W;try{V=I.getPose(D.anchorSpace,O)}catch{}V&&(J=M.prototype.anchorToObject3D.get(D),Y=J.offset,W=J.object3D,L(V,W,Y))})};var S;Z.exports.Component=H("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:B,type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new C.OrthographicCamera,this.orthoCam.layers.set(F),this.textureTarget=new C.WebGLRenderTarget(512,512,{}),this.basicMaterial=new C.MeshBasicMaterial({color:0,side:C.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new C.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var I=this.el.getAttribute("webxr"),O=I.optionalFeatures;(!O.includes("hit-test")||!O.includes("anchors"))&&(O.push("hit-test"),O.push("anchors"),this.el.setAttribute("webxr",I)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",function(){this.hitTest=null}.bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",function(){if(this.el.is("ar-mode")){var _=this.el.sceneEl.renderer,D=this.session=_.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,S||(S=new Map),D.requestReferenceSpace("viewer").then(function(Y){this.hitTest=new M(_,{space:Y}),S.set(Y,this.hitTest),this.el.emit("ar-hit-test-start")}.bind(this));var V="generic-touchscreen",J=new M(_,{profile:V});D.addEventListener("selectstart",function(Y){if(this.data.enabled===!0){var W=Y.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:W,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),W.profiles[0]===V?this.hitTest=J:(this.hitTest=S.get(W)||new M(_,{space:W.targetRaySpace}),S.set(W,this.hitTest)))}}.bind(this)),D.addEventListener("selectend",function(Y){if(!this.hitTest||this.data.enabled!==!0){this.hitTest=null;return}var W=Y.inputSource,U;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(U=this.data.target.object3D,U&&(L.tempFakePose.transform.position.copy(this.bboxMesh.position),L.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),L(L.tempFakePose,U,this.bboxOffset),U.visible=!0,this.hitTest.anchorFromLastHitTestResult(U,this.bboxOffset))),this.el.emit("ar-hit-test-select",{inputSource:W,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}.bind(this))}}.bind(this)),this.bboxOffset=new C.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(F),this.data.target.object3D.traverse(function(I){I.layers.enable(F)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var I=new C.PlaneGeometry(1,1),O=new C.MeshBasicMaterial({transparent:!0,color:16777215});I.rotateX(-Math.PI/2),I.rotateY(-Math.PI/2),this.bbox=new C.Box3,this.bboxMesh=new C.Mesh(I,O),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var I,O=this.el.sceneEl.renderer,_,D,V=O.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),_=O.getRenderTarget(),O.setRenderTarget(this.textureTarget),O.xr.enabled=!1,D=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,O.render(this.el.object3D,this.orthoCam),this.el.object3D.background=D,this.el.object3D.overrideMaterial=null,O.xr.enabled=V,O.setRenderTarget(_),O.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),I=this.context.getImageData(0,0,512,512);for(var J=0;J<262144;J++)I.data[J*4+3]!==0&&I.data[J*4+3]!==255&&(I.data[J*4+3]=128);this.context.putImageData(I,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var I,O=this.el.sceneEl.frame,_=this.el.sceneEl.renderer;if(O&&M.updateAnchorPoses(O,_.xr.getReferenceSpace()),this.bboxNeedsUpdate){if(this.bboxNeedsUpdate=!1,!this.data.target||this.data.type==="map"){var D;this.textureCache.has(this.data.src)?D=this.textureCache.get(this.data.src):(D=new C.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,D)),this.bboxMesh.material.map=D,this.bboxMesh.material.needsUpdate=!0}this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)}this.hitTest&&(I=this.hitTest.doHit(O),I&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(I.transform.position),this.bboxMesh.quaternion.copy(I.transform.orientation)))}})},"./src/components/scene/background.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/core/component.js").components;Z.exports.Component=B("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function(){var C=this.data,F=this.el.object3D;C.transparent?F.background=null:F.background=new THREE.Color(C.color)},remove:function(){var C=this.data,F=this.el.object3D;if(C.transparent){F.background=null;return}F.background=H[this.name].schema.color.default}})},"./src/components/scene/debug.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("debug",{schema:{default:!0}})},"./src/components/scene/device-orientation-permission-ui.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/index.js"),C=H.bind,F=E("./src/constants/index.js"),L="a-modal",M="a-dialog",b="a-dialog-text",S="a-dialog-text-container",I="a-dialog-buttons-container",O="a-dialog-button",_="a-dialog-allow-button",D="a-dialog-deny-button",V="a-dialog-ok-button";Z.exports.Component=B("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},init:function(){var U=this;if(this.data.enabled){if(location.hostname!=="localhost"&&location.hostname!=="127.0.0.1"&&location.protocol==="http:"&&this.showHTTPAlert(),typeof DeviceOrientationEvent>"u"||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=C(this.onDeviceMotionDialogAllowClicked,this),this.onDeviceMotionDialogDenyClicked=C(this.onDeviceMotionDialogDenyClicked,this),DeviceOrientationEvent.requestPermission().then(function(){U.el.emit("deviceorientationpermissiongranted"),U.permissionGranted=!0}).catch(function(){U.devicePermissionDialogEl=J(U.data.denyButtonText,U.data.allowButtonText,U.data.deviceMotionMessage,U.onDeviceMotionDialogAllowClicked,U.onDeviceMotionDialogDenyClicked),U.el.appendChild(U.devicePermissionDialogEl)})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var U=this,q=Y(U.data.cancelButtonText,U.data.httpsMessage,function(){U.el.removeChild(q)});this.el.appendChild(q)},onDeviceMotionDialogAllowClicked:function(){var U=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(q){q==="granted"?(U.el.emit("deviceorientationpermissiongranted"),U.permissionGranted=!0):U.el.emit("deviceorientationpermissionrejected"),U.remove()}).catch(console.error)}});function J(U,q,oe,ve,Ae){var Se,Ie,de;return Se=document.createElement("div"),Se.classList.add(I),Ie=document.createElement("button"),Ie.classList.add(O,D),Ie.setAttribute(F.AFRAME_INJECTED,""),Ie.innerHTML=U,Se.appendChild(Ie),de=document.createElement("button"),de.classList.add(O,_),de.setAttribute(F.AFRAME_INJECTED,""),de.innerHTML=q,Se.appendChild(de),de.addEventListener("click",function(pe){pe.stopPropagation(),ve()}),Ie.addEventListener("click",function(pe){pe.stopPropagation(),Ae()}),W(oe,Se)}function Y(U,q,oe){var ve,Ae;return ve=document.createElement("div"),ve.classList.add(I),Ae=document.createElement("button"),Ae.classList.add(O,V),Ae.setAttribute(F.AFRAME_INJECTED,""),Ae.innerHTML=U,ve.appendChild(Ae),Ae.addEventListener("click",function(Se){Se.stopPropagation(),oe()}),W(q,ve)}function W(U,q){var oe,ve,Ae,Se;return oe=document.createElement("div"),oe.classList.add(L),oe.setAttribute(F.AFRAME_INJECTED,""),ve=document.createElement("div"),ve.className=M,ve.setAttribute(F.AFRAME_INJECTED,""),oe.appendChild(ve),Ae=document.createElement("div"),Ae.classList.add(S),ve.appendChild(Ae),Se=document.createElement("div"),Se.classList.add(b),Se.innerHTML=U,Ae.appendChild(Se),ve.appendChild(q),oe}},"./src/components/scene/embedded.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function(){var H=this.el,C=H.querySelector(".a-enter-vr");this.data===!0?(C&&C.classList.add("embedded"),H.removeFullScreenStyles()):(C&&C.classList.remove("embedded"),H.addFullScreenStyles())}})},"./src/components/scene/fog.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=E("./src/utils/debug.js"),F=C("components:fog:warn");Z.exports.Component=B("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function(){var M=this.data,b=this.el,S=this.el.object3D.fog;if(!b.isScene){F("Fog component can only be applied to <a-scene>");return}if(!S||M.type!==S.name){b.object3D.fog=L(M),b.systems.material.updateMaterials();return}Object.keys(this.schema).forEach(function(I){var O=M[I];I==="color"&&(O=new H.Color(O)),S[I]=O})},remove:function(){var M=this.el.object3D.fog;M&&(M.far=0,M.near=.1)}});function L(M){var b;return M.type==="exponential"?b=new H.FogExp2(M.color,M.density):b=new H.Fog(M.color,M.near,M.far),b.name=M.type,b}},"./src/components/scene/inspector.js":(Z,te,E)=>{var B=E("./src/constants/index.js").AFRAME_INJECTED,H=E("./package.json"),C=E("./src/core/component.js").registerComponent,F=E("./src/utils/index.js");function L(O){var _=O.split(".");return _[2]="x",_.join(".")}var M="https://unpkg.com/aframe-inspector@"+L(H.version)+"/dist/aframe-inspector.min.js",b=M,S="Loading Inspector",I="Error loading Inspector";Z.exports.Component=C("inspector",{schema:{url:{default:b}},init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var O;this.firstPlay&&(O=F.getUrlParameter("inspector"),O!=="false"&&O&&(this.openInspector(),this.firstPlay=!1))},initOverlay:function(){var O='<span class="dots"><span>.</span><span>.</span><span>.</span></span>';this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML=S+O},remove:function(){this.removeEventListeners()},onKeydown:function(O){var _=O.keyCode===73&&(O.ctrlKey&&O.altKey||O.getModifierState("AltGraph"));_&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(O){O.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(O){var _=this,D;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(O);return}this.showLoader(),D=document.createElement("script"),D.src=this.data.url,D.setAttribute("data-name","aframe-inspector"),D.setAttribute(B,""),D.onload=function(){AFRAME.INSPECTOR.open(O),_.hideLoader(),_.removeEventListeners()},D.onerror=function(){_.loadingMessageEl.innerHTML=I},document.head.appendChild(D),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})},"./src/components/scene/keyboard-shortcuts.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/index.js").shouldCaptureKeyEvent;Z.exports.Component=B("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(C){var F=this.data;this.enterVREnabled=F.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(C){var F=this.el;H(C)&&(this.enterVREnabled&&C.keyCode===70&&F.enterVR(),this.enterVREnabled&&C.keyCode===27&&F.exitVR())}})},"./src/components/scene/pool.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=E("./src/core/component.js").registerComponent,C=B("components:pool:warn");Z.exports.Component=H("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function(){var F;for(this.availableEls=[],this.usedEls=[],this.data.mixin||C("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||C("Container "+this.data.container+" not found.")),this.container=this.container||this.el,F=0;F<this.data.size;++F)this.createEntity()},update:function(F){var L=this.data;(F.mixin!==L.mixin||F.size!==L.size)&&this.initPool()},createEntity:function(){var F;F=document.createElement("a-entity"),F.play=this.wrapPlay(F.play),F.setAttribute("mixin",this.data.mixin),F.object3D.visible=!1,F.pause(),this.container.appendChild(F),this.availableEls.push(F);var L=this.usedEls;F.addEventListener("loaded",function(){L.indexOf(F)===-1&&(F.object3DParent=F.object3D.parent,F.object3D.parent.remove(F.object3D))})},wrapPlay:function(F){var L=this.usedEls;return function(){L.indexOf(this)!==-1&&F.call(this)}},requestEntity:function(){var F;if(this.availableEls.length===0){if(this.data.dynamic===!1){C("Requested entity from empty pool: "+this.attrName);return}else C("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName);this.createEntity()}return F=this.availableEls.shift(),this.usedEls.push(F),F.object3DParent&&(F.object3DParent.add(F.object3D),this.updateRaycasters()),F.object3D.visible=!0,F},returnEntity:function(F){var L=this.usedEls.indexOf(F);if(L===-1){C("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(L,1),this.availableEls.push(F),F.object3DParent=F.object3D.parent,F.object3D.parent.remove(F.object3D),this.updateRaycasters(),F.object3D.visible=!1,F.pause(),F},updateRaycasters(){var F=document.querySelectorAll("[raycaster]");F.forEach(function(L){L.components.raycaster.setDirty()})}})},"./src/components/scene/reflection.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;function H(C,F,L,M){var b=Math.max(C.primaryLightIntensity.x,Math.max(C.primaryLightIntensity.y,C.primaryLightIntensity.z));F.sh.fromArray(C.sphericalHarmonicsCoefficients),F.intensity=1,L&&(L.color.setRGB(C.primaryLightIntensity.x/b,C.primaryLightIntensity.y/b,C.primaryLightIntensity.z/b),L.intensity=b,M.copy(C.primaryLightDirection))}Z.exports.Component=B("reflection",{schema:{directionalLight:{type:"selector"}},init:function(){var C=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var F=this.el.getAttribute("webxr"),L=F.optionalFeatures;L.includes("light-estimation")||(L.push("light-estimation"),this.el.setAttribute("webxr",F)),this.el.addEventListener("enter-vr",function(){var M=C.el.renderer,b=M.xr.getSession();b.requestLightProbe&&C.el.is("ar-mode")&&C.startLightProbe()}),this.el.addEventListener("exit-vr",function(){C.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var C=this.el.renderer,F=C.xr.getSession(),L=this,M=C.getContext();if(!this.probeLight){var b=document.createElement("a-light");b.setAttribute("type","probe"),b.setAttribute("intensity",0),this.el.appendChild(b),this.probeLight=b}switch(F.preferredReflectionFormat){case"srgba8":M.getExtension("EXT_sRGB");break;case"rgba16f":M.getExtension("OES_texture_half_float");break}this.glBinding=new XRWebGLBinding(F,M),M.getExtension("EXT_sRGB"),M.getExtension("OES_texture_half_float"),F.requestLightProbe().then(function(S){L.xrLightProbe=S,S.addEventListener("reflectionchange",L.updateXRCubeMap.bind(L))}).catch(function(S){console.warn("Lighting estimation not supported: "+S.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var C=this.el.renderer,F=this.glBinding.getReflectionCubeMap(this.xrLightProbe);if(F){var L=C.properties.get(this.lightingEstimationTexture);L.__webglTexture=F,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture}},tick:function(){var C=this.el.object3D,F=this.el.renderer,L=this.el.frame;if(L&&this.xrLightProbe){var M=L.getLightEstimate(this.xrLightProbe);M&&H(M,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(C.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(F,C),C.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&L&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}})},"./src/components/scene/screenshot.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),F=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`);Z.exports.Component=B("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function(){var L=this.el,M=this;L.renderer?b():L.addEventListener("render-target-loaded",b);function b(){var S=L.renderer.getContext();S&&(M.cubeMapSize=S.getParameter(S.MAX_CUBE_MAP_TEXTURE_SIZE),M.material=new H.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:C,fragmentShader:F,side:H.DoubleSide}),M.quad=new H.Mesh(new H.PlaneGeometry(1,1),M.material),M.quad.visible=!1,M.camera=new H.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),M.canvas=document.createElement("canvas"),M.ctx=M.canvas.getContext("2d"),L.object3D.add(M.quad),M.onKeyDown=M.onKeyDown.bind(M))}},getRenderTarget:function(L,M){return new H.WebGLRenderTarget(L,M,{encoding:this.el.sceneEl.renderer.outputEncoding,minFilter:H.LinearFilter,magFilter:H.LinearFilter,wrapS:H.ClampToEdgeWrapping,wrapT:H.ClampToEdgeWrapping,format:H.RGBAFormat,type:H.UnsignedByteType})},resize:function(L,M){this.quad.scale.set(L,M,1),this.camera.left=-1*L/2,this.camera.right=L/2,this.camera.top=M/2,this.camera.bottom=-1*M/2,this.camera.updateProjectionMatrix(),this.canvas.width=L,this.canvas.height=M},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(L){var M=L.keyCode===83&&L.ctrlKey&&L.altKey;if(!(!this.data||!M)){var b=L.shiftKey?"equirectangular":"perspective";this.capture(b)}},setCapture:function(L){var M=this.el,b,S,I,O;return L==="perspective"?(this.quad.visible=!1,S=this.data.camera&&this.data.camera.components.camera.camera||M.camera,b={width:this.data.width,height:this.data.height}):(S=this.camera,O=new H.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:H.RGBFormat,generateMipmaps:!0,minFilter:H.LinearMipmapLinearFilter,encoding:H.sRGBEncoding}),I=new H.CubeCamera(M.camera.near,M.camera.far,O),M.camera.getWorldPosition(I.position),M.camera.getWorldQuaternion(I.quaternion),I.update(M.renderer,M.object3D),this.quad.material.uniforms.map.value=I.renderTarget.texture,b={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:S,size:b,projection:L}},capture:function(L){var M=this.el.renderer.xr.enabled,b=this.el.renderer,S;b.xr.enabled=!1,S=this.setCapture(L),this.renderCapture(S.camera,S.size,S.projection),this.saveCapture(),b.xr.enabled=M},getCanvas:function(L){var M=this.el.renderer.xr.enabled,b=this.el.renderer,S=this.setCapture(L);return b.xr.enabled=!1,this.renderCapture(S.camera,S.size,S.projection),b.xr.enabled=M,this.canvas},renderCapture:function(L,M,b){var S=this.el.renderer.autoClear,I=this.el,O,_,D,V=I.renderer;_=this.getRenderTarget(M.width,M.height),D=new Uint8Array(4*M.width*M.height),this.resize(M.width,M.height),V.autoClear=!0,V.clear(),V.setRenderTarget(_),V.render(I.object3D,L),V.autoClear=S,V.readRenderTargetPixels(_,0,0,M.width,M.height,D),V.setRenderTarget(null),b==="perspective"&&(D=this.flipPixelsVertically(D,M.width,M.height)),O=new ImageData(new Uint8ClampedArray(D),M.width,M.height),this.quad.visible=!1,this.ctx.putImageData(O,0,0)},flipPixelsVertically:function(L,M,b){for(var S=L.slice(0),I=0;I<M;++I)for(var O=0;O<b;++O)S[I*4+O*M*4]=L[I*4+(b-O)*M*4],S[I*4+1+O*M*4]=L[I*4+1+(b-O)*M*4],S[I*4+2+O*M*4]=L[I*4+2+(b-O)*M*4],S[I*4+3+O*M*4]=L[I*4+3+(b-O)*M*4];return S},saveCapture:function(){this.canvas.toBlob(function(L){var M="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",b=document.createElement("a"),S=URL.createObjectURL(L);b.href=S,b.setAttribute("download",M),b.innerHTML="downloading...",b.style.display="none",document.body.appendChild(b),setTimeout(function(){b.click(),document.body.removeChild(b)},1)},"image/png")}})},"./src/components/scene/stats.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./vendor/rStats.js"),C=E("./src/utils/index.js");E("./vendor/rStats.extras.js"),E("./src/lib/rStatsAframe.js");var F=window.aframeStats,L=C.bind,M="a-hidden",b=window.threeStats;Z.exports.Component=B("stats",{schema:{default:!0},init:function(){var I=this.el;C.getUrlParameter("stats")!=="false"&&(this.stats=S(I),this.statsEl=document.querySelector(".rs-base"),this.hideBound=L(this.hide,this),this.showBound=L(this.show,this),I.addEventListener("enter-vr",this.hideBound),I.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var I=this.stats;I&&(I("rAF").tick(),I("FPS").frame(),I().update())},hide:function(){this.statsEl.classList.add(M)},show:function(){this.statsEl.classList.remove(M)}});function S(I){var O=new b(I.renderer),_=new F(I),D=I.isMobile?[]:[O,_];return new H({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:D})}},"./src/components/scene/vr-mode-ui.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/constants/index.js"),C=E("./src/utils/index.js"),F=C.bind,L="a-enter-vr",M="a-enter-ar",b="a-enter-vr-button",S="a-enter-ar-button",I="a-hidden",O="a-orientation-modal";Z.exports.Component=B("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},cardboardModeEnabled:{default:!1},enterVRButton:{default:""},enterARButton:{default:""}},init:function(){var Y=this,W=this.el;C.getUrlParameter("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),W.addEventListener("enter-vr",this.updateEnterInterfaces),W.addEventListener("exit-vr",this.updateEnterInterfaces),W.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(U){U.data.type==="loaderReady"&&(Y.insideLoader=!0,Y.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=F(this.onEnterVRButtonClick,this),this.onEnterARButtonClick=F(this.onEnterARButtonClick,this),this.onModalClick=F(this.onModalClick,this),this.toggleOrientationModalIfNeeded=F(this.toggleOrientationModalIfNeeded,this),this.updateEnterInterfaces=F(this.updateEnterInterfaces,this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var Y=this.data,W=this.el;if(!Y.enabled||this.insideLoader||C.getUrlParameter("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(Y.enterVRButton?(this.enterVREl=document.querySelector(Y.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=_(this.onEnterVRButtonClick),W.appendChild(this.enterVREl)),Y.enterARButton?(this.enterAREl=document.querySelector(Y.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=D(this.onEnterARButtonClick),W.appendChild(this.enterAREl)),this.orientationModalEl=V(this.onModalClick),W.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(Y){Y&&Y.parentNode&&Y.parentNode.removeChild(Y)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var Y=this.el;this.enterVREl&&(Y.is("vr-mode")||(Y.isMobile||C.device.isMobileDeviceRequestingDesktopSite())&&!this.data.cardboardModeEnabled&&!C.device.checkVRSupport()?this.enterVREl.classList.add(I):(C.device.checkVRSupport()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(I)))},toggleEnterARButtonIfNeeded:function(){var Y=this.el;this.enterAREl&&(Y.is("vr-mode")||!C.device.checkARSupport()?this.enterAREl.classList.add(I):this.enterAREl.classList.remove(I))},toggleOrientationModalIfNeeded:function(){var Y=this.el,W=this.orientationModalEl;!W||!Y.isMobile||(!C.device.isLandscape()&&Y.is("vr-mode")?W.classList.remove(I):W.classList.add(I))}});function _(Y){var W,U;return U=document.createElement("div"),U.classList.add(L),U.setAttribute(H.AFRAME_INJECTED,""),W=document.createElement("button"),W.className=b,W.setAttribute("title","Enter VR mode with a headset or fullscreen without"),W.setAttribute(H.AFRAME_INJECTED,""),C.device.isMobile()&&J(W),U.appendChild(W),W.addEventListener("click",function(q){Y(),q.stopPropagation()}),U}function D(Y){var W,U;return U=document.createElement("div"),U.classList.add(M),U.setAttribute(H.AFRAME_INJECTED,""),W=document.createElement("button"),W.className=S,W.setAttribute("title","Enter AR mode with a headset or handheld device."),W.setAttribute(H.AFRAME_INJECTED,""),C.device.isMobile()&&J(W),U.appendChild(W),W.addEventListener("click",function(q){Y(),q.stopPropagation()}),U}function V(Y){var W=document.createElement("div");W.className=O,W.classList.add(I),W.setAttribute(H.AFRAME_INJECTED,"");var U=document.createElement("button");return U.setAttribute(H.AFRAME_INJECTED,""),U.innerHTML="Exit VR",U.addEventListener("click",Y),W.appendChild(U),W}function J(Y){Y.addEventListener("touchstart",function(){Y.classList.remove("resethover")}),Y.addEventListener("touchend",function(){Y.classList.add("resethover")})}},"./src/components/shadow.js":(Z,te,E)=>{var B=E("./src/core/component.js"),H=E("./src/lib/three.js"),C=E("./src/utils/bind.js"),F=B.registerComponent;Z.exports.Component=F("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=C(this.update,this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var L=this.data;this.updateDescendants(L.cast,L.receive)},remove:function(){var L=this.el;L.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(L,M){var b=this.el.sceneEl;this.el.object3D.traverse(function(S){if(S instanceof H.Mesh&&(S.castShadow=L,S.receiveShadow=M,b.hasLoaded&&S.material))for(var I=Array.isArray(S.material)?S.material:[S.material],O=0;O<I.length;O++)I[O].needsUpdate=!0})}})},"./src/components/sound.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/debug.js"),C=E("./src/lib/three.js"),F=H("components:sound:warn");Z.exports.Component=B("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var L=this;this.listener=null,this.audioLoader=new C.AudioLoader,this.pool=new C.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){L.playSound()}},update:function(L){var M=this.data,b,S,I=M.src!==L.src;if(I){if(!M.src)return;this.setupSound()}for(b=0;b<this.pool.children.length;b++)S=this.pool.children[b],M.positional&&(S.setDistanceModel(M.distanceModel),S.setMaxDistance(M.maxDistance),S.setRefDistance(M.refDistance),S.setRolloffFactor(M.rolloffFactor)),S.setLoop(M.loop),S.setVolume(M.volume),S.isPaused=!1;if(M.on!==L.on&&this.updateEventListener(L.on),I){var O=this;this.loaded=!1,this.audioLoader.load(M.src,function(_){for(b=0;b<O.pool.children.length;b++)S=O.pool.children[b],S.setBuffer(_);O.loaded=!0,C.Cache.remove(M.src),(O.data.autoplay||O.mustPlay)&&O.playSound(),O.el.emit("sound-loaded",O.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var L,M;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(L=0;L<this.pool.children.length;L++)M=this.pool.children[L],M.disconnect()}catch{F("Audio source not properly disconnected")}},updateEventListener:function(L){var M=this.el;L&&M.removeEventListener(L,this.playSoundBound),M.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var L=this.el,M,b=L.sceneEl,S=this,I;this.pool.children.length>0&&(this.stopSound(),L.removeObject3D("sound"));var O=this.listener=b.audioListener||new C.AudioListener;for(b.audioListener=O,b.camera&&b.camera.add(O),b.addEventListener("camera-set-active",function(_){_.detail.cameraEl.getObject3D("camera").add(O)}),this.pool=new C.Group,M=0;M<this.data.poolSize;M++)I=this.data.positional?new C.PositionalAudio(O):new C.Audio(O),this.pool.add(I);for(L.setObject3D(this.attrName,this.pool),M=0;M<this.pool.children.length;M++)I=this.pool.children[M],I.onEnded=function(){this.isPlaying=!1,S.el.emit("sound-ended",S.evtDetail,!1)}},pauseSound:function(){var L,M;for(this.isPlaying=!1,L=0;L<this.pool.children.length;L++)M=this.pool.children[L],!(!M.source||!M.source.buffer||!M.isPlaying||M.isPaused)&&(M.isPaused=!0,M.pause())},playSound:function(L){var M,b,S;if(!this.loaded){F("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0;return}for(M=!1,this.isPlaying=!0,b=0;b<this.pool.children.length;b++)if(S=this.pool.children[b],!S.isPlaying&&S.buffer&&!M){L&&L(S),S.play(),S.isPaused=!1,M=!0;continue}if(!M){F("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1},stopSound:function(){var L,M;for(this.isPlaying=!1,L=0;L<this.pool.children.length;L++){if(M=this.pool.children[L],!M.source||!M.source.buffer)return;M.stop()}}})},"./src/components/text.js":(Z,te,E)=>{var B=E("./node_modules/three-bmfont-text/index.js"),H=E("./node_modules/load-bmfont/browser.js"),C=E("./src/core/component.js").registerComponent,F=E("./src/core/shader.js"),L=E("./src/lib/three.js"),M=E("./src/utils/index.js"),b=M.debug("components:text:error"),S=F.shaders,I=M.debug("components:text:warn"),O=1,_=16,D="https://cdn.aframe.io/fonts/",V={aileronsemibold:D+"Aileron-Semibold.fnt",dejavu:D+"DejaVu-sdf.fnt",exo2bold:D+"Exo2Bold.fnt",exo2semibold:D+"Exo2SemiBold.fnt",kelsonsans:D+"KelsonSans.fnt",monoid:D+"Monoid.fnt",mozillavr:D+"mozillavr.fnt",roboto:D+"Roboto-msdf.json",sourcecodepro:D+"SourceCodePro.fnt"},J=["roboto"],Y="roboto";Z.exports.FONTS=V;var W=new we,U={},q={},oe=/^\w+:/;Z.exports.Component=C("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:Y},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:S},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=B(),this.createOrUpdateMaterial()},update:function(he){var Pe=this.data,Ve=this.currentFont;if(q[Pe.font]?this.texture=q[Pe.font]:(this.texture=q[Pe.font]=new L.Texture,this.texture.anisotropy=_),this.createOrUpdateMaterial(),he.font!==Pe.font){this.updateFont();return}Ve&&(this.updateGeometry(this.geometry,Ve),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var he=this.data,Pe,Ve=this.material,ze,et=this.shaderData,Tt;if(Tt=he.shader,J.indexOf(he.font)!==-1||he.font.indexOf("-msdf.")>=0?Tt="msdf":he.font in V&&J.indexOf(he.font)===-1&&(Tt="sdf"),Pe=(this.shaderObject&&this.shaderObject.name)!==Tt,et.alphaTest=he.alphaTest,et.color=he.color,et.map=this.texture,et.opacity=he.opacity,et.side=ve(he.side),et.transparent=he.transparent,et.negate=he.negate,!Pe){this.shaderObject.update(et),Ve.transparent=et.transparent,Ve.side=et.side;return}ze=Ie(this.el,Tt,et),this.material=ze.material,this.shaderObject=ze.shader,this.material.side=et.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var he=this.data,Pe=this.el,Ve,ze=this.geometry,et=this;he.font||I("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),Ve=this.lookupFont(he.font||Y)||he.font,W.get(Ve,function(){return Ae(Ve,he.yOffset)}).then(function(Rt){var fn;if(Rt.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");U[Ve]||(Rt.widthFactor=U[Rt]=pe(Rt)),et.currentFont=Rt,fn=et.getFontImageSrc(),W.get(fn,function(){return Se(fn)}).then(function(cn){var Jn=et.texture;Jn&&(Jn.image=cn,Jn.needsUpdate=!0,q[he.font]=Jn,et.texture=Jn,et.initMesh(),et.currentFont=Rt,et.updateGeometry(ze,Rt),et.updateLayout(),et.mesh.visible=!0,Pe.emit("textfontset",{font:he.font,fontObj:Rt}))}).catch(function(cn){b(cn.message),b(cn.stack)})}).catch(function(Tt){b(Tt.message),b(Tt.stack)})},initMesh:function(){this.mesh||(this.mesh=new L.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var he=this.lookupFont(this.data.font||Y)||this.data.font,Pe=this.currentFont.pages[0];return Pe.match(oe)&&Pe.indexOf("http")!==0?he.replace(/(\.fnt)|(\.json)/,".png"):L.LoaderUtils.extractUrlBase(he)+Pe},updateLayout:function(){var he,Pe,Ve=this.el,ze=this.data,et=this.geometry,Tt,Rt,fn,cn=this.mesh,Jn,yn,Wn,gi,ai;if(!(!cn||!et.layout)){if(Tt=Ve.getAttribute("geometry"),Wn=ze.width||Tt&&Tt.width||O,Jn=de(ze.wrapPixels,ze.wrapCount,this.currentFont.widthFactor),yn=Wn/Jn,fn=et.layout,Rt=yn*(fn.height+fn.descender),Tt&&Tt.primitive==="plane"&&(Tt.width||Ve.setAttribute("geometry","width",Wn),Tt.height||Ve.setAttribute("geometry","height",Rt)),he=ze.anchor==="align"?ze.align:ze.anchor,he==="left")gi=0;else if(he==="right")gi=-1*fn.width;else if(he==="center")gi=-1*fn.width/2;else throw new TypeError("Invalid text.anchor property value",he);if(Pe=ze.baseline,Pe==="bottom")ai=0;else if(Pe==="top")ai=-1*fn.height+fn.ascender;else if(Pe==="center")ai=-1*fn.height/2;else throw new TypeError("Invalid text.baseline property value",Pe);cn.position.x=gi*yn+ze.xOffset,cn.position.y=ai*yn,cn.position.z=ze.zOffset,cn.scale.set(yn,-1*yn,yn)}},lookupFont:function(he){return V[he]},updateGeometry:function(){var he={},Pe={},Ve=/\\n/g,ze=/\\t/g;return function(et,Tt){var Rt=this.data;Pe.font=Tt,Pe.lineHeight=Rt.lineHeight&&isFinite(Rt.lineHeight)?Rt.lineHeight:Tt.common.lineHeight,Pe.text=Rt.value.toString().replace(Ve,`
`).replace(ze,"	"),Pe.width=de(Rt.wrapPixels,Rt.wrapCount,Tt.widthFactor),et.update(M.extend(he,Rt,Pe))}}()});function ve(he){switch(he){case"back":return L.FrontSide;case"double":return L.DoubleSide;default:return L.BackSide}}function Ae(he,Pe){return new Promise(function(Ve,ze){H(he,function(et,Tt){if(et){b("Error loading font",he),ze(et);return}he.indexOf("/Roboto-msdf.json")>=0&&(Pe=30),Pe&&Tt.chars.map(function(fn){fn.yoffset+=Pe}),Ve(Tt)})})}function Se(he){return new Promise(function(Pe,Ve){new L.ImageLoader().load(he,function(ze){Pe(ze)},void 0,function(){b("Error loading font image",he),Ve(null)})})}function Ie(he,Pe,Ve){var ze,et;return et=new S[Pe].Shader,et.el=he,et.init(Ve),et.update(Ve),ze=et.material,ze.transparent=Ve.transparent,{material:ze,shader:et}}function de(he,Pe,Ve){return he||(.5+Pe)*Ve}function pe(he){var Pe=0,Ve=0,ze=0;return he.chars.map(function(et){Pe+=et.xadvance,et.id>=48&&et.id<=57&&(ze++,Ve+=et.xadvance)}),ze?Ve/ze:Pe/he.chars.length}function we(){var he=this.cache={};this.get=function(Pe,Ve){return Pe in he||(he[Pe]=Ve()),he[Pe]}}},"./src/components/tracked-controls-webvr.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/tracked-controls.js"),C=E("./src/constants/index.js").DEFAULT_CAMERA_HEIGHT,F=E("./src/lib/three.js"),L=E("./src/constants/index.js").DEFAULT_HANDEDNESS,M={x:.175,y:-.3,z:-.03},b={x:0,y:0,z:-.175},S={touches:[]},I={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};Z.exports.Component=B("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new F.Vector3,this.controllerQuaternion=new F.Quaternion,this.controllerEuler=new F.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(O,_){var D=this.el.getObject3D("mesh");D&&D.update&&D.update(_/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return C},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var O=this.data,_=H.findMatchingControllerWebVR(this.system.controllers,O.id,O.idPrefix,O.hand,O.controller);this.controller=_,this.el.components["tracked-controls"].controller=_,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(O){var _=this.controller,D=this.controllerEuler,V=this.controllerQuaternion,J=this.deltaControllerPosition,Y,W,U,q,oe;W=this.getHeadElement(),U=W.object3D,oe=this.defaultUserHeight(),q=_.pose,Y=(_?_.hand:void 0)||L,O.copy(U.position),J.set(M.x*(Y==="left"?-1:Y==="right"?1:0),M.y,M.z),J.multiplyScalar(oe),J.applyAxisAngle(U.up,U.rotation.y),O.add(J),J.set(b.x,b.y,b.z),J.multiplyScalar(oe),q.orientation?V.fromArray(q.orientation):V.copy(U.quaternion),D.setFromQuaternion(V),D.set(D.x,D.y,0),J.applyEuler(D),O.add(J)},updatePose:function(){var O=this.controller,_=this.data,D=this.el.object3D,V,J=this.system.vrDisplay,Y;O&&(V=O.pose,V.position?D.position.fromArray(V.position):_.armModel&&this.applyArmModel(D.position),V.orientation&&D.quaternion.fromArray(V.orientation),J&&V.position&&(Y=this.el.sceneEl.renderer.xr.getStandingMatrix(),D.matrix.compose(D.position,D.quaternion,D.scale),D.matrix.multiplyMatrices(Y,D.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),D.rotateX(this.data.orientationOffset.x*F.MathUtils.DEG2RAD),D.rotateY(this.data.orientationOffset.y*F.MathUtils.DEG2RAD),D.rotateZ(this.data.orientationOffset.z*F.MathUtils.DEG2RAD))},updateButtons:function(){var O,_=this.controller,D;if(_){for(D=0;D<_.buttons.length;++D)this.buttonStates[D]||(this.buttonStates[D]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[D]||(this.buttonEventDetails[D]={id:D,state:this.buttonStates[D]}),O=_.buttons[D],this.handleButton(D,O);this.handleAxes()}},handleButton:function(O,_){var D;return D=this.handlePress(O,_)|this.handleTouch(O,_)|this.handleValue(O,_),D?(this.el.emit(I.BUTTONCHANGED,this.buttonEventDetails[O],!1),!0):!1},handleAxes:function(){var O=!1,_=this.controller.axes,D,V=this.axis,J=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),D=0;D<_.length;++D)J.push(V[D]!==_[D]),J[D]&&(O=!0);if(!O)return!1;for(this.axis.splice(0,this.axis.length),D=0;D<_.length;D++)this.axis.push(_[D]);return this.el.emit(I.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(O,_){var D,V=this.buttonStates[O];return _.pressed===V.pressed?!1:(D=_.pressed?I.BUTTONDOWN:I.BUTTONUP,this.el.emit(D,this.buttonEventDetails[O],!1),V.pressed=_.pressed,!0)},handleTouch:function(O,_){var D,V=this.buttonStates[O];return _.touched===V.touched?!1:(D=_.touched?I.TOUCHSTART:I.TOUCHEND,this.el.emit(D,this.buttonEventDetails[O],!1,S),V.touched=_.touched,!0)},handleValue:function(O,_){var D=this.buttonStates[O];return _.value===D.value?!1:(D.value=_.value,!0)}})},"./src/components/tracked-controls-webxr.js":(Z,te,E)=>{var B=E("./src/utils/tracked-controls.js"),H=E("./src/core/component.js").registerComponent,C={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};Z.exports.Component=H("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"gripSpace"}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var F=this.el.sceneEl;this.updateController(),F.addEventListener("controllersupdated",this.updateController)},pause:function(){var F=this.el.sceneEl;F.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(F){return!(!this.controller||this.controller.gamepad||F.inputSource.handedness!=="none"&&F.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=B.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var F=this.el.sceneEl,L=this.controller,M=F.frame;!L||!F.frame||!this.system.referenceSpace||L.hand||(this.pose=M.getPose(L[this.data.space],this.system.referenceSpace),this.updatePose(),this.updateButtons())},updatePose:function(){var F=this.el.object3D,L=this.pose;L&&(F.matrix.elements=L.transform.matrix,F.matrix.decompose(F.position,F.rotation,F.scale))},updateButtons:function(){var F,L,M=this.controller,b;if(!(!M||!M.gamepad)){for(b=M.gamepad,L=0;L<b.buttons.length;++L)this.buttonStates[L]||(this.buttonStates[L]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[L]||(this.buttonEventDetails[L]={id:L,state:this.buttonStates[L]}),F=b.buttons[L],this.handleButton(L,F);this.handleAxes()}},handleButton:function(F,L){var M;return M=this.handlePress(F,L)|this.handleTouch(F,L)|this.handleValue(F,L),M?(this.el.emit(C.BUTTONCHANGED,this.buttonEventDetails[F],!1),!0):!1},handleAxes:function(){var F=!1,L=this.controller.gamepad.axes,M,b=this.axis,S=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),M=0;M<L.length;++M)S.push(b[M]!==L[M]),S[M]&&(F=!0);if(!F)return!1;for(this.axis.splice(0,this.axis.length),M=0;M<L.length;M++)this.axis.push(L[M]);return this.el.emit(C.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(F,L){var M,b=this.buttonStates[F];return L.pressed===b.pressed?!1:(M=L.pressed?C.BUTTONDOWN:C.BUTTONUP,this.el.emit(M,this.buttonEventDetails[F],!1),b.pressed=L.pressed,!0)},handleTouch:function(F,L){var M,b=this.buttonStates[F];return L.touched===b.touched?!1:(M=L.touched?C.TOUCHSTART:C.TOUCHEND,this.el.emit(M,this.buttonEventDetails[F],!1),b.touched=L.touched,!0)},handleValue:function(F,L){var M=this.buttonStates[F];return L.value===M.value?!1:(M.value=L.value,!0)}})},"./src/components/tracked-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"targetRaySpace"}},update:function(){var H=this.data,C=this.el;C.sceneEl.hasWebXR?C.setAttribute("tracked-controls-webxr",{id:H.id,hand:H.hand,index:H.controller,iterateControllerProfiles:H.iterateControllerProfiles,handTrackingEnabled:H.handTrackingEnabled,space:H.space}):C.setAttribute("tracked-controls-webvr",H)}})},"./src/components/valve-index-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/lib/three.js"),F=E("./src/utils/tracked-controls.js"),L=F.checkControllerPresentAndSetup,M=F.emitIfAxesChanged,b=F.onButtonEvent,S="https://cdn.aframe.io/controllers/valve/index/valve-index-",I={left:S+"left.glb",right:S+"right.glb"},O="valve",_=E("./src/utils/index.js").device.isWebXRAvailable,D={left:{x:-.00023692678902063457,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}},V={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},J={left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},Y={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},W=_?Y:J,U=_?V:D;Z.exports.Component=B("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var q=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(oe){b(oe.detail.id,"down",q)},this.onButtonUp=function(oe){b(oe.detail.id,"up",q)},this.onButtonTouchEnd=function(oe){b(oe.detail.id,"touchend",q)},this.onButtonTouchStart=function(oe){b(oe.detail.id,"touchstart",q)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},addEventListeners:function(){var q=this.el;q.addEventListener("buttonchanged",this.onButtonChanged),q.addEventListener("buttondown",this.onButtonDown),q.addEventListener("buttonup",this.onButtonUp),q.addEventListener("touchend",this.onButtonTouchEnd),q.addEventListener("touchstart",this.onButtonTouchStart),q.addEventListener("model-loaded",this.onModelLoaded),q.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var q=this.el;q.removeEventListener("buttonchanged",this.onButtonChanged),q.removeEventListener("buttondown",this.onButtonDown),q.removeEventListener("buttonup",this.onButtonUp),q.removeEventListener("touchend",this.onButtonTouchEnd),q.removeEventListener("touchstart",this.onButtonTouchStart),q.removeEventListener("model-loaded",this.onModelLoaded),q.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var q=this.data,oe=q.hand==="right"?0:q.hand==="left"?1:2;L(this,O,{index:oe,iterateControllerProfiles:!0,hand:q.hand})},injectTrackedControls:function(){var q=this.el,oe=this.data;q.setAttribute("tracked-controls",{idPrefix:O,controller:oe.hand==="right"?1:oe.hand==="left"?0:2,hand:oe.hand,orientationOffset:oe.orientationOffset}),this.loadModel()},loadModel:function(){var q=this.data;q.model&&this.el.setAttribute("gltf-model",""+I[q.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(q){var oe=this.mapping.buttons[q.detail.id],ve=this.buttonMeshes,Ae;oe&&(oe==="trigger"&&(Ae=q.detail.state.value,ve&&ve.trigger&&(ve.trigger.rotation.x=this.triggerOriginalRotationX-Ae*(Math.PI/40))),this.el.emit(oe+"changed",q.detail.state))},onModelLoaded:function(q){var oe,ve=q.detail.model,Ae=this;this.data.model&&(oe=this.buttonMeshes={},oe.grip={left:ve.getObjectByName("leftgrip"),right:ve.getObjectByName("rightgrip")},oe.menu=ve.getObjectByName("menubutton"),oe.system=ve.getObjectByName("systembutton"),oe.trackpad=ve.getObjectByName("touchpad"),oe.trigger=ve.getObjectByName("trigger"),this.triggerOriginalRotationX=oe.trigger.rotation.x,Object.keys(oe).forEach(function(Se){Ae.setButtonColor(Se,Ae.data.buttonColor)}),ve.position.copy(U[this.data.hand]),ve.rotation.copy(W[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controlls",model:this.data.model,rayOrigin:new C.Vector3(0,0,0)}))},onAxisMoved:function(q){M(this,this.mapping.axes,q)},updateModel:function(q,oe){var ve,Ae;this.data.model&&(Ae=oe.indexOf("touch")!==-1,!Ae&&(ve=oe==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(q,ve)))},setButtonColor:function(q,oe){}})},"./src/components/visible.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent;Z.exports.Component=B("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},"./src/components/vive-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b="https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",S="https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl",I=E("./src/utils/index.js").device.isWebXRAvailable,O="htc-vive",_="OpenVR ",D=I?O:_,V={axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},J={axes:{thumbstick:[0,1]},buttons:["trigger","grip","trackpad","none","menu"]},Y=I?J:V;Z.exports.Component=B("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:Y,init:function(){var W=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(U){M(U.detail.id,"down",W)},this.onButtonUp=function(U){M(U.detail.id,"up",W)},this.onButtonTouchEnd=function(U){M(U.detail.id,"touchend",W)},this.onButtonTouchStart=function(U){M(U.detail.id,"touchstart",W)},this.previousButtonValues={},this.rendererSystem=this.el.sceneEl.systems.renderer,this.bindMethods()},update:function(){var W=this.data;this.controllerIndex=W.hand==="right"?0:W.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},addEventListeners:function(){var W=this.el;W.addEventListener("buttonchanged",this.onButtonChanged),W.addEventListener("buttondown",this.onButtonDown),W.addEventListener("buttonup",this.onButtonUp),W.addEventListener("touchend",this.onButtonTouchEnd),W.addEventListener("touchstart",this.onButtonTouchStart),W.addEventListener("model-loaded",this.onModelLoaded),W.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var W=this.el;W.removeEventListener("buttonchanged",this.onButtonChanged),W.removeEventListener("buttondown",this.onButtonDown),W.removeEventListener("buttonup",this.onButtonUp),W.removeEventListener("touchend",this.onButtonTouchEnd),W.removeEventListener("touchstart",this.onButtonTouchStart),W.removeEventListener("model-loaded",this.onModelLoaded),W.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var W=this.data;F(this,D,{index:this.controllerIndex,hand:W.hand})},injectTrackedControls:function(){var W=this.el,U=this.data;W.setAttribute("tracked-controls",{idPrefix:D,hand:U.hand,controller:this.controllerIndex,orientationOffset:U.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:b,mtl:S})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(W){var U=this.mapping.buttons[W.detail.id],q=this.buttonMeshes,oe;U&&(U==="trigger"&&(oe=W.detail.state.value,q&&q.trigger&&(q.trigger.rotation.x=-oe*(Math.PI/12))),this.el.emit(U+"changed",W.detail.state))},onModelLoaded:function(W){var U,q=W.detail.model,oe=this;this.data.model&&(U=this.buttonMeshes={},U.grip={left:q.getObjectByName("leftgrip"),right:q.getObjectByName("rightgrip")},U.menu=q.getObjectByName("menubutton"),U.system=q.getObjectByName("systembutton"),U.trackpad=q.getObjectByName("touchpad"),U.trigger=q.getObjectByName("trigger"),Object.keys(U).forEach(function(ve){oe.setButtonColor(ve,oe.data.buttonColor)}),q.position.set(0,-.015,.04))},onAxisMoved:function(W){L(this,this.mapping.axes,W)},updateModel:function(W,U){var q,oe;this.data.model&&(oe=U.indexOf("touch")!==-1,!oe&&(q=U==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(W,q)))},setButtonColor:function(W,U){var q=this.buttonMeshes,oe=this.rendererSystem;if(q){if(W==="grip"){q.grip.left.material.color.set(U),q.grip.right.material.color.set(U),oe.applyColorCorrection(q.grip.left.material.color),oe.applyColorCorrection(q.grip.right.material.color);return}q[W].material.color.set(U),oe.applyColorCorrection(q[W].material.color)}}})},"./src/components/vive-focus-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b="HTC Vive Focus",S="https://cdn.aframe.io/controllers/vive/focus-controller/focus-controller.gltf";Z.exports.Component=B("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.removeControllersUpdateListener=H(this.removeControllersUpdateListener,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var I=this;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(O){M(O.detail.id,"down",I)},this.onButtonUp=function(O){M(O.detail.id,"up",I)},this.onButtonTouchStart=function(O){M(O.detail.id,"touchstart",I)},this.onButtonTouchEnd=function(O){M(O.detail.id,"touchend",I)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var I=this.el;I.addEventListener("buttonchanged",this.onButtonChanged),I.addEventListener("buttondown",this.onButtonDown),I.addEventListener("buttonup",this.onButtonUp),I.addEventListener("touchstart",this.onButtonTouchStart),I.addEventListener("touchend",this.onButtonTouchEnd),I.addEventListener("model-loaded",this.onModelLoaded),I.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var I=this.el;I.removeEventListener("buttonchanged",this.onButtonChanged),I.removeEventListener("buttondown",this.onButtonDown),I.removeEventListener("buttonup",this.onButtonUp),I.removeEventListener("touchstart",this.onButtonTouchStart),I.removeEventListener("touchend",this.onButtonTouchEnd),I.removeEventListener("model-loaded",this.onModelLoaded),I.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){F(this,b,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var I=this.el,O=this.data;I.setAttribute("tracked-controls",{armModel:O.armModel,idPrefix:b,orientationOffset:O.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",S)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(I){var O=I.detail.model,_;this.data.model&&(_=this.buttonMeshes={},_.trigger=O.getObjectByName("BumperKey"),_.triggerPressed=O.getObjectByName("BumperKey_Press"),_.triggerPressed&&(_.triggerPressed.visible=!1),_.trackpad=O.getObjectByName("TouchPad"),_.trackpadPressed=O.getObjectByName("TouchPad_Press"),_.trackpadPressed&&(_.trackpadPressed.visible=!1))},onButtonChanged:function(I){var O=this.mapping.buttons[I.detail.id];O&&this.el.emit(O+"changed",I.detail.state)},onAxisMoved:function(I){L(this,this.mapping.axes,I)},updateModel:function(I,O){this.data.model&&this.updateButtonModel(I,O)},updateButtonModel:function(I,O){var _=this.buttonMeshes,D=I+"Pressed";if(!(!_||!_[I]||!_[D])){var V;switch(O){case"down":V=this.data.buttonHighlightColor;break;case"touchstart":V=this.data.buttonTouchedColor;break}V&&_[D].material.color.set(V),_[D].visible=!!V,_[I].visible=!V}}})},"./src/components/wasd-controls.js":(Z,te,E)=>{var B=E("./src/constants/index.js").keyboardevent.KEYCODE_TO_CODE,H=E("./src/core/component.js").registerComponent,C=E("./src/lib/three.js"),F=E("./src/utils/index.js"),L=F.bind,M=F.shouldCaptureKeyEvent,b=1e-5,S=.2,I=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];Z.exports.Component=H("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function(){this.keys={},this.easing=1.1,this.velocity=new C.Vector3,this.onBlur=L(this.onBlur,this),this.onContextMenu=L(this.onContextMenu,this),this.onFocus=L(this.onFocus,this),this.onKeyDown=L(this.onKeyDown,this),this.onKeyUp=L(this.onKeyUp,this),this.onVisibilityChange=L(this.onVisibilityChange,this),this.attachVisibilityEventListeners()},tick:function(_,D){var V=this.data,J=this.el,Y=this.velocity;!Y[V.adAxis]&&!Y[V.wsAxis]&&O(this.keys)||(D=D/1e3,this.updateVelocity(D),!(!Y[V.adAxis]&&!Y[V.wsAxis])&&J.object3D.position.add(this.getMovementVector(D)))},update:function(_){_.adAxis!==this.data.adAxis&&(this.velocity[_.adAxis]=0),_.wsAxis!==this.data.wsAxis&&(this.velocity[_.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(_){var D,V,J,Y=this.data,W=this.keys,U=this.velocity,q,oe;if(V=Y.adAxis,q=Y.wsAxis,_>S){U[V]=0,U[q]=0;return}var ve=Math.pow(1/this.easing,_*60);U[V]!==0&&(U[V]=U[V]*ve),U[q]!==0&&(U[q]=U[q]*ve),Math.abs(U[V])<b&&(U[V]=0),Math.abs(U[q])<b&&(U[q]=0),Y.enabled&&(D=Y.acceleration,Y.adEnabled&&(J=Y.adInverted?-1:1,(W.KeyA||W.ArrowLeft)&&(U[V]-=J*D*_),(W.KeyD||W.ArrowRight)&&(U[V]+=J*D*_)),Y.wsEnabled&&(oe=Y.wsInverted?-1:1,(W.KeyW||W.ArrowUp)&&(U[q]-=oe*D*_),(W.KeyS||W.ArrowDown)&&(U[q]+=oe*D*_)))},getMovementVector:function(){var _=new C.Vector3(0,0,0),D=new C.Euler(0,0,0,"YXZ");return function(V){var J=this.el.getAttribute("rotation"),Y=this.velocity,W;return _.copy(Y),_.multiplyScalar(V),J&&(W=this.data.fly?J.x:0,D.set(C.MathUtils.degToRad(W),C.MathUtils.degToRad(J.y),0),_.applyEuler(D)),_}}(),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var _=Object.keys(this.keys),D=0;D<_.length;D++)delete this.keys[_[D]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(_){var D;M(_)&&(D=_.code||B[_.keyCode],I.indexOf(D)!==-1&&(this.keys[D]=!0))},onKeyUp:function(_){var D;D=_.code||B[_.keyCode],delete this.keys[D]}});function O(_){var D;for(D in _)return!1;return!0}},"./src/components/windows-motion-controls.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/utils/bind.js"),C=E("./src/utils/tracked-controls.js"),F=C.checkControllerPresentAndSetup,L=C.emitIfAxesChanged,M=C.onButtonEvent,b=E("./src/utils/index.js"),S=b.debug("components:windows-motion-controls:debug"),I=b.debug("components:windows-motion-controls:warn"),O=E("./src/constants/index.js").DEFAULT_HANDEDNESS,_="https://cdn.aframe.io/controllers/microsoft/",D={left:"left.glb",right:"right.glb",default:"universal.glb"},V=E("./src/utils/index.js").device.isWebXRAvailable,J="windows-mixed-reality",Y="Spatial Controller (Spatial Interaction Source) ",W=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,U=V?J:Y,q={axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},oe={axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},ve=V?oe:q;Z.exports.Component=B("windows-motion-controls",{schema:{hand:{default:O},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:ve,bindMethods:function(){this.onModelError=H(this.onModelError,this),this.onModelLoaded=H(this.onModelLoaded,this),this.onControllersUpdate=H(this.onControllersUpdate,this),this.checkIfControllerPresent=H(this.checkIfControllerPresent,this),this.onAxisMoved=H(this.onAxisMoved,this)},init:function(){var Ae=this,Se=this.el;this.onButtonChanged=H(this.onButtonChanged,this),this.onButtonDown=function(Ie){M(Ie.detail.id,"down",Ae)},this.onButtonUp=function(Ie){M(Ie.detail.id,"up",Ae)},this.onButtonTouchStart=function(Ie){M(Ie.detail.id,"touchstart",Ae)},this.onButtonTouchEnd=function(Ie){M(Ie.detail.id,"touchend",Ae)},this.onControllerConnected=function(){Ae.setModelVisibility(!0)},this.onControllerDisconnected=function(){Ae.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},Se.addEventListener("controllerconnected",this.onControllerConnected),Se.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var Ae=this.el;Ae.addEventListener("buttonchanged",this.onButtonChanged),Ae.addEventListener("buttondown",this.onButtonDown),Ae.addEventListener("buttonup",this.onButtonUp),Ae.addEventListener("touchstart",this.onButtonTouchStart),Ae.addEventListener("touchend",this.onButtonTouchEnd),Ae.addEventListener("axismove",this.onAxisMoved),Ae.addEventListener("model-error",this.onModelError),Ae.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var Ae=this.el;Ae.removeEventListener("buttonchanged",this.onButtonChanged),Ae.removeEventListener("buttondown",this.onButtonDown),Ae.removeEventListener("buttonup",this.onButtonUp),Ae.removeEventListener("touchstart",this.onButtonTouchStart),Ae.removeEventListener("touchend",this.onButtonTouchEnd),Ae.removeEventListener("axismove",this.onAxisMoved),Ae.removeEventListener("model-error",this.onModelError),Ae.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){F(this,U,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var Ae=this.createControllerModelUrl();this.loadModel(Ae)},createControllerModelUrl:function(Ae){var Se=this.el.components["tracked-controls"],Ie=Se?Se.controller:null,de="default",pe=this.data.hand,we;if(Ie&&!window.hasNativeWebXRImplementation&&(pe=Ie.hand,!Ae)){var he=Ie.id.match(W);de=he&&he[0]||de}return we=D[pe]||D.default,_+de+"/"+we},injectTrackedControls:function(){var Ae=this.data;this.el.setAttribute("tracked-controls",{idPrefix:U,controller:Ae.pair,hand:Ae.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(Ae){var Se=this.createControllerModelUrl(!0);Ae.detail.src!==Se?(I("Failed to load controller model for device, attempting to load default."),this.loadModel(Se)):I("Failed to load default controller model.")},loadModel:function(Ae){this.el.setAttribute("gltf-model","url("+Ae+")")},onModelLoaded:function(Ae){var Se=this.controllerModel=Ae.detail.model,Ie=this.loadedMeshInfo,de,pe,we,he;if(S("Processing model"),Ie.buttonMeshes={},Ie.axisMeshes={},Se){for(de=0;de<this.mapping.buttons.length;de++){if(pe=this.mapping.buttonMeshNames[this.mapping.buttons[de]],!pe){S("Skipping unknown button at index: "+de+" with mapped name: "+this.mapping.buttons[de]);continue}if(we=Se.getObjectByName(pe),!we){I("Missing button mesh with name: "+pe);continue}he={index:de,value:Pe(we,"VALUE"),pressed:Pe(we,"PRESSED"),unpressed:Pe(we,"UNPRESSED")},he.value&&he.pressed&&he.unpressed?Ie.buttonMeshes[this.mapping.buttons[de]]=he:I("Missing button submesh under mesh with name: "+pe+"(VALUE: "+!!he.value+", PRESSED: "+!!he.pressed+", UNPRESSED:"+!!he.unpressed+")")}for(de=0;de<this.mapping.axisMeshNames.length;de++){if(pe=this.mapping.axisMeshNames[de],!pe){S("Skipping unknown axis at index: "+de);continue}if(we=Se.getObjectByName(pe),!we){I("Missing axis mesh with name: "+pe);continue}he={index:de,value:Pe(we,"VALUE"),min:Pe(we,"MIN"),max:Pe(we,"MAX")},he.value&&he.min&&he.max?Ie.axisMeshes[de]=he:I("Missing axis submesh under mesh with name: "+pe+"(VALUE: "+!!he.value+", MIN: "+!!he.min+", MAX:"+!!he.max+")")}this.calculateRayOriginFromMesh(Se),this.setModelVisibility()}S("Model load complete.");function Pe(Ve,ze){for(var et=0,Tt=Ve.children.length;et<Tt;et++){var Rt=Ve.children[et];if(Rt&&Rt.name===ze)return Rt}}},calculateRayOriginFromMesh:function(){var Ae=new THREE.Quaternion;return function(Se){var Ie;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,Ie=Se.getObjectByName(this.mapping.pointingPoseMeshName),Ie){var de=Se.parent;de&&(Se.parent=null,Se.updateMatrixWorld(!0),Se.parent=de),Ie.getWorldPosition(this.rayOrigin.origin),Ie.getWorldQuaternion(Ae),this.rayOrigin.direction.applyQuaternion(Ae),de&&Se.updateMatrixWorld(!0)}else S("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var Ae=new THREE.Quaternion;return function(Se,Ie){var de=this.loadedMeshInfo.axisMeshes[Se];if(de){var pe=de.min,we=de.max,he=de.value,Pe=Ie*.5+.5;he.setRotationFromQuaternion(Ae.copy(pe.quaternion).slerp(we.quaternion,Pe)),he.position.lerpVectors(pe.position,we.position,Pe)}}}(),lerpButtonTransform:function(){var Ae=new THREE.Quaternion;return function(Se,Ie){var de=this.loadedMeshInfo.buttonMeshes[Se];if(de){var pe=de.unpressed,we=de.pressed,he=de.value;he.setRotationFromQuaternion(Ae.copy(pe.quaternion).slerp(we.quaternion,Ie)),he.position.lerpVectors(pe.position,we.position,Ie)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(Ae){var Se=this.mapping.buttons[Ae.detail.id];Se&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(Se,Ae.detail.state.value),this.el.emit(Se+"changed",Ae.detail.state))},onAxisMoved:function(Ae){var Se=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var Ie=0;Ie<Se;Ie++)this.lerpAxisTransform(Ie,Ae.detail.axis[Ie]||0);L(this,this.mapping.axes,Ae)},setModelVisibility:function(Ae){var Se=this.el.getObject3D("mesh");Ae=Ae!==void 0?Ae:this.modelVisible,this.modelVisible=Ae,Se&&(Se.visible=Ae)}})},"./src/constants/index.js":(Z,te,E)=>{Z.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:E("./src/constants/keyboardevent.js")}},"./src/constants/keyboardevent.js":Z=>{Z.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},"./src/core/a-assets.js":(Z,te,E)=>{var B=E("./src/core/a-node.js").ANode,H=E("./src/utils/bind.js"),C=E("./src/utils/debug.js"),F=E("./src/lib/three.js"),L=new F.FileLoader,M=C("core:a-assets:warn");class b extends B{constructor(){super(),this.isAssets=!0,this.fileLoader=L,this.timeout=null}connectedCallback(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var W=this,U,q=[],oe,ve,Ae,Se,Ie;if(super.connectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(Se=this.querySelectorAll("img"),U=0;U<Se.length;U++)Ae=O(Se[U]),q.push(new Promise(function(de,pe){F.Cache.add(Se[U].getAttribute("src"),Ae),Ae.onload=de,Ae.onerror=pe}));for(ve=this.querySelectorAll("audio, video"),U=0;U<ve.length;U++)oe=O(ve[U]),!oe.src&&!oe.srcObject&&M("Audio/video asset has neither `src` nor `srcObject` attributes."),q.push(I(oe));Promise.allSettled(q).then(H(this.load,this)),Ie=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){W.hasLoaded||(M("Asset loading timed out in ",Ie,"ms"),W.emit("timeout"),W.load())},Ie)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(U){return U.isAssetItem&&U.hasAttribute("src")})}}customElements.define("a-assets",b);class S extends B{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var W=this,U=this.getAttribute("src");L.setResponseType(this.getAttribute("response-type")||V(U)),L.load(U,function(oe){W.data=oe,setTimeout(function(){B.prototype.load.call(W)})},function(oe){W.emit("progress",{loadedBytes:oe.loaded,totalBytes:oe.total,xhr:oe})},function(oe){W.emit("error",{xhr:oe})})}}customElements.define("a-asset-item",S);function I(Y){if(!(!Y.hasAttribute("autoplay")&&Y.getAttribute("preload")!=="auto"))return new Promise(function(W,U){if(Y.readyState===4)return W();if(Y.error)return U();Y.addEventListener("loadeddata",q,!1),Y.addEventListener("progress",q,!1),Y.addEventListener("error",U,!1);function q(){for(var oe=0,ve=0;ve<Y.buffered.length;ve++)oe+=Y.buffered.end(ve)-Y.buffered.start(ve);oe>=Y.duration&&(Y.tagName==="VIDEO"&&F.Cache.add(Y.getAttribute("src"),Y),W())}})}function O(Y){var W=_(Y);return W.tagName&&W.tagName.toLowerCase()==="video"&&(W.setAttribute("playsinline",""),W.setAttribute("webkit-playsinline","")),W!==Y&&(Y.parentNode.appendChild(W),Y.parentNode.removeChild(Y)),W}function _(Y){var W,U;return Y.hasAttribute("crossorigin")||(U=Y.getAttribute("src"),U!==null&&(U.indexOf("://")===-1||D(U)===window.location.host))?Y:(M('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',U),Y.crossOrigin="anonymous",W=Y.cloneNode(!0),W)}function D(Y){var W=Y.indexOf("://")>-1?Y.split("/")[2]:Y.split("/")[0];return W.substring(0,W.indexOf(":"))}function V(Y){var W=J(Y),U=W.lastIndexOf(".");if(U>=0){var q=W.slice(U,Y.search(/\?|#|$/));if(q===".glb")return"arraybuffer"}return"text"}Z.exports.inferResponseType=V;function J(Y){var W=document.createElement("a");W.href=Y;var U=W.search.replace(/^\?/,""),q=Y.replace(U,"").replace("?","");return q.substring(q.lastIndexOf("/")+1)}Z.exports.getFileNameFromURL=J},"./src/core/a-cubemap.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=B("core:cubemap:warn");class C extends HTMLElement{constructor(L){return L=super(L),L.srcs=L.validate(),L}validate(){var L=this.querySelectorAll("[src]"),M,b=[];if(L.length===6){for(M=0;M<L.length;M++)b.push(L[M].getAttribute("src"));return b}H("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",C)},"./src/core/a-entity.js":(Z,te,E)=>{var B=E("./src/core/a-node.js").ANode,H=E("./src/core/component.js").components,C=E("./src/lib/three.js"),F=E("./src/utils/index.js"),L=F.debug("core:a-entity:debug"),M=F.debug("core:a-entity:warn"),b="__",S=["position","rotation","scale","visible"],I={once:!0};class O extends B{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new C.Group,this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(U,q,oe){var ve=this.components[U];if(super.attributeChangedCallback(),ve&&ve.justInitialized&&oe===""){delete ve.justInitialized;return}!ve&&oe===null||this.setEntityAttribute(U,q,oe)}connectedCallback(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this.connectedCallback.bind(this));return}O.prototype.doConnectedCallback.call(this)}doConnectedCallback(){var U=this,q,oe;if(super.connectedCallback(),oe=this.sceneEl,this.addToParent(),!this.isScene){if(!oe){this.load();return}if(q=oe.querySelector("a-assets"),q&&!q.hasLoaded){q.addEventListener("loaded",function(){U.load()});return}this.load()}}disconnectedCallback(){var U;if(this.parentEl){for(U in this.components)this.removeComponent(U,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(U){return this.object3DMap[U]}setObject3D(U,q){var oe,ve=this;if(!(q instanceof C.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");oe=this.getObject3D(U),oe&&this.object3D.remove(oe),q.el=this,q.children.length&&q.traverse(function(Se){Se.el=ve}),this.object3D.add(q),this.object3DMap[U]=q,this.emit("object3dset",{object:q,type:U})}removeObject3D(U){var q=this.getObject3D(U);if(!q){M("Tried to remove `Object3D` of type:",U,"which was not defined.");return}this.object3D.remove(q),delete this.object3DMap[U],this.emit("object3dremove",{type:U})}getOrCreateObject3D(U,q){var oe=this.getObject3D(U);return!oe&&q&&(oe=new q,this.setObject3D(U,oe)),M("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),oe}add(U){if(!U.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(U.object3D),this.emit("child-attached",{el:U})}addToParent(){var U=this.parentEl=this.parentNode;!U||!U.add||this.attachedToParent||(U.add(this),this.attachedToParent=!0)}removeFromParent(){var U=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,U.emit("child-detached",{el:this})}load(){var U=this;this.hasLoaded||!this.parentEl||super.load.call(this,function(){U.parentEl&&(U.updateComponents(),(U.isScene||U.parentEl.isPlaying)&&U.play())})}remove(U){U?this.object3D.remove(U.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var U=this.children,q=[],oe=0;oe<U.length;oe++){var ve=U[oe];ve instanceof O&&q.push(ve)}return q}initComponent(U,q,oe){var ve,Ae,Se,Ie,de;if(Se=F.split(U,b),Ie=Se[0],Ae=Se.length>2?Se.slice(1).join("__"):Se[1],!!H[Ie]&&(de=_(this,U)||q!==void 0,!(!de&&!oe)&&!(U in this.components))){if(this.initComponentDependencies(Ie),Ae&&!H[Ie].multiple)throw new Error("Trying to initialize multiple components of type `"+Ie+"`. There can only be one component of this type per entity.");ve=new H[Ie].Component(this,q,Ae),this.isPlaying&&ve.play(),this.hasAttribute(U)||(ve.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,U,"")),L("Component initialized: %s",U)}}initComponentDependencies(U){var q=this,oe=H[U],ve,Ae;if(oe&&(ve=H[U].dependencies,!!ve))for(Ae=0;Ae<ve.length;Ae++)q.initComponent(ve[Ae],window.HTMLElement.prototype.getAttribute.call(q,ve[Ae])||void 0,!0)}removeComponent(U,q){var oe;if(oe=this.components[U],!!oe){if(!oe.initialized){this.addEventListener("componentinitialized",function ve(Ae){Ae.detail.name===U&&(this.removeComponent(U,q),this.removeEventListener("componentinitialized",ve))});return}oe.pause(),oe.remove(),q&&(oe.destroy(),delete this.components[U]),this.emit("componentremoved",oe.evtDetail,!1)}}updateComponents(){var U,q,oe,ve,Ae=this.componentsToUpdate;if(this.hasLoaded){for(oe=0;oe<this.mixinEls.length;oe++)for(ve in this.mixinEls[oe].componentCache)J(ve)&&(Ae[ve]=!0);if(this.getExtraComponents){q=this.getExtraComponents();for(ve in q)J(ve)&&(Ae[ve]=!0)}for(oe=0;oe<this.attributes.length;++oe)ve=this.attributes[oe].name,S.indexOf(ve)===-1&&J(ve)&&(Ae[ve]=!0);for(oe=0;oe<S.length;oe++)ve=S[oe],this.hasAttribute(ve)&&this.updateComponent(ve,this.getDOMAttribute(ve));for(ve in Ae)U=V(this.getDOMAttribute(ve),q&&q[ve]),this.updateComponent(ve,U),delete Ae[ve]}}updateComponent(U,q,oe){var ve=this.components[U];if(ve){if(q===null&&!_(this,U)){this.removeComponent(U,!0);return}ve.updateProperties(q,oe);return}this.initComponent(U,q,!1)}removeAttribute(U,q){var oe=this.components[U];if(oe&&q===void 0&&this.removeComponent(U,!0),oe&&q!==void 0){oe.resetProperty(q);return}U==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,U)}play(){var U,q,oe;if(!(this.isPlaying||!this.hasLoaded)){this.isPlaying=!0;for(oe in this.components)this.components[oe].play();for(U=this.getChildEntities(),q=0;q<U.length;q++)U[q].play();this.emit("play")}}pause(){var U,q,oe;if(this.isPlaying){this.isPlaying=!1;for(oe in this.components)this.components[oe].pause();for(U=this.getChildEntities(),q=0;q<U.length;q++)U[q].pause();this.emit("pause")}}setEntityAttribute(U,q,oe){if(H[U]||this.components[U]){this.updateComponent(U,oe);return}if(U==="mixin"){if(oe===this.computedMixinStr)return;this.mixinUpdate(oe,q)}}mixinUpdate(U,q){var oe=O.componentsUpdated,ve,Ae,Se,Ie,de=this;if(!this.hasLoaded){this.addEventListener("loaded",function(){de.mixinUpdate(U,q)},I);return}for(q=q||this.getAttribute("mixin"),Se=this.updateMixins(U,q),oe.length=0,Ie=0;Ie<this.mixinEls.length;Ie++)for(ve in this.mixinEls[Ie].componentCache)oe.indexOf(ve)===-1&&(this.components[ve]?this.components[ve].handleMixinUpdate():this.initComponent(ve,null),oe.push(ve));for(Ie=0;Ie<Se.oldMixinIds.length;Ie++)if(Ae=document.getElementById(Se.oldMixinIds[Ie]),!!Ae)for(ve in Ae.componentCache)oe.indexOf(ve)===-1&&this.components[ve]&&(this.getDOMAttribute(ve)?this.components[ve].handleMixinUpdate():this.removeComponent(ve,!0))}setAttribute(U,q,oe){var ve=O.singlePropUpdate,Ae,Se,Ie,de,pe,we;if(de=U.indexOf(b),Ie=de>0?U.substring(0,de):U,!H[Ie]){U==="mixin"&&this.mixinUpdate(q),super.setAttribute.call(this,U,q);return}if(!this.components[U]&&this.hasAttribute(U)&&this.updateComponent(U,window.HTMLElement.prototype.getAttribute.call(this,U)),typeof oe<"u"&&typeof q=="string"&&q.length>0&&typeof F.styleParser.parse(q)=="string"){for(we in ve)delete ve[we];Ae=ve,Ae[q]=oe,Se=!1}else Ae=q,Se=oe===!0;this.updateComponent(U,Ae,Se),pe=this.sceneEl&&this.sceneEl.getAttribute("debug"),pe&&this.components[U].flushToDOM()}flushToDOM(U){var q=this.components,oe,ve=this.children,Ae,Se;for(Se in q)q[Se].flushToDOM();if(U)for(Ae=0;Ae<ve.length;++Ae)oe=ve[Ae],oe.flushToDOM&&oe.flushToDOM(U)}getAttribute(U){var q;return U==="position"?this.object3D.position:U==="rotation"?Y(this):U==="scale"?this.object3D.scale:U==="visible"?this.object3D.visible:(q=this.components[U],q?q.data:window.HTMLElement.prototype.getAttribute.call(this,U))}getDOMAttribute(U){var q=this.components[U];return q?q.attrValue:window.HTMLElement.prototype.getAttribute.call(this,U)}addState(U){this.is(U)||(this.states.push(U),this.emit("stateadded",U))}removeState(U){var q=this.states.indexOf(U);q!==-1&&(this.states.splice(q,1),this.emit("stateremoved",U))}is(U){return this.states.indexOf(U)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var U;if(this.parentNode){M("Entity can only be destroyed if detached from scenegraph.");return}for(U in this.components)this.components[U].destroy()}}function _(W,U){return W.components[U]&&W.components[U].attrValue?!0:D(U,W.mixinEls)}function D(W,U){var q,oe=!1;for(q=0;q<U.length&&(oe=U[q].hasAttribute(W),!oe);++q);return oe}function V(W,U){return U?U.constructor===Object?F.extend(U,F.styleParser.parse(W||{})):W||U:W}function J(W){return W.indexOf(b)!==-1&&(W=F.split(W,b)[0]),!!H[W]}function Y(W){var U=C.MathUtils.radToDeg,q=W.object3D.rotation,oe=W.rotationObj;return oe.x=U(q.x),oe.y=U(q.y),oe.z=U(q.z),oe}O.componentsUpdated=[],O.singlePropUpdate={},customElements.define("a-entity",O),Z.exports.AEntity=O},"./src/core/a-mixin.js":(Z,te,E)=>{var B=E("./src/core/a-node.js").ANode,H=E("./src/core/component.js").components,C=E("./src/utils/index.js"),F="__";class L extends B{constructor(){super(),this.componentCache={},this.isMixin=!0}connectedCallback(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){super.connectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(b,S,I){super.attributeChangedCallback(),this.cacheAttribute(b,I),this.updateEntities()}setAttribute(b,S){window.HTMLElement.prototype.setAttribute.call(this,b,S),this.cacheAttribute(b,S)}cacheAttribute(b,S){var I,O;O=C.split(b,F)[0],I=H[O],I&&(S===void 0&&(S=window.HTMLElement.prototype.getAttribute.call(this,b)),this.componentCache[b]=I.parseAttrValueForCache(S))}getAttribute(b){return this.componentCache[b]||window.HTMLElement.prototype.getAttribute.call(this,b)}cacheAttributes(){var b=this.attributes,S,I;for(I=0;I<b.length;I++)S=b[I].name,this.cacheAttribute(S)}updateEntities(){var b,S,I;if(this.sceneEl)for(S=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),I=0;I<S.length;I++)b=S[I],!(!b.hasLoaded||b.isMixin)&&b.mixinUpdate(this.id)}}customElements.define("a-mixin",L)},"./src/core/a-node.js":(Z,te,E)=>{var B=E("./src/utils/index.js"),H=B.debug("core:a-node:warn"),C={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function F(M){return M.tagName.toLowerCase()in C||M.isNode}class L extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]}connectedCallback(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this.connectedCallback.bind(this));return}L.prototype.doConnectedCallback.call(this)}doConnectedCallback(){var b;this.sceneEl=this.closestScene(),this.sceneEl||H("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(b=this.getAttribute("mixin"),b&&this.updateMixins(b))}attributeChangedCallback(b,S,I){I!==this.computedMixinStr&&b==="mixin"&&!this.isMixin&&this.updateMixins(I,S)}closestScene(){for(var b=this;b&&!b.isScene;)b=b.parentElement;return b}closest(b){for(var S=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,I=this;I&&!S.call(I,b);)I=I.parentElement;return I}disconnectedCallback(){this.hasLoaded=!1}load(b,S){var I,O,_=this;this.hasLoaded||(S=S||F,I=this.getChildren(),O=I.filter(S).map(function(D){return new Promise(function(J,Y){if(D.hasLoaded)return J();D.addEventListener("loaded",J),D.addEventListener("error",Y)})}),Promise.allSettled(O).then(function(V){V.forEach(function(Y){Y.status==="rejected"&&H("Rendering scene with errors on node: ",Y.reason.target)}),_.hasLoaded=!0,b&&b(),_.setupMutationObserver(),_.emit("loaded",void 0,!1)}))}setupMutationObserver(){var b=this,S={attributes:!0,attributeOldValue:!0},I=new MutationObserver(function(_){var D;for(D=0;D<_.length;D++)if(_[D].type==="attributes"){var V=_[D].attributeName,J=window.HTMLElement.prototype.getAttribute.call(b,V),Y=_[D].oldValue;b.attributeChangedCallback(V,Y,J)}});I.observe(this,S)}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(b,S){var I=L.newMixinIdArray,O=L.oldMixinIdArray,_=L.mixinIds,D,V,J;for(I.length=0,O.length=0,V=b?B.split(b.trim(),/\s+/):I,J=S?B.split(S.trim(),/\s+/):O,_.newMixinIds=V,_.oldMixinIds=J,D=0;D<J.length;D++)V.indexOf(J[D])===-1&&this.unregisterMixin(J[D]);for(this.computedMixinStr="",this.mixinEls.length=0,D=0;D<V.length;D++)this.registerMixin(document.getElementById(V[D]));return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),_}registerMixin(b){var S,I,O;if(b){if(O=b.getAttribute("mixin"),O)for(S=B.split(O.trim(),/\s+/),I=0;I<S.length;I++)this.registerMixin(document.getElementById(S[I]));this.computedMixinStr=this.computedMixinStr+" "+b.id,this.mixinEls.push(b)}}setAttribute(b,S){b==="mixin"&&this.updateMixins(S),window.HTMLElement.prototype.setAttribute.call(this,b,S)}unregisterMixin(b){var S,I=this.mixinEls,O;for(S=0;S<I.length;++S)if(O=I[S],b===O.id){I.splice(S,1);break}}emit(b,S,I,O){var _=L.evtData;I===void 0&&(I=!0),_.bubbles=!!I,_.detail=S,O&&(_=B.extend({},O,_)),this.dispatchEvent(new CustomEvent(b,_))}}L.evtData={},L.newMixinIdArray=[],L.oldMixinIdArray=[],L.mixinIds={},customElements.define("a-node",L),Z.exports.ANode=L,Z.exports.knownTags=C},"./src/core/component.js":(Z,te,E)=>{var B=E("./src/core/schema.js"),H=E("./src/core/scene/scenes.js"),C=E("./src/core/system.js"),F=E("./src/utils/index.js"),L=Z.exports.components={},M=B.parseProperties,b=B.parseProperty,S=B.process,I=B.isSingleProperty,O=B.stringifyProperties,_=B.stringifyProperty,D=F.styleParser,V=F.debug("core:component:warn"),J=document.currentScript,Y=new RegExp("[A-Z]+"),W={},U=Z.exports.Component=function(he,Pe,Ve){var ze=this;this.el=he,this.id=Ve,this.attrName=this.name+(Ve?"__"+Ve:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.isSingleProperty=I(this.schema),this.isSinglePropertyObject=this.isSingleProperty&&pe(b(void 0,this.schema))&&!(this.schema.default instanceof window.HTMLElement),this.isObjectBased=!this.isSingleProperty||this.isSinglePropertyObject,this.el.components[this.attrName]=this,this.objectPool=W[this.name];var et=this.events;this.events={},q(this,et),this.attrValue=void 0,this.isObjectBased?(this.nextData=this.objectPool.use(),F.objectPool.removeUnusedKeys(this.nextData,this.schema),this.oldData=this.objectPool.use(),F.objectPool.removeUnusedKeys(this.oldData,this.schema),this.previousOldData=this.objectPool.use(),F.objectPool.removeUnusedKeys(this.previousOldData,this.schema),this.parsingAttrValue=this.objectPool.use(),F.objectPool.removeUnusedKeys(this.parsingAttrValue,this.schema)):(this.nextData=void 0,this.oldData=void 0,this.previousOldData=void 0,this.parsingAttrValue=void 0),this.throttledEmitComponentChanged=F.throttleLeadingAndTrailing(function(){he.emit("componentchanged",ze.evtDetail,!1)},200),this.updateProperties(Pe)};U.prototype={schema:{},init:function(){},events:{},update:function(he){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},parse:function(he,Pe){var Ve=this.schema;return this.isSingleProperty?b(he,Ve):M(D.parse(he),Ve,!0,this.name,Pe)},stringify:function(he){var Pe=this.schema;return typeof he=="string"?he:this.isSingleProperty?_(he,Pe):(he=O(he,Pe),D.stringify(he))},updateCachedAttrValue:function(he,Pe){var Ve,ze,et;if(he!==void 0){if(he===null){this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0;return}if(he instanceof Object&&!(he instanceof window.HTMLElement)?(ze=this.objectPool.use(),Ve=F.extend(ze,he)):Ve=this.parseAttrValueForCache(he),this.isObjectBased&&!Pe&&this.attrValue)for(et in this.attrValue)Ve[et]===void 0&&(Ve[et]=this.attrValue[et]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),F.objectPool.clearObject(this.attrValue),this.attrValue=Ae(this.attrValue,Ve,this.isObjectBased),F.objectPool.clearObject(ze)}},parseAttrValueForCache:function(he){var Pe;return typeof he!="string"?he:(this.isSingleProperty?(Pe=this.schema.parse(he),typeof Pe=="string"&&(Pe=he)):(F.objectPool.clearObject(this.parsingAttrValue),Pe=D.parse(he,this.parsingAttrValue)),Pe)},flushToDOM:function(he){var Pe=he?this.data:this.attrValue;Pe!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(Pe))},updateProperties:function(he,Pe){var Ve=this.el;if(!Ve.hasLoaded){this.updateCachedAttrValue(he);return}he!==null&&(he=this.parseAttrValueForCache(he)),this.updateCachedAttrValue(he,Pe),this.initialized?(this.updateComponent(he,Pe),this.callUpdateHandler()):this.initComponent()},initComponent:function(){var he=this.el,Pe;this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),!he.initializingComponents[this.name]&&(he.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete he.initializingComponents[this.name],this.oldData=Ae(this.oldData,this.data,this.isObjectBased),Pe=this.isObjectBased?this.objectPool.use():void 0,this.update(Pe),this.isObjectBased&&this.objectPool.recycle(Pe),he.isPlaying&&this.play(),he.emit("componentinitialized",this.evtDetail,!1))},updateComponent:function(he,Pe){var Ve,ze;if(Pe){this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),this.data=this.buildData(this.attrValue,!0,!1);return}if(this.isSingleProperty){this.isObjectBased&&b(he,this.schema),this.data=he;return}if(M(he,this.schema,!0,this.name),this.schemaChangeKeys.length){for(Ve in he)if(this.schema[Ve].schemaChange){ze=!0;break}}if(ze){this.updateSchema&&this.updateSchema(this.buildData(this.attrValue,!0,!0)),this.data=this.buildData(this.attrValue,!0,!1);return}for(Ve in he)he[Ve]!==void 0&&(this.data[Ve]=he[Ve])},callUpdateHandler:function(){var he;this.previousOldData instanceof Object&&F.objectPool.clearObject(this.previousOldData),this.isObjectBased?ve(this.previousOldData,this.oldData):this.previousOldData=this.oldData,he=!F.deepEqual(this.oldData,this.data),!(!this.isPositionRotationScale&&!he)&&(this.oldData instanceof Object&&F.objectPool.clearObject(this.oldData),this.oldData=Ae(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData),this.throttledEmitComponentChanged())},handleMixinUpdate:function(){this.data=this.buildData(this.attrValue),this.callUpdateHandler()},resetProperty:function(he){if(this.isObjectBased){if(!(he in this.attrValue))return;delete this.attrValue[he],this.data[he]=this.schema[he].default}else this.attrValue=this.schema.default,this.data=this.schema.default;this.updateProperties(this.attrValue)},extendSchema:function(he){var Pe;Pe=F.extend({},L[this.name].schema),F.extend(Pe,he),this.schema=S(Pe),this.el.emit("schemachanged",this.evtDetail)},buildData:function(he,Pe,Ve){var ze,et,Tt,Rt,fn,cn=this.nextData,Jn=this.schema,yn,Wn=this.el.mixinEls,gi;if(ze=he&&he.constructor===Array?he.length:he!=null,this.isObjectBased&&F.objectPool.clearObject(cn),this.isSingleProperty)this.isObjectBased?et=ve(cn,Jn.default):et=we(Jn.default)?F.clone(Jn.default):Jn.default;else{gi=!Pe&&this.attrValue,et=gi instanceof Object?ve(cn,gi):cn;for(Rt in Jn)Tt=Jn[Rt].default,et[Rt]===void 0&&(et[Rt]=we(Tt)?F.clone(Tt):Tt)}for(yn=0;yn<Wn.length;yn++)fn=Wn[yn].getAttribute(this.attrName),fn&&(et=Ae(et,fn,this.isObjectBased));if(ze){if(this.isSingleProperty)return pe(he)?(ve(this.parsingAttrValue,he),b(this.parsingAttrValue,Jn)):b(he,Jn);et=Ae(et,he,this.isObjectBased)}else if(this.isSingleProperty)return b(et,Jn);return M(et,Jn,void 0,this.name,Ve)},eventsAttach:function(){var he;this.eventsDetach();for(he in this.events)this.el.addEventListener(he,this.events[he])},eventsDetach:function(){var he;for(he in this.events)this.el.removeEventListener(he,this.events[he])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}};function q(he,Pe){var Ve;for(Ve in Pe)he.events[Ve]=Pe[Ve].bind(he)}if(window.debug)var oe=Z.exports.registrationOrderWarnings={};Z.exports.registerComponent=function(he,Pe){var Ve,ze,et={},Tt,Rt;if(document.currentScript&&document.currentScript!==J&&H.forEach(function(cn){cn.hasLoaded||document.currentScript.compareDocumentPosition(cn)!==Node.DOCUMENT_POSITION_FOLLOWING&&(V("The component `"+he+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(oe[he]=!0))}),Y.test(he)===!0&&V("The component name `"+he+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+he.toLowerCase()+"`"),he.indexOf("__")!==-1)throw new Error("The component name `"+he+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(Pe).forEach(function(fn){et[fn]={value:Pe[fn],writable:!0}}),L[he])throw new Error("The component `"+he+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");if(Ve=function(fn,cn,Jn){U.call(this,fn,cn,Jn)},Ve.prototype=Object.create(U.prototype,et),Ve.prototype.name=he,Ve.prototype.isPositionRotationScale=he==="position"||he==="rotation"||he==="scale",Ve.prototype.constructor=Ve,Ve.prototype.system=C&&C.systems[he],Ve.prototype.play=de(Ve.prototype.play),Ve.prototype.pause=Ie(Ve.prototype.pause),Tt=F.extend(S(Ve.prototype.schema,Ve.prototype.name)),Rt=I(Ve.prototype.schema),!Rt){Ve.prototype.schemaChangeKeys=[];for(ze in Tt)Tt[ze].schemaChange&&Ve.prototype.schemaChangeKeys.push(ze)}return W[he]=F.objectPool.createPool(),L[he]={Component:Ve,dependencies:Ve.prototype.dependencies,isSingleProp:Rt,multiple:Ve.prototype.multiple,name:he,parse:Ve.prototype.parse,parseAttrValueForCache:Ve.prototype.parseAttrValueForCache,schema:Tt,stringify:Ve.prototype.stringify,type:Ve.prototype.type},Ve};function ve(he,Pe){var Ve,ze;for(ze in Pe)Pe[ze]!==void 0&&(Ve=Pe[ze],he[ze]=we(Ve)?F.clone(Ve):Ve);return he}function Ae(he,Pe,Ve){var ze;if(Ve&&Pe.constructor===Object){for(ze in Pe)Pe[ze]!==void 0&&(Pe[ze]&&Pe[ze].constructor===Object?he[ze]=F.clone(Pe[ze]):he[ze]=Pe[ze]);return he}return Pe}function Se(he){return he.tick||he.tock}function Ie(he){return function(){var Ve=this.el.sceneEl;this.isPlaying&&(he.call(this),this.isPlaying=!1,this.eventsDetach(),Se(this)&&Ve.removeBehavior(this))}}function de(he){return function(){var Ve=this.el.sceneEl,ze=this.el.isPlaying&&!this.isPlaying;!this.initialized||!ze||(he.call(this),this.isPlaying=!0,this.eventsAttach(),Se(this)&&Ve.addBehavior(this))}}function pe(he){return he&&he.constructor===Object&&!(he instanceof window.HTMLElement)}function we(he){return he&&(he.constructor===Object||he.constructor===Array)&&!(he instanceof window.HTMLElement)}},"./src/core/geometry.js":(Z,te,E)=>{var B=E("./src/core/schema.js"),H=B.process,C=Z.exports.geometries={},F=Z.exports.geometryNames=[],L=E("./src/lib/three.js"),M=Z.exports.Geometry=function(){};M.prototype={schema:{},init:function(b){return this.geometry=new L.BufferGeometry,this.geometry},update:function(b){}},Z.exports.registerGeometry=function(b,S){var I,O={};if(Object.keys(S).forEach(function(D){O[D]={value:S[D],writable:!0}}),C[b])throw new Error("The geometry `"+b+"` has been already registered");return I=function(){M.call(this)},I.prototype=Object.create(M.prototype,O),I.prototype.name=b,I.prototype.constructor=I,C[b]={Geometry:I,schema:H(I.prototype.schema)},F.push(b),I}},"./src/core/propertyTypes.js":(Z,te,E)=>{var B=E("./src/utils/coordinates.js"),H=E("./node_modules/debug/browser.js"),C=H("core:propertyTypes:warn"),F=H("core:propertyTypes:warn"),L=Z.exports.propertyTypes={},M=/[,> .[\]:]/,b=/\url\((.+)\)/;S("audio","",_),S("array",[],I,O),S("asset","",_),S("boolean",!1,J),S("color","#FFF",D,V),S("int",0,Y),S("number",0,W),S("map","",_),S("model","",_),S("selector",null,U,oe),S("selectorAll",null,q,ve),S("src","",Ae),S("string","",D,V),S("time",0,Y),S("vec2",{x:0,y:0},Se,B.stringify),S("vec3",{x:0,y:0,z:0},Se,B.stringify),S("vec4",{x:0,y:0,z:0,w:1},Se,B.stringify);function S(pe,we,he,Pe){if("type"in L){C("Property type "+pe+" is already registered.");return}L[pe]={default:we,parse:he||D,stringify:Pe||V}}Z.exports.registerPropertyType=S;function I(pe){if(Array.isArray(pe))return pe;if(!pe||typeof pe!="string")return[];return pe.split(",").map(we);function we(he){return he.trim()}}function O(pe){return pe.join(", ")}function _(pe){var we,he;if(typeof pe!="string")return pe;if(he=pe.match(b),he)return he[1];if(pe.charAt(0)==="#"){if(we=document.getElementById(pe.substring(1)),we)return we.tagName==="CANVAS"||we.tagName==="VIDEO"||we.tagName==="IMG"?we:we.getAttribute("src");F('"'+pe+'" asset not found.');return}return pe}function D(pe){return pe}function V(pe){return pe===null?"null":pe.toString()}function J(pe){return pe!=="false"&&pe!==!1}function Y(pe){return parseInt(pe,10)}function W(pe){return parseFloat(pe,10)}function U(pe){return pe?typeof pe!="string"?pe:pe[0]==="#"&&!M.test(pe)?document.getElementById(pe.substring(1)):document.querySelector(pe):null}function q(pe){return pe?typeof pe!="string"?pe:Array.prototype.slice.call(document.querySelectorAll(pe),0):null}function oe(pe){return pe.getAttribute?"#"+pe.getAttribute("id"):V(pe)}function ve(pe){return pe instanceof Array?pe.map(function(we){return"#"+we.getAttribute("id")}).join(", "):V(pe)}function Ae(pe){return F("`src` property type is deprecated. Use `asset` instead."),_(pe)}function Se(pe){return B.parse(pe,this.default)}function Ie(pe,we){return pe==="audio"&&typeof we!="string"||pe==="array"&&!Array.isArray(we)||pe==="asset"&&typeof we!="string"||pe==="boolean"&&typeof we!="boolean"||pe==="color"&&typeof we!="string"||pe==="int"&&typeof we!="number"||pe==="number"&&typeof we!="number"||pe==="map"&&typeof we!="string"||pe==="model"&&typeof we!="string"||pe==="selector"&&typeof we!="string"&&we!==null||pe==="selectorAll"&&typeof we!="string"&&we!==null||pe==="src"&&typeof we!="string"||pe==="string"&&typeof we!="string"||pe==="time"&&typeof we!="number"?!1:pe==="vec2"?de(we,2):pe==="vec3"?de(we,3):pe==="vec4"?de(we,4):!0}Z.exports.isValidDefaultValue=Ie;function de(pe,we){if(pe===null)return!0;if(typeof pe!="object"||Object.keys(pe).length!==we)return!1;var he=pe.x,Pe=pe.y,Ve=pe.z,ze=pe.w;return!(typeof he!="number"||typeof Pe!="number"||we>2&&typeof Ve!="number"||we>3&&typeof ze!="number")}Z.exports.isValidDefaultCoordinate=de},"./src/core/scene/a-scene.js":(Z,te,E)=>{var B=E("./src/core/scene/metaTags.js").inject,H=E("./src/core/scene/wakelock.js"),C=E("./src/core/scene/loadingScreen.js"),F=E("./src/core/scene/scenes.js"),L=E("./src/core/system.js").systems,M=E("./src/lib/three.js"),b=E("./src/utils/index.js"),S=E("./src/core/a-entity.js").AEntity,I=E("./src/core/a-node.js").ANode,O=E("./src/core/scene/postMessage.js"),_=b.bind,D=b.device.isIOS(),V=b.device.isMobile(),J=b.device.isWebXRAvailable,Y=b.debug("core:a-scene:warn");D&&E("./src/utils/ios-orientationchange-blank-bug.js");class W extends S{constructor(){var de;super(),de=this,de.clock=new M.Clock,de.isIOS=D,de.isMobile=V,de.hasWebXR=J,de.isAR=!1,de.isScene=!0,de.object3D=new M.Scene,de.object3D.onAfterRender=function(pe,we,he){de.isPlaying&&de.tock(de.time,de.delta,he)},de.resize=_(de.resize,de),de.render=_(de.render,de),de.systems={},de.systemNames=[],de.time=de.delta=0,de.behaviors={tick:[],tock:[]},de.hasLoaded=!1,de.isPlaying=!1,de.originalHTML=de.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}connectedCallback(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var de=this,pe=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("vr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.connectedCallback(),Se(this),this.setupRenderer(),C.setup(this,q),this.resize(),pe||this.addFullScreenStyles(),O(this),B(this),H(this),this.onVRPresentChangeBound=_(this.onVRPresentChange,this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){de.enterVR()},this.exitVRBound=function(){de.exitVR()},this.exitVRTrueBound=function(){de.exitVR(!0)},this.pointerRestrictedBound=function(){de.pointerRestricted()},this.pointerUnrestrictedBound=function(){de.pointerUnrestricted()},J||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){de.attachedCallbackPostCamera()}),this.initSystems(),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){de.enterVR()})}attachedCallbackPostCamera(){var de,pe=this;window.addEventListener("load",de),window.addEventListener("resize",function(){pe.isIOS?setTimeout(pe.resize,100):pe.resize()}),this.play(),F.push(this)}initSystems(){var de;this.initSystem("camera");for(de in L)de!=="camera"&&this.initSystem(de)}initSystem(de){this.systems[de]||(this.systems[de]=new L[de](this),this.systemNames.push(de))}disconnectedCallback(){var de=F.indexOf(this);super.disconnectedCallback(),F.splice(de,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.dispose()}addBehavior(de){var pe,we=this.behaviors,he;for(he in we)de[he]&&(pe=this.behaviors[he],pe.indexOf(de)===-1&&pe.push(de))}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return b.device.checkHeadsetConnected()}enterAR(){var de;if(!this.hasWebXR)throw de="Failed to enter AR mode, WebXR not supported.",new Error(de);if(!b.device.checkARSupport())throw de="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(de);return this.enterVR(!0)}enterVR(de){var pe=this,we,he=pe.renderer.xr,Pe;if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var Ve=pe.getAttribute("renderer");if(he.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var ze=this.sceneEl.systems.webxr.sessionReferenceSpaceType;he.setReferenceSpaceType(ze);var et=de?"immersive-ar":"immersive-vr";return Pe=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(cn,Jn){navigator.xr.requestSession(et,Pe).then(function(Wn){pe.xrSession=Wn,he.layersEnabled=Pe.requiredFeatures.indexOf("layers")!==-1,he.setSession(Wn).then(function(){he.setFoveation(Ve.foveationLevel)}),Wn.addEventListener("end",pe.exitVRBound),Rt(cn)},function(Wn){var gi=et==="immersive-ar",ai=gi?"AR":"VR";throw new Error("Failed to enter "+ai+" mode (`requestSession`) "+Wn)})})}else{if(we=b.device.getVRDisplay(),he.setDevice(we),we.isPresenting&&!window.hasNativeWebVRImplementation)return Rt(),Promise.resolve();var Tt={highRefreshRate:Ve.highRefreshRate};return we.requestPresent([{source:this.canvas,attributes:Tt}]).then(Rt,fn)}}return Rt(),Promise.resolve();function Rt(cn){var Jn;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(Jn=new CustomEvent("vrdisplaypresentchange",{detail:{display:b.device.getVRDisplay()}}),window.dispatchEvent(Jn)),de?pe.addState("ar-mode"):pe.addState("vr-mode"),pe.emit("enter-vr",{target:pe}),!J&&pe.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),pe.addFullScreenStyles(),!pe.isMobile&&!pe.checkHeadsetConnected()&&ve(pe.canvas),pe.resize(),cn&&cn()}function fn(cn){throw pe.removeState("vr-mode"),cn&&cn.message?new Error("Failed to enter VR mode (`requestPresent`): "+cn.message):new Error("Failed to enter VR mode (`requestPresent`).")}}exitVR(){var de=this,pe,we=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(we.enabled=!1,pe=b.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0;else if(pe.isPresenting)return pe.exitPresent().then(he,Pe)}else Ae();return he(),Promise.resolve();function he(){de.removeState("vr-mode"),de.removeState("ar-mode"),de.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),de.hasAttribute("embedded")&&de.removeFullScreenStyles(),de.resize(),de.isIOS&&b.forceCanvasResizeSafariMobile(de.canvas),de.renderer.setPixelRatio(window.devicePixelRatio),de.emit("exit-vr",{target:de})}function Pe(Ve){throw Ve&&Ve.message?new Error("Failed to exit VR mode (`exitPresent`): "+Ve.message):new Error("Failed to exit VR mode (`exitPresent`).")}}pointerRestricted(){if(this.canvas){var de=this.getPointerLockElement();de&&de!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}pointerUnrestricted(){var de=this.getPointerLockElement();de&&de===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}onVRPresentChange(de){var pe=de.display||de.detail.display;if(pe&&pe.isPresenting){this.enterVR();return}this.exitVR()}getAttribute(de){var pe=this.systems[de];return pe?pe.data:S.prototype.getAttribute.call(this,de)}getComputedAttribut(de){Y("`getComputedAttribute` is deprecated. Use `getAttribute` instead."),this.getAttribute(de)}getDOMAttribute(de){var pe=this.systems[de];return pe?pe.data:S.prototype.getDOMAttribute.call(this,de)}setAttribute(de,pe,we){var he=this.systems[de];if(he){I.prototype.setAttribute.call(this,de,pe),he.updateProperties(pe);return}S.prototype.setAttribute.call(this,de,pe,we)}removeBehavior(de){var pe,we,he=this.behaviors,Pe;for(we in he)de[we]&&(pe=this.behaviors[we],Pe=pe.indexOf(de),Pe!==-1&&pe.splice(Pe,1))}resize(){var de=this.camera,pe=this.canvas,we,he,Pe,Ve=this.renderer.xr.isPresenting;he=this.renderer.xr.enabled&&Ve,!(!de||!pe||this.is("vr-mode")&&(this.isMobile||he))&&(we=this.getAttribute("embedded")&&!this.is("vr-mode"),Pe=q(pe,we,this.maxCanvasSize,this.is("vr-mode")),de.aspect=Pe.width/Pe.height,de.updateProjectionMatrix(),this.renderer.setSize(Pe.width,Pe.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var de=this,pe,we,he,Pe;Pe={alpha:!0,antialias:!V,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:1920,width:1920},this.hasAttribute("renderer")&&(he=this.getAttribute("renderer"),we=b.styleParser.parse(he),we.precision&&(Pe.precision=we.precision+"p"),we.antialias&&we.antialias!=="auto"&&(Pe.antialias=we.antialias==="true"),we.logarithmicDepthBuffer&&we.logarithmicDepthBuffer!=="auto"&&(Pe.logarithmicDepthBuffer=we.logarithmicDepthBuffer==="true"),we.alpha&&(Pe.alpha=we.alpha==="true"),this.maxCanvasSize={width:we.maxCanvasWidth?parseInt(we.maxCanvasWidth):this.maxCanvasSize.width,height:we.maxCanvasHeight?parseInt(we.maxCanvasHeight):this.maxCanvasSize.height}),pe=this.renderer=new M.WebGLRenderer(Pe),pe.setPixelRatio(window.devicePixelRatio),pe.sortObjects=!1,this.camera&&pe.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){pe.xr.setPoseTarget(de.camera.el.object3D)})}play(){var de=this,pe=this;if(this.renderStarted){S.prototype.play.call(this);return}this.addEventListener("loaded",function(){var we=this.renderer,he,Pe=this.renderer.xr;S.prototype.play.call(this),!pe.renderStarted&&(pe.resize(),pe.renderer&&(window.performance&&window.performance.mark("render-started"),C.remove(),he=b.device.getVRDisplay(),he&&he.isPresenting&&(Pe.setDevice(he),Pe.enabled=!0,pe.enterVR()),we.setAnimationLoop(this.render),pe.renderStarted=!0,pe.emit("renderstart")))}),setTimeout(function(){S.prototype.load.call(de)})}updateComponent(de){de in L||S.prototype.updateComponent.apply(this,arguments)}tick(de,pe){var we,he=this.systems;for(we=0;we<this.behaviors.tick.length;we++)this.behaviors.tick[we].el.isPlaying&&this.behaviors.tick[we].tick(de,pe);for(we=0;we<this.systemNames.length;we++)he[this.systemNames[we]].tick&&he[this.systemNames[we]].tick(de,pe)}tock(de,pe,we){var he,Pe=this.systems;for(he=0;he<this.behaviors.tock.length;he++)this.behaviors.tock[he].el.isPlaying&&this.behaviors.tock[he].tock(de,pe,we);for(he=0;he<this.systemNames.length;he++)Pe[this.systemNames[he]].tock&&Pe[this.systemNames[he]].tock(de,pe,we)}render(de,pe){var we=this.renderer;this.frame=pe,this.delta=this.clock.getDelta()*1e3,this.time=this.clock.elapsedTime*1e3,this.isPlaying&&this.tick(this.time,this.delta);var he=null;this.is("ar-mode")&&(he=this.object3D.background,this.object3D.background=null),we.render(this.object3D,this.camera),he&&(this.object3D.background=he)}}function U(Ie,de){var pe,we=window.devicePixelRatio;return!de||de.width===-1&&de.height===-1||Ie.width*we<de.width&&Ie.height*we<de.height||(pe=Ie.width/Ie.height,Ie.width*we>de.width&&de.width!==-1&&(Ie.width=Math.round(de.width/we),Ie.height=Math.round(de.width/pe/we)),Ie.height*we>de.height&&de.height!==-1&&(Ie.height=Math.round(de.height/we),Ie.width=Math.round(de.height*pe/we))),Ie}window.customElements.define("a-scene",W);function q(Ie,de,pe,we){if(!Ie.parentElement)return{height:0,width:0};if(de){var he;return he={height:Ie.parentElement.offsetHeight,width:Ie.parentElement.offsetWidth},U(he,pe)}return oe(pe,we)}function oe(Ie,de){var pe;return pe={height:document.body.offsetHeight,width:document.body.offsetWidth},de?pe:U(pe,Ie)}function ve(Ie){var de=Ie.requestFullscreen||Ie.webkitRequestFullscreen||Ie.mozRequestFullScreen||Ie.msRequestFullscreen;de.apply(Ie,[{navigationUI:"hide"}])}function Ae(){var Ie=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;Ie&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function Se(Ie){var de;de=document.createElement("canvas"),de.classList.add("a-canvas"),de.dataset.aframeCanvas=!0,Ie.appendChild(de),document.addEventListener("fullscreenchange",pe),document.addEventListener("mozfullscreenchange",pe),document.addEventListener("webkitfullscreenchange",pe),document.addEventListener("MSFullscreenChange",pe),de.addEventListener("touchmove",function(we){we.preventDefault()}),Ie.canvas=de,Ie.emit("render-target-loaded",{target:de}),setTimeout(_(Ie.resize,Ie),0);function pe(){var we=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;we||Ie.exitVR(),document.activeElement.blur(),document.body.focus()}}Z.exports.setupCanvas=Se,Z.exports.AScene=W},"./src/core/scene/loadingScreen.js":(Z,te,E)=>{var B=E("./src/utils/index.js"),H=B.styleParser,C,F,L,M="loading-screen",b="a-loader-title";Z.exports.setup=function(_,D){C=_,L=D;var V=C.hasAttribute(M)?H.parse(C.getAttribute(M)):void 0,J=V&&V.dotsColor||"white",Y=V&&V.backgroundColor||"#24CAFF",W=V===void 0||V.enabled==="true"||V.enabled===void 0,U,q,oe,ve,Ae,Se,Ie,de,pe,we;W&&(U=new THREE.Scene,q=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),oe=new THREE.MeshBasicMaterial({color:J}),ve=new THREE.Mesh(q,oe),Ae=ve.clone(),Se=ve.clone(),Ie=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),de=new THREE.Clock,pe=0,we=function(){C.renderer.render(U,Ie),pe=de.getElapsedTime()%4,ve.visible=pe>=1,Ae.visible=pe>=2,Se.visible=pe>=3},U.background=new THREE.Color(Y),U.add(Ie),ve.position.set(-1,0,-15),Ae.position.set(0,0,-15),Se.position.set(1,0,-15),Ie.add(ve),Ie.add(Ae),Ie.add(Se),I(),setTimeout(function(){C.hasLoaded||(S(Ie),F.style.display="block",window.addEventListener("resize",function(){S(Ie)}),C.renderer.setAnimationLoop(we))},200))},Z.exports.remove=function(){window.removeEventListener("resize",S),F&&(F.style.display="none")};function S(O){var _=C.hasAttribute("embedded"),D=L(C.canvas,_,C.maxCanvasSize,C.is("vr-mode"));O.aspect=D.width/D.height,O.updateProjectionMatrix(),C.renderer.setSize(D.width,D.height,!1)}function I(){F=document.createElement("div"),F.className=b,F.innerHTML=document.title,F.style.display="none",C.appendChild(F)}},"./src/core/scene/metaTags.js":(Z,te,E)=>{var B=E("./src/constants/index.js"),H=E("./src/utils/index.js").extend,C=Z.exports.MOBILE_HEAD_TAGS=[L({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),L({name:"mobile-web-app-capable",content:"yes"}),L({name:"theme-color",content:"black"})],F=[L({name:"apple-mobile-web-app-capable",content:"yes"}),L({name:"apple-mobile-web-app-status-bar-style",content:"black"}),M({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function L(S){return{tagName:"meta",attributes:S,exists:function(){return document.querySelector('meta[name="'+S.name+'"]')}}}function M(S){return{tagName:"link",attributes:S,exists:function(){return document.querySelector('link[rel="'+S.rel+'"]')}}}Z.exports.inject=function(I){var O=document.head,_=O.querySelector("script"),D,V=[];return C.forEach(J),I.isIOS&&F.forEach(J),V;function J(Y){!Y||Y.exists()||(D=b(Y),D&&(_?_.parentNode.insertBefore(D,_):O.appendChild(D),V.push(D)))}};function b(S){if(!(!S||!S.tagName)){var I=document.createElement(S.tagName);return I.setAttribute(B.AFRAME_INJECTED,""),H(I,S.attributes)}}},"./src/core/scene/postMessage.js":(Z,te,E)=>{var B=E("./src/utils/bind.js"),H=E("./src/utils/index.js").isIframed;Z.exports=function(L){H()&&window.addEventListener("message",B(C,L))};function C(F){var L=this;if(F.data)switch(F.data.type){case"vr":switch(F.data.data){case"enter":L.enterVR();break;case"exit":L.exitVR();break}}}},"./src/core/scene/scenes.js":Z=>{Z.exports=[]},"./src/core/scene/wakelock.js":(Z,te,E)=>{var B=E("./vendor/wakelock/wakelock.js");Z.exports=function(C){if(C.isMobile){var F=C.wakelock=new B;C.addEventListener("enter-vr",function(){F.request()}),C.addEventListener("exit-vr",function(){F.release()})}}},"./src/core/schema.js":(Z,te,E)=>{var B=E("./src/utils/index.js"),H=E("./src/core/propertyTypes.js"),C=B.debug,F=H.isValidDefaultValue,L=H.propertyTypes,M=C("core:schema:warn");function b(_){return"type"in _?typeof _.type=="string":"default"in _}Z.exports.isSingleProperty=b,Z.exports.process=function(_,D){var V;if(b(_))return S(_,D);for(V in _)_[V]=S(_[V],D);return _};function S(_,D){var V=_.default,J,Y,W=_.type;return _.type?_.type==="bool"?W="boolean":_.type==="float"&&(W="number"):V!==void 0&&(typeof V=="boolean"||typeof V=="number")?W=typeof V:Array.isArray(V)?W="array":W="string",Y=L[W],Y||M("Unknown property type for component `"+D+"`: "+W),J=!!_.parse,_.parse=_.parse||Y.parse,_.stringify=_.stringify||Y.stringify,_.type=W,"default"in _?!J&&!F(W,V)&&M("Default value `"+V+"` does not match type `"+W+"` in component `"+D+"`"):_.default=Y.default,_}Z.exports.processPropertyDefinition=S,Z.exports.parseProperties=function(){var _=[];return function(D,V,J,Y,W){var U,q,oe,ve;_.length=0;for(q in J?D:V)J&&D[q]===void 0||_.push(q);if(D===null||typeof D!="object")return D;for(q in D)D[q]!==void 0&&!V[q]&&!W&&M("Unknown property `"+q+"` for component/system `"+Y+"`.");for(U=0;U<_.length;U++){if(q=_[U],oe=V[q],ve=D[q],!V[q])return;D[q]=I(ve,oe)}return D}}();function I(_,D){return(_==null||_==="")&&(_=D.default,Array.isArray(_)&&(_=_.slice())),D.parse(_,D.default)}Z.exports.parseProperty=I,Z.exports.stringifyProperties=function(_,D){var V,J,Y,W={},U;for(V in _)J=D[V],Y=_[V],U=Y,typeof U=="object"&&(U=O(Y,J),J||M("Unknown component property: "+V)),W[V]=U;return W};function O(_,D){return typeof _!="object"?_:!D||_===null?JSON.stringify(_):D.stringify(_)}Z.exports.stringifyProperty=O},"./src/core/shader.js":(Z,te,E)=>{var B=E("./src/core/schema.js"),H=B.process,C=Z.exports.shaders={},F=Z.exports.shaderNames=[],L=E("./src/lib/three.js"),M=E("./src/utils/index.js"),b={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},S=Z.exports.Shader=function(){};S.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(I){return this.attributes=this.initVariables(I,"attribute"),this.uniforms=this.initVariables(I,"uniform"),this.material=new(this.raw?L.RawShaderMaterial:L.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initVariables:function(I,O){var _,D=this.schema,V={},J;for(_ in D)D[_].is===O&&(J=b[D[_].type],V[_]={type:J,value:void 0});return V},update:function(I){this.updateVariables(I,"attribute"),this.updateVariables(I,"uniform")},updateVariables:function(I,O){var _,D,V=this.schema,J;J=O==="uniform"?this.uniforms:this.attributes;for(_ in I)if(!(!V[_]||V[_].is!==O)){if(V[_].type==="map"){if(!J[_]||J[_].value===I[_])continue;D="_texture_"+_,this.setMapOnTextureLoad(J,_,D),M.material.updateMapMaterialFromData(D,_,this,I);continue}J[_].value=this.parseValue(V[_].type,I[_]),J[_].needsUpdate=!0}},parseValue:function(I,O){var _;switch(I){case"vec2":return new L.Vector2(O.x,O.y);case"vec3":return new L.Vector3(O.x,O.y,O.z);case"vec4":return new L.Vector4(O.x,O.y,O.z,O.w);case"color":return _=new L.Color(O),new L.Vector3(_.r,_.g,_.b);case"map":return L.ImageUtils.loadTexture(O);default:return O}},setMapOnTextureLoad:function(I,O,_){var D=this;this.el.addEventListener("materialtextureloaded",function(){I[O].value=D.material[_],I[O].needsUpdate=!0})}},Z.exports.registerShader=function(I,O){var _,D={};if(Object.keys(O).forEach(function(V){D[V]={value:O[V],writable:!0}}),C[I])throw new Error("The shader "+I+" has been already registered");return _=function(){S.call(this)},_.prototype=Object.create(S.prototype,D),_.prototype.name=I,_.prototype.constructor=_,C[I]={Shader:_,schema:H(_.prototype.schema)},F.push(I),_}},"./src/core/system.js":(Z,te,E)=>{var B=E("./src/core/component.js"),H=E("./src/core/schema.js"),C=E("./src/utils/index.js"),F=H.parseProperties,L=H.parseProperty,M=H.process,b=H.isSingleProperty,S=C.styleParser,I=Z.exports.systems={},O=Z.exports.System=function(_){var D=B&&B.components[this.name];this.el=_,this.sceneEl=_,D&&(D.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};O.prototype={schema:{},init:function(){},update:function(_){},updateProperties:function(_){var D=this.data;Object.keys(H).length&&(this.buildData(_),this.update(D))},buildData:function(_){var D=this.schema;Object.keys(D).length&&(_=_||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),b(D)?this.data=L(_,D):this.data=F(S.parse(_)||{},D))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},Z.exports.registerSystem=function(_,D){var V,J,Y={},W=C.findAllScenes(document);if(Object.keys(D).forEach(function(U){Y[U]={value:D[U],writable:!0}}),I[_])throw new Error("The system `"+_+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");for(J=function(U){O.call(this,U)},J.prototype=Object.create(O.prototype,Y),J.prototype.name=_,J.prototype.constructor=J,J.prototype.schema=C.extend(M(J.prototype.schema)),I[_]=J,V=0;V<W.length;V++)W[V].initSystem(_)}},"./src/extras/components/index.js":(Z,te,E)=>{E("./src/extras/components/pivot.js")},"./src/extras/components/pivot.js":(Z,te,E)=>{var B=E("./src/core/component.js").registerComponent,H=E("./src/lib/three.js"),C=new H.Vector3,F=new H.Vector3;B("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var L=this.data,M=this.el,b=M.object3D.parent,S=M.object3D,I=new H.Group;C.copy(S.position),F.copy(S.rotation),b.remove(S),I.add(S),b.add(I),M.object3D=I,S.position.set(-1*L.x,-1*L.y,-1*L.z),I.position.set(L.x+C.x,L.y+C.y,L.z+C.z),I.rotation.copy(S.rotation),S.rotation.set(0,0,0)}})},"./src/extras/primitives/getMeshMixin.js":(Z,te,E)=>{var B=E("./src/core/component.js").components,H=E("./src/core/shader.js").shaders,C=E("./src/utils/index.js"),F={};Object.keys(B.material.schema).forEach(L),Object.keys(H.standard.schema).forEach(L);function L(M){var b=M.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();M==="fog"&&(b="material-fog"),M==="visible"&&(b="material-visible"),F[b]="material."+M}Z.exports=function(){return{defaultComponents:{material:{}},mappings:C.extend({},F)}}},"./src/extras/primitives/index.js":(Z,te,E)=>{E("./src/extras/primitives/primitives/a-camera.js"),E("./src/extras/primitives/primitives/a-cursor.js"),E("./src/extras/primitives/primitives/a-curvedimage.js"),E("./src/extras/primitives/primitives/a-gltf-model.js"),E("./src/extras/primitives/primitives/a-image.js"),E("./src/extras/primitives/primitives/a-light.js"),E("./src/extras/primitives/primitives/a-link.js"),E("./src/extras/primitives/primitives/a-obj-model.js"),E("./src/extras/primitives/primitives/a-sky.js"),E("./src/extras/primitives/primitives/a-sound.js"),E("./src/extras/primitives/primitives/a-text.js"),E("./src/extras/primitives/primitives/a-video.js"),E("./src/extras/primitives/primitives/a-videosphere.js"),E("./src/extras/primitives/primitives/meshPrimitives.js")},"./src/extras/primitives/primitives.js":(Z,te,E)=>{var B=E("./src/core/a-node.js").knownTags,H=E("./src/core/a-entity.js").AEntity,C=E("./src/core/component.js").components,F=E("./src/utils/index.js"),L=F.debug,M=F.entity.setComponentProperty,b=L("extras:primitives:debug"),S=L("extras:primitives:warn"),I=L("extras:primitives:error"),O=Z.exports.primitives={};Z.exports.registerPrimitive=function(J,Y){if(J=J.toLowerCase(),B[J]){I("Trying to register primitive "+J+" that has been already previously registered");return}B[J]=!0,b("Registering <%s>",J),Y.defaultAttributes&&S("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var W=Y.mappings||{},U=class extends H{constructor(){super(),this.defaultComponentsFromPrimitive=Y.defaultComponents||Y.defaultAttributes||{},this.deprecated=Y.deprecated||null,this.deprecatedMappings=Y.deprecatedMappings||{},this.mappings=W,Y.deprecated&&console.warn(Y.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var q=this.mappings,oe=this;Object.keys(q).forEach(function(Ae){var Se;Ae!==Ae.toLowerCase()&&S("Mapping keys should be specified in lower case. The mapping key "+Ae+" may not be recognized"),C[Ae]&&(Se=q[Ae].replace(".","-"),q[Se]=q[Ae],delete q[Ae],console.warn("The primitive "+oe.tagName.toLowerCase()+" has a mapping collision. The attribute "+Ae+" has the same name as a registered component and has been renamed to "+Se))})}getExtraComponents(){var q,oe,ve,Ae,Se,Ie,de=this;for(oe=F.clone(this.defaultComponentsFromPrimitive),Se=this.getAttribute("mixin"),Se&&(Se=Se.trim().split(" "),Se.forEach(function(ze){var et=de.sceneEl.querySelector("#"+ze).componentCache;Object.keys(et).forEach(function(Rt){oe[Rt]=pe(oe[Rt],et[Rt])})})),ve=0;ve<this.attributes.length;ve++)if(q=this.attributes[ve],Ae=this.mappings[q.name],Ae){Ie=F.entity.getComponentPropertyPath(Ae),Ie.constructor===Array?(oe[Ie[0]]=oe[Ie[0]]||{},oe[Ie[0]][Ie[1]]=q.value.trim()):oe[Ie]=q.value.trim();continue}return oe;function pe(Ve,ze){return we(Ve)?he(ze):we(ze)?he(Ve):Pe(Ve)&&Pe(ze)?F.extendDeep(Ve,ze):he(ze)}function we(Ve){return typeof Ve>"u"}function he(Ve){return Pe(Ve)?F.extendDeep({},Ve):Ve}function Pe(Ve){return Ve!==null&&Ve.constructor===Object}}attributeChangedCallback(q,oe,ve){var Ae=this.mappings[q];if(q in this.deprecatedMappings&&console.warn(this.deprecatedMappings[q]),!q||!Ae){super.attributeChangedCallback(q,oe,ve);return}M(this,Ae,ve)}};return customElements.define(J,U),U.mappings=W,O[J]=U,U};function _(V,J){var Y=C[V].schema;Object.keys(Y).map(function(W){var U=W.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();J[U]!==void 0&&(U=V+"-"+W),J[U]=V+"."+W})}function D(V,J,Y){Y=Y||{},Object.keys(J).map(function(U){_(U,Y)}),Z.exports.registerPrimitive(V,F.extendDeep({},null,{defaultComponents:J,mappings:Y}))}Z.exports.definePrimitive=D},"./src/extras/primitives/primitives/a-camera.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").registerPrimitive;B("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},"./src/extras/primitives/primitives/a-cursor.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-cursor",C.extendDeep({},B(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},"./src/extras/primitives/primitives/a-curvedimage.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-curvedimage",C.extendDeep({},B(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},"./src/extras/primitives/primitives/a-gltf-model.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").registerPrimitive;B("a-gltf-model",{mappings:{src:"gltf-model"}})},"./src/extras/primitives/primitives/a-image.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-image",C.extendDeep({},B(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-light.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").registerPrimitive;B("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}})},"./src/extras/primitives/primitives/a-link.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").registerPrimitive;B("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},"./src/extras/primitives/primitives/a-obj-model.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js")(),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-obj-model",C.extendDeep({},B,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},"./src/extras/primitives/primitives/a-sky.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js"),F=E("./src/extras/primitives/primitives/meshPrimitives.js");H("a-sky",C.extendDeep({},B(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:C.extendDeep({},F["a-sphere"].mappings)}))},"./src/extras/primitives/primitives/a-sound.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").registerPrimitive;B("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},"./src/extras/primitives/primitives/a-text.js":(Z,te,E)=>{var B=E("./src/extras/primitives/primitives.js").definePrimitive;B("a-text",{text:{anchor:"align",width:5}})},"./src/extras/primitives/primitives/a-video.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-video",C.extendDeep({},B(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-videosphere.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/extras/primitives/primitives.js").registerPrimitive,C=E("./src/utils/index.js");H("a-videosphere",C.extendDeep({},B(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},"./src/extras/primitives/primitives/meshPrimitives.js":(Z,te,E)=>{var B=E("./src/extras/primitives/getMeshMixin.js"),H=E("./src/core/geometry.js").geometries,C=E("./src/core/geometry.js").geometryNames,F=E("./src/extras/primitives/primitives.js").registerPrimitive,L=E("./src/utils/index.js"),M=Z.exports={};C.forEach(function(I){var O=H[I],_=b(I),D={};Object.keys(O.schema).forEach(function(W){D[b(W)]="geometry."+W});var V="a-"+_,J=F(V,L.extendDeep({},B(),{defaultComponents:{geometry:{primitive:I}},mappings:D}));M[V]=J});function b(S){return S.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},"./src/geometries/box.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(C){this.geometry=new H.BoxGeometry(C.width,C.height,C.depth,C.segmentsWidth,C.segmentsHeight,C.segmentsDepth)}})},"./src/geometries/circle.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(F){this.geometry=new H.CircleGeometry(F.radius,F.segments,C(F.thetaStart),C(F.thetaLength))}})},"./src/geometries/cone.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(F){this.geometry=new H.CylinderGeometry(F.radiusTop,F.radiusBottom,F.height,F.segmentsRadial,F.segmentsHeight,F.openEnded,C(F.thetaStart),C(F.thetaLength))}})},"./src/geometries/cylinder.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(F){this.geometry=new H.CylinderGeometry(F.radius,F.radius,F.height,F.segmentsRadial,F.segmentsHeight,F.openEnded,C(F.thetaStart),C(F.thetaLength))}})},"./src/geometries/dodecahedron.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(C){this.geometry=new H.DodecahedronGeometry(C.radius,C.detail)}})},"./src/geometries/icosahedron.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(C){this.geometry=new H.IcosahedronGeometry(C.radius,C.detail)}})},"./src/geometries/index.js":(Z,te,E)=>{E("./src/geometries/box.js"),E("./src/geometries/circle.js"),E("./src/geometries/cone.js"),E("./src/geometries/cylinder.js"),E("./src/geometries/dodecahedron.js"),E("./src/geometries/icosahedron.js"),E("./src/geometries/octahedron.js"),E("./src/geometries/plane.js"),E("./src/geometries/ring.js"),E("./src/geometries/sphere.js"),E("./src/geometries/tetrahedron.js"),E("./src/geometries/torus.js"),E("./src/geometries/torusKnot.js"),E("./src/geometries/triangle.js")},"./src/geometries/octahedron.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(C){this.geometry=new H.OctahedronGeometry(C.radius,C.detail)}})},"./src/geometries/plane.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(C){this.geometry=new H.PlaneGeometry(C.width,C.height,C.segmentsWidth,C.segmentsHeight)}})},"./src/geometries/ring.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(F){this.geometry=new H.RingGeometry(F.radiusInner,F.radiusOuter,F.segmentsTheta,F.segmentsPhi,C(F.thetaStart),C(F.thetaLength))}})},"./src/geometries/sphere.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(F){this.geometry=new H.SphereGeometry(F.radius,F.segmentsWidth,F.segmentsHeight,C(F.phiStart),C(F.phiLength),C(F.thetaStart),C(F.thetaLength))}})},"./src/geometries/tetrahedron.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(C){this.geometry=new H.TetrahedronGeometry(C.radius,C.detail)}})},"./src/geometries/torus.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=H.MathUtils.degToRad;B("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(F){this.geometry=new H.TorusGeometry(F.radius,F.radiusTubular*2,F.segmentsRadial,F.segmentsTubular,C(F.arc))}})},"./src/geometries/torusKnot.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js");B("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(C){this.geometry=new H.TorusKnotGeometry(C.radius,C.radiusTubular*2,C.segmentsTubular,C.segmentsRadial,C.p,C.q)}})},"./src/geometries/triangle.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").registerGeometry,H=E("./src/lib/three.js"),C=new H.Quaternion,F=new H.Vector3(0,0,1),L=new H.Vector2,M=new H.Vector2,b=new H.Vector2;B("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(S){var I,O,_,D,V,J,Y,W,U;_=new H.Triangle,_.a.set(S.vertexA.x,S.vertexA.y,S.vertexA.z),_.b.set(S.vertexB.x,S.vertexB.y,S.vertexB.z),_.c.set(S.vertexC.x,S.vertexC.y,S.vertexC.z),O=_.getNormal(new H.Vector3),C.setFromUnitVectors(O,F),D=_.a.clone().applyQuaternion(C),V=_.b.clone().applyQuaternion(C),J=_.c.clone().applyQuaternion(C),L.set(Math.min(D.x,V.x,J.x),Math.min(D.y,V.y,J.y)),M.set(Math.max(D.x,V.x,J.x),Math.max(D.y,V.y,J.y)),b.set(0,0).subVectors(M,L),D=new H.Vector2().subVectors(D,L).divide(b),V=new H.Vector2().subVectors(V,L).divide(b),J=new H.Vector2().subVectors(J,L).divide(b),I=this.geometry=new H.BufferGeometry,Y=[_.a.x,_.a.y,_.a.z,_.b.x,_.b.y,_.b.z,_.c.x,_.c.y,_.c.z],W=[O.x,O.y,O.z,O.x,O.y,O.z,O.x,O.y,O.z],U=[D.x,D.y,V.x,V.y,J.x,J.y],I.setAttribute("position",new H.Float32BufferAttribute(Y,3)),I.setAttribute("normal",new H.Float32BufferAttribute(W,3)),I.setAttribute("uv",new H.Float32BufferAttribute(U,2))}})},"./src/index.js":(Z,te,E)=>{if(window.Promise=window.Promise||E("./node_modules/promise-polyfill/Promise.js"),E("./node_modules/@ungap/custom-elements/index.js"),window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=navigator.xr!==void 0,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var B=E("./src/utils/isIOSOlderThan10.js"),H=B(window.navigator.userAgent)?1/window.devicePixelRatio:1,C=E("./node_modules/webvr-polyfill/build/webvr-polyfill.js"),F={BUFFER_SCALE:H,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new C(F)}var L=E("./src/utils/index.js"),M=L.debug;L.isIE11&&(E("./node_modules/custom-event-polyfill/polyfill.js"),E("./vendor/starts-with-polyfill.js"));var b=M("A-Frame:error"),S=M("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&S("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),!window.cordova&&window.location.protocol==="file:"&&b("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server."),E("./node_modules/present/lib/present-browser.js"),L.device.isBrowserEnvironment&&(E("./src/style/aframe.css"),E("./src/style/rStats.css"));var I=E("./src/core/scene/a-scene.js").AScene,O=E("./src/core/component.js").components,_=E("./src/core/component.js").registerComponent,D=E("./src/core/geometry.js").registerGeometry,V=E("./src/extras/primitives/primitives.js").registerPrimitive,J=E("./src/core/shader.js").registerShader,Y=E("./src/core/system.js").registerSystem,W=E("./src/core/shader.js").shaders,U=E("./src/core/system.js").systems,q=window.THREE=E("./src/lib/three.js"),oe=E("./package.json");E("./src/components/index.js"),E("./src/geometries/index.js"),E("./src/shaders/index.js"),E("./src/systems/index.js");var ve=E("./src/core/a-node.js").ANode,Ae=E("./src/core/a-entity.js").AEntity;E("./src/core/a-assets.js"),E("./src/core/a-cubemap.js"),E("./src/core/a-mixin.js"),E("./src/extras/components/index.js"),E("./src/extras/primitives/index.js"),console.log("A-Frame Version: 1.4.1 (Date 2023-01-04, Commit #5183a179)"),console.log("THREE Version (https://github.com/supermedium/three.js):",oe.dependencies["super-three"]),console.log("WebVR Polyfill Version:",oe.dependencies["webvr-polyfill"]),Z.exports=window.AFRAME={AComponent:E("./src/core/component.js").Component,AEntity:Ae,ANode:ve,ANIME:E("./node_modules/super-animejs/lib/anime.es.js").default,AScene:I,components:O,coreComponents:Object.keys(O),geometries:E("./src/core/geometry.js").geometries,registerComponent:_,registerGeometry:D,registerPrimitive:V,registerShader:J,registerSystem:Y,primitives:{getMeshMixin:E("./src/extras/primitives/getMeshMixin.js"),primitives:E("./src/extras/primitives/primitives.js").primitives},scenes:E("./src/core/scene/scenes.js"),schema:E("./src/core/schema.js"),shaders:W,systems:U,THREE:q,utils:L,version:oe.version}},"./src/lib/rStatsAframe.js":Z=>{window.aframeStats=function(te){var E=null,B=te,H={te:{caption:"Entities"},lt:{caption:"Load Time"}},C=[{caption:"A-Frame",values:["te","lt"]}];function F(){E("te").set(L()),window.performance.getEntriesByName&&E("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}function L(){var I=B.querySelectorAll("*");return Array.prototype.slice.call(I).filter(function(O){return O.isEntity}),I.length}function M(){}function b(){}function S(I){E=I}return{update:F,start:M,end:b,attach:S,values:H,groups:C,fractions:[]}},Z.exports={aframeStats:window.aframeStats}},"./src/lib/three.js":(Z,te,E)=>{var B=E("./src/lib/three.module.js").default;B.TextureLoader&&(B.TextureLoader.prototype.crossOrigin="anonymous"),B.ImageLoader&&(B.ImageLoader.prototype.crossOrigin="anonymous"),B.Cache&&(B.Cache.enabled=!0),B.DRACOLoader.prototype.crossOrigin="anonymous",B.GLTFLoader.prototype.crossOrigin="anonymous",B.KTX2Loader.prototype.crossOrigin="anonymous",B.MTLLoader.prototype.crossOrigin="anonymous",B.OBJLoader.prototype.crossOrigin="anonymous",Z.exports=B},"./src/lib/three.module.js":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>_});var B=E("./node_modules/super-three/build/three.module.js"),H=E("./node_modules/super-three/examples/jsm/loaders/DRACOLoader.js"),C=E("./node_modules/super-three/examples/jsm/loaders/GLTFLoader.js"),F=E("./node_modules/super-three/examples/jsm/loaders/KTX2Loader.js"),L=E("./node_modules/super-three/examples/jsm/loaders/OBJLoader.js"),M=E("./node_modules/super-three/examples/jsm/loaders/MTLLoader.js"),b=E("./node_modules/super-three/examples/jsm/utils/BufferGeometryUtils.js"),S=E("./node_modules/super-three/examples/jsm/lights/LightProbeGenerator.js"),I=E("./node_modules/object-assign/index.js"),O=window.THREE=I({},B);E("./vendor/DeviceOrientationControls.js"),O.DRACOLoader=H.DRACOLoader,O.GLTFLoader=C.GLTFLoader,O.KTX2Loader=F.KTX2Loader,O.OBJLoader=L.OBJLoader,O.MTLLoader=M.MTLLoader,O.BufferGeometryUtils=b,O.LightProbeGenerator=S.LightProbeGenerator;const _=O},"./src/shaders/flat.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=E("./src/lib/three.js"),C=E("./src/utils/index.js");Z.exports.Shader=B("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(L){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new H.Color},this.textureSrc=null,F(L,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new H.MeshBasicMaterial(this.materialData)},update:function(L){this.updateMaterial(L),C.material.updateMap(this,L)},updateMaterial:function(L){var M;F(L,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color);for(M in this.materialData)this.material[M]=this.materialData[M]}});function F(L,M){return M.color.set(L.color),M.fog=L.fog,M.wireframe=L.wireframe,M.toneMapped=L.toneMapped,M.wireframeLinewidth=L.wireframeLinewidth,M}},"./src/shaders/index.js":(Z,te,E)=>{E("./src/shaders/flat.js"),E("./src/shaders/standard.js"),E("./src/shaders/phong.js"),E("./src/shaders/sdf.js"),E("./src/shaders/msdf.js"),E("./src/shaders/ios10hls.js"),E("./src/shaders/shadow.js")},"./src/shaders/ios10hls.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader;Z.exports.Shader=B("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join(`
`)})},"./src/shaders/msdf.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=!!document.createElement("canvas").getContext("webgl2"),C=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),F=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),L=H?F:C,M=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture2D(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join(`
`),b=["#version 300 es","precision highp float;","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  fragColor = vec4(color.xyz, alpha * opacity);","}"].join(`
`),S=H?b:M;Z.exports.Shader=B("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:L,fragmentShader:S})},"./src/shaders/phong.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=new H.CubeTextureLoader,L={};Z.exports.Shader=B("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(b){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new H.Color,specular:new H.Color,emissive:new H.Color},this.textureSrc=null,M(b,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.material=new H.MeshPhongMaterial(this.materialData),C.material.updateMap(this,b)},update:function(b){this.updateMaterial(b),C.material.updateMap(this,b),b.normalMap&&C.material.updateDistortionMap("normal",this,b),b.displacementMap&&C.material.updateDistortionMap("displacement",this,b),b.ambientOcclusionMap&&C.material.updateDistortionMap("ambientOcclusion",this,b),b.bump&&C.material.updateDistortionMap("bump",this,b),this.updateEnvMap(b)},updateMaterial:function(b){var S;M(b,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color);for(S in this.materialData)this.material[S]=this.materialData[S]},updateEnvMap:function(b){var S=this,I=this.material,O=b.envMap,_=b.sphericalEnvMap,D=b.refract,V=this.el.sceneEl;if(!O&&!_||this.isLoadingEnvMap){Object.defineProperty(I,"envMap",{get:function(){return V.object3D.environment},set:function(J){delete this.envMap,this.envMap=J}}),I.needsUpdate=!0;return}if(this.isLoadingEnvMap=!0,delete I.envMap,_){this.el.sceneEl.systems.material.loadTexture(_,{src:_},function(Y){S.isLoadingEnvMap=!1,Y.mapping=D?H.EquirectangularRefractionMapping:H.EquirectangularReflectionMapping,I.envMap=Y,C.material.handleTextureEvents(S.el,Y),I.needsUpdate=!0});return}if(L[O]){L[O].then(function(J){S.isLoadingEnvMap=!1,I.envMap=J,C.material.handleTextureEvents(S.el,J),I.needsUpdate=!0});return}L[O]=new Promise(function(J){C.srcLoader.validateCubemapSrc(O,function(W){F.load(W,function(U){S.isLoadingEnvMap=!1,I.envMap=U,U.mapping=D?H.CubeRefractionMapping:H.CubeReflectionMapping,C.material.handleTextureEvents(S.el,U),J(U)})})})}});function M(b,S){switch(S.color.set(b.color),S.specular.set(b.emissive),S.emissive.set(b.emissive),S.emissiveIntensity=b.emissiveIntensity,S.fog=b.fog,S.transparent=b.transparent,S.wireframe=b.wireframe,S.wireframeLinewidth=b.wireframeLinewidth,S.shininess=b.shininess,S.flatShading=b.flatShading,S.wireframe=b.wireframe,S.wireframeLinewidth=b.wireframeLinewidth,S.reflectivity=b.reflectivity,S.refractionRatio=b.refractionRatio,b.combine){case"mix":S.combine=H.MixOperation;break;case"multiply":S.combine=H.MultiplyOperation;break;case"add":S.combine=H.AddOperation;break}return b.normalMap&&(S.normalScale=b.normalScale),b.ambientOcclusionMap&&(S.aoMapIntensity=b.ambientOcclusionMapIntensity),b.bumpMap&&(S.aoMapIntensity=b.bumpMapScale),b.displacementMap&&(S.displacementScale=b.displacementScale,S.displacementBias=b.displacementBias),S}},"./src/shaders/sdf.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=!!document.createElement("canvas").getContext("webgl2"),C=["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),F=["#version 300 es","in vec2 uv;","in vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join(`
`),L=H?F:C,M=["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture2D(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture2D(map, box.xy).a, width)","        + contour(texture2D(map, box.zw).a, width)","        + contour(texture2D(map, box.xw).a, width)","        + contour(texture2D(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture2D(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  gl_FragColor = vec4(color, opacity * alpha);","}"].join(`
`),b=["#version 300 es","precision highp float;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","out vec4 fragColor;","#ifdef GL_OES_standard_derivatives","  float contour(float width, float value) {","    return smoothstep(0.5 - value, 0.5 + value, width);","  }","#else","  float aastep(float value, float afwidth) {","    return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","  }","#endif","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","void main() {","  #ifdef GL_OES_standard_derivatives","    vec2 uv = vUV;","    vec4 texColor = texture(map, uv);","    float dist = texColor.a;","    float width = fwidth(dist);","    float alpha = contour(dist, width);","    float dscale = 0.353505;","    vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","    float isBigEnough = max(abs(duv.x), abs(duv.y));","    if (isBigEnough > BIG_ENOUGH) {","      float ratio = BIG_ENOUGH / isBigEnough;","      alpha = ratio * alpha + (1.0 - ratio) * dist;","    }","    if (isBigEnough <= BIG_ENOUGH) {","      vec4 box = vec4 (uv - duv, uv + duv);","      alpha = (alpha + 0.5 * (","        contour(texture(map, box.xy).a, width)","        + contour(texture(map, box.zw).a, width)","        + contour(texture(map, box.xw).a, width)","        + contour(texture(map, box.zy).a, width)","      )) / 3.0;","    }","    if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  #else","    vec4 texColor = texture(map, vUV);","    float value = texColor.a;","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","    float alpha = aastep(value, afwidth);","    float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","    if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","    alpha = alpha * ratio + (1.0 - ratio) * value;","    if (ratio < 1.0 && alpha <= DISCARD_ALPHA) { discard; return; }","  #endif","  fragColor = vec4(color, opacity * alpha);","}"].join(`
`),S=H?b:M;Z.exports.Shader=B("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:L,fragmentShader:S})},"./src/shaders/shadow.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=E("./src/lib/three.js");Z.exports.Shader=B("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(C){this.rendererSystem=this.el.sceneEl.systems.renderer,this.material=new H.ShadowMaterial},update:function(C){this.material.opacity=C.opacity,this.material.alphaToCoverage=C.alphaToCoverage,this.material.transparent=C.transparent}})},"./src/shaders/standard.js":(Z,te,E)=>{var B=E("./src/core/shader.js").registerShader,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=new H.CubeTextureLoader,L={};Z.exports.Shader=B("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(b){this.rendererSystem=this.el.sceneEl.systems.renderer,this.materialData={color:new H.Color,emissive:new H.Color},M(b,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive),this.material=new H.MeshStandardMaterial(this.materialData)},update:function(b){this.updateMaterial(b),C.material.updateMap(this,b),b.normalMap&&C.material.updateDistortionMap("normal",this,b),b.displacementMap&&C.material.updateDistortionMap("displacement",this,b),b.ambientOcclusionMap&&C.material.updateDistortionMap("ambientOcclusion",this,b),b.metalnessMap&&C.material.updateDistortionMap("metalness",this,b),b.roughnessMap&&C.material.updateDistortionMap("roughness",this,b),this.updateEnvMap(b)},updateMaterial:function(b){var S,I=this.material;M(b,this.materialData),this.rendererSystem.applyColorCorrection(this.materialData.color),this.rendererSystem.applyColorCorrection(this.materialData.emissive);for(S in this.materialData)I[S]=this.materialData[S]},updateEnvMap:function(b){var S=this,I=this.material,O=b.envMap,_=b.sphericalEnvMap;if(!O&&!_||this.isLoadingEnvMap){I.envMap=null,I.needsUpdate=!0;return}if(this.isLoadingEnvMap=!0,_){this.el.sceneEl.systems.material.loadTexture(_,{src:_},function(V){S.isLoadingEnvMap=!1,V.mapping=H.EquirectangularReflectionMapping,I.envMap=V,C.material.handleTextureEvents(S.el,V),I.needsUpdate=!0});return}if(L[O]){L[O].then(function(D){S.isLoadingEnvMap=!1,I.envMap=D,C.material.handleTextureEvents(S.el,D),I.needsUpdate=!0});return}L[O]=new Promise(function(D){C.srcLoader.validateCubemapSrc(O,function(J){F.load(J,function(Y){S.isLoadingEnvMap=!1,I.envMap=Y,C.material.handleTextureEvents(S.el,Y),D(Y)})})})}});function M(b,S){return S.color.set(b.color),S.emissive.set(b.emissive),S.emissiveIntensity=b.emissiveIntensity,S.fog=b.fog,S.metalness=b.metalness,S.roughness=b.roughness,S.wireframe=b.wireframe,S.wireframeLinewidth=b.wireframeLinewidth,b.normalMap&&(S.normalScale=b.normalScale),b.ambientOcclusionMap&&(S.aoMapIntensity=b.ambientOcclusionMapIntensity),b.displacementMap&&(S.displacementScale=b.displacementScale,S.displacementBias=b.displacementBias),S}},"./src/systems/camera.js":(Z,te,E)=>{var B=E("./src/constants/index.js"),H=E("./src/core/system.js").registerSystem,C="data-aframe-default-camera";Z.exports.System=H("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var L,M,b=this.sceneEl,S=this;if(b.camera&&!b.camera.el.getAttribute("camera").spectator){b.emit("cameraready",{cameraEl:b.camera.el});return}if(L=b.querySelectorAll("a-camera, :not(a-mixin)[camera]"),!L.length){this.createDefaultCamera();return}for(this.numUserCameras=L.length,M=0;M<L.length;M++)L[M].addEventListener("object3dset",function(I){I.detail.type==="camera"&&S.checkUserCamera(this)}),L[M].isNode?L[M].load():L[M].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(L){var M,b=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(M=L.getAttribute("camera"),!M.active||M.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,b.camera=L.getObject3D("camera"),b.emit("cameraready",{cameraEl:L})}},createDefaultCamera:function(){var L,M=this.sceneEl;L=document.createElement("a-entity"),L.setAttribute("camera",{active:!0}),L.setAttribute("position",{x:0,y:B.DEFAULT_CAMERA_HEIGHT,z:0}),L.setAttribute("wasd-controls",""),L.setAttribute("look-controls",""),L.setAttribute(B.AFRAME_INJECTED,""),L.addEventListener("object3dset",function(b){b.detail.type==="camera"&&(M.camera=b.detail.object,M.emit("cameraready",{cameraEl:L}))}),M.appendChild(L)},disableActiveCamera:function(){var L,M;L=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"),M=L[L.length-1],M.setAttribute("camera","active",!0)},setActiveCamera:function(L){var M,b,S,I,O=this.activeCameraEl,_=this.sceneEl;if(I=L.getObject3D("camera"),!(!I||L===this.activeCameraEl)){var D=_.querySelector("["+C+"]"),V=D&&D.querySelector(":not(a-mixin)[camera]");for(L!==V&&F(_),this.activeCameraEl=L,this.activeCameraEl.play(),_.camera=I,O&&O.setAttribute("camera","active",!1),b=_.querySelectorAll(":not(a-mixin)[camera]"),S=0;S<b.length;S++)M=b[S],!(!M.isEntity||L===M)&&(M.setAttribute("camera","active",!1),M.pause());_.emit("camera-set-active",{cameraEl:L})}},setSpectatorCamera:function(L){var M,b=this.spectatorCameraEl,S=this.sceneEl,I;M=L.getObject3D("camera"),!(!M||L===this.spectatorCameraEl)&&(b&&b.setAttribute("camera","spectator",!1),I=this.spectatorCameraEl=L,S.addEventListener("enter-vr",this.wrapRender),S.addEventListener("exit-vr",this.unwrapRender),I.setAttribute("camera","active",!1),I.play(),S.emit("camera-set-spectator",{cameraEl:L}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){!this.spectatorCameraEl||this.originalRender||(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(L,M){var b,S=this.sceneEl,I;b=S.renderer.xr.enabled,this.originalRender.call(S.renderer,L,M),!(!this.spectatorCameraEl||S.isMobile||!b)&&(I=this.spectatorCameraEl.components.camera.camera,S.renderer.xr.enabled=!1,this.originalRender.call(S.renderer,L,I),S.renderer.xr.enabled=b)}});function F(L){var M,b=L.camera;b&&(M=L.querySelector("["+C+"]"),M&&L.removeChild(M))}},"./src/systems/geometry.js":(Z,te,E)=>{var B=E("./src/core/geometry.js").geometries,H=E("./src/core/system.js").registerSystem;Z.exports.System=H("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(M){var b=this.cache,S,I;return M.skipCache?C(M):(I=this.hash(M),S=b[I],L(this.cacheCount,I),S||(S=C(M),b[I]=S,S))},unuseGeometry:function(M){var b=this.cache,S=this.cacheCount,I,O;M.skipCache||(O=this.hash(M),b[O]&&(F(S,O),!(S[O]>0)&&(I=b[O],I.dispose(),delete b[O],delete S[O])))},hash:function(M){return JSON.stringify(M)}});function C(M){var b=M.primitive,S=B[b]&&B[b].Geometry,I=new S;if(!S)throw new Error("Unknown geometry `"+b+"`");return I.init(M),I.geometry}function F(M,b){M[b]--}function L(M,b){M[b]=M[b]===void 0?1:M[b]+1}},"./src/systems/gltf-model.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/lib/three.js");function C(F){return new Promise(function(L,M){var b=document.createElement("script");document.body.appendChild(b),b.onload=L,b.onerror=M,b.async=!0,b.src=F})}Z.exports.System=B("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var F=this.data.dracoDecoderPath,L=this.data.basisTranscoderPath,M=this.data.meshoptDecoderPath;!this.dracoLoader&&F&&(this.dracoLoader=new H.DRACOLoader,this.dracoLoader.setDecoderPath(F)),!this.ktx2Loader&&L&&(this.ktx2Loader=new H.KTX2Loader,this.ktx2Loader.setTranscoderPath(L).detectSupport(this.el.renderer)),!this.meshoptDecoder&&M&&(this.meshoptDecoder=C(M).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},"./src/systems/index.js":(Z,te,E)=>{E("./src/systems/camera.js"),E("./src/systems/geometry.js"),E("./src/systems/gltf-model.js"),E("./src/systems/light.js"),E("./src/systems/material.js"),E("./src/systems/renderer.js"),E("./src/systems/shadow.js"),E("./src/systems/tracked-controls-webvr.js"),E("./src/systems/tracked-controls-webxr.js"),E("./src/systems/webxr.js")},"./src/systems/light.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/utils/bind.js"),C=E("./src/constants/index.js"),F="data-aframe-default-light";Z.exports.System=B("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",H(this.setupDefaultLights,this))},registerLight:function(L){L.hasAttribute(F)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var L,M=this.sceneEl;if(this.defaultLights){L=document.querySelectorAll("["+F+"]");for(var b=0;b<L.length;b++)M.removeChild(L[b]);this.defaultLights=!1}},setupDefaultLights:function(){var L=this.sceneEl,M,b;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||(M=document.createElement("a-entity"),M.setAttribute("light",{color:"#BBB",type:"ambient"}),M.setAttribute(F,""),M.setAttribute(C.AFRAME_INJECTED,""),L.appendChild(M),b=document.createElement("a-entity"),b.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),b.setAttribute("position",{x:-.5,y:1,z:1}),b.setAttribute(F,""),b.setAttribute(C.AFRAME_INJECTED,""),L.appendChild(b),this.defaultLights=!0)}})},"./src/systems/material.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/lib/three.js"),C=E("./src/utils/index.js"),F=E("./src/utils/material.js").isHLS,L=E("./src/utils/material.js").setTextureProperties,M=C.bind,b=C.debug,S=b("components:texture:error"),I=new H.TextureLoader,O=b("components:texture:warn");I.setCrossOrigin("anonymous"),Z.exports.System=B("material",{init:function(){this.materials={},this.textureCounts={},this.textureCache={},this.sceneEl.addEventListener("materialtextureloaded",M(this.onMaterialTextureLoaded,this))},clearTextureCache:function(){this.textureCache={}},loadTexture:function(Y,W,U){var q=this;if(Y.tagName==="CANVAS"){this.loadCanvas(Y,W,U);return}if(Y.tagName==="VIDEO"){!Y.src&&!Y.srcObject&&!Y.childElementCount&&O("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes."),this.loadVideo(Y,W,U);return}C.srcLoader.validateSrc(Y,oe,ve);function oe(Ae){q.loadImage(Ae,W,U)}function ve(Ae){q.loadVideo(Ae,W,U)}},loadImage:function(Y,W,U){var q=this.hash(W),oe=this.textureCache;if(oe[q]){oe[q].then(U);return}oe[q]=D(Y,W),oe[q].then(U)},loadCanvas:function(Y,W,U){var q;q=new H.CanvasTexture(Y),L(q,W),U(q)},loadVideo:function(Y,W,U){var q,oe,ve=this.textureCache,Ae,Se;function Ie(de){de.texture.needsUpdate=!0,U(de.texture,de.videoEl)}if(typeof Y!="string"){if(Ae=Y,q=this.hashVideo(W,Ae),ve[q]){ve[q].then(Ie);return}J(Ae)}if(Ae=Ae||V(Y,W.width,W.height),q=this.hashVideo(W,Ae),ve[q]){ve[q].then(Ie);return}oe=new H.VideoTexture(Ae),oe.minFilter=H.LinearFilter,L(oe,W),this.sceneEl.isIOS&&F(Ae.src||Ae.getAttribute("src"),Ae.type||Ae.getAttribute("type"))&&(oe.format=H.RGBAFormat,oe.needsCorrectionBGRA=!0,oe.flipY=!1,oe.needsCorrectionFlipY=!0),Se={texture:oe,videoEl:Ae},ve[q]=Promise.resolve(Se),Ie(Se)},hash:function(Y){return Y.src.tagName&&(Y=C.extendDeep({},Y),Y.src=Y.src.src),JSON.stringify(Y)},hashVideo:function(Y,W){return _(Y,W)},registerMaterial:function(Y){this.materials[Y.uuid]=Y},unregisterMaterial:function(Y){delete this.materials[Y.uuid];var W=this.textureCounts;Object.keys(Y).filter(function(U){return Y[U]&&Y[U].isTexture}).forEach(function(U){W[Y[U].uuid]--,W[Y[U].uuid]<=0&&Y[U].dispose()})},updateMaterials:function(Y){var W=this.materials;Object.keys(W).forEach(function(U){W[U].needsUpdate=!0})},onMaterialTextureLoaded:function(Y){this.textureCounts[Y.detail.texture.uuid]||(this.textureCounts[Y.detail.texture.uuid]=0),this.textureCounts[Y.detail.texture.uuid]++}});function _(Y,W){var U,q=W.getAttribute("id"),oe,ve;if(q)return q;for(oe="",ve=Y||{},U=0;U<W.attributes.length;U++)ve[W.attributes[U].name]=W.attributes[U].value;return Object.keys(ve).sort().forEach(function(Ae){oe+=Ae+":"+ve[Ae]+";"}),oe}function D(Y,W){return new Promise(U);function U(q,oe){var ve=typeof Y!="string";function Ae(Se){L(Se,W),Se.needsUpdate=!0,q(Se)}if(ve){Ae(new H.Texture(Y));return}I.load(Y,Ae,function(){},function(Se){S("`$s` could not be fetched (Error code: %s; Response: %s)",Se.status,Se.statusText)})}}function V(Y,W,U){var q=document.createElement("video");return q.width=W,q.height=U,q.setAttribute("playsinline",""),q.setAttribute("webkit-playsinline",""),q.autoplay=!0,q.loop=!0,q.crossOrigin="anonymous",q.addEventListener("error",function(){O("`$s` is not a valid video",Y)},!0),q.src=Y,q}function J(Y){return Y.autoplay=Y.hasAttribute("autoplay")&&Y.getAttribute("autoplay")!=="false",Y.controls=Y.hasAttribute("controls")&&Y.getAttribute("controls")!=="false",Y.getAttribute("loop")==="false"&&Y.removeAttribute("loop"),Y.getAttribute("preload")==="false"&&(Y.preload="none"),Y.crossOrigin=Y.crossOrigin||"anonymous",Y.setAttribute("playsinline",""),Y.setAttribute("webkit-playsinline",""),Y}},"./src/systems/renderer.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/utils/index.js"),C=E("./src/lib/three.js"),F=H.debug,L=F("components:renderer:warn");Z.exports.System=B("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:H.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:1920},maxCanvasHeight:{default:1920},physicallyCorrectLights:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon"]},precision:{default:"high",oneOf:["high","medium","low"]},sortObjects:{default:!1},colorManagement:{default:!1},gammaOutput:{default:!1},alpha:{default:!0},foveationLevel:{default:1}},init:function(){var M=this.data,b=this.el,S=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),I=b.renderer;I.sortObjects=M.sortObjects,I.physicallyCorrectLights=M.physicallyCorrectLights,I.toneMapping=C[S+"ToneMapping"],(M.colorManagement||M.gammaOutput)&&(I.outputEncoding=C.sRGBEncoding,M.gammaOutput&&L('Property `gammaOutput` is deprecated. Use `renderer="colorManagement: true;"` instead.')),b.hasAttribute("antialias")&&L('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),b.hasAttribute("logarithmicDepthBuffer")&&L('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.')},update:function(){var M=this.data,b=this.el,S=b.renderer,I=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);S.toneMapping=C[I+"ToneMapping"],S.toneMappingExposure=M.exposure,S.xr.setFoveation(M.foveationLevel)},applyColorCorrection:function(M){!this.data.colorManagement||!M||(M.isColor?M.convertSRGBToLinear():M.isTexture&&(M.encoding=C.sRGBEncoding))}})},"./src/systems/shadow.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/lib/three.js"),C={basic:H.BasicShadowMap,pcf:H.PCFShadowMap,pcfsoft:H.PCFSoftShadowMap};Z.exports.System=B("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var F=this.sceneEl,L=this.data;this.shadowMapEnabled=!1,F.renderer&&(F.renderer.shadowMap.type=C[L.type],F.renderer.shadowMap.autoUpdate=L.autoUpdate,this.setShadowMapEnabled(this.shadowMapEnabled))},update:function(F){F.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.data.enabled)},setShadowMapEnabled:function(F){var L=this.sceneEl.renderer;this.shadowMapEnabled=this.data.enabled&&F,L&&(L.shadowMap.enabled=this.shadowMapEnabled)}})},"./src/systems/tracked-controls-webvr.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/utils/index.js"),C=H.device.isWebXRAvailable;Z.exports.System=B("tracked-controls-webvr",{init:function(){var F=this;this.controllers=[],this.isChrome=navigator.userAgent.indexOf("Chrome")!==-1,this.updateControllerList(),this.throttledUpdateControllerList=H.throttle(this.updateControllerList,500,this),!C&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(L){L.length&&(F.vrDisplay=L[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var F=this.controllers,L,M,b,S;if(M=navigator.getGamepads&&navigator.getGamepads(),!!M){for(S=F.length,F.length=0,b=0;b<M.length;++b)L=M[b],L&&L.pose&&F.push(L);F.length!==S&&this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/tracked-controls-webxr.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/utils/index.js");Z.exports.System=B("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=H.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var C=this,F=this.el.xrSession;if(!F){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var L=C.el.sceneEl.systems.webxr.sessionReferenceSpaceType;F.requestReferenceSpace(L).then(function(M){C.referenceSpace=M}).catch(function(M){throw C.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(L,'tracked-controls-webxr uses reference space "'+L+'".'),M})},updateControllerList:function(){var C=this.el.xrSession,F=this.oldControllers,L;if(!C){if(this.oldControllersLength===0)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(C.inputSources){if(this.controllers=C.inputSources,this.oldControllersLength===this.controllers.length){var M=!0;for(L=0;L<this.controllers.length;++L)if(!(this.controllers[L]===F[L]&&this.controllers[L].gamepad===F[L].gamepad)){M=!1;break}if(M)return}for(F.length=0,L=0;L<this.controllers.length;L++)F.push(this.controllers[L]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/webxr.js":(Z,te,E)=>{var B=E("./src/core/system.js").registerSystem,H=E("./src/utils/index.js"),C=H.debug("systems:webxr:warn");Z.exports.System=B("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var F=this.data;this.sessionConfiguration={requiredFeatures:F.requiredFeatures,optionalFeatures:F.optionalFeatures},this.sessionReferenceSpaceType=F.referenceSpaceType,F.overlayElement&&(F.overlayElement.classList.remove("a-dom-overlay"),F.optionalFeatures.includes("dom-overlay")||(F.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",F)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:F.overlayElement},F.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(F){return!!(F==="viewer"||F==="local"||this.sessionConfiguration.requiredFeatures.includes(F)||this.sessionConfiguration.optionalFeatures.includes(F))},warnIfFeatureNotRequested:function(F,L){if(!this.wasFeatureRequested(F)){var M='Please add the feature "'+F+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`;C((L?L+" ":"")+M)}}})},"./src/utils/bind.js":Z=>{Z.exports=function(E,B){return function(H){return function(){var F=H.concat(Array.prototype.slice.call(arguments,0));return E.apply(B,F)}}(Array.prototype.slice.call(arguments,2))}},"./src/utils/coordinates.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=E("./node_modules/object-assign/index.js"),C=B("utils:coordinates:warn"),F=["x","y","z","w"],L=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;Z.exports.regex=L;var M="object",b=/\s+/g;function S(D,V){var J,Y,W,U,q,oe,ve,Ae,Se;if(D&&D instanceof Object)return oe=D.x===void 0?V&&V.x:D.x,ve=D.y===void 0?V&&V.y:D.y,Ae=D.z===void 0?V&&V.z:D.z,Se=D.w===void 0?V&&V.w:D.w,oe!=null&&(D.x=_(oe)),ve!=null&&(D.y=_(ve)),Ae!=null&&(D.z=_(Ae)),Se!=null&&(D.w=_(Se)),D;if(D==null)return typeof V===M?H({},V):V;for(J=D.trim().split(b),q={},U=0;U<F.length;U++)if(W=F[U],J[U])q[W]=parseFloat(J[U],10);else{if(Y=V&&V[W],Y===void 0)continue;q[W]=_(Y)}return q}Z.exports.parse=S;function I(D){var V;return typeof D!==M?D:(V=D.x+" "+D.y,D.z!=null&&(V+=" "+D.z),D.w!=null&&(V+=" "+D.w),V)}Z.exports.stringify=I;function O(D){return L.test(D)}Z.exports.isCoordinates=O,Z.exports.isCoordinate=function(D){return C("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),O(D)};function _(D){return D!=null&&D.constructor===String?parseFloat(D,10):D}Z.exports.toVector3=function(D){return new THREE.Vector3(D.x,D.y,D.z)}},"./src/utils/debug.js":(Z,te,E)=>{var B=E("./node_modules/process/browser.js"),H=E("./node_modules/debug/browser.js"),C=E("./node_modules/object-assign/index.js"),F={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},L=function(O){var _=H(O);return _.color=b(O),_};C(L,H);function M(O){var _=O.split(":");return _[_.length-1]}function b(O){var _=M(O),D=F.colors&&F.colors[_];return D||null}function S(){try{return window.localStorage}catch{}}var I=S();I&&(parseInt(I.logs,10)||I.logs==="true")?L.enable("*"):L.enable("*:error,*:info,*:warn"),B.browser&&(window.logs=L),Z.exports=L},"./src/utils/device.js":(Z,te,E)=>{var B=E("./node_modules/process/browser.js"),H=E("./node_modules/debug/browser.js")("device:error"),C,F=!1,L=!1,M=Z.exports.isWebXRAvailable=!window.debug&&navigator.xr!==void 0;if(window.addEventListener("vrdisplayactivate",function(Ae){var Se;M||(Se=document.createElement("canvas"),C=Ae.display,Se.getContext("webgl",{}),C.requestPresent([{source:Se}]).then(function(){},function(){}))}),M){var b=function(){var Ae=document.querySelector("a-scene");if(!Ae){window.addEventListener("DOMContentLoaded",b);return}Ae.hasLoaded?Ae.components["vr-mode-ui"].updateEnterInterfaces():Ae.addEventListener("loaded",b)},S=function(Ae){H("WebXR session support error: "+Ae.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(Ae){F=Ae,b()}).catch(S),navigator.xr.isSessionSupported("immersive-ar").then(function(Ae){L=Ae,b()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){F=!0,b()}).catch(S),navigator.xr.supportsSession("immersive-ar").then(function(){L=!0,b()}).catch(function(){})):H("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(Ae){var Se=document.querySelector("a-scene");C=Ae.length&&Ae[0],Se&&Se.emit("displayconnected",{vrDisplay:C})});function I(){return C}Z.exports.getVRDisplay=I;function O(){return F||L||!!I()}Z.exports.checkHeadsetConnected=O;function _(){return L}Z.exports.checkARSupport=_;function D(){return F}Z.exports.checkVRSupport=D;var V=function(){var Ae=!1;return function(Se){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(Se)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Se.substr(0,4)))&&(Ae=!0),(Y()||J()||ve())&&(Ae=!0),oe()&&(Ae=!1)}(window.navigator.userAgent||window.navigator.vendor||window.opera),function(){return Ae}}();Z.exports.isMobile=V;function J(Ae){var Se=Ae||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(Se)}Z.exports.isTablet=J;function Y(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}Z.exports.isIOS=Y;function W(){return!V()&&!oe()&&window.orientation!==void 0}Z.exports.isMobileDeviceRequestingDesktopSite=W;function U(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}Z.exports.isOculusBrowser=U;function q(){return/(Mobile VR)/i.test(window.navigator.userAgent)}Z.exports.isFirefoxReality=q;function oe(){return U()||q()}Z.exports.isMobileVR=oe;function ve(){return/R7 Build/.test(window.navigator.userAgent)}Z.exports.isR7=ve,Z.exports.isLandscape=function(){var Ae=window.orientation;return ve()&&(Ae+=90),Ae===90||Ae===-90},Z.exports.isBrowserEnvironment=!!(!B||B.browser),Z.exports.isNodeEnvironment=!Z.exports.isBrowserEnvironment},"./src/utils/entity.js":Z=>{var te={};function E(B,H){return H=H||".",te[H]||(te[H]={}),B.indexOf(H)!==-1?te[H][B]=B.split(H):te[H][B]=B,te[H][B]}Z.exports.getComponentPropertyPath=E,Z.exports.propertyPathCache=te,Z.exports.getComponentProperty=function(B,H,C){var F;return C=C||".",H.indexOf(C)!==-1?(F=E(H,C),F.constructor===String?B.getAttribute(F):B.getAttribute(F[0])[F[1]]):B.getAttribute(H)},Z.exports.setComponentProperty=function(B,H,C,F){var L;if(F=F||".",H.indexOf(F)!==-1){L=E(H,F),L.constructor===String?B.setAttribute(L,C):B.setAttribute(L[0],L[1],C);return}B.setAttribute(H,C)}},"./src/utils/forceCanvasResizeSafariMobile.js":Z=>{Z.exports=function(E){var B=E.style.width,H=E.style.height;E.style.width=parseInt(B,10)+1+"px",E.style.height=parseInt(H,10)+1+"px",setTimeout(function(){E.style.width=B,E.style.height=H},200)}},"./src/utils/index.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=E("./node_modules/deep-assign/index.js"),C=E("./src/utils/device.js"),F=E("./node_modules/object-assign/index.js"),L=E("./src/utils/object-pool.js"),M=B("utils:warn");Z.exports.bind=E("./src/utils/bind.js"),Z.exports.coordinates=E("./src/utils/coordinates.js"),Z.exports.debug=B,Z.exports.device=C,Z.exports.entity=E("./src/utils/entity.js"),Z.exports.forceCanvasResizeSafariMobile=E("./src/utils/forceCanvasResizeSafariMobile.js"),Z.exports.isIE11=E("./src/utils/is-ie11.js"),Z.exports.material=E("./src/utils/material.js"),Z.exports.objectPool=L,Z.exports.split=E("./src/utils/split.js").split,Z.exports.styleParser=E("./src/utils/styleParser.js"),Z.exports.trackedControls=E("./src/utils/tracked-controls.js"),Z.exports.checkHeadsetConnected=function(){return M("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),C.checkHeadsetConnected(arguments)},Z.exports.isGearVR=Z.exports.device.isGearVR=function(){M("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},Z.exports.isIOS=function(){return M("`utils.isIOS` has moved to `utils.device.isIOS`"),C.isIOS(arguments)},Z.exports.isOculusGo=Z.exports.device.isOculusGo=function(){M("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},Z.exports.isMobile=function(){return M("`utils.isMobile has moved to `utils.device.isMobile`"),C.isMobile(arguments)},Z.exports.throttle=function(S,I,O){var _;return O&&(S=Z.exports.bind(S,O)),function(){var D=Date.now(),V=typeof _>"u"?I:D-_;(typeof _>"u"||V>=I)&&(_=D,S.apply(null,arguments))}},Z.exports.throttleLeadingAndTrailing=function(S,I,O){var _,D;return O&&(S=Z.exports.bind(S,O)),function(){var V=Date.now(),J=typeof _>"u"?I:V-_,Y=arguments;typeof _>"u"||J>=I?(clearTimeout(D),_=V,S.apply(null,Y)):(clearTimeout(D),D=setTimeout(function(){_=Date.now(),S.apply(this,Y)},I-J))}},Z.exports.throttleTick=function(S,I,O){var _;return O&&(S=Z.exports.bind(S,O)),function(D,V){var J=typeof _>"u"?V:D-_;(typeof _>"u"||J>=I)&&(_=D,S(D,J))}},Z.exports.debounce=function(S,I,O){var _;return function(){var D=this,V=arguments,J=function(){_=null,O||S.apply(D,V)},Y=O&&!_;clearTimeout(_),_=setTimeout(J,I),Y&&S.apply(D,V)}},Z.exports.extend=F,Z.exports.extendDeep=H,Z.exports.clone=function(S){return JSON.parse(JSON.stringify(S))};var b=function(){var S=L.createPool(function(){return[]});return function(I,O){var _,D,V,J,Y,W;if(I===void 0||O===void 0||I===null||O===null||!(I&&O&&I.constructor===Object&&O.constructor===Object||I.constructor===Array&&O.constructor===Array))return I===O;D=S.use(),V=S.use(),D.length=0,V.length=0;for(_ in I)D.push(_);for(_ in O)V.push(_);if(D.length!==V.length)return S.recycle(D),S.recycle(V),!1;for(J=0;J<D.length;++J)if(Y=I[D[J]],W=O[D[J]],typeof Y=="object"||typeof W=="object"||Array.isArray(Y)&&Array.isArray(W)){if(Y===W)continue;if(!b(Y,W))return S.recycle(D),S.recycle(V),!1}else if(Y!==W)return S.recycle(D),S.recycle(V),!1;return S.recycle(D),S.recycle(V),!0}}();Z.exports.deepEqual=b,Z.exports.diff=function(){var S=[];return function(I,O,_){var D,V,J,Y,W,U,q;Y=_||{},S.length=0;for(W in I)S.push(W);if(!O)return Y;for(J in O)S.indexOf(J)===-1&&S.push(J);for(U=0;U<S.length;U++)W=S[U],D=I[W],V=O[W],q=D&&V&&D.constructor===Object&&V.constructor===Object,(q&&!b(D,V)||!q&&D!==V)&&(Y[W]=V);return Y}}(),Z.exports.shouldCaptureKeyEvent=function(S){return S.metaKey?!1:document.activeElement===document.body},Z.exports.splitString=function(S,I){typeof I>"u"&&(I=" ");var O=new RegExp(I,"g");return S=(S||"").replace(O,I),S.split(I)},Z.exports.getElData=function(S,I){I=I||{};var O={};Object.keys(I).forEach(_);function _(D){S.hasAttribute(D)&&(O[D]=S.getAttribute(D))}return O},Z.exports.getUrlParameter=function(S){S=S.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var I=new RegExp("[\\?&]"+S+"=([^&#]*)"),O=I.exec(location.search);return O===null?"":decodeURIComponent(O[1].replace(/\+/g," "))},Z.exports.isIframed=function(){return window.top!==window.self},Z.exports.findAllScenes=function(S){for(var I=[],O=S.getElementsByTagName("*"),_=0,D=O.length;_<D;_++)O[_].isScene&&I.push(O[_]);return I},Z.exports.srcLoader=E("./src/utils/src-loader.js")},"./src/utils/ios-orientationchange-blank-bug.js":()=>{window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},"./src/utils/is-ie11.js":Z=>{function te(){var E=-1,B=navigator.userAgent,H;return navigator.appName==="Microsoft Internet Explorer"?(H=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),H.exec(B)!=null&&(E=parseFloat(RegExp.$1))):navigator.appName==="Netscape"&&(H=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"),H.exec(B)!=null&&(E=parseFloat(RegExp.$1))),E}Z.exports=te()===11},"./src/utils/isIOSOlderThan10.js":Z=>{Z.exports=function(E){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(E)}},"./src/utils/material.js":(Z,te,E)=>{var B=E("./src/lib/three.js"),H=["application/x-mpegurl","application/vnd.apple.mpegurl"],C=new Set(["emissiveMap","envMap","map","specularMap"]);function F(M,b){var S=b.offset||{x:0,y:0},I=b.repeat||{x:1,y:1},O=b.npot||!1;O&&(M.wrapS=B.ClampToEdgeWrapping,M.wrapT=B.ClampToEdgeWrapping,M.magFilter=B.LinearFilter,M.minFilter=B.LinearFilter),(I.x!==1||I.y!==1)&&(M.wrapS=B.RepeatWrapping,M.wrapT=B.RepeatWrapping,M.repeat.set(I.x,I.y)),(S.x!==0||S.y!==0)&&M.offset.set(S.x,S.y)}Z.exports.setTextureProperties=F,Z.exports.updateMapMaterialFromData=function(M,b,S,I){var O=S.el,_=S.material,D=O.sceneEl.systems.renderer,V=I[b];if(S.materialSrcs||(S.materialSrcs={}),!V){delete S.materialSrcs[M],Y(null);return}if(V===S.materialSrcs[M]&&_[M]){F(_[M],I);return}S.materialSrcs[M]=V,V instanceof B.Texture?Y(V):O.sceneEl.systems.material.loadTexture(V,{src:V,repeat:I.repeat,offset:I.offset,npot:I.npot},J);function J(W){S.materialSrcs[M]===V&&Y(W)}function Y(W){_[M]=W,W&&C.has(M)&&D.applyColorCorrection(W),_.needsUpdate=!0,L(O,W)}},Z.exports.updateMap=function(M,b){return Z.exports.updateMapMaterialFromData("map","src",M,b)},Z.exports.updateDistortionMap=function(M,b,S){var I=M;M==="ambientOcclusion"&&(I="ao");var O=b.el,_=b.material,D=O.sceneEl.systems.renderer,V=S[M+"Map"],J={};if(J.src=V,J.offset=S[M+"TextureOffset"],J.repeat=S[M+"TextureRepeat"],J.wrap=S[M+"TextureWrap"],V){if(V===b[M+"TextureSrc"])return;b[M+"TextureSrc"]=V,O.sceneEl.systems.material.loadTexture(V,J,Y);return}if(!_.map)return;Y(null);function Y(W){var U=I+"Map";_[U]=W,W&&C.has(U)&&D.applyColorCorrection(W),W&&F(W,S),_.needsUpdate=!0,L(O,W)}};function L(M,b){b&&(M.emit("materialtextureloaded",{src:b.image,texture:b}),!(!b.image||b.image.tagName!=="VIDEO")&&(b.image.addEventListener("loadeddata",function(){!M.components||!M.components.material||(b.needsCorrectionBGRA&&b.needsCorrectionFlipY&&["standard","flat"].indexOf(M.components.material.data.shader)!==-1&&M.setAttribute("material","shader","ios10hls"),M.emit("materialvideoloadeddata",{src:b.image,texture:b}))}),b.image.addEventListener("ended",function(){M.emit("materialvideoended",{src:b.image,texture:b})})))}Z.exports.handleTextureEvents=L,Z.exports.isHLS=function(M,b){return!!(b&&H.includes(b.toLowerCase())||M&&M.toLowerCase().indexOf(".m3u8")>0)}},"./src/utils/math.js":Z=>{function te(B,H,C){var F=H.dot(B);return(F-H.dot(C))/H.length()}function E(B,H,C,F){var L=te(B,H,C);return F.copy(H),F.multiplyScalar(L),F.add(C),F}Z.exports.distanceOfPointFromPlane=te,Z.exports.nearestPointInPlane=E},"./src/utils/object-pool.js":Z=>{var te=Object.freeze(Object.create(null));function E(){return{}}Z.exports.createPool=function(F){var L=[],M=null;F=F||E;function b(){var _;return(M===null||M===L.length)&&I(L.length||5),_=L[M],L[M++]=te,B(_),_}function S(_){if(_ instanceof Object){if(M===null||M===-1){L[L.length]=_;return}L[--M]=_}}function I(_){var D,V;if(_=_===void 0?L.length:_,_>0&&M==null&&(M=0),_>0)for(D=L.length,L.length+=Number(_),V=D;V<L.length;V++)L[V]=F();return L.length}function O(){return L.length}return{grow:I,pool:L,recycle:S,size:O,use:b}};function B(C){var F;if(!(!C||C.constructor!==Object))for(F in C)C[F]=void 0}Z.exports.clearObject=B;function H(C,F){var L;if(!(!C||C.constructor!==Object))for(L in C)L in F||delete C[L]}Z.exports.removeUnusedKeys=H},"./src/utils/split.js":Z=>{Z.exports.split=function(){var te={};return function(E,B){return B in te||(te[B]={}),E in te[B]||(te[B][E]=E.split(B)),te[B][E]}}()},"./src/utils/src-loader.js":(Z,te,E)=>{var B=E("./src/utils/debug.js"),H=B("utils:src-loader:warn");function C(I,O,_){M(I,function(V){if(V){O(I);return}_(I)})}function F(I,O){var _,D="",V,J,Y=[];for(V=0;V<5;V++)D+="(url\\((?:[^\\)]+)\\),\\s*)";D+="(url\\((?:[^\\)]+)\\)\\s*)",J=I.match(new RegExp(D));function W(U){Y.push(U),Y.length===6&&O(Y)}if(J){for(V=1;V<7;V++)C(L(J[V]),W);return}if(_=S(I),!!_){if(_.tagName==="A-CUBEMAP"&&_.srcs)return O(_.srcs);H('Selector "%s" does not point to <a-cubemap>',I)}}function L(I){var O=I.match(/\url\((.+)\)/);if(O)return O[1]}function M(I,O){var _;if(I.tagName){O(I.tagName==="IMG");return}_=new XMLHttpRequest,_.open("HEAD",I),_.addEventListener("load",function(D){var V;_.status>=200&&_.status<300?(V=_.getResponseHeader("Content-Type"),V==null?b(I,O):V.startsWith("image")?O(!0):O(!1)):b(I,O),_.abort()}),_.send()}function b(I,O){var _=new Image;_.addEventListener("load",D);function D(){O(!0)}_.addEventListener("error",V);function V(){O(!1)}_.src=I}function S(I){try{var O=document.querySelector(I);return O||H('No element was found matching the selector: "%s"',I),O}catch{H('"%s" is not a valid selector',I);return}}Z.exports={parseUrl:L,validateSrc:C,validateCubemapSrc:F}},"./src/utils/styleParser.js":Z=>{var te=/-([a-z])/g;Z.exports.parse=function(M,b){var S;return typeof M!="string"||(S=C(M,b),S[""])?M:B(S)},Z.exports.stringify=function(M){return typeof M=="string"?M:F(M)};function E(M){return M.replace(te,L)}Z.exports.toCamelCase=E;function B(M){var b,S;for(S in M)b=E(S),S!==b&&(M[b]=M[S],delete M[S]);return M}Z.exports.transformKeysToCamelCase=B;var H=function(){var M=[],b=/url\([^)]+$/;return function(I){var O="",_,D=0,V=";";for(M.length=0;D<I.length;){if(_=I.indexOf(V,D),_===-1&&(_=I.length),O+=I.substring(D,_),b.test(O)){O+=";",D=_+1;continue}M.push(O.trim()),O="",D=_+1}return M}}();function C(M,b){var S,I,O,_,D,V;for(b=b||{},S=H(M),I=0;I<S.length;I++)O=S[I],O&&(_=O.indexOf(":"),D=O.substr(0,_).trim(),V=O.substr(_+1).trim(),b[D]=V);return b}function F(M){var b,S=0,I=0,O="";for(b in M)S++;for(b in M)O+=b+": "+M[b],I<S-1&&(O+="; "),I++;return O}function L(M){return M[1].toUpperCase()}},"./src/utils/tracked-controls.js":(Z,te,E)=>{var B=E("./src/constants/index.js").DEFAULT_HANDEDNESS,H=["x","y","z","w"],C=2;Z.exports.checkControllerPresentAndSetup=function(S,I,O){var _=S.el,D,V=_.sceneEl.hasWebXR,J=V?L:F,Y;if(D=J(S,I,O),Y=!!D,S.controllerPresent&&!S.controllerEventsActive&&!V&&S.addEventListeners(),Y===S.controllerPresent)return Y;S.controllerPresent=Y,Y?(S.addEventListeners(),S.injectTrackedControls(D),_.emit("controllerconnected",{name:S.name,component:S})):(S.removeEventListeners(),_.emit("controllerdisconnected",{name:S.name,component:S}))};function F(S,I,O){var _,D=S.el.sceneEl,V,J=O.index||0;return!I||(V=D&&D.systems["tracked-controls-webvr"],!V)||(_=V.controllers,!_.length)?!1:!!M(_,null,I,O.hand,J)}function L(S,I,O){var _,D=S.el.sceneEl,V=D&&D.systems["tracked-controls-webxr"];return!V||(_=V.controllers,!_||!_.length)?!1:b(_,I,O.hand,O.index,O.iterateControllerProfiles,O.handTracking)}Z.exports.isControllerPresentWebVR=F,Z.exports.isControllerPresentWebXR=L;function M(S,I,O,_,D){var V,J,Y=0,W=D>=0?D:0;for(J=0;J<S.length;J++)if(V=S[J],!(O&&!V.id.startsWith(O))&&!(!O&&V.id!==I)&&!(_&&V.hand&&_!==V.hand)){if(_&&!V.hand)W=C*D+(_===B?0:1);else return V;if(Y===W)return V;++Y}}function b(S,I,O,_,D,V){var J,Y,W,U=!1,q,oe;for(J=0;J<S.length;J++){if(W=S[J],oe=W.profiles,V)U=W.hand;else if(D)for(Y=0;Y<oe.length&&(U=oe[Y].startsWith(I),!U);Y++);else U=oe.length>0&&oe[0].startsWith(I);if(U){if(q=W.handedness==="right"||W.handedness==="left",q){if(W.handedness===O)return S[J]}else if(J===_)return S[J]}}}Z.exports.findMatchingControllerWebVR=M,Z.exports.findMatchingControllerWebXR=b,Z.exports.emitIfAxesChanged=function(S,I,O){var _,D,V,J,Y;for(D in I){for(_=I[D],V=!1,Y=0;Y<_.length;Y++)O.detail.changed[_[Y]]&&(V=!0);if(V){for(J={},Y=0;Y<_.length;Y++)J[H[Y]]=O.detail.axis[_[Y]];S.el.emit(D+"moved",J)}}},Z.exports.onButtonEvent=function(S,I,O,_){var D=_?O.mapping[_]:O.mapping,V=D.buttons[S];O.el.emit(V+I),O.updateModel&&O.updateModel(V,I)}},"./vendor/DeviceOrientationControls.js":()=>{THREE.DeviceOrientationControls=function(Z){var te=this;this.object=Z,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var E=function(C){te.deviceOrientation=C},B=function(){te.screenOrientation=window.orientation||0},H=function(){var C=new THREE.Vector3(0,0,1),F=new THREE.Euler,L=new THREE.Quaternion,M=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(b,S,I,O,_){F.set(I,S,-O,"YXZ"),b.setFromEuler(F),b.multiply(M),b.multiply(L.setFromAxisAngle(C,-_))}}();this.connect=function(){B(),window.addEventListener("orientationchange",B,!1),window.addEventListener("deviceorientation",E,!1),te.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",B,!1),window.removeEventListener("deviceorientation",E,!1),te.enabled=!1},this.update=function(){if(te.enabled!==!1){var C=te.deviceOrientation;if(C){var F=C.alpha?THREE.MathUtils.degToRad(C.alpha)+te.alphaOffset:0,L=C.beta?THREE.MathUtils.degToRad(C.beta):0,M=C.gamma?THREE.MathUtils.degToRad(C.gamma):0,b=te.screenOrientation?THREE.MathUtils.degToRad(te.screenOrientation):0;H(te.object.quaternion,F,L,M,b)}}},this.dispose=function(){te.disconnect()},this.connect()}},"./vendor/rStats.extras.js":Z=>{window.glStats=function(){var te=null,E=0,B=0,H=0,C=0,F=0,L=0,M=0;function b(Y,W){return function(){W.apply(this,arguments),Y.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=b(WebGLRenderingContext.prototype.drawArrays,function(){E++,arguments[0]==this.POINTS?L+=arguments[2]:F+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=b(WebGLRenderingContext.prototype.drawElements,function(){B++,C+=arguments[1]/3,F+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=b(WebGLRenderingContext.prototype.useProgram,function(){H++}),WebGLRenderingContext.prototype.bindTexture=b(WebGLRenderingContext.prototype.bindTexture,function(){M++});var S={allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},I=[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],O=[{base:"allcalls",steps:["drawelements","drawarrays"]}];function _(){te("allcalls").set(E+B),te("drawElements").set(B),te("drawArrays").set(E),te("bindTexture").set(M),te("useProgram").set(H),te("glfaces").set(C),te("glvertices").set(F),te("glpoints").set(L)}function D(){E=0,B=0,H=0,C=0,F=0,L=0,M=0}function V(){}function J(Y){te=Y}return{update:_,start:D,end:V,attach:J,values:S,groups:I,fractions:O}},window.threeStats=function(te){var E=null,B={"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},H=[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],C=[];function F(){E("renderer.info.memory.geometries").set(te.info.memory.geometries),E("renderer.info.programs").set(te.info.programs.length),E("renderer.info.memory.textures").set(te.info.memory.textures),E("renderer.info.render.calls").set(te.info.render.calls),E("renderer.info.render.triangles").set(te.info.render.triangles),E("renderer.info.render.points").set(te.info.render.points)}function L(){}function M(){}function b(S){E=S}return{update:F,start:L,end:M,attach:b,values:B,groups:H,fractions:C}},window.BrowserStats=function(){var te=null,E=0,B=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var H={memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},C=[{caption:"Browser",values:["memory","total"]}],F=[{base:"total",steps:["memory"]}],L=Math.log(1024);function M(_){var D=100,V=Math.floor(Math.log(_)/L);return Math.round(_*D/Math.pow(1024,V))/D}function b(){E=M(performance.memory.usedJSHeapSize),B=M(performance.memory.totalJSHeapSize),te("memory").set(E),te("total").set(B)}function S(){E=0}function I(){}function O(_){te=_}return{update:b,start:S,end:I,attach:O,values:H,groups:C,fractions:F}},Z.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},"./vendor/rStats.js":Z=>{(function(){"performance"in window||(window.performance={});var te=window.performance;if(!("now"in te)){var E=Date.now();te.timing&&te.timing.navigationStart&&(E=te.timing.navigationStart),te.now=function(){return Date.now()-E}}te.mark||(te.mark=function(){}),te.measure||(te.measure=function(){})})(),window.rStats=function(E){function B(oe,ve){for(var Ae=Object.keys(oe),Se=0,Ie=Ae.length;Se<Ie;Se++)ve(Ae[Se])}function H(oe){var ve=document.createElement("link");ve.href=oe,ve.rel="stylesheet",ve.type="text/css",document.getElementsByTagName("head")[0].appendChild(ve)}var C=E||{},F=C.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],L="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",M=(C.CSSPath?C.CSSPath:"")+"rStats.css",b=C.css||[L,M];b.forEach(function(oe){H(oe)}),C.values||(C.values={});var S,I,O=10,_=200,D={};function V(oe,ve,Ae){var Se=Ae||{},Ie=document.createElement("canvas"),de=Ie.getContext("2d"),pe=0,we=0,he=Se.color?Se.color:"#666666",Pe=document.createElement("canvas"),Ve=Pe.getContext("2d");Pe.width=1,Pe.height=2*O,Ve.fillStyle="#444444",Ve.fillRect(0,0,1,2*O),Ve.fillStyle=he,Ve.fillRect(0,O,1,O),Ve.fillStyle="#ffffff",Ve.globalAlpha=.5,Ve.fillRect(0,O,1,1),Ve.globalAlpha=1;var ze=document.createElement("canvas"),et=ze.getContext("2d");ze.width=1,ze.height=2*O,et.fillStyle="#444444",et.fillRect(0,0,1,2*O),et.fillStyle="#b70000",et.fillRect(0,O,1,O),et.globalAlpha=.5,et.fillStyle="#ffffff",et.fillRect(0,O,1,1),et.globalAlpha=1;function Tt(){Ie.width=_,Ie.height=O,Ie.style.width=Ie.width+"px",Ie.style.height=Ie.height+"px",Ie.className="rs-canvas",oe.appendChild(Ie),de.fillStyle="#444444",de.fillRect(0,0,Ie.width,Ie.height)}function Rt(fn,cn){we+=(fn-we)*.1,pe*=.99,we>pe&&(pe=we),de.drawImage(Ie,1,0,Ie.width-1,Ie.height,0,0,Ie.width-1,Ie.height),cn?de.drawImage(ze,Ie.width-1,Ie.height-we*Ie.height/pe-O):de.drawImage(Pe,Ie.width-1,Ie.height-we*Ie.height/pe-O)}return Tt(),{draw:Rt}}function J(oe,ve){var Ae=document.createElement("canvas"),Se=Ae.getContext("2d");function Ie(){Ae.width=_,Ae.height=O*ve,Ae.style.width=Ae.width+"px",Ae.style.height=Ae.height+"px",Ae.className="rs-canvas",oe.appendChild(Ae),Se.fillStyle="#444444",Se.fillRect(0,0,Ae.width,Ae.height)}function de(pe){Se.drawImage(Ae,1,0,Ae.width-1,Ae.height,0,0,Ae.width-1,Ae.height);var we=0;B(pe,function(he){var Pe=pe[he]*Ae.height;Se.fillStyle=F[he],Se.fillRect(Ae.width-1,we,1,Pe),we+=Pe})}return Ie(),{draw:de}}function Y(oe,ve){var Ae=oe,Se,Ie=0,de=0,pe=0,we=0,he=performance.now(),Pe=0,Ve=document.createElement("div"),ze=document.createElement("span"),et=document.createElement("div"),Tt=document.createTextNode(""),Rt=C?C.values[Ae.toLowerCase()]:null,fn=new V(Ve,Ae,Rt),cn=!1;ze.className="rs-counter-id",ze.textContent=Rt&&Rt.caption?Rt.caption:Ae,et.className="rs-counter-value",et.appendChild(Tt),Ve.appendChild(ze),Ve.appendChild(et),ve?ve.div.appendChild(Ve):I.appendChild(Ve),Se=performance.now();function Jn(Ot){if(Rt&&Rt.average){we+=Ot,Pe++;var $t=performance.now();$t-he>=(Rt.avgMs||1e3)&&(pe=we/Pe,we=0,he=$t,Pe=0)}}function yn(){Se=performance.now(),C.userTimingAPI&&performance.mark(Ae+"-start"),cn=!0}function Wn(){Ie=performance.now()-Se,C.userTimingAPI&&(performance.mark(Ae+"-end"),cn&&performance.measure(Ae,Ae+"-start",Ae+"-end")),Jn(Ie)}function gi(){Wn(),yn()}function ai(){var Ot=Rt&&Rt.average?pe:Ie;Tt.nodeValue=Math.round(Ot*100)/100;var $t=Rt&&(Rt.below&&Ie<Rt.below||Rt.over&&Ie>Rt.over);fn.draw(Ie,$t),Ve.className=$t?"rs-counter-base alarm":"rs-counter-base"}function nt(){var Ot=performance.now(),$t=Ot-Se;de++,$t>1e3&&(Rt&&Rt.interpolate===!1?Ie=de:Ie=de*1e3/$t,de=0,Se=Ot,Jn(Ie))}function dt(Ot){Ie=Ot,Jn(Ie)}return{set:dt,start:yn,tick:gi,end:Wn,frame:nt,value:function(){return Ie},draw:ai}}function W(oe){var ve=oe.toLowerCase();if(ve===void 0&&(ve="default"),D[ve])return D[ve];var Ae=null;C&&C.groups&&B(C.groups,function(Ie){var de=C.groups[parseInt(Ie,10)];!Ae&&de.values.indexOf(ve.toLowerCase())!==-1&&(Ae=de)});var Se=new Y(ve,Ae);return D[ve]=Se,Se}function U(){if(C.plugins){C.values||(C.values={}),C.groups||(C.groups=[]),C.fractions||(C.fractions=[]);for(var oe=0;oe<C.plugins.length;oe++)C.plugins[oe].attach(W),B(C.plugins[oe].values,function(ve){C.values[ve]=C.plugins[oe].values[ve]}),C.groups=C.groups.concat(C.plugins[oe].groups),C.fractions=C.fractions.concat(C.plugins[oe].fractions)}else C.plugins={};S=document.createElement("div"),S.className="rs-base",I=document.createElement("div"),I.className="rs-container",I.style.height="auto",S.appendChild(I),document.body.appendChild(S),C&&(C.groups&&B(C.groups,function(ve){var Ae=C.groups[parseInt(ve,10)],Se=document.createElement("div");Se.className="rs-group",Ae.div=Se;var Ie=document.createElement("h1");Ie.textContent=Ae.caption,Ie.addEventListener("click",function(de){this.classList.toggle("hidden"),de.preventDefault()}.bind(Se)),I.appendChild(Ie),I.appendChild(Se)}),C.fractions&&B(C.fractions,function(ve){var Ae=C.fractions[parseInt(ve,10)],Se=document.createElement("div");Se.className="rs-fraction";var Ie=document.createElement("div");Ie.className="rs-legend";var de=0;B(C.fractions[ve].steps,function(we){var he=document.createElement("p");he.textContent=C.fractions[ve].steps[we],he.style.color=F[de],Ie.appendChild(he),de++}),Se.appendChild(Ie),Se.style.height=de*O+"px",Ae.div=Se;var pe=new J(Se,de);Ae.graph=pe,I.appendChild(Se)}))}function q(){B(C.plugins,function(oe){C.plugins[oe].update()}),B(D,function(oe){D[oe].draw()}),C&&C.fractions&&B(C.fractions,function(oe){var ve=C.fractions[parseInt(oe,10)],Ae=[],Se=D[ve.base.toLowerCase()];Se&&(Se=Se.value(),B(C.fractions[oe].steps,function(Ie){var de=C.fractions[oe].steps[parseInt(Ie,10)].toLowerCase(),pe=D[de];pe&&Ae.push(pe.value()/Se)})),ve.graph.draw(Ae)})}return U(),function(oe){return oe?W(oe):{element:S,update:q}}},Z.exports=window.rStats},"./vendor/starts-with-polyfill.js":()=>{String.prototype.startsWith||(String.prototype.startsWith=function(Z,te){return te=te||0,this.substr(te,Z.length)===Z})},"./vendor/wakelock/util.js":Z=>{var te={};te.base64=function(E,B){return"data:"+E+";base64,"+B},te.isMobile=function(){var E=!1;return function(B){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(B)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(B.substr(0,4)))&&(E=!0)}(navigator.userAgent||navigator.vendor||window.opera),E},te.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},te.isIFrame=function(){try{return window.self!==window.top}catch{return!0}},te.appendQueryParameter=function(E,B,H){var C=E.indexOf("?")<0?"?":"&";return E+=C+B+"="+H,E},te.getQueryParameter=function(E){E=E.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var B=new RegExp("[\\?&]"+E+"=([^&#]*)"),H=B.exec(location.search);return H===null?"":decodeURIComponent(H[1].replace(/\+/g," "))},te.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90},Z.exports=te},"./vendor/wakelock/wakelock.js":(Z,te,E)=>{var B=E("./vendor/wakelock/util.js");function H(){var L=document.createElement("video");L.addEventListener("ended",function(){L.play()}),this.request=function(){L.paused&&(L.src=B.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),L.play())},this.release=function(){L.pause(),L.src=""}}function C(){var L=null;this.request=function(){L||(L=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){L&&(clearInterval(L),L=null)}}function F(){var L=navigator.userAgent||navigator.vendor||window.opera;return L.match(/iPhone/i)||L.match(/iPod/i)?C:H}Z.exports=F()},"./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>q});var B=E("./node_modules/css-loader/dist/runtime/sourceMaps.js"),H=E.n(B),C=E("./node_modules/css-loader/dist/runtime/api.js"),F=E.n(C),L=E("./node_modules/css-loader/dist/runtime/getUrl.js"),M=E.n(L),b=new URL(E("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),E.b),S=new URL(E("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),E.b),I=new URL(E("data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"),E.b),O=new URL(E("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"),E.b),_=new URL(E("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"),E.b),D=F()(H()),V=M()(b),J=M()(S),Y=M()(I),W=M()(O),U=M()(_);D.push([Z.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar {
  right: 80px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(`+V+`) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(`+J+`) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(`+Y+`);
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  margin-right: 10px;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}


.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(`+W+`) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(`+U+`) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;EAClB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;;AAGA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar {
  right: 80px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  margin-right: 10px;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}


.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const q=D},"./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>M});var B=E("./node_modules/css-loader/dist/runtime/sourceMaps.js"),H=E.n(B),C=E("./node_modules/css-loader/dist/runtime/api.js"),F=E.n(C),L=F()(H());L.push([Z.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const M=L},"./src/style/aframe.css":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>Y});var B=E("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),H=E.n(B),C=E("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),F=E.n(C),L=E("./node_modules/style-loader/dist/runtime/insertBySelector.js"),M=E.n(L),b=E("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),S=E.n(b),I=E("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),O=E.n(I),_=E("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),D=E.n(_),V=E("./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css"),J={};J.styleTagTransform=D(),J.setAttributes=S(),J.insert=M().bind(null,"head"),J.domAPI=F(),J.insertStyleElement=O(),H()(V.default,J);const Y=V.default&&V.default.locals?V.default.locals:void 0},"./src/style/rStats.css":(Z,te,E)=>{E.r(te),E.d(te,{default:()=>Y});var B=E("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),H=E.n(B),C=E("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),F=E.n(C),L=E("./node_modules/style-loader/dist/runtime/insertBySelector.js"),M=E.n(L),b=E("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),S=E.n(b),I=E("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),O=E.n(I),_=E("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),D=E.n(_),V=E("./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css"),J={};J.styleTagTransform=D(),J.setAttributes=S(),J.insert=M().bind(null,"head"),J.domAPI=F(),J.insertStyleElement=O(),H()(V.default,J);const Y=V.default&&V.default.locals?V.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":Z=>{var te=[];function E(C){for(var F=-1,L=0;L<te.length;L++)if(te[L].identifier===C){F=L;break}return F}function B(C,F){for(var L={},M=[],b=0;b<C.length;b++){var S=C[b],I=F.base?S[0]+F.base:S[0],O=L[I]||0,_="".concat(I," ").concat(O);L[I]=O+1;var D=E(_),V={css:S[1],media:S[2],sourceMap:S[3],supports:S[4],layer:S[5]};if(D!==-1)te[D].references++,te[D].updater(V);else{var J=H(V,F);F.byIndex=b,te.splice(b,0,{identifier:_,updater:J,references:1})}M.push(_)}return M}function H(C,F){var L=F.domAPI(F);L.update(C);var M=function(S){if(S){if(S.css===C.css&&S.media===C.media&&S.sourceMap===C.sourceMap&&S.supports===C.supports&&S.layer===C.layer)return;L.update(C=S)}else L.remove()};return M}Z.exports=function(C,F){F=F||{},C=C||[];var L=B(C,F);return function(b){b=b||[];for(var S=0;S<L.length;S++){var I=L[S],O=E(I);te[O].references--}for(var _=B(b,F),D=0;D<L.length;D++){var V=L[D],J=E(V);te[J].references===0&&(te[J].updater(),te.splice(J,1))}L=_}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":Z=>{var te={};function E(H){if(typeof te[H]>"u"){var C=document.querySelector(H);if(window.HTMLIFrameElement&&C instanceof window.HTMLIFrameElement)try{C=C.contentDocument.head}catch{C=null}te[H]=C}return te[H]}function B(H,C){var F=E(H);if(!F)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");F.appendChild(C)}Z.exports=B},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":Z=>{function te(E){var B=document.createElement("style");return E.setAttributes(B,E.attributes),E.insert(B,E.options),B}Z.exports=te},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(Z,te,E)=>{function B(H){var C=E.nc;C&&H.setAttribute("nonce",C)}Z.exports=B},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":Z=>{function te(H,C,F){var L="";F.supports&&(L+="@supports (".concat(F.supports,") {")),F.media&&(L+="@media ".concat(F.media," {"));var M=typeof F.layer<"u";M&&(L+="@layer".concat(F.layer.length>0?" ".concat(F.layer):""," {")),L+=F.css,M&&(L+="}"),F.media&&(L+="}"),F.supports&&(L+="}");var b=F.sourceMap;b&&typeof btoa<"u"&&(L+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(b))))," */")),C.styleTagTransform(L,H,C.options)}function E(H){if(H.parentNode===null)return!1;H.parentNode.removeChild(H)}function B(H){var C=H.insertStyleElement(H);return{update:function(L){te(C,H,L)},remove:function(){E(C)}}}Z.exports=B},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":Z=>{function te(E,B){if(B.styleSheet)B.styleSheet.cssText=E;else{for(;B.firstChild;)B.removeChild(B.firstChild);B.appendChild(document.createTextNode(E))}}Z.exports=te},"data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E":Z=>{Z.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":Z=>{Z.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":Z=>{Z.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E":Z=>{Z.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E":Z=>{Z.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"},"./node_modules/super-three/build/three.module.js":(Z,te,E)=>{E.r(te),E.d(te,{ACESFilmicToneMapping:()=>Nt,AddEquation:()=>Ae,AddOperation:()=>Pn,AdditiveAnimationBlendMode:()=>br,AdditiveBlending:()=>U,AlphaFormat:()=>Gi,AlwaysDepth:()=>Wn,AlwaysStencilFunc:()=>oh,AmbientLight:()=>Nm,AmbientLightProbe:()=>rA,AnimationClip:()=>Hh,AnimationLoader:()=>Tc,AnimationMixer:()=>pC,AnimationObjectGroup:()=>uC,AnimationUtils:()=>q2,ArcCurve:()=>dv,ArrayCamera:()=>d0,ArrowHelper:()=>DC,Audio:()=>Um,AudioAnalyser:()=>eC,AudioContext:()=>jp,AudioListener:()=>Yp,AudioLoader:()=>nA,AxesHelper:()=>ey,BackSide:()=>V,BasicDepthPacking:()=>Is,BasicShadowMap:()=>S,Bone:()=>v0,BooleanKeyframeTrack:()=>Ku,Box2:()=>xC,Box3:()=>ss,Box3Helper:()=>kC,BoxBufferGeometry:()=>WC,BoxGeometry:()=>bc,BoxHelper:()=>BC,BufferAttribute:()=>Vt,BufferGeometry:()=>Or,BufferGeometryLoader:()=>q0,ByteType:()=>lr,Cache:()=>su,Camera:()=>wd,CameraHelper:()=>RC,CanvasTexture:()=>hv,CapsuleBufferGeometry:()=>HC,CapsuleGeometry:()=>Dp,CatmullRomCurve3:()=>pv,CineonToneMapping:()=>ui,CircleBufferGeometry:()=>KC,CircleGeometry:()=>eu,ClampToEdgeWrapping:()=>Ct,Clock:()=>Pm,Color:()=>Si,ColorKeyframeTrack:()=>W0,ColorManagement:()=>ma,CompressedArrayTexture:()=>k2,CompressedTexture:()=>vm,CompressedTextureLoader:()=>Wl,ConeBufferGeometry:()=>XC,ConeGeometry:()=>Vl,CubeCamera:()=>Ff,CubeReflectionMapping:()=>We,CubeRefractionMapping:()=>Oe,CubeTexture:()=>rc,CubeTextureLoader:()=>K0,CubeUVReflectionMapping:()=>vt,CubicBezierCurve:()=>Em,CubicBezierCurve3:()=>mv,CubicInterpolant:()=>Fv,CullFaceBack:()=>L,CullFaceFront:()=>M,CullFaceFrontBack:()=>b,CullFaceNone:()=>F,Curve:()=>oc,CurvePath:()=>Av,CustomBlending:()=>ve,CustomToneMapping:()=>De,CylinderBufferGeometry:()=>QC,CylinderGeometry:()=>Ph,Cylindrical:()=>bC,Data3DTexture:()=>so,DataArrayTexture:()=>Mu,DataTexture:()=>Gu,DataTexture2DArray:()=>VC,DataTexture3D:()=>zC,DataTextureLoader:()=>X0,DataUtils:()=>OC,DecrementStencilOp:()=>pl,DecrementWrapStencilOp:()=>fl,DefaultLoadingManager:()=>Qu,DepthFormat:()=>$r,DepthStencilFormat:()=>ws,DepthTexture:()=>Yc,DirectionalLight:()=>Dm,DirectionalLightHelper:()=>Jv,DiscreteInterpolant:()=>Pv,DodecahedronBufferGeometry:()=>ZC,DodecahedronGeometry:()=>nu,DoubleSide:()=>J,DstAlphaFactor:()=>Tt,DstColorFactor:()=>fn,DynamicCopyUsage:()=>lh,DynamicDrawUsage:()=>ad,DynamicReadUsage:()=>wf,EdgesGeometry:()=>tl,EllipseCurve:()=>Bp,EqualDepth:()=>nt,EqualStencilFunc:()=>jl,EquirectangularReflectionMapping:()=>Qe,EquirectangularRefractionMapping:()=>Ke,Euler:()=>yo,EventDispatcher:()=>io,ExtrudeBufferGeometry:()=>$C,ExtrudeGeometry:()=>Pp,FileLoader:()=>cc,Float16BufferAttribute:()=>Uo,Float32BufferAttribute:()=>Fi,Float64BufferAttribute:()=>Ca,FloatType:()=>ti,Fog:()=>im,FogExp2:()=>nm,FramebufferTexture:()=>B2,FrontSide:()=>D,Frustum:()=>Pf,GLBufferAttribute:()=>AC,GLSL1:()=>ld,GLSL3:()=>Cu,GreaterDepth:()=>Ot,GreaterEqualDepth:()=>dt,GreaterEqualStencilFunc:()=>sd,GreaterStencilFunc:()=>id,GridHelper:()=>MC,Group:()=>Pu,HalfFloatType:()=>hn,HemisphereLight:()=>Wp,HemisphereLightHelper:()=>TC,HemisphereLightProbe:()=>iA,IcosahedronBufferGeometry:()=>jC,IcosahedronGeometry:()=>Op,ImageBitmapLoader:()=>Vv,ImageLoader:()=>Kh,ImageUtils:()=>Tu,ImmediateRenderObject:()=>GC,IncrementStencilOp:()=>Ml,IncrementWrapStencilOp:()=>fc,InstancedBufferAttribute:()=>Fd,InstancedBufferGeometry:()=>J0,InstancedInterleavedBuffer:()=>gC,InstancedMesh:()=>av,Int16BufferAttribute:()=>Dg,Int32BufferAttribute:()=>Ng,Int8BufferAttribute:()=>Rf,IntType:()=>Vs,InterleavedBuffer:()=>rm,InterleavedBufferAttribute:()=>Jc,Interpolant:()=>Vp,InterpolateDiscrete:()=>vn,InterpolateLinear:()=>Lt,InterpolateSmooth:()=>rn,InvertStencilOp:()=>_l,KeepStencilOp:()=>Fo,KeyframeTrack:()=>lc,LOD:()=>um,LatheBufferGeometry:()=>ny,LatheGeometry:()=>Od,Layers:()=>jr,LessDepth:()=>gi,LessEqualDepth:()=>ai,LessEqualStencilFunc:()=>Js,LessStencilFunc:()=>$l,Light:()=>Mc,LightProbe:()=>Qp,Line:()=>Uu,Line3:()=>CC,LineBasicMaterial:()=>Fa,LineCurve:()=>Pd,LineCurve3:()=>gv,LineDashedMaterial:()=>Nv,LineLoop:()=>lv,LineSegments:()=>Ic,LinearEncoding:()=>Qr,LinearFilter:()=>ft,LinearInterpolant:()=>z0,LinearMipMapLinearFilter:()=>ri,LinearMipMapNearestFilter:()=>hi,LinearMipmapLinearFilter:()=>bi,LinearMipmapNearestFilter:()=>Ft,LinearSRGBColorSpace:()=>no,LinearToneMapping:()=>Dn,Loader:()=>uo,LoaderUtils:()=>$p,LoadingManager:()=>zp,LoopOnce:()=>At,LoopPingPong:()=>Sn,LoopRepeat:()=>It,LuminanceAlphaFormat:()=>Fr,LuminanceFormat:()=>Xr,MOUSE:()=>H,Material:()=>Ba,MaterialLoader:()=>Zp,MathUtils:()=>dp,Matrix3:()=>ro,Matrix4:()=>Ri,MaxEquation:()=>pe,Mesh:()=>lo,MeshBasicMaterial:()=>_u,MeshDepthMaterial:()=>em,MeshDistanceMaterial:()=>u0,MeshLambertMaterial:()=>Lv,MeshMatcapMaterial:()=>Dv,MeshNormalMaterial:()=>kv,MeshPhongMaterial:()=>Rv,MeshPhysicalMaterial:()=>_v,MeshStandardMaterial:()=>P0,MeshToonMaterial:()=>Bv,MinEquation:()=>de,MirroredRepeatWrapping:()=>Yt,MixOperation:()=>mn,MultiplyBlending:()=>oe,MultiplyOperation:()=>Ye,NearestFilter:()=>me,NearestMipMapLinearFilter:()=>ht,NearestMipMapNearestFilter:()=>ae,NearestMipmapLinearFilter:()=>Ue,NearestMipmapNearestFilter:()=>ee,NeverDepth:()=>yn,NeverStencilFunc:()=>Rl,NoBlending:()=>Y,NoColorSpace:()=>Va,NoToneMapping:()=>wn,NormalAnimationBlendMode:()=>Vi,NormalBlending:()=>W,NotEqualDepth:()=>$t,NotEqualStencilFunc:()=>rd,NumberKeyframeTrack:()=>Xu,Object3D:()=>as,ObjectLoader:()=>Gv,ObjectSpaceNormalMap:()=>Ua,OctahedronBufferGeometry:()=>YC,OctahedronGeometry:()=>Wd,OneFactor:()=>he,OneMinusDstAlphaFactor:()=>Rt,OneMinusDstColorFactor:()=>cn,OneMinusSrcAlphaFactor:()=>et,OneMinusSrcColorFactor:()=>Ve,OrthographicCamera:()=>Kf,PCFShadowMap:()=>I,PCFSoftShadowMap:()=>O,PMREMGenerator:()=>e0,Path:()=>Lp,PerspectiveCamera:()=>qs,Plane:()=>_o,PlaneBufferGeometry:()=>JC,PlaneGeometry:()=>Ed,PlaneHelper:()=>LC,PointLight:()=>Lm,PointLightHelper:()=>IC,Points:()=>zu,PointsMaterial:()=>C0,PolarGridHelper:()=>_C,PolyhedronBufferGeometry:()=>qC,PolyhedronGeometry:()=>tu,PositionalAudio:()=>oA,PropertyBinding:()=>fs,PropertyMixer:()=>Rc,QuadraticBezierCurve:()=>T0,QuadraticBezierCurve3:()=>M0,Quaternion:()=>la,QuaternionKeyframeTrack:()=>wl,QuaternionLinearInterpolant:()=>Ov,REVISION:()=>B,RGBADepthPacking:()=>Ys,RGBAFormat:()=>cr,RGBAIntegerFormat:()=>st,RGBA_ASTC_10x10_Format:()=>ce,RGBA_ASTC_10x5_Format:()=>zs,RGBA_ASTC_10x6_Format:()=>zr,RGBA_ASTC_10x8_Format:()=>ie,RGBA_ASTC_12x10_Format:()=>Ce,RGBA_ASTC_12x12_Format:()=>_e,RGBA_ASTC_4x4_Format:()=>us,RGBA_ASTC_5x4_Format:()=>Tr,RGBA_ASTC_5x5_Format:()=>pr,RGBA_ASTC_6x5_Format:()=>Pr,RGBA_ASTC_6x6_Format:()=>Rs,RGBA_ASTC_8x5_Format:()=>fa,RGBA_ASTC_8x6_Format:()=>di,RGBA_ASTC_8x8_Format:()=>Cr,RGBA_BPTC_Format:()=>Xe,RGBA_ETC2_EAC_Format:()=>ir,RGBA_PVRTC_2BPPV1_Format:()=>An,RGBA_PVRTC_4BPPV1_Format:()=>vi,RGBA_S3TC_DXT1_Format:()=>en,RGBA_S3TC_DXT3_Format:()=>Xt,RGBA_S3TC_DXT5_Format:()=>En,RGBFormat:()=>nr,RGB_ETC1_Format:()=>Ui,RGB_ETC2_Format:()=>Hi,RGB_PVRTC_2BPPV1_Format:()=>Ci,RGB_PVRTC_4BPPV1_Format:()=>Fn,RGB_S3TC_DXT1_Format:()=>wt,RGFormat:()=>vs,RGIntegerFormat:()=>Ge,RawShaderMaterial:()=>Mv,Ray:()=>_a,Raycaster:()=>vC,RectAreaLight:()=>_c,RedFormat:()=>vr,RedIntegerFormat:()=>As,ReinhardToneMapping:()=>gn,RepeatWrapping:()=>ct,ReplaceStencilOp:()=>dl,ReverseSubtractEquation:()=>Ie,RingBufferGeometry:()=>ew,RingGeometry:()=>Gp,SRGBColorSpace:()=>Bs,Scene:()=>j1,ShaderChunk:()=>Gr,ShaderLib:()=>qo,ShaderMaterial:()=>Ol,ShadowMaterial:()=>Tv,Shape:()=>iu,ShapeBufferGeometry:()=>tw,ShapeGeometry:()=>Up,ShapePath:()=>ty,ShapeUtils:()=>Sc,ShortType:()=>_s,Skeleton:()=>pm,SkeletonHelper:()=>EC,SkinnedMesh:()=>dm,Source:()=>gc,Sphere:()=>To,SphereBufferGeometry:()=>nw,SphereGeometry:()=>Hd,Spherical:()=>yC,SphericalHarmonics3:()=>Y0,SplineCurve:()=>Ho,SpotLight:()=>km,SpotLightHelper:()=>wC,Sprite:()=>J1,SpriteMaterial:()=>m0,SrcAlphaFactor:()=>ze,SrcAlphaSaturateFactor:()=>Jn,SrcColorFactor:()=>Pe,StaticCopyUsage:()=>up,StaticDrawUsage:()=>Yl,StaticReadUsage:()=>Cf,StereoCamera:()=>sA,StreamCopyUsage:()=>ch,StreamDrawUsage:()=>od,StreamReadUsage:()=>cp,StringKeyframeTrack:()=>ru,SubtractEquation:()=>Se,SubtractiveBlending:()=>q,TOUCH:()=>C,TangentSpaceNormalMap:()=>Ps,TetrahedronBufferGeometry:()=>iw,TetrahedronGeometry:()=>Gh,Texture:()=>Ws,TextureLoader:()=>Q0,TorusBufferGeometry:()=>rw,TorusGeometry:()=>Uh,TorusKnotBufferGeometry:()=>sw,TorusKnotGeometry:()=>Vh,Triangle:()=>Ss,TriangleFanDrawMode:()=>ys,TriangleStripDrawMode:()=>er,TrianglesDrawMode:()=>ur,TubeBufferGeometry:()=>aw,TubeGeometry:()=>zh,UVMapping:()=>Re,Uint16BufferAttribute:()=>mp,Uint32BufferAttribute:()=>Fg,Uint8BufferAttribute:()=>JA,Uint8ClampedBufferAttribute:()=>Lg,Uniform:()=>lA,UniformsGroup:()=>mC,UniformsLib:()=>pi,UniformsUtils:()=>Gg,UnsignedByteType:()=>Ai,UnsignedInt248Type:()=>Yn,UnsignedIntType:()=>Dr,UnsignedShort4444Type:()=>On,UnsignedShort5551Type:()=>Oi,UnsignedShortType:()=>Fs,VSMShadowMap:()=>_,Vector2:()=>kn,Vector3:()=>tt,Vector4:()=>es,VectorKeyframeTrack:()=>Wh,VideoTexture:()=>uv,WebGL1Renderer:()=>tm,WebGL3DRenderTarget:()=>Bg,WebGLArrayRenderTarget:()=>If,WebGLCubeRenderTarget:()=>Ug,WebGLMultipleRenderTargets:()=>Sf,WebGLMultisampleRenderTarget:()=>UC,WebGLRenderTarget:()=>So,WebGLRenderer:()=>$1,WebGLUtils:()=>K1,WireframeGeometry:()=>Iv,WrapAroundEnding:()=>Ii,ZeroCurvatureEnding:()=>Bn,ZeroFactor:()=>we,ZeroSlopeEnding:()=>fi,ZeroStencilOp:()=>Tl,_SRGBAFormat:()=>wu,sRGBEncoding:()=>gr});/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const B="147",H={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},C={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},F=0,L=1,M=2,b=3,S=0,I=1,O=2,_=3,D=0,V=1,J=2,Y=0,W=1,U=2,q=3,oe=4,ve=5,Ae=100,Se=101,Ie=102,de=103,pe=104,we=200,he=201,Pe=202,Ve=203,ze=204,et=205,Tt=206,Rt=207,fn=208,cn=209,Jn=210,yn=0,Wn=1,gi=2,ai=3,nt=4,dt=5,Ot=6,$t=7,Ye=0,mn=1,Pn=2,wn=0,Dn=1,gn=2,ui=3,Nt=4,De=5,Re=300,We=301,Oe=302,Qe=303,Ke=304,vt=306,ct=1e3,Ct=1001,Yt=1002,me=1003,ee=1004,ae=1004,Ue=1005,ht=1005,ft=1006,Ft=1007,hi=1007,bi=1008,ri=1008,Ai=1009,lr=1010,_s=1011,Fs=1012,Vs=1013,Dr=1014,ti=1015,hn=1016,On=1017,Oi=1018,Yn=1020,Gi=1021,nr=1022,cr=1023,Xr=1024,Fr=1025,$r=1026,ws=1027,vr=1028,As=1029,vs=1030,Ge=1031,st=1033,wt=33776,en=33777,Xt=33778,En=33779,Fn=35840,Ci=35841,vi=35842,An=35843,Ui=36196,Hi=37492,ir=37496,us=37808,Tr=37809,pr=37810,Pr=37811,Rs=37812,fa=37813,di=37814,Cr=37815,zs=37816,zr=37817,ie=37818,ce=37819,Ce=37820,_e=37821,Xe=36492,At=2200,It=2201,Sn=2202,vn=2300,Lt=2301,rn=2302,Bn=2400,fi=2401,Ii=2402,Vi=2500,br=2501,ur=0,er=1,ys=2,Qr=3e3,gr=3001,Is=3200,Ys=3201,Ps=0,Ua=1,Va="",Bs="srgb",no="srgb-linear",Tl=0,Fo=7680,dl=7681,Ml=7682,pl=7683,fc=34055,fl=34056,_l=5386,Rl=512,$l=513,jl=514,Js=515,id=516,rd=517,sd=518,oh=519,Yl=35044,ad=35048,od=35040,Cf=35045,wf=35049,cp=35041,up=35046,lh=35050,ch=35042,ld="100",Cu="300 es",wu=1035;class io{addEventListener(n,a){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[n]===void 0&&(u[n]=[]),u[n].indexOf(a)===-1&&u[n].push(a)}hasEventListener(n,a){if(this._listeners===void 0)return!1;const u=this._listeners;return u[n]!==void 0&&u[n].indexOf(a)!==-1}removeEventListener(n,a){if(this._listeners===void 0)return;const d=this._listeners[n];if(d!==void 0){const m=d.indexOf(a);m!==-1&&d.splice(m,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const u=this._listeners[n.type];if(u!==void 0){n.target=this;const d=u.slice(0);for(let m=0,A=d.length;m<A;m++)d[m].call(this,n);n.target=null}}}const za=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Eu=1234567;const Bl=Math.PI/180,Jl=180/Math.PI;function Za(){const x=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(za[x&255]+za[x>>8&255]+za[x>>16&255]+za[x>>24&255]+"-"+za[n&255]+za[n>>8&255]+"-"+za[n>>16&15|64]+za[n>>24&255]+"-"+za[a&63|128]+za[a>>8&255]+"-"+za[a>>16&255]+za[a>>24&255]+za[u&255]+za[u>>8&255]+za[u>>16&255]+za[u>>24&255]).toLowerCase()}function aa(x,n,a){return Math.max(n,Math.min(a,x))}function cd(x,n){return(x%n+n)%n}function ud(x,n,a,u,d){return u+(x-n)*(d-u)/(a-n)}function uh(x,n,a){return x!==n?(a-x)/(n-x):0}function mc(x,n,a){return(1-a)*x+a*n}function hh(x,n,a,u){return mc(x,n,1-Math.exp(-a*u))}function dh(x,n=1){return n-Math.abs(cd(x,n*2)-n)}function ph(x,n,a){return x<=n?0:x>=a?1:(x=(x-n)/(a-n),x*x*(3-2*x))}function fh(x,n,a){return x<=n?0:x>=a?1:(x=(x-n)/(a-n),x*x*x*(x*(x*6-15)+10))}function mh(x,n){return x+Math.floor(Math.random()*(n-x+1))}function gh(x,n){return x+Math.random()*(n-x)}function hd(x){return x*(.5-Math.random())}function dd(x){x!==void 0&&(Eu=x);let n=Eu+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}function pd(x){return x*Bl}function fd(x){return x*Jl}function md(x){return(x&x-1)===0&&x!==0}function hp(x){return Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))}function Ah(x){return Math.pow(2,Math.floor(Math.log(x)/Math.LN2))}function Ef(x,n,a,u,d){const m=Math.cos,A=Math.sin,y=m(a/2),k=A(a/2),N=m((n+u)/2),K=A((n+u)/2),$=m((n-u)/2),j=A((n-u)/2),ne=m((u-n)/2),le=A((u-n)/2);switch(d){case"XYX":x.set(y*K,k*$,k*j,y*N);break;case"YZY":x.set(k*j,y*K,k*$,y*N);break;case"ZXZ":x.set(k*$,k*j,y*K,y*N);break;case"XZX":x.set(y*K,k*le,k*ne,y*N);break;case"YXY":x.set(k*ne,y*K,k*le,y*N);break;case"ZYZ":x.set(k*le,k*ne,y*K,y*N);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+d)}}function kl(x,n){switch(n.constructor){case Float32Array:return x;case Uint16Array:return x/65535;case Uint8Array:return x/255;case Int16Array:return Math.max(x/32767,-1);case Int8Array:return Math.max(x/127,-1);default:throw new Error("Invalid component type.")}}function hs(x,n){switch(n.constructor){case Float32Array:return x;case Uint16Array:return Math.round(x*65535);case Uint8Array:return Math.round(x*255);case Int16Array:return Math.round(x*32767);case Int8Array:return Math.round(x*127);default:throw new Error("Invalid component type.")}}var dp=Object.freeze({__proto__:null,DEG2RAD:Bl,RAD2DEG:Jl,generateUUID:Za,clamp:aa,euclideanModulo:cd,mapLinear:ud,inverseLerp:uh,lerp:mc,damp:hh,pingpong:dh,smoothstep:ph,smootherstep:fh,randInt:mh,randFloat:gh,randFloatSpread:hd,seededRandom:dd,degToRad:pd,radToDeg:fd,isPowerOfTwo:md,ceilPowerOfTwo:hp,floorPowerOfTwo:Ah,setQuaternionFromProperEuler:Ef,normalize:hs,denormalize:kl});class kn{constructor(n=0,a=0){kn.prototype.isVector2=!0,this.x=n,this.y=a}get width(){return this.x}set width(n){this.x=n}get height(){return this.y}set height(n){this.y=n}set(n,a){return this.x=n,this.y=a,this}setScalar(n){return this.x=n,this.y=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setComponent(n,a){switch(n){case 0:this.x=a;break;case 1:this.y=a;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y)}copy(n){return this.x=n.x,this.y=n.y,this}add(n){return this.x+=n.x,this.y+=n.y,this}addScalar(n){return this.x+=n,this.y+=n,this}addVectors(n,a){return this.x=n.x+a.x,this.y=n.y+a.y,this}addScaledVector(n,a){return this.x+=n.x*a,this.y+=n.y*a,this}sub(n){return this.x-=n.x,this.y-=n.y,this}subScalar(n){return this.x-=n,this.y-=n,this}subVectors(n,a){return this.x=n.x-a.x,this.y=n.y-a.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divide(n){return this.x/=n.x,this.y/=n.y,this}divideScalar(n){return this.multiplyScalar(1/n)}applyMatrix3(n){const a=this.x,u=this.y,d=n.elements;return this.x=d[0]*a+d[3]*u+d[6],this.y=d[1]*a+d[4]*u+d[7],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this}clamp(n,a){return this.x=Math.max(n.x,Math.min(a.x,this.x)),this.y=Math.max(n.y,Math.min(a.y,this.y)),this}clampScalar(n,a){return this.x=Math.max(n,Math.min(a,this.x)),this.y=Math.max(n,Math.min(a,this.y)),this}clampLength(n,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(n,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const a=this.x-n.x,u=this.y-n.y;return a*a+u*u}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,a){return this.x+=(n.x-this.x)*a,this.y+=(n.y-this.y)*a,this}lerpVectors(n,a,u){return this.x=n.x+(a.x-n.x)*u,this.y=n.y+(a.y-n.y)*u,this}equals(n){return n.x===this.x&&n.y===this.y}fromArray(n,a=0){return this.x=n[a],this.y=n[a+1],this}toArray(n=[],a=0){return n[a]=this.x,n[a+1]=this.y,n}fromBufferAttribute(n,a){return this.x=n.getX(a),this.y=n.getY(a),this}rotateAround(n,a){const u=Math.cos(a),d=Math.sin(a),m=this.x-n.x,A=this.y-n.y;return this.x=m*u-A*d+n.x,this.y=m*d+A*u+n.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ro{constructor(){ro.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(n,a,u,d,m,A,y,k,N){const K=this.elements;return K[0]=n,K[1]=d,K[2]=y,K[3]=a,K[4]=m,K[5]=k,K[6]=u,K[7]=A,K[8]=N,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(n){const a=this.elements,u=n.elements;return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],this}extractBasis(n,a,u){return n.setFromMatrix3Column(this,0),a.setFromMatrix3Column(this,1),u.setFromMatrix3Column(this,2),this}setFromMatrix4(n){const a=n.elements;return this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]),this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,a){const u=n.elements,d=a.elements,m=this.elements,A=u[0],y=u[3],k=u[6],N=u[1],K=u[4],$=u[7],j=u[2],ne=u[5],le=u[8],se=d[0],re=d[3],ye=d[6],Be=d[1],Ee=d[4],Me=d[7],Fe=d[2],it=d[5],yt=d[8];return m[0]=A*se+y*Be+k*Fe,m[3]=A*re+y*Ee+k*it,m[6]=A*ye+y*Me+k*yt,m[1]=N*se+K*Be+$*Fe,m[4]=N*re+K*Ee+$*it,m[7]=N*ye+K*Me+$*yt,m[2]=j*se+ne*Be+le*Fe,m[5]=j*re+ne*Ee+le*it,m[8]=j*ye+ne*Me+le*yt,this}multiplyScalar(n){const a=this.elements;return a[0]*=n,a[3]*=n,a[6]*=n,a[1]*=n,a[4]*=n,a[7]*=n,a[2]*=n,a[5]*=n,a[8]*=n,this}determinant(){const n=this.elements,a=n[0],u=n[1],d=n[2],m=n[3],A=n[4],y=n[5],k=n[6],N=n[7],K=n[8];return a*A*K-a*y*N-u*m*K+u*y*k+d*m*N-d*A*k}invert(){const n=this.elements,a=n[0],u=n[1],d=n[2],m=n[3],A=n[4],y=n[5],k=n[6],N=n[7],K=n[8],$=K*A-y*N,j=y*k-K*m,ne=N*m-A*k,le=a*$+u*j+d*ne;if(le===0)return this.set(0,0,0,0,0,0,0,0,0);const se=1/le;return n[0]=$*se,n[1]=(d*N-K*u)*se,n[2]=(y*u-d*A)*se,n[3]=j*se,n[4]=(K*a-d*k)*se,n[5]=(d*m-y*a)*se,n[6]=ne*se,n[7]=(u*k-N*a)*se,n[8]=(A*a-u*m)*se,this}transpose(){let n;const a=this.elements;return n=a[1],a[1]=a[3],a[3]=n,n=a[2],a[2]=a[6],a[6]=n,n=a[5],a[5]=a[7],a[7]=n,this}getNormalMatrix(n){return this.setFromMatrix4(n).invert().transpose()}transposeIntoArray(n){const a=this.elements;return n[0]=a[0],n[1]=a[3],n[2]=a[6],n[3]=a[1],n[4]=a[4],n[5]=a[7],n[6]=a[2],n[7]=a[5],n[8]=a[8],this}setUvTransform(n,a,u,d,m,A,y){const k=Math.cos(m),N=Math.sin(m);return this.set(u*k,u*N,-u*(k*A+N*y)+A+n,-d*N,d*k,-d*(-N*A+k*y)+y+a,0,0,1),this}scale(n,a){return this.premultiply(gd.makeScale(n,a)),this}rotate(n){return this.premultiply(gd.makeRotation(-n)),this}translate(n,a){return this.premultiply(gd.makeTranslation(n,a)),this}makeTranslation(n,a){return this.set(1,0,n,0,1,a,0,0,1),this}makeRotation(n){const a=Math.cos(n),u=Math.sin(n);return this.set(a,-u,0,u,a,0,0,0,1),this}makeScale(n,a){return this.set(n,0,0,0,a,0,0,0,1),this}equals(n){const a=this.elements,u=n.elements;for(let d=0;d<9;d++)if(a[d]!==u[d])return!1;return!0}fromArray(n,a=0){for(let u=0;u<9;u++)this.elements[u]=n[u+a];return this}toArray(n=[],a=0){const u=this.elements;return n[a]=u[0],n[a+1]=u[1],n[a+2]=u[2],n[a+3]=u[3],n[a+4]=u[4],n[a+5]=u[5],n[a+6]=u[6],n[a+7]=u[7],n[a+8]=u[8],n}clone(){return new this.constructor().fromArray(this.elements)}}const gd=new ro;function pp(x){for(let n=x.length-1;n>=0;--n)if(x[n]>=65535)return!0;return!1}const vh={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ll(x,n){return new vh[x](n)}function ql(x){return document.createElementNS("http://www.w3.org/1999/xhtml",x)}function ml(x){return x<.04045?x*.0773993808:Math.pow(x*.9478672986+.0521327014,2.4)}function Iu(x){return x<.0031308?x*12.92:1.055*Math.pow(x,.41666)-.055}const yh={[Bs]:{[no]:ml},[no]:{[Bs]:Iu}},ma={legacyMode:!0,get workingColorSpace(){return no},set workingColorSpace(x){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(x,n,a){if(this.legacyMode||n===a||!n||!a)return x;if(yh[n]&&yh[n][a]!==void 0){const u=yh[n][a];return x.r=u(x.r),x.g=u(x.g),x.b=u(x.b),x}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(x,n){return this.convert(x,this.workingColorSpace,n)},toWorkingColorSpace:function(x,n){return this.convert(x,n,this.workingColorSpace)}},Ad={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oa={r:0,g:0,b:0},Io={h:0,s:0,l:0},Gc={h:0,s:0,l:0};function Uc(x,n,a){return a<0&&(a+=1),a>1&&(a-=1),a<.16666666666666666?x+(n-x)*6*a:a<.5?n:a<.6666666666666666?x+(n-x)*6*(.6666666666666666-a):x}function Su(x,n){return n.r=x.r,n.g=x.g,n.b=x.b,n}class Si{constructor(n,a,u){return this.isColor=!0,this.r=1,this.g=1,this.b=1,a===void 0&&u===void 0?this.set(n):this.setRGB(n,a,u)}set(n){return n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n),this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,a=Bs){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,ma.toWorkingColorSpace(this,a),this}setRGB(n,a,u,d=ma.workingColorSpace){return this.r=n,this.g=a,this.b=u,ma.toWorkingColorSpace(this,d),this}setHSL(n,a,u,d=ma.workingColorSpace){if(n=cd(n,1),a=aa(a,0,1),u=aa(u,0,1),a===0)this.r=this.g=this.b=u;else{const m=u<=.5?u*(1+a):u+a-u*a,A=2*u-m;this.r=Uc(A,m,n+.3333333333333333),this.g=Uc(A,m,n),this.b=Uc(A,m,n-.3333333333333333)}return ma.toWorkingColorSpace(this,d),this}setStyle(n,a=Bs){function u(m){m!==void 0&&parseFloat(m)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let d;if(d=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(n)){let m;const A=d[1],y=d[2];switch(A){case"rgb":case"rgba":if(m=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y))return this.r=Math.min(255,parseInt(m[1],10))/255,this.g=Math.min(255,parseInt(m[2],10))/255,this.b=Math.min(255,parseInt(m[3],10))/255,ma.toWorkingColorSpace(this,a),u(m[4]),this;if(m=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y))return this.r=Math.min(100,parseInt(m[1],10))/100,this.g=Math.min(100,parseInt(m[2],10))/100,this.b=Math.min(100,parseInt(m[3],10))/100,ma.toWorkingColorSpace(this,a),u(m[4]),this;break;case"hsl":case"hsla":if(m=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y)){const k=parseFloat(m[1])/360,N=parseFloat(m[2])/100,K=parseFloat(m[3])/100;return u(m[4]),this.setHSL(k,N,K,a)}break}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(n)){const m=d[1],A=m.length;if(A===3)return this.r=parseInt(m.charAt(0)+m.charAt(0),16)/255,this.g=parseInt(m.charAt(1)+m.charAt(1),16)/255,this.b=parseInt(m.charAt(2)+m.charAt(2),16)/255,ma.toWorkingColorSpace(this,a),this;if(A===6)return this.r=parseInt(m.charAt(0)+m.charAt(1),16)/255,this.g=parseInt(m.charAt(2)+m.charAt(3),16)/255,this.b=parseInt(m.charAt(4)+m.charAt(5),16)/255,ma.toWorkingColorSpace(this,a),this}return n&&n.length>0?this.setColorName(n,a):this}setColorName(n,a=Bs){const u=Ad[n.toLowerCase()];return u!==void 0?this.setHex(u,a):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=ml(n.r),this.g=ml(n.g),this.b=ml(n.b),this}copyLinearToSRGB(n){return this.r=Iu(n.r),this.g=Iu(n.g),this.b=Iu(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=Bs){return ma.fromWorkingColorSpace(Su(this,oa),n),aa(oa.r*255,0,255)<<16^aa(oa.g*255,0,255)<<8^aa(oa.b*255,0,255)<<0}getHexString(n=Bs){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,a=ma.workingColorSpace){ma.fromWorkingColorSpace(Su(this,oa),a);const u=oa.r,d=oa.g,m=oa.b,A=Math.max(u,d,m),y=Math.min(u,d,m);let k,N;const K=(y+A)/2;if(y===A)k=0,N=0;else{const $=A-y;switch(N=K<=.5?$/(A+y):$/(2-A-y),A){case u:k=(d-m)/$+(d<m?6:0);break;case d:k=(m-u)/$+2;break;case m:k=(u-d)/$+4;break}k/=6}return n.h=k,n.s=N,n.l=K,n}getRGB(n,a=ma.workingColorSpace){return ma.fromWorkingColorSpace(Su(this,oa),a),n.r=oa.r,n.g=oa.g,n.b=oa.b,n}getStyle(n=Bs){return ma.fromWorkingColorSpace(Su(this,oa),n),n!==Bs?`color(${n} ${oa.r} ${oa.g} ${oa.b})`:`rgb(${oa.r*255|0},${oa.g*255|0},${oa.b*255|0})`}offsetHSL(n,a,u){return this.getHSL(Io),Io.h+=n,Io.s+=a,Io.l+=u,this.setHSL(Io.h,Io.s,Io.l),this}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,a){return this.r=n.r+a.r,this.g=n.g+a.g,this.b=n.b+a.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,a){return this.r+=(n.r-this.r)*a,this.g+=(n.g-this.g)*a,this.b+=(n.b-this.b)*a,this}lerpColors(n,a,u){return this.r=n.r+(a.r-n.r)*u,this.g=n.g+(a.g-n.g)*u,this.b=n.b+(a.b-n.b)*u,this}lerpHSL(n,a){this.getHSL(Io),n.getHSL(Gc);const u=mc(Io.h,Gc.h,a),d=mc(Io.s,Gc.s,a),m=mc(Io.l,Gc.l,a);return this.setHSL(u,d,m),this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,a=0){return this.r=n[a],this.g=n[a+1],this.b=n[a+2],this}toArray(n=[],a=0){return n[a]=this.r,n[a+1]=this.g,n[a+2]=this.b,n}fromBufferAttribute(n,a){return this.r=n.getX(a),this.g=n.getY(a),this.b=n.getZ(a),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Si.NAMES=Ad;let ec;class Tu{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let a;if(n instanceof HTMLCanvasElement)a=n;else{ec===void 0&&(ec=ql("canvas")),ec.width=n.width,ec.height=n.height;const u=ec.getContext("2d");n instanceof ImageData?u.putImageData(n,0,0):u.drawImage(n,0,0,n.width,n.height),a=ec}return a.width>2048||a.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),a.toDataURL("image/jpeg",.6)):a.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const a=ql("canvas");a.width=n.width,a.height=n.height;const u=a.getContext("2d");u.drawImage(n,0,0,n.width,n.height);const d=u.getImageData(0,0,n.width,n.height),m=d.data;for(let A=0;A<m.length;A++)m[A]=ml(m[A]/255)*255;return u.putImageData(d,0,0),a}else if(n.data){const a=n.data.slice(0);for(let u=0;u<a.length;u++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[u]=Math.floor(ml(a[u]/255)*255):a[u]=ml(a[u]);return{data:a,width:n.width,height:n.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}}class gc{constructor(n=null){this.isSource=!0,this.uuid=Za(),this.data=n,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const a=n===void 0||typeof n=="string";if(!a&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const u={uuid:this.uuid,url:""},d=this.data;if(d!==null){let m;if(Array.isArray(d)){m=[];for(let A=0,y=d.length;A<y;A++)d[A].isDataTexture?m.push(Ao(d[A].image)):m.push(Ao(d[A]))}else m=Ao(d);u.url=m}return a||(n.images[this.uuid]=u),u}}function Ao(x){return typeof HTMLImageElement<"u"&&x instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&x instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&x instanceof ImageBitmap?Tu.getDataURL(x):x.data?{data:Array.from(x.data),width:x.width,height:x.height,type:x.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Rg=0;class Ws extends io{constructor(n=Ws.DEFAULT_IMAGE,a=Ws.DEFAULT_MAPPING,u=Ct,d=Ct,m=ft,A=bi,y=cr,k=Ai,N=Ws.DEFAULT_ANISOTROPY,K=Qr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Rg++}),this.uuid=Za(),this.name="",this.source=new gc(n),this.mipmaps=[],this.mapping=a,this.wrapS=u,this.wrapT=d,this.magFilter=m,this.minFilter=A,this.anisotropy=N,this.format=y,this.internalFormat=null,this.type=k,this.offset=new kn(0,0),this.repeat=new kn(1,1),this.center=new kn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ro,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=K,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(n){this.source.data=n}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(n){return this.name=n.name,this.source=n.source,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.encoding=n.encoding,this.userData=JSON.parse(JSON.stringify(n.userData)),this.needsUpdate=!0,this}toJSON(n){const a=n===void 0||typeof n=="string";if(!a&&n.textures[this.uuid]!==void 0)return n.textures[this.uuid];const u={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(n).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(u.userData=this.userData),a||(n.textures[this.uuid]=u),u}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(n){if(this.mapping!==Re)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case ct:n.x=n.x-Math.floor(n.x);break;case Ct:n.x=n.x<0?0:1;break;case Yt:Math.abs(Math.floor(n.x)%2)===1?n.x=Math.ceil(n.x)-n.x:n.x=n.x-Math.floor(n.x);break}if(n.y<0||n.y>1)switch(this.wrapT){case ct:n.y=n.y-Math.floor(n.y);break;case Ct:n.y=n.y<0?0:1;break;case Yt:Math.abs(Math.floor(n.y)%2)===1?n.y=Math.ceil(n.y)-n.y:n.y=n.y-Math.floor(n.y);break}return this.flipY&&(n.y=1-n.y),n}set needsUpdate(n){n===!0&&(this.version++,this.source.needsUpdate=!0)}}Ws.DEFAULT_IMAGE=null,Ws.DEFAULT_MAPPING=Re,Ws.DEFAULT_ANISOTROPY=1;class es{constructor(n=0,a=0,u=0,d=1){es.prototype.isVector4=!0,this.x=n,this.y=a,this.z=u,this.w=d}get width(){return this.z}set width(n){this.z=n}get height(){return this.w}set height(n){this.w=n}set(n,a,u,d){return this.x=n,this.y=a,this.z=u,this.w=d,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this.w=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setW(n){return this.w=n,this}setComponent(n,a){switch(n){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w!==void 0?n.w:1,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this}addVectors(n,a){return this.x=n.x+a.x,this.y=n.y+a.y,this.z=n.z+a.z,this.w=n.w+a.w,this}addScaledVector(n,a){return this.x+=n.x*a,this.y+=n.y*a,this.z+=n.z*a,this.w+=n.w*a,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this}subVectors(n,a){return this.x=n.x-a.x,this.y=n.y-a.y,this.z=n.z-a.z,this.w=n.w-a.w,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this}applyMatrix4(n){const a=this.x,u=this.y,d=this.z,m=this.w,A=n.elements;return this.x=A[0]*a+A[4]*u+A[8]*d+A[12]*m,this.y=A[1]*a+A[5]*u+A[9]*d+A[13]*m,this.z=A[2]*a+A[6]*u+A[10]*d+A[14]*m,this.w=A[3]*a+A[7]*u+A[11]*d+A[15]*m,this}divideScalar(n){return this.multiplyScalar(1/n)}setAxisAngleFromQuaternion(n){this.w=2*Math.acos(n.w);const a=Math.sqrt(1-n.w*n.w);return a<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/a,this.y=n.y/a,this.z=n.z/a),this}setAxisAngleFromRotationMatrix(n){let a,u,d,m;const k=n.elements,N=k[0],K=k[4],$=k[8],j=k[1],ne=k[5],le=k[9],se=k[2],re=k[6],ye=k[10];if(Math.abs(K-j)<.01&&Math.abs($-se)<.01&&Math.abs(le-re)<.01){if(Math.abs(K+j)<.1&&Math.abs($+se)<.1&&Math.abs(le+re)<.1&&Math.abs(N+ne+ye-3)<.1)return this.set(1,0,0,0),this;a=Math.PI;const Ee=(N+1)/2,Me=(ne+1)/2,Fe=(ye+1)/2,it=(K+j)/4,yt=($+se)/4,Le=(le+re)/4;return Ee>Me&&Ee>Fe?Ee<.01?(u=0,d=.707106781,m=.707106781):(u=Math.sqrt(Ee),d=it/u,m=yt/u):Me>Fe?Me<.01?(u=.707106781,d=0,m=.707106781):(d=Math.sqrt(Me),u=it/d,m=Le/d):Fe<.01?(u=.707106781,d=.707106781,m=0):(m=Math.sqrt(Fe),u=yt/m,d=Le/m),this.set(u,d,m,a),this}let Be=Math.sqrt((re-le)*(re-le)+($-se)*($-se)+(j-K)*(j-K));return Math.abs(Be)<.001&&(Be=1),this.x=(re-le)/Be,this.y=($-se)/Be,this.z=(j-K)/Be,this.w=Math.acos((N+ne+ye-1)/2),this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this}clamp(n,a){return this.x=Math.max(n.x,Math.min(a.x,this.x)),this.y=Math.max(n.y,Math.min(a.y,this.y)),this.z=Math.max(n.z,Math.min(a.z,this.z)),this.w=Math.max(n.w,Math.min(a.w,this.w)),this}clampScalar(n,a){return this.x=Math.max(n,Math.min(a,this.x)),this.y=Math.max(n,Math.min(a,this.y)),this.z=Math.max(n,Math.min(a,this.z)),this.w=Math.max(n,Math.min(a,this.w)),this}clampLength(n,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(n,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,a){return this.x+=(n.x-this.x)*a,this.y+=(n.y-this.y)*a,this.z+=(n.z-this.z)*a,this.w+=(n.w-this.w)*a,this}lerpVectors(n,a,u){return this.x=n.x+(a.x-n.x)*u,this.y=n.y+(a.y-n.y)*u,this.z=n.z+(a.z-n.z)*u,this.w=n.w+(a.w-n.w)*u,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w}fromArray(n,a=0){return this.x=n[a],this.y=n[a+1],this.z=n[a+2],this.w=n[a+3],this}toArray(n=[],a=0){return n[a]=this.x,n[a+1]=this.y,n[a+2]=this.z,n[a+3]=this.w,n}fromBufferAttribute(n,a){return this.x=n.getX(a),this.y=n.getY(a),this.z=n.getZ(a),this.w=n.getW(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class So extends io{constructor(n=1,a=1,u={}){super(),this.isWebGLRenderTarget=!0,this.width=n,this.height=a,this.depth=1,this.scissor=new es(0,0,n,a),this.scissorTest=!1,this.viewport=new es(0,0,n,a);const d={width:n,height:a,depth:1};this.texture=new Ws(d,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=u.generateMipmaps!==void 0?u.generateMipmaps:!1,this.texture.internalFormat=u.internalFormat!==void 0?u.internalFormat:null,this.texture.minFilter=u.minFilter!==void 0?u.minFilter:ft,this.depthBuffer=u.depthBuffer!==void 0?u.depthBuffer:!0,this.stencilBuffer=u.stencilBuffer!==void 0?u.stencilBuffer:!1,this.depthTexture=u.depthTexture!==void 0?u.depthTexture:null,this.samples=u.samples!==void 0?u.samples:0}setSize(n,a,u=1){(this.width!==n||this.height!==a||this.depth!==u)&&(this.width=n,this.height=a,this.depth=u,this.texture.image.width=n,this.texture.image.height=a,this.texture.image.depth=u,this.dispose()),this.viewport.set(0,0,n,a),this.scissor.set(0,0,n,a)}clone(){return new this.constructor().copy(this)}copy(n){this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.copy(n.viewport),this.texture=n.texture.clone(),this.texture.isRenderTargetTexture=!0;const a=Object.assign({},n.texture.image);return this.texture.source=new gc(a),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.samples=n.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Mu extends Ws{constructor(n=null,a=1,u=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:n,width:a,height:u,depth:d},this.magFilter=me,this.minFilter=me,this.wrapR=Ct,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class If extends So{constructor(n=1,a=1,u=1){super(n,a),this.isWebGLArrayRenderTarget=!0,this.depth=u,this.texture=new Mu(null,n,a,u),this.texture.isRenderTargetTexture=!0}}class so extends Ws{constructor(n=null,a=1,u=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:a,height:u,depth:d},this.magFilter=me,this.minFilter=me,this.wrapR=Ct,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bg extends So{constructor(n=1,a=1,u=1){super(n,a),this.isWebGL3DRenderTarget=!0,this.depth=u,this.texture=new so(null,n,a,u),this.texture.isRenderTargetTexture=!0}}class Sf extends So{constructor(n=1,a=1,u=1,d={}){super(n,a,d),this.isWebGLMultipleRenderTargets=!0;const m=this.texture;this.texture=[];for(let A=0;A<u;A++)this.texture[A]=m.clone(),this.texture[A].isRenderTargetTexture=!0}setSize(n,a,u=1){if(this.width!==n||this.height!==a||this.depth!==u){this.width=n,this.height=a,this.depth=u;for(let d=0,m=this.texture.length;d<m;d++)this.texture[d].image.width=n,this.texture[d].image.height=a,this.texture[d].image.depth=u;this.dispose()}return this.viewport.set(0,0,n,a),this.scissor.set(0,0,n,a),this}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.texture.length=0;for(let a=0,u=n.texture.length;a<u;a++)this.texture[a]=n.texture[a].clone(),this.texture[a].isRenderTargetTexture=!0;return this}}class la{constructor(n=0,a=0,u=0,d=1){this.isQuaternion=!0,this._x=n,this._y=a,this._z=u,this._w=d}static slerpFlat(n,a,u,d,m,A,y){let k=u[d+0],N=u[d+1],K=u[d+2],$=u[d+3];const j=m[A+0],ne=m[A+1],le=m[A+2],se=m[A+3];if(y===0){n[a+0]=k,n[a+1]=N,n[a+2]=K,n[a+3]=$;return}if(y===1){n[a+0]=j,n[a+1]=ne,n[a+2]=le,n[a+3]=se;return}if($!==se||k!==j||N!==ne||K!==le){let re=1-y;const ye=k*j+N*ne+K*le+$*se,Be=ye>=0?1:-1,Ee=1-ye*ye;if(Ee>Number.EPSILON){const Fe=Math.sqrt(Ee),it=Math.atan2(Fe,ye*Be);re=Math.sin(re*it)/Fe,y=Math.sin(y*it)/Fe}const Me=y*Be;if(k=k*re+j*Me,N=N*re+ne*Me,K=K*re+le*Me,$=$*re+se*Me,re===1-y){const Fe=1/Math.sqrt(k*k+N*N+K*K+$*$);k*=Fe,N*=Fe,K*=Fe,$*=Fe}}n[a]=k,n[a+1]=N,n[a+2]=K,n[a+3]=$}static multiplyQuaternionsFlat(n,a,u,d,m,A){const y=u[d],k=u[d+1],N=u[d+2],K=u[d+3],$=m[A],j=m[A+1],ne=m[A+2],le=m[A+3];return n[a]=y*le+K*$+k*ne-N*j,n[a+1]=k*le+K*j+N*$-y*ne,n[a+2]=N*le+K*ne+y*j-k*$,n[a+3]=K*le-y*$-k*j-N*ne,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,a,u,d){return this._x=n,this._y=a,this._z=u,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,a){const u=n._x,d=n._y,m=n._z,A=n._order,y=Math.cos,k=Math.sin,N=y(u/2),K=y(d/2),$=y(m/2),j=k(u/2),ne=k(d/2),le=k(m/2);switch(A){case"XYZ":this._x=j*K*$+N*ne*le,this._y=N*ne*$-j*K*le,this._z=N*K*le+j*ne*$,this._w=N*K*$-j*ne*le;break;case"YXZ":this._x=j*K*$+N*ne*le,this._y=N*ne*$-j*K*le,this._z=N*K*le-j*ne*$,this._w=N*K*$+j*ne*le;break;case"ZXY":this._x=j*K*$-N*ne*le,this._y=N*ne*$+j*K*le,this._z=N*K*le+j*ne*$,this._w=N*K*$-j*ne*le;break;case"ZYX":this._x=j*K*$-N*ne*le,this._y=N*ne*$+j*K*le,this._z=N*K*le-j*ne*$,this._w=N*K*$+j*ne*le;break;case"YZX":this._x=j*K*$+N*ne*le,this._y=N*ne*$+j*K*le,this._z=N*K*le-j*ne*$,this._w=N*K*$-j*ne*le;break;case"XZY":this._x=j*K*$-N*ne*le,this._y=N*ne*$-j*K*le,this._z=N*K*le+j*ne*$,this._w=N*K*$+j*ne*le;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+A)}return a!==!1&&this._onChangeCallback(),this}setFromAxisAngle(n,a){const u=a/2,d=Math.sin(u);return this._x=n.x*d,this._y=n.y*d,this._z=n.z*d,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(n){const a=n.elements,u=a[0],d=a[4],m=a[8],A=a[1],y=a[5],k=a[9],N=a[2],K=a[6],$=a[10],j=u+y+$;if(j>0){const ne=.5/Math.sqrt(j+1);this._w=.25/ne,this._x=(K-k)*ne,this._y=(m-N)*ne,this._z=(A-d)*ne}else if(u>y&&u>$){const ne=2*Math.sqrt(1+u-y-$);this._w=(K-k)/ne,this._x=.25*ne,this._y=(d+A)/ne,this._z=(m+N)/ne}else if(y>$){const ne=2*Math.sqrt(1+y-u-$);this._w=(m-N)/ne,this._x=(d+A)/ne,this._y=.25*ne,this._z=(k+K)/ne}else{const ne=2*Math.sqrt(1+$-u-y);this._w=(A-d)/ne,this._x=(m+N)/ne,this._y=(k+K)/ne,this._z=.25*ne}return this._onChangeCallback(),this}setFromUnitVectors(n,a){let u=n.dot(a)+1;return u<Number.EPSILON?(u=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=u):(this._x=0,this._y=-n.z,this._z=n.y,this._w=u)):(this._x=n.y*a.z-n.z*a.y,this._y=n.z*a.x-n.x*a.z,this._z=n.x*a.y-n.y*a.x,this._w=u),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(aa(this.dot(n),-1,1)))}rotateTowards(n,a){const u=this.angleTo(n);if(u===0)return this;const d=Math.min(1,a/u);return this.slerp(n,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,a){const u=n._x,d=n._y,m=n._z,A=n._w,y=a._x,k=a._y,N=a._z,K=a._w;return this._x=u*K+A*y+d*N-m*k,this._y=d*K+A*k+m*y-u*N,this._z=m*K+A*N+u*k-d*y,this._w=A*K-u*y-d*k-m*N,this._onChangeCallback(),this}slerp(n,a){if(a===0)return this;if(a===1)return this.copy(n);const u=this._x,d=this._y,m=this._z,A=this._w;let y=A*n._w+u*n._x+d*n._y+m*n._z;if(y<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,y=-y):this.copy(n),y>=1)return this._w=A,this._x=u,this._y=d,this._z=m,this;const k=1-y*y;if(k<=Number.EPSILON){const ne=1-a;return this._w=ne*A+a*this._w,this._x=ne*u+a*this._x,this._y=ne*d+a*this._y,this._z=ne*m+a*this._z,this.normalize(),this._onChangeCallback(),this}const N=Math.sqrt(k),K=Math.atan2(N,y),$=Math.sin((1-a)*K)/N,j=Math.sin(a*K)/N;return this._w=A*$+this._w*j,this._x=u*$+this._x*j,this._y=d*$+this._y*j,this._z=m*$+this._z*j,this._onChangeCallback(),this}slerpQuaternions(n,a,u){return this.copy(n).slerp(a,u)}random(){const n=Math.random(),a=Math.sqrt(1-n),u=Math.sqrt(n),d=2*Math.PI*Math.random(),m=2*Math.PI*Math.random();return this.set(a*Math.cos(d),u*Math.sin(m),u*Math.cos(m),a*Math.sin(d))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,a=0){return this._x=n[a],this._y=n[a+1],this._z=n[a+2],this._w=n[a+3],this._onChangeCallback(),this}toArray(n=[],a=0){return n[a]=this._x,n[a+1]=this._y,n[a+2]=this._z,n[a+3]=this._w,n}fromBufferAttribute(n,a){return this._x=n.getX(a),this._y=n.getY(a),this._z=n.getZ(a),this._w=n.getW(a),this}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class tt{constructor(n=0,a=0,u=0){tt.prototype.isVector3=!0,this.x=n,this.y=a,this.z=u}set(n,a,u){return u===void 0&&(u=this.z),this.x=n,this.y=a,this.z=u,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setComponent(n,a){switch(n){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this}addVectors(n,a){return this.x=n.x+a.x,this.y=n.y+a.y,this.z=n.z+a.z,this}addScaledVector(n,a){return this.x+=n.x*a,this.y+=n.y*a,this.z+=n.z*a,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this}subVectors(n,a){return this.x=n.x-a.x,this.y=n.y-a.y,this.z=n.z-a.z,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this}multiplyVectors(n,a){return this.x=n.x*a.x,this.y=n.y*a.y,this.z=n.z*a.z,this}applyEuler(n){return this.applyQuaternion(Po.setFromEuler(n))}applyAxisAngle(n,a){return this.applyQuaternion(Po.setFromAxisAngle(n,a))}applyMatrix3(n){const a=this.x,u=this.y,d=this.z,m=n.elements;return this.x=m[0]*a+m[3]*u+m[6]*d,this.y=m[1]*a+m[4]*u+m[7]*d,this.z=m[2]*a+m[5]*u+m[8]*d,this}applyNormalMatrix(n){return this.applyMatrix3(n).normalize()}applyMatrix4(n){const a=this.x,u=this.y,d=this.z,m=n.elements,A=1/(m[3]*a+m[7]*u+m[11]*d+m[15]);return this.x=(m[0]*a+m[4]*u+m[8]*d+m[12])*A,this.y=(m[1]*a+m[5]*u+m[9]*d+m[13])*A,this.z=(m[2]*a+m[6]*u+m[10]*d+m[14])*A,this}applyQuaternion(n){const a=this.x,u=this.y,d=this.z,m=n.x,A=n.y,y=n.z,k=n.w,N=k*a+A*d-y*u,K=k*u+y*a-m*d,$=k*d+m*u-A*a,j=-m*a-A*u-y*d;return this.x=N*k+j*-m+K*-y-$*-A,this.y=K*k+j*-A+$*-m-N*-y,this.z=$*k+j*-y+N*-A-K*-m,this}project(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)}unproject(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)}transformDirection(n){const a=this.x,u=this.y,d=this.z,m=n.elements;return this.x=m[0]*a+m[4]*u+m[8]*d,this.y=m[1]*a+m[5]*u+m[9]*d,this.z=m[2]*a+m[6]*u+m[10]*d,this.normalize()}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this}divideScalar(n){return this.multiplyScalar(1/n)}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this}clamp(n,a){return this.x=Math.max(n.x,Math.min(a.x,this.x)),this.y=Math.max(n.y,Math.min(a.y,this.y)),this.z=Math.max(n.z,Math.min(a.z,this.z)),this}clampScalar(n,a){return this.x=Math.max(n,Math.min(a,this.x)),this.y=Math.max(n,Math.min(a,this.y)),this.z=Math.max(n,Math.min(a,this.z)),this}clampLength(n,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(n,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,a){return this.x+=(n.x-this.x)*a,this.y+=(n.y-this.y)*a,this.z+=(n.z-this.z)*a,this}lerpVectors(n,a,u){return this.x=n.x+(a.x-n.x)*u,this.y=n.y+(a.y-n.y)*u,this.z=n.z+(a.z-n.z)*u,this}cross(n){return this.crossVectors(this,n)}crossVectors(n,a){const u=n.x,d=n.y,m=n.z,A=a.x,y=a.y,k=a.z;return this.x=d*k-m*y,this.y=m*A-u*k,this.z=u*y-d*A,this}projectOnVector(n){const a=n.lengthSq();if(a===0)return this.set(0,0,0);const u=n.dot(this)/a;return this.copy(n).multiplyScalar(u)}projectOnPlane(n){return bh.copy(this).projectOnVector(n),this.sub(bh)}reflect(n){return this.sub(bh.copy(n).multiplyScalar(2*this.dot(n)))}angleTo(n){const a=Math.sqrt(this.lengthSq()*n.lengthSq());if(a===0)return Math.PI/2;const u=this.dot(n)/a;return Math.acos(aa(u,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const a=this.x-n.x,u=this.y-n.y,d=this.z-n.z;return a*a+u*u+d*d}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)}setFromSpherical(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)}setFromSphericalCoords(n,a,u){const d=Math.sin(a)*n;return this.x=d*Math.sin(u),this.y=Math.cos(a)*n,this.z=d*Math.cos(u),this}setFromCylindrical(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)}setFromCylindricalCoords(n,a,u){return this.x=n*Math.sin(a),this.y=u,this.z=n*Math.cos(a),this}setFromMatrixPosition(n){const a=n.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}setFromMatrixScale(n){const a=this.setFromMatrixColumn(n,0).length(),u=this.setFromMatrixColumn(n,1).length(),d=this.setFromMatrixColumn(n,2).length();return this.x=a,this.y=u,this.z=d,this}setFromMatrixColumn(n,a){return this.fromArray(n.elements,a*4)}setFromMatrix3Column(n,a){return this.fromArray(n.elements,a*3)}setFromEuler(n){return this.x=n._x,this.y=n._y,this.z=n._z,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z}fromArray(n,a=0){return this.x=n[a],this.y=n[a+1],this.z=n[a+2],this}toArray(n=[],a=0){return n[a]=this.x,n[a+1]=this.y,n[a+2]=this.z,n}fromBufferAttribute(n,a){return this.x=n.getX(a),this.y=n.getY(a),this.z=n.getZ(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const n=(Math.random()-.5)*2,a=Math.random()*Math.PI*2,u=Math.sqrt(1-n**2);return this.x=u*Math.cos(a),this.y=u*Math.sin(a),this.z=n,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const bh=new tt,Po=new la;class ss{constructor(n=new tt(1/0,1/0,1/0),a=new tt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=a}set(n,a){return this.min.copy(n),this.max.copy(a),this}setFromArray(n){let a=1/0,u=1/0,d=1/0,m=-1/0,A=-1/0,y=-1/0;for(let k=0,N=n.length;k<N;k+=3){const K=n[k],$=n[k+1],j=n[k+2];K<a&&(a=K),$<u&&(u=$),j<d&&(d=j),K>m&&(m=K),$>A&&(A=$),j>y&&(y=j)}return this.min.set(a,u,d),this.max.set(m,A,y),this}setFromBufferAttribute(n){let a=1/0,u=1/0,d=1/0,m=-1/0,A=-1/0,y=-1/0;for(let k=0,N=n.count;k<N;k++){const K=n.getX(k),$=n.getY(k),j=n.getZ(k);K<a&&(a=K),$<u&&(u=$),j<d&&(d=j),K>m&&(m=K),$>A&&(A=$),j>y&&(y=j)}return this.min.set(a,u,d),this.max.set(m,A,y),this}setFromPoints(n){this.makeEmpty();for(let a=0,u=n.length;a<u;a++)this.expandByPoint(n[a]);return this}setFromCenterAndSize(n,a){const u=Ac.copy(a).multiplyScalar(.5);return this.min.copy(n).sub(u),this.max.copy(n).add(u),this}setFromObject(n,a=!1){return this.makeEmpty(),this.expandByObject(n,a)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,a=!1){n.updateWorldMatrix(!1,!1);const u=n.geometry;if(u!==void 0)if(a&&u.attributes!=null&&u.attributes.position!==void 0){const m=u.attributes.position;for(let A=0,y=m.count;A<y;A++)Ac.fromBufferAttribute(m,A).applyMatrix4(n.matrixWorld),this.expandByPoint(Ac)}else u.boundingBox===null&&u.computeBoundingBox(),vd.copy(u.boundingBox),vd.applyMatrix4(n.matrixWorld),this.union(vd);const d=n.children;for(let m=0,A=d.length;m<A;m++)this.expandByObject(d[m],a);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,a){return a.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,Ac),Ac.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let a,u;return n.normal.x>0?(a=n.normal.x*this.min.x,u=n.normal.x*this.max.x):(a=n.normal.x*this.max.x,u=n.normal.x*this.min.x),n.normal.y>0?(a+=n.normal.y*this.min.y,u+=n.normal.y*this.max.y):(a+=n.normal.y*this.max.y,u+=n.normal.y*this.min.y),n.normal.z>0?(a+=n.normal.z*this.min.z,u+=n.normal.z*this.max.z):(a+=n.normal.z*this.max.z,u+=n.normal.z*this.min.z),a<=-n.constant&&u>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(Vc),vc.subVectors(this.max,Vc),Qo.subVectors(n.a,Vc),$a.subVectors(n.b,Vc),ds.subVectors(n.c,Vc),gl.subVectors($a,Qo),Dl.subVectors(ds,$a),ja.subVectors(Qo,ds);let a=[0,-gl.z,gl.y,0,-Dl.z,Dl.y,0,-ja.z,ja.y,gl.z,0,-gl.x,Dl.z,0,-Dl.x,ja.z,0,-ja.x,-gl.y,gl.x,0,-Dl.y,Dl.x,0,-ja.y,ja.x,0];return!xh(a,Qo,$a,ds,vc)||(a=[1,0,0,0,1,0,0,0,1],!xh(a,Qo,$a,ds,vc))?!1:(Nl.crossVectors(gl,Dl),a=[Nl.x,Nl.y,Nl.z],xh(a,Qo,$a,ds,vc))}clampPoint(n,a){return a.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return Ac.copy(n).clamp(this.min,this.max).sub(n).length()}getBoundingSphere(n){return this.getCenter(n.center),n.radius=this.getSize(Ac).length()*.5,n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(ca[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),ca[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),ca[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),ca[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),ca[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),ca[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),ca[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),ca[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(ca),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const ca=[new tt,new tt,new tt,new tt,new tt,new tt,new tt,new tt],Ac=new tt,vd=new ss,Qo=new tt,$a=new tt,ds=new tt,gl=new tt,Dl=new tt,ja=new tt,Vc=new tt,vc=new tt,Nl=new tt,Hs=new tt;function xh(x,n,a,u,d){for(let m=0,A=x.length-3;m<=A;m+=3){Hs.fromArray(x,m);const y=d.x*Math.abs(Hs.x)+d.y*Math.abs(Hs.y)+d.z*Math.abs(Hs.z),k=n.dot(Hs),N=a.dot(Hs),K=u.dot(Hs);if(Math.max(-Math.max(k,N,K),Math.min(k,N,K))>y)return!1}return!0}const fp=new ss,Ma=new tt,tc=new tt;class To{constructor(n=new tt,a=-1){this.center=n,this.radius=a}set(n,a){return this.center.copy(n),this.radius=a,this}setFromPoints(n,a){const u=this.center;a!==void 0?u.copy(a):fp.setFromPoints(n).getCenter(u);let d=0;for(let m=0,A=n.length;m<A;m++)d=Math.max(d,u.distanceToSquared(n[m]));return this.radius=Math.sqrt(d),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const a=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=a*a}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,a){const u=this.center.distanceToSquared(n);return a.copy(n),u>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;Ma.subVectors(n,this.center);const a=Ma.lengthSq();if(a>this.radius*this.radius){const u=Math.sqrt(a),d=(u-this.radius)*.5;this.center.addScaledVector(Ma,d/u),this.radius+=d}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(tc.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(Ma.copy(n.center).add(tc)),this.expandByPoint(Ma.copy(n.center).sub(tc))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Fl=new tt,Ch=new tt,Ti=new tt,hr=new tt,fr=new tt,Un=new tt,ts=new tt;class _a{constructor(n=new tt,a=new tt(0,0,-1)){this.origin=n,this.direction=a}set(n,a){return this.origin.copy(n),this.direction.copy(a),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,a){return a.copy(this.direction).multiplyScalar(n).add(this.origin)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,Fl)),this}closestPointToPoint(n,a){a.subVectors(n,this.origin);const u=a.dot(this.direction);return u<0?a.copy(this.origin):a.copy(this.direction).multiplyScalar(u).add(this.origin)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const a=Fl.subVectors(n,this.origin).dot(this.direction);return a<0?this.origin.distanceToSquared(n):(Fl.copy(this.direction).multiplyScalar(a).add(this.origin),Fl.distanceToSquared(n))}distanceSqToSegment(n,a,u,d){Ch.copy(n).add(a).multiplyScalar(.5),Ti.copy(a).sub(n).normalize(),hr.copy(this.origin).sub(Ch);const m=n.distanceTo(a)*.5,A=-this.direction.dot(Ti),y=hr.dot(this.direction),k=-hr.dot(Ti),N=hr.lengthSq(),K=Math.abs(1-A*A);let $,j,ne,le;if(K>0)if($=A*k-y,j=A*y-k,le=m*K,$>=0)if(j>=-le)if(j<=le){const se=1/K;$*=se,j*=se,ne=$*($+A*j+2*y)+j*(A*$+j+2*k)+N}else j=m,$=Math.max(0,-(A*j+y)),ne=-$*$+j*(j+2*k)+N;else j=-m,$=Math.max(0,-(A*j+y)),ne=-$*$+j*(j+2*k)+N;else j<=-le?($=Math.max(0,-(-A*m+y)),j=$>0?-m:Math.min(Math.max(-m,-k),m),ne=-$*$+j*(j+2*k)+N):j<=le?($=0,j=Math.min(Math.max(-m,-k),m),ne=j*(j+2*k)+N):($=Math.max(0,-(A*m+y)),j=$>0?m:Math.min(Math.max(-m,-k),m),ne=-$*$+j*(j+2*k)+N);else j=A>0?-m:m,$=Math.max(0,-(A*j+y)),ne=-$*$+j*(j+2*k)+N;return u&&u.copy(this.direction).multiplyScalar($).add(this.origin),d&&d.copy(Ti).multiplyScalar(j).add(Ch),ne}intersectSphere(n,a){Fl.subVectors(n.center,this.origin);const u=Fl.dot(this.direction),d=Fl.dot(Fl)-u*u,m=n.radius*n.radius;if(d>m)return null;const A=Math.sqrt(m-d),y=u-A,k=u+A;return y<0&&k<0?null:y<0?this.at(k,a):this.at(y,a)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const a=n.normal.dot(this.direction);if(a===0)return n.distanceToPoint(this.origin)===0?0:null;const u=-(this.origin.dot(n.normal)+n.constant)/a;return u>=0?u:null}intersectPlane(n,a){const u=this.distanceToPlane(n);return u===null?null:this.at(u,a)}intersectsPlane(n){const a=n.distanceToPoint(this.origin);return a===0||n.normal.dot(this.direction)*a<0}intersectBox(n,a){let u,d,m,A,y,k;const N=1/this.direction.x,K=1/this.direction.y,$=1/this.direction.z,j=this.origin;return N>=0?(u=(n.min.x-j.x)*N,d=(n.max.x-j.x)*N):(u=(n.max.x-j.x)*N,d=(n.min.x-j.x)*N),K>=0?(m=(n.min.y-j.y)*K,A=(n.max.y-j.y)*K):(m=(n.max.y-j.y)*K,A=(n.min.y-j.y)*K),u>A||m>d||((m>u||isNaN(u))&&(u=m),(A<d||isNaN(d))&&(d=A),$>=0?(y=(n.min.z-j.z)*$,k=(n.max.z-j.z)*$):(y=(n.max.z-j.z)*$,k=(n.min.z-j.z)*$),u>k||y>d)||((y>u||u!==u)&&(u=y),(k<d||d!==d)&&(d=k),d<0)?null:this.at(u>=0?u:d,a)}intersectsBox(n){return this.intersectBox(n,Fl)!==null}intersectTriangle(n,a,u,d,m){fr.subVectors(a,n),Un.subVectors(u,n),ts.crossVectors(fr,Un);let A=this.direction.dot(ts),y;if(A>0){if(d)return null;y=1}else if(A<0)y=-1,A=-A;else return null;hr.subVectors(this.origin,n);const k=y*this.direction.dot(Un.crossVectors(hr,Un));if(k<0)return null;const N=y*this.direction.dot(fr.cross(hr));if(N<0||k+N>A)return null;const K=-y*hr.dot(ts);return K<0?null:this.at(K/A,m)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ri{constructor(){Ri.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(n,a,u,d,m,A,y,k,N,K,$,j,ne,le,se,re){const ye=this.elements;return ye[0]=n,ye[4]=a,ye[8]=u,ye[12]=d,ye[1]=m,ye[5]=A,ye[9]=y,ye[13]=k,ye[2]=N,ye[6]=K,ye[10]=$,ye[14]=j,ye[3]=ne,ye[7]=le,ye[11]=se,ye[15]=re,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ri().fromArray(this.elements)}copy(n){const a=this.elements,u=n.elements;return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],this}copyPosition(n){const a=this.elements,u=n.elements;return a[12]=u[12],a[13]=u[13],a[14]=u[14],this}setFromMatrix3(n){const a=n.elements;return this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),this}extractBasis(n,a,u){return n.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),u.setFromMatrixColumn(this,2),this}makeBasis(n,a,u){return this.set(n.x,a.x,u.x,0,n.y,a.y,u.y,0,n.z,a.z,u.z,0,0,0,0,1),this}extractRotation(n){const a=this.elements,u=n.elements,d=1/Oo.setFromMatrixColumn(n,0).length(),m=1/Oo.setFromMatrixColumn(n,1).length(),A=1/Oo.setFromMatrixColumn(n,2).length();return a[0]=u[0]*d,a[1]=u[1]*d,a[2]=u[2]*d,a[3]=0,a[4]=u[4]*m,a[5]=u[5]*m,a[6]=u[6]*m,a[7]=0,a[8]=u[8]*A,a[9]=u[9]*A,a[10]=u[10]*A,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromEuler(n){const a=this.elements,u=n.x,d=n.y,m=n.z,A=Math.cos(u),y=Math.sin(u),k=Math.cos(d),N=Math.sin(d),K=Math.cos(m),$=Math.sin(m);if(n.order==="XYZ"){const j=A*K,ne=A*$,le=y*K,se=y*$;a[0]=k*K,a[4]=-k*$,a[8]=N,a[1]=ne+le*N,a[5]=j-se*N,a[9]=-y*k,a[2]=se-j*N,a[6]=le+ne*N,a[10]=A*k}else if(n.order==="YXZ"){const j=k*K,ne=k*$,le=N*K,se=N*$;a[0]=j+se*y,a[4]=le*y-ne,a[8]=A*N,a[1]=A*$,a[5]=A*K,a[9]=-y,a[2]=ne*y-le,a[6]=se+j*y,a[10]=A*k}else if(n.order==="ZXY"){const j=k*K,ne=k*$,le=N*K,se=N*$;a[0]=j-se*y,a[4]=-A*$,a[8]=le+ne*y,a[1]=ne+le*y,a[5]=A*K,a[9]=se-j*y,a[2]=-A*N,a[6]=y,a[10]=A*k}else if(n.order==="ZYX"){const j=A*K,ne=A*$,le=y*K,se=y*$;a[0]=k*K,a[4]=le*N-ne,a[8]=j*N+se,a[1]=k*$,a[5]=se*N+j,a[9]=ne*N-le,a[2]=-N,a[6]=y*k,a[10]=A*k}else if(n.order==="YZX"){const j=A*k,ne=A*N,le=y*k,se=y*N;a[0]=k*K,a[4]=se-j*$,a[8]=le*$+ne,a[1]=$,a[5]=A*K,a[9]=-y*K,a[2]=-N*K,a[6]=ne*$+le,a[10]=j-se*$}else if(n.order==="XZY"){const j=A*k,ne=A*N,le=y*k,se=y*N;a[0]=k*K,a[4]=-$,a[8]=N*K,a[1]=j*$+se,a[5]=A*K,a[9]=ne*$-le,a[2]=le*$-ne,a[6]=y*K,a[10]=se*$+j}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(n){return this.compose(Ra,n,zc)}lookAt(n,a,u){const d=this.elements;return Ar.subVectors(n,a),Ar.lengthSq()===0&&(Ar.z=1),Ar.normalize(),vo.crossVectors(u,Ar),vo.lengthSq()===0&&(Math.abs(u.z)===1?Ar.x+=1e-4:Ar.z+=1e-4,Ar.normalize(),vo.crossVectors(u,Ar)),vo.normalize(),Br.crossVectors(Ar,vo),d[0]=vo.x,d[4]=Br.x,d[8]=Ar.x,d[1]=vo.y,d[5]=Br.y,d[9]=Ar.y,d[2]=vo.z,d[6]=Br.z,d[10]=Ar.z,this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,a){const u=n.elements,d=a.elements,m=this.elements,A=u[0],y=u[4],k=u[8],N=u[12],K=u[1],$=u[5],j=u[9],ne=u[13],le=u[2],se=u[6],re=u[10],ye=u[14],Be=u[3],Ee=u[7],Me=u[11],Fe=u[15],it=d[0],yt=d[4],Le=d[8],at=d[12],mt=d[1],Dt=d[5],on=d[9],Ut=d[13],_t=d[2],Qt=d[6],bn=d[10],je=d[14],Zt=d[3],Qn=d[7],Kn=d[11],xi=d[15];return m[0]=A*it+y*mt+k*_t+N*Zt,m[4]=A*yt+y*Dt+k*Qt+N*Qn,m[8]=A*Le+y*on+k*bn+N*Kn,m[12]=A*at+y*Ut+k*je+N*xi,m[1]=K*it+$*mt+j*_t+ne*Zt,m[5]=K*yt+$*Dt+j*Qt+ne*Qn,m[9]=K*Le+$*on+j*bn+ne*Kn,m[13]=K*at+$*Ut+j*je+ne*xi,m[2]=le*it+se*mt+re*_t+ye*Zt,m[6]=le*yt+se*Dt+re*Qt+ye*Qn,m[10]=le*Le+se*on+re*bn+ye*Kn,m[14]=le*at+se*Ut+re*je+ye*xi,m[3]=Be*it+Ee*mt+Me*_t+Fe*Zt,m[7]=Be*yt+Ee*Dt+Me*Qt+Fe*Qn,m[11]=Be*Le+Ee*on+Me*bn+Fe*Kn,m[15]=Be*at+Ee*Ut+Me*je+Fe*xi,this}multiplyScalar(n){const a=this.elements;return a[0]*=n,a[4]*=n,a[8]*=n,a[12]*=n,a[1]*=n,a[5]*=n,a[9]*=n,a[13]*=n,a[2]*=n,a[6]*=n,a[10]*=n,a[14]*=n,a[3]*=n,a[7]*=n,a[11]*=n,a[15]*=n,this}determinant(){const n=this.elements,a=n[0],u=n[4],d=n[8],m=n[12],A=n[1],y=n[5],k=n[9],N=n[13],K=n[2],$=n[6],j=n[10],ne=n[14],le=n[3],se=n[7],re=n[11],ye=n[15];return le*(+m*k*$-d*N*$-m*y*j+u*N*j+d*y*ne-u*k*ne)+se*(+a*k*ne-a*N*j+m*A*j-d*A*ne+d*N*K-m*k*K)+re*(+a*N*$-a*y*ne-m*A*$+u*A*ne+m*y*K-u*N*K)+ye*(-d*y*K-a*k*$+a*y*j+d*A*$-u*A*j+u*k*K)}transpose(){const n=this.elements;let a;return a=n[1],n[1]=n[4],n[4]=a,a=n[2],n[2]=n[8],n[8]=a,a=n[6],n[6]=n[9],n[9]=a,a=n[3],n[3]=n[12],n[12]=a,a=n[7],n[7]=n[13],n[13]=a,a=n[11],n[11]=n[14],n[14]=a,this}setPosition(n,a,u){const d=this.elements;return n.isVector3?(d[12]=n.x,d[13]=n.y,d[14]=n.z):(d[12]=n,d[13]=a,d[14]=u),this}invert(){const n=this.elements,a=n[0],u=n[1],d=n[2],m=n[3],A=n[4],y=n[5],k=n[6],N=n[7],K=n[8],$=n[9],j=n[10],ne=n[11],le=n[12],se=n[13],re=n[14],ye=n[15],Be=$*re*N-se*j*N+se*k*ne-y*re*ne-$*k*ye+y*j*ye,Ee=le*j*N-K*re*N-le*k*ne+A*re*ne+K*k*ye-A*j*ye,Me=K*se*N-le*$*N+le*y*ne-A*se*ne-K*y*ye+A*$*ye,Fe=le*$*k-K*se*k-le*y*j+A*se*j+K*y*re-A*$*re,it=a*Be+u*Ee+d*Me+m*Fe;if(it===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const yt=1/it;return n[0]=Be*yt,n[1]=(se*j*m-$*re*m-se*d*ne+u*re*ne+$*d*ye-u*j*ye)*yt,n[2]=(y*re*m-se*k*m+se*d*N-u*re*N-y*d*ye+u*k*ye)*yt,n[3]=($*k*m-y*j*m-$*d*N+u*j*N+y*d*ne-u*k*ne)*yt,n[4]=Ee*yt,n[5]=(K*re*m-le*j*m+le*d*ne-a*re*ne-K*d*ye+a*j*ye)*yt,n[6]=(le*k*m-A*re*m-le*d*N+a*re*N+A*d*ye-a*k*ye)*yt,n[7]=(A*j*m-K*k*m+K*d*N-a*j*N-A*d*ne+a*k*ne)*yt,n[8]=Me*yt,n[9]=(le*$*m-K*se*m-le*u*ne+a*se*ne+K*u*ye-a*$*ye)*yt,n[10]=(A*se*m-le*y*m+le*u*N-a*se*N-A*u*ye+a*y*ye)*yt,n[11]=(K*y*m-A*$*m-K*u*N+a*$*N+A*u*ne-a*y*ne)*yt,n[12]=Fe*yt,n[13]=(K*se*d-le*$*d+le*u*j-a*se*j-K*u*re+a*$*re)*yt,n[14]=(le*y*d-A*se*d-le*u*k+a*se*k+A*u*re-a*y*re)*yt,n[15]=(A*$*d-K*y*d+K*u*k-a*$*k-A*u*j+a*y*j)*yt,this}scale(n){const a=this.elements,u=n.x,d=n.y,m=n.z;return a[0]*=u,a[4]*=d,a[8]*=m,a[1]*=u,a[5]*=d,a[9]*=m,a[2]*=u,a[6]*=d,a[10]*=m,a[3]*=u,a[7]*=d,a[11]*=m,this}getMaxScaleOnAxis(){const n=this.elements,a=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],u=n[4]*n[4]+n[5]*n[5]+n[6]*n[6],d=n[8]*n[8]+n[9]*n[9]+n[10]*n[10];return Math.sqrt(Math.max(a,u,d))}makeTranslation(n,a,u){return this.set(1,0,0,n,0,1,0,a,0,0,1,u,0,0,0,1),this}makeRotationX(n){const a=Math.cos(n),u=Math.sin(n);return this.set(1,0,0,0,0,a,-u,0,0,u,a,0,0,0,0,1),this}makeRotationY(n){const a=Math.cos(n),u=Math.sin(n);return this.set(a,0,u,0,0,1,0,0,-u,0,a,0,0,0,0,1),this}makeRotationZ(n){const a=Math.cos(n),u=Math.sin(n);return this.set(a,-u,0,0,u,a,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(n,a){const u=Math.cos(a),d=Math.sin(a),m=1-u,A=n.x,y=n.y,k=n.z,N=m*A,K=m*y;return this.set(N*A+u,N*y-d*k,N*k+d*y,0,N*y+d*k,K*y+u,K*k-d*A,0,N*k-d*y,K*k+d*A,m*k*k+u,0,0,0,0,1),this}makeScale(n,a,u){return this.set(n,0,0,0,0,a,0,0,0,0,u,0,0,0,0,1),this}makeShear(n,a,u,d,m,A){return this.set(1,u,m,0,n,1,A,0,a,d,1,0,0,0,0,1),this}compose(n,a,u){const d=this.elements,m=a._x,A=a._y,y=a._z,k=a._w,N=m+m,K=A+A,$=y+y,j=m*N,ne=m*K,le=m*$,se=A*K,re=A*$,ye=y*$,Be=k*N,Ee=k*K,Me=k*$,Fe=u.x,it=u.y,yt=u.z;return d[0]=(1-(se+ye))*Fe,d[1]=(ne+Me)*Fe,d[2]=(le-Ee)*Fe,d[3]=0,d[4]=(ne-Me)*it,d[5]=(1-(j+ye))*it,d[6]=(re+Be)*it,d[7]=0,d[8]=(le+Ee)*yt,d[9]=(re-Be)*yt,d[10]=(1-(j+se))*yt,d[11]=0,d[12]=n.x,d[13]=n.y,d[14]=n.z,d[15]=1,this}decompose(n,a,u){const d=this.elements;let m=Oo.set(d[0],d[1],d[2]).length();const A=Oo.set(d[4],d[5],d[6]).length(),y=Oo.set(d[8],d[9],d[10]).length();this.determinant()<0&&(m=-m),n.x=d[12],n.y=d[13],n.z=d[14],Er.copy(this);const N=1/m,K=1/A,$=1/y;return Er.elements[0]*=N,Er.elements[1]*=N,Er.elements[2]*=N,Er.elements[4]*=K,Er.elements[5]*=K,Er.elements[6]*=K,Er.elements[8]*=$,Er.elements[9]*=$,Er.elements[10]*=$,a.setFromRotationMatrix(Er),u.x=m,u.y=A,u.z=y,this}makePerspective(n,a,u,d,m,A){const y=this.elements,k=2*m/(a-n),N=2*m/(u-d),K=(a+n)/(a-n),$=(u+d)/(u-d),j=-(A+m)/(A-m),ne=-2*A*m/(A-m);return y[0]=k,y[4]=0,y[8]=K,y[12]=0,y[1]=0,y[5]=N,y[9]=$,y[13]=0,y[2]=0,y[6]=0,y[10]=j,y[14]=ne,y[3]=0,y[7]=0,y[11]=-1,y[15]=0,this}makeOrthographic(n,a,u,d,m,A){const y=this.elements,k=1/(a-n),N=1/(u-d),K=1/(A-m),$=(a+n)*k,j=(u+d)*N,ne=(A+m)*K;return y[0]=2*k,y[4]=0,y[8]=0,y[12]=-$,y[1]=0,y[5]=2*N,y[9]=0,y[13]=-j,y[2]=0,y[6]=0,y[10]=-2*K,y[14]=-ne,y[3]=0,y[7]=0,y[11]=0,y[15]=1,this}equals(n){const a=this.elements,u=n.elements;for(let d=0;d<16;d++)if(a[d]!==u[d])return!1;return!0}fromArray(n,a=0){for(let u=0;u<16;u++)this.elements[u]=n[u+a];return this}toArray(n=[],a=0){const u=this.elements;return n[a]=u[0],n[a+1]=u[1],n[a+2]=u[2],n[a+3]=u[3],n[a+4]=u[4],n[a+5]=u[5],n[a+6]=u[6],n[a+7]=u[7],n[a+8]=u[8],n[a+9]=u[9],n[a+10]=u[10],n[a+11]=u[11],n[a+12]=u[12],n[a+13]=u[13],n[a+14]=u[14],n[a+15]=u[15],n}}const Oo=new tt,Er=new Ri,Ra=new tt(0,0,0),zc=new tt(1,1,1),vo=new tt,Br=new tt,Ar=new tt,ks=new Ri,Zo=new la;class yo{constructor(n=0,a=0,u=0,d=yo.DefaultOrder){this.isEuler=!0,this._x=n,this._y=a,this._z=u,this._order=d}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get order(){return this._order}set order(n){this._order=n,this._onChangeCallback()}set(n,a,u,d=this._order){return this._x=n,this._y=a,this._z=u,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this}setFromRotationMatrix(n,a=this._order,u=!0){const d=n.elements,m=d[0],A=d[4],y=d[8],k=d[1],N=d[5],K=d[9],$=d[2],j=d[6],ne=d[10];switch(a){case"XYZ":this._y=Math.asin(aa(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(-K,ne),this._z=Math.atan2(-A,m)):(this._x=Math.atan2(j,N),this._z=0);break;case"YXZ":this._x=Math.asin(-aa(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(y,ne),this._z=Math.atan2(k,N)):(this._y=Math.atan2(-$,m),this._z=0);break;case"ZXY":this._x=Math.asin(aa(j,-1,1)),Math.abs(j)<.9999999?(this._y=Math.atan2(-$,ne),this._z=Math.atan2(-A,N)):(this._y=0,this._z=Math.atan2(k,m));break;case"ZYX":this._y=Math.asin(-aa($,-1,1)),Math.abs($)<.9999999?(this._x=Math.atan2(j,ne),this._z=Math.atan2(k,m)):(this._x=0,this._z=Math.atan2(-A,N));break;case"YZX":this._z=Math.asin(aa(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(-K,N),this._y=Math.atan2(-$,m)):(this._x=0,this._y=Math.atan2(y,ne));break;case"XZY":this._z=Math.asin(-aa(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(j,N),this._y=Math.atan2(y,m)):(this._x=Math.atan2(-K,ne),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a)}return this._order=a,u===!0&&this._onChangeCallback(),this}setFromQuaternion(n,a,u){return ks.makeRotationFromQuaternion(n),this.setFromRotationMatrix(ks,a,u)}setFromVector3(n,a=this._order){return this.set(n.x,n.y,n.z,a)}reorder(n){return Zo.setFromEuler(this),this.setFromQuaternion(Zo,n)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order}fromArray(n){return this._x=n[0],this._y=n[1],this._z=n[2],n[3]!==void 0&&(this._order=n[3]),this._onChangeCallback(),this}toArray(n=[],a=0){return n[a]=this._x,n[a+1]=this._y,n[a+2]=this._z,n[a+3]=this._order,n}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}yo.DefaultOrder="XYZ",yo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class jr{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}isEnabled(n){return(this.mask&(1<<n|0))!==0}}let Ks=0;const Wr=new tt,ps=new la,xa=new Ri,Ya=new tt,Wc=new tt,nc=new tt,ao=new la,Go=new tt(1,0,0),Pl=new tt(0,1,0),Tf=new tt(0,0,1),kg={type:"added"},Mf={type:"removed"};class as extends io{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ks++}),this.uuid=Za(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=as.DefaultUp.clone();const n=new tt,a=new yo,u=new la,d=new tt(1,1,1);function m(){u.setFromEuler(a,!1)}function A(){a.setFromQuaternion(u,void 0,!1)}a._onChange(m),u._onChange(A),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:u},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new Ri},normalMatrix:{value:new ro}}),this.matrix=new Ri,this.matrixWorld=new Ri,this.matrixAutoUpdate=as.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=as.DefaultMatrixWorldAutoUpdate,this.layers=new jr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(n){return this.quaternion.premultiply(n),this}setRotationFromAxisAngle(n,a){this.quaternion.setFromAxisAngle(n,a)}setRotationFromEuler(n){this.quaternion.setFromEuler(n,!0)}setRotationFromMatrix(n){this.quaternion.setFromRotationMatrix(n)}setRotationFromQuaternion(n){this.quaternion.copy(n)}rotateOnAxis(n,a){return ps.setFromAxisAngle(n,a),this.quaternion.multiply(ps),this}rotateOnWorldAxis(n,a){return ps.setFromAxisAngle(n,a),this.quaternion.premultiply(ps),this}rotateX(n){return this.rotateOnAxis(Go,n)}rotateY(n){return this.rotateOnAxis(Pl,n)}rotateZ(n){return this.rotateOnAxis(Tf,n)}translateOnAxis(n,a){return Wr.copy(n).applyQuaternion(this.quaternion),this.position.add(Wr.multiplyScalar(a)),this}translateX(n){return this.translateOnAxis(Go,n)}translateY(n){return this.translateOnAxis(Pl,n)}translateZ(n){return this.translateOnAxis(Tf,n)}localToWorld(n){return n.applyMatrix4(this.matrixWorld)}worldToLocal(n){return n.applyMatrix4(xa.copy(this.matrixWorld).invert())}lookAt(n,a,u){n.isVector3?Ya.copy(n):Ya.set(n,a,u);const d=this.parent;this.updateWorldMatrix(!0,!1),Wc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xa.lookAt(Wc,Ya,this.up):xa.lookAt(Ya,Wc,this.up),this.quaternion.setFromRotationMatrix(xa),d&&(xa.extractRotation(d.matrixWorld),ps.setFromRotationMatrix(xa),this.quaternion.premultiply(ps.invert()))}add(n){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(n.parent!==null&&n.parent.remove(n),n.parent=this,this.children.push(n),n.dispatchEvent(kg)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)}remove(n){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.remove(arguments[u]);return this}const a=this.children.indexOf(n);return a!==-1&&(n.parent=null,this.children.splice(a,1),n.dispatchEvent(Mf)),this}removeFromParent(){const n=this.parent;return n!==null&&n.remove(this),this}clear(){for(let n=0;n<this.children.length;n++){const a=this.children[n];a.parent=null,a.dispatchEvent(Mf)}return this.children.length=0,this}attach(n){return this.updateWorldMatrix(!0,!1),xa.copy(this.matrixWorld).invert(),n.parent!==null&&(n.parent.updateWorldMatrix(!0,!1),xa.multiply(n.parent.matrixWorld)),n.applyMatrix4(xa),this.add(n),n.updateWorldMatrix(!1,!0),this}getObjectById(n){return this.getObjectByProperty("id",n)}getObjectByName(n){return this.getObjectByProperty("name",n)}getObjectByProperty(n,a){if(this[n]===a)return this;for(let u=0,d=this.children.length;u<d;u++){const A=this.children[u].getObjectByProperty(n,a);if(A!==void 0)return A}}getWorldPosition(n){return this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wc,n,nc),n}getWorldScale(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wc,ao,n),n}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return n.set(a[8],a[9],a[10]).normalize()}raycast(){}traverse(n){n(this);const a=this.children;for(let u=0,d=a.length;u<d;u++)a[u].traverse(n)}traverseVisible(n){if(this.visible===!1)return;n(this);const a=this.children;for(let u=0,d=a.length;u<d;u++)a[u].traverseVisible(n)}traverseAncestors(n){const a=this.parent;a!==null&&(n(a),a.traverseAncestors(n))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0);const a=this.children;for(let u=0,d=a.length;u<d;u++){const m=a[u];(m.matrixWorldAutoUpdate===!0||n===!0)&&m.updateMatrixWorld(n)}}updateWorldMatrix(n,a){const u=this.parent;if(n===!0&&u!==null&&u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),a===!0){const d=this.children;for(let m=0,A=d.length;m<A;m++){const y=d[m];y.matrixWorldAutoUpdate===!0&&y.updateWorldMatrix(!1,!0)}}}toJSON(n){const a=n===void 0||typeof n=="string",u={};a&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},u.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const d={};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON()));function m(y,k){return y[k.uuid]===void 0&&(y[k.uuid]=k.toJSON(n)),k.uuid}if(this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(d.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=m(n.geometries,this.geometry);const y=this.geometry.parameters;if(y!==void 0&&y.shapes!==void 0){const k=y.shapes;if(Array.isArray(k))for(let N=0,K=k.length;N<K;N++){const $=k[N];m(n.shapes,$)}else m(n.shapes,k)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(m(n.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const y=[];for(let k=0,N=this.material.length;k<N;k++)y.push(m(n.materials,this.material[k]));d.material=y}else d.material=m(n.materials,this.material);if(this.children.length>0){d.children=[];for(let y=0;y<this.children.length;y++)d.children.push(this.children[y].toJSON(n).object)}if(this.animations.length>0){d.animations=[];for(let y=0;y<this.animations.length;y++){const k=this.animations[y];d.animations.push(m(n.animations,k))}}if(a){const y=A(n.geometries),k=A(n.materials),N=A(n.textures),K=A(n.images),$=A(n.shapes),j=A(n.skeletons),ne=A(n.animations),le=A(n.nodes);y.length>0&&(u.geometries=y),k.length>0&&(u.materials=k),N.length>0&&(u.textures=N),K.length>0&&(u.images=K),$.length>0&&(u.shapes=$),j.length>0&&(u.skeletons=j),ne.length>0&&(u.animations=ne),le.length>0&&(u.nodes=le)}return u.object=d,u;function A(y){const k=[];for(const N in y){const K=y[N];delete K.metadata,k.push(K)}return k}}clone(n){return new this.constructor().copy(this,n)}copy(n,a=!0){if(this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=n.matrixWorldAutoUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.userData=JSON.parse(JSON.stringify(n.userData)),a===!0)for(let u=0;u<n.children.length;u++){const d=n.children[u];this.add(d.clone())}return this}}as.DefaultUp=new tt(0,1,0),as.DefaultMatrixAutoUpdate=!0,as.DefaultMatrixWorldAutoUpdate=!0;const Al=new tt,ga=new tt,bo=new tt,$o=new tt,Hc=new tt,yd=new tt,bd=new tt,_f=new tt,xd=new tt,wh=new tt;class Ss{constructor(n=new tt,a=new tt,u=new tt){this.a=n,this.b=a,this.c=u}static getNormal(n,a,u,d){d.subVectors(u,a),Al.subVectors(n,a),d.cross(Al);const m=d.lengthSq();return m>0?d.multiplyScalar(1/Math.sqrt(m)):d.set(0,0,0)}static getBarycoord(n,a,u,d,m){Al.subVectors(d,a),ga.subVectors(u,a),bo.subVectors(n,a);const A=Al.dot(Al),y=Al.dot(ga),k=Al.dot(bo),N=ga.dot(ga),K=ga.dot(bo),$=A*N-y*y;if($===0)return m.set(-2,-1,-1);const j=1/$,ne=(N*k-y*K)*j,le=(A*K-y*k)*j;return m.set(1-ne-le,le,ne)}static containsPoint(n,a,u,d){return this.getBarycoord(n,a,u,d,$o),$o.x>=0&&$o.y>=0&&$o.x+$o.y<=1}static getUV(n,a,u,d,m,A,y,k){return this.getBarycoord(n,a,u,d,$o),k.set(0,0),k.addScaledVector(m,$o.x),k.addScaledVector(A,$o.y),k.addScaledVector(y,$o.z),k}static isFrontFacing(n,a,u,d){return Al.subVectors(u,a),ga.subVectors(n,a),Al.cross(ga).dot(d)<0}set(n,a,u){return this.a.copy(n),this.b.copy(a),this.c.copy(u),this}setFromPointsAndIndices(n,a,u,d){return this.a.copy(n[a]),this.b.copy(n[u]),this.c.copy(n[d]),this}setFromAttributeAndIndices(n,a,u,d){return this.a.fromBufferAttribute(n,a),this.b.fromBufferAttribute(n,u),this.c.fromBufferAttribute(n,d),this}clone(){return new this.constructor().copy(this)}copy(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this}getArea(){return Al.subVectors(this.c,this.b),ga.subVectors(this.a,this.b),Al.cross(ga).length()*.5}getMidpoint(n){return n.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)}getNormal(n){return Ss.getNormal(this.a,this.b,this.c,n)}getPlane(n){return n.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(n,a){return Ss.getBarycoord(n,this.a,this.b,this.c,a)}getUV(n,a,u,d,m){return Ss.getUV(n,this.a,this.b,this.c,a,u,d,m)}containsPoint(n){return Ss.containsPoint(n,this.a,this.b,this.c)}isFrontFacing(n){return Ss.isFrontFacing(this.a,this.b,this.c,n)}intersectsBox(n){return n.intersectsTriangle(this)}closestPointToPoint(n,a){const u=this.a,d=this.b,m=this.c;let A,y;Hc.subVectors(d,u),yd.subVectors(m,u),_f.subVectors(n,u);const k=Hc.dot(_f),N=yd.dot(_f);if(k<=0&&N<=0)return a.copy(u);xd.subVectors(n,d);const K=Hc.dot(xd),$=yd.dot(xd);if(K>=0&&$<=K)return a.copy(d);const j=k*$-K*N;if(j<=0&&k>=0&&K<=0)return A=k/(k-K),a.copy(u).addScaledVector(Hc,A);wh.subVectors(n,m);const ne=Hc.dot(wh),le=yd.dot(wh);if(le>=0&&ne<=le)return a.copy(m);const se=ne*N-k*le;if(se<=0&&N>=0&&le<=0)return y=N/(N-le),a.copy(u).addScaledVector(yd,y);const re=K*le-ne*$;if(re<=0&&$-K>=0&&ne-le>=0)return bd.subVectors(m,d),y=($-K)/($-K+(ne-le)),a.copy(d).addScaledVector(bd,y);const ye=1/(re+se+j);return A=se*ye,y=j*ye,a.copy(u).addScaledVector(Hc,A).addScaledVector(yd,y)}equals(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)}}let ic=0;class Ba extends io{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ic++}),this.uuid=Za(),this.name="",this.type="Material",this.blending=W,this.side=D,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ze,this.blendDst=et,this.blendEquation=Ae,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ai,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=oh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Fo,this.stencilZFail=Fo,this.stencilZPass=Fo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const a in n){const u=n[a];if(u===void 0){console.warn("THREE.Material: '"+a+"' parameter is undefined.");continue}const d=this[a];if(d===void 0){console.warn("THREE."+this.type+": '"+a+"' is not a property of this material.");continue}d&&d.isColor?d.set(u):d&&d.isVector3&&u&&u.isVector3?d.copy(u):this[a]=u}}toJSON(n){const a=n===void 0||typeof n=="string";a&&(n={textures:{},images:{}});const u={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.color&&this.color.isColor&&(u.color=this.color.getHex()),this.roughness!==void 0&&(u.roughness=this.roughness),this.metalness!==void 0&&(u.metalness=this.metalness),this.sheen!==void 0&&(u.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(u.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(u.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(u.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(u.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(u.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(u.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(u.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(u.shininess=this.shininess),this.clearcoat!==void 0&&(u.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(u.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(u.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(u.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,u.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(u.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(u.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(u.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(u.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(u.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(u.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(u.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(u.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(u.lightMap=this.lightMap.toJSON(n).uuid,u.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(u.aoMap=this.aoMap.toJSON(n).uuid,u.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(u.bumpMap=this.bumpMap.toJSON(n).uuid,u.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(u.normalMap=this.normalMap.toJSON(n).uuid,u.normalMapType=this.normalMapType,u.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(u.displacementMap=this.displacementMap.toJSON(n).uuid,u.displacementScale=this.displacementScale,u.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(u.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(u.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(u.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(u.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(u.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(u.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(u.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(u.combine=this.combine)),this.envMapIntensity!==void 0&&(u.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(u.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(u.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(u.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(u.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(u.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(u.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(u.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(u.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(u.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(u.size=this.size),this.shadowSide!==null&&(u.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(u.sizeAttenuation=this.sizeAttenuation),this.blending!==W&&(u.blending=this.blending),this.side!==D&&(u.side=this.side),this.vertexColors&&(u.vertexColors=!0),this.opacity<1&&(u.opacity=this.opacity),this.transparent===!0&&(u.transparent=this.transparent),u.depthFunc=this.depthFunc,u.depthTest=this.depthTest,u.depthWrite=this.depthWrite,u.colorWrite=this.colorWrite,u.stencilWrite=this.stencilWrite,u.stencilWriteMask=this.stencilWriteMask,u.stencilFunc=this.stencilFunc,u.stencilRef=this.stencilRef,u.stencilFuncMask=this.stencilFuncMask,u.stencilFail=this.stencilFail,u.stencilZFail=this.stencilZFail,u.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(u.rotation=this.rotation),this.polygonOffset===!0&&(u.polygonOffset=!0),this.polygonOffsetFactor!==0&&(u.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(u.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(u.linewidth=this.linewidth),this.dashSize!==void 0&&(u.dashSize=this.dashSize),this.gapSize!==void 0&&(u.gapSize=this.gapSize),this.scale!==void 0&&(u.scale=this.scale),this.dithering===!0&&(u.dithering=!0),this.alphaTest>0&&(u.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(u.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(u.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(u.wireframe=this.wireframe),this.wireframeLinewidth>1&&(u.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(u.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(u.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(u.flatShading=this.flatShading),this.visible===!1&&(u.visible=!1),this.toneMapped===!1&&(u.toneMapped=!1),this.fog===!1&&(u.fog=!1),JSON.stringify(this.userData)!=="{}"&&(u.userData=this.userData);function d(m){const A=[];for(const y in m){const k=m[y];delete k.metadata,A.push(k)}return A}if(a){const m=d(n.textures),A=d(n.images);m.length>0&&(u.textures=m),A.length>0&&(u.images=A)}return u}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const a=n.clippingPlanes;let u=null;if(a!==null){const d=a.length;u=new Array(d);for(let m=0;m!==d;++m)u[m]=a[m].clone()}return this.clippingPlanes=u,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}}class _u extends Ba{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Si(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ye,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}const Wa=new tt,ua=new kn;class Vt{constructor(n,a,u){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=a,this.count=n!==void 0?n.length/a:0,this.normalized=u===!0,this.usage=Yl,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this}copyAt(n,a,u){n*=this.itemSize,u*=a.itemSize;for(let d=0,m=this.itemSize;d<m;d++)this.array[n+d]=a.array[u+d];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let a=0,u=this.count;a<u;a++)ua.fromBufferAttribute(this,a),ua.applyMatrix3(n),this.setXY(a,ua.x,ua.y);else if(this.itemSize===3)for(let a=0,u=this.count;a<u;a++)Wa.fromBufferAttribute(this,a),Wa.applyMatrix3(n),this.setXYZ(a,Wa.x,Wa.y,Wa.z);return this}applyMatrix4(n){for(let a=0,u=this.count;a<u;a++)Wa.fromBufferAttribute(this,a),Wa.applyMatrix4(n),this.setXYZ(a,Wa.x,Wa.y,Wa.z);return this}applyNormalMatrix(n){for(let a=0,u=this.count;a<u;a++)Wa.fromBufferAttribute(this,a),Wa.applyNormalMatrix(n),this.setXYZ(a,Wa.x,Wa.y,Wa.z);return this}transformDirection(n){for(let a=0,u=this.count;a<u;a++)Wa.fromBufferAttribute(this,a),Wa.transformDirection(n),this.setXYZ(a,Wa.x,Wa.y,Wa.z);return this}set(n,a=0){return this.array.set(n,a),this}getX(n){let a=this.array[n*this.itemSize];return this.normalized&&(a=kl(a,this.array)),a}setX(n,a){return this.normalized&&(a=hs(a,this.array)),this.array[n*this.itemSize]=a,this}getY(n){let a=this.array[n*this.itemSize+1];return this.normalized&&(a=kl(a,this.array)),a}setY(n,a){return this.normalized&&(a=hs(a,this.array)),this.array[n*this.itemSize+1]=a,this}getZ(n){let a=this.array[n*this.itemSize+2];return this.normalized&&(a=kl(a,this.array)),a}setZ(n,a){return this.normalized&&(a=hs(a,this.array)),this.array[n*this.itemSize+2]=a,this}getW(n){let a=this.array[n*this.itemSize+3];return this.normalized&&(a=kl(a,this.array)),a}setW(n,a){return this.normalized&&(a=hs(a,this.array)),this.array[n*this.itemSize+3]=a,this}setXY(n,a,u){return n*=this.itemSize,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array)),this.array[n+0]=a,this.array[n+1]=u,this}setXYZ(n,a,u,d){return n*=this.itemSize,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array),d=hs(d,this.array)),this.array[n+0]=a,this.array[n+1]=u,this.array[n+2]=d,this}setXYZW(n,a,u,d,m){return n*=this.itemSize,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array),d=hs(d,this.array),m=hs(m,this.array)),this.array[n+0]=a,this.array[n+1]=u,this.array[n+2]=d,this.array[n+3]=m,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==Yl&&(n.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(n.updateRange=this.updateRange),n}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Rf extends Vt{constructor(n,a,u){super(new Int8Array(n),a,u)}}class JA extends Vt{constructor(n,a,u){super(new Uint8Array(n),a,u)}}class Lg extends Vt{constructor(n,a,u){super(new Uint8ClampedArray(n),a,u)}}class Dg extends Vt{constructor(n,a,u){super(new Int16Array(n),a,u)}}class mp extends Vt{constructor(n,a,u){super(new Uint16Array(n),a,u)}}class Ng extends Vt{constructor(n,a,u){super(new Int32Array(n),a,u)}}class Fg extends Vt{constructor(n,a,u){super(new Uint32Array(n),a,u)}}class Uo extends Vt{constructor(n,a,u){super(new Uint16Array(n),a,u),this.isFloat16BufferAttribute=!0}}class Fi extends Vt{constructor(n,a,u){super(new Float32Array(n),a,u)}}class Ca extends Vt{constructor(n,a,u){super(new Float64Array(n),a,u)}}let qA=0;const vl=new Ri,Pg=new as,Ru=new tt,jo=new ss,yc=new ss,oo=new tt;class Or extends io{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qA++}),this.uuid=Za(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(n){return Array.isArray(n)?this.index=new(pp(n)?Fg:mp)(n,1):this.index=n,this}getAttribute(n){return this.attributes[n]}setAttribute(n,a){return this.attributes[n]=a,this}deleteAttribute(n){return delete this.attributes[n],this}hasAttribute(n){return this.attributes[n]!==void 0}addGroup(n,a,u=0){this.groups.push({start:n,count:a,materialIndex:u})}clearGroups(){this.groups=[]}setDrawRange(n,a){this.drawRange.start=n,this.drawRange.count=a}applyMatrix4(n){const a=this.attributes.position;a!==void 0&&(a.applyMatrix4(n),a.needsUpdate=!0);const u=this.attributes.normal;if(u!==void 0){const m=new ro().getNormalMatrix(n);u.applyNormalMatrix(m),u.needsUpdate=!0}const d=this.attributes.tangent;return d!==void 0&&(d.transformDirection(n),d.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(n){return vl.makeRotationFromQuaternion(n),this.applyMatrix4(vl),this}rotateX(n){return vl.makeRotationX(n),this.applyMatrix4(vl),this}rotateY(n){return vl.makeRotationY(n),this.applyMatrix4(vl),this}rotateZ(n){return vl.makeRotationZ(n),this.applyMatrix4(vl),this}translate(n,a,u){return vl.makeTranslation(n,a,u),this.applyMatrix4(vl),this}scale(n,a,u){return vl.makeScale(n,a,u),this.applyMatrix4(vl),this}lookAt(n){return Pg.lookAt(n),Pg.updateMatrix(),this.applyMatrix4(Pg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ru).negate(),this.translate(Ru.x,Ru.y,Ru.z),this}setFromPoints(n){const a=[];for(let u=0,d=n.length;u<d;u++){const m=n[u];a.push(m.x,m.y,m.z||0)}return this.setAttribute("position",new Fi(a,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ss);const n=this.attributes.position,a=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new tt(-1/0,-1/0,-1/0),new tt(1/0,1/0,1/0));return}if(n!==void 0){if(this.boundingBox.setFromBufferAttribute(n),a)for(let u=0,d=a.length;u<d;u++){const m=a[u];jo.setFromBufferAttribute(m),this.morphTargetsRelative?(oo.addVectors(this.boundingBox.min,jo.min),this.boundingBox.expandByPoint(oo),oo.addVectors(this.boundingBox.max,jo.max),this.boundingBox.expandByPoint(oo)):(this.boundingBox.expandByPoint(jo.min),this.boundingBox.expandByPoint(jo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new To);const n=this.attributes.position,a=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new tt,1/0);return}if(n){const u=this.boundingSphere.center;if(jo.setFromBufferAttribute(n),a)for(let m=0,A=a.length;m<A;m++){const y=a[m];yc.setFromBufferAttribute(y),this.morphTargetsRelative?(oo.addVectors(jo.min,yc.min),jo.expandByPoint(oo),oo.addVectors(jo.max,yc.max),jo.expandByPoint(oo)):(jo.expandByPoint(yc.min),jo.expandByPoint(yc.max))}jo.getCenter(u);let d=0;for(let m=0,A=n.count;m<A;m++)oo.fromBufferAttribute(n,m),d=Math.max(d,u.distanceToSquared(oo));if(a)for(let m=0,A=a.length;m<A;m++){const y=a[m],k=this.morphTargetsRelative;for(let N=0,K=y.count;N<K;N++)oo.fromBufferAttribute(y,N),k&&(Ru.fromBufferAttribute(n,N),oo.add(Ru)),d=Math.max(d,u.distanceToSquared(oo))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const n=this.index,a=this.attributes;if(n===null||a.position===void 0||a.normal===void 0||a.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const u=n.array,d=a.position.array,m=a.normal.array,A=a.uv.array,y=d.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Vt(new Float32Array(4*y),4));const k=this.getAttribute("tangent").array,N=[],K=[];for(let mt=0;mt<y;mt++)N[mt]=new tt,K[mt]=new tt;const $=new tt,j=new tt,ne=new tt,le=new kn,se=new kn,re=new kn,ye=new tt,Be=new tt;function Ee(mt,Dt,on){$.fromArray(d,mt*3),j.fromArray(d,Dt*3),ne.fromArray(d,on*3),le.fromArray(A,mt*2),se.fromArray(A,Dt*2),re.fromArray(A,on*2),j.sub($),ne.sub($),se.sub(le),re.sub(le);const Ut=1/(se.x*re.y-re.x*se.y);isFinite(Ut)&&(ye.copy(j).multiplyScalar(re.y).addScaledVector(ne,-se.y).multiplyScalar(Ut),Be.copy(ne).multiplyScalar(se.x).addScaledVector(j,-re.x).multiplyScalar(Ut),N[mt].add(ye),N[Dt].add(ye),N[on].add(ye),K[mt].add(Be),K[Dt].add(Be),K[on].add(Be))}let Me=this.groups;Me.length===0&&(Me=[{start:0,count:u.length}]);for(let mt=0,Dt=Me.length;mt<Dt;++mt){const on=Me[mt],Ut=on.start,_t=on.count;for(let Qt=Ut,bn=Ut+_t;Qt<bn;Qt+=3)Ee(u[Qt+0],u[Qt+1],u[Qt+2])}const Fe=new tt,it=new tt,yt=new tt,Le=new tt;function at(mt){yt.fromArray(m,mt*3),Le.copy(yt);const Dt=N[mt];Fe.copy(Dt),Fe.sub(yt.multiplyScalar(yt.dot(Dt))).normalize(),it.crossVectors(Le,Dt);const Ut=it.dot(K[mt])<0?-1:1;k[mt*4]=Fe.x,k[mt*4+1]=Fe.y,k[mt*4+2]=Fe.z,k[mt*4+3]=Ut}for(let mt=0,Dt=Me.length;mt<Dt;++mt){const on=Me[mt],Ut=on.start,_t=on.count;for(let Qt=Ut,bn=Ut+_t;Qt<bn;Qt+=3)at(u[Qt+0]),at(u[Qt+1]),at(u[Qt+2])}}computeVertexNormals(){const n=this.index,a=this.getAttribute("position");if(a!==void 0){let u=this.getAttribute("normal");if(u===void 0)u=new Vt(new Float32Array(a.count*3),3),this.setAttribute("normal",u);else for(let j=0,ne=u.count;j<ne;j++)u.setXYZ(j,0,0,0);const d=new tt,m=new tt,A=new tt,y=new tt,k=new tt,N=new tt,K=new tt,$=new tt;if(n)for(let j=0,ne=n.count;j<ne;j+=3){const le=n.getX(j+0),se=n.getX(j+1),re=n.getX(j+2);d.fromBufferAttribute(a,le),m.fromBufferAttribute(a,se),A.fromBufferAttribute(a,re),K.subVectors(A,m),$.subVectors(d,m),K.cross($),y.fromBufferAttribute(u,le),k.fromBufferAttribute(u,se),N.fromBufferAttribute(u,re),y.add(K),k.add(K),N.add(K),u.setXYZ(le,y.x,y.y,y.z),u.setXYZ(se,k.x,k.y,k.z),u.setXYZ(re,N.x,N.y,N.z)}else for(let j=0,ne=a.count;j<ne;j+=3)d.fromBufferAttribute(a,j+0),m.fromBufferAttribute(a,j+1),A.fromBufferAttribute(a,j+2),K.subVectors(A,m),$.subVectors(d,m),K.cross($),u.setXYZ(j+0,K.x,K.y,K.z),u.setXYZ(j+1,K.x,K.y,K.z),u.setXYZ(j+2,K.x,K.y,K.z);this.normalizeNormals(),u.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const n=this.attributes.normal;for(let a=0,u=n.count;a<u;a++)oo.fromBufferAttribute(n,a),oo.normalize(),n.setXYZ(a,oo.x,oo.y,oo.z)}toNonIndexed(){function n(y,k){const N=y.array,K=y.itemSize,$=y.normalized,j=new N.constructor(k.length*K);let ne=0,le=0;for(let se=0,re=k.length;se<re;se++){y.isInterleavedBufferAttribute?ne=k[se]*y.data.stride+y.offset:ne=k[se]*K;for(let ye=0;ye<K;ye++)j[le++]=N[ne++]}return new Vt(j,K,$)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const a=new Or,u=this.index.array,d=this.attributes;for(const y in d){const k=d[y],N=n(k,u);a.setAttribute(y,N)}const m=this.morphAttributes;for(const y in m){const k=[],N=m[y];for(let K=0,$=N.length;K<$;K++){const j=N[K],ne=n(j,u);k.push(ne)}a.morphAttributes[y]=k}a.morphTargetsRelative=this.morphTargetsRelative;const A=this.groups;for(let y=0,k=A.length;y<k;y++){const N=A[y];a.addGroup(N.start,N.count,N.materialIndex)}return a}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),this.parameters!==void 0){const k=this.parameters;for(const N in k)k[N]!==void 0&&(n[N]=k[N]);return n}n.data={attributes:{}};const a=this.index;a!==null&&(n.data.index={type:a.array.constructor.name,array:Array.prototype.slice.call(a.array)});const u=this.attributes;for(const k in u){const N=u[k];n.data.attributes[k]=N.toJSON(n.data)}const d={};let m=!1;for(const k in this.morphAttributes){const N=this.morphAttributes[k],K=[];for(let $=0,j=N.length;$<j;$++){const ne=N[$];K.push(ne.toJSON(n.data))}K.length>0&&(d[k]=K,m=!0)}m&&(n.data.morphAttributes=d,n.data.morphTargetsRelative=this.morphTargetsRelative);const A=this.groups;A.length>0&&(n.data.groups=JSON.parse(JSON.stringify(A)));const y=this.boundingSphere;return y!==null&&(n.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),n}clone(){return new this.constructor().copy(this)}copy(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const a={};this.name=n.name;const u=n.index;u!==null&&this.setIndex(u.clone(a));const d=n.attributes;for(const N in d){const K=d[N];this.setAttribute(N,K.clone(a))}const m=n.morphAttributes;for(const N in m){const K=[],$=m[N];for(let j=0,ne=$.length;j<ne;j++)K.push($[j].clone(a));this.morphAttributes[N]=K}this.morphTargetsRelative=n.morphTargetsRelative;const A=n.groups;for(let N=0,K=A.length;N<K;N++){const $=A[N];this.addGroup($.start,$.count,$.materialIndex)}const y=n.boundingBox;y!==null&&(this.boundingBox=y.clone());const k=n.boundingSphere;return k!==null&&(this.boundingSphere=k.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,n.parameters!==void 0&&(this.parameters=Object.assign({},n.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Et=new Ri,Cd=new _a,Og=new To,Kc=new tt,Xc=new tt,ka=new tt,Eh=new tt,Bf=new tt,kf=new tt,ut=new tt,gp=new tt,Lf=new tt,Bt=new kn,Df=new kn,Qc=new kn,Ih=new tt,Vo=new tt;class lo extends as{constructor(n=new Or,a=new _u){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=a,this.updateMorphTargets()}copy(n,a){return super.copy(n,a),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=n.material,this.geometry=n.geometry,this}updateMorphTargets(){const a=this.geometry.morphAttributes,u=Object.keys(a);if(u.length>0){const d=a[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,A=d.length;m<A;m++){const y=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[y]=m}}}}raycast(n,a){const u=this.geometry,d=this.material,m=this.matrixWorld;if(d===void 0||(u.boundingSphere===null&&u.computeBoundingSphere(),Og.copy(u.boundingSphere),Og.applyMatrix4(m),n.ray.intersectsSphere(Og)===!1)||(Et.copy(m).invert(),Cd.copy(n.ray).applyMatrix4(Et),u.boundingBox!==null&&Cd.intersectsBox(u.boundingBox)===!1))return;let A;const y=u.index,k=u.attributes.position,N=u.morphAttributes.position,K=u.morphTargetsRelative,$=u.attributes.uv,j=u.attributes.uv2,ne=u.groups,le=u.drawRange;if(y!==null)if(Array.isArray(d))for(let se=0,re=ne.length;se<re;se++){const ye=ne[se],Be=d[ye.materialIndex],Ee=Math.max(ye.start,le.start),Me=Math.min(y.count,Math.min(ye.start+ye.count,le.start+le.count));for(let Fe=Ee,it=Me;Fe<it;Fe+=3){const yt=y.getX(Fe),Le=y.getX(Fe+1),at=y.getX(Fe+2);A=Nf(this,Be,n,Cd,k,N,K,$,j,yt,Le,at),A&&(A.faceIndex=Math.floor(Fe/3),A.face.materialIndex=ye.materialIndex,a.push(A))}}else{const se=Math.max(0,le.start),re=Math.min(y.count,le.start+le.count);for(let ye=se,Be=re;ye<Be;ye+=3){const Ee=y.getX(ye),Me=y.getX(ye+1),Fe=y.getX(ye+2);A=Nf(this,d,n,Cd,k,N,K,$,j,Ee,Me,Fe),A&&(A.faceIndex=Math.floor(ye/3),a.push(A))}}else if(k!==void 0)if(Array.isArray(d))for(let se=0,re=ne.length;se<re;se++){const ye=ne[se],Be=d[ye.materialIndex],Ee=Math.max(ye.start,le.start),Me=Math.min(k.count,Math.min(ye.start+ye.count,le.start+le.count));for(let Fe=Ee,it=Me;Fe<it;Fe+=3){const yt=Fe,Le=Fe+1,at=Fe+2;A=Nf(this,Be,n,Cd,k,N,K,$,j,yt,Le,at),A&&(A.faceIndex=Math.floor(Fe/3),A.face.materialIndex=ye.materialIndex,a.push(A))}}else{const se=Math.max(0,le.start),re=Math.min(k.count,le.start+le.count);for(let ye=se,Be=re;ye<Be;ye+=3){const Ee=ye,Me=ye+1,Fe=ye+2;A=Nf(this,d,n,Cd,k,N,K,$,j,Ee,Me,Fe),A&&(A.faceIndex=Math.floor(ye/3),a.push(A))}}}}function e1(x,n,a,u,d,m,A,y){let k;if(n.side===V?k=u.intersectTriangle(A,m,d,!0,y):k=u.intersectTriangle(d,m,A,n.side!==J,y),k===null)return null;Vo.copy(y),Vo.applyMatrix4(x.matrixWorld);const N=a.ray.origin.distanceTo(Vo);return N<a.near||N>a.far?null:{distance:N,point:Vo.clone(),object:x}}function Nf(x,n,a,u,d,m,A,y,k,N,K,$){Kc.fromBufferAttribute(d,N),Xc.fromBufferAttribute(d,K),ka.fromBufferAttribute(d,$);const j=x.morphTargetInfluences;if(m&&j){ut.set(0,0,0),gp.set(0,0,0),Lf.set(0,0,0);for(let le=0,se=m.length;le<se;le++){const re=j[le],ye=m[le];re!==0&&(Eh.fromBufferAttribute(ye,N),Bf.fromBufferAttribute(ye,K),kf.fromBufferAttribute(ye,$),A?(ut.addScaledVector(Eh,re),gp.addScaledVector(Bf,re),Lf.addScaledVector(kf,re)):(ut.addScaledVector(Eh.sub(Kc),re),gp.addScaledVector(Bf.sub(Xc),re),Lf.addScaledVector(kf.sub(ka),re)))}Kc.add(ut),Xc.add(gp),ka.add(Lf)}x.isSkinnedMesh&&(x.boneTransform(N,Kc),x.boneTransform(K,Xc),x.boneTransform($,ka));const ne=e1(x,n,a,u,Kc,Xc,ka,Ih);if(ne){y&&(Bt.fromBufferAttribute(y,N),Df.fromBufferAttribute(y,K),Qc.fromBufferAttribute(y,$),ne.uv=Ss.getUV(Ih,Kc,Xc,ka,Bt,Df,Qc,new kn)),k&&(Bt.fromBufferAttribute(k,N),Df.fromBufferAttribute(k,K),Qc.fromBufferAttribute(k,$),ne.uv2=Ss.getUV(Ih,Kc,Xc,ka,Bt,Df,Qc,new kn));const le={a:N,b:K,c:$,normal:new tt,materialIndex:0};Ss.getNormal(Kc,Xc,ka,le.normal),ne.face=le}return ne}class bc extends Or{constructor(n=1,a=1,u=1,d=1,m=1,A=1){super(),this.type="BoxGeometry",this.parameters={width:n,height:a,depth:u,widthSegments:d,heightSegments:m,depthSegments:A};const y=this;d=Math.floor(d),m=Math.floor(m),A=Math.floor(A);const k=[],N=[],K=[],$=[];let j=0,ne=0;le("z","y","x",-1,-1,u,a,n,A,m,0),le("z","y","x",1,-1,u,a,-n,A,m,1),le("x","z","y",1,1,n,u,a,d,A,2),le("x","z","y",1,-1,n,u,-a,d,A,3),le("x","y","z",1,-1,n,a,u,d,m,4),le("x","y","z",-1,-1,n,a,-u,d,m,5),this.setIndex(k),this.setAttribute("position",new Fi(N,3)),this.setAttribute("normal",new Fi(K,3)),this.setAttribute("uv",new Fi($,2));function le(se,re,ye,Be,Ee,Me,Fe,it,yt,Le,at){const mt=Me/yt,Dt=Fe/Le,on=Me/2,Ut=Fe/2,_t=it/2,Qt=yt+1,bn=Le+1;let je=0,Zt=0;const Qn=new tt;for(let Kn=0;Kn<bn;Kn++){const xi=Kn*Dt-Ut;for(let li=0;li<Qt;li++){const pn=li*mt-on;Qn[se]=pn*Be,Qn[re]=xi*Ee,Qn[ye]=_t,N.push(Qn.x,Qn.y,Qn.z),Qn[se]=0,Qn[re]=0,Qn[ye]=it>0?1:-1,K.push(Qn.x,Qn.y,Qn.z),$.push(li/yt),$.push(1-Kn/Le),je+=1}}for(let Kn=0;Kn<Le;Kn++)for(let xi=0;xi<yt;xi++){const li=j+xi+Qt*Kn,pn=j+xi+Qt*(Kn+1),Rn=j+(xi+1)+Qt*(Kn+1),Vn=j+(xi+1)+Qt*Kn;k.push(li,pn,Vn),k.push(pn,Rn,Vn),Zt+=6}y.addGroup(ne,Zt,at),ne+=Zt,j+=je}}static fromJSON(n){return new bc(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)}}function Sh(x){const n={};for(const a in x){n[a]={};for(const u in x[a]){const d=x[a][u];d&&(d.isColor||d.isMatrix3||d.isMatrix4||d.isVector2||d.isVector3||d.isVector4||d.isTexture||d.isQuaternion)?n[a][u]=d.clone():Array.isArray(d)?n[a][u]=d.slice():n[a][u]=d}}return n}function zo(x){const n={};for(let a=0;a<x.length;a++){const u=Sh(x[a]);for(const d in u)n[d]=u[d]}return n}function xb(x){const n=[];for(let a=0;a<x.length;a++)n.push(x[a].clone());return n}function t1(x){return x.getRenderTarget()===null&&x.outputEncoding===gr?Bs:no}const Gg={clone:Sh,merge:zo};var Mo=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Cb=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ol extends Ba{constructor(n){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Mo,this.fragmentShader=Cb,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,n!==void 0&&this.setValues(n)}copy(n){return super.copy(n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=Sh(n.uniforms),this.uniformsGroups=xb(n.uniformsGroups),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.fog=n.fog,this.lights=n.lights,this.clipping=n.clipping,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this}toJSON(n){const a=super.toJSON(n);a.glslVersion=this.glslVersion,a.uniforms={};for(const d in this.uniforms){const A=this.uniforms[d].value;A&&A.isTexture?a.uniforms[d]={type:"t",value:A.toJSON(n).uuid}:A&&A.isColor?a.uniforms[d]={type:"c",value:A.getHex()}:A&&A.isVector2?a.uniforms[d]={type:"v2",value:A.toArray()}:A&&A.isVector3?a.uniforms[d]={type:"v3",value:A.toArray()}:A&&A.isVector4?a.uniforms[d]={type:"v4",value:A.toArray()}:A&&A.isMatrix3?a.uniforms[d]={type:"m3",value:A.toArray()}:A&&A.isMatrix4?a.uniforms[d]={type:"m4",value:A.toArray()}:a.uniforms[d]={value:A}}Object.keys(this.defines).length>0&&(a.defines=this.defines),a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader;const u={};for(const d in this.extensions)this.extensions[d]===!0&&(u[d]=!0);return Object.keys(u).length>0&&(a.extensions=u),a}}class wd extends as{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ri,this.projectionMatrix=new Ri,this.projectionMatrixInverse=new Ri}copy(n,a){return super.copy(n,a),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return n.set(-a[8],-a[9],-a[10]).normalize()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,a){super.updateWorldMatrix(n,a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class qs extends wd{constructor(n=50,a=1,u=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=u,this.far=d,this.focus=10,this.aspect=a,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,a){return super.copy(n,a),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const a=.5*this.getFilmHeight()/n;this.fov=Jl*2*Math.atan(a),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(Bl*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return Jl*2*Math.atan(Math.tan(Bl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(n,a,u,d,m,A){this.aspect=n/a,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=a,this.view.offsetX=u,this.view.offsetY=d,this.view.width=m,this.view.height=A,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let a=n*Math.tan(Bl*.5*this.fov)/this.zoom,u=2*a,d=this.aspect*u,m=-.5*d;const A=this.view;if(this.view!==null&&this.view.enabled){const k=A.fullWidth,N=A.fullHeight;m+=A.offsetX*d/k,a-=A.offsetY*u/N,d*=A.width/k,u*=A.height/N}const y=this.filmOffset;y!==0&&(m+=n*y/this.getFilmWidth()),this.projectionMatrix.makePerspective(m,m+d,a,a-u,n,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const a=super.toJSON(n);return a.object.fov=this.fov,a.object.zoom=this.zoom,a.object.near=this.near,a.object.far=this.far,a.object.focus=this.focus,a.object.aspect=this.aspect,this.view!==null&&(a.object.view=Object.assign({},this.view)),a.object.filmGauge=this.filmGauge,a.object.filmOffset=this.filmOffset,a}}const yl=-90,Th=1;class Ff extends as{constructor(n,a,u){super(),this.type="CubeCamera",this.renderTarget=u;const d=new qs(yl,Th,n,a);d.layers=this.layers,d.up.set(0,1,0),d.lookAt(1,0,0),this.add(d);const m=new qs(yl,Th,n,a);m.layers=this.layers,m.up.set(0,1,0),m.lookAt(-1,0,0),this.add(m);const A=new qs(yl,Th,n,a);A.layers=this.layers,A.up.set(0,0,-1),A.lookAt(0,1,0),this.add(A);const y=new qs(yl,Th,n,a);y.layers=this.layers,y.up.set(0,0,1),y.lookAt(0,-1,0),this.add(y);const k=new qs(yl,Th,n,a);k.layers=this.layers,k.up.set(0,1,0),k.lookAt(0,0,1),this.add(k);const N=new qs(yl,Th,n,a);N.layers=this.layers,N.up.set(0,1,0),N.lookAt(0,0,-1),this.add(N)}update(n,a){this.parent===null&&this.updateMatrixWorld();const u=this.renderTarget,[d,m,A,y,k,N]=this.children,K=n.getRenderTarget(),$=n.toneMapping,j=n.xr.enabled;n.toneMapping=wn,n.xr.enabled=!1;const ne=u.texture.generateMipmaps;u.texture.generateMipmaps=!1,n.setRenderTarget(u,0),n.render(a,d),n.setRenderTarget(u,1),n.render(a,m),n.setRenderTarget(u,2),n.render(a,A),n.setRenderTarget(u,3),n.render(a,y),n.setRenderTarget(u,4),n.render(a,k),u.texture.generateMipmaps=ne,n.setRenderTarget(u,5),n.render(a,N),n.setRenderTarget(K),n.toneMapping=$,n.xr.enabled=j,u.texture.needsPMREMUpdate=!0}}class rc extends Ws{constructor(n,a,u,d,m,A,y,k,N,K){n=n!==void 0?n:[],a=a!==void 0?a:We,super(n,a,u,d,m,A,y,k,N,K),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(n){this.image=n}}class Ug extends So{constructor(n=1,a={}){super(n,n,a),this.isWebGLCubeRenderTarget=!0;const u={width:n,height:n,depth:1},d=[u,u,u,u,u,u];this.texture=new rc(d,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=a.generateMipmaps!==void 0?a.generateMipmaps:!1,this.texture.minFilter=a.minFilter!==void 0?a.minFilter:ft}fromEquirectangularTexture(n,a){this.texture.type=a.type,this.texture.encoding=a.encoding,this.texture.generateMipmaps=a.generateMipmaps,this.texture.minFilter=a.minFilter,this.texture.magFilter=a.magFilter;const u={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new bc(5,5,5),m=new Ol({name:"CubemapFromEquirect",uniforms:Sh(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,side:V,blending:Y});m.uniforms.tEquirect.value=a;const A=new lo(d,m),y=a.minFilter;return a.minFilter===bi&&(a.minFilter=ft),new Ff(1,10,this).update(n,A),a.minFilter=y,A.geometry.dispose(),A.material.dispose(),this}clear(n,a,u,d){const m=n.getRenderTarget();for(let A=0;A<6;A++)n.setRenderTarget(this,A),n.clear(a,u,d);n.setRenderTarget(m)}}const Vg=new tt,wb=new tt,Eb=new ro;class _o{constructor(n=new tt(1,0,0),a=0){this.isPlane=!0,this.normal=n,this.constant=a}set(n,a){return this.normal.copy(n),this.constant=a,this}setComponents(n,a,u,d){return this.normal.set(n,a,u),this.constant=d,this}setFromNormalAndCoplanarPoint(n,a){return this.normal.copy(n),this.constant=-a.dot(this.normal),this}setFromCoplanarPoints(n,a,u){const d=Vg.subVectors(u,a).cross(wb.subVectors(n,a)).normalize();return this.setFromNormalAndCoplanarPoint(d,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,a){return a.copy(this.normal).multiplyScalar(-this.distanceToPoint(n)).add(n)}intersectLine(n,a){const u=n.delta(Vg),d=this.normal.dot(u);if(d===0)return this.distanceToPoint(n.start)===0?a.copy(n.start):null;const m=-(n.start.dot(this.normal)+this.constant)/d;return m<0||m>1?null:a.copy(u).multiplyScalar(m).add(n.start)}intersectsLine(n){const a=this.distanceToPoint(n.start),u=this.distanceToPoint(n.end);return a<0&&u>0||u<0&&a>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,a){const u=a||Eb.getNormalMatrix(n),d=this.coplanarPoint(Vg).applyMatrix4(n),m=this.normal.applyMatrix3(u).normalize();return this.constant=-d.dot(m),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}}const sc=new To,Ap=new tt;class Pf{constructor(n=new _o,a=new _o,u=new _o,d=new _o,m=new _o,A=new _o){this.planes=[n,a,u,d,m,A]}set(n,a,u,d,m,A){const y=this.planes;return y[0].copy(n),y[1].copy(a),y[2].copy(u),y[3].copy(d),y[4].copy(m),y[5].copy(A),this}copy(n){const a=this.planes;for(let u=0;u<6;u++)a[u].copy(n.planes[u]);return this}setFromProjectionMatrix(n){const a=this.planes,u=n.elements,d=u[0],m=u[1],A=u[2],y=u[3],k=u[4],N=u[5],K=u[6],$=u[7],j=u[8],ne=u[9],le=u[10],se=u[11],re=u[12],ye=u[13],Be=u[14],Ee=u[15];return a[0].setComponents(y-d,$-k,se-j,Ee-re).normalize(),a[1].setComponents(y+d,$+k,se+j,Ee+re).normalize(),a[2].setComponents(y+m,$+N,se+ne,Ee+ye).normalize(),a[3].setComponents(y-m,$-N,se-ne,Ee-ye).normalize(),a[4].setComponents(y-A,$-K,se-le,Ee-Be).normalize(),a[5].setComponents(y+A,$+K,se+le,Ee+Be).normalize(),this}intersectsObject(n){const a=n.geometry;return a.boundingSphere===null&&a.computeBoundingSphere(),sc.copy(a.boundingSphere).applyMatrix4(n.matrixWorld),this.intersectsSphere(sc)}intersectsSprite(n){return sc.center.set(0,0,0),sc.radius=.7071067811865476,sc.applyMatrix4(n.matrixWorld),this.intersectsSphere(sc)}intersectsSphere(n){const a=this.planes,u=n.center,d=-n.radius;for(let m=0;m<6;m++)if(a[m].distanceToPoint(u)<d)return!1;return!0}intersectsBox(n){const a=this.planes;for(let u=0;u<6;u++){const d=a[u];if(Ap.x=d.normal.x>0?n.max.x:n.min.x,Ap.y=d.normal.y>0?n.max.y:n.min.y,Ap.z=d.normal.z>0?n.max.z:n.min.z,d.distanceToPoint(Ap)<0)return!1}return!0}containsPoint(n){const a=this.planes;for(let u=0;u<6;u++)if(a[u].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function zg(){let x=null,n=!1,a=null,u=null;function d(m,A){a(m,A),u=x.requestAnimationFrame(d)}return{start:function(){n!==!0&&a!==null&&(u=x.requestAnimationFrame(d),n=!0)},stop:function(){x.cancelAnimationFrame(u),n=!1},setAnimationLoop:function(m){a=m},setContext:function(m){x=m}}}function Ib(x,n){const a=n.isWebGL2,u=new WeakMap;function d(N,K){const $=N.array,j=N.usage,ne=x.createBuffer();x.bindBuffer(K,ne),x.bufferData(K,$,j),N.onUploadCallback();let le;if($ instanceof Float32Array)le=5126;else if($ instanceof Uint16Array)if(N.isFloat16BufferAttribute)if(a)le=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else le=5123;else if($ instanceof Int16Array)le=5122;else if($ instanceof Uint32Array)le=5125;else if($ instanceof Int32Array)le=5124;else if($ instanceof Int8Array)le=5120;else if($ instanceof Uint8Array)le=5121;else if($ instanceof Uint8ClampedArray)le=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+$);return{buffer:ne,type:le,bytesPerElement:$.BYTES_PER_ELEMENT,version:N.version}}function m(N,K,$){const j=K.array,ne=K.updateRange;x.bindBuffer($,N),ne.count===-1?x.bufferSubData($,0,j):(a?x.bufferSubData($,ne.offset*j.BYTES_PER_ELEMENT,j,ne.offset,ne.count):x.bufferSubData($,ne.offset*j.BYTES_PER_ELEMENT,j.subarray(ne.offset,ne.offset+ne.count)),ne.count=-1),K.onUploadCallback()}function A(N){return N.isInterleavedBufferAttribute&&(N=N.data),u.get(N)}function y(N){N.isInterleavedBufferAttribute&&(N=N.data);const K=u.get(N);K&&(x.deleteBuffer(K.buffer),u.delete(N))}function k(N,K){if(N.isGLBufferAttribute){const j=u.get(N);(!j||j.version<N.version)&&u.set(N,{buffer:N.buffer,type:N.type,bytesPerElement:N.elementSize,version:N.version});return}N.isInterleavedBufferAttribute&&(N=N.data);const $=u.get(N);$===void 0?u.set(N,d(N,K)):$.version<N.version&&(m($.buffer,N,K),$.version=N.version)}return{get:A,remove:y,update:k}}class Ed extends Or{constructor(n=1,a=1,u=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:n,height:a,widthSegments:u,heightSegments:d};const m=n/2,A=a/2,y=Math.floor(u),k=Math.floor(d),N=y+1,K=k+1,$=n/y,j=a/k,ne=[],le=[],se=[],re=[];for(let ye=0;ye<K;ye++){const Be=ye*j-A;for(let Ee=0;Ee<N;Ee++){const Me=Ee*$-m;le.push(Me,-Be,0),se.push(0,0,1),re.push(Ee/y),re.push(1-ye/k)}}for(let ye=0;ye<k;ye++)for(let Be=0;Be<y;Be++){const Ee=Be+N*ye,Me=Be+N*(ye+1),Fe=Be+1+N*(ye+1),it=Be+1+N*ye;ne.push(Ee,Me,it),ne.push(Me,Fe,it)}this.setIndex(ne),this.setAttribute("position",new Fi(le,3)),this.setAttribute("normal",new Fi(se,3)),this.setAttribute("uv",new Fi(re,2))}static fromJSON(n){return new Ed(n.width,n.height,n.widthSegments,n.heightSegments)}}var n1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,i1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Sb=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Tb=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Mh=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,r1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Mb="vec3 transformed = vec3( position );",_b=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,s1=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,xc=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Rb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Bb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Wg=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,kb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,dr=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Lb=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,wi=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Db=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,_h=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Nb=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Fb=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bs=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Pb=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,a1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,ea=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Of=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Pt="gl_FragColor = linearToOutputTexel( gl_FragColor );",Hr=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,bl=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,o1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Bu=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ob=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Hg=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Gb=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,La=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ub=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Gf=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Vb=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Yr=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,ku=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Ha=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Ir=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,zb=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Rh=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Wb=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Hb=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Kg=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,l1=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Kb=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,vp=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Xg=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Xb=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Qg=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Qb=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Zg=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,c1=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,u1=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,h1=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Zb=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,d1=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,p1=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,f1=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,m1=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,g1=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Uf=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Vf=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,zf=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,$g=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,$b=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,A1=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,jb=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Id=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Gl=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Nn=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Yb=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Hn=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Jb=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,v1=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qb=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,rr=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,St=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,tx=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ro=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,nx=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ix=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,rx=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,sx=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,ax=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,y1=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,ox=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,jg=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,lx=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yp=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cx=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,ux=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,hx=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,dx=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,px=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,fx=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,mx=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,gx=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Ax=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,vx=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,yx=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,bx=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Gr={alphamap_fragment:n1,alphamap_pars_fragment:i1,alphatest_fragment:Sb,alphatest_pars_fragment:Tb,aomap_fragment:Mh,aomap_pars_fragment:r1,begin_vertex:Mb,beginnormal_vertex:_b,bsdfs:s1,iridescence_fragment:xc,bumpmap_pars_fragment:Rb,clipping_planes_fragment:Bb,clipping_planes_pars_fragment:Wg,clipping_planes_pars_vertex:kb,clipping_planes_vertex:dr,color_fragment:Lb,color_pars_fragment:wi,color_pars_vertex:Db,color_vertex:_h,common:Nb,cube_uv_reflection_fragment:Fb,defaultnormal_vertex:bs,displacementmap_pars_vertex:Pb,displacementmap_vertex:a1,emissivemap_fragment:ea,emissivemap_pars_fragment:Of,encodings_fragment:Pt,encodings_pars_fragment:Hr,envmap_fragment:bl,envmap_common_pars_fragment:o1,envmap_pars_fragment:Bu,envmap_pars_vertex:Ob,envmap_physical_pars_fragment:Rh,envmap_vertex:Hg,fog_vertex:Gb,fog_pars_vertex:La,fog_fragment:Ub,fog_pars_fragment:Gf,gradientmap_pars_fragment:Vb,lightmap_fragment:Yr,lightmap_pars_fragment:ku,lights_lambert_fragment:Ha,lights_lambert_pars_fragment:Ir,lights_pars_begin:zb,lights_toon_fragment:Wb,lights_toon_pars_fragment:Hb,lights_phong_fragment:Kg,lights_phong_pars_fragment:l1,lights_physical_fragment:Kb,lights_physical_pars_fragment:vp,lights_fragment_begin:Xg,lights_fragment_maps:Xb,lights_fragment_end:Qg,logdepthbuf_fragment:Qb,logdepthbuf_pars_fragment:Zg,logdepthbuf_pars_vertex:c1,logdepthbuf_vertex:u1,map_fragment:h1,map_pars_fragment:Zb,map_particle_fragment:d1,map_particle_pars_fragment:p1,metalnessmap_fragment:f1,metalnessmap_pars_fragment:m1,morphcolor_vertex:g1,morphnormal_vertex:Uf,morphtarget_pars_vertex:Vf,morphtarget_vertex:zf,normal_fragment_begin:$g,normal_fragment_maps:$b,normal_pars_fragment:A1,normal_pars_vertex:jb,normal_vertex:Id,normalmap_pars_fragment:Gl,clearcoat_normal_fragment_begin:Nn,clearcoat_normal_fragment_maps:Yb,clearcoat_pars_fragment:Hn,iridescence_pars_fragment:Jb,output_fragment:v1,packing:qb,premultiplied_alpha_fragment:rr,project_vertex:ex,dithering_fragment:St,dithering_pars_fragment:tx,roughnessmap_fragment:Ro,roughnessmap_pars_fragment:nx,shadowmap_pars_fragment:ix,shadowmap_pars_vertex:rx,shadowmap_vertex:sx,shadowmask_pars_fragment:ax,skinbase_vertex:y1,skinning_pars_vertex:ox,skinning_vertex:jg,skinnormal_vertex:lx,specularmap_fragment:yp,specularmap_pars_fragment:cx,tonemapping_fragment:ux,tonemapping_pars_fragment:hx,transmission_fragment:dx,transmission_pars_fragment:px,uv_pars_fragment:fx,uv_pars_vertex:mx,uv_vertex:gx,uv2_pars_fragment:Ax,uv2_pars_vertex:vx,uv2_vertex:yx,worldpos_vertex:bx,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},pi={common:{diffuse:{value:new Si(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ro},uv2Transform:{value:new ro},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new kn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Si(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Si(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ro}},sprite:{diffuse:{value:new Si(16777215)},opacity:{value:1},center:{value:new kn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ro}}},qo={basic:{uniforms:zo([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.fog]),vertexShader:Gr.meshbasic_vert,fragmentShader:Gr.meshbasic_frag},lambert:{uniforms:zo([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,pi.lights,{emissive:{value:new Si(0)}}]),vertexShader:Gr.meshlambert_vert,fragmentShader:Gr.meshlambert_frag},phong:{uniforms:zo([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,pi.lights,{emissive:{value:new Si(0)},specular:{value:new Si(1118481)},shininess:{value:30}}]),vertexShader:Gr.meshphong_vert,fragmentShader:Gr.meshphong_frag},standard:{uniforms:zo([pi.common,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.roughnessmap,pi.metalnessmap,pi.fog,pi.lights,{emissive:{value:new Si(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Gr.meshphysical_vert,fragmentShader:Gr.meshphysical_frag},toon:{uniforms:zo([pi.common,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.gradientmap,pi.fog,pi.lights,{emissive:{value:new Si(0)}}]),vertexShader:Gr.meshtoon_vert,fragmentShader:Gr.meshtoon_frag},matcap:{uniforms:zo([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,{matcap:{value:null}}]),vertexShader:Gr.meshmatcap_vert,fragmentShader:Gr.meshmatcap_frag},points:{uniforms:zo([pi.points,pi.fog]),vertexShader:Gr.points_vert,fragmentShader:Gr.points_frag},dashed:{uniforms:zo([pi.common,pi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Gr.linedashed_vert,fragmentShader:Gr.linedashed_frag},depth:{uniforms:zo([pi.common,pi.displacementmap]),vertexShader:Gr.depth_vert,fragmentShader:Gr.depth_frag},normal:{uniforms:zo([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,{opacity:{value:1}}]),vertexShader:Gr.meshnormal_vert,fragmentShader:Gr.meshnormal_frag},sprite:{uniforms:zo([pi.sprite,pi.fog]),vertexShader:Gr.sprite_vert,fragmentShader:Gr.sprite_frag},background:{uniforms:{uvTransform:{value:new ro},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Gr.background_vert,fragmentShader:Gr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Gr.backgroundCube_vert,fragmentShader:Gr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Gr.cube_vert,fragmentShader:Gr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Gr.equirect_vert,fragmentShader:Gr.equirect_frag},distanceRGBA:{uniforms:zo([pi.common,pi.displacementmap,{referencePosition:{value:new tt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gr.distanceRGBA_vert,fragmentShader:Gr.distanceRGBA_frag},shadow:{uniforms:zo([pi.lights,pi.fog,{color:{value:new Si(0)},opacity:{value:1}}]),vertexShader:Gr.shadow_vert,fragmentShader:Gr.shadow_frag}};qo.physical={uniforms:zo([qo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new kn(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Si(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new kn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Si(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Si(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Gr.meshphysical_vert,fragmentShader:Gr.meshphysical_frag};const Hf={r:0,b:0,g:0};function xx(x,n,a,u,d,m,A){const y=new Si(0);let k=m===!0?0:1,N,K,$=null,j=0,ne=null;function le(re,ye){let Be=!1,Ee=ye.isScene===!0?ye.background:null;Ee&&Ee.isTexture&&(Ee=(ye.backgroundBlurriness>0?a:n).get(Ee));const Me=x.xr,Fe=Me.getSession&&Me.getSession();Fe&&Fe.environmentBlendMode==="additive"&&(Ee=null),Ee===null?se(y,k):Ee&&Ee.isColor&&(se(Ee,1),Be=!0),(x.autoClear||Be)&&x.clear(x.autoClearColor,x.autoClearDepth,x.autoClearStencil),Ee&&(Ee.isCubeTexture||Ee.mapping===vt)?(K===void 0&&(K=new lo(new bc(1,1,1),new Ol({name:"BackgroundCubeMaterial",uniforms:Sh(qo.backgroundCube.uniforms),vertexShader:qo.backgroundCube.vertexShader,fragmentShader:qo.backgroundCube.fragmentShader,side:V,depthTest:!1,depthWrite:!1,fog:!1})),K.geometry.deleteAttribute("normal"),K.geometry.deleteAttribute("uv"),K.onBeforeRender=function(it,yt,Le){this.matrixWorld.copyPosition(Le.matrixWorld)},Object.defineProperty(K.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(K)),K.material.uniforms.envMap.value=Ee,K.material.uniforms.flipEnvMap.value=Ee.isCubeTexture&&Ee.isRenderTargetTexture===!1?-1:1,K.material.uniforms.backgroundBlurriness.value=ye.backgroundBlurriness,K.material.uniforms.backgroundIntensity.value=ye.backgroundIntensity,($!==Ee||j!==Ee.version||ne!==x.toneMapping)&&(K.material.needsUpdate=!0,$=Ee,j=Ee.version,ne=x.toneMapping),K.layers.enableAll(),re.unshift(K,K.geometry,K.material,0,0,null)):Ee&&Ee.isTexture&&(N===void 0&&(N=new lo(new Ed(2,2),new Ol({name:"BackgroundMaterial",uniforms:Sh(qo.background.uniforms),vertexShader:qo.background.vertexShader,fragmentShader:qo.background.fragmentShader,side:D,depthTest:!1,depthWrite:!1,fog:!1})),N.geometry.deleteAttribute("normal"),Object.defineProperty(N.material,"map",{get:function(){return this.uniforms.t2D.value}}),d.update(N)),N.material.uniforms.t2D.value=Ee,N.material.uniforms.backgroundIntensity.value=ye.backgroundIntensity,Ee.matrixAutoUpdate===!0&&Ee.updateMatrix(),N.material.uniforms.uvTransform.value.copy(Ee.matrix),($!==Ee||j!==Ee.version||ne!==x.toneMapping)&&(N.material.needsUpdate=!0,$=Ee,j=Ee.version,ne=x.toneMapping),N.layers.enableAll(),re.unshift(N,N.geometry,N.material,0,0,null))}function se(re,ye){re.getRGB(Hf,t1(x)),u.buffers.color.setClear(Hf.r,Hf.g,Hf.b,ye,A)}return{getClearColor:function(){return y},setClearColor:function(re,ye=1){y.set(re),k=ye,se(y,k)},getClearAlpha:function(){return k},setClearAlpha:function(re){k=re,se(y,k)},render:le}}function Cx(x,n,a,u){const d=x.getParameter(34921),m=u.isWebGL2?null:n.get("OES_vertex_array_object"),A=u.isWebGL2||m!==null,y={},k=re(null);let N=k,K=!1;function $(_t,Qt,bn,je,Zt){let Qn=!1;if(A){const Kn=se(je,bn,Qt);N!==Kn&&(N=Kn,ne(N.object)),Qn=ye(_t,je,bn,Zt),Qn&&Be(_t,je,bn,Zt)}else{const Kn=Qt.wireframe===!0;(N.geometry!==je.id||N.program!==bn.id||N.wireframe!==Kn)&&(N.geometry=je.id,N.program=bn.id,N.wireframe=Kn,Qn=!0)}Zt!==null&&a.update(Zt,34963),(Qn||K)&&(K=!1,Le(_t,Qt,bn,je),Zt!==null&&x.bindBuffer(34963,a.get(Zt).buffer))}function j(){return u.isWebGL2?x.createVertexArray():m.createVertexArrayOES()}function ne(_t){return u.isWebGL2?x.bindVertexArray(_t):m.bindVertexArrayOES(_t)}function le(_t){return u.isWebGL2?x.deleteVertexArray(_t):m.deleteVertexArrayOES(_t)}function se(_t,Qt,bn){const je=bn.wireframe===!0;let Zt=y[_t.id];Zt===void 0&&(Zt={},y[_t.id]=Zt);let Qn=Zt[Qt.id];Qn===void 0&&(Qn={},Zt[Qt.id]=Qn);let Kn=Qn[je];return Kn===void 0&&(Kn=re(j()),Qn[je]=Kn),Kn}function re(_t){const Qt=[],bn=[],je=[];for(let Zt=0;Zt<d;Zt++)Qt[Zt]=0,bn[Zt]=0,je[Zt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Qt,enabledAttributes:bn,attributeDivisors:je,object:_t,attributes:{},index:null}}function ye(_t,Qt,bn,je){const Zt=N.attributes,Qn=Qt.attributes;let Kn=0;const xi=bn.getAttributes();for(const li in xi)if(xi[li].location>=0){const Rn=Zt[li];let Vn=Qn[li];if(Vn===void 0&&(li==="instanceMatrix"&&_t.instanceMatrix&&(Vn=_t.instanceMatrix),li==="instanceColor"&&_t.instanceColor&&(Vn=_t.instanceColor)),Rn===void 0||Rn.attribute!==Vn||Vn&&Rn.data!==Vn.data)return!0;Kn++}return N.attributesNum!==Kn||N.index!==je}function Be(_t,Qt,bn,je){const Zt={},Qn=Qt.attributes;let Kn=0;const xi=bn.getAttributes();for(const li in xi)if(xi[li].location>=0){let Rn=Qn[li];Rn===void 0&&(li==="instanceMatrix"&&_t.instanceMatrix&&(Rn=_t.instanceMatrix),li==="instanceColor"&&_t.instanceColor&&(Rn=_t.instanceColor));const Vn={};Vn.attribute=Rn,Rn&&Rn.data&&(Vn.data=Rn.data),Zt[li]=Vn,Kn++}N.attributes=Zt,N.attributesNum=Kn,N.index=je}function Ee(){const _t=N.newAttributes;for(let Qt=0,bn=_t.length;Qt<bn;Qt++)_t[Qt]=0}function Me(_t){Fe(_t,0)}function Fe(_t,Qt){const bn=N.newAttributes,je=N.enabledAttributes,Zt=N.attributeDivisors;bn[_t]=1,je[_t]===0&&(x.enableVertexAttribArray(_t),je[_t]=1),Zt[_t]!==Qt&&((u.isWebGL2?x:n.get("ANGLE_instanced_arrays"))[u.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](_t,Qt),Zt[_t]=Qt)}function it(){const _t=N.newAttributes,Qt=N.enabledAttributes;for(let bn=0,je=Qt.length;bn<je;bn++)Qt[bn]!==_t[bn]&&(x.disableVertexAttribArray(bn),Qt[bn]=0)}function yt(_t,Qt,bn,je,Zt,Qn){u.isWebGL2===!0&&(bn===5124||bn===5125)?x.vertexAttribIPointer(_t,Qt,bn,Zt,Qn):x.vertexAttribPointer(_t,Qt,bn,je,Zt,Qn)}function Le(_t,Qt,bn,je){if(u.isWebGL2===!1&&(_t.isInstancedMesh||je.isInstancedBufferGeometry)&&n.get("ANGLE_instanced_arrays")===null)return;Ee();const Zt=je.attributes,Qn=bn.getAttributes(),Kn=Qt.defaultAttributeValues;for(const xi in Qn){const li=Qn[xi];if(li.location>=0){let pn=Zt[xi];if(pn===void 0&&(xi==="instanceMatrix"&&_t.instanceMatrix&&(pn=_t.instanceMatrix),xi==="instanceColor"&&_t.instanceColor&&(pn=_t.instanceColor)),pn!==void 0){const Rn=pn.normalized,Vn=pn.itemSize,Jt=a.get(pn);if(Jt===void 0)continue;const Ei=Jt.buffer,ii=Jt.type,tr=Jt.bytesPerElement;if(pn.isInterleavedBufferAttribute){const ni=pn.data,Mr=ni.stride,Ln=pn.offset;if(ni.isInstancedInterleavedBuffer){for(let Tn=0;Tn<li.locationSize;Tn++)Fe(li.location+Tn,ni.meshPerAttribute);_t.isInstancedMesh!==!0&&je._maxInstanceCount===void 0&&(je._maxInstanceCount=ni.meshPerAttribute*ni.count)}else for(let Tn=0;Tn<li.locationSize;Tn++)Me(li.location+Tn);x.bindBuffer(34962,Ei);for(let Tn=0;Tn<li.locationSize;Tn++)yt(li.location+Tn,Vn/li.locationSize,ii,Rn,Mr*tr,(Ln+Vn/li.locationSize*Tn)*tr)}else{if(pn.isInstancedBufferAttribute){for(let ni=0;ni<li.locationSize;ni++)Fe(li.location+ni,pn.meshPerAttribute);_t.isInstancedMesh!==!0&&je._maxInstanceCount===void 0&&(je._maxInstanceCount=pn.meshPerAttribute*pn.count)}else for(let ni=0;ni<li.locationSize;ni++)Me(li.location+ni);x.bindBuffer(34962,Ei);for(let ni=0;ni<li.locationSize;ni++)yt(li.location+ni,Vn/li.locationSize,ii,Rn,Vn*tr,Vn/li.locationSize*ni*tr)}}else if(Kn!==void 0){const Rn=Kn[xi];if(Rn!==void 0)switch(Rn.length){case 2:x.vertexAttrib2fv(li.location,Rn);break;case 3:x.vertexAttrib3fv(li.location,Rn);break;case 4:x.vertexAttrib4fv(li.location,Rn);break;default:x.vertexAttrib1fv(li.location,Rn)}}}}it()}function at(){on();for(const _t in y){const Qt=y[_t];for(const bn in Qt){const je=Qt[bn];for(const Zt in je)le(je[Zt].object),delete je[Zt];delete Qt[bn]}delete y[_t]}}function mt(_t){if(y[_t.id]===void 0)return;const Qt=y[_t.id];for(const bn in Qt){const je=Qt[bn];for(const Zt in je)le(je[Zt].object),delete je[Zt];delete Qt[bn]}delete y[_t.id]}function Dt(_t){for(const Qt in y){const bn=y[Qt];if(bn[_t.id]===void 0)continue;const je=bn[_t.id];for(const Zt in je)le(je[Zt].object),delete je[Zt];delete bn[_t.id]}}function on(){Ut(),K=!0,N!==k&&(N=k,ne(N.object))}function Ut(){k.geometry=null,k.program=null,k.wireframe=!1}return{setup:$,reset:on,resetDefaultState:Ut,dispose:at,releaseStatesOfGeometry:mt,releaseStatesOfProgram:Dt,initAttributes:Ee,enableAttribute:Me,disableUnusedAttributes:it}}function wx(x,n,a,u){const d=u.isWebGL2;let m;function A(N){m=N}function y(N,K){x.drawArrays(m,N,K),a.update(K,m,1)}function k(N,K,$){if($===0)return;let j,ne;if(d)j=x,ne="drawArraysInstanced";else if(j=n.get("ANGLE_instanced_arrays"),ne="drawArraysInstancedANGLE",j===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}j[ne](m,N,K,$),a.update(K,m,$)}this.setMode=A,this.render=y,this.renderInstances=k}function Ex(x,n,a){let u;function d(){if(u!==void 0)return u;if(n.has("EXT_texture_filter_anisotropic")===!0){const yt=n.get("EXT_texture_filter_anisotropic");u=x.getParameter(yt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else u=0;return u}function m(yt){if(yt==="highp"){if(x.getShaderPrecisionFormat(35633,36338).precision>0&&x.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";yt="mediump"}return yt==="mediump"&&x.getShaderPrecisionFormat(35633,36337).precision>0&&x.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const A=typeof WebGL2RenderingContext<"u"&&x instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&x instanceof WebGL2ComputeRenderingContext;let y=a.precision!==void 0?a.precision:"highp";const k=m(y);k!==y&&(console.warn("THREE.WebGLRenderer:",y,"not supported, using",k,"instead."),y=k);const N=A||n.has("WEBGL_draw_buffers"),K=a.logarithmicDepthBuffer===!0,$=x.getParameter(34930),j=x.getParameter(35660),ne=x.getParameter(3379),le=x.getParameter(34076),se=x.getParameter(34921),re=x.getParameter(36347),ye=x.getParameter(36348),Be=x.getParameter(36349),Ee=j>0,Me=A||n.has("OES_texture_float"),Fe=Ee&&Me,it=A?x.getParameter(36183):0;return{isWebGL2:A,drawBuffers:N,getMaxAnisotropy:d,getMaxPrecision:m,precision:y,logarithmicDepthBuffer:K,maxTextures:$,maxVertexTextures:j,maxTextureSize:ne,maxCubemapSize:le,maxAttributes:se,maxVertexUniforms:re,maxVaryings:ye,maxFragmentUniforms:Be,vertexTextures:Ee,floatFragmentTextures:Me,floatVertexTextures:Fe,maxSamples:it}}function Ix(x){const n=this;let a=null,u=0,d=!1,m=!1;const A=new _o,y=new ro,k={value:null,needsUpdate:!1};this.uniform=k,this.numPlanes=0,this.numIntersection=0,this.init=function($,j,ne){const le=$.length!==0||j||u!==0||d;return d=j,a=K($,ne,0),u=$.length,le},this.beginShadows=function(){m=!0,K(null)},this.endShadows=function(){m=!1,N()},this.setState=function($,j,ne){const le=$.clippingPlanes,se=$.clipIntersection,re=$.clipShadows,ye=x.get($);if(!d||le===null||le.length===0||m&&!re)m?K(null):N();else{const Be=m?0:u,Ee=Be*4;let Me=ye.clippingState||null;k.value=Me,Me=K(le,j,Ee,ne);for(let Fe=0;Fe!==Ee;++Fe)Me[Fe]=a[Fe];ye.clippingState=Me,this.numIntersection=se?this.numPlanes:0,this.numPlanes+=Be}};function N(){k.value!==a&&(k.value=a,k.needsUpdate=u>0),n.numPlanes=u,n.numIntersection=0}function K($,j,ne,le){const se=$!==null?$.length:0;let re=null;if(se!==0){if(re=k.value,le!==!0||re===null){const ye=ne+se*4,Be=j.matrixWorldInverse;y.getNormalMatrix(Be),(re===null||re.length<ye)&&(re=new Float32Array(ye));for(let Ee=0,Me=ne;Ee!==se;++Ee,Me+=4)A.copy($[Ee]).applyMatrix4(Be,y),A.normal.toArray(re,Me),re[Me+3]=A.constant}k.value=re,k.needsUpdate=!0}return n.numPlanes=se,n.numIntersection=0,re}}function Sx(x){let n=new WeakMap;function a(A,y){return y===Qe?A.mapping=We:y===Ke&&(A.mapping=Oe),A}function u(A){if(A&&A.isTexture&&A.isRenderTargetTexture===!1){const y=A.mapping;if(y===Qe||y===Ke)if(n.has(A)){const k=n.get(A).texture;return a(k,A.mapping)}else{const k=A.image;if(k&&k.height>0){const N=new Ug(k.height/2);return N.fromEquirectangularTexture(x,A),n.set(A,N),A.addEventListener("dispose",d),a(N.texture,A.mapping)}else return null}}return A}function d(A){const y=A.target;y.removeEventListener("dispose",d);const k=n.get(y);k!==void 0&&(n.delete(y),k.dispose())}function m(){n=new WeakMap}return{get:u,dispose:m}}class Kf extends wd{constructor(n=-1,a=1,u=1,d=-1,m=.1,A=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=a,this.top=u,this.bottom=d,this.near=m,this.far=A,this.updateProjectionMatrix()}copy(n,a){return super.copy(n,a),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,a,u,d,m,A){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=a,this.view.offsetX=u,this.view.offsetY=d,this.view.width=m,this.view.height=A,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),u=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let m=u-n,A=u+n,y=d+a,k=d-a;if(this.view!==null&&this.view.enabled){const N=(this.right-this.left)/this.view.fullWidth/this.zoom,K=(this.top-this.bottom)/this.view.fullHeight/this.zoom;m+=N*this.view.offsetX,A=m+N*this.view.width,y-=K*this.view.offsetY,k=y-K*this.view.height}this.projectionMatrix.makeOrthographic(m,A,y,k,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const a=super.toJSON(n);return a.object.zoom=this.zoom,a.object.left=this.left,a.object.right=this.right,a.object.top=this.top,a.object.bottom=this.bottom,a.object.near=this.near,a.object.far=this.far,this.view!==null&&(a.object.view=Object.assign({},this.view)),a}}const Md=4,kh=[.125,.215,.35,.446,.526,.582],Lh=20,Jg=new Kf,Cp=new Si;let qg=null;const Ja=(1+Math.sqrt(5))/2,_d=1/Ja,I1=[new tt(1,1,1),new tt(-1,1,1),new tt(1,1,-1),new tt(-1,1,-1),new tt(0,Ja,_d),new tt(0,Ja,-_d),new tt(_d,0,Ja),new tt(-_d,0,Ja),new tt(Ja,_d,0),new tt(-Ja,_d,0)];class e0{constructor(n){this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(n,a=0,u=.1,d=100){qg=this._renderer.getRenderTarget(),this._setSize(256);const m=this._allocateTargets();return m.depthBuffer=!0,this._sceneToCubeUV(n,u,d,m),a>0&&this._blur(m,0,0,a),this._applyPMREM(m),this._cleanup(m),m}fromEquirectangular(n,a=null){return this._fromTexture(n,a)}fromCubemap(n,a=null){return this._fromTexture(n,a)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=M1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=T1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(n){this._lodMax=Math.floor(Math.log2(n)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let n=0;n<this._lodPlanes.length;n++)this._lodPlanes[n].dispose()}_cleanup(n){this._renderer.setRenderTarget(qg),n.scissorTest=!1,Xf(n,0,0,n.width,n.height)}_fromTexture(n,a){n.mapping===We||n.mapping===Oe?this._setSize(n.image.length===0?16:n.image[0].width||n.image[0].image.width):this._setSize(n.image.width/4),qg=this._renderer.getRenderTarget();const u=a||this._allocateTargets();return this._textureToCubeUV(n,u),this._applyPMREM(u),this._cleanup(u),u}_allocateTargets(){const n=3*Math.max(this._cubeSize,112),a=4*this._cubeSize,u={magFilter:ft,minFilter:ft,generateMipmaps:!1,type:hn,format:cr,encoding:Qr,depthBuffer:!1},d=S1(n,a,u);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=S1(n,a,u);const{_lodMax:m}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Tx(m)),this._blurMaterial=Mx(m,n,a)}return d}_compileMaterial(n){const a=new lo(this._lodPlanes[0],n);this._renderer.compile(a,Jg)}_sceneToCubeUV(n,a,u,d){const y=new qs(90,1,a,u),k=[1,-1,1,1,1,1],N=[1,1,1,-1,-1,-1],K=this._renderer,$=K.autoClear,j=K.toneMapping;K.getClearColor(Cp),K.toneMapping=wn,K.autoClear=!1;const ne=new _u({name:"PMREM.Background",side:V,depthWrite:!1,depthTest:!1}),le=new lo(new bc,ne);let se=!1;const re=n.background;re?re.isColor&&(ne.color.copy(re),n.background=null,se=!0):(ne.color.copy(Cp),se=!0);for(let ye=0;ye<6;ye++){const Be=ye%3;Be===0?(y.up.set(0,k[ye],0),y.lookAt(N[ye],0,0)):Be===1?(y.up.set(0,0,k[ye]),y.lookAt(0,N[ye],0)):(y.up.set(0,k[ye],0),y.lookAt(0,0,N[ye]));const Ee=this._cubeSize;Xf(d,Be*Ee,ye>2?Ee:0,Ee,Ee),K.setRenderTarget(d),se&&K.render(le,y),K.render(n,y)}le.geometry.dispose(),le.material.dispose(),K.toneMapping=j,K.autoClear=$,n.background=re}_textureToCubeUV(n,a){const u=this._renderer,d=n.mapping===We||n.mapping===Oe;d?(this._cubemapMaterial===null&&(this._cubemapMaterial=M1()),this._cubemapMaterial.uniforms.flipEnvMap.value=n.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=T1());const m=d?this._cubemapMaterial:this._equirectMaterial,A=new lo(this._lodPlanes[0],m),y=m.uniforms;y.envMap.value=n;const k=this._cubeSize;Xf(a,0,0,3*k,2*k),u.setRenderTarget(a),u.render(A,Jg)}_applyPMREM(n){const a=this._renderer,u=a.autoClear;a.autoClear=!1;for(let d=1;d<this._lodPlanes.length;d++){const m=Math.sqrt(this._sigmas[d]*this._sigmas[d]-this._sigmas[d-1]*this._sigmas[d-1]),A=I1[(d-1)%I1.length];this._blur(n,d-1,d,m,A)}a.autoClear=u}_blur(n,a,u,d,m){const A=this._pingPongRenderTarget;this._halfBlur(n,A,a,u,d,"latitudinal",m),this._halfBlur(A,n,u,u,d,"longitudinal",m)}_halfBlur(n,a,u,d,m,A,y){const k=this._renderer,N=this._blurMaterial;A!=="latitudinal"&&A!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const K=3,$=new lo(this._lodPlanes[d],N),j=N.uniforms,ne=this._sizeLods[u]-1,le=isFinite(m)?Math.PI/(2*ne):2*Math.PI/(2*Lh-1),se=m/le,re=isFinite(m)?1+Math.floor(K*se):Lh;re>Lh&&console.warn(`sigmaRadians, ${m}, is too large and will clip, as it requested ${re} samples when the maximum is set to ${Lh}`);const ye=[];let Be=0;for(let yt=0;yt<Lh;++yt){const Le=yt/se,at=Math.exp(-Le*Le/2);ye.push(at),yt===0?Be+=at:yt<re&&(Be+=2*at)}for(let yt=0;yt<ye.length;yt++)ye[yt]=ye[yt]/Be;j.envMap.value=n.texture,j.samples.value=re,j.weights.value=ye,j.latitudinal.value=A==="latitudinal",y&&(j.poleAxis.value=y);const{_lodMax:Ee}=this;j.dTheta.value=le,j.mipInt.value=Ee-u;const Me=this._sizeLods[d],Fe=3*Me*(d>Ee-Md?d-Ee+Md:0),it=4*(this._cubeSize-Me);Xf(a,Fe,it,3*Me,2*Me),k.setRenderTarget(a),k.render($,Jg)}}function Tx(x){const n=[],a=[],u=[];let d=x;const m=x-Md+1+kh.length;for(let A=0;A<m;A++){const y=Math.pow(2,d);a.push(y);let k=1/y;A>x-Md?k=kh[A-x+Md-1]:A===0&&(k=0),u.push(k);const N=1/(y-2),K=-N,$=1+N,j=[K,K,$,K,$,$,K,K,$,$,K,$],ne=6,le=6,se=3,re=2,ye=1,Be=new Float32Array(se*le*ne),Ee=new Float32Array(re*le*ne),Me=new Float32Array(ye*le*ne);for(let it=0;it<ne;it++){const yt=it%3*2/3-1,Le=it>2?0:-1,at=[yt,Le,0,yt+2/3,Le,0,yt+2/3,Le+1,0,yt,Le,0,yt+2/3,Le+1,0,yt,Le+1,0];Be.set(at,se*le*it),Ee.set(j,re*le*it);const mt=[it,it,it,it,it,it];Me.set(mt,ye*le*it)}const Fe=new Or;Fe.setAttribute("position",new Vt(Be,se)),Fe.setAttribute("uv",new Vt(Ee,re)),Fe.setAttribute("faceIndex",new Vt(Me,ye)),n.push(Fe),d>Md&&d--}return{lodPlanes:n,sizeLods:a,sigmas:u}}function S1(x,n,a){const u=new So(x,n,a);return u.texture.mapping=vt,u.texture.name="PMREM.cubeUv",u.scissorTest=!0,u}function Xf(x,n,a,u,d){x.viewport.set(n,a,u,d),x.scissor.set(n,a,u,d)}function Mx(x,n,a){const u=new Float32Array(Lh),d=new tt(0,1,0);return new Ol({name:"SphericalGaussianBlur",defines:{n:Lh,CUBEUV_TEXEL_WIDTH:1/n,CUBEUV_TEXEL_HEIGHT:1/a,CUBEUV_MAX_MIP:`${x}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:u},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:d}},vertexShader:Zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function T1(){return new Ol({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function M1(){return new Ol({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function Zc(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function _x(x){let n=new WeakMap,a=null;function u(y){if(y&&y.isTexture){const k=y.mapping,N=k===Qe||k===Ke,K=k===We||k===Oe;if(N||K)if(y.isRenderTargetTexture&&y.needsPMREMUpdate===!0){y.needsPMREMUpdate=!1;let $=n.get(y);return a===null&&(a=new e0(x)),$=N?a.fromEquirectangular(y,$):a.fromCubemap(y,$),n.set(y,$),$.texture}else{if(n.has(y))return n.get(y).texture;{const $=y.image;if(N&&$&&$.height>0||K&&$&&d($)){a===null&&(a=new e0(x));const j=N?a.fromEquirectangular(y):a.fromCubemap(y);return n.set(y,j),y.addEventListener("dispose",m),j.texture}else return null}}}return y}function d(y){let k=0;const N=6;for(let K=0;K<N;K++)y[K]!==void 0&&k++;return k===N}function m(y){const k=y.target;k.removeEventListener("dispose",m);const N=n.get(k);N!==void 0&&(n.delete(k),N.dispose())}function A(){n=new WeakMap,a!==null&&(a.dispose(),a=null)}return{get:u,dispose:A}}function _1(x){const n={};function a(u){if(n[u]!==void 0)return n[u];let d;switch(u){case"WEBGL_depth_texture":d=x.getExtension("WEBGL_depth_texture")||x.getExtension("MOZ_WEBGL_depth_texture")||x.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=x.getExtension("EXT_texture_filter_anisotropic")||x.getExtension("MOZ_EXT_texture_filter_anisotropic")||x.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=x.getExtension("WEBGL_compressed_texture_s3tc")||x.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||x.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=x.getExtension("WEBGL_compressed_texture_pvrtc")||x.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=x.getExtension(u)}return n[u]=d,d}return{has:function(u){return a(u)!==null},init:function(u){u.isWebGL2?a("EXT_color_buffer_float"):(a("WEBGL_depth_texture"),a("OES_texture_float"),a("OES_texture_half_float"),a("OES_texture_half_float_linear"),a("OES_standard_derivatives"),a("OES_element_index_uint"),a("OES_vertex_array_object"),a("ANGLE_instanced_arrays")),a("OES_texture_float_linear"),a("EXT_color_buffer_half_float"),a("WEBGL_multisampled_render_to_texture")},get:function(u){const d=a(u);return d===null&&console.warn("THREE.WebGLRenderer: "+u+" extension not supported."),d}}}function Rx(x,n,a,u){const d={},m=new WeakMap;function A($){const j=$.target;j.index!==null&&n.remove(j.index);for(const le in j.attributes)n.remove(j.attributes[le]);j.removeEventListener("dispose",A),delete d[j.id];const ne=m.get(j);ne&&(n.remove(ne),m.delete(j)),u.releaseStatesOfGeometry(j),j.isInstancedBufferGeometry===!0&&delete j._maxInstanceCount,a.memory.geometries--}function y($,j){return d[j.id]===!0||(j.addEventListener("dispose",A),d[j.id]=!0,a.memory.geometries++),j}function k($){const j=$.attributes;for(const le in j)n.update(j[le],34962);const ne=$.morphAttributes;for(const le in ne){const se=ne[le];for(let re=0,ye=se.length;re<ye;re++)n.update(se[re],34962)}}function N($){const j=[],ne=$.index,le=$.attributes.position;let se=0;if(ne!==null){const Be=ne.array;se=ne.version;for(let Ee=0,Me=Be.length;Ee<Me;Ee+=3){const Fe=Be[Ee+0],it=Be[Ee+1],yt=Be[Ee+2];j.push(Fe,it,it,yt,yt,Fe)}}else{const Be=le.array;se=le.version;for(let Ee=0,Me=Be.length/3-1;Ee<Me;Ee+=3){const Fe=Ee+0,it=Ee+1,yt=Ee+2;j.push(Fe,it,it,yt,yt,Fe)}}const re=new(pp(j)?Fg:mp)(j,1);re.version=se;const ye=m.get($);ye&&n.remove(ye),m.set($,re)}function K($){const j=m.get($);if(j){const ne=$.index;ne!==null&&j.version<ne.version&&N($)}else N($);return m.get($)}return{get:y,update:k,getWireframeAttribute:K}}function t0(x,n,a,u){const d=u.isWebGL2;let m;function A(j){m=j}let y,k;function N(j){y=j.type,k=j.bytesPerElement}function K(j,ne){x.drawElements(m,ne,y,j*k),a.update(ne,m,1)}function $(j,ne,le){if(le===0)return;let se,re;if(d)se=x,re="drawElementsInstanced";else if(se=n.get("ANGLE_instanced_arrays"),re="drawElementsInstancedANGLE",se===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}se[re](m,ne,y,j*k,le),a.update(ne,m,le)}this.setMode=A,this.setIndex=N,this.render=K,this.renderInstances=$}function Bx(x){const n={geometries:0,textures:0},a={frame:0,calls:0,triangles:0,points:0,lines:0};function u(m,A,y){switch(a.calls++,A){case 4:a.triangles+=y*(m/3);break;case 1:a.lines+=y*(m/2);break;case 3:a.lines+=y*(m-1);break;case 2:a.lines+=y*m;break;case 0:a.points+=y*m;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",A);break}}function d(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0}return{memory:n,render:a,programs:null,autoReset:!0,reset:d,update:u}}function R1(x,n){return x[0]-n[0]}function kx(x,n){return Math.abs(n[1])-Math.abs(x[1])}function Lx(x,n,a){const u={},d=new Float32Array(8),m=new WeakMap,A=new es,y=[];for(let N=0;N<8;N++)y[N]=[N,0];function k(N,K,$,j){const ne=N.morphTargetInfluences;if(n.isWebGL2===!0){const se=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,re=se!==void 0?se.length:0;let ye=m.get(K);if(ye===void 0||ye.count!==re){let bn=function(){_t.dispose(),m.delete(K),K.removeEventListener("dispose",bn)};var le=bn;ye!==void 0&&ye.texture.dispose();const Me=K.morphAttributes.position!==void 0,Fe=K.morphAttributes.normal!==void 0,it=K.morphAttributes.color!==void 0,yt=K.morphAttributes.position||[],Le=K.morphAttributes.normal||[],at=K.morphAttributes.color||[];let mt=0;Me===!0&&(mt=1),Fe===!0&&(mt=2),it===!0&&(mt=3);let Dt=K.attributes.position.count*mt,on=1;Dt>n.maxTextureSize&&(on=Math.ceil(Dt/n.maxTextureSize),Dt=n.maxTextureSize);const Ut=new Float32Array(Dt*on*4*re),_t=new Mu(Ut,Dt,on,re);_t.type=ti,_t.needsUpdate=!0;const Qt=mt*4;for(let je=0;je<re;je++){const Zt=yt[je],Qn=Le[je],Kn=at[je],xi=Dt*on*4*je;for(let li=0;li<Zt.count;li++){const pn=li*Qt;Me===!0&&(A.fromBufferAttribute(Zt,li),Ut[xi+pn+0]=A.x,Ut[xi+pn+1]=A.y,Ut[xi+pn+2]=A.z,Ut[xi+pn+3]=0),Fe===!0&&(A.fromBufferAttribute(Qn,li),Ut[xi+pn+4]=A.x,Ut[xi+pn+5]=A.y,Ut[xi+pn+6]=A.z,Ut[xi+pn+7]=0),it===!0&&(A.fromBufferAttribute(Kn,li),Ut[xi+pn+8]=A.x,Ut[xi+pn+9]=A.y,Ut[xi+pn+10]=A.z,Ut[xi+pn+11]=Kn.itemSize===4?A.w:1)}}ye={count:re,texture:_t,size:new kn(Dt,on)},m.set(K,ye),K.addEventListener("dispose",bn)}let Be=0;for(let Me=0;Me<ne.length;Me++)Be+=ne[Me];const Ee=K.morphTargetsRelative?1:1-Be;j.getUniforms().setValue(x,"morphTargetBaseInfluence",Ee),j.getUniforms().setValue(x,"morphTargetInfluences",ne),j.getUniforms().setValue(x,"morphTargetsTexture",ye.texture,a),j.getUniforms().setValue(x,"morphTargetsTextureSize",ye.size)}else{const se=ne===void 0?0:ne.length;let re=u[K.id];if(re===void 0||re.length!==se){re=[];for(let Fe=0;Fe<se;Fe++)re[Fe]=[Fe,0];u[K.id]=re}for(let Fe=0;Fe<se;Fe++){const it=re[Fe];it[0]=Fe,it[1]=ne[Fe]}re.sort(kx);for(let Fe=0;Fe<8;Fe++)Fe<se&&re[Fe][1]?(y[Fe][0]=re[Fe][0],y[Fe][1]=re[Fe][1]):(y[Fe][0]=Number.MAX_SAFE_INTEGER,y[Fe][1]=0);y.sort(R1);const ye=K.morphAttributes.position,Be=K.morphAttributes.normal;let Ee=0;for(let Fe=0;Fe<8;Fe++){const it=y[Fe],yt=it[0],Le=it[1];yt!==Number.MAX_SAFE_INTEGER&&Le?(ye&&K.getAttribute("morphTarget"+Fe)!==ye[yt]&&K.setAttribute("morphTarget"+Fe,ye[yt]),Be&&K.getAttribute("morphNormal"+Fe)!==Be[yt]&&K.setAttribute("morphNormal"+Fe,Be[yt]),d[Fe]=Le,Ee+=Le):(ye&&K.hasAttribute("morphTarget"+Fe)===!0&&K.deleteAttribute("morphTarget"+Fe),Be&&K.hasAttribute("morphNormal"+Fe)===!0&&K.deleteAttribute("morphNormal"+Fe),d[Fe]=0)}const Me=K.morphTargetsRelative?1:1-Ee;j.getUniforms().setValue(x,"morphTargetBaseInfluence",Me),j.getUniforms().setValue(x,"morphTargetInfluences",d)}}return{update:k}}function Dx(x,n,a,u){let d=new WeakMap;function m(k){const N=u.render.frame,K=k.geometry,$=n.get(k,K);return d.get($)!==N&&(n.update($),d.set($,N)),k.isInstancedMesh&&(k.hasEventListener("dispose",y)===!1&&k.addEventListener("dispose",y),a.update(k.instanceMatrix,34962),k.instanceColor!==null&&a.update(k.instanceColor,34962)),$}function A(){d=new WeakMap}function y(k){const N=k.target;N.removeEventListener("dispose",y),a.remove(N.instanceMatrix),N.instanceColor!==null&&a.remove(N.instanceColor)}return{update:m,dispose:A}}const n0=new Ws,B1=new Mu,k1=new so,L1=new rc,Qf=[],D1=[],i0=new Float32Array(16),N1=new Float32Array(9),Zf=new Float32Array(4);function Rd(x,n,a){const u=x[0];if(u<=0||u>0)return x;const d=n*a;let m=Qf[d];if(m===void 0&&(m=new Float32Array(d),Qf[d]=m),n!==0){u.toArray(m,0);for(let A=1,y=0;A!==n;++A)y+=a,x[A].toArray(m,y)}return m}function Ka(x,n){if(x.length!==n.length)return!1;for(let a=0,u=x.length;a<u;a++)if(x[a]!==n[a])return!1;return!0}function qa(x,n){for(let a=0,u=n.length;a<u;a++)x[a]=n[a]}function $f(x,n){let a=D1[n];a===void 0&&(a=new Int32Array(n),D1[n]=a);for(let u=0;u!==n;++u)a[u]=x.allocateTextureUnit();return a}function Nx(x,n){const a=this.cache;a[0]!==n&&(x.uniform1f(this.addr,n),a[0]=n)}function r0(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y)&&(x.uniform2f(this.addr,n.x,n.y),a[0]=n.x,a[1]=n.y);else{if(Ka(a,n))return;x.uniform2fv(this.addr,n),qa(a,n)}}function Fx(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z)&&(x.uniform3f(this.addr,n.x,n.y,n.z),a[0]=n.x,a[1]=n.y,a[2]=n.z);else if(n.r!==void 0)(a[0]!==n.r||a[1]!==n.g||a[2]!==n.b)&&(x.uniform3f(this.addr,n.r,n.g,n.b),a[0]=n.r,a[1]=n.g,a[2]=n.b);else{if(Ka(a,n))return;x.uniform3fv(this.addr,n),qa(a,n)}}function Px(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z||a[3]!==n.w)&&(x.uniform4f(this.addr,n.x,n.y,n.z,n.w),a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=n.w);else{if(Ka(a,n))return;x.uniform4fv(this.addr,n),qa(a,n)}}function Ox(x,n){const a=this.cache,u=n.elements;if(u===void 0){if(Ka(a,n))return;x.uniformMatrix2fv(this.addr,!1,n),qa(a,n)}else{if(Ka(a,u))return;Zf.set(u),x.uniformMatrix2fv(this.addr,!1,Zf),qa(a,u)}}function Cc(x,n){const a=this.cache,u=n.elements;if(u===void 0){if(Ka(a,n))return;x.uniformMatrix3fv(this.addr,!1,n),qa(a,n)}else{if(Ka(a,u))return;N1.set(u),x.uniformMatrix3fv(this.addr,!1,N1),qa(a,u)}}function Gx(x,n){const a=this.cache,u=n.elements;if(u===void 0){if(Ka(a,n))return;x.uniformMatrix4fv(this.addr,!1,n),qa(a,n)}else{if(Ka(a,u))return;i0.set(u),x.uniformMatrix4fv(this.addr,!1,i0),qa(a,u)}}function el(x,n){const a=this.cache;a[0]!==n&&(x.uniform1i(this.addr,n),a[0]=n)}function Ux(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y)&&(x.uniform2i(this.addr,n.x,n.y),a[0]=n.x,a[1]=n.y);else{if(Ka(a,n))return;x.uniform2iv(this.addr,n),qa(a,n)}}function ns(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z)&&(x.uniform3i(this.addr,n.x,n.y,n.z),a[0]=n.x,a[1]=n.y,a[2]=n.z);else{if(Ka(a,n))return;x.uniform3iv(this.addr,n),qa(a,n)}}function Vx(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z||a[3]!==n.w)&&(x.uniform4i(this.addr,n.x,n.y,n.z,n.w),a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=n.w);else{if(Ka(a,n))return;x.uniform4iv(this.addr,n),qa(a,n)}}function zx(x,n){const a=this.cache;a[0]!==n&&(x.uniform1ui(this.addr,n),a[0]=n)}function Wx(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y)&&(x.uniform2ui(this.addr,n.x,n.y),a[0]=n.x,a[1]=n.y);else{if(Ka(a,n))return;x.uniform2uiv(this.addr,n),qa(a,n)}}function Hx(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z)&&(x.uniform3ui(this.addr,n.x,n.y,n.z),a[0]=n.x,a[1]=n.y,a[2]=n.z);else{if(Ka(a,n))return;x.uniform3uiv(this.addr,n),qa(a,n)}}function Kx(x,n){const a=this.cache;if(n.x!==void 0)(a[0]!==n.x||a[1]!==n.y||a[2]!==n.z||a[3]!==n.w)&&(x.uniform4ui(this.addr,n.x,n.y,n.z,n.w),a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=n.w);else{if(Ka(a,n))return;x.uniform4uiv(this.addr,n),qa(a,n)}}function jf(x,n,a){const u=this.cache,d=a.allocateTextureUnit();u[0]!==d&&(x.uniform1i(this.addr,d),u[0]=d),a.setTexture2D(n||n0,d)}function Xx(x,n,a){const u=this.cache,d=a.allocateTextureUnit();u[0]!==d&&(x.uniform1i(this.addr,d),u[0]=d),a.setTexture3D(n||k1,d)}function Qx(x,n,a){const u=this.cache,d=a.allocateTextureUnit();u[0]!==d&&(x.uniform1i(this.addr,d),u[0]=d),a.setTextureCube(n||L1,d)}function s0(x,n,a){const u=this.cache,d=a.allocateTextureUnit();u[0]!==d&&(x.uniform1i(this.addr,d),u[0]=d),a.setTexture2DArray(n||B1,d)}function F1(x){switch(x){case 5126:return Nx;case 35664:return r0;case 35665:return Fx;case 35666:return Px;case 35674:return Ox;case 35675:return Cc;case 35676:return Gx;case 5124:case 35670:return el;case 35667:case 35671:return Ux;case 35668:case 35672:return ns;case 35669:case 35673:return Vx;case 5125:return zx;case 36294:return Wx;case 36295:return Hx;case 36296:return Kx;case 35678:case 36198:case 36298:case 36306:case 35682:return jf;case 35679:case 36299:case 36307:return Xx;case 35680:case 36300:case 36308:case 36293:return Qx;case 36289:case 36303:case 36311:case 36292:return s0}}function Xa(x,n){x.uniform1fv(this.addr,n)}function Da(x,n){const a=Rd(n,this.size,2);x.uniform2fv(this.addr,a)}function co(x,n){const a=Rd(n,this.size,3);x.uniform3fv(this.addr,a)}function ha(x,n){const a=Rd(n,this.size,4);x.uniform4fv(this.addr,a)}function Nu(x,n){const a=Rd(n,this.size,4);x.uniformMatrix2fv(this.addr,!1,a)}function wa(x,n){const a=Rd(n,this.size,9);x.uniformMatrix3fv(this.addr,!1,a)}function Zx(x,n){const a=Rd(n,this.size,16);x.uniformMatrix4fv(this.addr,!1,a)}function wc(x,n){x.uniform1iv(this.addr,n)}function $x(x,n){x.uniform2iv(this.addr,n)}function a0(x,n){x.uniform3iv(this.addr,n)}function jx(x,n){x.uniform4iv(this.addr,n)}function Bd(x,n){x.uniform1uiv(this.addr,n)}function xs(x,n){x.uniform2uiv(this.addr,n)}function Yx(x,n){x.uniform3uiv(this.addr,n)}function ko(x,n){x.uniform4uiv(this.addr,n)}function Jx(x,n,a){const u=this.cache,d=n.length,m=$f(a,d);Ka(u,m)||(x.uniform1iv(this.addr,m),qa(u,m));for(let A=0;A!==d;++A)a.setTexture2D(n[A]||n0,m[A])}function Qs(x,n,a){const u=this.cache,d=n.length,m=$f(a,d);Ka(u,m)||(x.uniform1iv(this.addr,m),qa(u,m));for(let A=0;A!==d;++A)a.setTexture3D(n[A]||k1,m[A])}function qx(x,n,a){const u=this.cache,d=n.length,m=$f(a,d);Ka(u,m)||(x.uniform1iv(this.addr,m),qa(u,m));for(let A=0;A!==d;++A)a.setTextureCube(n[A]||L1,m[A])}function Ji(x,n,a){const u=this.cache,d=n.length,m=$f(a,d);Ka(u,m)||(x.uniform1iv(this.addr,m),qa(u,m));for(let A=0;A!==d;++A)a.setTexture2DArray(n[A]||B1,m[A])}function e2(x){switch(x){case 5126:return Xa;case 35664:return Da;case 35665:return co;case 35666:return ha;case 35674:return Nu;case 35675:return wa;case 35676:return Zx;case 5124:case 35670:return wc;case 35667:case 35671:return $x;case 35668:case 35672:return a0;case 35669:case 35673:return jx;case 5125:return Bd;case 36294:return xs;case 36295:return Yx;case 36296:return ko;case 35678:case 36198:case 36298:case 36306:case 35682:return Jx;case 35679:case 36299:case 36307:return Qs;case 35680:case 36300:case 36308:case 36293:return qx;case 36289:case 36303:case 36311:case 36292:return Ji}}class P1{constructor(n,a,u){this.id=n,this.addr=u,this.cache=[],this.setValue=F1(a.type)}}class Yf{constructor(n,a,u){this.id=n,this.addr=u,this.cache=[],this.size=a.size,this.setValue=e2(a.type)}}class t2{constructor(n){this.id=n,this.seq=[],this.map={}}setValue(n,a,u){const d=this.seq;for(let m=0,A=d.length;m!==A;++m){const y=d[m];y.setValue(n,a[y.id],u)}}}const o0=/(\w+)(\])?(\[|\.)?/g;function O1(x,n){x.seq.push(n),x.map[n.id]=n}function $c(x,n,a){const u=x.name,d=u.length;for(o0.lastIndex=0;;){const m=o0.exec(u),A=o0.lastIndex;let y=m[1];const k=m[2]==="]",N=m[3];if(k&&(y=y|0),N===void 0||N==="["&&A+2===d){O1(a,N===void 0?new P1(y,x,n):new Yf(y,x,n));break}else{let $=a.map[y];$===void 0&&($=new t2(y),O1(a,$)),a=$}}}class Jf{constructor(n,a){this.seq=[],this.map={};const u=n.getProgramParameter(a,35718);for(let d=0;d<u;++d){const m=n.getActiveUniform(a,d),A=n.getUniformLocation(a,m.name);$c(m,A,this)}}setValue(n,a,u,d){const m=this.map[a];m!==void 0&&m.setValue(n,u,d)}setOptional(n,a,u){const d=a[u];d!==void 0&&this.setValue(n,u,d)}static upload(n,a,u,d){for(let m=0,A=a.length;m!==A;++m){const y=a[m],k=u[y.id];k.needsUpdate!==!1&&y.setValue(n,k.value,d)}}static seqWithValue(n,a){const u=[];for(let d=0,m=n.length;d!==m;++d){const A=n[d];A.id in a&&u.push(A)}return u}}function xl(x,n,a){const u=x.createShader(n);return x.shaderSource(u,a),x.compileShader(u),u}let n2=0;function i2(x,n){const a=x.split(`
`),u=[],d=Math.max(n-6,0),m=Math.min(n+6,a.length);for(let A=d;A<m;A++){const y=A+1;u.push(`${y===n?">":" "} ${y}: ${a[A]}`)}return u.join(`
`)}function r2(x){switch(x){case Qr:return["Linear","( value )"];case gr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",x),["Linear","( value )"]}}function Ul(x,n,a){const u=x.getShaderParameter(n,35713),d=x.getShaderInfoLog(n).trim();if(u&&d==="")return"";const m=/ERROR: 0:(\d+)/.exec(d);if(m){const A=parseInt(m[1]);return a.toUpperCase()+`

`+d+`

`+i2(x.getShaderSource(n),A)}else return d}function s2(x,n){const a=r2(n);return"vec4 "+x+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function G1(x,n){let a;switch(n){case Dn:a="Linear";break;case gn:a="Reinhard";break;case ui:a="OptimizedCineon";break;case Nt:a="ACESFilmic";break;case De:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),a="Linear"}return"vec3 "+x+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function a2(x){return[x.extensionDerivatives||x.envMapCubeUVHeight||x.bumpMap||x.tangentSpaceNormalMap||x.clearcoatNormalMap||x.flatShading||x.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(x.extensionFragDepth||x.logarithmicDepthBuffer)&&x.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",x.extensionDrawBuffers&&x.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(x.extensionShaderTextureLOD||x.envMap||x.transmission)&&x.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Dh).join(`
`)}function qf(x){const n=[];for(const a in x){const u=x[a];u!==!1&&n.push("#define "+a+" "+u)}return n.join(`
`)}function o2(x,n){const a={},u=x.getProgramParameter(n,35721);for(let d=0;d<u;d++){const m=x.getActiveAttrib(n,d),A=m.name;let y=1;m.type===35674&&(y=2),m.type===35675&&(y=3),m.type===35676&&(y=4),a[A]={type:m.type,location:x.getAttribLocation(n,A),locationSize:y}}return a}function Dh(x){return x!==""}function U1(x,n){const a=n.numSpotLightShadows+n.numSpotLightMaps-n.numSpotLightShadowsWithMaps;return x.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,n.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,a).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,n.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function Cl(x,n){return x.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const l2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fu(x){return x.replace(l2,c2)}function c2(x,n){const a=Gr[n];if(a===void 0)throw new Error("Can not resolve #include <"+n+">");return Fu(a)}const u2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function V1(x){return x.replace(u2,h2)}function h2(x,n,a,u){let d="";for(let m=parseInt(n);m<parseInt(a);m++)d+=u.replace(/\[\s*i\s*\]/g,"[ "+m+" ]").replace(/UNROLLED_LOOP_INDEX/g,m);return d}function z1(x){let n="precision "+x.precision+` float;
precision `+x.precision+" int;";return x.precision==="highp"?n+=`
#define HIGH_PRECISION`:x.precision==="mediump"?n+=`
#define MEDIUM_PRECISION`:x.precision==="lowp"&&(n+=`
#define LOW_PRECISION`),n}function d2(x){let n="SHADOWMAP_TYPE_BASIC";return x.shadowMapType===I?n="SHADOWMAP_TYPE_PCF":x.shadowMapType===O?n="SHADOWMAP_TYPE_PCF_SOFT":x.shadowMapType===_&&(n="SHADOWMAP_TYPE_VSM"),n}function p2(x){let n="ENVMAP_TYPE_CUBE";if(x.envMap)switch(x.envMapMode){case We:case Oe:n="ENVMAP_TYPE_CUBE";break;case vt:n="ENVMAP_TYPE_CUBE_UV";break}return n}function l0(x){let n="ENVMAP_MODE_REFLECTION";if(x.envMap)switch(x.envMapMode){case Oe:n="ENVMAP_MODE_REFRACTION";break}return n}function f2(x){let n="ENVMAP_BLENDING_NONE";if(x.envMap)switch(x.combine){case Ye:n="ENVMAP_BLENDING_MULTIPLY";break;case mn:n="ENVMAP_BLENDING_MIX";break;case Pn:n="ENVMAP_BLENDING_ADD";break}return n}function W1(x){const n=x.envMapCubeUVHeight;if(n===null)return null;const a=Math.log2(n)-2,u=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,a),7*16)),texelHeight:u,maxMip:a}}function m2(x,n,a,u){const d=x.getContext(),m=a.defines;let A=a.vertexShader,y=a.fragmentShader;const k=d2(a),N=p2(a),K=l0(a),$=f2(a),j=W1(a),ne=a.isWebGL2?"":a2(a),le=qf(m),se=d.createProgram();let re,ye,Be=a.glslVersion?"#version "+a.glslVersion+`
`:"";a.isRawShaderMaterial?(re=[le].filter(Dh).join(`
`),re.length>0&&(re+=`
`),ye=[ne,le].filter(Dh).join(`
`),ye.length>0&&(ye+=`
`)):(re=[z1(a),"#define SHADER_NAME "+a.shaderName,le,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+K:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",a.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&a.flatShading===!1?"#define USE_MORPHNORMALS":"",a.morphColors&&a.isWebGL2?"#define USE_MORPHCOLORS":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+a.morphTextureStride:"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+k:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Dh).join(`
`),ye=[ne,z1(a),"#define SHADER_NAME "+a.shaderName,le,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+N:"",a.envMap?"#define "+K:"",a.envMap?"#define "+$:"",j?"#define CUBEUV_TEXEL_WIDTH "+j.texelWidth:"",j?"#define CUBEUV_TEXEL_HEIGHT "+j.texelHeight:"",j?"#define CUBEUV_MAX_MIP "+j.maxMip+".0":"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.iridescence?"#define USE_IRIDESCENCE":"",a.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",a.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+k:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==wn?"#define TONE_MAPPING":"",a.toneMapping!==wn?Gr.tonemapping_pars_fragment:"",a.toneMapping!==wn?G1("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.opaque?"#define OPAQUE":"",Gr.encodings_pars_fragment,s2("linearToOutputTexel",a.outputEncoding),a.useDepthPacking?"#define DEPTH_PACKING "+a.depthPacking:"",`
`].filter(Dh).join(`
`)),A=Fu(A),A=U1(A,a),A=Cl(A,a),y=Fu(y),y=U1(y,a),y=Cl(y,a),A=V1(A),y=V1(y),a.isWebGL2&&a.isRawShaderMaterial!==!0&&(Be=`#version 300 es
`,re=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+re,ye=["#define varying in",a.glslVersion===Cu?"":"layout(location = 0) out highp vec4 pc_fragColor;",a.glslVersion===Cu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ye);const Ee=Be+re+A,Me=Be+ye+y,Fe=xl(d,35633,Ee),it=xl(d,35632,Me);if(d.attachShader(se,Fe),d.attachShader(se,it),a.index0AttributeName!==void 0?d.bindAttribLocation(se,0,a.index0AttributeName):a.morphTargets===!0&&d.bindAttribLocation(se,0,"position"),d.linkProgram(se),x.debug.checkShaderErrors){const at=d.getProgramInfoLog(se).trim(),mt=d.getShaderInfoLog(Fe).trim(),Dt=d.getShaderInfoLog(it).trim();let on=!0,Ut=!0;if(d.getProgramParameter(se,35714)===!1){on=!1;const _t=Ul(d,Fe,"vertex"),Qt=Ul(d,it,"fragment");console.error("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(se,35715)+`

Program Info Log: `+at+`
`+_t+`
`+Qt)}else at!==""?console.warn("THREE.WebGLProgram: Program Info Log:",at):(mt===""||Dt==="")&&(Ut=!1);Ut&&(this.diagnostics={runnable:on,programLog:at,vertexShader:{log:mt,prefix:re},fragmentShader:{log:Dt,prefix:ye}})}d.deleteShader(Fe),d.deleteShader(it);let yt;this.getUniforms=function(){return yt===void 0&&(yt=new Jf(d,se)),yt};let Le;return this.getAttributes=function(){return Le===void 0&&(Le=o2(d,se)),Le},this.destroy=function(){u.releaseStatesOfProgram(this),d.deleteProgram(se),this.program=void 0},this.name=a.shaderName,this.id=n2++,this.cacheKey=n,this.usedTimes=1,this.program=se,this.vertexShader=Fe,this.fragmentShader=it,this}let kd=0;class g2{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(n){const a=n.vertexShader,u=n.fragmentShader,d=this._getShaderStage(a),m=this._getShaderStage(u),A=this._getShaderCacheForMaterial(n);return A.has(d)===!1&&(A.add(d),d.usedTimes++),A.has(m)===!1&&(A.add(m),m.usedTimes++),this}remove(n){const a=this.materialCache.get(n);for(const u of a)u.usedTimes--,u.usedTimes===0&&this.shaderCache.delete(u.code);return this.materialCache.delete(n),this}getVertexShaderID(n){return this._getShaderStage(n.vertexShader).id}getFragmentShaderID(n){return this._getShaderStage(n.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(n){const a=this.materialCache;let u=a.get(n);return u===void 0&&(u=new Set,a.set(n,u)),u}_getShaderStage(n){const a=this.shaderCache;let u=a.get(n);return u===void 0&&(u=new A2(n),a.set(n,u)),u}}class A2{constructor(n){this.id=kd++,this.code=n,this.usedTimes=0}}function v2(x,n,a,u,d,m,A){const y=new jr,k=new g2,N=[],K=d.isWebGL2,$=d.logarithmicDepthBuffer,j=d.vertexTextures;let ne=d.precision;const le={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function se(Le,at,mt,Dt,on){const Ut=Dt.fog,_t=on.geometry,Qt=Le.isMeshStandardMaterial?Dt.environment:null,bn=(Le.isMeshStandardMaterial?a:n).get(Le.envMap||Qt),je=bn&&bn.mapping===vt?bn.image.height:null,Zt=le[Le.type];Le.precision!==null&&(ne=d.getMaxPrecision(Le.precision),ne!==Le.precision&&console.warn("THREE.WebGLProgram.getParameters:",Le.precision,"not supported, using",ne,"instead."));const Qn=_t.morphAttributes.position||_t.morphAttributes.normal||_t.morphAttributes.color,Kn=Qn!==void 0?Qn.length:0;let xi=0;_t.morphAttributes.position!==void 0&&(xi=1),_t.morphAttributes.normal!==void 0&&(xi=2),_t.morphAttributes.color!==void 0&&(xi=3);let li,pn,Rn,Vn;if(Zt){const Mr=qo[Zt];li=Mr.vertexShader,pn=Mr.fragmentShader}else li=Le.vertexShader,pn=Le.fragmentShader,k.update(Le),Rn=k.getVertexShaderID(Le),Vn=k.getFragmentShaderID(Le);const Jt=x.getRenderTarget(),Ei=Le.alphaTest>0,ii=Le.clearcoat>0,tr=Le.iridescence>0;return{isWebGL2:K,shaderID:Zt,shaderName:Le.type,vertexShader:li,fragmentShader:pn,defines:Le.defines,customVertexShaderID:Rn,customFragmentShaderID:Vn,isRawShaderMaterial:Le.isRawShaderMaterial===!0,glslVersion:Le.glslVersion,precision:ne,instancing:on.isInstancedMesh===!0,instancingColor:on.isInstancedMesh===!0&&on.instanceColor!==null,supportsVertexTextures:j,outputEncoding:Jt===null?x.outputEncoding:Jt.isXRRenderTarget===!0?Jt.texture.encoding:Qr,map:!!Le.map,matcap:!!Le.matcap,envMap:!!bn,envMapMode:bn&&bn.mapping,envMapCubeUVHeight:je,lightMap:!!Le.lightMap,aoMap:!!Le.aoMap,emissiveMap:!!Le.emissiveMap,bumpMap:!!Le.bumpMap,normalMap:!!Le.normalMap,objectSpaceNormalMap:Le.normalMapType===Ua,tangentSpaceNormalMap:Le.normalMapType===Ps,decodeVideoTexture:!!Le.map&&Le.map.isVideoTexture===!0&&Le.map.encoding===gr,clearcoat:ii,clearcoatMap:ii&&!!Le.clearcoatMap,clearcoatRoughnessMap:ii&&!!Le.clearcoatRoughnessMap,clearcoatNormalMap:ii&&!!Le.clearcoatNormalMap,iridescence:tr,iridescenceMap:tr&&!!Le.iridescenceMap,iridescenceThicknessMap:tr&&!!Le.iridescenceThicknessMap,displacementMap:!!Le.displacementMap,roughnessMap:!!Le.roughnessMap,metalnessMap:!!Le.metalnessMap,specularMap:!!Le.specularMap,specularIntensityMap:!!Le.specularIntensityMap,specularColorMap:!!Le.specularColorMap,opaque:Le.transparent===!1&&Le.blending===W,alphaMap:!!Le.alphaMap,alphaTest:Ei,gradientMap:!!Le.gradientMap,sheen:Le.sheen>0,sheenColorMap:!!Le.sheenColorMap,sheenRoughnessMap:!!Le.sheenRoughnessMap,transmission:Le.transmission>0,transmissionMap:!!Le.transmissionMap,thicknessMap:!!Le.thicknessMap,combine:Le.combine,vertexTangents:!!Le.normalMap&&!!_t.attributes.tangent,vertexColors:Le.vertexColors,vertexAlphas:Le.vertexColors===!0&&!!_t.attributes.color&&_t.attributes.color.itemSize===4,vertexUvs:!!Le.map||!!Le.bumpMap||!!Le.normalMap||!!Le.specularMap||!!Le.alphaMap||!!Le.emissiveMap||!!Le.roughnessMap||!!Le.metalnessMap||!!Le.clearcoatMap||!!Le.clearcoatRoughnessMap||!!Le.clearcoatNormalMap||!!Le.iridescenceMap||!!Le.iridescenceThicknessMap||!!Le.displacementMap||!!Le.transmissionMap||!!Le.thicknessMap||!!Le.specularIntensityMap||!!Le.specularColorMap||!!Le.sheenColorMap||!!Le.sheenRoughnessMap,uvsVertexOnly:!(Le.map||Le.bumpMap||Le.normalMap||Le.specularMap||Le.alphaMap||Le.emissiveMap||Le.roughnessMap||Le.metalnessMap||Le.clearcoatNormalMap||Le.iridescenceMap||Le.iridescenceThicknessMap||Le.transmission>0||Le.transmissionMap||Le.thicknessMap||Le.specularIntensityMap||Le.specularColorMap||Le.sheen>0||Le.sheenColorMap||Le.sheenRoughnessMap)&&!!Le.displacementMap,fog:!!Ut,useFog:Le.fog===!0,fogExp2:Ut&&Ut.isFogExp2,flatShading:!!Le.flatShading,sizeAttenuation:Le.sizeAttenuation,logarithmicDepthBuffer:$,skinning:on.isSkinnedMesh===!0,morphTargets:_t.morphAttributes.position!==void 0,morphNormals:_t.morphAttributes.normal!==void 0,morphColors:_t.morphAttributes.color!==void 0,morphTargetsCount:Kn,morphTextureStride:xi,numDirLights:at.directional.length,numPointLights:at.point.length,numSpotLights:at.spot.length,numSpotLightMaps:at.spotLightMap.length,numRectAreaLights:at.rectArea.length,numHemiLights:at.hemi.length,numDirLightShadows:at.directionalShadowMap.length,numPointLightShadows:at.pointShadowMap.length,numSpotLightShadows:at.spotShadowMap.length,numSpotLightShadowsWithMaps:at.numSpotLightShadowsWithMaps,numClippingPlanes:A.numPlanes,numClipIntersection:A.numIntersection,dithering:Le.dithering,shadowMapEnabled:x.shadowMap.enabled&&mt.length>0,shadowMapType:x.shadowMap.type,toneMapping:Le.toneMapped?x.toneMapping:wn,physicallyCorrectLights:x.physicallyCorrectLights,premultipliedAlpha:Le.premultipliedAlpha,doubleSided:Le.side===J,flipSided:Le.side===V,useDepthPacking:!!Le.depthPacking,depthPacking:Le.depthPacking||0,index0AttributeName:Le.index0AttributeName,extensionDerivatives:Le.extensions&&Le.extensions.derivatives,extensionFragDepth:Le.extensions&&Le.extensions.fragDepth,extensionDrawBuffers:Le.extensions&&Le.extensions.drawBuffers,extensionShaderTextureLOD:Le.extensions&&Le.extensions.shaderTextureLOD,rendererExtensionFragDepth:K||u.has("EXT_frag_depth"),rendererExtensionDrawBuffers:K||u.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:K||u.has("EXT_shader_texture_lod"),customProgramCacheKey:Le.customProgramCacheKey()}}function re(Le){const at=[];if(Le.shaderID?at.push(Le.shaderID):(at.push(Le.customVertexShaderID),at.push(Le.customFragmentShaderID)),Le.defines!==void 0)for(const mt in Le.defines)at.push(mt),at.push(Le.defines[mt]);return Le.isRawShaderMaterial===!1&&(ye(at,Le),Be(at,Le),at.push(x.outputEncoding)),at.push(Le.customProgramCacheKey),at.join()}function ye(Le,at){Le.push(at.precision),Le.push(at.outputEncoding),Le.push(at.envMapMode),Le.push(at.envMapCubeUVHeight),Le.push(at.combine),Le.push(at.vertexUvs),Le.push(at.fogExp2),Le.push(at.sizeAttenuation),Le.push(at.morphTargetsCount),Le.push(at.morphAttributeCount),Le.push(at.numDirLights),Le.push(at.numPointLights),Le.push(at.numSpotLights),Le.push(at.numSpotLightMaps),Le.push(at.numHemiLights),Le.push(at.numRectAreaLights),Le.push(at.numDirLightShadows),Le.push(at.numPointLightShadows),Le.push(at.numSpotLightShadows),Le.push(at.numSpotLightShadowsWithMaps),Le.push(at.shadowMapType),Le.push(at.toneMapping),Le.push(at.numClippingPlanes),Le.push(at.numClipIntersection),Le.push(at.depthPacking)}function Be(Le,at){y.disableAll(),at.isWebGL2&&y.enable(0),at.supportsVertexTextures&&y.enable(1),at.instancing&&y.enable(2),at.instancingColor&&y.enable(3),at.map&&y.enable(4),at.matcap&&y.enable(5),at.envMap&&y.enable(6),at.lightMap&&y.enable(7),at.aoMap&&y.enable(8),at.emissiveMap&&y.enable(9),at.bumpMap&&y.enable(10),at.normalMap&&y.enable(11),at.objectSpaceNormalMap&&y.enable(12),at.tangentSpaceNormalMap&&y.enable(13),at.clearcoat&&y.enable(14),at.clearcoatMap&&y.enable(15),at.clearcoatRoughnessMap&&y.enable(16),at.clearcoatNormalMap&&y.enable(17),at.iridescence&&y.enable(18),at.iridescenceMap&&y.enable(19),at.iridescenceThicknessMap&&y.enable(20),at.displacementMap&&y.enable(21),at.specularMap&&y.enable(22),at.roughnessMap&&y.enable(23),at.metalnessMap&&y.enable(24),at.gradientMap&&y.enable(25),at.alphaMap&&y.enable(26),at.alphaTest&&y.enable(27),at.vertexColors&&y.enable(28),at.vertexAlphas&&y.enable(29),at.vertexUvs&&y.enable(30),at.vertexTangents&&y.enable(31),at.uvsVertexOnly&&y.enable(32),Le.push(y.mask),y.disableAll(),at.fog&&y.enable(0),at.useFog&&y.enable(1),at.flatShading&&y.enable(2),at.logarithmicDepthBuffer&&y.enable(3),at.skinning&&y.enable(4),at.morphTargets&&y.enable(5),at.morphNormals&&y.enable(6),at.morphColors&&y.enable(7),at.premultipliedAlpha&&y.enable(8),at.shadowMapEnabled&&y.enable(9),at.physicallyCorrectLights&&y.enable(10),at.doubleSided&&y.enable(11),at.flipSided&&y.enable(12),at.useDepthPacking&&y.enable(13),at.dithering&&y.enable(14),at.specularIntensityMap&&y.enable(15),at.specularColorMap&&y.enable(16),at.transmission&&y.enable(17),at.transmissionMap&&y.enable(18),at.thicknessMap&&y.enable(19),at.sheen&&y.enable(20),at.sheenColorMap&&y.enable(21),at.sheenRoughnessMap&&y.enable(22),at.decodeVideoTexture&&y.enable(23),at.opaque&&y.enable(24),Le.push(y.mask)}function Ee(Le){const at=le[Le.type];let mt;if(at){const Dt=qo[at];mt=Gg.clone(Dt.uniforms)}else mt=Le.uniforms;return mt}function Me(Le,at){let mt;for(let Dt=0,on=N.length;Dt<on;Dt++){const Ut=N[Dt];if(Ut.cacheKey===at){mt=Ut,++mt.usedTimes;break}}return mt===void 0&&(mt=new m2(x,at,Le,m),N.push(mt)),mt}function Fe(Le){if(--Le.usedTimes===0){const at=N.indexOf(Le);N[at]=N[N.length-1],N.pop(),Le.destroy()}}function it(Le){k.remove(Le)}function yt(){k.dispose()}return{getParameters:se,getProgramCacheKey:re,getUniforms:Ee,acquireProgram:Me,releaseProgram:Fe,releaseShaderCache:it,programs:N,dispose:yt}}function Ec(){let x=new WeakMap;function n(m){let A=x.get(m);return A===void 0&&(A={},x.set(m,A)),A}function a(m){x.delete(m)}function u(m,A,y){x.get(m)[A]=y}function d(){x=new WeakMap}return{get:n,remove:a,update:u,dispose:d}}function y2(x,n){return x.groupOrder!==n.groupOrder?x.groupOrder-n.groupOrder:x.renderOrder!==n.renderOrder?x.renderOrder-n.renderOrder:x.material.id!==n.material.id?x.material.id-n.material.id:x.z!==n.z?x.z-n.z:x.id-n.id}function c0(x,n){return x.groupOrder!==n.groupOrder?x.groupOrder-n.groupOrder:x.renderOrder!==n.renderOrder?x.renderOrder-n.renderOrder:x.z!==n.z?n.z-x.z:x.id-n.id}function H1(){const x=[];let n=0;const a=[],u=[],d=[];function m(){n=0,a.length=0,u.length=0,d.length=0}function A($,j,ne,le,se,re){let ye=x[n];return ye===void 0?(ye={id:$.id,object:$,geometry:j,material:ne,groupOrder:le,renderOrder:$.renderOrder,z:se,group:re},x[n]=ye):(ye.id=$.id,ye.object=$,ye.geometry=j,ye.material=ne,ye.groupOrder=le,ye.renderOrder=$.renderOrder,ye.z=se,ye.group=re),n++,ye}function y($,j,ne,le,se,re){const ye=A($,j,ne,le,se,re);ne.transmission>0?u.push(ye):ne.transparent===!0?d.push(ye):a.push(ye)}function k($,j,ne,le,se,re){const ye=A($,j,ne,le,se,re);ne.transmission>0?u.unshift(ye):ne.transparent===!0?d.unshift(ye):a.unshift(ye)}function N($,j){a.length>1&&a.sort($||y2),u.length>1&&u.sort(j||c0),d.length>1&&d.sort(j||c0)}function K(){for(let $=n,j=x.length;$<j;$++){const ne=x[$];if(ne.id===null)break;ne.id=null,ne.object=null,ne.geometry=null,ne.material=null,ne.group=null}}return{opaque:a,transmissive:u,transparent:d,init:m,push:y,unshift:k,finish:K,sort:N}}function Ld(){let x=new WeakMap;function n(u,d){const m=x.get(u);let A;return m===void 0?(A=new H1,x.set(u,[A])):d>=m.length?(A=new H1,m.push(A)):A=m[d],A}function a(){x=new WeakMap}return{get:n,dispose:a}}function b2(){const x={};return{get:function(n){if(x[n.id]!==void 0)return x[n.id];let a;switch(n.type){case"DirectionalLight":a={direction:new tt,color:new Si};break;case"SpotLight":a={position:new tt,direction:new tt,color:new Si,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new tt,color:new Si,distance:0,decay:0};break;case"HemisphereLight":a={direction:new tt,skyColor:new Si,groundColor:new Si};break;case"RectAreaLight":a={color:new Si,position:new tt,halfWidth:new tt,halfHeight:new tt};break}return x[n.id]=a,a}}}function wp(){const x={};return{get:function(n){if(x[n.id]!==void 0)return x[n.id];let a;switch(n.type){case"DirectionalLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn};break;case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kn,shadowCameraNear:1,shadowCameraFar:1e3};break}return x[n.id]=a,a}}}let x2=0;function C2(x,n){return(n.castShadow?2:0)-(x.castShadow?2:0)+(n.map?1:0)-(x.map?1:0)}function w2(x,n){const a=new b2,u=wp(),d={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let K=0;K<9;K++)d.probe.push(new tt);const m=new tt,A=new Ri,y=new Ri;function k(K,$){let j=0,ne=0,le=0;for(let Dt=0;Dt<9;Dt++)d.probe[Dt].set(0,0,0);let se=0,re=0,ye=0,Be=0,Ee=0,Me=0,Fe=0,it=0,yt=0,Le=0;K.sort(C2);const at=$!==!0?Math.PI:1;for(let Dt=0,on=K.length;Dt<on;Dt++){const Ut=K[Dt],_t=Ut.color,Qt=Ut.intensity,bn=Ut.distance,je=Ut.shadow&&Ut.shadow.map?Ut.shadow.map.texture:null;if(Ut.isAmbientLight)j+=_t.r*Qt*at,ne+=_t.g*Qt*at,le+=_t.b*Qt*at;else if(Ut.isLightProbe)for(let Zt=0;Zt<9;Zt++)d.probe[Zt].addScaledVector(Ut.sh.coefficients[Zt],Qt);else if(Ut.isDirectionalLight){const Zt=a.get(Ut);if(Zt.color.copy(Ut.color).multiplyScalar(Ut.intensity*at),Ut.castShadow){const Qn=Ut.shadow,Kn=u.get(Ut);Kn.shadowBias=Qn.bias,Kn.shadowNormalBias=Qn.normalBias,Kn.shadowRadius=Qn.radius,Kn.shadowMapSize=Qn.mapSize,d.directionalShadow[se]=Kn,d.directionalShadowMap[se]=je,d.directionalShadowMatrix[se]=Ut.shadow.matrix,Me++}d.directional[se]=Zt,se++}else if(Ut.isSpotLight){const Zt=a.get(Ut);Zt.position.setFromMatrixPosition(Ut.matrixWorld),Zt.color.copy(_t).multiplyScalar(Qt*at),Zt.distance=bn,Zt.coneCos=Math.cos(Ut.angle),Zt.penumbraCos=Math.cos(Ut.angle*(1-Ut.penumbra)),Zt.decay=Ut.decay,d.spot[ye]=Zt;const Qn=Ut.shadow;if(Ut.map&&(d.spotLightMap[yt]=Ut.map,yt++,Qn.updateMatrices(Ut),Ut.castShadow&&Le++),d.spotLightMatrix[ye]=Qn.matrix,Ut.castShadow){const Kn=u.get(Ut);Kn.shadowBias=Qn.bias,Kn.shadowNormalBias=Qn.normalBias,Kn.shadowRadius=Qn.radius,Kn.shadowMapSize=Qn.mapSize,d.spotShadow[ye]=Kn,d.spotShadowMap[ye]=je,it++}ye++}else if(Ut.isRectAreaLight){const Zt=a.get(Ut);Zt.color.copy(_t).multiplyScalar(Qt),Zt.halfWidth.set(Ut.width*.5,0,0),Zt.halfHeight.set(0,Ut.height*.5,0),d.rectArea[Be]=Zt,Be++}else if(Ut.isPointLight){const Zt=a.get(Ut);if(Zt.color.copy(Ut.color).multiplyScalar(Ut.intensity*at),Zt.distance=Ut.distance,Zt.decay=Ut.decay,Ut.castShadow){const Qn=Ut.shadow,Kn=u.get(Ut);Kn.shadowBias=Qn.bias,Kn.shadowNormalBias=Qn.normalBias,Kn.shadowRadius=Qn.radius,Kn.shadowMapSize=Qn.mapSize,Kn.shadowCameraNear=Qn.camera.near,Kn.shadowCameraFar=Qn.camera.far,d.pointShadow[re]=Kn,d.pointShadowMap[re]=je,d.pointShadowMatrix[re]=Ut.shadow.matrix,Fe++}d.point[re]=Zt,re++}else if(Ut.isHemisphereLight){const Zt=a.get(Ut);Zt.skyColor.copy(Ut.color).multiplyScalar(Qt*at),Zt.groundColor.copy(Ut.groundColor).multiplyScalar(Qt*at),d.hemi[Ee]=Zt,Ee++}}Be>0&&(n.isWebGL2||x.has("OES_texture_float_linear")===!0?(d.rectAreaLTC1=pi.LTC_FLOAT_1,d.rectAreaLTC2=pi.LTC_FLOAT_2):x.has("OES_texture_half_float_linear")===!0?(d.rectAreaLTC1=pi.LTC_HALF_1,d.rectAreaLTC2=pi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),d.ambient[0]=j,d.ambient[1]=ne,d.ambient[2]=le;const mt=d.hash;(mt.directionalLength!==se||mt.pointLength!==re||mt.spotLength!==ye||mt.rectAreaLength!==Be||mt.hemiLength!==Ee||mt.numDirectionalShadows!==Me||mt.numPointShadows!==Fe||mt.numSpotShadows!==it||mt.numSpotMaps!==yt)&&(d.directional.length=se,d.spot.length=ye,d.rectArea.length=Be,d.point.length=re,d.hemi.length=Ee,d.directionalShadow.length=Me,d.directionalShadowMap.length=Me,d.pointShadow.length=Fe,d.pointShadowMap.length=Fe,d.spotShadow.length=it,d.spotShadowMap.length=it,d.directionalShadowMatrix.length=Me,d.pointShadowMatrix.length=Fe,d.spotLightMatrix.length=it+yt-Le,d.spotLightMap.length=yt,d.numSpotLightShadowsWithMaps=Le,mt.directionalLength=se,mt.pointLength=re,mt.spotLength=ye,mt.rectAreaLength=Be,mt.hemiLength=Ee,mt.numDirectionalShadows=Me,mt.numPointShadows=Fe,mt.numSpotShadows=it,mt.numSpotMaps=yt,d.version=x2++)}function N(K,$){let j=0,ne=0,le=0,se=0,re=0;const ye=$.matrixWorldInverse;for(let Be=0,Ee=K.length;Be<Ee;Be++){const Me=K[Be];if(Me.isDirectionalLight){const Fe=d.directional[j];Fe.direction.setFromMatrixPosition(Me.matrixWorld),m.setFromMatrixPosition(Me.target.matrixWorld),Fe.direction.sub(m),Fe.direction.transformDirection(ye),j++}else if(Me.isSpotLight){const Fe=d.spot[le];Fe.position.setFromMatrixPosition(Me.matrixWorld),Fe.position.applyMatrix4(ye),Fe.direction.setFromMatrixPosition(Me.matrixWorld),m.setFromMatrixPosition(Me.target.matrixWorld),Fe.direction.sub(m),Fe.direction.transformDirection(ye),le++}else if(Me.isRectAreaLight){const Fe=d.rectArea[se];Fe.position.setFromMatrixPosition(Me.matrixWorld),Fe.position.applyMatrix4(ye),y.identity(),A.copy(Me.matrixWorld),A.premultiply(ye),y.extractRotation(A),Fe.halfWidth.set(Me.width*.5,0,0),Fe.halfHeight.set(0,Me.height*.5,0),Fe.halfWidth.applyMatrix4(y),Fe.halfHeight.applyMatrix4(y),se++}else if(Me.isPointLight){const Fe=d.point[ne];Fe.position.setFromMatrixPosition(Me.matrixWorld),Fe.position.applyMatrix4(ye),ne++}else if(Me.isHemisphereLight){const Fe=d.hemi[re];Fe.direction.setFromMatrixPosition(Me.matrixWorld),Fe.direction.transformDirection(ye),re++}}}return{setup:k,setupView:N,state:d}}function mr(x,n){const a=new w2(x,n),u=[],d=[];function m(){u.length=0,d.length=0}function A($){u.push($)}function y($){d.push($)}function k($){a.setup(u,$)}function N($){a.setupView(u,$)}return{init:m,state:{lightsArray:u,shadowsArray:d,lights:a},setupLights:k,setupLightsView:N,pushLight:A,pushShadow:y}}function E2(x,n){let a=new WeakMap;function u(m,A=0){const y=a.get(m);let k;return y===void 0?(k=new mr(x,n),a.set(m,[k])):A>=y.length?(k=new mr(x,n),y.push(k)):k=y[A],k}function d(){a=new WeakMap}return{get:u,dispose:d}}class em extends Ba{constructor(n){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Is,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(n)}copy(n){return super.copy(n),this.depthPacking=n.depthPacking,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this}}class u0 extends Ba{constructor(n){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new tt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(n)}copy(n){return super.copy(n),this.referencePosition.copy(n.referencePosition),this.nearDistance=n.nearDistance,this.farDistance=n.farDistance,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this}}const I2=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,S2=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function jc(x,n,a){let u=new Pf;const d=new kn,m=new kn,A=new es,y=new em({depthPacking:Ys}),k=new u0,N={},K=a.maxTextureSize,$={0:V,1:D,2:J},j=new Ol({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new kn},radius:{value:4}},vertexShader:I2,fragmentShader:S2}),ne=j.clone();ne.defines.HORIZONTAL_PASS=1;const le=new Or;le.setAttribute("position",new Vt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const se=new lo(le,j),re=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=I,this.render=function(Me,Fe,it){if(re.enabled===!1||re.autoUpdate===!1&&re.needsUpdate===!1||Me.length===0)return;const yt=x.getRenderTarget(),Le=x.getActiveCubeFace(),at=x.getActiveMipmapLevel(),mt=x.state;mt.setBlending(Y),mt.buffers.color.setClear(1,1,1,1),mt.buffers.depth.setTest(!0),mt.setScissorTest(!1);for(let Dt=0,on=Me.length;Dt<on;Dt++){const Ut=Me[Dt],_t=Ut.shadow;if(_t===void 0){console.warn("THREE.WebGLShadowMap:",Ut,"has no shadow.");continue}if(_t.autoUpdate===!1&&_t.needsUpdate===!1)continue;d.copy(_t.mapSize);const Qt=_t.getFrameExtents();if(d.multiply(Qt),m.copy(_t.mapSize),(d.x>K||d.y>K)&&(d.x>K&&(m.x=Math.floor(K/Qt.x),d.x=m.x*Qt.x,_t.mapSize.x=m.x),d.y>K&&(m.y=Math.floor(K/Qt.y),d.y=m.y*Qt.y,_t.mapSize.y=m.y)),_t.map===null){const je=this.type!==_?{minFilter:me,magFilter:me}:{};_t.map=new So(d.x,d.y,je),_t.map.texture.name=Ut.name+".shadowMap",_t.camera.updateProjectionMatrix()}x.setRenderTarget(_t.map),x.clear();const bn=_t.getViewportCount();for(let je=0;je<bn;je++){const Zt=_t.getViewport(je);A.set(m.x*Zt.x,m.y*Zt.y,m.x*Zt.z,m.y*Zt.w),mt.viewport(A),_t.updateMatrices(Ut,je),u=_t.getFrustum(),Ee(Fe,it,_t.camera,Ut,this.type)}_t.isPointLightShadow!==!0&&this.type===_&&ye(_t,it),_t.needsUpdate=!1}re.needsUpdate=!1,x.setRenderTarget(yt,Le,at)};function ye(Me,Fe){const it=n.update(se);j.defines.VSM_SAMPLES!==Me.blurSamples&&(j.defines.VSM_SAMPLES=Me.blurSamples,ne.defines.VSM_SAMPLES=Me.blurSamples,j.needsUpdate=!0,ne.needsUpdate=!0),Me.mapPass===null&&(Me.mapPass=new So(d.x,d.y)),j.uniforms.shadow_pass.value=Me.map.texture,j.uniforms.resolution.value=Me.mapSize,j.uniforms.radius.value=Me.radius,x.setRenderTarget(Me.mapPass),x.clear(),x.renderBufferDirect(Fe,null,it,j,se,null),ne.uniforms.shadow_pass.value=Me.mapPass.texture,ne.uniforms.resolution.value=Me.mapSize,ne.uniforms.radius.value=Me.radius,x.setRenderTarget(Me.map),x.clear(),x.renderBufferDirect(Fe,null,it,ne,se,null)}function Be(Me,Fe,it,yt,Le,at){let mt=null;const Dt=it.isPointLight===!0?Me.customDistanceMaterial:Me.customDepthMaterial;if(Dt!==void 0?mt=Dt:mt=it.isPointLight===!0?k:y,x.localClippingEnabled&&Fe.clipShadows===!0&&Array.isArray(Fe.clippingPlanes)&&Fe.clippingPlanes.length!==0||Fe.displacementMap&&Fe.displacementScale!==0||Fe.alphaMap&&Fe.alphaTest>0||Fe.map&&Fe.alphaTest>0){const on=mt.uuid,Ut=Fe.uuid;let _t=N[on];_t===void 0&&(_t={},N[on]=_t);let Qt=_t[Ut];Qt===void 0&&(Qt=mt.clone(),_t[Ut]=Qt),mt=Qt}return mt.visible=Fe.visible,mt.wireframe=Fe.wireframe,at===_?mt.side=Fe.shadowSide!==null?Fe.shadowSide:Fe.side:mt.side=Fe.shadowSide!==null?Fe.shadowSide:$[Fe.side],mt.alphaMap=Fe.alphaMap,mt.alphaTest=Fe.alphaTest,mt.map=Fe.map,mt.clipShadows=Fe.clipShadows,mt.clippingPlanes=Fe.clippingPlanes,mt.clipIntersection=Fe.clipIntersection,mt.displacementMap=Fe.displacementMap,mt.displacementScale=Fe.displacementScale,mt.displacementBias=Fe.displacementBias,mt.wireframeLinewidth=Fe.wireframeLinewidth,mt.linewidth=Fe.linewidth,it.isPointLight===!0&&mt.isMeshDistanceMaterial===!0&&(mt.referencePosition.setFromMatrixPosition(it.matrixWorld),mt.nearDistance=yt,mt.farDistance=Le),mt}function Ee(Me,Fe,it,yt,Le){if(Me.visible===!1)return;if(Me.layers.test(Fe.layers)&&(Me.isMesh||Me.isLine||Me.isPoints)&&(Me.castShadow||Me.receiveShadow&&Le===_)&&(!Me.frustumCulled||u.intersectsObject(Me))){Me.modelViewMatrix.multiplyMatrices(it.matrixWorldInverse,Me.matrixWorld);const Dt=n.update(Me),on=Me.material;if(Array.isArray(on)){const Ut=Dt.groups;for(let _t=0,Qt=Ut.length;_t<Qt;_t++){const bn=Ut[_t],je=on[bn.materialIndex];if(je&&je.visible){const Zt=Be(Me,je,yt,it.near,it.far,Le);x.renderBufferDirect(it,null,Dt,Zt,Me,bn)}}}else if(on.visible){const Ut=Be(Me,on,yt,it.near,it.far,Le);x.renderBufferDirect(it,null,Dt,Ut,Me,null)}}const mt=Me.children;for(let Dt=0,on=mt.length;Dt<on;Dt++)Ee(mt[Dt],Fe,it,yt,Le)}}function T2(x,n,a){const u=a.isWebGL2;function d(){let Mt=!1;const Cn=new es;let Zn=null;const Li=new es(0,0,0,0);return{setMask:function(qi){Zn!==qi&&!Mt&&(x.colorMask(qi,qi,qi,qi),Zn=qi)},setLocked:function(qi){Mt=qi},setClear:function(qi,Ms,ia,Oa,nl){nl===!0&&(qi*=Oa,Ms*=Oa,ia*=Oa),Cn.set(qi,Ms,ia,Oa),Li.equals(Cn)===!1&&(x.clearColor(qi,Ms,ia,Oa),Li.copy(Cn))},reset:function(){Mt=!1,Zn=null,Li.set(-1,0,0,0)}}}function m(){let Mt=!1,Cn=null,Zn=null,Li=null;return{setTest:function(qi){qi?Ei(2929):ii(2929)},setMask:function(qi){Cn!==qi&&!Mt&&(x.depthMask(qi),Cn=qi)},setFunc:function(qi){if(Zn!==qi){switch(qi){case yn:x.depthFunc(512);break;case Wn:x.depthFunc(519);break;case gi:x.depthFunc(513);break;case ai:x.depthFunc(515);break;case nt:x.depthFunc(514);break;case dt:x.depthFunc(518);break;case Ot:x.depthFunc(516);break;case $t:x.depthFunc(517);break;default:x.depthFunc(515)}Zn=qi}},setLocked:function(qi){Mt=qi},setClear:function(qi){Li!==qi&&(x.clearDepth(qi),Li=qi)},reset:function(){Mt=!1,Cn=null,Zn=null,Li=null}}}function A(){let Mt=!1,Cn=null,Zn=null,Li=null,qi=null,Ms=null,ia=null,Oa=null,nl=null;return{setTest:function(os){Mt||(os?Ei(2960):ii(2960))},setMask:function(os){Cn!==os&&!Mt&&(x.stencilMask(os),Cn=os)},setFunc:function(os,uc,Es){(Zn!==os||Li!==uc||qi!==Es)&&(x.stencilFunc(os,uc,Es),Zn=os,Li=uc,qi=Es)},setOp:function(os,uc,Es){(Ms!==os||ia!==uc||Oa!==Es)&&(x.stencilOp(os,uc,Es),Ms=os,ia=uc,Oa=Es)},setLocked:function(os){Mt=os},setClear:function(os){nl!==os&&(x.clearStencil(os),nl=os)},reset:function(){Mt=!1,Cn=null,Zn=null,Li=null,qi=null,Ms=null,ia=null,Oa=null,nl=null}}}const y=new d,k=new m,N=new A,K=new WeakMap,$=new WeakMap;let j={},ne={},le=new WeakMap,se=[],re=null,ye=!1,Be=null,Ee=null,Me=null,Fe=null,it=null,yt=null,Le=null,at=!1,mt=null,Dt=null,on=null,Ut=null,_t=null;const Qt=x.getParameter(35661);let bn=!1,je=0;const Zt=x.getParameter(7938);Zt.indexOf("WebGL")!==-1?(je=parseFloat(/^WebGL (\d)/.exec(Zt)[1]),bn=je>=1):Zt.indexOf("OpenGL ES")!==-1&&(je=parseFloat(/^OpenGL ES (\d)/.exec(Zt)[1]),bn=je>=2);let Qn=null,Kn={};const xi=x.getParameter(3088),li=x.getParameter(2978),pn=new es().fromArray(xi),Rn=new es().fromArray(li);function Vn(Mt,Cn,Zn){const Li=new Uint8Array(4),qi=x.createTexture();x.bindTexture(Mt,qi),x.texParameteri(Mt,10241,9728),x.texParameteri(Mt,10240,9728);for(let Ms=0;Ms<Zn;Ms++)x.texImage2D(Cn+Ms,0,6408,1,1,0,6408,5121,Li);return qi}const Jt={};Jt[3553]=Vn(3553,3553,1),Jt[34067]=Vn(34067,34069,6),y.setClear(0,0,0,1),k.setClear(1),N.setClear(0),Ei(2929),k.setFunc(ai),mi(!1),wr(L),Ei(2884),qn(Y);function Ei(Mt){j[Mt]!==!0&&(x.enable(Mt),j[Mt]=!0)}function ii(Mt){j[Mt]!==!1&&(x.disable(Mt),j[Mt]=!1)}function tr(Mt,Cn){return ne[Mt]!==Cn?(x.bindFramebuffer(Mt,Cn),ne[Mt]=Cn,u&&(Mt===36009&&(ne[36160]=Cn),Mt===36160&&(ne[36009]=Cn)),!0):!1}function ni(Mt,Cn){let Zn=se,Li=!1;if(Mt)if(Zn=le.get(Cn),Zn===void 0&&(Zn=[],le.set(Cn,Zn)),Mt.isWebGLMultipleRenderTargets){const qi=Mt.texture;if(Zn.length!==qi.length||Zn[0]!==36064){for(let Ms=0,ia=qi.length;Ms<ia;Ms++)Zn[Ms]=36064+Ms;Zn.length=qi.length,Li=!0}}else Zn[0]!==36064&&(Zn[0]=36064,Li=!0);else Zn[0]!==1029&&(Zn[0]=1029,Li=!0);Li&&(a.isWebGL2?x.drawBuffers(Zn):n.get("WEBGL_draw_buffers").drawBuffersWEBGL(Zn))}function Mr(Mt){return re!==Mt?(x.useProgram(Mt),re=Mt,!0):!1}const Ln={[Ae]:32774,[Se]:32778,[Ie]:32779};if(u)Ln[de]=32775,Ln[pe]=32776;else{const Mt=n.get("EXT_blend_minmax");Mt!==null&&(Ln[de]=Mt.MIN_EXT,Ln[pe]=Mt.MAX_EXT)}const Tn={[we]:0,[he]:1,[Pe]:768,[ze]:770,[Jn]:776,[fn]:774,[Tt]:772,[Ve]:769,[et]:771,[cn]:775,[Rt]:773};function qn(Mt,Cn,Zn,Li,qi,Ms,ia,Oa){if(Mt===Y){ye===!0&&(ii(3042),ye=!1);return}if(ye===!1&&(Ei(3042),ye=!0),Mt!==ve){if(Mt!==Be||Oa!==at){if((Ee!==Ae||it!==Ae)&&(x.blendEquation(32774),Ee=Ae,it=Ae),Oa)switch(Mt){case W:x.blendFuncSeparate(1,771,1,771);break;case U:x.blendFunc(1,1);break;case q:x.blendFuncSeparate(0,769,0,1);break;case oe:x.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Mt);break}else switch(Mt){case W:x.blendFuncSeparate(770,771,1,771);break;case U:x.blendFunc(770,1);break;case q:x.blendFuncSeparate(0,769,0,1);break;case oe:x.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Mt);break}Me=null,Fe=null,yt=null,Le=null,Be=Mt,at=Oa}return}qi=qi||Cn,Ms=Ms||Zn,ia=ia||Li,(Cn!==Ee||qi!==it)&&(x.blendEquationSeparate(Ln[Cn],Ln[qi]),Ee=Cn,it=qi),(Zn!==Me||Li!==Fe||Ms!==yt||ia!==Le)&&(x.blendFuncSeparate(Tn[Zn],Tn[Li],Tn[Ms],Tn[ia]),Me=Zn,Fe=Li,yt=Ms,Le=ia),Be=Mt,at=!1}function $i(Mt,Cn){Mt.side===J?ii(2884):Ei(2884);let Zn=Mt.side===V;Cn&&(Zn=!Zn),mi(Zn),Mt.blending===W&&Mt.transparent===!1?qn(Y):qn(Mt.blending,Mt.blendEquation,Mt.blendSrc,Mt.blendDst,Mt.blendEquationAlpha,Mt.blendSrcAlpha,Mt.blendDstAlpha,Mt.premultipliedAlpha),k.setFunc(Mt.depthFunc),k.setTest(Mt.depthTest),k.setMask(Mt.depthWrite),y.setMask(Mt.colorWrite);const Li=Mt.stencilWrite;N.setTest(Li),Li&&(N.setMask(Mt.stencilWriteMask),N.setFunc(Mt.stencilFunc,Mt.stencilRef,Mt.stencilFuncMask),N.setOp(Mt.stencilFail,Mt.stencilZFail,Mt.stencilZPass)),sr(Mt.polygonOffset,Mt.polygonOffsetFactor,Mt.polygonOffsetUnits),Mt.alphaToCoverage===!0?Ei(32926):ii(32926)}function mi(Mt){mt!==Mt&&(Mt?x.frontFace(2304):x.frontFace(2305),mt=Mt)}function wr(Mt){Mt!==F?(Ei(2884),Mt!==Dt&&(Mt===L?x.cullFace(1029):Mt===M?x.cullFace(1028):x.cullFace(1032))):ii(2884),Dt=Mt}function ki(Mt){Mt!==on&&(bn&&x.lineWidth(Mt),on=Mt)}function sr(Mt,Cn,Zn){Mt?(Ei(32823),(Ut!==Cn||_t!==Zn)&&(x.polygonOffset(Cn,Zn),Ut=Cn,_t=Zn)):ii(32823)}function Os(Mt){Mt?Ei(3089):ii(3089)}function Ts(Mt){Mt===void 0&&(Mt=33984+Qt-1),Qn!==Mt&&(x.activeTexture(Mt),Qn=Mt)}function ot(Mt,Cn,Zn){Zn===void 0&&(Qn===null?Zn=33984+Qt-1:Zn=Qn);let Li=Kn[Zn];Li===void 0&&(Li={type:void 0,texture:void 0},Kn[Zn]=Li),(Li.type!==Mt||Li.texture!==Cn)&&(Qn!==Zn&&(x.activeTexture(Zn),Qn=Zn),x.bindTexture(Mt,Cn||Jt[Mt]),Li.type=Mt,Li.texture=Cn)}function Ze(){const Mt=Kn[Qn];Mt!==void 0&&Mt.type!==void 0&&(x.bindTexture(Mt.type,null),Mt.type=void 0,Mt.texture=void 0)}function ln(){try{x.compressedTexImage2D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function Xn(){try{x.compressedTexImage3D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function oi(){try{x.texSubImage2D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function Mi(){try{x.texSubImage3D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function Sr(){try{x.compressedTexSubImage2D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function _i(){try{x.compressedTexSubImage3D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function _n(){try{x.texStorage2D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function ji(){try{x.texStorage3D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function Bi(){try{x.texImage2D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function Ki(){try{x.texImage3D.apply(x,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}}function zi(Mt){pn.equals(Mt)===!1&&(x.scissor(Mt.x,Mt.y,Mt.z,Mt.w),pn.copy(Mt))}function ar(Mt){Rn.equals(Mt)===!1&&(x.viewport(Mt.x,Mt.y,Mt.z,Mt.w),Rn.copy(Mt))}function Jr(Mt,Cn){let Zn=$.get(Cn);Zn===void 0&&(Zn=new WeakMap,$.set(Cn,Zn));let Li=Zn.get(Mt);Li===void 0&&(Li=x.getUniformBlockIndex(Cn,Mt.name),Zn.set(Mt,Li))}function na(Mt,Cn){const Li=$.get(Cn).get(Mt);K.get(Mt)!==Li&&(x.uniformBlockBinding(Cn,Li,Mt.__bindingPointIndex),K.set(Mt,Li))}function da(){x.disable(3042),x.disable(2884),x.disable(2929),x.disable(32823),x.disable(3089),x.disable(2960),x.disable(32926),x.blendEquation(32774),x.blendFunc(1,0),x.blendFuncSeparate(1,0,1,0),x.colorMask(!0,!0,!0,!0),x.clearColor(0,0,0,0),x.depthMask(!0),x.depthFunc(513),x.clearDepth(1),x.stencilMask(4294967295),x.stencilFunc(519,0,4294967295),x.stencilOp(7680,7680,7680),x.clearStencil(0),x.cullFace(1029),x.frontFace(2305),x.polygonOffset(0,0),x.activeTexture(33984),x.bindFramebuffer(36160,null),u===!0&&(x.bindFramebuffer(36009,null),x.bindFramebuffer(36008,null)),x.useProgram(null),x.lineWidth(1),x.scissor(0,0,x.canvas.width,x.canvas.height),x.viewport(0,0,x.canvas.width,x.canvas.height),j={},Qn=null,Kn={},ne={},le=new WeakMap,se=[],re=null,ye=!1,Be=null,Ee=null,Me=null,Fe=null,it=null,yt=null,Le=null,at=!1,mt=null,Dt=null,on=null,Ut=null,_t=null,pn.set(0,0,x.canvas.width,x.canvas.height),Rn.set(0,0,x.canvas.width,x.canvas.height),y.reset(),k.reset(),N.reset()}return{buffers:{color:y,depth:k,stencil:N},enable:Ei,disable:ii,bindFramebuffer:tr,drawBuffers:ni,useProgram:Mr,setBlending:qn,setMaterial:$i,setFlipSided:mi,setCullFace:wr,setLineWidth:ki,setPolygonOffset:sr,setScissorTest:Os,activeTexture:Ts,bindTexture:ot,unbindTexture:Ze,compressedTexImage2D:ln,compressedTexImage3D:Xn,texImage2D:Bi,texImage3D:Ki,updateUBOMapping:Jr,uniformBlockBinding:na,texStorage2D:_n,texStorage3D:ji,texSubImage2D:oi,texSubImage3D:Mi,compressedTexSubImage2D:Sr,compressedTexSubImage3D:_i,scissor:zi,viewport:ar,reset:da}}function h0(x,n,a,u,d,m,A){const y=d.isWebGL2,k=d.maxTextures,N=d.maxCubemapSize,K=d.maxTextureSize,$=d.maxSamples,j=n.has("WEBGL_multisampled_render_to_texture")?n.get("WEBGL_multisampled_render_to_texture"):null,ne=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),le=new WeakMap;let se;const re=new WeakMap;let ye=!1;try{ye=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Be(ot,Ze){return ye?new OffscreenCanvas(ot,Ze):ql("canvas")}function Ee(ot,Ze,ln,Xn){let oi=1;if((ot.width>Xn||ot.height>Xn)&&(oi=Xn/Math.max(ot.width,ot.height)),oi<1||Ze===!0)if(typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ot instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ot instanceof ImageBitmap){const Mi=Ze?Ah:Math.floor,Sr=Mi(oi*ot.width),_i=Mi(oi*ot.height);se===void 0&&(se=Be(Sr,_i));const _n=ln?Be(Sr,_i):se;return _n.width=Sr,_n.height=_i,_n.getContext("2d").drawImage(ot,0,0,Sr,_i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ot.width+"x"+ot.height+") to ("+Sr+"x"+_i+")."),_n}else return"data"in ot&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ot.width+"x"+ot.height+")."),ot;return ot}function Me(ot){return md(ot.width)&&md(ot.height)}function Fe(ot){return y?!1:ot.wrapS!==Ct||ot.wrapT!==Ct||ot.minFilter!==me&&ot.minFilter!==ft}function it(ot,Ze){return ot.generateMipmaps&&Ze&&ot.minFilter!==me&&ot.minFilter!==ft}function yt(ot){x.generateMipmap(ot)}function Le(ot,Ze,ln,Xn,oi=!1){if(y===!1)return Ze;if(ot!==null){if(x[ot]!==void 0)return x[ot];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ot+"'")}let Mi=Ze;return Ze===6403&&(ln===5126&&(Mi=33326),ln===5131&&(Mi=33325),ln===5121&&(Mi=33321)),Ze===33319&&(ln===5126&&(Mi=33328),ln===5131&&(Mi=33327),ln===5121&&(Mi=33323)),Ze===6408&&(ln===5126&&(Mi=34836),ln===5131&&(Mi=34842),ln===5121&&(Mi=Xn===gr&&oi===!1?35907:32856),ln===32819&&(Mi=32854),ln===32820&&(Mi=32855)),(Mi===33325||Mi===33326||Mi===33327||Mi===33328||Mi===34842||Mi===34836)&&n.get("EXT_color_buffer_float"),Mi}function at(ot,Ze,ln){return it(ot,ln)===!0||ot.isFramebufferTexture&&ot.minFilter!==me&&ot.minFilter!==ft?Math.log2(Math.max(Ze.width,Ze.height))+1:ot.mipmaps!==void 0&&ot.mipmaps.length>0?ot.mipmaps.length:ot.isCompressedTexture&&Array.isArray(ot.image)?Ze.mipmaps.length:1}function mt(ot){return ot===me||ot===ee||ot===Ue?9728:9729}function Dt(ot){const Ze=ot.target;Ze.removeEventListener("dispose",Dt),Ut(Ze),Ze.isVideoTexture&&le.delete(Ze)}function on(ot){const Ze=ot.target;Ze.removeEventListener("dispose",on),Qt(Ze)}function Ut(ot){const Ze=u.get(ot);if(Ze.__webglInit===void 0)return;const ln=ot.source,Xn=re.get(ln);if(Xn){const oi=Xn[Ze.__cacheKey];oi.usedTimes--,oi.usedTimes===0&&_t(ot),Object.keys(Xn).length===0&&re.delete(ln)}u.remove(ot)}function _t(ot){const Ze=u.get(ot);x.deleteTexture(Ze.__webglTexture);const ln=ot.source,Xn=re.get(ln);delete Xn[Ze.__cacheKey],A.memory.textures--}function Qt(ot){const Ze=ot.texture,ln=u.get(ot),Xn=u.get(Ze);if(Xn.__webglTexture!==void 0&&(x.deleteTexture(Xn.__webglTexture),A.memory.textures--),ot.depthTexture&&ot.depthTexture.dispose(),ot.isWebGLCubeRenderTarget)for(let oi=0;oi<6;oi++)x.deleteFramebuffer(ln.__webglFramebuffer[oi]),ln.__webglDepthbuffer&&x.deleteRenderbuffer(ln.__webglDepthbuffer[oi]);else{if(x.deleteFramebuffer(ln.__webglFramebuffer),ln.__webglDepthbuffer&&x.deleteRenderbuffer(ln.__webglDepthbuffer),ln.__webglMultisampledFramebuffer&&x.deleteFramebuffer(ln.__webglMultisampledFramebuffer),ln.__webglColorRenderbuffer)for(let oi=0;oi<ln.__webglColorRenderbuffer.length;oi++)ln.__webglColorRenderbuffer[oi]&&x.deleteRenderbuffer(ln.__webglColorRenderbuffer[oi]);ln.__webglDepthRenderbuffer&&x.deleteRenderbuffer(ln.__webglDepthRenderbuffer)}if(ot.isWebGLMultipleRenderTargets)for(let oi=0,Mi=Ze.length;oi<Mi;oi++){const Sr=u.get(Ze[oi]);Sr.__webglTexture&&(x.deleteTexture(Sr.__webglTexture),A.memory.textures--),u.remove(Ze[oi])}u.remove(Ze),u.remove(ot)}let bn=0;function je(){bn=0}function Zt(){const ot=bn;return ot>=k&&console.warn("THREE.WebGLTextures: Trying to use "+ot+" texture units while this GPU supports only "+k),bn+=1,ot}function Qn(ot){const Ze=[];return Ze.push(ot.wrapS),Ze.push(ot.wrapT),Ze.push(ot.wrapR||0),Ze.push(ot.magFilter),Ze.push(ot.minFilter),Ze.push(ot.anisotropy),Ze.push(ot.internalFormat),Ze.push(ot.format),Ze.push(ot.type),Ze.push(ot.generateMipmaps),Ze.push(ot.premultiplyAlpha),Ze.push(ot.flipY),Ze.push(ot.unpackAlignment),Ze.push(ot.encoding),Ze.join()}function Kn(ot,Ze){const ln=u.get(ot);if(ot.isVideoTexture&&Os(ot),ot.isRenderTargetTexture===!1&&ot.version>0&&ln.__version!==ot.version){const Xn=ot.image;if(Xn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Xn.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ii(ln,ot,Ze);return}}a.bindTexture(3553,ln.__webglTexture,33984+Ze)}function xi(ot,Ze){const ln=u.get(ot);if(ot.version>0&&ln.__version!==ot.version){ii(ln,ot,Ze);return}a.bindTexture(35866,ln.__webglTexture,33984+Ze)}function li(ot,Ze){const ln=u.get(ot);if(ot.version>0&&ln.__version!==ot.version){ii(ln,ot,Ze);return}a.bindTexture(32879,ln.__webglTexture,33984+Ze)}function pn(ot,Ze){const ln=u.get(ot);if(ot.version>0&&ln.__version!==ot.version){tr(ln,ot,Ze);return}a.bindTexture(34067,ln.__webglTexture,33984+Ze)}const Rn={[ct]:10497,[Ct]:33071,[Yt]:33648},Vn={[me]:9728,[ee]:9984,[Ue]:9986,[ft]:9729,[Ft]:9985,[bi]:9987};function Jt(ot,Ze,ln){if(ln?(x.texParameteri(ot,10242,Rn[Ze.wrapS]),x.texParameteri(ot,10243,Rn[Ze.wrapT]),(ot===32879||ot===35866)&&x.texParameteri(ot,32882,Rn[Ze.wrapR]),x.texParameteri(ot,10240,Vn[Ze.magFilter]),x.texParameteri(ot,10241,Vn[Ze.minFilter])):(x.texParameteri(ot,10242,33071),x.texParameteri(ot,10243,33071),(ot===32879||ot===35866)&&x.texParameteri(ot,32882,33071),(Ze.wrapS!==Ct||Ze.wrapT!==Ct)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),x.texParameteri(ot,10240,mt(Ze.magFilter)),x.texParameteri(ot,10241,mt(Ze.minFilter)),Ze.minFilter!==me&&Ze.minFilter!==ft&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),n.has("EXT_texture_filter_anisotropic")===!0){const Xn=n.get("EXT_texture_filter_anisotropic");if(Ze.type===ti&&n.has("OES_texture_float_linear")===!1||y===!1&&Ze.type===hn&&n.has("OES_texture_half_float_linear")===!1)return;(Ze.anisotropy>1||u.get(Ze).__currentAnisotropy)&&(x.texParameterf(ot,Xn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ze.anisotropy,d.getMaxAnisotropy())),u.get(Ze).__currentAnisotropy=Ze.anisotropy)}}function Ei(ot,Ze){let ln=!1;ot.__webglInit===void 0&&(ot.__webglInit=!0,Ze.addEventListener("dispose",Dt));const Xn=Ze.source;let oi=re.get(Xn);oi===void 0&&(oi={},re.set(Xn,oi));const Mi=Qn(Ze);if(Mi!==ot.__cacheKey){oi[Mi]===void 0&&(oi[Mi]={texture:x.createTexture(),usedTimes:0},A.memory.textures++,ln=!0),oi[Mi].usedTimes++;const Sr=oi[ot.__cacheKey];Sr!==void 0&&(oi[ot.__cacheKey].usedTimes--,Sr.usedTimes===0&&_t(Ze)),ot.__cacheKey=Mi,ot.__webglTexture=oi[Mi].texture}return ln}function ii(ot,Ze,ln){let Xn=3553;(Ze.isDataArrayTexture||Ze.isCompressedArrayTexture)&&(Xn=35866),Ze.isData3DTexture&&(Xn=32879);const oi=Ei(ot,Ze),Mi=Ze.source;a.bindTexture(Xn,ot.__webglTexture,33984+ln);const Sr=u.get(Mi);if(Mi.version!==Sr.__version||oi===!0){a.activeTexture(33984+ln),x.pixelStorei(37440,Ze.flipY),x.pixelStorei(37441,Ze.premultiplyAlpha),x.pixelStorei(3317,Ze.unpackAlignment),x.pixelStorei(37443,0);const _i=Fe(Ze)&&Me(Ze.image)===!1;let _n=Ee(Ze.image,_i,!1,K);_n=Ts(Ze,_n);const ji=Me(_n)||y,Bi=m.convert(Ze.format,Ze.encoding);let Ki=m.convert(Ze.type),zi=Le(Ze.internalFormat,Bi,Ki,Ze.encoding,Ze.isVideoTexture);Jt(Xn,Ze,ji);let ar;const Jr=Ze.mipmaps,na=y&&Ze.isVideoTexture!==!0,da=Sr.__version===void 0||oi===!0,Mt=at(Ze,_n,ji);if(Ze.isDepthTexture)zi=6402,y?Ze.type===ti?zi=36012:Ze.type===Dr?zi=33190:Ze.type===Yn?zi=35056:zi=33189:Ze.type===ti&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ze.format===$r&&zi===6402&&Ze.type!==Fs&&Ze.type!==Dr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ze.type=Dr,Ki=m.convert(Ze.type)),Ze.format===ws&&zi===6402&&(zi=34041,Ze.type!==Yn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ze.type=Yn,Ki=m.convert(Ze.type))),da&&(na?a.texStorage2D(3553,1,zi,_n.width,_n.height):a.texImage2D(3553,0,zi,_n.width,_n.height,0,Bi,Ki,null));else if(Ze.isDataTexture)if(Jr.length>0&&ji){na&&da&&a.texStorage2D(3553,Mt,zi,Jr[0].width,Jr[0].height);for(let Cn=0,Zn=Jr.length;Cn<Zn;Cn++)ar=Jr[Cn],na?a.texSubImage2D(3553,Cn,0,0,ar.width,ar.height,Bi,Ki,ar.data):a.texImage2D(3553,Cn,zi,ar.width,ar.height,0,Bi,Ki,ar.data);Ze.generateMipmaps=!1}else na?(da&&a.texStorage2D(3553,Mt,zi,_n.width,_n.height),a.texSubImage2D(3553,0,0,0,_n.width,_n.height,Bi,Ki,_n.data)):a.texImage2D(3553,0,zi,_n.width,_n.height,0,Bi,Ki,_n.data);else if(Ze.isCompressedTexture)if(Ze.isCompressedArrayTexture){na&&da&&a.texStorage3D(35866,Mt,zi,Jr[0].width,Jr[0].height,_n.depth);for(let Cn=0,Zn=Jr.length;Cn<Zn;Cn++)ar=Jr[Cn],Ze.format!==cr?Bi!==null?na?a.compressedTexSubImage3D(35866,Cn,0,0,0,ar.width,ar.height,_n.depth,Bi,ar.data,0,0):a.compressedTexImage3D(35866,Cn,zi,ar.width,ar.height,_n.depth,0,ar.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):na?a.texSubImage3D(35866,Cn,0,0,0,ar.width,ar.height,_n.depth,Bi,Ki,ar.data):a.texImage3D(35866,Cn,zi,ar.width,ar.height,_n.depth,0,Bi,Ki,ar.data)}else{na&&da&&a.texStorage2D(3553,Mt,zi,Jr[0].width,Jr[0].height);for(let Cn=0,Zn=Jr.length;Cn<Zn;Cn++)ar=Jr[Cn],Ze.format!==cr?Bi!==null?na?a.compressedTexSubImage2D(3553,Cn,0,0,ar.width,ar.height,Bi,ar.data):a.compressedTexImage2D(3553,Cn,zi,ar.width,ar.height,0,ar.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):na?a.texSubImage2D(3553,Cn,0,0,ar.width,ar.height,Bi,Ki,ar.data):a.texImage2D(3553,Cn,zi,ar.width,ar.height,0,Bi,Ki,ar.data)}else if(Ze.isDataArrayTexture)na?(da&&a.texStorage3D(35866,Mt,zi,_n.width,_n.height,_n.depth),a.texSubImage3D(35866,0,0,0,0,_n.width,_n.height,_n.depth,Bi,Ki,_n.data)):a.texImage3D(35866,0,zi,_n.width,_n.height,_n.depth,0,Bi,Ki,_n.data);else if(Ze.isData3DTexture)na?(da&&a.texStorage3D(32879,Mt,zi,_n.width,_n.height,_n.depth),a.texSubImage3D(32879,0,0,0,0,_n.width,_n.height,_n.depth,Bi,Ki,_n.data)):a.texImage3D(32879,0,zi,_n.width,_n.height,_n.depth,0,Bi,Ki,_n.data);else if(Ze.isFramebufferTexture){if(da)if(na)a.texStorage2D(3553,Mt,zi,_n.width,_n.height);else{let Cn=_n.width,Zn=_n.height;for(let Li=0;Li<Mt;Li++)a.texImage2D(3553,Li,zi,Cn,Zn,0,Bi,Ki,null),Cn>>=1,Zn>>=1}}else if(Jr.length>0&&ji){na&&da&&a.texStorage2D(3553,Mt,zi,Jr[0].width,Jr[0].height);for(let Cn=0,Zn=Jr.length;Cn<Zn;Cn++)ar=Jr[Cn],na?a.texSubImage2D(3553,Cn,0,0,Bi,Ki,ar):a.texImage2D(3553,Cn,zi,Bi,Ki,ar);Ze.generateMipmaps=!1}else na?(da&&a.texStorage2D(3553,Mt,zi,_n.width,_n.height),a.texSubImage2D(3553,0,0,0,Bi,Ki,_n)):a.texImage2D(3553,0,zi,Bi,Ki,_n);it(Ze,ji)&&yt(Xn),Sr.__version=Mi.version,Ze.onUpdate&&Ze.onUpdate(Ze)}ot.__version=Ze.version}function tr(ot,Ze,ln){if(Ze.image.length!==6)return;const Xn=Ei(ot,Ze),oi=Ze.source;a.bindTexture(34067,ot.__webglTexture,33984+ln);const Mi=u.get(oi);if(oi.version!==Mi.__version||Xn===!0){a.activeTexture(33984+ln),x.pixelStorei(37440,Ze.flipY),x.pixelStorei(37441,Ze.premultiplyAlpha),x.pixelStorei(3317,Ze.unpackAlignment),x.pixelStorei(37443,0);const Sr=Ze.isCompressedTexture||Ze.image[0].isCompressedTexture,_i=Ze.image[0]&&Ze.image[0].isDataTexture,_n=[];for(let Cn=0;Cn<6;Cn++)!Sr&&!_i?_n[Cn]=Ee(Ze.image[Cn],!1,!0,N):_n[Cn]=_i?Ze.image[Cn].image:Ze.image[Cn],_n[Cn]=Ts(Ze,_n[Cn]);const ji=_n[0],Bi=Me(ji)||y,Ki=m.convert(Ze.format,Ze.encoding),zi=m.convert(Ze.type),ar=Le(Ze.internalFormat,Ki,zi,Ze.encoding),Jr=y&&Ze.isVideoTexture!==!0,na=Mi.__version===void 0||Xn===!0;let da=at(Ze,ji,Bi);Jt(34067,Ze,Bi);let Mt;if(Sr){Jr&&na&&a.texStorage2D(34067,da,ar,ji.width,ji.height);for(let Cn=0;Cn<6;Cn++){Mt=_n[Cn].mipmaps;for(let Zn=0;Zn<Mt.length;Zn++){const Li=Mt[Zn];Ze.format!==cr?Ki!==null?Jr?a.compressedTexSubImage2D(34069+Cn,Zn,0,0,Li.width,Li.height,Ki,Li.data):a.compressedTexImage2D(34069+Cn,Zn,ar,Li.width,Li.height,0,Li.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Jr?a.texSubImage2D(34069+Cn,Zn,0,0,Li.width,Li.height,Ki,zi,Li.data):a.texImage2D(34069+Cn,Zn,ar,Li.width,Li.height,0,Ki,zi,Li.data)}}}else{Mt=Ze.mipmaps,Jr&&na&&(Mt.length>0&&da++,a.texStorage2D(34067,da,ar,_n[0].width,_n[0].height));for(let Cn=0;Cn<6;Cn++)if(_i){Jr?a.texSubImage2D(34069+Cn,0,0,0,_n[Cn].width,_n[Cn].height,Ki,zi,_n[Cn].data):a.texImage2D(34069+Cn,0,ar,_n[Cn].width,_n[Cn].height,0,Ki,zi,_n[Cn].data);for(let Zn=0;Zn<Mt.length;Zn++){const qi=Mt[Zn].image[Cn].image;Jr?a.texSubImage2D(34069+Cn,Zn+1,0,0,qi.width,qi.height,Ki,zi,qi.data):a.texImage2D(34069+Cn,Zn+1,ar,qi.width,qi.height,0,Ki,zi,qi.data)}}else{Jr?a.texSubImage2D(34069+Cn,0,0,0,Ki,zi,_n[Cn]):a.texImage2D(34069+Cn,0,ar,Ki,zi,_n[Cn]);for(let Zn=0;Zn<Mt.length;Zn++){const Li=Mt[Zn];Jr?a.texSubImage2D(34069+Cn,Zn+1,0,0,Ki,zi,Li.image[Cn]):a.texImage2D(34069+Cn,Zn+1,ar,Ki,zi,Li.image[Cn])}}}it(Ze,Bi)&&yt(34067),Mi.__version=oi.version,Ze.onUpdate&&Ze.onUpdate(Ze)}ot.__version=Ze.version}function ni(ot,Ze,ln,Xn,oi){const Mi=m.convert(ln.format,ln.encoding),Sr=m.convert(ln.type),_i=Le(ln.internalFormat,Mi,Sr,ln.encoding);u.get(Ze).__hasExternalTextures||(oi===32879||oi===35866?a.texImage3D(oi,0,_i,Ze.width,Ze.height,Ze.depth,0,Mi,Sr,null):a.texImage2D(oi,0,_i,Ze.width,Ze.height,0,Mi,Sr,null)),a.bindFramebuffer(36160,ot),sr(Ze)?j.framebufferTexture2DMultisampleEXT(36160,Xn,oi,u.get(ln).__webglTexture,0,ki(Ze)):(oi===3553||oi>=34069&&oi<=34074)&&x.framebufferTexture2D(36160,Xn,oi,u.get(ln).__webglTexture,0),a.bindFramebuffer(36160,null)}function Mr(ot,Ze,ln){if(x.bindRenderbuffer(36161,ot),Ze.depthBuffer&&!Ze.stencilBuffer){let Xn=33189;if(ln||sr(Ze)){const oi=Ze.depthTexture;oi&&oi.isDepthTexture&&(oi.type===ti?Xn=36012:oi.type===Dr&&(Xn=33190));const Mi=ki(Ze);sr(Ze)?j.renderbufferStorageMultisampleEXT(36161,Mi,Xn,Ze.width,Ze.height):x.renderbufferStorageMultisample(36161,Mi,Xn,Ze.width,Ze.height)}else x.renderbufferStorage(36161,Xn,Ze.width,Ze.height);x.framebufferRenderbuffer(36160,36096,36161,ot)}else if(Ze.depthBuffer&&Ze.stencilBuffer){const Xn=ki(Ze);ln&&sr(Ze)===!1?x.renderbufferStorageMultisample(36161,Xn,35056,Ze.width,Ze.height):sr(Ze)?j.renderbufferStorageMultisampleEXT(36161,Xn,35056,Ze.width,Ze.height):x.renderbufferStorage(36161,34041,Ze.width,Ze.height),x.framebufferRenderbuffer(36160,33306,36161,ot)}else{const Xn=Ze.isWebGLMultipleRenderTargets===!0?Ze.texture:[Ze.texture];for(let oi=0;oi<Xn.length;oi++){const Mi=Xn[oi],Sr=m.convert(Mi.format,Mi.encoding),_i=m.convert(Mi.type),_n=Le(Mi.internalFormat,Sr,_i,Mi.encoding),ji=ki(Ze);ln&&sr(Ze)===!1?x.renderbufferStorageMultisample(36161,ji,_n,Ze.width,Ze.height):sr(Ze)?j.renderbufferStorageMultisampleEXT(36161,ji,_n,Ze.width,Ze.height):x.renderbufferStorage(36161,_n,Ze.width,Ze.height)}}x.bindRenderbuffer(36161,null)}function Ln(ot,Ze){if(Ze&&Ze.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(36160,ot),!(Ze.depthTexture&&Ze.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!u.get(Ze.depthTexture).__webglTexture||Ze.depthTexture.image.width!==Ze.width||Ze.depthTexture.image.height!==Ze.height)&&(Ze.depthTexture.image.width=Ze.width,Ze.depthTexture.image.height=Ze.height,Ze.depthTexture.needsUpdate=!0),Kn(Ze.depthTexture,0);const Xn=u.get(Ze.depthTexture).__webglTexture,oi=ki(Ze);if(Ze.depthTexture.format===$r)sr(Ze)?j.framebufferTexture2DMultisampleEXT(36160,36096,3553,Xn,0,oi):x.framebufferTexture2D(36160,36096,3553,Xn,0);else if(Ze.depthTexture.format===ws)sr(Ze)?j.framebufferTexture2DMultisampleEXT(36160,33306,3553,Xn,0,oi):x.framebufferTexture2D(36160,33306,3553,Xn,0);else throw new Error("Unknown depthTexture format")}function Tn(ot){const Ze=u.get(ot),ln=ot.isWebGLCubeRenderTarget===!0;if(ot.depthTexture&&!Ze.__autoAllocateDepthBuffer){if(ln)throw new Error("target.depthTexture not supported in Cube render targets");Ln(Ze.__webglFramebuffer,ot)}else if(ln){Ze.__webglDepthbuffer=[];for(let Xn=0;Xn<6;Xn++)a.bindFramebuffer(36160,Ze.__webglFramebuffer[Xn]),Ze.__webglDepthbuffer[Xn]=x.createRenderbuffer(),Mr(Ze.__webglDepthbuffer[Xn],ot,!1)}else a.bindFramebuffer(36160,Ze.__webglFramebuffer),Ze.__webglDepthbuffer=x.createRenderbuffer(),Mr(Ze.__webglDepthbuffer,ot,!1);a.bindFramebuffer(36160,null)}function qn(ot,Ze,ln){const Xn=u.get(ot);Ze!==void 0&&ni(Xn.__webglFramebuffer,ot,ot.texture,36064,3553),ln!==void 0&&Tn(ot)}function $i(ot){const Ze=ot.texture,ln=u.get(ot),Xn=u.get(Ze);ot.addEventListener("dispose",on),ot.isWebGLMultipleRenderTargets!==!0&&(Xn.__webglTexture===void 0&&(Xn.__webglTexture=x.createTexture()),Xn.__version=Ze.version,A.memory.textures++);const oi=ot.isWebGLCubeRenderTarget===!0,Mi=ot.isWebGLMultipleRenderTargets===!0,Sr=Me(ot)||y;if(oi){ln.__webglFramebuffer=[];for(let _i=0;_i<6;_i++)ln.__webglFramebuffer[_i]=x.createFramebuffer()}else{if(ln.__webglFramebuffer=x.createFramebuffer(),Mi)if(d.drawBuffers){const _i=ot.texture;for(let _n=0,ji=_i.length;_n<ji;_n++){const Bi=u.get(_i[_n]);Bi.__webglTexture===void 0&&(Bi.__webglTexture=x.createTexture(),A.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(y&&ot.samples>0&&sr(ot)===!1){const _i=Mi?Ze:[Ze];ln.__webglMultisampledFramebuffer=x.createFramebuffer(),ln.__webglColorRenderbuffer=[],a.bindFramebuffer(36160,ln.__webglMultisampledFramebuffer);for(let _n=0;_n<_i.length;_n++){const ji=_i[_n];ln.__webglColorRenderbuffer[_n]=x.createRenderbuffer(),x.bindRenderbuffer(36161,ln.__webglColorRenderbuffer[_n]);const Bi=m.convert(ji.format,ji.encoding),Ki=m.convert(ji.type),zi=Le(ji.internalFormat,Bi,Ki,ji.encoding,ot.isXRRenderTarget===!0),ar=ki(ot);x.renderbufferStorageMultisample(36161,ar,zi,ot.width,ot.height),x.framebufferRenderbuffer(36160,36064+_n,36161,ln.__webglColorRenderbuffer[_n])}x.bindRenderbuffer(36161,null),ot.depthBuffer&&(ln.__webglDepthRenderbuffer=x.createRenderbuffer(),Mr(ln.__webglDepthRenderbuffer,ot,!0)),a.bindFramebuffer(36160,null)}}if(oi){a.bindTexture(34067,Xn.__webglTexture),Jt(34067,Ze,Sr);for(let _i=0;_i<6;_i++)ni(ln.__webglFramebuffer[_i],ot,Ze,36064,34069+_i);it(Ze,Sr)&&yt(34067),a.unbindTexture()}else if(Mi){const _i=ot.texture;for(let _n=0,ji=_i.length;_n<ji;_n++){const Bi=_i[_n],Ki=u.get(Bi);a.bindTexture(3553,Ki.__webglTexture),Jt(3553,Bi,Sr),ni(ln.__webglFramebuffer,ot,Bi,36064+_n,3553),it(Bi,Sr)&&yt(3553)}a.unbindTexture()}else{let _i=3553;(ot.isWebGL3DRenderTarget||ot.isWebGLArrayRenderTarget)&&(y?_i=ot.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),a.bindTexture(_i,Xn.__webglTexture),Jt(_i,Ze,Sr),ni(ln.__webglFramebuffer,ot,Ze,36064,_i),it(Ze,Sr)&&yt(_i),a.unbindTexture()}ot.depthBuffer&&Tn(ot)}function mi(ot){const Ze=Me(ot)||y,ln=ot.isWebGLMultipleRenderTargets===!0?ot.texture:[ot.texture];for(let Xn=0,oi=ln.length;Xn<oi;Xn++){const Mi=ln[Xn];if(it(Mi,Ze)){const Sr=ot.isWebGLCubeRenderTarget?34067:3553,_i=u.get(Mi).__webglTexture;a.bindTexture(Sr,_i),yt(Sr),a.unbindTexture()}}}function wr(ot){if(y&&ot.samples>0&&sr(ot)===!1){const Ze=ot.isWebGLMultipleRenderTargets?ot.texture:[ot.texture],ln=ot.width,Xn=ot.height;let oi=16384;const Mi=[],Sr=ot.stencilBuffer?33306:36096,_i=u.get(ot),_n=ot.isWebGLMultipleRenderTargets===!0;if(_n)for(let ji=0;ji<Ze.length;ji++)a.bindFramebuffer(36160,_i.__webglMultisampledFramebuffer),x.framebufferRenderbuffer(36160,36064+ji,36161,null),a.bindFramebuffer(36160,_i.__webglFramebuffer),x.framebufferTexture2D(36009,36064+ji,3553,null,0);a.bindFramebuffer(36008,_i.__webglMultisampledFramebuffer),a.bindFramebuffer(36009,_i.__webglFramebuffer);for(let ji=0;ji<Ze.length;ji++){Mi.push(36064+ji),ot.depthBuffer&&Mi.push(Sr);const Bi=_i.__ignoreDepthValues!==void 0?_i.__ignoreDepthValues:!1;if(Bi===!1&&(ot.depthBuffer&&(oi|=256),ot.stencilBuffer&&(oi|=1024)),_n&&x.framebufferRenderbuffer(36008,36064,36161,_i.__webglColorRenderbuffer[ji]),Bi===!0&&(x.invalidateFramebuffer(36008,[Sr]),x.invalidateFramebuffer(36009,[Sr])),_n){const Ki=u.get(Ze[ji]).__webglTexture;x.framebufferTexture2D(36009,36064,3553,Ki,0)}x.blitFramebuffer(0,0,ln,Xn,0,0,ln,Xn,oi,9728),ne&&x.invalidateFramebuffer(36008,Mi)}if(a.bindFramebuffer(36008,null),a.bindFramebuffer(36009,null),_n)for(let ji=0;ji<Ze.length;ji++){a.bindFramebuffer(36160,_i.__webglMultisampledFramebuffer),x.framebufferRenderbuffer(36160,36064+ji,36161,_i.__webglColorRenderbuffer[ji]);const Bi=u.get(Ze[ji]).__webglTexture;a.bindFramebuffer(36160,_i.__webglFramebuffer),x.framebufferTexture2D(36009,36064+ji,3553,Bi,0)}a.bindFramebuffer(36009,_i.__webglMultisampledFramebuffer)}}function ki(ot){return Math.min($,ot.samples)}function sr(ot){const Ze=u.get(ot);return y&&ot.samples>0&&n.has("WEBGL_multisampled_render_to_texture")===!0&&Ze.__useRenderToTexture!==!1}function Os(ot){const Ze=A.render.frame;le.get(ot)!==Ze&&(le.set(ot,Ze),ot.update())}function Ts(ot,Ze){const ln=ot.encoding,Xn=ot.format,oi=ot.type;return ot.isCompressedTexture===!0||ot.isVideoTexture===!0||ot.format===wu||ln!==Qr&&(ln===gr?y===!1?n.has("EXT_sRGB")===!0&&Xn===cr?(ot.format=wu,ot.minFilter=ft,ot.generateMipmaps=!1):Ze=Tu.sRGBToLinear(Ze):(Xn!==cr||oi!==Ai)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ln)),Ze}this.allocateTextureUnit=Zt,this.resetTextureUnits=je,this.setTexture2D=Kn,this.setTexture2DArray=xi,this.setTexture3D=li,this.setTextureCube=pn,this.rebindTextures=qn,this.setupRenderTarget=$i,this.updateRenderTargetMipmap=mi,this.updateMultisampleRenderTarget=wr,this.setupDepthRenderbuffer=Tn,this.setupFrameBufferTexture=ni,this.useMultisampledRTT=sr}function K1(x,n,a){const u=a.isWebGL2;function d(m,A=null){let y;if(m===Ai)return 5121;if(m===On)return 32819;if(m===Oi)return 32820;if(m===lr)return 5120;if(m===_s)return 5122;if(m===Fs)return 5123;if(m===Vs)return 5124;if(m===Dr)return 5125;if(m===ti)return 5126;if(m===hn)return u?5131:(y=n.get("OES_texture_half_float"),y!==null?y.HALF_FLOAT_OES:null);if(m===Gi)return 6406;if(m===cr)return 6408;if(m===Xr)return 6409;if(m===Fr)return 6410;if(m===$r)return 6402;if(m===ws)return 34041;if(m===nr)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(m===wu)return y=n.get("EXT_sRGB"),y!==null?y.SRGB_ALPHA_EXT:null;if(m===vr)return 6403;if(m===As)return 36244;if(m===vs)return 33319;if(m===Ge)return 33320;if(m===st)return 36249;if(m===wt||m===en||m===Xt||m===En)if(A===gr)if(y=n.get("WEBGL_compressed_texture_s3tc_srgb"),y!==null){if(m===wt)return y.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(m===en)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(m===Xt)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(m===En)return y.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(y=n.get("WEBGL_compressed_texture_s3tc"),y!==null){if(m===wt)return y.COMPRESSED_RGB_S3TC_DXT1_EXT;if(m===en)return y.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(m===Xt)return y.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(m===En)return y.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(m===Fn||m===Ci||m===vi||m===An)if(y=n.get("WEBGL_compressed_texture_pvrtc"),y!==null){if(m===Fn)return y.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(m===Ci)return y.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(m===vi)return y.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(m===An)return y.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(m===Ui)return y=n.get("WEBGL_compressed_texture_etc1"),y!==null?y.COMPRESSED_RGB_ETC1_WEBGL:null;if(m===Hi||m===ir)if(y=n.get("WEBGL_compressed_texture_etc"),y!==null){if(m===Hi)return A===gr?y.COMPRESSED_SRGB8_ETC2:y.COMPRESSED_RGB8_ETC2;if(m===ir)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:y.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(m===us||m===Tr||m===pr||m===Pr||m===Rs||m===fa||m===di||m===Cr||m===zs||m===zr||m===ie||m===ce||m===Ce||m===_e)if(y=n.get("WEBGL_compressed_texture_astc"),y!==null){if(m===us)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:y.COMPRESSED_RGBA_ASTC_4x4_KHR;if(m===Tr)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:y.COMPRESSED_RGBA_ASTC_5x4_KHR;if(m===pr)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:y.COMPRESSED_RGBA_ASTC_5x5_KHR;if(m===Pr)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:y.COMPRESSED_RGBA_ASTC_6x5_KHR;if(m===Rs)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:y.COMPRESSED_RGBA_ASTC_6x6_KHR;if(m===fa)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:y.COMPRESSED_RGBA_ASTC_8x5_KHR;if(m===di)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:y.COMPRESSED_RGBA_ASTC_8x6_KHR;if(m===Cr)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:y.COMPRESSED_RGBA_ASTC_8x8_KHR;if(m===zs)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:y.COMPRESSED_RGBA_ASTC_10x5_KHR;if(m===zr)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:y.COMPRESSED_RGBA_ASTC_10x6_KHR;if(m===ie)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:y.COMPRESSED_RGBA_ASTC_10x8_KHR;if(m===ce)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:y.COMPRESSED_RGBA_ASTC_10x10_KHR;if(m===Ce)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:y.COMPRESSED_RGBA_ASTC_12x10_KHR;if(m===_e)return A===gr?y.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:y.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(m===Xe)if(y=n.get("EXT_texture_compression_bptc"),y!==null){if(m===Xe)return A===gr?y.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:y.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return m===Yn?u?34042:(y=n.get("WEBGL_depth_texture"),y!==null?y.UNSIGNED_INT_24_8_WEBGL:null):x[m]!==void 0?x[m]:null}return{convert:d}}class Pu extends as{constructor(){super(),this.isGroup=!0,this.type="Group"}}class d0 extends qs{constructor(n=[]){super(),this.isArrayCamera=!0,this.cameras=n}}var X1=new tt,Q1=new tt;function p0(x,n,a){X1.setFromMatrixPosition(n.matrixWorld),Q1.setFromMatrixPosition(a.matrixWorld);var u=X1.distanceTo(Q1),d=n.projectionMatrix.elements,m=a.projectionMatrix.elements,A=d[14]/(d[10]-1),y=d[14]/(d[10]+1),k=(d[9]+1)/d[5],N=(d[9]-1)/d[5],K=(d[8]-1)/d[0],$=(m[8]+1)/m[0],j=A*K,ne=A*$,le=u/(-K+$),se=le*-K;n.matrixWorld.decompose(x.position,x.quaternion,x.scale),x.translateX(se),x.translateZ(le),x.matrixWorld.compose(x.position,x.quaternion,x.scale),x.matrixWorldInverse.copy(x.matrixWorld).invert();var re=A+le,ye=y+le,Be=j-se,Ee=ne+(u-se),Me=k*y/ye*re,Fe=N*y/ye*re;x.projectionMatrix.makePerspective(Be,Ee,Me,Fe,re,ye)}function Z1(x){var n,a,u=this,d=null,m=null,A=null,y=[],k=new Ri,N=new Ri,K=1,$="local-floor";typeof window<"u"&&"VRFrameData"in window&&(m=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",Me,!1));var j=new Ri,ne=new la,le=new tt,se=new qs;se.viewport=new es,se.layers.enable(1);var re=new qs;re.viewport=new es,re.layers.enable(2);var ye=new d0([se,re]);ye.layers.enable(1),ye.layers.enable(2);var Be=new kn,Ee;function Me(){var Dt=u.isPresenting=d!==null&&d.isPresenting===!0;if(Dt){var on=d.getEyeParameters("left");n=2*on.renderWidth*K,a=on.renderHeight*K,Ee=x.getPixelRatio(),x.getSize(Be),x.setDrawingBufferSize(n,a,1),se.viewport.set(0,0,n/2,a),re.viewport.set(n/2,0,n/2,a),mt.start(),u.dispatchEvent({type:"sessionstart"})}else u.enabled&&x.setDrawingBufferSize(Be.width,Be.height,Ee),mt.stop(),u.dispatchEvent({type:"sessionend"})}var Fe=[],it=[];function yt(Dt){for(var on=navigator.getGamepads&&navigator.getGamepads(),Ut=0,_t=on.length;Ut<_t;Ut++){var Qt=on[Ut];if(Qt&&(Qt.id==="Daydream Controller"||Qt.id==="Gear VR Controller"||Qt.id==="Oculus Go Controller"||Qt.id==="OpenVR Gamepad"||Qt.id.startsWith("Oculus Touch")||Qt.id.startsWith("HTC Vive Focus")||Qt.id.startsWith("Spatial Controller"))){var bn=Qt.hand;if(Dt===0&&(bn===""||bn==="right")||Dt===1&&bn==="left")return Qt}}}function Le(){for(var Dt=0;Dt<y.length;Dt++){var on=y[Dt],Ut=yt(Dt);if(Ut!==void 0&&Ut.pose!==void 0){if(Ut.pose===null)return;var _t=Ut.pose;_t.hasPosition===!1&&on.position.set(.2,-.6,-.05),_t.position!==null&&on.position.fromArray(_t.position),_t.orientation!==null&&on.quaternion.fromArray(_t.orientation),on.matrix.compose(on.position,on.quaternion,on.scale),on.matrix.premultiply(k),on.matrix.decompose(on.position,on.quaternion,on.scale),on.matrixWorldNeedsUpdate=!0,on.visible=!0;var Qt=Ut.id==="Daydream Controller"?0:1;Fe[Dt]===void 0&&(Fe[Dt]=!1),Fe[Dt]!==Ut.buttons[Qt].pressed&&(Fe[Dt]=Ut.buttons[Qt].pressed,Fe[Dt]===!0?on.dispatchEvent({type:"selectstart"}):(on.dispatchEvent({type:"selectend"}),on.dispatchEvent({type:"select"}))),Qt=2,it[Dt]===void 0&&(it[Dt]=!1),Ut.buttons[Qt]!==void 0&&it[Dt]!==Ut.buttons[Qt].pressed&&(it[Dt]=Ut.buttons[Qt].pressed,it[Dt]===!0?on.dispatchEvent({type:"squeezestart"}):(on.dispatchEvent({type:"squeezeend"}),on.dispatchEvent({type:"squeeze"})))}else on.visible=!1}}function at(Dt,on){on!==null&&on.length===4&&Dt.set(on[0]*n,on[1]*a,on[2]*n,on[3]*a)}this.enabled=!1,this.getController=function(Dt){var on=y[Dt];return on===void 0&&(on=new Pu,on.matrixAutoUpdate=!1,on.visible=!1,y[Dt]=on),on},this.getDevice=function(){return d},this.setDevice=function(Dt){Dt!==void 0&&(d=Dt),mt.setContext(Dt)},this.setFramebufferScaleFactor=function(Dt){K=Dt},this.setReferenceSpaceType=function(Dt){$=Dt},this.setPoseTarget=function(Dt){Dt!==void 0&&(A=Dt)},this.cameraAutoUpdate=!0,this.updateCamera=function(Dt){var on=$==="local-floor"?1.6:0;if(d.depthNear=Dt.near,d.depthFar=Dt.far,d.getFrameData(m),$==="local-floor"){var Ut=d.stageParameters;Ut?k.fromArray(Ut.sittingToStandingTransform):k.makeTranslation(0,on,0)}var _t=m.pose,Qt=A!==null?A:Dt;Qt.matrix.copy(k),Qt.matrix.decompose(Qt.position,Qt.quaternion,Qt.scale),_t.orientation!==null&&(ne.fromArray(_t.orientation),Qt.quaternion.multiply(ne)),_t.position!==null&&(ne.setFromRotationMatrix(k),le.fromArray(_t.position),le.applyQuaternion(ne),Qt.position.add(le)),Qt.updateMatrixWorld();for(var bn=Qt.children,je=0,Zt=bn.length;je<Zt;je++)bn[je].updateMatrixWorld(!0);se.near=Dt.near,re.near=Dt.near,se.far=Dt.far,re.far=Dt.far,se.matrixWorldInverse.fromArray(m.leftViewMatrix),re.matrixWorldInverse.fromArray(m.rightViewMatrix),N.copy(k).invert(),$==="local-floor"&&(se.matrixWorldInverse.multiply(N),re.matrixWorldInverse.multiply(N));var Qn=Qt.parent;Qn!==null&&(j.copy(Qn.matrixWorld).invert(),se.matrixWorldInverse.multiply(j),re.matrixWorldInverse.multiply(j)),se.matrixWorld.copy(se.matrixWorldInverse).invert(),re.matrixWorld.copy(re.matrixWorldInverse).invert(),se.projectionMatrix.fromArray(m.leftProjectionMatrix),re.projectionMatrix.fromArray(m.rightProjectionMatrix),p0(ye,se,re);var Kn=d.getLayers();if(Kn.length){var xi=Kn[0];at(se.viewport,xi.leftBounds),at(re.viewport,xi.rightBounds)}return Le(),ye},this.getCamera=function(){return ye},this.getFoveation=function(){return 1},this.setFoveation=function(Dt){Dt!==1&&console.warn("THREE.WebVRManager: setFoveation() not used in WebVR.")},this.getStandingMatrix=function(){return k},this.isPresenting=!1;var mt=new zg;this.setAnimationLoop=function(Dt){mt.setAnimationLoop(Dt),this.isPresenting&&mt.start()},this.submitFrame=function(){this.isPresenting&&d.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",Me)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}Object.assign(Z1.prototype,{addEventListener:io.prototype.addEventListener,hasEventListener:io.prototype.hasEventListener,removeEventListener:io.prototype.removeEventListener,dispatchEvent:io.prototype.dispatchEvent});const M2={type:"move"};class f0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Pu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Pu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new tt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new tt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Pu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new tt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new tt),this._grip}dispatchEvent(n){return this._targetRay!==null&&this._targetRay.dispatchEvent(n),this._grip!==null&&this._grip.dispatchEvent(n),this._hand!==null&&this._hand.dispatchEvent(n),this}connect(n){if(n&&n.hand){const a=this._hand;if(a)for(const u of n.hand.values())this._getHandJoint(a,u)}return this.dispatchEvent({type:"connected",data:n}),this}disconnect(n){return this.dispatchEvent({type:"disconnected",data:n}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(n,a,u){let d=null,m=null,A=null;const y=this._targetRay,k=this._grip,N=this._hand;if(n&&a.session.visibilityState!=="visible-blurred"){if(N&&n.hand){A=!0;for(const se of n.hand.values()){const re=a.getJointPose(se,u),ye=this._getHandJoint(N,se);re!==null&&(ye.matrix.fromArray(re.transform.matrix),ye.matrix.decompose(ye.position,ye.rotation,ye.scale),ye.jointRadius=re.radius),ye.visible=re!==null}const K=N.joints["index-finger-tip"],$=N.joints["thumb-tip"],j=K.position.distanceTo($.position),ne=.02,le=.005;N.inputState.pinching&&j>ne+le?(N.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!N.inputState.pinching&&j<=ne-le&&(N.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else k!==null&&n.gripSpace&&(m=a.getPose(n.gripSpace,u),m!==null&&(k.matrix.fromArray(m.transform.matrix),k.matrix.decompose(k.position,k.rotation,k.scale),m.linearVelocity?(k.hasLinearVelocity=!0,k.linearVelocity.copy(m.linearVelocity)):k.hasLinearVelocity=!1,m.angularVelocity?(k.hasAngularVelocity=!0,k.angularVelocity.copy(m.angularVelocity)):k.hasAngularVelocity=!1));y!==null&&(d=a.getPose(n.targetRaySpace,u),d===null&&m!==null&&(d=m),d!==null&&(y.matrix.fromArray(d.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),d.linearVelocity?(y.hasLinearVelocity=!0,y.linearVelocity.copy(d.linearVelocity)):y.hasLinearVelocity=!1,d.angularVelocity?(y.hasAngularVelocity=!0,y.angularVelocity.copy(d.angularVelocity)):y.hasAngularVelocity=!1,this.dispatchEvent(M2)))}return y!==null&&(y.visible=d!==null),k!==null&&(k.visible=m!==null),N!==null&&(N.visible=A!==null),this}_getHandJoint(n,a){if(n.joints[a.jointName]===void 0){const u=new Pu;u.matrixAutoUpdate=!1,u.visible=!1,n.joints[a.jointName]=u,n.add(u)}return n.joints[a.jointName]}}class Yc extends Ws{constructor(n,a,u,d,m,A,y,k,N,K){if(K=K!==void 0?K:$r,K!==$r&&K!==ws)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");u===void 0&&K===$r&&(u=Dr),u===void 0&&K===ws&&(u=Yn),super(null,d,m,A,y,k,K,u,N),this.isDepthTexture=!0,this.image={width:n,height:a},this.magFilter=y!==void 0?y:me,this.minFilter=k!==void 0?k:me,this.flipY=!1,this.generateMipmaps=!1}}class _2 extends io{constructor(n,a){super();const u=this;let d=null,m=1;var A=null;let y=null,k="local-floor",N=null,K=null;var $=[];let j=null,ne=null,le=null,se=null;const re=a.getContextAttributes();let ye=null,Be=null;const Ee=[],Me=[],Fe=new Set,it=new Map,yt=new qs;yt.layers.enable(1),yt.viewport=new es;const Le=new qs;Le.layers.enable(2),Le.viewport=new es;const at=[yt,Le],mt=new d0;mt.layers.enable(1),mt.layers.enable(2);let Dt=null,on=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.getCameraPose=function(){return K},this.getController=function(pn){let Rn=Ee[pn];return Rn===void 0&&(Rn=new f0,Ee[pn]=Rn),Rn.getTargetRaySpace()},this.getControllerGrip=function(pn){let Rn=Ee[pn];return Rn===void 0&&(Rn=new f0,Ee[pn]=Rn),Rn.getGripSpace()},this.getHand=function(pn){let Rn=Ee[pn];return Rn===void 0&&(Rn=new f0,Ee[pn]=Rn),Rn.getHandSpace()};function Ut(pn){const Rn=Me.indexOf(pn.inputSource);if(Rn===-1)return;const Vn=Ee[Rn];Vn!==void 0&&Vn.dispatchEvent({type:pn.type,data:pn.inputSource})}function _t(){d.removeEventListener("select",Ut),d.removeEventListener("selectstart",Ut),d.removeEventListener("selectend",Ut),d.removeEventListener("squeeze",Ut),d.removeEventListener("squeezestart",Ut),d.removeEventListener("squeezeend",Ut),d.removeEventListener("end",_t),d.removeEventListener("inputsourceschange",Qt);for(let pn=0;pn<Ee.length;pn++){const Rn=Me[pn];Rn!==null&&(Me[pn]=null,Ee[pn].disconnect(Rn))}Dt=null,on=null,n.setRenderTarget(ye),le=null,ne=null,j=null,d=null,Be=null,li.stop(),u.isPresenting=!1,u.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(pn){m=pn,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pn){k=pn,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return N||y},this.setReferenceSpace=function(pn){N=pn},this.getBaseLayer=function(){return ne!==null?ne:le},this.getBinding=function(){return j},this.getFrame=function(){return se},this.getSession=function(){return d},this.setSession=async function(pn){if(d=pn,d!==null){if(ye=n.getRenderTarget(),d.addEventListener("select",Ut),d.addEventListener("selectstart",Ut),d.addEventListener("selectend",Ut),d.addEventListener("squeeze",Ut),d.addEventListener("squeezestart",Ut),d.addEventListener("squeezeend",Ut),d.addEventListener("end",_t),d.addEventListener("inputsourceschange",Qt),re.xrCompatible!==!0&&await a.makeXRCompatible(),d.renderState.layers===void 0||n.capabilities.isWebGL2===!1){const Rn={antialias:d.renderState.layers===void 0?re.antialias:!0,alpha:re.alpha,depth:re.depth,stencil:re.stencil,framebufferScaleFactor:m};le=new XRWebGLLayer(d,a,Rn),d.updateRenderState({baseLayer:le}),Be=new So(le.framebufferWidth,le.framebufferHeight,{format:cr,type:Ai,encoding:n.outputEncoding,stencilBuffer:re.stencil})}else{let Rn=null,Vn=null,Jt=null;re.depth&&(Jt=re.stencil?35056:33190,Rn=re.stencil?ws:$r,Vn=re.stencil?Yn:Dr);const Ei={colorFormat:32856,depthFormat:Jt,scaleFactor:m};j=new XRWebGLBinding(d,a),ne=j.createProjectionLayer(Ei),d.updateRenderState({layers:[ne]}),Be=new So(ne.textureWidth,ne.textureHeight,{format:cr,type:Ai,depthTexture:new Yc(ne.textureWidth,ne.textureHeight,Vn,void 0,void 0,void 0,void 0,void 0,void 0,Rn),stencilBuffer:re.stencil,encoding:n.outputEncoding,samples:re.antialias?4:0});const ii=n.properties.get(Be);ii.__ignoreDepthValues=ne.ignoreDepthValues}Be.isXRRenderTarget=!0,this.setFoveation(1),N=null,y=await d.requestReferenceSpace(k),li.setContext(d),li.start(),u.isPresenting=!0,u.dispatchEvent({type:"sessionstart"})}},this.addLayer=function(pn){!window.XRWebGLBinding||!this.layersEnabled||!d||($.push(pn),this.updateLayers())},this.removeLayer=function(pn){$.splice($.indexOf(pn),1),!(!window.XRWebGLBinding||!this.layersEnabled||!d)&&this.updateLayers()},this.updateLayers=function(){var pn=$.map(function(Rn){return Rn});pn.unshift(d.renderState.layers[0]),d.updateRenderState({layers:pn})};function Qt(pn){for(let Rn=0;Rn<pn.removed.length;Rn++){const Vn=pn.removed[Rn],Jt=Me.indexOf(Vn);Jt>=0&&(Me[Jt]=null,Ee[Jt].disconnect(Vn))}for(let Rn=0;Rn<pn.added.length;Rn++){const Vn=pn.added[Rn];let Jt=Me.indexOf(Vn);if(Jt===-1){for(let ii=0;ii<Ee.length;ii++)if(ii>=Me.length){Me.push(Vn),Jt=ii;break}else if(Me[ii]===null){Me[ii]=Vn,Jt=ii;break}if(Jt===-1)break}const Ei=Ee[Jt];Ei&&Ei.connect(Vn)}}const bn=new tt,je=new tt;function Zt(pn,Rn,Vn){bn.setFromMatrixPosition(Rn.matrixWorld),je.setFromMatrixPosition(Vn.matrixWorld);const Jt=bn.distanceTo(je),Ei=Rn.projectionMatrix.elements,ii=Vn.projectionMatrix.elements,tr=Ei[14]/(Ei[10]-1),ni=Ei[14]/(Ei[10]+1),Mr=(Ei[9]+1)/Ei[5],Ln=(Ei[9]-1)/Ei[5],Tn=(Ei[8]-1)/Ei[0],qn=(ii[8]+1)/ii[0],$i=tr*Tn,mi=tr*qn,wr=Jt/(-Tn+qn),ki=wr*-Tn;Rn.matrixWorld.decompose(pn.position,pn.quaternion,pn.scale),pn.translateX(ki),pn.translateZ(wr),pn.matrixWorld.compose(pn.position,pn.quaternion,pn.scale),pn.matrixWorldInverse.copy(pn.matrixWorld).invert();const sr=tr+wr,Os=ni+wr,Ts=$i-ki,ot=mi+(Jt-ki),Ze=Mr*ni/Os*sr,ln=Ln*ni/Os*sr;pn.projectionMatrix.makePerspective(Ts,ot,Ze,ln,sr,Os)}function Qn(pn,Rn){Rn===null?pn.matrixWorld.copy(pn.matrix):pn.matrixWorld.multiplyMatrices(Rn.matrixWorld,pn.matrix),pn.matrixWorldInverse.copy(pn.matrixWorld).invert()}this.setPoseTarget=function(pn){pn!==void 0&&(A=pn)},this.updateCamera=function(pn){if(d===null)return;mt.near=Le.near=yt.near=pn.near,mt.far=Le.far=yt.far=pn.far,(Dt!==mt.near||on!==mt.far)&&(d.updateRenderState({depthNear:mt.near,depthFar:mt.far}),Dt=mt.near,on=mt.far);const Rn=mt.cameras;var Vn=A||pn;const Jt=Vn.parent;Qn(mt,Jt);for(let ii=0;ii<Rn.length;ii++)Qn(Rn[ii],Jt);mt.matrixWorld.decompose(mt.position,mt.quaternion,mt.scale),Vn.matrixWorld.copy(mt.matrixWorld),Vn.matrix.copy(mt.matrix),Vn.matrix.decompose(Vn.position,Vn.quaternion,Vn.scale);const Ei=Vn.children;for(let ii=0,tr=Ei.length;ii<tr;ii++)Ei[ii].updateMatrixWorld(!0);Rn.length===2?Zt(mt,yt,Le):mt.projectionMatrix.copy(yt.projectionMatrix)},this.getCamera=function(){return mt},this.getFoveation=function(){if(ne!==null)return ne.fixedFoveation;if(le!==null)return le.fixedFoveation},this.setFoveation=function(pn){ne!==null&&(ne.fixedFoveation=pn),le!==null&&le.fixedFoveation!==void 0&&(le.fixedFoveation=pn)},this.getPlanes=function(){return Fe};let Kn=null;function xi(pn,Rn){if(K=Rn.getViewerPose(N||y),se=Rn,K!==null){const Vn=K.views;le!==null&&(n.setRenderTargetFramebuffer(Be,le.framebuffer),n.setRenderTarget(Be));let Jt=!1;Vn.length!==mt.cameras.length&&(mt.cameras.length=0,Jt=!0);for(let Ei=0;Ei<Vn.length;Ei++){const ii=Vn[Ei];let tr=null;if(le!==null)tr=le.getViewport(ii);else{const Mr=j.getViewSubImage(ne,ii);tr=Mr.viewport,Ei===0&&(n.setRenderTargetTextures(Be,Mr.colorTexture,ne.ignoreDepthValues?void 0:Mr.depthStencilTexture),n.setRenderTarget(Be))}let ni=at[Ei];ni===void 0&&(ni=new qs,ni.layers.enable(Ei),ni.viewport=new es,at[Ei]=ni),ni.matrix.fromArray(ii.transform.matrix),ni.projectionMatrix.fromArray(ii.projectionMatrix),ni.viewport.set(tr.x,tr.y,tr.width,tr.height),Ei===0&&mt.matrix.copy(ni.matrix),Jt===!0&&mt.cameras.push(ni)}}for(let Vn=0;Vn<Ee.length;Vn++){const Jt=Me[Vn],Ei=Ee[Vn];Jt!==null&&Ei!==void 0&&Ei.update(Jt,Rn,N||y)}if(Kn&&Kn(pn,Rn),Rn.detectedPlanes){u.dispatchEvent({type:"planesdetected",data:Rn.detectedPlanes});let Vn=null;for(const Jt of Fe)Rn.detectedPlanes.has(Jt)||(Vn===null&&(Vn=[]),Vn.push(Jt));if(Vn!==null)for(const Jt of Vn)Fe.delete(Jt),it.delete(Jt),u.dispatchEvent({type:"planeremoved",data:Jt});for(const Jt of Rn.detectedPlanes)if(!Fe.has(Jt))Fe.add(Jt),it.set(Jt,Rn.lastChangedTime),u.dispatchEvent({type:"planeadded",data:Jt});else{const Ei=it.get(Jt);Jt.lastChangedTime>Ei&&(it.set(Jt,Jt.lastChangedTime),u.dispatchEvent({type:"planechanged",data:Jt}))}}se=null}const li=new zg;li.setAnimationLoop(xi),this.setAnimationLoop=function(pn){Kn=pn},this.dispose=function(){}}}function Na(x,n){function a(se,re){re.color.getRGB(se.fogColor.value,t1(x)),re.isFog?(se.fogNear.value=re.near,se.fogFar.value=re.far):re.isFogExp2&&(se.fogDensity.value=re.density)}function u(se,re,ye,Be,Ee){re.isMeshBasicMaterial||re.isMeshLambertMaterial?d(se,re):re.isMeshToonMaterial?(d(se,re),K(se,re)):re.isMeshPhongMaterial?(d(se,re),N(se,re)):re.isMeshStandardMaterial?(d(se,re),$(se,re),re.isMeshPhysicalMaterial&&j(se,re,Ee)):re.isMeshMatcapMaterial?(d(se,re),ne(se,re)):re.isMeshDepthMaterial?d(se,re):re.isMeshDistanceMaterial?(d(se,re),le(se,re)):re.isMeshNormalMaterial?d(se,re):re.isLineBasicMaterial?(m(se,re),re.isLineDashedMaterial&&A(se,re)):re.isPointsMaterial?y(se,re,ye,Be):re.isSpriteMaterial?k(se,re):re.isShadowMaterial?(se.color.value.copy(re.color),se.opacity.value=re.opacity):re.isShaderMaterial&&(re.uniformsNeedUpdate=!1)}function d(se,re){se.opacity.value=re.opacity,re.color&&se.diffuse.value.copy(re.color),re.emissive&&se.emissive.value.copy(re.emissive).multiplyScalar(re.emissiveIntensity),re.map&&(se.map.value=re.map),re.alphaMap&&(se.alphaMap.value=re.alphaMap),re.bumpMap&&(se.bumpMap.value=re.bumpMap,se.bumpScale.value=re.bumpScale,re.side===V&&(se.bumpScale.value*=-1)),re.displacementMap&&(se.displacementMap.value=re.displacementMap,se.displacementScale.value=re.displacementScale,se.displacementBias.value=re.displacementBias),re.emissiveMap&&(se.emissiveMap.value=re.emissiveMap),re.normalMap&&(se.normalMap.value=re.normalMap,se.normalScale.value.copy(re.normalScale),re.side===V&&se.normalScale.value.negate()),re.specularMap&&(se.specularMap.value=re.specularMap),re.alphaTest>0&&(se.alphaTest.value=re.alphaTest);const ye=n.get(re).envMap;if(ye&&(se.envMap.value=ye,se.flipEnvMap.value=ye.isCubeTexture&&ye.isRenderTargetTexture===!1?-1:1,se.reflectivity.value=re.reflectivity,se.ior.value=re.ior,se.refractionRatio.value=re.refractionRatio),re.lightMap){se.lightMap.value=re.lightMap;const Me=x.physicallyCorrectLights!==!0?Math.PI:1;se.lightMapIntensity.value=re.lightMapIntensity*Me}re.aoMap&&(se.aoMap.value=re.aoMap,se.aoMapIntensity.value=re.aoMapIntensity);let Be;re.map?Be=re.map:re.specularMap?Be=re.specularMap:re.displacementMap?Be=re.displacementMap:re.normalMap?Be=re.normalMap:re.bumpMap?Be=re.bumpMap:re.roughnessMap?Be=re.roughnessMap:re.metalnessMap?Be=re.metalnessMap:re.alphaMap?Be=re.alphaMap:re.emissiveMap?Be=re.emissiveMap:re.clearcoatMap?Be=re.clearcoatMap:re.clearcoatNormalMap?Be=re.clearcoatNormalMap:re.clearcoatRoughnessMap?Be=re.clearcoatRoughnessMap:re.iridescenceMap?Be=re.iridescenceMap:re.iridescenceThicknessMap?Be=re.iridescenceThicknessMap:re.specularIntensityMap?Be=re.specularIntensityMap:re.specularColorMap?Be=re.specularColorMap:re.transmissionMap?Be=re.transmissionMap:re.thicknessMap?Be=re.thicknessMap:re.sheenColorMap?Be=re.sheenColorMap:re.sheenRoughnessMap&&(Be=re.sheenRoughnessMap),Be!==void 0&&(Be.isWebGLRenderTarget&&(Be=Be.texture),Be.matrixAutoUpdate===!0&&Be.updateMatrix(),se.uvTransform.value.copy(Be.matrix));let Ee;re.aoMap?Ee=re.aoMap:re.lightMap&&(Ee=re.lightMap),Ee!==void 0&&(Ee.isWebGLRenderTarget&&(Ee=Ee.texture),Ee.matrixAutoUpdate===!0&&Ee.updateMatrix(),se.uv2Transform.value.copy(Ee.matrix))}function m(se,re){se.diffuse.value.copy(re.color),se.opacity.value=re.opacity}function A(se,re){se.dashSize.value=re.dashSize,se.totalSize.value=re.dashSize+re.gapSize,se.scale.value=re.scale}function y(se,re,ye,Be){se.diffuse.value.copy(re.color),se.opacity.value=re.opacity,se.size.value=re.size*ye,se.scale.value=Be*.5,re.map&&(se.map.value=re.map),re.alphaMap&&(se.alphaMap.value=re.alphaMap),re.alphaTest>0&&(se.alphaTest.value=re.alphaTest);let Ee;re.map?Ee=re.map:re.alphaMap&&(Ee=re.alphaMap),Ee!==void 0&&(Ee.matrixAutoUpdate===!0&&Ee.updateMatrix(),se.uvTransform.value.copy(Ee.matrix))}function k(se,re){se.diffuse.value.copy(re.color),se.opacity.value=re.opacity,se.rotation.value=re.rotation,re.map&&(se.map.value=re.map),re.alphaMap&&(se.alphaMap.value=re.alphaMap),re.alphaTest>0&&(se.alphaTest.value=re.alphaTest);let ye;re.map?ye=re.map:re.alphaMap&&(ye=re.alphaMap),ye!==void 0&&(ye.matrixAutoUpdate===!0&&ye.updateMatrix(),se.uvTransform.value.copy(ye.matrix))}function N(se,re){se.specular.value.copy(re.specular),se.shininess.value=Math.max(re.shininess,1e-4)}function K(se,re){re.gradientMap&&(se.gradientMap.value=re.gradientMap)}function $(se,re){se.roughness.value=re.roughness,se.metalness.value=re.metalness,re.roughnessMap&&(se.roughnessMap.value=re.roughnessMap),re.metalnessMap&&(se.metalnessMap.value=re.metalnessMap),n.get(re).envMap&&(se.envMapIntensity.value=re.envMapIntensity)}function j(se,re,ye){se.ior.value=re.ior,re.sheen>0&&(se.sheenColor.value.copy(re.sheenColor).multiplyScalar(re.sheen),se.sheenRoughness.value=re.sheenRoughness,re.sheenColorMap&&(se.sheenColorMap.value=re.sheenColorMap),re.sheenRoughnessMap&&(se.sheenRoughnessMap.value=re.sheenRoughnessMap)),re.clearcoat>0&&(se.clearcoat.value=re.clearcoat,se.clearcoatRoughness.value=re.clearcoatRoughness,re.clearcoatMap&&(se.clearcoatMap.value=re.clearcoatMap),re.clearcoatRoughnessMap&&(se.clearcoatRoughnessMap.value=re.clearcoatRoughnessMap),re.clearcoatNormalMap&&(se.clearcoatNormalScale.value.copy(re.clearcoatNormalScale),se.clearcoatNormalMap.value=re.clearcoatNormalMap,re.side===V&&se.clearcoatNormalScale.value.negate())),re.iridescence>0&&(se.iridescence.value=re.iridescence,se.iridescenceIOR.value=re.iridescenceIOR,se.iridescenceThicknessMinimum.value=re.iridescenceThicknessRange[0],se.iridescenceThicknessMaximum.value=re.iridescenceThicknessRange[1],re.iridescenceMap&&(se.iridescenceMap.value=re.iridescenceMap),re.iridescenceThicknessMap&&(se.iridescenceThicknessMap.value=re.iridescenceThicknessMap)),re.transmission>0&&(se.transmission.value=re.transmission,se.transmissionSamplerMap.value=ye.texture,se.transmissionSamplerSize.value.set(ye.width,ye.height),re.transmissionMap&&(se.transmissionMap.value=re.transmissionMap),se.thickness.value=re.thickness,re.thicknessMap&&(se.thicknessMap.value=re.thicknessMap),se.attenuationDistance.value=re.attenuationDistance,se.attenuationColor.value.copy(re.attenuationColor)),se.specularIntensity.value=re.specularIntensity,se.specularColor.value.copy(re.specularColor),re.specularIntensityMap&&(se.specularIntensityMap.value=re.specularIntensityMap),re.specularColorMap&&(se.specularColorMap.value=re.specularColorMap)}function ne(se,re){re.matcap&&(se.matcap.value=re.matcap)}function le(se,re){se.referencePosition.value.copy(re.referencePosition),se.nearDistance.value=re.nearDistance,se.farDistance.value=re.farDistance}return{refreshFogUniforms:a,refreshMaterialUniforms:u}}function eo(x,n,a,u){let d={},m={},A=[];const y=a.isWebGL2?x.getParameter(35375):0;function k(Be,Ee){const Me=Ee.program;u.uniformBlockBinding(Be,Me)}function N(Be,Ee){let Me=d[Be.id];Me===void 0&&(le(Be),Me=K(Be),d[Be.id]=Me,Be.addEventListener("dispose",re));const Fe=Ee.program;u.updateUBOMapping(Be,Fe);const it=n.render.frame;m[Be.id]!==it&&(j(Be),m[Be.id]=it)}function K(Be){const Ee=$();Be.__bindingPointIndex=Ee;const Me=x.createBuffer(),Fe=Be.__size,it=Be.usage;return x.bindBuffer(35345,Me),x.bufferData(35345,Fe,it),x.bindBuffer(35345,null),x.bindBufferBase(35345,Ee,Me),Me}function $(){for(let Be=0;Be<y;Be++)if(A.indexOf(Be)===-1)return A.push(Be),Be;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function j(Be){const Ee=d[Be.id],Me=Be.uniforms,Fe=Be.__cache;x.bindBuffer(35345,Ee);for(let it=0,yt=Me.length;it<yt;it++){const Le=Me[it];if(ne(Le,it,Fe)===!0){const at=Le.value,mt=Le.__offset;typeof at=="number"?(Le.__data[0]=at,x.bufferSubData(35345,mt,Le.__data)):(Le.value.isMatrix3?(Le.__data[0]=Le.value.elements[0],Le.__data[1]=Le.value.elements[1],Le.__data[2]=Le.value.elements[2],Le.__data[3]=Le.value.elements[0],Le.__data[4]=Le.value.elements[3],Le.__data[5]=Le.value.elements[4],Le.__data[6]=Le.value.elements[5],Le.__data[7]=Le.value.elements[0],Le.__data[8]=Le.value.elements[6],Le.__data[9]=Le.value.elements[7],Le.__data[10]=Le.value.elements[8],Le.__data[11]=Le.value.elements[0]):at.toArray(Le.__data),x.bufferSubData(35345,mt,Le.__data))}}x.bindBuffer(35345,null)}function ne(Be,Ee,Me){const Fe=Be.value;if(Me[Ee]===void 0)return typeof Fe=="number"?Me[Ee]=Fe:Me[Ee]=Fe.clone(),!0;if(typeof Fe=="number"){if(Me[Ee]!==Fe)return Me[Ee]=Fe,!0}else{const it=Me[Ee];if(it.equals(Fe)===!1)return it.copy(Fe),!0}return!1}function le(Be){const Ee=Be.uniforms;let Me=0;const Fe=16;let it=0;for(let yt=0,Le=Ee.length;yt<Le;yt++){const at=Ee[yt],mt=se(at);if(at.__data=new Float32Array(mt.storage/Float32Array.BYTES_PER_ELEMENT),at.__offset=Me,yt>0){it=Me%Fe;const Dt=Fe-it;it!==0&&Dt-mt.boundary<0&&(Me+=Fe-it,at.__offset=Me)}Me+=mt.storage}return it=Me%Fe,it>0&&(Me+=Fe-it),Be.__size=Me,Be.__cache={},this}function se(Be){const Ee=Be.value,Me={boundary:0,storage:0};return typeof Ee=="number"?(Me.boundary=4,Me.storage=4):Ee.isVector2?(Me.boundary=8,Me.storage=8):Ee.isVector3||Ee.isColor?(Me.boundary=16,Me.storage=12):Ee.isVector4?(Me.boundary=16,Me.storage=16):Ee.isMatrix3?(Me.boundary=48,Me.storage=48):Ee.isMatrix4?(Me.boundary=64,Me.storage=64):Ee.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Ee),Me}function re(Be){const Ee=Be.target;Ee.removeEventListener("dispose",re);const Me=A.indexOf(Ee.__bindingPointIndex);A.splice(Me,1),x.deleteBuffer(d[Ee.id]),delete d[Ee.id],delete m[Ee.id]}function ye(){for(const Be in d)x.deleteBuffer(d[Be]);A=[],d={},m={}}return{bind:k,update:N,dispose:ye}}function Nh(){const x=ql("canvas");return x.style.display="block",x}function $1(x={}){this.isWebGLRenderer=!0;const n=x.canvas!==void 0?x.canvas:Nh(),a=x.context!==void 0?x.context:null,u=x.depth!==void 0?x.depth:!0,d=x.stencil!==void 0?x.stencil:!0,m=x.antialias!==void 0?x.antialias:!1,A=x.premultipliedAlpha!==void 0?x.premultipliedAlpha:!0,y=x.preserveDrawingBuffer!==void 0?x.preserveDrawingBuffer:!1,k=x.powerPreference!==void 0?x.powerPreference:"default",N=x.failIfMajorPerformanceCaveat!==void 0?x.failIfMajorPerformanceCaveat:!1;let K;a!==null?K=a.getContextAttributes().alpha:K=x.alpha!==void 0?x.alpha:!1;let $=null,j=null;const ne=[],le=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Qr,this.physicallyCorrectLights=!1,this.toneMapping=wn,this.toneMappingExposure=1;const se=this;let re=!1,ye=0,Be=0,Ee=null,Me=-1,Fe=null;const it=new es,yt=new es;let Le=null,at=n.width,mt=n.height,Dt=1,on=null,Ut=null;const _t=new es(0,0,at,mt),Qt=new es(0,0,at,mt);let bn=!1;const je=new Pf;let Zt=!1,Qn=!1,Kn=null;const xi=new Ri,li=new kn,pn=new tt,Rn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Vn(){return Ee===null?Dt:1}let Jt=a;function Ei(qe,jt){for(let un=0;un<qe.length;un++){const Ht=qe[un],In=n.getContext(Ht,jt);if(In!==null)return In}return null}try{const qe={alpha:!0,depth:u,stencil:d,antialias:m,premultipliedAlpha:A,preserveDrawingBuffer:y,powerPreference:k,failIfMajorPerformanceCaveat:N};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${B}`),n.addEventListener("webglcontextlost",zi,!1),n.addEventListener("webglcontextrestored",ar,!1),n.addEventListener("webglcontextcreationerror",Jr,!1),Jt===null){const jt=["webgl2","webgl","experimental-webgl"];if(se.isWebGL1Renderer===!0&&jt.shift(),Jt=Ei(jt,qe),Jt===null)throw Ei(jt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Jt.getShaderPrecisionFormat===void 0&&(Jt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(qe){throw console.error("THREE.WebGLRenderer: "+qe.message),qe}let ii,tr,ni,Mr,Ln,Tn,qn,$i,mi,wr,ki,sr,Os,Ts,ot,Ze,ln,Xn,oi,Mi,Sr,_i,_n,ji;function Bi(){ii=new _1(Jt),tr=new Ex(Jt,ii,x),ii.init(tr),_i=new K1(Jt,ii,tr),ni=new T2(Jt,ii,tr),Mr=new Bx,Ln=new Ec,Tn=new h0(Jt,ii,ni,Ln,tr,_i,Mr),qn=new Sx(se),$i=new _x(se),mi=new Ib(Jt,tr),_n=new Cx(Jt,ii,mi,tr),wr=new Rx(Jt,mi,Mr,_n),ki=new Dx(Jt,wr,mi,Mr),oi=new Lx(Jt,tr,Tn),Ze=new Ix(Ln),sr=new v2(se,qn,$i,ii,tr,_n,Ze),Os=new Na(se,Ln),Ts=new Ld,ot=new E2(ii,tr),Xn=new xx(se,qn,$i,ni,ki,K,A),ln=new jc(se,ki,tr),ji=new eo(Jt,Mr,tr,ni),Mi=new wx(Jt,ii,Mr,tr),Sr=new t0(Jt,ii,Mr,tr),Mr.programs=sr.programs,se.capabilities=tr,se.extensions=ii,se.properties=Ln,se.renderLists=Ts,se.shadowMap=ln,se.state=ni,se.info=Mr}Bi();const Ki=typeof navigator<"u"&&"xr"in navigator?new _2(se,Jt):new Z1(se);this.xr=Ki,this.getContext=function(){return Jt},this.getContextAttributes=function(){return Jt.getContextAttributes()},this.forceContextLoss=function(){const qe=ii.get("WEBGL_lose_context");qe&&qe.loseContext()},this.forceContextRestore=function(){const qe=ii.get("WEBGL_lose_context");qe&&qe.restoreContext()},this.getPixelRatio=function(){return Dt},this.setPixelRatio=function(qe){qe!==void 0&&(Dt=qe,this.setSize(at,mt,!1))},this.getSize=function(qe){return qe.set(at,mt)},this.setSize=function(qe,jt,un){if(Ki.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}at=qe,mt=jt,n.width=Math.floor(qe*Dt),n.height=Math.floor(jt*Dt),un!==!1&&(n.style.width=qe+"px",n.style.height=jt+"px"),this.setViewport(0,0,qe,jt)},this.getDrawingBufferSize=function(qe){return qe.set(at*Dt,mt*Dt).floor()},this.setDrawingBufferSize=function(qe,jt,un){at=qe,mt=jt,Dt=un,n.width=Math.floor(qe*un),n.height=Math.floor(jt*un),this.setViewport(0,0,qe,jt)},this.getCurrentViewport=function(qe){return qe.copy(it)},this.getViewport=function(qe){return qe.copy(_t)},this.setViewport=function(qe,jt,un,Ht){qe.isVector4?_t.set(qe.x,qe.y,qe.z,qe.w):_t.set(qe,jt,un,Ht),ni.viewport(it.copy(_t).multiplyScalar(Dt).floor())},this.getScissor=function(qe){return qe.copy(Qt)},this.setScissor=function(qe,jt,un,Ht){qe.isVector4?Qt.set(qe.x,qe.y,qe.z,qe.w):Qt.set(qe,jt,un,Ht),ni.scissor(yt.copy(Qt).multiplyScalar(Dt).floor())},this.getScissorTest=function(){return bn},this.setScissorTest=function(qe){ni.setScissorTest(bn=qe)},this.setOpaqueSort=function(qe){on=qe},this.setTransparentSort=function(qe){Ut=qe},this.getClearColor=function(qe){return qe.copy(Xn.getClearColor())},this.setClearColor=function(){Xn.setClearColor.apply(Xn,arguments)},this.getClearAlpha=function(){return Xn.getClearAlpha()},this.setClearAlpha=function(){Xn.setClearAlpha.apply(Xn,arguments)},this.clear=function(qe=!0,jt=!0,un=!0){let Ht=0;qe&&(Ht|=16384),jt&&(Ht|=256),un&&(Ht|=1024),Jt.clear(Ht)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",zi,!1),n.removeEventListener("webglcontextrestored",ar,!1),n.removeEventListener("webglcontextcreationerror",Jr,!1),Ts.dispose(),ot.dispose(),Ln.dispose(),qn.dispose(),$i.dispose(),ki.dispose(),_n.dispose(),ji.dispose(),sr.dispose(),Ki.dispose(),Ki.removeEventListener("sessionstart",Li),Ki.removeEventListener("sessionend",qi),Kn&&(Kn.dispose(),Kn=null),Ms.stop()};function zi(qe){qe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),re=!0}function ar(){console.log("THREE.WebGLRenderer: Context Restored."),re=!1;const qe=Mr.autoReset,jt=ln.enabled,un=ln.autoUpdate,Ht=ln.needsUpdate,In=ln.type;Bi(),Mr.autoReset=qe,ln.enabled=jt,ln.autoUpdate=un,ln.needsUpdate=Ht,ln.type=In}function Jr(qe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",qe.statusMessage)}function na(qe){const jt=qe.target;jt.removeEventListener("dispose",na),da(jt)}function da(qe){Mt(qe),Ln.remove(qe)}function Mt(qe){const jt=Ln.get(qe).programs;jt!==void 0&&(jt.forEach(function(un){sr.releaseProgram(un)}),qe.isShaderMaterial&&sr.releaseShaderCache(qe))}this.renderBufferDirect=function(qe,jt,un,Ht,In,or){jt===null&&(jt=Rn);const _r=In.isMesh&&In.matrixWorld.determinant()<0,Ur=qp(qe,jt,un,Ht,In);ni.setMaterial(Ht,_r);let Vr=un.index,Nr=1;Ht.wireframe===!0&&(Vr=wr.getWireframeAttribute(un),Nr=2);const is=un.drawRange,Zr=un.attributes.position;let Ia=is.start*Nr,Aa=(is.start+is.count)*Nr;or!==null&&(Ia=Math.max(Ia,or.start*Nr),Aa=Math.min(Aa,(or.start+or.count)*Nr)),Vr!==null?(Ia=Math.max(Ia,0),Aa=Math.min(Aa,Vr.count)):Zr!=null&&(Ia=Math.max(Ia,0),Aa=Math.min(Aa,Zr.count));const du=Aa-Ia;if(du<0||du===1/0)return;_n.setup(In,Ht,Ur,un,Vr);let Qh,Ga=Mi;if(Vr!==null&&(Qh=mi.get(Vr),Ga=Sr,Ga.setIndex(Qh)),In.isMesh)Ht.wireframe===!0?(ni.setLineWidth(Ht.wireframeLinewidth*Vn()),Ga.setMode(1)):Ga.setMode(4);else if(In.isLine){let ls=Ht.linewidth;ls===void 0&&(ls=1),ni.setLineWidth(ls*Vn()),In.isLineSegments?Ga.setMode(1):In.isLineLoop?Ga.setMode(2):Ga.setMode(3)}else In.isPoints?Ga.setMode(0):In.isSprite&&Ga.setMode(4);if(In.isInstancedMesh)Ga.renderInstances(Ia,du,In.count);else if(un.isInstancedBufferGeometry){const ls=un._maxInstanceCount!==void 0?un._maxInstanceCount:1/0,Zh=Math.min(un.instanceCount,ls);Ga.renderInstances(Ia,du,Zh)}else Ga.render(Ia,du)},this.compile=function(qe,jt){function un(Ht,In,or){Ht.transparent===!0&&Ht.side===J?(Ht.side=V,Ht.needsUpdate=!0,Es(Ht,In,or),Ht.side=D,Ht.needsUpdate=!0,Es(Ht,In,or),Ht.side=J):Es(Ht,In,or)}j=ot.get(qe),j.init(),le.push(j),qe.traverseVisible(function(Ht){Ht.isLight&&Ht.layers.test(jt.layers)&&(j.pushLight(Ht),Ht.castShadow&&j.pushShadow(Ht))}),j.setupLights(se.physicallyCorrectLights),qe.traverse(function(Ht){const In=Ht.material;if(In)if(Array.isArray(In))for(let or=0;or<In.length;or++){const _r=In[or];un(_r,qe,Ht)}else un(In,qe,Ht)}),le.pop(),j=null};let Cn=null;function Zn(qe){Cn&&Cn(qe)}function Li(){Ms.stop()}function qi(){Ms.start()}const Ms=new zg;Ms.setAnimationLoop(Zn),typeof self<"u"&&Ms.setContext(self),this.setAnimationLoop=function(qe){Cn=qe,Ki.setAnimationLoop(qe),qe===null?Ms.stop():Ms.start()},Ki.addEventListener("sessionstart",Li),Ki.addEventListener("sessionend",qi),this.render=function(qe,jt){if(jt!==void 0&&jt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(re===!0)return;qe.matrixWorldAutoUpdate===!0&&qe.updateMatrixWorld(),jt.parent===null&&jt.matrixWorldAutoUpdate===!0&&jt.updateMatrixWorld(),Ki.enabled===!0&&Ki.isPresenting===!0&&(Ki.cameraAutoUpdate===!0&&Ki.updateCamera(jt),jt=Ki.getCamera()),qe.isScene===!0&&qe.onBeforeRender(se,qe,jt,Ee),j=ot.get(qe,le.length),j.init(),le.push(j),xi.multiplyMatrices(jt.projectionMatrix,jt.matrixWorldInverse),je.setFromProjectionMatrix(xi),Qn=this.localClippingEnabled,Zt=Ze.init(this.clippingPlanes,Qn,jt),$=Ts.get(qe,ne.length),$.init(),ne.push($),ia(qe,jt,0,se.sortObjects),$.finish(),se.sortObjects===!0&&$.sort(on,Ut),Zt===!0&&Ze.beginShadows();const un=j.state.shadowsArray;if(ln.render(un,qe,jt),Zt===!0&&Ze.endShadows(),this.info.autoReset===!0&&this.info.reset(),Xn.render($,qe),j.setupLights(se.physicallyCorrectLights),jt.isArrayCamera){const Ht=jt.cameras;for(let In=0,or=Ht.length;In<or;In++){const _r=Ht[In];Oa($,qe,_r,_r.viewport)}}else Oa($,qe,jt);Ee!==null&&(Tn.updateMultisampleRenderTarget(Ee),Tn.updateRenderTargetMipmap(Ee)),qe.isScene===!0&&qe.onAfterRender(se,qe,jt),Ki.enabled&&Ki.submitFrame&&Ki.submitFrame(),_n.resetDefaultState(),Me=-1,Fe=null,le.pop(),le.length>0?j=le[le.length-1]:j=null,ne.pop(),ne.length>0?$=ne[ne.length-1]:$=null};function ia(qe,jt,un,Ht){if(qe.visible===!1)return;if(qe.layers.test(jt.layers)){if(qe.isGroup)un=qe.renderOrder;else if(qe.isLOD)qe.autoUpdate===!0&&qe.update(jt);else if(qe.isLight)j.pushLight(qe),qe.castShadow&&j.pushShadow(qe);else if(qe.isSprite){if(!qe.frustumCulled||je.intersectsSprite(qe)){Ht&&pn.setFromMatrixPosition(qe.matrixWorld).applyMatrix4(xi);const _r=ki.update(qe),Ur=qe.material;Ur.visible&&$.push(qe,_r,Ur,un,pn.z,null)}}else if((qe.isMesh||qe.isLine||qe.isPoints)&&(qe.isSkinnedMesh&&qe.skeleton.frame!==Mr.render.frame&&(qe.skeleton.update(),qe.skeleton.frame=Mr.render.frame),!qe.frustumCulled||je.intersectsObject(qe))){Ht&&pn.setFromMatrixPosition(qe.matrixWorld).applyMatrix4(xi);const _r=ki.update(qe),Ur=qe.material;if(Array.isArray(Ur)){const Vr=_r.groups;for(let Nr=0,is=Vr.length;Nr<is;Nr++){const Zr=Vr[Nr],Ia=Ur[Zr.materialIndex];Ia&&Ia.visible&&$.push(qe,_r,Ia,un,pn.z,Zr)}}else Ur.visible&&$.push(qe,_r,Ur,un,pn.z,null)}}const or=qe.children;for(let _r=0,Ur=or.length;_r<Ur;_r++)ia(or[_r],jt,un,Ht)}function Oa(qe,jt,un,Ht){const In=qe.opaque,or=qe.transmissive,_r=qe.transparent;j.setupLightsView(un),or.length>0&&nl(In,jt,un),Ht&&ni.viewport(it.copy(Ht)),In.length>0&&os(In,jt,un),or.length>0&&os(or,jt,un),_r.length>0&&os(_r,jt,un),ni.buffers.depth.setTest(!0),ni.buffers.depth.setMask(!0),ni.buffers.color.setMask(!0),ni.setPolygonOffset(!1)}function nl(qe,jt,un){const Ht=tr.isWebGL2;Kn===null&&(Kn=new So(1,1,{generateMipmaps:!0,type:ii.has("EXT_color_buffer_half_float")?hn:Ai,minFilter:bi,samples:Ht&&m===!0?4:0})),se.getDrawingBufferSize(li),Ht?Kn.setSize(li.x,li.y):Kn.setSize(Ah(li.x),Ah(li.y));const In=se.getRenderTarget();se.setRenderTarget(Kn),se.clear();const or=se.toneMapping;se.toneMapping=wn,os(qe,jt,un),se.toneMapping=or,Tn.updateMultisampleRenderTarget(Kn),Tn.updateRenderTargetMipmap(Kn),se.setRenderTarget(In)}function os(qe,jt,un){const Ht=jt.isScene===!0?jt.overrideMaterial:null;for(let In=0,or=qe.length;In<or;In++){const _r=qe[In],Ur=_r.object,Vr=_r.geometry,Nr=Ht===null?_r.material:Ht,is=_r.group;Ur.layers.test(un.layers)&&uc(Ur,jt,un,Vr,Nr,is)}}function uc(qe,jt,un,Ht,In,or){qe.onBeforeRender(se,jt,un,Ht,In,or),qe.modelViewMatrix.multiplyMatrices(un.matrixWorldInverse,qe.matrixWorld),qe.normalMatrix.getNormalMatrix(qe.modelViewMatrix),In.onBeforeRender(se,jt,un,Ht,qe,or),In.transparent===!0&&In.side===J?(In.side=V,In.needsUpdate=!0,se.renderBufferDirect(un,jt,Ht,In,qe,or),In.side=D,In.needsUpdate=!0,se.renderBufferDirect(un,jt,Ht,In,qe,or),In.side=J):se.renderBufferDirect(un,jt,Ht,In,qe,or),qe.onAfterRender(se,jt,un,Ht,In,or)}function Es(qe,jt,un){jt.isScene!==!0&&(jt=Rn);const Ht=Ln.get(qe),In=j.state.lights,or=j.state.shadowsArray,_r=In.state.version,Ur=sr.getParameters(qe,In.state,or,jt,un),Vr=sr.getProgramCacheKey(Ur);let Nr=Ht.programs;Ht.environment=qe.isMeshStandardMaterial?jt.environment:null,Ht.fog=jt.fog,Ht.envMap=(qe.isMeshStandardMaterial?$i:qn).get(qe.envMap||Ht.environment),Nr===void 0&&(qe.addEventListener("dispose",na),Nr=new Map,Ht.programs=Nr);let is=Nr.get(Vr);if(is!==void 0){if(Ht.currentProgram===is&&Ht.lightsStateVersion===_r)return Hl(qe,Ur),is}else Ur.uniforms=sr.getUniforms(qe),qe.onBuild(un,Ur,se),qe.onBeforeCompile(Ur,se),is=sr.acquireProgram(Ur,Vr),Nr.set(Vr,is),Ht.uniforms=Ur.uniforms;const Zr=Ht.uniforms;(!qe.isShaderMaterial&&!qe.isRawShaderMaterial||qe.clipping===!0)&&(Zr.clippingPlanes=Ze.uniform),Hl(qe,Ur),Ht.needsLights=ow(qe),Ht.lightsStateVersion=_r,Ht.needsLights&&(Zr.ambientLightColor.value=In.state.ambient,Zr.lightProbe.value=In.state.probe,Zr.directionalLights.value=In.state.directional,Zr.directionalLightShadows.value=In.state.directionalShadow,Zr.spotLights.value=In.state.spot,Zr.spotLightShadows.value=In.state.spotShadow,Zr.rectAreaLights.value=In.state.rectArea,Zr.ltc_1.value=In.state.rectAreaLTC1,Zr.ltc_2.value=In.state.rectAreaLTC2,Zr.pointLights.value=In.state.point,Zr.pointLightShadows.value=In.state.pointShadow,Zr.hemisphereLights.value=In.state.hemi,Zr.directionalShadowMap.value=In.state.directionalShadowMap,Zr.directionalShadowMatrix.value=In.state.directionalShadowMatrix,Zr.spotShadowMap.value=In.state.spotShadowMap,Zr.spotLightMatrix.value=In.state.spotLightMatrix,Zr.spotLightMap.value=In.state.spotLightMap,Zr.pointShadowMap.value=In.state.pointShadowMap,Zr.pointShadowMatrix.value=In.state.pointShadowMatrix);const Ia=is.getUniforms(),Aa=Jf.seqWithValue(Ia.seq,Zr);return Ht.currentProgram=is,Ht.uniformsList=Aa,is}function Hl(qe,jt){const un=Ln.get(qe);un.outputEncoding=jt.outputEncoding,un.instancing=jt.instancing,un.skinning=jt.skinning,un.morphTargets=jt.morphTargets,un.morphNormals=jt.morphNormals,un.morphColors=jt.morphColors,un.morphTargetsCount=jt.morphTargetsCount,un.numClippingPlanes=jt.numClippingPlanes,un.numIntersection=jt.numClipIntersection,un.vertexAlphas=jt.vertexAlphas,un.vertexTangents=jt.vertexTangents,un.toneMapping=jt.toneMapping}function qp(qe,jt,un,Ht,In){jt.isScene!==!0&&(jt=Rn),Tn.resetTextureUnits();const or=jt.fog,_r=Ht.isMeshStandardMaterial?jt.environment:null,Ur=Ee===null?se.outputEncoding:Ee.isXRRenderTarget===!0?Ee.texture.encoding:Qr,Vr=(Ht.isMeshStandardMaterial?$i:qn).get(Ht.envMap||_r),Nr=Ht.vertexColors===!0&&!!un.attributes.color&&un.attributes.color.itemSize===4,is=!!Ht.normalMap&&!!un.attributes.tangent,Zr=!!un.morphAttributes.position,Ia=!!un.morphAttributes.normal,Aa=!!un.morphAttributes.color,du=Ht.toneMapped?se.toneMapping:wn,Qh=un.morphAttributes.position||un.morphAttributes.normal||un.morphAttributes.color,Ga=Qh!==void 0?Qh.length:0,ls=Ln.get(Ht),Zh=j.state.lights;if(Zt===!0&&(Qn===!0||qe!==Fe)){const rl=qe===Fe&&Ht.id===Me;Ze.setState(Ht,qe,rl)}let ho=!1;Ht.version===ls.__version?(ls.needsLights&&ls.lightsStateVersion!==Zh.state.version||ls.outputEncoding!==Ur||In.isInstancedMesh&&ls.instancing===!1||!In.isInstancedMesh&&ls.instancing===!0||In.isSkinnedMesh&&ls.skinning===!1||!In.isSkinnedMesh&&ls.skinning===!0||ls.envMap!==Vr||Ht.fog===!0&&ls.fog!==or||ls.numClippingPlanes!==void 0&&(ls.numClippingPlanes!==Ze.numPlanes||ls.numIntersection!==Ze.numIntersection)||ls.vertexAlphas!==Nr||ls.vertexTangents!==is||ls.morphTargets!==Zr||ls.morphNormals!==Ia||ls.morphColors!==Aa||ls.toneMapping!==du||tr.isWebGL2===!0&&ls.morphTargetsCount!==Ga)&&(ho=!0):(ho=!0,ls.__version=Ht.version);let $h=ls.currentProgram;ho===!0&&($h=Es(Ht,jt,In));let iy=!1,tf=!1,il=!1;const Lo=$h.getUniforms(),pu=ls.uniforms;if(ni.useProgram($h.program)&&(iy=!0,tf=!0,il=!0),Ht.id!==Me&&(Me=Ht.id,tf=!0),iy||Fe!==qe){if(Lo.setValue(Jt,"projectionMatrix",qe.projectionMatrix),tr.logarithmicDepthBuffer&&Lo.setValue(Jt,"logDepthBufFC",2/(Math.log(qe.far+1)/Math.LN2)),Fe!==qe&&(Fe=qe,tf=!0,il=!0),Ht.isShaderMaterial||Ht.isMeshPhongMaterial||Ht.isMeshToonMaterial||Ht.isMeshStandardMaterial||Ht.envMap){const rl=Lo.map.cameraPosition;rl!==void 0&&rl.setValue(Jt,pn.setFromMatrixPosition(qe.matrixWorld))}(Ht.isMeshPhongMaterial||Ht.isMeshToonMaterial||Ht.isMeshLambertMaterial||Ht.isMeshBasicMaterial||Ht.isMeshStandardMaterial||Ht.isShaderMaterial)&&Lo.setValue(Jt,"isOrthographic",qe.isOrthographicCamera===!0),(Ht.isMeshPhongMaterial||Ht.isMeshToonMaterial||Ht.isMeshLambertMaterial||Ht.isMeshBasicMaterial||Ht.isMeshStandardMaterial||Ht.isShaderMaterial||Ht.isShadowMaterial||In.isSkinnedMesh)&&Lo.setValue(Jt,"viewMatrix",qe.matrixWorldInverse)}if(In.isSkinnedMesh){Lo.setOptional(Jt,In,"bindMatrix"),Lo.setOptional(Jt,In,"bindMatrixInverse");const rl=In.skeleton;rl&&(tr.floatVertexTextures?(rl.boneTexture===null&&rl.computeBoneTexture(),Lo.setValue(Jt,"boneTexture",rl.boneTexture,Tn),Lo.setValue(Jt,"boneTextureSize",rl.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const $m=un.morphAttributes;if(($m.position!==void 0||$m.normal!==void 0||$m.color!==void 0&&tr.isWebGL2===!0)&&oi.update(In,un,Ht,$h),(tf||ls.receiveShadow!==In.receiveShadow)&&(ls.receiveShadow=In.receiveShadow,Lo.setValue(Jt,"receiveShadow",In.receiveShadow)),Ht.isMeshGouraudMaterial&&Ht.envMap!==null&&(pu.envMap.value=Vr,pu.flipEnvMap.value=Vr.isCubeTexture&&Vr.isRenderTargetTexture===!1?-1:1),tf&&(Lo.setValue(Jt,"toneMappingExposure",se.toneMappingExposure),ls.needsLights&&ef(pu,il),or&&Ht.fog===!0&&Os.refreshFogUniforms(pu,or),Os.refreshMaterialUniforms(pu,Ht,Dt,mt,Kn),Jf.upload(Jt,ls.uniformsList,pu,Tn)),Ht.isShaderMaterial&&Ht.uniformsNeedUpdate===!0&&(Jf.upload(Jt,ls.uniformsList,pu,Tn),Ht.uniformsNeedUpdate=!1),Ht.isSpriteMaterial&&Lo.setValue(Jt,"center",In.center),Lo.setValue(Jt,"modelViewMatrix",In.modelViewMatrix),Lo.setValue(Jt,"normalMatrix",In.normalMatrix),Lo.setValue(Jt,"modelMatrix",In.matrixWorld),Ht.isShaderMaterial||Ht.isRawShaderMaterial){const rl=Ht.uniformsGroups;for(let jm=0,ry=rl.length;jm<ry;jm++)if(tr.isWebGL2){const pA=rl[jm];ji.update(pA,$h),ji.bind(pA,$h)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $h}function ef(qe,jt){qe.ambientLightColor.needsUpdate=jt,qe.lightProbe.needsUpdate=jt,qe.directionalLights.needsUpdate=jt,qe.directionalLightShadows.needsUpdate=jt,qe.pointLights.needsUpdate=jt,qe.pointLightShadows.needsUpdate=jt,qe.spotLights.needsUpdate=jt,qe.spotLightShadows.needsUpdate=jt,qe.rectAreaLights.needsUpdate=jt,qe.hemisphereLights.needsUpdate=jt}function ow(qe){return qe.isMeshLambertMaterial||qe.isMeshToonMaterial||qe.isMeshPhongMaterial||qe.isMeshStandardMaterial||qe.isShadowMaterial||qe.isShaderMaterial&&qe.lights===!0}this.setTexture2D=function(){var qe=!1;return function(un,Ht){un&&un.isWebGLRenderTarget&&(qe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),qe=!0),un=un.texture),Tn.setTexture2D(un,Ht)}}(),this.getActiveCubeFace=function(){return ye},this.getActiveMipmapLevel=function(){return Be},this.getRenderTarget=function(){return Ee},this.setRenderTargetTextures=function(qe,jt,un){Ln.get(qe.texture).__webglTexture=jt,Ln.get(qe.depthTexture).__webglTexture=un;const Ht=Ln.get(qe);Ht.__hasExternalTextures=!0,Ht.__hasExternalTextures&&(Ht.__autoAllocateDepthBuffer=un===void 0,Ht.__autoAllocateDepthBuffer||ii.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ht.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(qe,jt){const un=Ln.get(qe);un.__webglFramebuffer=jt,un.__useDefaultFramebuffer=jt===void 0},this.setRenderTarget=function(qe,jt=0,un=0){Ee=qe,ye=jt,Be=un;let Ht=!0,In=null,or=!1,_r=!1;if(qe){const Vr=Ln.get(qe);Vr.__useDefaultFramebuffer!==void 0?(ni.bindFramebuffer(36160,null),Ht=!1):Vr.__webglFramebuffer===void 0?Tn.setupRenderTarget(qe):Vr.__hasExternalTextures&&Tn.rebindTextures(qe,Ln.get(qe.texture).__webglTexture,Ln.get(qe.depthTexture).__webglTexture);const Nr=qe.texture;(Nr.isData3DTexture||Nr.isDataArrayTexture||Nr.isCompressedArrayTexture)&&(_r=!0);const is=Ln.get(qe).__webglFramebuffer;qe.isWebGLCubeRenderTarget?(In=is[jt],or=!0):tr.isWebGL2&&qe.samples>0&&Tn.useMultisampledRTT(qe)===!1?In=Ln.get(qe).__webglMultisampledFramebuffer:In=is,it.copy(qe.viewport),yt.copy(qe.scissor),Le=qe.scissorTest}else it.copy(_t).multiplyScalar(Dt).floor(),yt.copy(Qt).multiplyScalar(Dt).floor(),Le=bn;if(ni.bindFramebuffer(36160,In)&&tr.drawBuffers&&Ht&&ni.drawBuffers(qe,In),ni.viewport(it),ni.scissor(yt),ni.setScissorTest(Le),or){const Vr=Ln.get(qe.texture);Jt.framebufferTexture2D(36160,36064,34069+jt,Vr.__webglTexture,un)}else if(_r){const Vr=Ln.get(qe.texture),Nr=jt||0;Jt.framebufferTextureLayer(36160,36064,Vr.__webglTexture,un||0,Nr)}Me=-1},this.readRenderTargetPixels=function(qe,jt,un,Ht,In,or,_r){if(!(qe&&qe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ur=Ln.get(qe).__webglFramebuffer;if(qe.isWebGLCubeRenderTarget&&_r!==void 0&&(Ur=Ur[_r]),Ur){ni.bindFramebuffer(36160,Ur);try{const Vr=qe.texture,Nr=Vr.format,is=Vr.type;if(Nr!==cr&&_i.convert(Nr)!==Jt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zr=is===hn&&(ii.has("EXT_color_buffer_half_float")||tr.isWebGL2&&ii.has("EXT_color_buffer_float"));if(is!==Ai&&_i.convert(is)!==Jt.getParameter(35738)&&!(is===ti&&(tr.isWebGL2||ii.has("OES_texture_float")||ii.has("WEBGL_color_buffer_float")))&&!Zr){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}jt>=0&&jt<=qe.width-Ht&&un>=0&&un<=qe.height-In&&Jt.readPixels(jt,un,Ht,In,_i.convert(Nr),_i.convert(is),or)}finally{const Vr=Ee!==null?Ln.get(Ee).__webglFramebuffer:null;ni.bindFramebuffer(36160,Vr)}}},this.copyFramebufferToTexture=function(qe,jt,un=0){const Ht=Math.pow(2,-un),In=Math.floor(jt.image.width*Ht),or=Math.floor(jt.image.height*Ht);Tn.setTexture2D(jt,0),Jt.copyTexSubImage2D(3553,un,0,0,qe.x,qe.y,In,or),ni.unbindTexture()},this.copyTextureToTexture=function(qe,jt,un,Ht=0){const In=jt.image.width,or=jt.image.height,_r=_i.convert(un.format),Ur=_i.convert(un.type);Tn.setTexture2D(un,0),Jt.pixelStorei(37440,un.flipY),Jt.pixelStorei(37441,un.premultiplyAlpha),Jt.pixelStorei(3317,un.unpackAlignment),jt.isDataTexture?Jt.texSubImage2D(3553,Ht,qe.x,qe.y,In,or,_r,Ur,jt.image.data):jt.isCompressedTexture?Jt.compressedTexSubImage2D(3553,Ht,qe.x,qe.y,jt.mipmaps[0].width,jt.mipmaps[0].height,_r,jt.mipmaps[0].data):Jt.texSubImage2D(3553,Ht,qe.x,qe.y,_r,Ur,jt.image),Ht===0&&un.generateMipmaps&&Jt.generateMipmap(3553),ni.unbindTexture()},this.copyTextureToTexture3D=function(qe,jt,un,Ht,In=0){if(se.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const or=qe.max.x-qe.min.x+1,_r=qe.max.y-qe.min.y+1,Ur=qe.max.z-qe.min.z+1,Vr=_i.convert(Ht.format),Nr=_i.convert(Ht.type);let is;if(Ht.isData3DTexture)Tn.setTexture3D(Ht,0),is=32879;else if(Ht.isDataArrayTexture)Tn.setTexture2DArray(Ht,0),is=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Jt.pixelStorei(37440,Ht.flipY),Jt.pixelStorei(37441,Ht.premultiplyAlpha),Jt.pixelStorei(3317,Ht.unpackAlignment);const Zr=Jt.getParameter(3314),Ia=Jt.getParameter(32878),Aa=Jt.getParameter(3316),du=Jt.getParameter(3315),Qh=Jt.getParameter(32877),Ga=un.isCompressedTexture?un.mipmaps[0]:un.image;Jt.pixelStorei(3314,Ga.width),Jt.pixelStorei(32878,Ga.height),Jt.pixelStorei(3316,qe.min.x),Jt.pixelStorei(3315,qe.min.y),Jt.pixelStorei(32877,qe.min.z),un.isDataTexture||un.isData3DTexture?Jt.texSubImage3D(is,In,jt.x,jt.y,jt.z,or,_r,Ur,Vr,Nr,Ga.data):un.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Jt.compressedTexSubImage3D(is,In,jt.x,jt.y,jt.z,or,_r,Ur,Vr,Ga.data)):Jt.texSubImage3D(is,In,jt.x,jt.y,jt.z,or,_r,Ur,Vr,Nr,Ga),Jt.pixelStorei(3314,Zr),Jt.pixelStorei(32878,Ia),Jt.pixelStorei(3316,Aa),Jt.pixelStorei(3315,du),Jt.pixelStorei(32877,Qh),In===0&&Ht.generateMipmaps&&Jt.generateMipmap(is),ni.unbindTexture()},this.initTexture=function(qe){qe.isCubeTexture?Tn.setTextureCube(qe,0):qe.isData3DTexture?Tn.setTexture3D(qe,0):qe.isDataArrayTexture||qe.isCompressedArrayTexture?Tn.setTexture2DArray(qe,0):Tn.setTexture2D(qe,0),ni.unbindTexture()},this.resetState=function(){ye=0,Be=0,Ee=null,ni.reset(),_n.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class tm extends $1{}tm.prototype.isWebGL1Renderer=!0;class nm{constructor(n,a=25e-5){this.isFogExp2=!0,this.name="",this.color=new Si(n),this.density=a}clone(){return new nm(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class im{constructor(n,a=1,u=1e3){this.isFog=!0,this.name="",this.color=new Si(n),this.near=a,this.far=u}clone(){return new im(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class j1 extends as{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(n,a){return super.copy(n,a),n.background!==null&&(this.background=n.background.clone()),n.environment!==null&&(this.environment=n.environment.clone()),n.fog!==null&&(this.fog=n.fog.clone()),this.backgroundBlurriness=n.backgroundBlurriness,this.backgroundIntensity=n.backgroundIntensity,n.overrideMaterial!==null&&(this.overrideMaterial=n.overrideMaterial.clone()),this.matrixAutoUpdate=n.matrixAutoUpdate,this}toJSON(n){const a=super.toJSON(n);return this.fog!==null&&(a.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(a.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(a.backgroundIntensity=this.backgroundIntensity),a}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(n){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=n}}class rm{constructor(n,a){this.isInterleavedBuffer=!0,this.array=n,this.stride=a,this.count=n!==void 0?n.length/a:0,this.usage=Yl,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Za()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,a,u){n*=this.stride,u*=a.stride;for(let d=0,m=this.stride;d<m;d++)this.array[n+d]=a.array[u+d];return this}set(n,a=0){return this.array.set(n,a),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Za()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const a=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),u=new this.constructor(a,this.stride);return u.setUsage(this.usage),u}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Za()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Wo=new tt;class Jc{constructor(n,a,u,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=n,this.itemSize=a,this.offset=u,this.normalized=d===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(n){this.data.needsUpdate=n}applyMatrix4(n){for(let a=0,u=this.data.count;a<u;a++)Wo.fromBufferAttribute(this,a),Wo.applyMatrix4(n),this.setXYZ(a,Wo.x,Wo.y,Wo.z);return this}applyNormalMatrix(n){for(let a=0,u=this.count;a<u;a++)Wo.fromBufferAttribute(this,a),Wo.applyNormalMatrix(n),this.setXYZ(a,Wo.x,Wo.y,Wo.z);return this}transformDirection(n){for(let a=0,u=this.count;a<u;a++)Wo.fromBufferAttribute(this,a),Wo.transformDirection(n),this.setXYZ(a,Wo.x,Wo.y,Wo.z);return this}setX(n,a){return this.normalized&&(a=hs(a,this.array)),this.data.array[n*this.data.stride+this.offset]=a,this}setY(n,a){return this.normalized&&(a=hs(a,this.array)),this.data.array[n*this.data.stride+this.offset+1]=a,this}setZ(n,a){return this.normalized&&(a=hs(a,this.array)),this.data.array[n*this.data.stride+this.offset+2]=a,this}setW(n,a){return this.normalized&&(a=hs(a,this.array)),this.data.array[n*this.data.stride+this.offset+3]=a,this}getX(n){let a=this.data.array[n*this.data.stride+this.offset];return this.normalized&&(a=kl(a,this.array)),a}getY(n){let a=this.data.array[n*this.data.stride+this.offset+1];return this.normalized&&(a=kl(a,this.array)),a}getZ(n){let a=this.data.array[n*this.data.stride+this.offset+2];return this.normalized&&(a=kl(a,this.array)),a}getW(n){let a=this.data.array[n*this.data.stride+this.offset+3];return this.normalized&&(a=kl(a,this.array)),a}setXY(n,a,u){return n=n*this.data.stride+this.offset,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array)),this.data.array[n+0]=a,this.data.array[n+1]=u,this}setXYZ(n,a,u,d){return n=n*this.data.stride+this.offset,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array),d=hs(d,this.array)),this.data.array[n+0]=a,this.data.array[n+1]=u,this.data.array[n+2]=d,this}setXYZW(n,a,u,d,m){return n=n*this.data.stride+this.offset,this.normalized&&(a=hs(a,this.array),u=hs(u,this.array),d=hs(d,this.array),m=hs(m,this.array)),this.data.array[n+0]=a,this.data.array[n+1]=u,this.data.array[n+2]=d,this.data.array[n+3]=m,this}clone(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const a=[];for(let u=0;u<this.count;u++){const d=u*this.data.stride+this.offset;for(let m=0;m<this.itemSize;m++)a.push(this.data.array[d+m])}return new Vt(new this.array.constructor(a),this.itemSize,this.normalized)}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new Jc(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const a=[];for(let u=0;u<this.count;u++){const d=u*this.data.stride+this.offset;for(let m=0;m<this.itemSize;m++)a.push(this.data.array[d+m])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class m0 extends Ba{constructor(n){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Si(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}let qc;const Ep=new tt,Co=new tt,Dd=new tt,Ou=new kn,Ip=new kn,sm=new Ri,am=new tt,Sp=new tt,om=new tt,Y1=new kn,g0=new kn,lm=new kn;class J1 extends as{constructor(n){if(super(),this.isSprite=!0,this.type="Sprite",qc===void 0){qc=new Or;const a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),u=new rm(a,5);qc.setIndex([0,1,2,0,2,3]),qc.setAttribute("position",new Jc(u,3,0,!1)),qc.setAttribute("uv",new Jc(u,2,3,!1))}this.geometry=qc,this.material=n!==void 0?n:new m0,this.center=new kn(.5,.5)}raycast(n,a){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Co.setFromMatrixScale(this.matrixWorld),sm.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),Dd.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Co.multiplyScalar(-Dd.z);const u=this.material.rotation;let d,m;u!==0&&(m=Math.cos(u),d=Math.sin(u));const A=this.center;cm(am.set(-.5,-.5,0),Dd,A,Co,d,m),cm(Sp.set(.5,-.5,0),Dd,A,Co,d,m),cm(om.set(.5,.5,0),Dd,A,Co,d,m),Y1.set(0,0),g0.set(1,0),lm.set(1,1);let y=n.ray.intersectTriangle(am,Sp,om,!1,Ep);if(y===null&&(cm(Sp.set(-.5,.5,0),Dd,A,Co,d,m),g0.set(0,1),y=n.ray.intersectTriangle(am,om,Sp,!1,Ep),y===null))return;const k=n.ray.origin.distanceTo(Ep);k<n.near||k>n.far||a.push({distance:k,point:Ep.clone(),uv:Ss.getUV(Ep,am,Sp,om,Y1,g0,lm,new kn),face:null,object:this})}copy(n,a){return super.copy(n,a),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}}function cm(x,n,a,u,d,m){Ou.subVectors(x,a).addScalar(.5).multiply(u),d!==void 0?(Ip.x=m*Ou.x-d*Ou.y,Ip.y=d*Ou.x+m*Ou.y):Ip.copy(Ou),x.copy(n),x.x+=Ip.x,x.y+=Ip.y,x.applyMatrix4(sm)}const Nd=new tt,q1=new tt;class um extends as{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const a=n.levels;for(let u=0,d=a.length;u<d;u++){const m=a[u];this.addLevel(m.object.clone(),m.distance,m.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,a=0,u=0){a=Math.abs(a);const d=this.levels;let m;for(m=0;m<d.length&&!(a<d[m].distance);m++);return d.splice(m,0,{distance:a,hysteresis:u,object:n}),this.add(n),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const a=this.levels;if(a.length>0){let u,d;for(u=1,d=a.length;u<d;u++){let m=a[u].distance;if(a[u].object.visible&&(m-=m*a[u].hysteresis),n<m)break}return a[u-1].object}return null}raycast(n,a){if(this.levels.length>0){Nd.setFromMatrixPosition(this.matrixWorld);const d=n.ray.origin.distanceTo(Nd);this.getObjectForDistance(d).raycast(n,a)}}update(n){const a=this.levels;if(a.length>1){Nd.setFromMatrixPosition(n.matrixWorld),q1.setFromMatrixPosition(this.matrixWorld);const u=Nd.distanceTo(q1)/n.zoom;a[0].object.visible=!0;let d,m;for(d=1,m=a.length;d<m;d++){let A=a[d].distance;if(a[d].object.visible&&(A-=A*a[d].hysteresis),u>=A)a[d-1].object.visible=!1,a[d].object.visible=!0;else break}for(this._currentLevel=d-1;d<m;d++)a[d].object.visible=!1}}toJSON(n){const a=super.toJSON(n);this.autoUpdate===!1&&(a.object.autoUpdate=!1),a.object.levels=[];const u=this.levels;for(let d=0,m=u.length;d<m;d++){const A=u[d];a.object.levels.push({object:A.object.uuid,distance:A.distance,hysteresis:A.hysteresis})}return a}}const ev=new tt,hm=new es,tv=new es,A0=new tt,nv=new Ri;class dm extends lo{constructor(n,a){super(n,a),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ri,this.bindMatrixInverse=new Ri}copy(n,a){return super.copy(n,a),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,this}bind(n,a){this.skeleton=n,a===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),a=this.matrixWorld),this.bindMatrix.copy(a),this.bindMatrixInverse.copy(a).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new es,a=this.geometry.attributes.skinWeight;for(let u=0,d=a.count;u<d;u++){n.fromBufferAttribute(a,u);const m=1/n.manhattanLength();m!==1/0?n.multiplyScalar(m):n.set(1,0,0,0),a.setXYZW(u,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(n,a){const u=this.skeleton,d=this.geometry;hm.fromBufferAttribute(d.attributes.skinIndex,n),tv.fromBufferAttribute(d.attributes.skinWeight,n),ev.copy(a).applyMatrix4(this.bindMatrix),a.set(0,0,0);for(let m=0;m<4;m++){const A=tv.getComponent(m);if(A!==0){const y=hm.getComponent(m);nv.multiplyMatrices(u.bones[y].matrixWorld,u.boneInverses[y]),a.addScaledVector(A0.copy(ev).applyMatrix4(nv),A)}}return a.applyMatrix4(this.bindMatrixInverse)}}class v0 extends as{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Gu extends Ws{constructor(n=null,a=1,u=1,d,m,A,y,k,N=me,K=me,$,j){super(null,A,y,k,N,K,d,m,$,j),this.isDataTexture=!0,this.image={data:n,width:a,height:u},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const iv=new Ri,y0=new Ri;class pm{constructor(n=[],a=[]){this.uuid=Za(),this.bones=n.slice(0),this.boneInverses=a,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const n=this.bones,a=this.boneInverses;if(this.boneMatrices=new Float32Array(n.length*16),a.length===0)this.calculateInverses();else if(n.length!==a.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let u=0,d=this.bones.length;u<d;u++)this.boneInverses.push(new Ri)}}calculateInverses(){this.boneInverses.length=0;for(let n=0,a=this.bones.length;n<a;n++){const u=new Ri;this.bones[n]&&u.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(u)}}pose(){for(let n=0,a=this.bones.length;n<a;n++){const u=this.bones[n];u&&u.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,a=this.bones.length;n<a;n++){const u=this.bones[n];u&&(u.parent&&u.parent.isBone?(u.matrix.copy(u.parent.matrixWorld).invert(),u.matrix.multiply(u.matrixWorld)):u.matrix.copy(u.matrixWorld),u.matrix.decompose(u.position,u.quaternion,u.scale))}}update(){const n=this.bones,a=this.boneInverses,u=this.boneMatrices,d=this.boneTexture;for(let m=0,A=n.length;m<A;m++){const y=n[m]?n[m].matrixWorld:y0;iv.multiplyMatrices(y,a[m]),iv.toArray(u,m*16)}d!==null&&(d.needsUpdate=!0)}clone(){return new pm(this.bones,this.boneInverses)}computeBoneTexture(){let n=Math.sqrt(this.bones.length*4);n=hp(n),n=Math.max(n,4);const a=new Float32Array(n*n*4);a.set(this.boneMatrices);const u=new Gu(a,n,n,cr,ti);return u.needsUpdate=!0,this.boneMatrices=a,this.boneTexture=u,this.boneTextureSize=n,this}getBoneByName(n){for(let a=0,u=this.bones.length;a<u;a++){const d=this.bones[a];if(d.name===n)return d}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,a){this.uuid=n.uuid;for(let u=0,d=n.bones.length;u<d;u++){const m=n.bones[u];let A=a[m];A===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",m),A=new v0),this.bones.push(A),this.boneInverses.push(new Ri().fromArray(n.boneInverses[u]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;const a=this.bones,u=this.boneInverses;for(let d=0,m=a.length;d<m;d++){const A=a[d];n.bones.push(A.uuid);const y=u[d];n.boneInverses.push(y.toArray())}return n}}class Fd extends Vt{constructor(n,a,u,d=1){super(n,a,u),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}}const rv=new Ri,sv=new Ri,fm=[],R2=new Ri,Tp=new lo;class av extends lo{constructor(n,a,u){super(n,a),this.isInstancedMesh=!0,this.instanceMatrix=new Fd(new Float32Array(u*16),16),this.instanceColor=null,this.count=u,this.frustumCulled=!1;for(let d=0;d<u;d++)this.setMatrixAt(d,R2)}copy(n,a){return super.copy(n,a),this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,this}getColorAt(n,a){a.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,a){a.fromArray(this.instanceMatrix.array,n*16)}raycast(n,a){const u=this.matrixWorld,d=this.count;if(Tp.geometry=this.geometry,Tp.material=this.material,Tp.material!==void 0)for(let m=0;m<d;m++){this.getMatrixAt(m,rv),sv.multiplyMatrices(u,rv),Tp.matrixWorld=sv,Tp.raycast(n,fm);for(let A=0,y=fm.length;A<y;A++){const k=fm[A];k.instanceId=m,k.object=this,a.push(k)}fm.length=0}}setColorAt(n,a){this.instanceColor===null&&(this.instanceColor=new Fd(new Float32Array(this.instanceMatrix.count*3),3)),a.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,a){a.toArray(this.instanceMatrix.array,n*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Fa extends Ba{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Si(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}}const mm=new tt,b0=new tt,ov=new Ri,x0=new _a,gm=new To;class Uu extends as{constructor(n=new Or,a=new Fa){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=a,this.updateMorphTargets()}copy(n,a){return super.copy(n,a),this.material=n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const a=n.attributes.position,u=[0];for(let d=1,m=a.count;d<m;d++)mm.fromBufferAttribute(a,d-1),b0.fromBufferAttribute(a,d),u[d]=u[d-1],u[d]+=mm.distanceTo(b0);n.setAttribute("lineDistance",new Fi(u,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,a){const u=this.geometry,d=this.matrixWorld,m=n.params.Line.threshold,A=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),gm.copy(u.boundingSphere),gm.applyMatrix4(d),gm.radius+=m,n.ray.intersectsSphere(gm)===!1)return;ov.copy(d).invert(),x0.copy(n.ray).applyMatrix4(ov);const y=m/((this.scale.x+this.scale.y+this.scale.z)/3),k=y*y,N=new tt,K=new tt,$=new tt,j=new tt,ne=this.isLineSegments?2:1,le=u.index,re=u.attributes.position;if(le!==null){const ye=Math.max(0,A.start),Be=Math.min(le.count,A.start+A.count);for(let Ee=ye,Me=Be-1;Ee<Me;Ee+=ne){const Fe=le.getX(Ee),it=le.getX(Ee+1);if(N.fromBufferAttribute(re,Fe),K.fromBufferAttribute(re,it),x0.distanceSqToSegment(N,K,j,$)>k)continue;j.applyMatrix4(this.matrixWorld);const Le=n.ray.origin.distanceTo(j);Le<n.near||Le>n.far||a.push({distance:Le,point:$.clone().applyMatrix4(this.matrixWorld),index:Ee,face:null,faceIndex:null,object:this})}}else{const ye=Math.max(0,A.start),Be=Math.min(re.count,A.start+A.count);for(let Ee=ye,Me=Be-1;Ee<Me;Ee+=ne){if(N.fromBufferAttribute(re,Ee),K.fromBufferAttribute(re,Ee+1),x0.distanceSqToSegment(N,K,j,$)>k)continue;j.applyMatrix4(this.matrixWorld);const it=n.ray.origin.distanceTo(j);it<n.near||it>n.far||a.push({distance:it,point:$.clone().applyMatrix4(this.matrixWorld),index:Ee,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const a=this.geometry.morphAttributes,u=Object.keys(a);if(u.length>0){const d=a[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,A=d.length;m<A;m++){const y=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[y]=m}}}}}const Mp=new tt,_p=new tt;class Ic extends Uu{constructor(n,a){super(n,a),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const a=n.attributes.position,u=[];for(let d=0,m=a.count;d<m;d+=2)Mp.fromBufferAttribute(a,d),_p.fromBufferAttribute(a,d+1),u[d]=d===0?0:u[d-1],u[d+1]=u[d]+Mp.distanceTo(_p);n.setAttribute("lineDistance",new Fi(u,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class lv extends Uu{constructor(n,a){super(n,a),this.isLineLoop=!0,this.type="LineLoop"}}class C0 extends Ba{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Si(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}const Vu=new Ri,w0=new _a,Rp=new To,Am=new tt;class zu extends as{constructor(n=new Or,a=new C0){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=a,this.updateMorphTargets()}copy(n,a){return super.copy(n,a),this.material=n.material,this.geometry=n.geometry,this}raycast(n,a){const u=this.geometry,d=this.matrixWorld,m=n.params.Points.threshold,A=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),Rp.copy(u.boundingSphere),Rp.applyMatrix4(d),Rp.radius+=m,n.ray.intersectsSphere(Rp)===!1)return;Vu.copy(d).invert(),w0.copy(n.ray).applyMatrix4(Vu);const y=m/((this.scale.x+this.scale.y+this.scale.z)/3),k=y*y,N=u.index,$=u.attributes.position;if(N!==null){const j=Math.max(0,A.start),ne=Math.min(N.count,A.start+A.count);for(let le=j,se=ne;le<se;le++){const re=N.getX(le);Am.fromBufferAttribute($,re),cv(Am,re,k,d,n,a,this)}}else{const j=Math.max(0,A.start),ne=Math.min($.count,A.start+A.count);for(let le=j,se=ne;le<se;le++)Am.fromBufferAttribute($,le),cv(Am,le,k,d,n,a,this)}}updateMorphTargets(){const a=this.geometry.morphAttributes,u=Object.keys(a);if(u.length>0){const d=a[u[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,A=d.length;m<A;m++){const y=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[y]=m}}}}}function cv(x,n,a,u,d,m,A){const y=w0.distanceSqToPoint(x);if(y<a){const k=new tt;w0.closestPointToPoint(x,k),k.applyMatrix4(u);const N=d.ray.origin.distanceTo(k);if(N<d.near||N>d.far)return;m.push({distance:N,distanceToRay:Math.sqrt(y),point:k,index:n,face:null,object:A})}}class uv extends Ws{constructor(n,a,u,d,m,A,y,k,N){super(n,a,u,d,m,A,y,k,N),this.isVideoTexture=!0,this.minFilter=A!==void 0?A:ft,this.magFilter=m!==void 0?m:ft,this.generateMipmaps=!1;const K=this;function $(){K.needsUpdate=!0,n.requestVideoFrameCallback($)}"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback($)}clone(){return new this.constructor(this.image).copy(this)}update(){const n=this.image;"requestVideoFrameCallback"in n===!1&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class B2 extends Ws{constructor(n,a,u){super({width:n,height:a}),this.isFramebufferTexture=!0,this.format=u,this.magFilter=me,this.minFilter=me,this.generateMipmaps=!1,this.needsUpdate=!0}}class vm extends Ws{constructor(n,a,u,d,m,A,y,k,N,K,$,j){super(null,A,y,k,N,K,d,m,$,j),this.isCompressedTexture=!0,this.image={width:a,height:u},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}}class k2 extends vm{constructor(n,a,u,d,m,A){super(n,a,u,m,A),this.isCompressedArrayTexture=!0,this.image.depth=d,this.wrapR=Ct}}class hv extends Ws{constructor(n,a,u,d,m,A,y,k,N){super(n,a,u,d,m,A,y,k,N),this.isCanvasTexture=!0,this.needsUpdate=!0}}class oc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(n,a){const u=this.getUtoTmapping(n);return this.getPoint(u,a)}getPoints(n=5){const a=[];for(let u=0;u<=n;u++)a.push(this.getPoint(u/n));return a}getSpacedPoints(n=5){const a=[];for(let u=0;u<=n;u++)a.push(this.getPointAt(u/n));return a}getLength(){const n=this.getLengths();return n[n.length-1]}getLengths(n=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const a=[];let u,d=this.getPoint(0),m=0;a.push(0);for(let A=1;A<=n;A++)u=this.getPoint(A/n),m+=u.distanceTo(d),a.push(m),d=u;return this.cacheArcLengths=a,a}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(n,a){const u=this.getLengths();let d=0;const m=u.length;let A;a?A=a:A=n*u[m-1];let y=0,k=m-1,N;for(;y<=k;)if(d=Math.floor(y+(k-y)/2),N=u[d]-A,N<0)y=d+1;else if(N>0)k=d-1;else{k=d;break}if(d=k,u[d]===A)return d/(m-1);const K=u[d],j=u[d+1]-K,ne=(A-K)/j;return(d+ne)/(m-1)}getTangent(n,a){let d=n-1e-4,m=n+1e-4;d<0&&(d=0),m>1&&(m=1);const A=this.getPoint(d),y=this.getPoint(m),k=a||(A.isVector2?new kn:new tt);return k.copy(y).sub(A).normalize(),k}getTangentAt(n,a){const u=this.getUtoTmapping(n);return this.getTangent(u,a)}computeFrenetFrames(n,a){const u=new tt,d=[],m=[],A=[],y=new tt,k=new Ri;for(let ne=0;ne<=n;ne++){const le=ne/n;d[ne]=this.getTangentAt(le,new tt)}m[0]=new tt,A[0]=new tt;let N=Number.MAX_VALUE;const K=Math.abs(d[0].x),$=Math.abs(d[0].y),j=Math.abs(d[0].z);K<=N&&(N=K,u.set(1,0,0)),$<=N&&(N=$,u.set(0,1,0)),j<=N&&u.set(0,0,1),y.crossVectors(d[0],u).normalize(),m[0].crossVectors(d[0],y),A[0].crossVectors(d[0],m[0]);for(let ne=1;ne<=n;ne++){if(m[ne]=m[ne-1].clone(),A[ne]=A[ne-1].clone(),y.crossVectors(d[ne-1],d[ne]),y.length()>Number.EPSILON){y.normalize();const le=Math.acos(aa(d[ne-1].dot(d[ne]),-1,1));m[ne].applyMatrix4(k.makeRotationAxis(y,le))}A[ne].crossVectors(d[ne],m[ne])}if(a===!0){let ne=Math.acos(aa(m[0].dot(m[n]),-1,1));ne/=n,d[0].dot(y.crossVectors(m[0],m[n]))>0&&(ne=-ne);for(let le=1;le<=n;le++)m[le].applyMatrix4(k.makeRotationAxis(d[le],ne*le)),A[le].crossVectors(d[le],m[le])}return{tangents:d,normals:m,binormals:A}}clone(){return new this.constructor().copy(this)}copy(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}toJSON(){const n={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n}fromJSON(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}}class Bp extends oc{constructor(n=0,a=0,u=1,d=1,m=0,A=Math.PI*2,y=!1,k=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=n,this.aY=a,this.xRadius=u,this.yRadius=d,this.aStartAngle=m,this.aEndAngle=A,this.aClockwise=y,this.aRotation=k}getPoint(n,a){const u=a||new kn,d=Math.PI*2;let m=this.aEndAngle-this.aStartAngle;const A=Math.abs(m)<Number.EPSILON;for(;m<0;)m+=d;for(;m>d;)m-=d;m<Number.EPSILON&&(A?m=0:m=d),this.aClockwise===!0&&!A&&(m===d?m=-d:m=m-d);const y=this.aStartAngle+n*m;let k=this.aX+this.xRadius*Math.cos(y),N=this.aY+this.yRadius*Math.sin(y);if(this.aRotation!==0){const K=Math.cos(this.aRotation),$=Math.sin(this.aRotation),j=k-this.aX,ne=N-this.aY;k=j*K-ne*$+this.aX,N=j*$+ne*K+this.aY}return u.set(k,N)}copy(n){return super.copy(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}toJSON(){const n=super.toJSON();return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n}fromJSON(n){return super.fromJSON(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}}class dv extends Bp{constructor(n,a,u,d,m,A){super(n,a,u,u,d,m,A),this.isArcCurve=!0,this.type="ArcCurve"}}function E0(){let x=0,n=0,a=0,u=0;function d(m,A,y,k){x=m,n=y,a=-3*m+3*A-2*y-k,u=2*m-2*A+y+k}return{initCatmullRom:function(m,A,y,k,N){d(A,y,N*(y-m),N*(k-A))},initNonuniformCatmullRom:function(m,A,y,k,N,K,$){let j=(A-m)/N-(y-m)/(N+K)+(y-A)/K,ne=(y-A)/K-(k-A)/(K+$)+(k-y)/$;j*=K,ne*=K,d(A,y,j,ne)},calc:function(m){const A=m*m,y=A*m;return x+n*m+a*A+u*y}}}const ym=new tt,bm=new E0,I0=new E0,xm=new E0;class pv extends oc{constructor(n=[],a=!1,u="centripetal",d=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=n,this.closed=a,this.curveType=u,this.tension=d}getPoint(n,a=new tt){const u=a,d=this.points,m=d.length,A=(m-(this.closed?0:1))*n;let y=Math.floor(A),k=A-y;this.closed?y+=y>0?0:(Math.floor(Math.abs(y)/m)+1)*m:k===0&&y===m-1&&(y=m-2,k=1);let N,K;this.closed||y>0?N=d[(y-1)%m]:(ym.subVectors(d[0],d[1]).add(d[0]),N=ym);const $=d[y%m],j=d[(y+1)%m];if(this.closed||y+2<m?K=d[(y+2)%m]:(ym.subVectors(d[m-1],d[m-2]).add(d[m-1]),K=ym),this.curveType==="centripetal"||this.curveType==="chordal"){const ne=this.curveType==="chordal"?.5:.25;let le=Math.pow(N.distanceToSquared($),ne),se=Math.pow($.distanceToSquared(j),ne),re=Math.pow(j.distanceToSquared(K),ne);se<1e-4&&(se=1),le<1e-4&&(le=se),re<1e-4&&(re=se),bm.initNonuniformCatmullRom(N.x,$.x,j.x,K.x,le,se,re),I0.initNonuniformCatmullRom(N.y,$.y,j.y,K.y,le,se,re),xm.initNonuniformCatmullRom(N.z,$.z,j.z,K.z,le,se,re)}else this.curveType==="catmullrom"&&(bm.initCatmullRom(N.x,$.x,j.x,K.x,this.tension),I0.initCatmullRom(N.y,$.y,j.y,K.y,this.tension),xm.initCatmullRom(N.z,$.z,j.z,K.z,this.tension));return u.set(bm.calc(k),I0.calc(k),xm.calc(k)),u}copy(n){super.copy(n),this.points=[];for(let a=0,u=n.points.length;a<u;a++){const d=n.points[a];this.points.push(d.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let a=0,u=this.points.length;a<u;a++){const d=this.points[a];n.points.push(d.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let a=0,u=n.points.length;a<u;a++){const d=n.points[a];this.points.push(new tt().fromArray(d))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function Cm(x,n,a,u,d){const m=(u-n)*.5,A=(d-a)*.5,y=x*x,k=x*y;return(2*a-2*u+m+A)*k+(-3*a+3*u-2*m-A)*y+m*x+a}function L2(x,n){const a=1-x;return a*a*n}function fv(x,n){return 2*(1-x)*x*n}function D2(x,n){return x*x*n}function Fh(x,n,a,u){return L2(x,n)+fv(x,a)+D2(x,u)}function N2(x,n){const a=1-x;return a*a*a*n}function wm(x,n){const a=1-x;return 3*a*a*x*n}function F2(x,n){return 3*(1-x)*x*x*n}function S0(x,n){return x*x*x*n}function kp(x,n,a,u,d){return N2(x,n)+wm(x,a)+F2(x,u)+S0(x,d)}class Em extends oc{constructor(n=new kn,a=new kn,u=new kn,d=new kn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=n,this.v1=a,this.v2=u,this.v3=d}getPoint(n,a=new kn){const u=a,d=this.v0,m=this.v1,A=this.v2,y=this.v3;return u.set(kp(n,d.x,m.x,A.x,y.x),kp(n,d.y,m.y,A.y,y.y)),u}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class mv extends oc{constructor(n=new tt,a=new tt,u=new tt,d=new tt){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=n,this.v1=a,this.v2=u,this.v3=d}getPoint(n,a=new tt){const u=a,d=this.v0,m=this.v1,A=this.v2,y=this.v3;return u.set(kp(n,d.x,m.x,A.x,y.x),kp(n,d.y,m.y,A.y,y.y),kp(n,d.z,m.z,A.z,y.z)),u}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class Pd extends oc{constructor(n=new kn,a=new kn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=n,this.v2=a}getPoint(n,a=new kn){const u=a;return n===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(n).add(this.v1)),u}getPointAt(n,a){return this.getPoint(n,a)}getTangent(n,a){const u=a||new kn;return u.copy(this.v2).sub(this.v1).normalize(),u}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class gv extends oc{constructor(n=new tt,a=new tt){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=n,this.v2=a}getPoint(n,a=new tt){const u=a;return n===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(n).add(this.v1)),u}getPointAt(n,a){return this.getPoint(n,a)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class T0 extends oc{constructor(n=new kn,a=new kn,u=new kn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=n,this.v1=a,this.v2=u}getPoint(n,a=new kn){const u=a,d=this.v0,m=this.v1,A=this.v2;return u.set(Fh(n,d.x,m.x,A.x),Fh(n,d.y,m.y,A.y)),u}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class M0 extends oc{constructor(n=new tt,a=new tt,u=new tt){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=n,this.v1=a,this.v2=u}getPoint(n,a=new tt){const u=a,d=this.v0,m=this.v1,A=this.v2;return u.set(Fh(n,d.x,m.x,A.x),Fh(n,d.y,m.y,A.y),Fh(n,d.z,m.z,A.z)),u}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class Ho extends oc{constructor(n=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=n}getPoint(n,a=new kn){const u=a,d=this.points,m=(d.length-1)*n,A=Math.floor(m),y=m-A,k=d[A===0?A:A-1],N=d[A],K=d[A>d.length-2?d.length-1:A+1],$=d[A>d.length-3?d.length-1:A+2];return u.set(Cm(y,k.x,N.x,K.x,$.x),Cm(y,k.y,N.y,K.y,$.y)),u}copy(n){super.copy(n),this.points=[];for(let a=0,u=n.points.length;a<u;a++){const d=n.points[a];this.points.push(d.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let a=0,u=this.points.length;a<u;a++){const d=this.points[a];n.points.push(d.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let a=0,u=n.points.length;a<u;a++){const d=n.points[a];this.points.push(new kn().fromArray(d))}return this}}var _0=Object.freeze({__proto__:null,ArcCurve:dv,CatmullRomCurve3:pv,CubicBezierCurve:Em,CubicBezierCurve3:mv,EllipseCurve:Bp,LineCurve:Pd,LineCurve3:gv,QuadraticBezierCurve:T0,QuadraticBezierCurve3:M0,SplineCurve:Ho});class Av extends oc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(n){this.curves.push(n)}closePath(){const n=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);n.equals(a)||this.curves.push(new Pd(a,n))}getPoint(n,a){const u=n*this.getLength(),d=this.getCurveLengths();let m=0;for(;m<d.length;){if(d[m]>=u){const A=d[m]-u,y=this.curves[m],k=y.getLength(),N=k===0?0:1-A/k;return y.getPointAt(N,a)}m++}return null}getLength(){const n=this.getCurveLengths();return n[n.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let a=0;for(let u=0,d=this.curves.length;u<d;u++)a+=this.curves[u].getLength(),n.push(a);return this.cacheLengths=n,n}getSpacedPoints(n=40){const a=[];for(let u=0;u<=n;u++)a.push(this.getPoint(u/n));return this.autoClose&&a.push(a[0]),a}getPoints(n=12){const a=[];let u;for(let d=0,m=this.curves;d<m.length;d++){const A=m[d],y=A.isEllipseCurve?n*2:A.isLineCurve||A.isLineCurve3?1:A.isSplineCurve?n*A.points.length:n,k=A.getPoints(y);for(let N=0;N<k.length;N++){const K=k[N];u&&u.equals(K)||(a.push(K),u=K)}}return this.autoClose&&a.length>1&&!a[a.length-1].equals(a[0])&&a.push(a[0]),a}copy(n){super.copy(n),this.curves=[];for(let a=0,u=n.curves.length;a<u;a++){const d=n.curves[a];this.curves.push(d.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let a=0,u=this.curves.length;a<u;a++){const d=this.curves[a];n.curves.push(d.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let a=0,u=n.curves.length;a<u;a++){const d=n.curves[a];this.curves.push(new _0[d.type]().fromJSON(d))}return this}}class Lp extends Av{constructor(n){super(),this.type="Path",this.currentPoint=new kn,n&&this.setFromPoints(n)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let a=1,u=n.length;a<u;a++)this.lineTo(n[a].x,n[a].y);return this}moveTo(n,a){return this.currentPoint.set(n,a),this}lineTo(n,a){const u=new Pd(this.currentPoint.clone(),new kn(n,a));return this.curves.push(u),this.currentPoint.set(n,a),this}quadraticCurveTo(n,a,u,d){const m=new T0(this.currentPoint.clone(),new kn(n,a),new kn(u,d));return this.curves.push(m),this.currentPoint.set(u,d),this}bezierCurveTo(n,a,u,d,m,A){const y=new Em(this.currentPoint.clone(),new kn(n,a),new kn(u,d),new kn(m,A));return this.curves.push(y),this.currentPoint.set(m,A),this}splineThru(n){const a=[this.currentPoint.clone()].concat(n),u=new Ho(a);return this.curves.push(u),this.currentPoint.copy(n[n.length-1]),this}arc(n,a,u,d,m,A){const y=this.currentPoint.x,k=this.currentPoint.y;return this.absarc(n+y,a+k,u,d,m,A),this}absarc(n,a,u,d,m,A){return this.absellipse(n,a,u,u,d,m,A),this}ellipse(n,a,u,d,m,A,y,k){const N=this.currentPoint.x,K=this.currentPoint.y;return this.absellipse(n+N,a+K,u,d,m,A,y,k),this}absellipse(n,a,u,d,m,A,y,k){const N=new Bp(n,a,u,d,m,A,y,k);if(this.curves.length>0){const $=N.getPoint(0);$.equals(this.currentPoint)||this.lineTo($.x,$.y)}this.curves.push(N);const K=N.getPoint(1);return this.currentPoint.copy(K),this}copy(n){return super.copy(n),this.currentPoint.copy(n.currentPoint),this}toJSON(){const n=super.toJSON();return n.currentPoint=this.currentPoint.toArray(),n}fromJSON(n){return super.fromJSON(n),this.currentPoint.fromArray(n.currentPoint),this}}class Od extends Or{constructor(n=[new kn(0,-.5),new kn(.5,0),new kn(0,.5)],a=12,u=0,d=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:n,segments:a,phiStart:u,phiLength:d},a=Math.floor(a),d=aa(d,0,Math.PI*2);const m=[],A=[],y=[],k=[],N=[],K=1/a,$=new tt,j=new kn,ne=new tt,le=new tt,se=new tt;let re=0,ye=0;for(let Be=0;Be<=n.length-1;Be++)switch(Be){case 0:re=n[Be+1].x-n[Be].x,ye=n[Be+1].y-n[Be].y,ne.x=ye*1,ne.y=-re,ne.z=ye*0,se.copy(ne),ne.normalize(),k.push(ne.x,ne.y,ne.z);break;case n.length-1:k.push(se.x,se.y,se.z);break;default:re=n[Be+1].x-n[Be].x,ye=n[Be+1].y-n[Be].y,ne.x=ye*1,ne.y=-re,ne.z=ye*0,le.copy(ne),ne.x+=se.x,ne.y+=se.y,ne.z+=se.z,ne.normalize(),k.push(ne.x,ne.y,ne.z),se.copy(le)}for(let Be=0;Be<=a;Be++){const Ee=u+Be*K*d,Me=Math.sin(Ee),Fe=Math.cos(Ee);for(let it=0;it<=n.length-1;it++){$.x=n[it].x*Me,$.y=n[it].y,$.z=n[it].x*Fe,A.push($.x,$.y,$.z),j.x=Be/a,j.y=it/(n.length-1),y.push(j.x,j.y);const yt=k[3*it+0]*Me,Le=k[3*it+1],at=k[3*it+0]*Fe;N.push(yt,Le,at)}}for(let Be=0;Be<a;Be++)for(let Ee=0;Ee<n.length-1;Ee++){const Me=Ee+Be*n.length,Fe=Me,it=Me+n.length,yt=Me+n.length+1,Le=Me+1;m.push(Fe,it,Le),m.push(yt,Le,it)}this.setIndex(m),this.setAttribute("position",new Fi(A,3)),this.setAttribute("uv",new Fi(y,2)),this.setAttribute("normal",new Fi(N,3))}static fromJSON(n){return new Od(n.points,n.segments,n.phiStart,n.phiLength)}}class Dp extends Od{constructor(n=1,a=1,u=4,d=8){const m=new Lp;m.absarc(0,-a/2,n,Math.PI*1.5,0),m.absarc(0,a/2,n,0,Math.PI*.5),super(m.getPoints(u),d),this.type="CapsuleGeometry",this.parameters={radius:n,height:a,capSegments:u,radialSegments:d}}static fromJSON(n){return new Dp(n.radius,n.length,n.capSegments,n.radialSegments)}}class eu extends Or{constructor(n=1,a=8,u=0,d=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:a,thetaStart:u,thetaLength:d},a=Math.max(3,a);const m=[],A=[],y=[],k=[],N=new tt,K=new kn;A.push(0,0,0),y.push(0,0,1),k.push(.5,.5);for(let $=0,j=3;$<=a;$++,j+=3){const ne=u+$/a*d;N.x=n*Math.cos(ne),N.y=n*Math.sin(ne),A.push(N.x,N.y,N.z),y.push(0,0,1),K.x=(A[j]/n+1)/2,K.y=(A[j+1]/n+1)/2,k.push(K.x,K.y)}for(let $=1;$<=a;$++)m.push($,$+1,0);this.setIndex(m),this.setAttribute("position",new Fi(A,3)),this.setAttribute("normal",new Fi(y,3)),this.setAttribute("uv",new Fi(k,2))}static fromJSON(n){return new eu(n.radius,n.segments,n.thetaStart,n.thetaLength)}}class Ph extends Or{constructor(n=1,a=1,u=1,d=8,m=1,A=!1,y=0,k=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:n,radiusBottom:a,height:u,radialSegments:d,heightSegments:m,openEnded:A,thetaStart:y,thetaLength:k};const N=this;d=Math.floor(d),m=Math.floor(m);const K=[],$=[],j=[],ne=[];let le=0;const se=[],re=u/2;let ye=0;Be(),A===!1&&(n>0&&Ee(!0),a>0&&Ee(!1)),this.setIndex(K),this.setAttribute("position",new Fi($,3)),this.setAttribute("normal",new Fi(j,3)),this.setAttribute("uv",new Fi(ne,2));function Be(){const Me=new tt,Fe=new tt;let it=0;const yt=(a-n)/u;for(let Le=0;Le<=m;Le++){const at=[],mt=Le/m,Dt=mt*(a-n)+n;for(let on=0;on<=d;on++){const Ut=on/d,_t=Ut*k+y,Qt=Math.sin(_t),bn=Math.cos(_t);Fe.x=Dt*Qt,Fe.y=-mt*u+re,Fe.z=Dt*bn,$.push(Fe.x,Fe.y,Fe.z),Me.set(Qt,yt,bn).normalize(),j.push(Me.x,Me.y,Me.z),ne.push(Ut,1-mt),at.push(le++)}se.push(at)}for(let Le=0;Le<d;Le++)for(let at=0;at<m;at++){const mt=se[at][Le],Dt=se[at+1][Le],on=se[at+1][Le+1],Ut=se[at][Le+1];K.push(mt,Dt,Ut),K.push(Dt,on,Ut),it+=6}N.addGroup(ye,it,0),ye+=it}function Ee(Me){const Fe=le,it=new kn,yt=new tt;let Le=0;const at=Me===!0?n:a,mt=Me===!0?1:-1;for(let on=1;on<=d;on++)$.push(0,re*mt,0),j.push(0,mt,0),ne.push(.5,.5),le++;const Dt=le;for(let on=0;on<=d;on++){const _t=on/d*k+y,Qt=Math.cos(_t),bn=Math.sin(_t);yt.x=at*bn,yt.y=re*mt,yt.z=at*Qt,$.push(yt.x,yt.y,yt.z),j.push(0,mt,0),it.x=Qt*.5+.5,it.y=bn*.5*mt+.5,ne.push(it.x,it.y),le++}for(let on=0;on<d;on++){const Ut=Fe+on,_t=Dt+on;Me===!0?K.push(_t,_t+1,Ut):K.push(_t+1,_t,Ut),Le+=3}N.addGroup(ye,Le,Me===!0?1:2),ye+=Le}}static fromJSON(n){return new Ph(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class Vl extends Ph{constructor(n=1,a=1,u=8,d=1,m=!1,A=0,y=Math.PI*2){super(0,n,a,u,d,m,A,y),this.type="ConeGeometry",this.parameters={radius:n,height:a,radialSegments:u,heightSegments:d,openEnded:m,thetaStart:A,thetaLength:y}}static fromJSON(n){return new Vl(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class tu extends Or{constructor(n=[],a=[],u=1,d=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:a,radius:u,detail:d};const m=[],A=[];y(d),N(u),K(),this.setAttribute("position",new Fi(m,3)),this.setAttribute("normal",new Fi(m.slice(),3)),this.setAttribute("uv",new Fi(A,2)),d===0?this.computeVertexNormals():this.normalizeNormals();function y(Be){const Ee=new tt,Me=new tt,Fe=new tt;for(let it=0;it<a.length;it+=3)ne(a[it+0],Ee),ne(a[it+1],Me),ne(a[it+2],Fe),k(Ee,Me,Fe,Be)}function k(Be,Ee,Me,Fe){const it=Fe+1,yt=[];for(let Le=0;Le<=it;Le++){yt[Le]=[];const at=Be.clone().lerp(Me,Le/it),mt=Ee.clone().lerp(Me,Le/it),Dt=it-Le;for(let on=0;on<=Dt;on++)on===0&&Le===it?yt[Le][on]=at:yt[Le][on]=at.clone().lerp(mt,on/Dt)}for(let Le=0;Le<it;Le++)for(let at=0;at<2*(it-Le)-1;at++){const mt=Math.floor(at/2);at%2===0?(j(yt[Le][mt+1]),j(yt[Le+1][mt]),j(yt[Le][mt])):(j(yt[Le][mt+1]),j(yt[Le+1][mt+1]),j(yt[Le+1][mt]))}}function N(Be){const Ee=new tt;for(let Me=0;Me<m.length;Me+=3)Ee.x=m[Me+0],Ee.y=m[Me+1],Ee.z=m[Me+2],Ee.normalize().multiplyScalar(Be),m[Me+0]=Ee.x,m[Me+1]=Ee.y,m[Me+2]=Ee.z}function K(){const Be=new tt;for(let Ee=0;Ee<m.length;Ee+=3){Be.x=m[Ee+0],Be.y=m[Ee+1],Be.z=m[Ee+2];const Me=re(Be)/2/Math.PI+.5,Fe=ye(Be)/Math.PI+.5;A.push(Me,1-Fe)}le(),$()}function $(){for(let Be=0;Be<A.length;Be+=6){const Ee=A[Be+0],Me=A[Be+2],Fe=A[Be+4],it=Math.max(Ee,Me,Fe),yt=Math.min(Ee,Me,Fe);it>.9&&yt<.1&&(Ee<.2&&(A[Be+0]+=1),Me<.2&&(A[Be+2]+=1),Fe<.2&&(A[Be+4]+=1))}}function j(Be){m.push(Be.x,Be.y,Be.z)}function ne(Be,Ee){const Me=Be*3;Ee.x=n[Me+0],Ee.y=n[Me+1],Ee.z=n[Me+2]}function le(){const Be=new tt,Ee=new tt,Me=new tt,Fe=new tt,it=new kn,yt=new kn,Le=new kn;for(let at=0,mt=0;at<m.length;at+=9,mt+=6){Be.set(m[at+0],m[at+1],m[at+2]),Ee.set(m[at+3],m[at+4],m[at+5]),Me.set(m[at+6],m[at+7],m[at+8]),it.set(A[mt+0],A[mt+1]),yt.set(A[mt+2],A[mt+3]),Le.set(A[mt+4],A[mt+5]),Fe.copy(Be).add(Ee).add(Me).divideScalar(3);const Dt=re(Fe);se(it,mt+0,Be,Dt),se(yt,mt+2,Ee,Dt),se(Le,mt+4,Me,Dt)}}function se(Be,Ee,Me,Fe){Fe<0&&Be.x===1&&(A[Ee]=Be.x-1),Me.x===0&&Me.z===0&&(A[Ee]=Fe/2/Math.PI+.5)}function re(Be){return Math.atan2(Be.z,-Be.x)}function ye(Be){return Math.atan2(-Be.y,Math.sqrt(Be.x*Be.x+Be.z*Be.z))}}static fromJSON(n){return new tu(n.vertices,n.indices,n.radius,n.details)}}class nu extends tu{constructor(n=1,a=0){const u=(1+Math.sqrt(5))/2,d=1/u,m=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-u,0,-d,u,0,d,-u,0,d,u,-d,-u,0,-d,u,0,d,-u,0,d,u,0,-u,0,-d,u,0,-d,-u,0,d,u,0,d],A=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(m,A,n,a),this.type="DodecahedronGeometry",this.parameters={radius:n,detail:a}}static fromJSON(n){return new nu(n.radius,n.detail)}}const Im=new tt,Sm=new tt,R0=new tt,Tm=new Ss;class tl extends Or{constructor(n=null,a=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:n,thresholdAngle:a},n!==null){const d=Math.pow(10,4),m=Math.cos(Bl*a),A=n.getIndex(),y=n.getAttribute("position"),k=A?A.count:y.count,N=[0,0,0],K=["a","b","c"],$=new Array(3),j={},ne=[];for(let le=0;le<k;le+=3){A?(N[0]=A.getX(le),N[1]=A.getX(le+1),N[2]=A.getX(le+2)):(N[0]=le,N[1]=le+1,N[2]=le+2);const{a:se,b:re,c:ye}=Tm;if(se.fromBufferAttribute(y,N[0]),re.fromBufferAttribute(y,N[1]),ye.fromBufferAttribute(y,N[2]),Tm.getNormal(R0),$[0]=`${Math.round(se.x*d)},${Math.round(se.y*d)},${Math.round(se.z*d)}`,$[1]=`${Math.round(re.x*d)},${Math.round(re.y*d)},${Math.round(re.z*d)}`,$[2]=`${Math.round(ye.x*d)},${Math.round(ye.y*d)},${Math.round(ye.z*d)}`,!($[0]===$[1]||$[1]===$[2]||$[2]===$[0]))for(let Be=0;Be<3;Be++){const Ee=(Be+1)%3,Me=$[Be],Fe=$[Ee],it=Tm[K[Be]],yt=Tm[K[Ee]],Le=`${Me}_${Fe}`,at=`${Fe}_${Me}`;at in j&&j[at]?(R0.dot(j[at].normal)<=m&&(ne.push(it.x,it.y,it.z),ne.push(yt.x,yt.y,yt.z)),j[at]=null):Le in j||(j[Le]={index0:N[Be],index1:N[Ee],normal:R0.clone()})}}for(const le in j)if(j[le]){const{index0:se,index1:re}=j[le];Im.fromBufferAttribute(y,se),Sm.fromBufferAttribute(y,re),ne.push(Im.x,Im.y,Im.z),ne.push(Sm.x,Sm.y,Sm.z)}this.setAttribute("position",new Fi(ne,3))}}}class iu extends Lp{constructor(n){super(n),this.uuid=Za(),this.type="Shape",this.holes=[]}getPointsHoles(n){const a=[];for(let u=0,d=this.holes.length;u<d;u++)a[u]=this.holes[u].getPoints(n);return a}extractPoints(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}}copy(n){super.copy(n),this.holes=[];for(let a=0,u=n.holes.length;a<u;a++){const d=n.holes[a];this.holes.push(d.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let a=0,u=this.holes.length;a<u;a++){const d=this.holes[a];n.holes.push(d.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let a=0,u=n.holes.length;a<u;a++){const d=n.holes[a];this.holes.push(new Lp().fromJSON(d))}return this}}const P2={triangulate:function(x,n,a=2){const u=n&&n.length,d=u?n[0]*a:x.length;let m=vv(x,0,d,a,!0);const A=[];if(!m||m.next===m.prev)return A;let y,k,N,K,$,j,ne;if(u&&(m=V2(x,n,m,a)),x.length>80*a){y=N=x[0],k=K=x[1];for(let le=a;le<d;le+=a)$=x[le],j=x[le+1],$<y&&(y=$),j<k&&(k=j),$>N&&(N=$),j>K&&(K=j);ne=Math.max(N-y,K-k),ne=ne!==0?32767/ne:0}return Gd(m,A,a,y,k,ne,0),A}};function vv(x,n,a,u,d){let m,A;if(d===Z2(x,n,a,u)>0)for(m=n;m<a;m+=u)A=D0(m,x[m],x[m+1],A);else for(m=a-u;m>=n;m-=u)A=D0(m,x[m],x[m+1],A);return A&&Vd(A,A.next)&&(Fp(A),A=A.next),A}function Oh(x,n){if(!x)return x;n||(n=x);let a=x,u;do if(u=!1,!a.steiner&&(Vd(a,a.next)||ta(a.prev,a,a.next)===0)){if(Fp(a),a=n=a.prev,a===a.next)break;u=!0}else a=a.next;while(u||a!==n);return n}function Gd(x,n,a,u,d,m,A){if(!x)return;!A&&m&&H2(x,u,d,m);let y=x,k,N;for(;x.prev!==x.next;){if(k=x.prev,N=x.next,m?G2(x,u,d,m):O2(x)){n.push(k.i/a|0),n.push(x.i/a|0),n.push(N.i/a|0),Fp(x),x=N.next,y=N.next;continue}if(x=N,x===y){A?A===1?(x=U2(Oh(x),n,a),Gd(x,n,a,u,d,m,2)):A===2&&yv(x,n,a,u,d,m):Gd(Oh(x),n,a,u,d,m,1);break}}}function O2(x){const n=x.prev,a=x,u=x.next;if(ta(n,a,u)>=0)return!1;const d=n.x,m=a.x,A=u.x,y=n.y,k=a.y,N=u.y,K=d<m?d<A?d:A:m<A?m:A,$=y<k?y<N?y:N:k<N?k:N,j=d>m?d>A?d:A:m>A?m:A,ne=y>k?y>N?y:N:k>N?k:N;let le=u.next;for(;le!==n;){if(le.x>=K&&le.x<=j&&le.y>=$&&le.y<=ne&&Wu(d,y,m,k,A,N,le.x,le.y)&&ta(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function G2(x,n,a,u){const d=x.prev,m=x,A=x.next;if(ta(d,m,A)>=0)return!1;const y=d.x,k=m.x,N=A.x,K=d.y,$=m.y,j=A.y,ne=y<k?y<N?y:N:k<N?k:N,le=K<$?K<j?K:j:$<j?$:j,se=y>k?y>N?y:N:k>N?k:N,re=K>$?K>j?K:j:$>j?$:j,ye=B0(ne,le,n,a,u),Be=B0(se,re,n,a,u);let Ee=x.prevZ,Me=x.nextZ;for(;Ee&&Ee.z>=ye&&Me&&Me.z<=Be;){if(Ee.x>=ne&&Ee.x<=se&&Ee.y>=le&&Ee.y<=re&&Ee!==d&&Ee!==A&&Wu(y,K,k,$,N,j,Ee.x,Ee.y)&&ta(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Me.x>=ne&&Me.x<=se&&Me.y>=le&&Me.y<=re&&Me!==d&&Me!==A&&Wu(y,K,k,$,N,j,Me.x,Me.y)&&ta(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;Ee&&Ee.z>=ye;){if(Ee.x>=ne&&Ee.x<=se&&Ee.y>=le&&Ee.y<=re&&Ee!==d&&Ee!==A&&Wu(y,K,k,$,N,j,Ee.x,Ee.y)&&ta(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Me&&Me.z<=Be;){if(Me.x>=ne&&Me.x<=se&&Me.y>=le&&Me.y<=re&&Me!==d&&Me!==A&&Wu(y,K,k,$,N,j,Me.x,Me.y)&&ta(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function U2(x,n,a){let u=x;do{const d=u.prev,m=u.next.next;!Vd(d,m)&&xv(d,u,u.next,m)&&Np(d,m)&&Np(m,d)&&(n.push(d.i/a|0),n.push(u.i/a|0),n.push(m.i/a|0),Fp(u),Fp(u.next),u=x=m),u=u.next}while(u!==x);return Oh(u)}function yv(x,n,a,u,d,m){let A=x;do{let y=A.next.next;for(;y!==A.prev;){if(A.i!==y.i&&L0(A,y)){let k=Cv(A,y);A=Oh(A,A.next),k=Oh(k,k.next),Gd(A,n,a,u,d,m,0),Gd(k,n,a,u,d,m,0);return}y=y.next}A=A.next}while(A!==x)}function V2(x,n,a,u){const d=[];let m,A,y,k,N;for(m=0,A=n.length;m<A;m++)y=n[m]*u,k=m<A-1?n[m+1]*u:x.length,N=vv(x,y,k,u,!1),N===N.next&&(N.steiner=!0),d.push(k0(N));for(d.sort(Ud),m=0;m<d.length;m++)a=z2(d[m],a);return a}function Ud(x,n){return x.x-n.x}function z2(x,n){const a=bv(x,n);if(!a)return n;const u=Cv(a,x);return Oh(u,u.next),Oh(a,a.next)}function bv(x,n){let a=n,u=-1/0,d;const m=x.x,A=x.y;do{if(A<=a.y&&A>=a.next.y&&a.next.y!==a.y){const j=a.x+(A-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(j<=m&&j>u&&(u=j,d=a.x<a.next.x?a:a.next,j===m))return d}a=a.next}while(a!==n);if(!d)return null;const y=d,k=d.x,N=d.y;let K=1/0,$;a=d;do m>=a.x&&a.x>=k&&m!==a.x&&Wu(A<N?m:u,A,k,N,A<N?u:m,A,a.x,a.y)&&($=Math.abs(A-a.y)/(m-a.x),Np(a,x)&&($<K||$===K&&(a.x>d.x||a.x===d.x&&W2(d,a)))&&(d=a,K=$)),a=a.next;while(a!==y);return d}function W2(x,n){return ta(x.prev,x,n.prev)<0&&ta(n.next,x,x.next)<0}function H2(x,n,a,u){let d=x;do d.z===0&&(d.z=B0(d.x,d.y,n,a,u)),d.prevZ=d.prev,d.nextZ=d.next,d=d.next;while(d!==x);d.prevZ.nextZ=null,d.prevZ=null,K2(d)}function K2(x){let n,a,u,d,m,A,y,k,N=1;do{for(a=x,x=null,m=null,A=0;a;){for(A++,u=a,y=0,n=0;n<N&&(y++,u=u.nextZ,!!u);n++);for(k=N;y>0||k>0&&u;)y!==0&&(k===0||!u||a.z<=u.z)?(d=a,a=a.nextZ,y--):(d=u,u=u.nextZ,k--),m?m.nextZ=d:x=d,d.prevZ=m,m=d;a=u}m.nextZ=null,N*=2}while(A>1);return x}function B0(x,n,a,u,d){return x=(x-a)*d|0,n=(n-u)*d|0,x=(x|x<<8)&16711935,x=(x|x<<4)&252645135,x=(x|x<<2)&858993459,x=(x|x<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,x|n<<1}function k0(x){let n=x,a=x;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==x);return a}function Wu(x,n,a,u,d,m,A,y){return(d-A)*(n-y)>=(x-A)*(m-y)&&(x-A)*(u-y)>=(a-A)*(n-y)&&(a-A)*(m-y)>=(d-A)*(u-y)}function L0(x,n){return x.next.i!==n.i&&x.prev.i!==n.i&&!X2(x,n)&&(Np(x,n)&&Np(n,x)&&Q2(x,n)&&(ta(x.prev,x,n.prev)||ta(x,n.prev,n))||Vd(x,n)&&ta(x.prev,x,x.next)>0&&ta(n.prev,n,n.next)>0)}function ta(x,n,a){return(n.y-x.y)*(a.x-n.x)-(n.x-x.x)*(a.y-n.y)}function Vd(x,n){return x.x===n.x&&x.y===n.y}function xv(x,n,a,u){const d=_m(ta(x,n,a)),m=_m(ta(x,n,u)),A=_m(ta(a,u,x)),y=_m(ta(a,u,n));return!!(d!==m&&A!==y||d===0&&Mm(x,a,n)||m===0&&Mm(x,u,n)||A===0&&Mm(a,x,u)||y===0&&Mm(a,n,u))}function Mm(x,n,a){return n.x<=Math.max(x.x,a.x)&&n.x>=Math.min(x.x,a.x)&&n.y<=Math.max(x.y,a.y)&&n.y>=Math.min(x.y,a.y)}function _m(x){return x>0?1:x<0?-1:0}function X2(x,n){let a=x;do{if(a.i!==x.i&&a.next.i!==x.i&&a.i!==n.i&&a.next.i!==n.i&&xv(a,a.next,x,n))return!0;a=a.next}while(a!==x);return!1}function Np(x,n){return ta(x.prev,x,x.next)<0?ta(x,n,x.next)>=0&&ta(x,x.prev,n)>=0:ta(x,n,x.prev)<0||ta(x,x.next,n)<0}function Q2(x,n){let a=x,u=!1;const d=(x.x+n.x)/2,m=(x.y+n.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==x);return u}function Cv(x,n){const a=new N0(x.i,x.x,x.y),u=new N0(n.i,n.x,n.y),d=x.next,m=n.prev;return x.next=n,n.prev=x,a.next=d,d.prev=a,u.next=a,a.prev=u,m.next=u,u.prev=m,u}function D0(x,n,a,u){const d=new N0(x,n,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function Fp(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function N0(x,n,a){this.i=x,this.x=n,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Z2(x,n,a,u){let d=0;for(let m=n,A=a-u;m<a;m+=u)d+=(x[A]-x[m])*(x[m+1]+x[A+1]),A=m;return d}class Sc{static area(n){const a=n.length;let u=0;for(let d=a-1,m=0;m<a;d=m++)u+=n[d].x*n[m].y-n[m].x*n[d].y;return u*.5}static isClockWise(n){return Sc.area(n)<0}static triangulateShape(n,a){const u=[],d=[],m=[];wv(n),Ev(u,n);let A=n.length;a.forEach(wv);for(let k=0;k<a.length;k++)d.push(A),A+=a[k].length,Ev(u,a[k]);const y=P2.triangulate(u,d);for(let k=0;k<y.length;k+=3)m.push(y.slice(k,k+3));return m}}function wv(x){const n=x.length;n>2&&x[n-1].equals(x[0])&&x.pop()}function Ev(x,n){for(let a=0;a<n.length;a++)x.push(n[a].x),x.push(n[a].y)}class Pp extends Or{constructor(n=new iu([new kn(.5,.5),new kn(-.5,.5),new kn(-.5,-.5),new kn(.5,-.5)]),a={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:a},n=Array.isArray(n)?n:[n];const u=this,d=[],m=[];for(let y=0,k=n.length;y<k;y++){const N=n[y];A(N)}this.setAttribute("position",new Fi(d,3)),this.setAttribute("uv",new Fi(m,2)),this.computeVertexNormals();function A(y){const k=[],N=a.curveSegments!==void 0?a.curveSegments:12,K=a.steps!==void 0?a.steps:1,$=a.depth!==void 0?a.depth:1;let j=a.bevelEnabled!==void 0?a.bevelEnabled:!0,ne=a.bevelThickness!==void 0?a.bevelThickness:.2,le=a.bevelSize!==void 0?a.bevelSize:ne-.1,se=a.bevelOffset!==void 0?a.bevelOffset:0,re=a.bevelSegments!==void 0?a.bevelSegments:3;const ye=a.extrudePath,Be=a.UVGenerator!==void 0?a.UVGenerator:$2;let Ee,Me=!1,Fe,it,yt,Le;ye&&(Ee=ye.getSpacedPoints(K),Me=!0,j=!1,Fe=ye.computeFrenetFrames(K,!1),it=new tt,yt=new tt,Le=new tt),j||(re=0,ne=0,le=0,se=0);const at=y.extractPoints(N);let mt=at.shape;const Dt=at.holes;if(!Sc.isClockWise(mt)){mt=mt.reverse();for(let Ln=0,Tn=Dt.length;Ln<Tn;Ln++){const qn=Dt[Ln];Sc.isClockWise(qn)&&(Dt[Ln]=qn.reverse())}}const Ut=Sc.triangulateShape(mt,Dt),_t=mt;for(let Ln=0,Tn=Dt.length;Ln<Tn;Ln++){const qn=Dt[Ln];mt=mt.concat(qn)}function Qt(Ln,Tn,qn){return Tn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Tn.clone().multiplyScalar(qn).add(Ln)}const bn=mt.length,je=Ut.length;function Zt(Ln,Tn,qn){let $i,mi,wr;const ki=Ln.x-Tn.x,sr=Ln.y-Tn.y,Os=qn.x-Ln.x,Ts=qn.y-Ln.y,ot=ki*ki+sr*sr,Ze=ki*Ts-sr*Os;if(Math.abs(Ze)>Number.EPSILON){const ln=Math.sqrt(ot),Xn=Math.sqrt(Os*Os+Ts*Ts),oi=Tn.x-sr/ln,Mi=Tn.y+ki/ln,Sr=qn.x-Ts/Xn,_i=qn.y+Os/Xn,_n=((Sr-oi)*Ts-(_i-Mi)*Os)/(ki*Ts-sr*Os);$i=oi+ki*_n-Ln.x,mi=Mi+sr*_n-Ln.y;const ji=$i*$i+mi*mi;if(ji<=2)return new kn($i,mi);wr=Math.sqrt(ji/2)}else{let ln=!1;ki>Number.EPSILON?Os>Number.EPSILON&&(ln=!0):ki<-Number.EPSILON?Os<-Number.EPSILON&&(ln=!0):Math.sign(sr)===Math.sign(Ts)&&(ln=!0),ln?($i=-sr,mi=ki,wr=Math.sqrt(ot)):($i=ki,mi=sr,wr=Math.sqrt(ot/2))}return new kn($i/wr,mi/wr)}const Qn=[];for(let Ln=0,Tn=_t.length,qn=Tn-1,$i=Ln+1;Ln<Tn;Ln++,qn++,$i++)qn===Tn&&(qn=0),$i===Tn&&($i=0),Qn[Ln]=Zt(_t[Ln],_t[qn],_t[$i]);const Kn=[];let xi,li=Qn.concat();for(let Ln=0,Tn=Dt.length;Ln<Tn;Ln++){const qn=Dt[Ln];xi=[];for(let $i=0,mi=qn.length,wr=mi-1,ki=$i+1;$i<mi;$i++,wr++,ki++)wr===mi&&(wr=0),ki===mi&&(ki=0),xi[$i]=Zt(qn[$i],qn[wr],qn[ki]);Kn.push(xi),li=li.concat(xi)}for(let Ln=0;Ln<re;Ln++){const Tn=Ln/re,qn=ne*Math.cos(Tn*Math.PI/2),$i=le*Math.sin(Tn*Math.PI/2)+se;for(let mi=0,wr=_t.length;mi<wr;mi++){const ki=Qt(_t[mi],Qn[mi],$i);Ei(ki.x,ki.y,-qn)}for(let mi=0,wr=Dt.length;mi<wr;mi++){const ki=Dt[mi];xi=Kn[mi];for(let sr=0,Os=ki.length;sr<Os;sr++){const Ts=Qt(ki[sr],xi[sr],$i);Ei(Ts.x,Ts.y,-qn)}}}const pn=le+se;for(let Ln=0;Ln<bn;Ln++){const Tn=j?Qt(mt[Ln],li[Ln],pn):mt[Ln];Me?(yt.copy(Fe.normals[0]).multiplyScalar(Tn.x),it.copy(Fe.binormals[0]).multiplyScalar(Tn.y),Le.copy(Ee[0]).add(yt).add(it),Ei(Le.x,Le.y,Le.z)):Ei(Tn.x,Tn.y,0)}for(let Ln=1;Ln<=K;Ln++)for(let Tn=0;Tn<bn;Tn++){const qn=j?Qt(mt[Tn],li[Tn],pn):mt[Tn];Me?(yt.copy(Fe.normals[Ln]).multiplyScalar(qn.x),it.copy(Fe.binormals[Ln]).multiplyScalar(qn.y),Le.copy(Ee[Ln]).add(yt).add(it),Ei(Le.x,Le.y,Le.z)):Ei(qn.x,qn.y,$/K*Ln)}for(let Ln=re-1;Ln>=0;Ln--){const Tn=Ln/re,qn=ne*Math.cos(Tn*Math.PI/2),$i=le*Math.sin(Tn*Math.PI/2)+se;for(let mi=0,wr=_t.length;mi<wr;mi++){const ki=Qt(_t[mi],Qn[mi],$i);Ei(ki.x,ki.y,$+qn)}for(let mi=0,wr=Dt.length;mi<wr;mi++){const ki=Dt[mi];xi=Kn[mi];for(let sr=0,Os=ki.length;sr<Os;sr++){const Ts=Qt(ki[sr],xi[sr],$i);Me?Ei(Ts.x,Ts.y+Ee[K-1].y,Ee[K-1].x+qn):Ei(Ts.x,Ts.y,$+qn)}}}Rn(),Vn();function Rn(){const Ln=d.length/3;if(j){let Tn=0,qn=bn*Tn;for(let $i=0;$i<je;$i++){const mi=Ut[$i];ii(mi[2]+qn,mi[1]+qn,mi[0]+qn)}Tn=K+re*2,qn=bn*Tn;for(let $i=0;$i<je;$i++){const mi=Ut[$i];ii(mi[0]+qn,mi[1]+qn,mi[2]+qn)}}else{for(let Tn=0;Tn<je;Tn++){const qn=Ut[Tn];ii(qn[2],qn[1],qn[0])}for(let Tn=0;Tn<je;Tn++){const qn=Ut[Tn];ii(qn[0]+bn*K,qn[1]+bn*K,qn[2]+bn*K)}}u.addGroup(Ln,d.length/3-Ln,0)}function Vn(){const Ln=d.length/3;let Tn=0;Jt(_t,Tn),Tn+=_t.length;for(let qn=0,$i=Dt.length;qn<$i;qn++){const mi=Dt[qn];Jt(mi,Tn),Tn+=mi.length}u.addGroup(Ln,d.length/3-Ln,1)}function Jt(Ln,Tn){let qn=Ln.length;for(;--qn>=0;){const $i=qn;let mi=qn-1;mi<0&&(mi=Ln.length-1);for(let wr=0,ki=K+re*2;wr<ki;wr++){const sr=bn*wr,Os=bn*(wr+1),Ts=Tn+$i+sr,ot=Tn+mi+sr,Ze=Tn+mi+Os,ln=Tn+$i+Os;tr(Ts,ot,Ze,ln)}}}function Ei(Ln,Tn,qn){k.push(Ln),k.push(Tn),k.push(qn)}function ii(Ln,Tn,qn){ni(Ln),ni(Tn),ni(qn);const $i=d.length/3,mi=Be.generateTopUV(u,d,$i-3,$i-2,$i-1);Mr(mi[0]),Mr(mi[1]),Mr(mi[2])}function tr(Ln,Tn,qn,$i){ni(Ln),ni(Tn),ni($i),ni(Tn),ni(qn),ni($i);const mi=d.length/3,wr=Be.generateSideWallUV(u,d,mi-6,mi-3,mi-2,mi-1);Mr(wr[0]),Mr(wr[1]),Mr(wr[3]),Mr(wr[1]),Mr(wr[2]),Mr(wr[3])}function ni(Ln){d.push(k[Ln*3+0]),d.push(k[Ln*3+1]),d.push(k[Ln*3+2])}function Mr(Ln){m.push(Ln.x),m.push(Ln.y)}}}toJSON(){const n=super.toJSON(),a=this.parameters.shapes,u=this.parameters.options;return zd(a,u,n)}static fromJSON(n,a){const u=[];for(let m=0,A=n.shapes.length;m<A;m++){const y=a[n.shapes[m]];u.push(y)}const d=n.options.extrudePath;return d!==void 0&&(n.options.extrudePath=new _0[d.type]().fromJSON(d)),new Pp(u,n.options)}}const $2={generateTopUV:function(x,n,a,u,d){const m=n[a*3],A=n[a*3+1],y=n[u*3],k=n[u*3+1],N=n[d*3],K=n[d*3+1];return[new kn(m,A),new kn(y,k),new kn(N,K)]},generateSideWallUV:function(x,n,a,u,d,m){const A=n[a*3],y=n[a*3+1],k=n[a*3+2],N=n[u*3],K=n[u*3+1],$=n[u*3+2],j=n[d*3],ne=n[d*3+1],le=n[d*3+2],se=n[m*3],re=n[m*3+1],ye=n[m*3+2];return Math.abs(y-K)<Math.abs(A-N)?[new kn(A,1-k),new kn(N,1-$),new kn(j,1-le),new kn(se,1-ye)]:[new kn(y,1-k),new kn(K,1-$),new kn(ne,1-le),new kn(re,1-ye)]}};function zd(x,n,a){if(a.shapes=[],Array.isArray(x))for(let u=0,d=x.length;u<d;u++){const m=x[u];a.shapes.push(m.uuid)}else a.shapes.push(x.uuid);return a.options=Object.assign({},n),n.extrudePath!==void 0&&(a.options.extrudePath=n.extrudePath.toJSON()),a}class Op extends tu{constructor(n=1,a=0){const u=(1+Math.sqrt(5))/2,d=[-1,u,0,1,u,0,-1,-u,0,1,-u,0,0,-1,u,0,1,u,0,-1,-u,0,1,-u,u,0,-1,u,0,1,-u,0,-1,-u,0,1],m=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(d,m,n,a),this.type="IcosahedronGeometry",this.parameters={radius:n,detail:a}}static fromJSON(n){return new Op(n.radius,n.detail)}}class Wd extends tu{constructor(n=1,a=0){const u=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(u,d,n,a),this.type="OctahedronGeometry",this.parameters={radius:n,detail:a}}static fromJSON(n){return new Wd(n.radius,n.detail)}}class Gp extends Or{constructor(n=.5,a=1,u=8,d=1,m=0,A=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:n,outerRadius:a,thetaSegments:u,phiSegments:d,thetaStart:m,thetaLength:A},u=Math.max(3,u),d=Math.max(1,d);const y=[],k=[],N=[],K=[];let $=n;const j=(a-n)/d,ne=new tt,le=new kn;for(let se=0;se<=d;se++){for(let re=0;re<=u;re++){const ye=m+re/u*A;ne.x=$*Math.cos(ye),ne.y=$*Math.sin(ye),k.push(ne.x,ne.y,ne.z),N.push(0,0,1),le.x=(ne.x/a+1)/2,le.y=(ne.y/a+1)/2,K.push(le.x,le.y)}$+=j}for(let se=0;se<d;se++){const re=se*(u+1);for(let ye=0;ye<u;ye++){const Be=ye+re,Ee=Be,Me=Be+u+1,Fe=Be+u+2,it=Be+1;y.push(Ee,Me,it),y.push(Me,Fe,it)}}this.setIndex(y),this.setAttribute("position",new Fi(k,3)),this.setAttribute("normal",new Fi(N,3)),this.setAttribute("uv",new Fi(K,2))}static fromJSON(n){return new Gp(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)}}class Up extends Or{constructor(n=new iu([new kn(0,.5),new kn(-.5,-.5),new kn(.5,-.5)]),a=12){super(),this.type="ShapeGeometry",this.parameters={shapes:n,curveSegments:a};const u=[],d=[],m=[],A=[];let y=0,k=0;if(Array.isArray(n)===!1)N(n);else for(let K=0;K<n.length;K++)N(n[K]),this.addGroup(y,k,K),y+=k,k=0;this.setIndex(u),this.setAttribute("position",new Fi(d,3)),this.setAttribute("normal",new Fi(m,3)),this.setAttribute("uv",new Fi(A,2));function N(K){const $=d.length/3,j=K.extractPoints(a);let ne=j.shape;const le=j.holes;Sc.isClockWise(ne)===!1&&(ne=ne.reverse());for(let re=0,ye=le.length;re<ye;re++){const Be=le[re];Sc.isClockWise(Be)===!0&&(le[re]=Be.reverse())}const se=Sc.triangulateShape(ne,le);for(let re=0,ye=le.length;re<ye;re++){const Be=le[re];ne=ne.concat(Be)}for(let re=0,ye=ne.length;re<ye;re++){const Be=ne[re];d.push(Be.x,Be.y,0),m.push(0,0,1),A.push(Be.x,Be.y)}for(let re=0,ye=se.length;re<ye;re++){const Be=se[re],Ee=Be[0]+$,Me=Be[1]+$,Fe=Be[2]+$;u.push(Ee,Me,Fe),k+=3}}}toJSON(){const n=super.toJSON(),a=this.parameters.shapes;return j2(a,n)}static fromJSON(n,a){const u=[];for(let d=0,m=n.shapes.length;d<m;d++){const A=a[n.shapes[d]];u.push(A)}return new Up(u,n.curveSegments)}}function j2(x,n){if(n.shapes=[],Array.isArray(x))for(let a=0,u=x.length;a<u;a++){const d=x[a];n.shapes.push(d.uuid)}else n.shapes.push(x.uuid);return n}class Hd extends Or{constructor(n=1,a=32,u=16,d=0,m=Math.PI*2,A=0,y=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:a,heightSegments:u,phiStart:d,phiLength:m,thetaStart:A,thetaLength:y},a=Math.max(3,Math.floor(a)),u=Math.max(2,Math.floor(u));const k=Math.min(A+y,Math.PI);let N=0;const K=[],$=new tt,j=new tt,ne=[],le=[],se=[],re=[];for(let ye=0;ye<=u;ye++){const Be=[],Ee=ye/u;let Me=0;ye==0&&A==0?Me=.5/a:ye==u&&k==Math.PI&&(Me=-.5/a);for(let Fe=0;Fe<=a;Fe++){const it=Fe/a;$.x=-n*Math.cos(d+it*m)*Math.sin(A+Ee*y),$.y=n*Math.cos(A+Ee*y),$.z=n*Math.sin(d+it*m)*Math.sin(A+Ee*y),le.push($.x,$.y,$.z),j.copy($).normalize(),se.push(j.x,j.y,j.z),re.push(it+Me,1-Ee),Be.push(N++)}K.push(Be)}for(let ye=0;ye<u;ye++)for(let Be=0;Be<a;Be++){const Ee=K[ye][Be+1],Me=K[ye][Be],Fe=K[ye+1][Be],it=K[ye+1][Be+1];(ye!==0||A>0)&&ne.push(Ee,Me,it),(ye!==u-1||k<Math.PI)&&ne.push(Me,Fe,it)}this.setIndex(ne),this.setAttribute("position",new Fi(le,3)),this.setAttribute("normal",new Fi(se,3)),this.setAttribute("uv",new Fi(re,2))}static fromJSON(n){return new Hd(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)}}class Gh extends tu{constructor(n=1,a=0){const u=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],d=[2,1,0,0,3,2,1,3,0,2,3,1];super(u,d,n,a),this.type="TetrahedronGeometry",this.parameters={radius:n,detail:a}}static fromJSON(n){return new Gh(n.radius,n.detail)}}class Uh extends Or{constructor(n=1,a=.4,u=8,d=6,m=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:a,radialSegments:u,tubularSegments:d,arc:m},u=Math.floor(u),d=Math.floor(d);const A=[],y=[],k=[],N=[],K=new tt,$=new tt,j=new tt;for(let ne=0;ne<=u;ne++)for(let le=0;le<=d;le++){const se=le/d*m,re=ne/u*Math.PI*2;$.x=(n+a*Math.cos(re))*Math.cos(se),$.y=(n+a*Math.cos(re))*Math.sin(se),$.z=a*Math.sin(re),y.push($.x,$.y,$.z),K.x=n*Math.cos(se),K.y=n*Math.sin(se),j.subVectors($,K).normalize(),k.push(j.x,j.y,j.z),N.push(le/d),N.push(ne/u)}for(let ne=1;ne<=u;ne++)for(let le=1;le<=d;le++){const se=(d+1)*ne+le-1,re=(d+1)*(ne-1)+le-1,ye=(d+1)*(ne-1)+le,Be=(d+1)*ne+le;A.push(se,re,Be),A.push(re,ye,Be)}this.setIndex(A),this.setAttribute("position",new Fi(y,3)),this.setAttribute("normal",new Fi(k,3)),this.setAttribute("uv",new Fi(N,2))}static fromJSON(n){return new Uh(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)}}class Vh extends Or{constructor(n=1,a=.4,u=64,d=8,m=2,A=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:n,tube:a,tubularSegments:u,radialSegments:d,p:m,q:A},u=Math.floor(u),d=Math.floor(d);const y=[],k=[],N=[],K=[],$=new tt,j=new tt,ne=new tt,le=new tt,se=new tt,re=new tt,ye=new tt;for(let Ee=0;Ee<=u;++Ee){const Me=Ee/u*m*Math.PI*2;Be(Me,m,A,n,ne),Be(Me+.01,m,A,n,le),re.subVectors(le,ne),ye.addVectors(le,ne),se.crossVectors(re,ye),ye.crossVectors(se,re),se.normalize(),ye.normalize();for(let Fe=0;Fe<=d;++Fe){const it=Fe/d*Math.PI*2,yt=-a*Math.cos(it),Le=a*Math.sin(it);$.x=ne.x+(yt*ye.x+Le*se.x),$.y=ne.y+(yt*ye.y+Le*se.y),$.z=ne.z+(yt*ye.z+Le*se.z),k.push($.x,$.y,$.z),j.subVectors($,ne).normalize(),N.push(j.x,j.y,j.z),K.push(Ee/u),K.push(Fe/d)}}for(let Ee=1;Ee<=u;Ee++)for(let Me=1;Me<=d;Me++){const Fe=(d+1)*(Ee-1)+(Me-1),it=(d+1)*Ee+(Me-1),yt=(d+1)*Ee+Me,Le=(d+1)*(Ee-1)+Me;y.push(Fe,it,Le),y.push(it,yt,Le)}this.setIndex(y),this.setAttribute("position",new Fi(k,3)),this.setAttribute("normal",new Fi(N,3)),this.setAttribute("uv",new Fi(K,2));function Be(Ee,Me,Fe,it,yt){const Le=Math.cos(Ee),at=Math.sin(Ee),mt=Fe/Me*Ee,Dt=Math.cos(mt);yt.x=it*(2+Dt)*.5*Le,yt.y=it*(2+Dt)*at*.5,yt.z=it*Math.sin(mt)*.5}}static fromJSON(n){return new Vh(n.radius,n.tube,n.tubularSegments,n.radialSegments,n.p,n.q)}}class zh extends Or{constructor(n=new M0(new tt(-1,-1,0),new tt(-1,1,0),new tt(1,1,0)),a=64,u=1,d=8,m=!1){super(),this.type="TubeGeometry",this.parameters={path:n,tubularSegments:a,radius:u,radialSegments:d,closed:m};const A=n.computeFrenetFrames(a,m);this.tangents=A.tangents,this.normals=A.normals,this.binormals=A.binormals;const y=new tt,k=new tt,N=new kn;let K=new tt;const $=[],j=[],ne=[],le=[];se(),this.setIndex(le),this.setAttribute("position",new Fi($,3)),this.setAttribute("normal",new Fi(j,3)),this.setAttribute("uv",new Fi(ne,2));function se(){for(let Ee=0;Ee<a;Ee++)re(Ee);re(m===!1?a:0),Be(),ye()}function re(Ee){K=n.getPointAt(Ee/a,K);const Me=A.normals[Ee],Fe=A.binormals[Ee];for(let it=0;it<=d;it++){const yt=it/d*Math.PI*2,Le=Math.sin(yt),at=-Math.cos(yt);k.x=at*Me.x+Le*Fe.x,k.y=at*Me.y+Le*Fe.y,k.z=at*Me.z+Le*Fe.z,k.normalize(),j.push(k.x,k.y,k.z),y.x=K.x+u*k.x,y.y=K.y+u*k.y,y.z=K.z+u*k.z,$.push(y.x,y.y,y.z)}}function ye(){for(let Ee=1;Ee<=a;Ee++)for(let Me=1;Me<=d;Me++){const Fe=(d+1)*(Ee-1)+(Me-1),it=(d+1)*Ee+(Me-1),yt=(d+1)*Ee+Me,Le=(d+1)*(Ee-1)+Me;le.push(Fe,it,Le),le.push(it,yt,Le)}}function Be(){for(let Ee=0;Ee<=a;Ee++)for(let Me=0;Me<=d;Me++)N.x=Ee/a,N.y=Me/d,ne.push(N.x,N.y)}}toJSON(){const n=super.toJSON();return n.path=this.parameters.path.toJSON(),n}static fromJSON(n){return new zh(new _0[n.path.type]().fromJSON(n.path),n.tubularSegments,n.radius,n.radialSegments,n.closed)}}class Iv extends Or{constructor(n=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:n},n!==null){const a=[],u=new Set,d=new tt,m=new tt;if(n.index!==null){const A=n.attributes.position,y=n.index;let k=n.groups;k.length===0&&(k=[{start:0,count:y.count,materialIndex:0}]);for(let N=0,K=k.length;N<K;++N){const $=k[N],j=$.start,ne=$.count;for(let le=j,se=j+ne;le<se;le+=3)for(let re=0;re<3;re++){const ye=y.getX(le+re),Be=y.getX(le+(re+1)%3);d.fromBufferAttribute(A,ye),m.fromBufferAttribute(A,Be),Sv(d,m,u)===!0&&(a.push(d.x,d.y,d.z),a.push(m.x,m.y,m.z))}}}else{const A=n.attributes.position;for(let y=0,k=A.count/3;y<k;y++)for(let N=0;N<3;N++){const K=3*y+N,$=3*y+(N+1)%3;d.fromBufferAttribute(A,K),m.fromBufferAttribute(A,$),Sv(d,m,u)===!0&&(a.push(d.x,d.y,d.z),a.push(m.x,m.y,m.z))}}this.setAttribute("position",new Fi(a,3))}}}function Sv(x,n,a){const u=`${x.x},${x.y},${x.z}-${n.x},${n.y},${n.z}`,d=`${n.x},${n.y},${n.z}-${x.x},${x.y},${x.z}`;return a.has(u)===!0||a.has(d)===!0?!1:(a.add(u),a.add(d),!0)}var F0=Object.freeze({__proto__:null,BoxGeometry:bc,CapsuleGeometry:Dp,CircleGeometry:eu,ConeGeometry:Vl,CylinderGeometry:Ph,DodecahedronGeometry:nu,EdgesGeometry:tl,ExtrudeGeometry:Pp,IcosahedronGeometry:Op,LatheGeometry:Od,OctahedronGeometry:Wd,PlaneGeometry:Ed,PolyhedronGeometry:tu,RingGeometry:Gp,ShapeGeometry:Up,SphereGeometry:Hd,TetrahedronGeometry:Gh,TorusGeometry:Uh,TorusKnotGeometry:Vh,TubeGeometry:zh,WireframeGeometry:Iv});class Tv extends Ba{constructor(n){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Si(0),this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.fog=n.fog,this}}class Mv extends Ol{constructor(n){super(n),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class P0 extends Ba{constructor(n){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Si(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class _v extends P0{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new kn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return aa(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(a){this.ior=(1+.4*a)/(1-.4*a)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Si(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Si(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Si(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(n)}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}}class Rv extends Ba{constructor(n){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Si(16777215),this.specular=new Si(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ye,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class Bv extends Ba{constructor(n){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Si(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}class kv extends Ba{constructor(n){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.flatShading=n.flatShading,this}}class Lv extends Ba{constructor(n){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Si(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ye,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class Dv extends Ba{constructor(n){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Si(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ps,this.normalScale=new kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.flatShading=n.flatShading,this.fog=n.fog,this}}class Nv extends Fa{constructor(n){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}copy(n){return super.copy(n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this}}function zl(x,n,a){return O0(x)?new x.constructor(x.subarray(n,a!==void 0?a:x.length)):x.slice(n,a)}function Hu(x,n,a){return!x||!a&&x.constructor===n?x:typeof n.BYTES_PER_ELEMENT=="number"?new n(x):Array.prototype.slice.call(x)}function O0(x){return ArrayBuffer.isView(x)&&!(x instanceof DataView)}function G0(x){function n(d,m){return x[d]-x[m]}const a=x.length,u=new Array(a);for(let d=0;d!==a;++d)u[d]=d;return u.sort(n),u}function U0(x,n,a){const u=x.length,d=new x.constructor(u);for(let m=0,A=0;A!==u;++m){const y=a[m]*n;for(let k=0;k!==n;++k)d[A++]=x[y+k]}return d}function V0(x,n,a,u){let d=1,m=x[0];for(;m!==void 0&&m[u]===void 0;)m=x[d++];if(m===void 0)return;let A=m[u];if(A!==void 0)if(Array.isArray(A))do A=m[u],A!==void 0&&(n.push(m.time),a.push.apply(a,A)),m=x[d++];while(m!==void 0);else if(A.toArray!==void 0)do A=m[u],A!==void 0&&(n.push(m.time),A.toArray(a,a.length)),m=x[d++];while(m!==void 0);else do A=m[u],A!==void 0&&(n.push(m.time),a.push(A)),m=x[d++];while(m!==void 0)}function Y2(x,n,a,u,d=30){const m=x.clone();m.name=n;const A=[];for(let k=0;k<m.tracks.length;++k){const N=m.tracks[k],K=N.getValueSize(),$=[],j=[];for(let ne=0;ne<N.times.length;++ne){const le=N.times[ne]*d;if(!(le<a||le>=u)){$.push(N.times[ne]);for(let se=0;se<K;++se)j.push(N.values[ne*K+se])}}$.length!==0&&(N.times=Hu($,N.times.constructor),N.values=Hu(j,N.values.constructor),A.push(N))}m.tracks=A;let y=1/0;for(let k=0;k<m.tracks.length;++k)y>m.tracks[k].times[0]&&(y=m.tracks[k].times[0]);for(let k=0;k<m.tracks.length;++k)m.tracks[k].shift(-1*y);return m.resetDuration(),m}function J2(x,n=0,a=x,u=30){u<=0&&(u=30);const d=a.tracks.length,m=n/u;for(let A=0;A<d;++A){const y=a.tracks[A],k=y.ValueTypeName;if(k==="bool"||k==="string")continue;const N=x.tracks.find(function(ye){return ye.name===y.name&&ye.ValueTypeName===k});if(N===void 0)continue;let K=0;const $=y.getValueSize();y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(K=$/3);let j=0;const ne=N.getValueSize();N.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(j=ne/3);const le=y.times.length-1;let se;if(m<=y.times[0]){const ye=K,Be=$-K;se=zl(y.values,ye,Be)}else if(m>=y.times[le]){const ye=le*$+K,Be=ye+$-K;se=zl(y.values,ye,Be)}else{const ye=y.createInterpolant(),Be=K,Ee=$-K;ye.evaluate(m),se=zl(ye.resultBuffer,Be,Ee)}k==="quaternion"&&new la().fromArray(se).normalize().conjugate().toArray(se);const re=N.times.length;for(let ye=0;ye<re;++ye){const Be=ye*ne+j;if(k==="quaternion")la.multiplyQuaternionsFlat(N.values,Be,se,0,N.values,Be);else{const Ee=ne-j*2;for(let Me=0;Me<Ee;++Me)N.values[Be+Me]-=se[Me]}}}return x.blendMode=br,x}var q2=Object.freeze({__proto__:null,arraySlice:zl,convertArray:Hu,isTypedArray:O0,getKeyframeOrder:G0,sortedArray:U0,flattenJSON:V0,subclip:Y2,makeClipAdditive:J2});class Vp{constructor(n,a,u,d){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=d!==void 0?d:new a.constructor(u),this.sampleValues=a,this.valueSize=u,this.settings=null,this.DefaultSettings_={}}evaluate(n){const a=this.parameterPositions;let u=this._cachedIndex,d=a[u],m=a[u-1];e:{t:{let A;n:{i:if(!(n<d)){for(let y=u+2;;){if(d===void 0){if(n<m)break i;return u=a.length,this._cachedIndex=u,this.copySampleValue_(u-1)}if(u===y)break;if(m=d,d=a[++u],n<d)break t}A=a.length;break n}if(!(n>=m)){const y=a[1];n<y&&(u=2,m=y);for(let k=u-2;;){if(m===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(u===k)break;if(d=m,m=a[--u-1],n>=m)break t}A=u,u=0;break n}break e}for(;u<A;){const y=u+A>>>1;n<a[y]?A=y:u=y+1}if(d=a[u],m=a[u-1],m===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===void 0)return u=a.length,this._cachedIndex=u,this.copySampleValue_(u-1)}this._cachedIndex=u,this.intervalChanged_(u,m,d)}return this.interpolate_(u,m,n,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const a=this.resultBuffer,u=this.sampleValues,d=this.valueSize,m=n*d;for(let A=0;A!==d;++A)a[A]=u[m+A];return a}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Fv extends Vp{constructor(n,a,u,d){super(n,a,u,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Bn,endingEnd:Bn}}intervalChanged_(n,a,u){const d=this.parameterPositions;let m=n-2,A=n+1,y=d[m],k=d[A];if(y===void 0)switch(this.getSettings_().endingStart){case fi:m=n,y=2*a-u;break;case Ii:m=d.length-2,y=a+d[m]-d[m+1];break;default:m=n,y=u}if(k===void 0)switch(this.getSettings_().endingEnd){case fi:A=n,k=2*u-a;break;case Ii:A=1,k=u+d[1]-d[0];break;default:A=n-1,k=a}const N=(u-a)*.5,K=this.valueSize;this._weightPrev=N/(a-y),this._weightNext=N/(k-u),this._offsetPrev=m*K,this._offsetNext=A*K}interpolate_(n,a,u,d){const m=this.resultBuffer,A=this.sampleValues,y=this.valueSize,k=n*y,N=k-y,K=this._offsetPrev,$=this._offsetNext,j=this._weightPrev,ne=this._weightNext,le=(u-a)/(d-a),se=le*le,re=se*le,ye=-j*re+2*j*se-j*le,Be=(1+j)*re+(-1.5-2*j)*se+(-.5+j)*le+1,Ee=(-1-ne)*re+(1.5+ne)*se+.5*le,Me=ne*re-ne*se;for(let Fe=0;Fe!==y;++Fe)m[Fe]=ye*A[K+Fe]+Be*A[N+Fe]+Ee*A[k+Fe]+Me*A[$+Fe];return m}}class z0 extends Vp{constructor(n,a,u,d){super(n,a,u,d)}interpolate_(n,a,u,d){const m=this.resultBuffer,A=this.sampleValues,y=this.valueSize,k=n*y,N=k-y,K=(u-a)/(d-a),$=1-K;for(let j=0;j!==y;++j)m[j]=A[N+j]*$+A[k+j]*K;return m}}class Pv extends Vp{constructor(n,a,u,d){super(n,a,u,d)}interpolate_(n){return this.copySampleValue_(n-1)}}class lc{constructor(n,a,u,d){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(a===void 0||a.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=Hu(a,this.TimeBufferType),this.values=Hu(u,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(n){const a=n.constructor;let u;if(a.toJSON!==this.toJSON)u=a.toJSON(n);else{u={name:n.name,times:Hu(n.times,Array),values:Hu(n.values,Array)};const d=n.getInterpolation();d!==n.DefaultInterpolation&&(u.interpolation=d)}return u.type=n.ValueTypeName,u}InterpolantFactoryMethodDiscrete(n){return new Pv(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new z0(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new Fv(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let a;switch(n){case vn:a=this.InterpolantFactoryMethodDiscrete;break;case Lt:a=this.InterpolantFactoryMethodLinear;break;case rn:a=this.InterpolantFactoryMethodSmooth;break}if(a===void 0){const u="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(u);return console.warn("THREE.KeyframeTrack:",u),this}return this.createInterpolant=a,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return vn;case this.InterpolantFactoryMethodLinear:return Lt;case this.InterpolantFactoryMethodSmooth:return rn}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const a=this.times;for(let u=0,d=a.length;u!==d;++u)a[u]+=n}return this}scale(n){if(n!==1){const a=this.times;for(let u=0,d=a.length;u!==d;++u)a[u]*=n}return this}trim(n,a){const u=this.times,d=u.length;let m=0,A=d-1;for(;m!==d&&u[m]<n;)++m;for(;A!==-1&&u[A]>a;)--A;if(++A,m!==0||A!==d){m>=A&&(A=Math.max(A,1),m=A-1);const y=this.getValueSize();this.times=zl(u,m,A),this.values=zl(this.values,m*y,A*y)}return this}validate(){let n=!0;const a=this.getValueSize();a-Math.floor(a)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const u=this.times,d=this.values,m=u.length;m===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let A=null;for(let y=0;y!==m;y++){const k=u[y];if(typeof k=="number"&&isNaN(k)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,y,k),n=!1;break}if(A!==null&&A>k){console.error("THREE.KeyframeTrack: Out of order keys.",this,y,k,A),n=!1;break}A=k}if(d!==void 0&&O0(d))for(let y=0,k=d.length;y!==k;++y){const N=d[y];if(isNaN(N)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,y,N),n=!1;break}}return n}optimize(){const n=zl(this.times),a=zl(this.values),u=this.getValueSize(),d=this.getInterpolation()===rn,m=n.length-1;let A=1;for(let y=1;y<m;++y){let k=!1;const N=n[y],K=n[y+1];if(N!==K&&(y!==1||N!==n[0]))if(d)k=!0;else{const $=y*u,j=$-u,ne=$+u;for(let le=0;le!==u;++le){const se=a[$+le];if(se!==a[j+le]||se!==a[ne+le]){k=!0;break}}}if(k){if(y!==A){n[A]=n[y];const $=y*u,j=A*u;for(let ne=0;ne!==u;++ne)a[j+ne]=a[$+ne]}++A}}if(m>0){n[A]=n[m];for(let y=m*u,k=A*u,N=0;N!==u;++N)a[k+N]=a[y+N];++A}return A!==n.length?(this.times=zl(n,0,A),this.values=zl(a,0,A*u)):(this.times=n,this.values=a),this}clone(){const n=zl(this.times,0),a=zl(this.values,0),u=this.constructor,d=new u(this.name,n,a);return d.createInterpolant=this.createInterpolant,d}}lc.prototype.TimeBufferType=Float32Array,lc.prototype.ValueBufferType=Float32Array,lc.prototype.DefaultInterpolation=Lt;class Ku extends lc{}Ku.prototype.ValueTypeName="bool",Ku.prototype.ValueBufferType=Array,Ku.prototype.DefaultInterpolation=vn,Ku.prototype.InterpolantFactoryMethodLinear=void 0,Ku.prototype.InterpolantFactoryMethodSmooth=void 0;class W0 extends lc{}W0.prototype.ValueTypeName="color";class Xu extends lc{}Xu.prototype.ValueTypeName="number";class Ov extends Vp{constructor(n,a,u,d){super(n,a,u,d)}interpolate_(n,a,u,d){const m=this.resultBuffer,A=this.sampleValues,y=this.valueSize,k=(u-a)/(d-a);let N=n*y;for(let K=N+y;N!==K;N+=4)la.slerpFlat(m,0,A,N-y,A,N,k);return m}}class wl extends lc{InterpolantFactoryMethodLinear(n){return new Ov(this.times,this.values,this.getValueSize(),n)}}wl.prototype.ValueTypeName="quaternion",wl.prototype.DefaultInterpolation=Lt,wl.prototype.InterpolantFactoryMethodSmooth=void 0;class ru extends lc{}ru.prototype.ValueTypeName="string",ru.prototype.ValueBufferType=Array,ru.prototype.DefaultInterpolation=vn,ru.prototype.InterpolantFactoryMethodLinear=void 0,ru.prototype.InterpolantFactoryMethodSmooth=void 0;class Wh extends lc{}Wh.prototype.ValueTypeName="vector";class Hh{constructor(n,a=-1,u,d=Vi){this.name=n,this.tracks=u,this.duration=a,this.blendMode=d,this.uuid=Za(),this.duration<0&&this.resetDuration()}static parse(n){const a=[],u=n.tracks,d=1/(n.fps||1);for(let A=0,y=u.length;A!==y;++A)a.push(Rm(u[A]).scale(d));const m=new this(n.name,n.duration,a,n.blendMode);return m.uuid=n.uuid,m}static toJSON(n){const a=[],u=n.tracks,d={name:n.name,duration:n.duration,tracks:a,uuid:n.uuid,blendMode:n.blendMode};for(let m=0,A=u.length;m!==A;++m)a.push(lc.toJSON(u[m]));return d}static CreateFromMorphTargetSequence(n,a,u,d){const m=a.length,A=[];for(let y=0;y<m;y++){let k=[],N=[];k.push((y+m-1)%m,y,(y+1)%m),N.push(0,1,0);const K=G0(k);k=U0(k,1,K),N=U0(N,1,K),!d&&k[0]===0&&(k.push(m),N.push(N[0])),A.push(new Xu(".morphTargetInfluences["+a[y].name+"]",k,N).scale(1/u))}return new this(n,-1,A)}static findByName(n,a){let u=n;if(!Array.isArray(n)){const d=n;u=d.geometry&&d.geometry.animations||d.animations}for(let d=0;d<u.length;d++)if(u[d].name===a)return u[d];return null}static CreateClipsFromMorphTargetSequences(n,a,u){const d={},m=/^([\w-]*?)([\d]+)$/;for(let y=0,k=n.length;y<k;y++){const N=n[y],K=N.name.match(m);if(K&&K.length>1){const $=K[1];let j=d[$];j||(d[$]=j=[]),j.push(N)}}const A=[];for(const y in d)A.push(this.CreateFromMorphTargetSequence(y,d[y],a,u));return A}static parseAnimation(n,a){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const u=function($,j,ne,le,se){if(ne.length!==0){const re=[],ye=[];V0(ne,re,ye,le),re.length!==0&&se.push(new $(j,re,ye))}},d=[],m=n.name||"default",A=n.fps||30,y=n.blendMode;let k=n.length||-1;const N=n.hierarchy||[];for(let $=0;$<N.length;$++){const j=N[$].keys;if(!(!j||j.length===0))if(j[0].morphTargets){const ne={};let le;for(le=0;le<j.length;le++)if(j[le].morphTargets)for(let se=0;se<j[le].morphTargets.length;se++)ne[j[le].morphTargets[se]]=-1;for(const se in ne){const re=[],ye=[];for(let Be=0;Be!==j[le].morphTargets.length;++Be){const Ee=j[le];re.push(Ee.time),ye.push(Ee.morphTarget===se?1:0)}d.push(new Xu(".morphTargetInfluence["+se+"]",re,ye))}k=ne.length*A}else{const ne=".bones["+a[$].name+"]";u(Wh,ne+".position",j,"pos",d),u(wl,ne+".quaternion",j,"rot",d),u(Wh,ne+".scale",j,"scl",d)}}return d.length===0?null:new this(m,k,d,y)}resetDuration(){const n=this.tracks;let a=0;for(let u=0,d=n.length;u!==d;++u){const m=this.tracks[u];a=Math.max(a,m.times[m.times.length-1])}return this.duration=a,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let a=0;a<this.tracks.length;a++)n=n&&this.tracks[a].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let a=0;a<this.tracks.length;a++)n.push(this.tracks[a].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function H0(x){switch(x.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xu;case"vector":case"vector2":case"vector3":case"vector4":return Wh;case"color":return W0;case"quaternion":return wl;case"bool":case"boolean":return Ku;case"string":return ru}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+x)}function Rm(x){if(x.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=H0(x.type);if(x.times===void 0){const a=[],u=[];V0(x.keys,a,u,"value"),x.times=a,x.values=u}return n.parse!==void 0?n.parse(x):new n(x.name,x.times,x.values,x.interpolation)}const su={enabled:!1,files:{},add:function(x,n){this.enabled!==!1&&(this.files[x]=n)},get:function(x){if(this.enabled!==!1)return this.files[x]},remove:function(x){delete this.files[x]},clear:function(){this.files={}}};class zp{constructor(n,a,u){const d=this;let m=!1,A=0,y=0,k;const N=[];this.onStart=void 0,this.onLoad=n,this.onProgress=a,this.onError=u,this.itemStart=function(K){y++,m===!1&&d.onStart!==void 0&&d.onStart(K,A,y),m=!0},this.itemEnd=function(K){A++,d.onProgress!==void 0&&d.onProgress(K,A,y),A===y&&(m=!1,d.onLoad!==void 0&&d.onLoad())},this.itemError=function(K){d.onError!==void 0&&d.onError(K)},this.resolveURL=function(K){return k?k(K):K},this.setURLModifier=function(K){return k=K,this},this.addHandler=function(K,$){return N.push(K,$),this},this.removeHandler=function(K){const $=N.indexOf(K);return $!==-1&&N.splice($,2),this},this.getHandler=function(K){for(let $=0,j=N.length;$<j;$+=2){const ne=N[$],le=N[$+1];if(ne.global&&(ne.lastIndex=0),ne.test(K))return le}return null}}}const Qu=new zp;class uo{constructor(n){this.manager=n!==void 0?n:Qu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,a){const u=this;return new Promise(function(d,m){u.load(n,d,a,m)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}}const au={};class Bm extends Error{constructor(n,a){super(n),this.response=a}}class cc extends uo{constructor(n){super(n)}load(n,a,u,d){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const m=su.get(n);if(m!==void 0)return this.manager.itemStart(n),setTimeout(()=>{a&&a(m),this.manager.itemEnd(n)},0),m;if(au[n]!==void 0){au[n].push({onLoad:a,onProgress:u,onError:d});return}au[n]=[],au[n].push({onLoad:a,onProgress:u,onError:d});const A=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),y=this.mimeType,k=this.responseType;fetch(A).then(N=>{if(N.status===200||N.status===0){if(N.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||N.body===void 0||N.body.getReader===void 0)return N;const K=au[n],$=N.body.getReader(),j=N.headers.get("Content-Length")||N.headers.get("X-File-Size"),ne=j?parseInt(j):0,le=ne!==0;let se=0;const re=new ReadableStream({start(ye){Be();function Be(){$.read().then(({done:Ee,value:Me})=>{if(Ee)ye.close();else{se+=Me.byteLength;const Fe=new ProgressEvent("progress",{lengthComputable:le,loaded:se,total:ne});for(let it=0,yt=K.length;it<yt;it++){const Le=K[it];Le.onProgress&&Le.onProgress(Fe)}ye.enqueue(Me),Be()}})}}});return new Response(re)}else throw new Bm(`fetch for "${N.url}" responded with ${N.status}: ${N.statusText}`,N)}).then(N=>{switch(k){case"arraybuffer":return N.arrayBuffer();case"blob":return N.blob();case"document":return N.text().then(K=>new DOMParser().parseFromString(K,y));case"json":return N.json();default:if(y===void 0)return N.text();{const $=/charset="?([^;"\s]*)"?/i.exec(y),j=$&&$[1]?$[1].toLowerCase():void 0,ne=new TextDecoder(j);return N.arrayBuffer().then(le=>ne.decode(le))}}}).then(N=>{su.add(n,N);const K=au[n];delete au[n];for(let $=0,j=K.length;$<j;$++){const ne=K[$];ne.onLoad&&ne.onLoad(N)}}).catch(N=>{const K=au[n];if(K===void 0)throw this.manager.itemError(n),N;delete au[n];for(let $=0,j=K.length;$<j;$++){const ne=K[$];ne.onError&&ne.onError(N)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}}class Tc extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=new cc(this.manager);A.setPath(this.path),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(n,function(y){try{a(m.parse(JSON.parse(y)))}catch(k){d?d(k):console.error(k),m.manager.itemError(n)}},u,d)}parse(n){const a=[];for(let u=0;u<n.length;u++){const d=Hh.parse(n[u]);a.push(d)}return a}}class Wl extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=[],y=new vm,k=new cc(this.manager);k.setPath(this.path),k.setResponseType("arraybuffer"),k.setRequestHeader(this.requestHeader),k.setWithCredentials(m.withCredentials);let N=0;function K($){k.load(n[$],function(j){const ne=m.parse(j,!0);A[$]={width:ne.width,height:ne.height,format:ne.format,mipmaps:ne.mipmaps},N+=1,N===6&&(ne.mipmapCount===1&&(y.minFilter=ft),y.image=A,y.format=ne.format,y.needsUpdate=!0,a&&a(y))},u,d)}if(Array.isArray(n))for(let $=0,j=n.length;$<j;++$)K($);else k.load(n,function($){const j=m.parse($,!0);if(j.isCubemap){const ne=j.mipmaps.length/j.mipmapCount;for(let le=0;le<ne;le++){A[le]={mipmaps:[]};for(let se=0;se<j.mipmapCount;se++)A[le].mipmaps.push(j.mipmaps[le*j.mipmapCount+se]),A[le].format=j.format,A[le].width=j.width,A[le].height=j.height}y.image=A}else y.image.width=j.width,y.image.height=j.height,y.mipmaps=j.mipmaps;j.mipmapCount===1&&(y.minFilter=ft),y.format=j.format,y.needsUpdate=!0,a&&a(y)},u,d);return y}}class Kh extends uo{constructor(n){super(n)}load(n,a,u,d){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const m=this,A=su.get(n);if(A!==void 0)return m.manager.itemStart(n),setTimeout(function(){a&&a(A),m.manager.itemEnd(n)},0),A;const y=ql("img");function k(){K(),su.add(n,this),a&&a(this),m.manager.itemEnd(n)}function N($){K(),d&&d($),m.manager.itemError(n),m.manager.itemEnd(n)}function K(){y.removeEventListener("load",k,!1),y.removeEventListener("error",N,!1)}return y.addEventListener("load",k,!1),y.addEventListener("error",N,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(y.crossOrigin=this.crossOrigin),m.manager.itemStart(n),y.src=n,y}}class K0 extends uo{constructor(n){super(n)}load(n,a,u,d){const m=new rc,A=new Kh(this.manager);A.setCrossOrigin(this.crossOrigin),A.setPath(this.path);let y=0;function k(N){A.load(n[N],function(K){m.images[N]=K,y++,y===6&&(m.needsUpdate=!0,a&&a(m))},void 0,d)}for(let N=0;N<n.length;++N)k(N);return m}}class X0 extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=new Gu,y=new cc(this.manager);return y.setResponseType("arraybuffer"),y.setRequestHeader(this.requestHeader),y.setPath(this.path),y.setWithCredentials(m.withCredentials),y.load(n,function(k){const N=m.parse(k);N&&(N.image!==void 0?A.image=N.image:N.data!==void 0&&(A.image.width=N.width,A.image.height=N.height,A.image.data=N.data),A.wrapS=N.wrapS!==void 0?N.wrapS:Ct,A.wrapT=N.wrapT!==void 0?N.wrapT:Ct,A.magFilter=N.magFilter!==void 0?N.magFilter:ft,A.minFilter=N.minFilter!==void 0?N.minFilter:ft,A.anisotropy=N.anisotropy!==void 0?N.anisotropy:1,N.encoding!==void 0&&(A.encoding=N.encoding),N.flipY!==void 0&&(A.flipY=N.flipY),N.format!==void 0&&(A.format=N.format),N.type!==void 0&&(A.type=N.type),N.mipmaps!==void 0&&(A.mipmaps=N.mipmaps,A.minFilter=bi),N.mipmapCount===1&&(A.minFilter=ft),N.generateMipmaps!==void 0&&(A.generateMipmaps=N.generateMipmaps),A.needsUpdate=!0,a&&a(A,N))},u,d),A}}class Q0 extends uo{constructor(n){super(n)}load(n,a,u,d){const m=new Ws,A=new Kh(this.manager);return A.setCrossOrigin(this.crossOrigin),A.setPath(this.path),A.load(n,function(y){m.image=y,m.needsUpdate=!0,a!==void 0&&a(m)},u,d),m}}class Mc extends as{constructor(n,a=1){super(),this.isLight=!0,this.type="Light",this.color=new Si(n),this.intensity=a}dispose(){}copy(n,a){return super.copy(n,a),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const a=super.toJSON(n);return a.object.color=this.color.getHex(),a.object.intensity=this.intensity,this.groundColor!==void 0&&(a.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(a.object.distance=this.distance),this.angle!==void 0&&(a.object.angle=this.angle),this.decay!==void 0&&(a.object.decay=this.decay),this.penumbra!==void 0&&(a.object.penumbra=this.penumbra),this.shadow!==void 0&&(a.object.shadow=this.shadow.toJSON()),a}}class Wp extends Mc{constructor(n,a,u){super(n,u),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.groundColor=new Si(a)}copy(n,a){return super.copy(n,a),this.groundColor.copy(n.groundColor),this}}const Hp=new Ri,Kd=new tt,Xd=new tt;class Xh{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new kn(512,512),this.map=null,this.mapPass=null,this.matrix=new Ri,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Pf,this._frameExtents=new kn(1,1),this._viewportCount=1,this._viewports=[new es(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const a=this.camera,u=this.matrix;Kd.setFromMatrixPosition(n.matrixWorld),a.position.copy(Kd),Xd.setFromMatrixPosition(n.target.matrixWorld),a.lookAt(Xd),a.updateMatrixWorld(),Hp.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hp),u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(Hp)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}}class Z0 extends Xh{constructor(){super(new qs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const a=this.camera,u=Jl*2*n.angle*this.focus,d=this.mapSize.width/this.mapSize.height,m=n.distance||a.far;(u!==a.fov||d!==a.aspect||m!==a.far)&&(a.fov=u,a.aspect=d,a.far=m,a.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}}class km extends Mc{constructor(n,a,u=0,d=Math.PI/3,m=0,A=2){super(n,a),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.target=new as,this.distance=u,this.angle=d,this.penumbra=m,this.decay=A,this.map=null,this.shadow=new Z0}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,a){return super.copy(n,a),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}const Kp=new Ri,Zu=new tt,Xp=new tt;class $0 extends Xh{constructor(){super(new qs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new kn(4,2),this._viewportCount=6,this._viewports=[new es(2,1,1,1),new es(0,1,1,1),new es(3,1,1,1),new es(1,1,1,1),new es(3,0,1,1),new es(1,0,1,1)],this._cubeDirections=[new tt(1,0,0),new tt(-1,0,0),new tt(0,0,1),new tt(0,0,-1),new tt(0,1,0),new tt(0,-1,0)],this._cubeUps=[new tt(0,1,0),new tt(0,1,0),new tt(0,1,0),new tt(0,1,0),new tt(0,0,1),new tt(0,0,-1)]}updateMatrices(n,a=0){const u=this.camera,d=this.matrix,m=n.distance||u.far;m!==u.far&&(u.far=m,u.updateProjectionMatrix()),Zu.setFromMatrixPosition(n.matrixWorld),u.position.copy(Zu),Xp.copy(u.position),Xp.add(this._cubeDirections[a]),u.up.copy(this._cubeUps[a]),u.lookAt(Xp),u.updateMatrixWorld(),d.makeTranslation(-Zu.x,-Zu.y,-Zu.z),Kp.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kp)}}class Lm extends Mc{constructor(n,a,u=0,d=2){super(n,a),this.isPointLight=!0,this.type="PointLight",this.distance=u,this.decay=d,this.shadow=new $0}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,a){return super.copy(n,a),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}}class j0 extends Xh{constructor(){super(new Kf(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Dm extends Mc{constructor(n,a){super(n,a),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.target=new as,this.shadow=new j0}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}class Nm extends Mc{constructor(n,a){super(n,a),this.isAmbientLight=!0,this.type="AmbientLight"}}class _c extends Mc{constructor(n,a,u=10,d=10){super(n,a),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=u,this.height=d}get power(){return this.intensity*this.width*this.height*Math.PI}set power(n){this.intensity=n/(this.width*this.height*Math.PI)}copy(n){return super.copy(n),this.width=n.width,this.height=n.height,this}toJSON(n){const a=super.toJSON(n);return a.object.width=this.width,a.object.height=this.height,a}}class Y0{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let n=0;n<9;n++)this.coefficients.push(new tt)}set(n){for(let a=0;a<9;a++)this.coefficients[a].copy(n[a]);return this}zero(){for(let n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this}getAt(n,a){const u=n.x,d=n.y,m=n.z,A=this.coefficients;return a.copy(A[0]).multiplyScalar(.282095),a.addScaledVector(A[1],.488603*d),a.addScaledVector(A[2],.488603*m),a.addScaledVector(A[3],.488603*u),a.addScaledVector(A[4],1.092548*(u*d)),a.addScaledVector(A[5],1.092548*(d*m)),a.addScaledVector(A[6],.315392*(3*m*m-1)),a.addScaledVector(A[7],1.092548*(u*m)),a.addScaledVector(A[8],.546274*(u*u-d*d)),a}getIrradianceAt(n,a){const u=n.x,d=n.y,m=n.z,A=this.coefficients;return a.copy(A[0]).multiplyScalar(.886227),a.addScaledVector(A[1],1.023328*d),a.addScaledVector(A[2],1.023328*m),a.addScaledVector(A[3],1.023328*u),a.addScaledVector(A[4],.858086*u*d),a.addScaledVector(A[5],.858086*d*m),a.addScaledVector(A[6],.743125*m*m-.247708),a.addScaledVector(A[7],.858086*u*m),a.addScaledVector(A[8],.429043*(u*u-d*d)),a}add(n){for(let a=0;a<9;a++)this.coefficients[a].add(n.coefficients[a]);return this}addScaledSH(n,a){for(let u=0;u<9;u++)this.coefficients[u].addScaledVector(n.coefficients[u],a);return this}scale(n){for(let a=0;a<9;a++)this.coefficients[a].multiplyScalar(n);return this}lerp(n,a){for(let u=0;u<9;u++)this.coefficients[u].lerp(n.coefficients[u],a);return this}equals(n){for(let a=0;a<9;a++)if(!this.coefficients[a].equals(n.coefficients[a]))return!1;return!0}copy(n){return this.set(n.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(n,a=0){const u=this.coefficients;for(let d=0;d<9;d++)u[d].fromArray(n,a+d*3);return this}toArray(n=[],a=0){const u=this.coefficients;for(let d=0;d<9;d++)u[d].toArray(n,a+d*3);return n}static getBasisAt(n,a){const u=n.x,d=n.y,m=n.z;a[0]=.282095,a[1]=.488603*d,a[2]=.488603*m,a[3]=.488603*u,a[4]=1.092548*u*d,a[5]=1.092548*d*m,a[6]=.315392*(3*m*m-1),a[7]=1.092548*u*m,a[8]=.546274*(u*u-d*d)}}class Qp extends Mc{constructor(n=new Y0,a=1){super(void 0,a),this.isLightProbe=!0,this.sh=n}copy(n){return super.copy(n),this.sh.copy(n.sh),this}fromJSON(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this}toJSON(n){const a=super.toJSON(n);return a.object.sh=this.sh.toArray(),a}}class Zp extends uo{constructor(n){super(n),this.textures={}}load(n,a,u,d){const m=this,A=new cc(m.manager);A.setPath(m.path),A.setRequestHeader(m.requestHeader),A.setWithCredentials(m.withCredentials),A.load(n,function(y){try{a(m.parse(JSON.parse(y)))}catch(k){d?d(k):console.error(k),m.manager.itemError(n)}},u,d)}parse(n){const a=this.textures;function u(m){return a[m]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",m),a[m]}const d=Zp.createMaterialFromType(n.type);if(n.uuid!==void 0&&(d.uuid=n.uuid),n.name!==void 0&&(d.name=n.name),n.color!==void 0&&d.color!==void 0&&d.color.setHex(n.color),n.roughness!==void 0&&(d.roughness=n.roughness),n.metalness!==void 0&&(d.metalness=n.metalness),n.sheen!==void 0&&(d.sheen=n.sheen),n.sheenColor!==void 0&&(d.sheenColor=new Si().setHex(n.sheenColor)),n.sheenRoughness!==void 0&&(d.sheenRoughness=n.sheenRoughness),n.emissive!==void 0&&d.emissive!==void 0&&d.emissive.setHex(n.emissive),n.specular!==void 0&&d.specular!==void 0&&d.specular.setHex(n.specular),n.specularIntensity!==void 0&&(d.specularIntensity=n.specularIntensity),n.specularColor!==void 0&&d.specularColor!==void 0&&d.specularColor.setHex(n.specularColor),n.shininess!==void 0&&(d.shininess=n.shininess),n.clearcoat!==void 0&&(d.clearcoat=n.clearcoat),n.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=n.clearcoatRoughness),n.iridescence!==void 0&&(d.iridescence=n.iridescence),n.iridescenceIOR!==void 0&&(d.iridescenceIOR=n.iridescenceIOR),n.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=n.iridescenceThicknessRange),n.transmission!==void 0&&(d.transmission=n.transmission),n.thickness!==void 0&&(d.thickness=n.thickness),n.attenuationDistance!==void 0&&(d.attenuationDistance=n.attenuationDistance),n.attenuationColor!==void 0&&d.attenuationColor!==void 0&&d.attenuationColor.setHex(n.attenuationColor),n.fog!==void 0&&(d.fog=n.fog),n.flatShading!==void 0&&(d.flatShading=n.flatShading),n.blending!==void 0&&(d.blending=n.blending),n.combine!==void 0&&(d.combine=n.combine),n.side!==void 0&&(d.side=n.side),n.shadowSide!==void 0&&(d.shadowSide=n.shadowSide),n.opacity!==void 0&&(d.opacity=n.opacity),n.transparent!==void 0&&(d.transparent=n.transparent),n.alphaTest!==void 0&&(d.alphaTest=n.alphaTest),n.depthTest!==void 0&&(d.depthTest=n.depthTest),n.depthWrite!==void 0&&(d.depthWrite=n.depthWrite),n.colorWrite!==void 0&&(d.colorWrite=n.colorWrite),n.stencilWrite!==void 0&&(d.stencilWrite=n.stencilWrite),n.stencilWriteMask!==void 0&&(d.stencilWriteMask=n.stencilWriteMask),n.stencilFunc!==void 0&&(d.stencilFunc=n.stencilFunc),n.stencilRef!==void 0&&(d.stencilRef=n.stencilRef),n.stencilFuncMask!==void 0&&(d.stencilFuncMask=n.stencilFuncMask),n.stencilFail!==void 0&&(d.stencilFail=n.stencilFail),n.stencilZFail!==void 0&&(d.stencilZFail=n.stencilZFail),n.stencilZPass!==void 0&&(d.stencilZPass=n.stencilZPass),n.wireframe!==void 0&&(d.wireframe=n.wireframe),n.wireframeLinewidth!==void 0&&(d.wireframeLinewidth=n.wireframeLinewidth),n.wireframeLinecap!==void 0&&(d.wireframeLinecap=n.wireframeLinecap),n.wireframeLinejoin!==void 0&&(d.wireframeLinejoin=n.wireframeLinejoin),n.rotation!==void 0&&(d.rotation=n.rotation),n.linewidth!==1&&(d.linewidth=n.linewidth),n.dashSize!==void 0&&(d.dashSize=n.dashSize),n.gapSize!==void 0&&(d.gapSize=n.gapSize),n.scale!==void 0&&(d.scale=n.scale),n.polygonOffset!==void 0&&(d.polygonOffset=n.polygonOffset),n.polygonOffsetFactor!==void 0&&(d.polygonOffsetFactor=n.polygonOffsetFactor),n.polygonOffsetUnits!==void 0&&(d.polygonOffsetUnits=n.polygonOffsetUnits),n.dithering!==void 0&&(d.dithering=n.dithering),n.alphaToCoverage!==void 0&&(d.alphaToCoverage=n.alphaToCoverage),n.premultipliedAlpha!==void 0&&(d.premultipliedAlpha=n.premultipliedAlpha),n.visible!==void 0&&(d.visible=n.visible),n.toneMapped!==void 0&&(d.toneMapped=n.toneMapped),n.userData!==void 0&&(d.userData=n.userData),n.vertexColors!==void 0&&(typeof n.vertexColors=="number"?d.vertexColors=n.vertexColors>0:d.vertexColors=n.vertexColors),n.uniforms!==void 0)for(const m in n.uniforms){const A=n.uniforms[m];switch(d.uniforms[m]={},A.type){case"t":d.uniforms[m].value=u(A.value);break;case"c":d.uniforms[m].value=new Si().setHex(A.value);break;case"v2":d.uniforms[m].value=new kn().fromArray(A.value);break;case"v3":d.uniforms[m].value=new tt().fromArray(A.value);break;case"v4":d.uniforms[m].value=new es().fromArray(A.value);break;case"m3":d.uniforms[m].value=new ro().fromArray(A.value);break;case"m4":d.uniforms[m].value=new Ri().fromArray(A.value);break;default:d.uniforms[m].value=A.value}}if(n.defines!==void 0&&(d.defines=n.defines),n.vertexShader!==void 0&&(d.vertexShader=n.vertexShader),n.fragmentShader!==void 0&&(d.fragmentShader=n.fragmentShader),n.glslVersion!==void 0&&(d.glslVersion=n.glslVersion),n.extensions!==void 0)for(const m in n.extensions)d.extensions[m]=n.extensions[m];if(n.size!==void 0&&(d.size=n.size),n.sizeAttenuation!==void 0&&(d.sizeAttenuation=n.sizeAttenuation),n.map!==void 0&&(d.map=u(n.map)),n.matcap!==void 0&&(d.matcap=u(n.matcap)),n.alphaMap!==void 0&&(d.alphaMap=u(n.alphaMap)),n.bumpMap!==void 0&&(d.bumpMap=u(n.bumpMap)),n.bumpScale!==void 0&&(d.bumpScale=n.bumpScale),n.normalMap!==void 0&&(d.normalMap=u(n.normalMap)),n.normalMapType!==void 0&&(d.normalMapType=n.normalMapType),n.normalScale!==void 0){let m=n.normalScale;Array.isArray(m)===!1&&(m=[m,m]),d.normalScale=new kn().fromArray(m)}return n.displacementMap!==void 0&&(d.displacementMap=u(n.displacementMap)),n.displacementScale!==void 0&&(d.displacementScale=n.displacementScale),n.displacementBias!==void 0&&(d.displacementBias=n.displacementBias),n.roughnessMap!==void 0&&(d.roughnessMap=u(n.roughnessMap)),n.metalnessMap!==void 0&&(d.metalnessMap=u(n.metalnessMap)),n.emissiveMap!==void 0&&(d.emissiveMap=u(n.emissiveMap)),n.emissiveIntensity!==void 0&&(d.emissiveIntensity=n.emissiveIntensity),n.specularMap!==void 0&&(d.specularMap=u(n.specularMap)),n.specularIntensityMap!==void 0&&(d.specularIntensityMap=u(n.specularIntensityMap)),n.specularColorMap!==void 0&&(d.specularColorMap=u(n.specularColorMap)),n.envMap!==void 0&&(d.envMap=u(n.envMap)),n.envMapIntensity!==void 0&&(d.envMapIntensity=n.envMapIntensity),n.reflectivity!==void 0&&(d.reflectivity=n.reflectivity),n.refractionRatio!==void 0&&(d.refractionRatio=n.refractionRatio),n.lightMap!==void 0&&(d.lightMap=u(n.lightMap)),n.lightMapIntensity!==void 0&&(d.lightMapIntensity=n.lightMapIntensity),n.aoMap!==void 0&&(d.aoMap=u(n.aoMap)),n.aoMapIntensity!==void 0&&(d.aoMapIntensity=n.aoMapIntensity),n.gradientMap!==void 0&&(d.gradientMap=u(n.gradientMap)),n.clearcoatMap!==void 0&&(d.clearcoatMap=u(n.clearcoatMap)),n.clearcoatRoughnessMap!==void 0&&(d.clearcoatRoughnessMap=u(n.clearcoatRoughnessMap)),n.clearcoatNormalMap!==void 0&&(d.clearcoatNormalMap=u(n.clearcoatNormalMap)),n.clearcoatNormalScale!==void 0&&(d.clearcoatNormalScale=new kn().fromArray(n.clearcoatNormalScale)),n.iridescenceMap!==void 0&&(d.iridescenceMap=u(n.iridescenceMap)),n.iridescenceThicknessMap!==void 0&&(d.iridescenceThicknessMap=u(n.iridescenceThicknessMap)),n.transmissionMap!==void 0&&(d.transmissionMap=u(n.transmissionMap)),n.thicknessMap!==void 0&&(d.thicknessMap=u(n.thicknessMap)),n.sheenColorMap!==void 0&&(d.sheenColorMap=u(n.sheenColorMap)),n.sheenRoughnessMap!==void 0&&(d.sheenRoughnessMap=u(n.sheenRoughnessMap)),d}setTextures(n){return this.textures=n,this}static createMaterialFromType(n){const a={ShadowMaterial:Tv,SpriteMaterial:m0,RawShaderMaterial:Mv,ShaderMaterial:Ol,PointsMaterial:C0,MeshPhysicalMaterial:_v,MeshStandardMaterial:P0,MeshPhongMaterial:Rv,MeshToonMaterial:Bv,MeshNormalMaterial:kv,MeshLambertMaterial:Lv,MeshDepthMaterial:em,MeshDistanceMaterial:u0,MeshBasicMaterial:_u,MeshMatcapMaterial:Dv,LineDashedMaterial:Nv,LineBasicMaterial:Fa,Material:Ba};return new a[n]}}class $p{static decodeText(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let a="";for(let u=0,d=n.length;u<d;u++)a+=String.fromCharCode(n[u]);try{return decodeURIComponent(escape(a))}catch{return a}}static extractUrlBase(n){const a=n.lastIndexOf("/");return a===-1?"./":n.slice(0,a+1)}static resolveURL(n,a){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(a)&&/^\//.test(n)&&(a=a.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:a+n)}}class J0 extends Or{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(n){return super.copy(n),this.instanceCount=n.instanceCount,this}toJSON(){const n=super.toJSON();return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}}class q0 extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=new cc(m.manager);A.setPath(m.path),A.setRequestHeader(m.requestHeader),A.setWithCredentials(m.withCredentials),A.load(n,function(y){try{a(m.parse(JSON.parse(y)))}catch(k){d?d(k):console.error(k),m.manager.itemError(n)}},u,d)}parse(n){const a={},u={};function d(ne,le){if(a[le]!==void 0)return a[le];const re=ne.interleavedBuffers[le],ye=m(ne,re.buffer),Be=Ll(re.type,ye),Ee=new rm(Be,re.stride);return Ee.uuid=re.uuid,a[le]=Ee,Ee}function m(ne,le){if(u[le]!==void 0)return u[le];const re=ne.arrayBuffers[le],ye=new Uint32Array(re).buffer;return u[le]=ye,ye}const A=n.isInstancedBufferGeometry?new J0:new Or,y=n.data.index;if(y!==void 0){const ne=Ll(y.type,y.array);A.setIndex(new Vt(ne,1))}const k=n.data.attributes;for(const ne in k){const le=k[ne];let se;if(le.isInterleavedBufferAttribute){const re=d(n.data,le.data);se=new Jc(re,le.itemSize,le.offset,le.normalized)}else{const re=Ll(le.type,le.array),ye=le.isInstancedBufferAttribute?Fd:Vt;se=new ye(re,le.itemSize,le.normalized)}le.name!==void 0&&(se.name=le.name),le.usage!==void 0&&se.setUsage(le.usage),le.updateRange!==void 0&&(se.updateRange.offset=le.updateRange.offset,se.updateRange.count=le.updateRange.count),A.setAttribute(ne,se)}const N=n.data.morphAttributes;if(N)for(const ne in N){const le=N[ne],se=[];for(let re=0,ye=le.length;re<ye;re++){const Be=le[re];let Ee;if(Be.isInterleavedBufferAttribute){const Me=d(n.data,Be.data);Ee=new Jc(Me,Be.itemSize,Be.offset,Be.normalized)}else{const Me=Ll(Be.type,Be.array);Ee=new Vt(Me,Be.itemSize,Be.normalized)}Be.name!==void 0&&(Ee.name=Be.name),se.push(Ee)}A.morphAttributes[ne]=se}n.data.morphTargetsRelative&&(A.morphTargetsRelative=!0);const $=n.data.groups||n.data.drawcalls||n.data.offsets;if($!==void 0)for(let ne=0,le=$.length;ne!==le;++ne){const se=$[ne];A.addGroup(se.start,se.count,se.materialIndex)}const j=n.data.boundingSphere;if(j!==void 0){const ne=new tt;j.center!==void 0&&ne.fromArray(j.center),A.boundingSphere=new To(ne,j.radius)}return n.name&&(A.name=n.name),n.userData&&(A.userData=n.userData),A}}class Gv extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=this.path===""?$p.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||A;const y=new cc(this.manager);y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials),y.load(n,function(k){let N=null;try{N=JSON.parse(k)}catch($){d!==void 0&&d($),console.error("THREE:ObjectLoader: Can't parse "+n+".",$.message);return}const K=N.metadata;if(K===void 0||K.type===void 0||K.type.toLowerCase()==="geometry"){d!==void 0&&d(new Error("THREE.ObjectLoader: Can't load "+n)),console.error("THREE.ObjectLoader: Can't load "+n);return}m.parse(N,a)},u,d)}async loadAsync(n,a){const u=this,d=this.path===""?$p.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||d;const m=new cc(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials);const A=await m.loadAsync(n,a),y=JSON.parse(A),k=y.metadata;if(k===void 0||k.type===void 0||k.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+n);return await u.parseAsync(y)}parse(n,a){const u=this.parseAnimations(n.animations),d=this.parseShapes(n.shapes),m=this.parseGeometries(n.geometries,d),A=this.parseImages(n.images,function(){a!==void 0&&a(N)}),y=this.parseTextures(n.textures,A),k=this.parseMaterials(n.materials,y),N=this.parseObject(n.object,m,k,y,u),K=this.parseSkeletons(n.skeletons,N);if(this.bindSkeletons(N,K),a!==void 0){let $=!1;for(const j in A)if(A[j].data instanceof HTMLImageElement){$=!0;break}$===!1&&a(N)}return N}async parseAsync(n){const a=this.parseAnimations(n.animations),u=this.parseShapes(n.shapes),d=this.parseGeometries(n.geometries,u),m=await this.parseImagesAsync(n.images),A=this.parseTextures(n.textures,m),y=this.parseMaterials(n.materials,A),k=this.parseObject(n.object,d,y,A,a),N=this.parseSkeletons(n.skeletons,k);return this.bindSkeletons(k,N),k}parseShapes(n){const a={};if(n!==void 0)for(let u=0,d=n.length;u<d;u++){const m=new iu().fromJSON(n[u]);a[m.uuid]=m}return a}parseSkeletons(n,a){const u={},d={};if(a.traverse(function(m){m.isBone&&(d[m.uuid]=m)}),n!==void 0)for(let m=0,A=n.length;m<A;m++){const y=new pm().fromJSON(n[m],d);u[y.uuid]=y}return u}parseGeometries(n,a){const u={};if(n!==void 0){const m=new q0;for(let A=0,y=n.length;A<y;A++){let k;const N=n[A];switch(N.type){case"BufferGeometry":case"InstancedBufferGeometry":k=m.parse(N);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var d=new THREE.LegacyJSONLoader;k=d.parse(N,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:N.type in F0?k=F0[N.type].fromJSON(N,a):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${N.type}"`)}k.uuid=N.uuid,N.name!==void 0&&(k.name=N.name),k.isBufferGeometry===!0&&N.userData!==void 0&&(k.userData=N.userData),u[N.uuid]=k}}return u}parseMaterials(n,a){const u={},d={};if(n!==void 0){const m=new Zp;m.setTextures(a);for(let A=0,y=n.length;A<y;A++){const k=n[A];u[k.uuid]===void 0&&(u[k.uuid]=m.parse(k)),d[k.uuid]=u[k.uuid]}}return d}parseAnimations(n){const a={};if(n!==void 0)for(let u=0;u<n.length;u++){const d=n[u],m=Hh.parse(d);a[m.uuid]=m}return a}parseImages(n,a){const u=this,d={};let m;function A(k){return u.manager.itemStart(k),m.load(k,function(){u.manager.itemEnd(k)},void 0,function(){u.manager.itemError(k),u.manager.itemEnd(k)})}function y(k){if(typeof k=="string"){const N=k,K=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(N)?N:u.resourcePath+N;return A(K)}else return k.data?{data:Ll(k.type,k.data),width:k.width,height:k.height}:null}if(n!==void 0&&n.length>0){const k=new zp(a);m=new Kh(k),m.setCrossOrigin(this.crossOrigin);for(let N=0,K=n.length;N<K;N++){const $=n[N],j=$.url;if(Array.isArray(j)){const ne=[];for(let le=0,se=j.length;le<se;le++){const re=j[le],ye=y(re);ye!==null&&(ye instanceof HTMLImageElement?ne.push(ye):ne.push(new Gu(ye.data,ye.width,ye.height)))}d[$.uuid]=new gc(ne)}else{const ne=y($.url);d[$.uuid]=new gc(ne)}}}return d}async parseImagesAsync(n){const a=this,u={};let d;async function m(A){if(typeof A=="string"){const y=A,k=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(y)?y:a.resourcePath+y;return await d.loadAsync(k)}else return A.data?{data:Ll(A.type,A.data),width:A.width,height:A.height}:null}if(n!==void 0&&n.length>0){d=new Kh(this.manager),d.setCrossOrigin(this.crossOrigin);for(let A=0,y=n.length;A<y;A++){const k=n[A],N=k.url;if(Array.isArray(N)){const K=[];for(let $=0,j=N.length;$<j;$++){const ne=N[$],le=await m(ne);le!==null&&(le instanceof HTMLImageElement?K.push(le):K.push(new Gu(le.data,le.width,le.height)))}u[k.uuid]=new gc(K)}else{const K=await m(k.url);u[k.uuid]=new gc(K)}}}return u}parseTextures(n,a){function u(m,A){return typeof m=="number"?m:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",m),A[m])}const d={};if(n!==void 0)for(let m=0,A=n.length;m<A;m++){const y=n[m];y.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',y.uuid),a[y.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",y.image);const k=a[y.image],N=k.data;let K;Array.isArray(N)?(K=new rc,N.length===6&&(K.needsUpdate=!0)):(N&&N.data?K=new Gu:K=new Ws,N&&(K.needsUpdate=!0)),K.source=k,K.uuid=y.uuid,y.name!==void 0&&(K.name=y.name),y.mapping!==void 0&&(K.mapping=u(y.mapping,eA)),y.offset!==void 0&&K.offset.fromArray(y.offset),y.repeat!==void 0&&K.repeat.fromArray(y.repeat),y.center!==void 0&&K.center.fromArray(y.center),y.rotation!==void 0&&(K.rotation=y.rotation),y.wrap!==void 0&&(K.wrapS=u(y.wrap[0],Uv),K.wrapT=u(y.wrap[1],Uv)),y.format!==void 0&&(K.format=y.format),y.type!==void 0&&(K.type=y.type),y.encoding!==void 0&&(K.encoding=y.encoding),y.minFilter!==void 0&&(K.minFilter=u(y.minFilter,tA)),y.magFilter!==void 0&&(K.magFilter=u(y.magFilter,tA)),y.anisotropy!==void 0&&(K.anisotropy=y.anisotropy),y.flipY!==void 0&&(K.flipY=y.flipY),y.premultiplyAlpha!==void 0&&(K.premultiplyAlpha=y.premultiplyAlpha),y.unpackAlignment!==void 0&&(K.unpackAlignment=y.unpackAlignment),y.userData!==void 0&&(K.userData=y.userData),d[y.uuid]=K}return d}parseObject(n,a,u,d,m){let A;function y(j){return a[j]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",j),a[j]}function k(j){if(j!==void 0){if(Array.isArray(j)){const ne=[];for(let le=0,se=j.length;le<se;le++){const re=j[le];u[re]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",re),ne.push(u[re])}return ne}return u[j]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",j),u[j]}}function N(j){return d[j]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",j),d[j]}let K,$;switch(n.type){case"Scene":A=new j1,n.background!==void 0&&(Number.isInteger(n.background)?A.background=new Si(n.background):A.background=N(n.background)),n.environment!==void 0&&(A.environment=N(n.environment)),n.fog!==void 0&&(n.fog.type==="Fog"?A.fog=new im(n.fog.color,n.fog.near,n.fog.far):n.fog.type==="FogExp2"&&(A.fog=new nm(n.fog.color,n.fog.density))),n.backgroundBlurriness!==void 0&&(A.backgroundBlurriness=n.backgroundBlurriness);break;case"PerspectiveCamera":A=new qs(n.fov,n.aspect,n.near,n.far),n.focus!==void 0&&(A.focus=n.focus),n.zoom!==void 0&&(A.zoom=n.zoom),n.filmGauge!==void 0&&(A.filmGauge=n.filmGauge),n.filmOffset!==void 0&&(A.filmOffset=n.filmOffset),n.view!==void 0&&(A.view=Object.assign({},n.view));break;case"OrthographicCamera":A=new Kf(n.left,n.right,n.top,n.bottom,n.near,n.far),n.zoom!==void 0&&(A.zoom=n.zoom),n.view!==void 0&&(A.view=Object.assign({},n.view));break;case"AmbientLight":A=new Nm(n.color,n.intensity);break;case"DirectionalLight":A=new Dm(n.color,n.intensity);break;case"PointLight":A=new Lm(n.color,n.intensity,n.distance,n.decay);break;case"RectAreaLight":A=new _c(n.color,n.intensity,n.width,n.height);break;case"SpotLight":A=new km(n.color,n.intensity,n.distance,n.angle,n.penumbra,n.decay);break;case"HemisphereLight":A=new Wp(n.color,n.groundColor,n.intensity);break;case"LightProbe":A=new Qp().fromJSON(n);break;case"SkinnedMesh":K=y(n.geometry),$=k(n.material),A=new dm(K,$),n.bindMode!==void 0&&(A.bindMode=n.bindMode),n.bindMatrix!==void 0&&A.bindMatrix.fromArray(n.bindMatrix),n.skeleton!==void 0&&(A.skeleton=n.skeleton);break;case"Mesh":K=y(n.geometry),$=k(n.material),A=new lo(K,$);break;case"InstancedMesh":K=y(n.geometry),$=k(n.material);const j=n.count,ne=n.instanceMatrix,le=n.instanceColor;A=new av(K,$,j),A.instanceMatrix=new Fd(new Float32Array(ne.array),16),le!==void 0&&(A.instanceColor=new Fd(new Float32Array(le.array),le.itemSize));break;case"LOD":A=new um;break;case"Line":A=new Uu(y(n.geometry),k(n.material));break;case"LineLoop":A=new lv(y(n.geometry),k(n.material));break;case"LineSegments":A=new Ic(y(n.geometry),k(n.material));break;case"PointCloud":case"Points":A=new zu(y(n.geometry),k(n.material));break;case"Sprite":A=new J1(k(n.material));break;case"Group":A=new Pu;break;case"Bone":A=new v0;break;default:A=new as}if(A.uuid=n.uuid,n.name!==void 0&&(A.name=n.name),n.matrix!==void 0?(A.matrix.fromArray(n.matrix),n.matrixAutoUpdate!==void 0&&(A.matrixAutoUpdate=n.matrixAutoUpdate),A.matrixAutoUpdate&&A.matrix.decompose(A.position,A.quaternion,A.scale)):(n.position!==void 0&&A.position.fromArray(n.position),n.rotation!==void 0&&A.rotation.fromArray(n.rotation),n.quaternion!==void 0&&A.quaternion.fromArray(n.quaternion),n.scale!==void 0&&A.scale.fromArray(n.scale)),n.castShadow!==void 0&&(A.castShadow=n.castShadow),n.receiveShadow!==void 0&&(A.receiveShadow=n.receiveShadow),n.shadow&&(n.shadow.bias!==void 0&&(A.shadow.bias=n.shadow.bias),n.shadow.normalBias!==void 0&&(A.shadow.normalBias=n.shadow.normalBias),n.shadow.radius!==void 0&&(A.shadow.radius=n.shadow.radius),n.shadow.mapSize!==void 0&&A.shadow.mapSize.fromArray(n.shadow.mapSize),n.shadow.camera!==void 0&&(A.shadow.camera=this.parseObject(n.shadow.camera))),n.visible!==void 0&&(A.visible=n.visible),n.frustumCulled!==void 0&&(A.frustumCulled=n.frustumCulled),n.renderOrder!==void 0&&(A.renderOrder=n.renderOrder),n.userData!==void 0&&(A.userData=n.userData),n.layers!==void 0&&(A.layers.mask=n.layers),n.children!==void 0){const j=n.children;for(let ne=0;ne<j.length;ne++)A.add(this.parseObject(j[ne],a,u,d,m))}if(n.animations!==void 0){const j=n.animations;for(let ne=0;ne<j.length;ne++){const le=j[ne];A.animations.push(m[le])}}if(n.type==="LOD"){n.autoUpdate!==void 0&&(A.autoUpdate=n.autoUpdate);const j=n.levels;for(let ne=0;ne<j.length;ne++){const le=j[ne],se=A.getObjectByProperty("uuid",le.object);se!==void 0&&A.addLevel(se,le.distance,le.hysteresis)}}return A}bindSkeletons(n,a){Object.keys(a).length!==0&&n.traverse(function(u){if(u.isSkinnedMesh===!0&&u.skeleton!==void 0){const d=a[u.skeleton];d===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",u.skeleton):u.bind(d,u.bindMatrix)}})}}const eA={UVMapping:Re,CubeReflectionMapping:We,CubeRefractionMapping:Oe,EquirectangularReflectionMapping:Qe,EquirectangularRefractionMapping:Ke,CubeUVReflectionMapping:vt},Uv={RepeatWrapping:ct,ClampToEdgeWrapping:Ct,MirroredRepeatWrapping:Yt},tA={NearestFilter:me,NearestMipmapNearestFilter:ee,NearestMipmapLinearFilter:Ue,LinearFilter:ft,LinearMipmapNearestFilter:Ft,LinearMipmapLinearFilter:bi};class Vv extends uo{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,a,u,d){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const m=this,A=su.get(n);if(A!==void 0)return m.manager.itemStart(n),setTimeout(function(){a&&a(A),m.manager.itemEnd(n)},0),A;const y={};y.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",y.headers=this.requestHeader,fetch(n,y).then(function(k){return k.blob()}).then(function(k){return createImageBitmap(k,Object.assign(m.options,{colorSpaceConversion:"none"}))}).then(function(k){su.add(n,k),a&&a(k),m.manager.itemEnd(n)}).catch(function(k){d&&d(k),m.manager.itemError(n),m.manager.itemEnd(n)}),m.manager.itemStart(n)}}let Qd;class jp{static getContext(){return Qd===void 0&&(Qd=new(window.AudioContext||window.webkitAudioContext)),Qd}static setContext(n){Qd=n}}class nA extends uo{constructor(n){super(n)}load(n,a,u,d){const m=this,A=new cc(this.manager);A.setResponseType("arraybuffer"),A.setPath(this.path),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(n,function(y){try{const k=y.slice(0);jp.getContext().decodeAudioData(k,function(K){a(K)})}catch(k){d?d(k):console.error(k),m.manager.itemError(n)}},u,d)}}class iA extends Qp{constructor(n,a,u=1){super(void 0,u),this.isHemisphereLightProbe=!0;const d=new Si().set(n),m=new Si().set(a),A=new tt(d.r,d.g,d.b),y=new tt(m.r,m.g,m.b),k=Math.sqrt(Math.PI),N=k*Math.sqrt(.75);this.sh.coefficients[0].copy(A).add(y).multiplyScalar(k),this.sh.coefficients[1].copy(A).sub(y).multiplyScalar(N)}}class rA extends Qp{constructor(n,a=1){super(void 0,a),this.isAmbientLightProbe=!0;const u=new Si().set(n);this.sh.coefficients[0].set(u.r,u.g,u.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const zv=new Ri,Fm=new Ri,ou=new Ri;class sA{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(n){const a=this._cache;if(a.focus!==n.focus||a.fov!==n.fov||a.aspect!==n.aspect*this.aspect||a.near!==n.near||a.far!==n.far||a.zoom!==n.zoom||a.eyeSep!==this.eyeSep){a.focus=n.focus,a.fov=n.fov,a.aspect=n.aspect*this.aspect,a.near=n.near,a.far=n.far,a.zoom=n.zoom,a.eyeSep=this.eyeSep,ou.copy(n.projectionMatrix);const d=a.eyeSep/2,m=d*a.near/a.focus,A=a.near*Math.tan(Bl*a.fov*.5)/a.zoom;let y,k;Fm.elements[12]=-d,zv.elements[12]=d,y=-A*a.aspect+m,k=A*a.aspect+m,ou.elements[0]=2*a.near/(k-y),ou.elements[8]=(k+y)/(k-y),this.cameraL.projectionMatrix.copy(ou),y=-A*a.aspect-m,k=A*a.aspect-m,ou.elements[0]=2*a.near/(k-y),ou.elements[8]=(k+y)/(k-y),this.cameraR.projectionMatrix.copy(ou)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(Fm),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(zv)}}class Pm{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Om(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const a=Om();n=(a-this.oldTime)/1e3,this.oldTime=a,this.elapsedTime+=n}return n}}function Om(){return(typeof performance>"u"?Date:performance).now()}const lu=new tt,Gm=new la,aA=new tt,cu=new tt;class Yp extends as{constructor(){super(),this.type="AudioListener",this.context=jp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Pm}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const a=this.context.listener,u=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lu,Gm,aA),cu.set(0,0,-1).applyQuaternion(Gm),a.positionX){const d=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(lu.x,d),a.positionY.linearRampToValueAtTime(lu.y,d),a.positionZ.linearRampToValueAtTime(lu.z,d),a.forwardX.linearRampToValueAtTime(cu.x,d),a.forwardY.linearRampToValueAtTime(cu.y,d),a.forwardZ.linearRampToValueAtTime(cu.z,d),a.upX.linearRampToValueAtTime(u.x,d),a.upY.linearRampToValueAtTime(u.y,d),a.upZ.linearRampToValueAtTime(u.z,d)}else a.setPosition(lu.x,lu.y,lu.z),a.setOrientation(cu.x,cu.y,cu.z,u.x,u.y,u.z)}}class Um extends as{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const a=this.context.createBufferSource();return a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,a=this.filters.length;n<a;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,a=this.filters.length;n<a;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){if(this.detune=n,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}}const uu=new tt,Vm=new la,Wv=new tt,$u=new tt;class oA extends Um{constructor(n){super(n),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(n){return this.panner.refDistance=n,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(n){return this.panner.rolloffFactor=n,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(n){return this.panner.distanceModel=n,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(n){return this.panner.maxDistance=n,this}setDirectionalCone(n,a,u){return this.panner.coneInnerAngle=n,this.panner.coneOuterAngle=a,this.panner.coneOuterGain=u,this}updateMatrixWorld(n){if(super.updateMatrixWorld(n),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(uu,Vm,Wv),$u.set(0,0,1).applyQuaternion(Vm);const a=this.panner;if(a.positionX){const u=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(uu.x,u),a.positionY.linearRampToValueAtTime(uu.y,u),a.positionZ.linearRampToValueAtTime(uu.z,u),a.orientationX.linearRampToValueAtTime($u.x,u),a.orientationY.linearRampToValueAtTime($u.y,u),a.orientationZ.linearRampToValueAtTime($u.z,u)}else a.setPosition(uu.x,uu.y,uu.z),a.setOrientation($u.x,$u.y,$u.z)}}class eC{constructor(n,a=2048){this.analyser=n.context.createAnalyser(),this.analyser.fftSize=a,this.data=new Uint8Array(this.analyser.frequencyBinCount),n.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let n=0;const a=this.getFrequencyData();for(let u=0;u<a.length;u++)n+=a[u];return n/a.length}}class Rc{constructor(n,a,u){this.binding=n,this.valueSize=u;let d,m,A;switch(a){case"quaternion":d=this._slerp,m=this._slerpAdditive,A=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(u*6),this._workIndex=5;break;case"string":case"bool":d=this._select,m=this._select,A=this._setAdditiveIdentityOther,this.buffer=new Array(u*5);break;default:d=this._lerp,m=this._lerpAdditive,A=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(u*5)}this._mixBufferRegion=d,this._mixBufferRegionAdditive=m,this._setIdentity=A,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(n,a){const u=this.buffer,d=this.valueSize,m=n*d+d;let A=this.cumulativeWeight;if(A===0){for(let y=0;y!==d;++y)u[m+y]=u[y];A=a}else{A+=a;const y=a/A;this._mixBufferRegion(u,m,0,y,d)}this.cumulativeWeight=A}accumulateAdditive(n){const a=this.buffer,u=this.valueSize,d=u*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(a,d,0,n,u),this.cumulativeWeightAdditive+=n}apply(n){const a=this.valueSize,u=this.buffer,d=n*a+a,m=this.cumulativeWeight,A=this.cumulativeWeightAdditive,y=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,m<1){const k=a*this._origIndex;this._mixBufferRegion(u,d,k,1-m,a)}A>0&&this._mixBufferRegionAdditive(u,d,this._addIndex*a,1,a);for(let k=a,N=a+a;k!==N;++k)if(u[k]!==u[k+a]){y.setValue(u,d);break}}saveOriginalState(){const n=this.binding,a=this.buffer,u=this.valueSize,d=u*this._origIndex;n.getValue(a,d);for(let m=u,A=d;m!==A;++m)a[m]=a[d+m%u];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const n=this.valueSize*3;this.binding.setValue(this.buffer,n)}_setAdditiveIdentityNumeric(){const n=this._addIndex*this.valueSize,a=n+this.valueSize;for(let u=n;u<a;u++)this.buffer[u]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const n=this._origIndex*this.valueSize,a=this._addIndex*this.valueSize;for(let u=0;u<this.valueSize;u++)this.buffer[a+u]=this.buffer[n+u]}_select(n,a,u,d,m){if(d>=.5)for(let A=0;A!==m;++A)n[a+A]=n[u+A]}_slerp(n,a,u,d){la.slerpFlat(n,a,n,a,n,u,d)}_slerpAdditive(n,a,u,d,m){const A=this._workIndex*m;la.multiplyQuaternionsFlat(n,A,n,a,n,u),la.slerpFlat(n,a,n,a,n,A,d)}_lerp(n,a,u,d,m){const A=1-d;for(let y=0;y!==m;++y){const k=a+y;n[k]=n[k]*A+n[u+y]*d}}_lerpAdditive(n,a,u,d,m){for(let A=0;A!==m;++A){const y=a+A;n[y]=n[y]+n[u+A]*d}}}const Jp="\\[\\]\\.:\\/",tC=new RegExp("["+Jp+"]","g"),zm="[^"+Jp+"]",nC="[^"+Jp.replace("\\.","")+"]",iC=/((?:WC+[\/:])*)/.source.replace("WC",zm),rC=/(WCOD+)?/.source.replace("WCOD",nC),sC=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zm),aC=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zm),oC=new RegExp("^"+iC+rC+sC+aC+"$"),lC=["material","materials","bones","map"];class cC{constructor(n,a,u){const d=u||fs.parseTrackName(a);this._targetGroup=n,this._bindings=n.subscribe_(a,d)}getValue(n,a){this.bind();const u=this._targetGroup.nCachedObjects_,d=this._bindings[u];d!==void 0&&d.getValue(n,a)}setValue(n,a){const u=this._bindings;for(let d=this._targetGroup.nCachedObjects_,m=u.length;d!==m;++d)u[d].setValue(n,a)}bind(){const n=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=n.length;a!==u;++a)n[a].bind()}unbind(){const n=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=n.length;a!==u;++a)n[a].unbind()}}class fs{constructor(n,a,u){this.path=a,this.parsedPath=u||fs.parseTrackName(a),this.node=fs.findNode(n,this.parsedPath.nodeName)||n,this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(n,a,u){return n&&n.isAnimationObjectGroup?new fs.Composite(n,a,u):new fs(n,a,u)}static sanitizeNodeName(n){return n.replace(/\s/g,"_").replace(tC,"")}static parseTrackName(n){const a=oC.exec(n);if(a===null)throw new Error("PropertyBinding: Cannot parse trackName: "+n);const u={nodeName:a[2],objectName:a[3],objectIndex:a[4],propertyName:a[5],propertyIndex:a[6]},d=u.nodeName&&u.nodeName.lastIndexOf(".");if(d!==void 0&&d!==-1){const m=u.nodeName.substring(d+1);lC.indexOf(m)!==-1&&(u.nodeName=u.nodeName.substring(0,d),u.objectName=m)}if(u.propertyName===null||u.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+n);return u}static findNode(n,a){if(a===void 0||a===""||a==="."||a===-1||a===n.name||a===n.uuid)return n;if(n.skeleton){const u=n.skeleton.getBoneByName(a);if(u!==void 0)return u}if(n.children){const u=function(m){for(let A=0;A<m.length;A++){const y=m[A];if(y.name===a||y.uuid===a)return y;const k=u(y.children);if(k)return k}return null},d=u(n.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(n,a){n[a]=this.targetObject[this.propertyName]}_getValue_array(n,a){const u=this.resolvedProperty;for(let d=0,m=u.length;d!==m;++d)n[a++]=u[d]}_getValue_arrayElement(n,a){n[a]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(n,a){this.resolvedProperty.toArray(n,a)}_setValue_direct(n,a){this.targetObject[this.propertyName]=n[a]}_setValue_direct_setNeedsUpdate(n,a){this.targetObject[this.propertyName]=n[a],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(n,a){this.targetObject[this.propertyName]=n[a],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,a){const u=this.resolvedProperty;for(let d=0,m=u.length;d!==m;++d)u[d]=n[a++]}_setValue_array_setNeedsUpdate(n,a){const u=this.resolvedProperty;for(let d=0,m=u.length;d!==m;++d)u[d]=n[a++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,a){const u=this.resolvedProperty;for(let d=0,m=u.length;d!==m;++d)u[d]=n[a++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(n,a){this.resolvedProperty[this.propertyIndex]=n[a]}_setValue_arrayElement_setNeedsUpdate(n,a){this.resolvedProperty[this.propertyIndex]=n[a],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(n,a){this.resolvedProperty[this.propertyIndex]=n[a],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(n,a){this.resolvedProperty.fromArray(n,a)}_setValue_fromArray_setNeedsUpdate(n,a){this.resolvedProperty.fromArray(n,a),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(n,a){this.resolvedProperty.fromArray(n,a),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(n,a){this.bind(),this.getValue(n,a)}_setValue_unbound(n,a){this.bind(),this.setValue(n,a)}bind(){let n=this.node;const a=this.parsedPath,u=a.objectName,d=a.propertyName;let m=a.propertyIndex;if(n||(n=fs.findNode(this.rootNode,a.nodeName)||this.rootNode,this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!n){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(u){let N=a.objectIndex;switch(u){case"materials":if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}n=n.material.materials;break;case"bones":if(!n.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}n=n.skeleton.bones;for(let K=0;K<n.length;K++)if(n[K].name===N){N=K;break}break;case"map":if("map"in n){n=n.map;break}if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}n=n.material.map;break;default:if(n[u]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}n=n[u]}if(N!==void 0){if(n[N]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);return}n=n[N]}}const A=n[d];if(A===void 0){const N=a.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+N+"."+d+" but it wasn't found.",n);return}let y=this.Versioning.None;this.targetObject=n,n.needsUpdate!==void 0?y=this.Versioning.NeedsUpdate:n.matrixWorldNeedsUpdate!==void 0&&(y=this.Versioning.MatrixWorldNeedsUpdate);let k=this.BindingType.Direct;if(m!==void 0){if(d==="morphTargetInfluences"){if(!n.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!n.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}n.morphTargetDictionary[m]!==void 0&&(m=n.morphTargetDictionary[m])}k=this.BindingType.ArrayElement,this.resolvedProperty=A,this.propertyIndex=m}else A.fromArray!==void 0&&A.toArray!==void 0?(k=this.BindingType.HasFromToArray,this.resolvedProperty=A):Array.isArray(A)?(k=this.BindingType.EntireArray,this.resolvedProperty=A):this.propertyName=d;this.getValue=this.GetterByBindingType[k],this.setValue=this.SetterByBindingTypeAndVersioning[k][y]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}fs.Composite=cC,fs.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},fs.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},fs.prototype.GetterByBindingType=[fs.prototype._getValue_direct,fs.prototype._getValue_array,fs.prototype._getValue_arrayElement,fs.prototype._getValue_toArray],fs.prototype.SetterByBindingTypeAndVersioning=[[fs.prototype._setValue_direct,fs.prototype._setValue_direct_setNeedsUpdate,fs.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[fs.prototype._setValue_array,fs.prototype._setValue_array_setNeedsUpdate,fs.prototype._setValue_array_setMatrixWorldNeedsUpdate],[fs.prototype._setValue_arrayElement,fs.prototype._setValue_arrayElement_setNeedsUpdate,fs.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[fs.prototype._setValue_fromArray,fs.prototype._setValue_fromArray_setNeedsUpdate,fs.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class uC{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Za(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const n={};this._indicesByUUID=n;for(let u=0,d=arguments.length;u!==d;++u)n[arguments[u].uuid]=u;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}add(){const n=this._objects,a=this._indicesByUUID,u=this._paths,d=this._parsedPaths,m=this._bindings,A=m.length;let y,k=n.length,N=this.nCachedObjects_;for(let K=0,$=arguments.length;K!==$;++K){const j=arguments[K],ne=j.uuid;let le=a[ne];if(le===void 0){le=k++,a[ne]=le,n.push(j);for(let se=0,re=A;se!==re;++se)m[se].push(new fs(j,u[se],d[se]))}else if(le<N){y=n[le];const se=--N,re=n[se];a[re.uuid]=le,n[le]=re,a[ne]=se,n[se]=j;for(let ye=0,Be=A;ye!==Be;++ye){const Ee=m[ye],Me=Ee[se];let Fe=Ee[le];Ee[le]=Me,Fe===void 0&&(Fe=new fs(j,u[ye],d[ye])),Ee[se]=Fe}}else n[le]!==y&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=N}remove(){const n=this._objects,a=this._indicesByUUID,u=this._bindings,d=u.length;let m=this.nCachedObjects_;for(let A=0,y=arguments.length;A!==y;++A){const k=arguments[A],N=k.uuid,K=a[N];if(K!==void 0&&K>=m){const $=m++,j=n[$];a[j.uuid]=K,n[K]=j,a[N]=$,n[$]=k;for(let ne=0,le=d;ne!==le;++ne){const se=u[ne],re=se[$],ye=se[K];se[K]=re,se[$]=ye}}}this.nCachedObjects_=m}uncache(){const n=this._objects,a=this._indicesByUUID,u=this._bindings,d=u.length;let m=this.nCachedObjects_,A=n.length;for(let y=0,k=arguments.length;y!==k;++y){const N=arguments[y],K=N.uuid,$=a[K];if($!==void 0)if(delete a[K],$<m){const j=--m,ne=n[j],le=--A,se=n[le];a[ne.uuid]=$,n[$]=ne,a[se.uuid]=j,n[j]=se,n.pop();for(let re=0,ye=d;re!==ye;++re){const Be=u[re],Ee=Be[j],Me=Be[le];Be[$]=Ee,Be[j]=Me,Be.pop()}}else{const j=--A,ne=n[j];j>0&&(a[ne.uuid]=$),n[$]=ne,n.pop();for(let le=0,se=d;le!==se;++le){const re=u[le];re[$]=re[j],re.pop()}}}this.nCachedObjects_=m}subscribe_(n,a){const u=this._bindingsIndicesByPath;let d=u[n];const m=this._bindings;if(d!==void 0)return m[d];const A=this._paths,y=this._parsedPaths,k=this._objects,N=k.length,K=this.nCachedObjects_,$=new Array(N);d=m.length,u[n]=d,A.push(n),y.push(a),m.push($);for(let j=K,ne=k.length;j!==ne;++j){const le=k[j];$[j]=new fs(le,n,a)}return $}unsubscribe_(n){const a=this._bindingsIndicesByPath,u=a[n];if(u!==void 0){const d=this._paths,m=this._parsedPaths,A=this._bindings,y=A.length-1,k=A[y],N=n[y];a[N]=u,A[u]=k,A.pop(),m[u]=m[y],m.pop(),d[u]=d[y],d.pop()}}}class hC{constructor(n,a,u=null,d=a.blendMode){this._mixer=n,this._clip=a,this._localRoot=u,this.blendMode=d;const m=a.tracks,A=m.length,y=new Array(A),k={endingStart:Bn,endingEnd:Bn};for(let N=0;N!==A;++N){const K=m[N].createInterpolant(null);y[N]=K,K.settings=k}this._interpolantSettings=k,this._interpolants=y,this._propertyBindings=new Array(A),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=It,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(n){return this._startTime=n,this}setLoop(n,a){return this.loop=n,this.repetitions=a,this}setEffectiveWeight(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(n){return this._scheduleFading(n,0,1)}fadeOut(n){return this._scheduleFading(n,1,0)}crossFadeFrom(n,a,u){if(n.fadeOut(a),this.fadeIn(a),u){const d=this._clip.duration,m=n._clip.duration,A=m/d,y=d/m;n.warp(1,A,a),this.warp(y,1,a)}return this}crossFadeTo(n,a,u){return n.crossFadeFrom(this,a,u)}stopFading(){const n=this._weightInterpolant;return n!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}setEffectiveTimeScale(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(n){return this.timeScale=this._clip.duration/n,this.stopWarping()}syncWith(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()}halt(n){return this.warp(this._effectiveTimeScale,0,n)}warp(n,a,u){const d=this._mixer,m=d.time,A=this.timeScale;let y=this._timeScaleInterpolant;y===null&&(y=d._lendControlInterpolant(),this._timeScaleInterpolant=y);const k=y.parameterPositions,N=y.sampleValues;return k[0]=m,k[1]=m+u,N[0]=n/A,N[1]=a/A,this}stopWarping(){const n=this._timeScaleInterpolant;return n!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(n,a,u,d){if(!this.enabled){this._updateWeight(n);return}const m=this._startTime;if(m!==null){const k=(n-m)*u;k<0||u===0?a=0:(this._startTime=null,a=u*k)}a*=this._updateTimeScale(n);const A=this._updateTime(a),y=this._updateWeight(n);if(y>0){const k=this._interpolants,N=this._propertyBindings;switch(this.blendMode){case br:for(let K=0,$=k.length;K!==$;++K)k[K].evaluate(A),N[K].accumulateAdditive(y);break;case Vi:default:for(let K=0,$=k.length;K!==$;++K)k[K].evaluate(A),N[K].accumulate(d,y)}}}_updateWeight(n){let a=0;if(this.enabled){a=this.weight;const u=this._weightInterpolant;if(u!==null){const d=u.evaluate(n)[0];a*=d,n>u.parameterPositions[1]&&(this.stopFading(),d===0&&(this.enabled=!1))}}return this._effectiveWeight=a,a}_updateTimeScale(n){let a=0;if(!this.paused){a=this.timeScale;const u=this._timeScaleInterpolant;if(u!==null){const d=u.evaluate(n)[0];a*=d,n>u.parameterPositions[1]&&(this.stopWarping(),a===0?this.paused=!0:this.timeScale=a)}}return this._effectiveTimeScale=a,a}_updateTime(n){const a=this._clip.duration,u=this.loop;let d=this.time+n,m=this._loopCount;const A=u===Sn;if(n===0)return m===-1?d:A&&(m&1)===1?a-d:d;if(u===At){m===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(d>=a)d=a;else if(d<0)d=0;else{this.time=d;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(m===-1&&(n>=0?(m=0,this._setEndings(!0,this.repetitions===0,A)):this._setEndings(this.repetitions===0,!0,A)),d>=a||d<0){const y=Math.floor(d/a);d-=a*y,m+=Math.abs(y);const k=this.repetitions-m;if(k<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,d=n>0?a:0,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(k===1){const N=n<0;this._setEndings(N,!N,A)}else this._setEndings(!1,!1,A);this._loopCount=m,this.time=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:y})}}else this.time=d;if(A&&(m&1)===1)return a-d}return d}_setEndings(n,a,u){const d=this._interpolantSettings;u?(d.endingStart=fi,d.endingEnd=fi):(n?d.endingStart=this.zeroSlopeAtStart?fi:Bn:d.endingStart=Ii,a?d.endingEnd=this.zeroSlopeAtEnd?fi:Bn:d.endingEnd=Ii)}_scheduleFading(n,a,u){const d=this._mixer,m=d.time;let A=this._weightInterpolant;A===null&&(A=d._lendControlInterpolant(),this._weightInterpolant=A);const y=A.parameterPositions,k=A.sampleValues;return y[0]=m,k[0]=a,y[1]=m+n,k[1]=u,this}}const dC=new Float32Array(1);class pC extends io{constructor(n){super(),this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(n,a){const u=n._localRoot||this._root,d=n._clip.tracks,m=d.length,A=n._propertyBindings,y=n._interpolants,k=u.uuid,N=this._bindingsByRootAndName;let K=N[k];K===void 0&&(K={},N[k]=K);for(let $=0;$!==m;++$){const j=d[$],ne=j.name;let le=K[ne];if(le!==void 0)++le.referenceCount,A[$]=le;else{if(le=A[$],le!==void 0){le._cacheIndex===null&&(++le.referenceCount,this._addInactiveBinding(le,k,ne));continue}const se=a&&a._propertyBindings[$].binding.parsedPath;le=new Rc(fs.create(u,ne,se),j.ValueTypeName,j.getValueSize()),++le.referenceCount,this._addInactiveBinding(le,k,ne),A[$]=le}y[$].resultBuffer=le.buffer}}_activateAction(n){if(!this._isActiveAction(n)){if(n._cacheIndex===null){const u=(n._localRoot||this._root).uuid,d=n._clip.uuid,m=this._actionsByClip[d];this._bindAction(n,m&&m.knownActions[0]),this._addInactiveAction(n,d,u)}const a=n._propertyBindings;for(let u=0,d=a.length;u!==d;++u){const m=a[u];m.useCount++===0&&(this._lendBinding(m),m.saveOriginalState())}this._lendAction(n)}}_deactivateAction(n){if(this._isActiveAction(n)){const a=n._propertyBindings;for(let u=0,d=a.length;u!==d;++u){const m=a[u];--m.useCount===0&&(m.restoreOriginalState(),this._takeBackBinding(m))}this._takeBackAction(n)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}}_isActiveAction(n){const a=n._cacheIndex;return a!==null&&a<this._nActiveActions}_addInactiveAction(n,a,u){const d=this._actions,m=this._actionsByClip;let A=m[a];if(A===void 0)A={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,m[a]=A;else{const y=A.knownActions;n._byClipCacheIndex=y.length,y.push(n)}n._cacheIndex=d.length,d.push(n),A.actionByRoot[u]=n}_removeInactiveAction(n){const a=this._actions,u=a[a.length-1],d=n._cacheIndex;u._cacheIndex=d,a[d]=u,a.pop(),n._cacheIndex=null;const m=n._clip.uuid,A=this._actionsByClip,y=A[m],k=y.knownActions,N=k[k.length-1],K=n._byClipCacheIndex;N._byClipCacheIndex=K,k[K]=N,k.pop(),n._byClipCacheIndex=null;const $=y.actionByRoot,j=(n._localRoot||this._root).uuid;delete $[j],k.length===0&&delete A[m],this._removeInactiveBindingsForAction(n)}_removeInactiveBindingsForAction(n){const a=n._propertyBindings;for(let u=0,d=a.length;u!==d;++u){const m=a[u];--m.referenceCount===0&&this._removeInactiveBinding(m)}}_lendAction(n){const a=this._actions,u=n._cacheIndex,d=this._nActiveActions++,m=a[d];n._cacheIndex=d,a[d]=n,m._cacheIndex=u,a[u]=m}_takeBackAction(n){const a=this._actions,u=n._cacheIndex,d=--this._nActiveActions,m=a[d];n._cacheIndex=d,a[d]=n,m._cacheIndex=u,a[u]=m}_addInactiveBinding(n,a,u){const d=this._bindingsByRootAndName,m=this._bindings;let A=d[a];A===void 0&&(A={},d[a]=A),A[u]=n,n._cacheIndex=m.length,m.push(n)}_removeInactiveBinding(n){const a=this._bindings,u=n.binding,d=u.rootNode.uuid,m=u.path,A=this._bindingsByRootAndName,y=A[d],k=a[a.length-1],N=n._cacheIndex;k._cacheIndex=N,a[N]=k,a.pop(),delete y[m],Object.keys(y).length===0&&delete A[d]}_lendBinding(n){const a=this._bindings,u=n._cacheIndex,d=this._nActiveBindings++,m=a[d];n._cacheIndex=d,a[d]=n,m._cacheIndex=u,a[u]=m}_takeBackBinding(n){const a=this._bindings,u=n._cacheIndex,d=--this._nActiveBindings,m=a[d];n._cacheIndex=d,a[d]=n,m._cacheIndex=u,a[u]=m}_lendControlInterpolant(){const n=this._controlInterpolants,a=this._nActiveControlInterpolants++;let u=n[a];return u===void 0&&(u=new z0(new Float32Array(2),new Float32Array(2),1,dC),u.__cacheIndex=a,n[a]=u),u}_takeBackControlInterpolant(n){const a=this._controlInterpolants,u=n.__cacheIndex,d=--this._nActiveControlInterpolants,m=a[d];n.__cacheIndex=d,a[d]=n,m.__cacheIndex=u,a[u]=m}clipAction(n,a,u){const d=a||this._root,m=d.uuid;let A=typeof n=="string"?Hh.findByName(d,n):n;const y=A!==null?A.uuid:n,k=this._actionsByClip[y];let N=null;if(u===void 0&&(A!==null?u=A.blendMode:u=Vi),k!==void 0){const $=k.actionByRoot[m];if($!==void 0&&$.blendMode===u)return $;N=k.knownActions[0],A===null&&(A=N._clip)}if(A===null)return null;const K=new hC(this,A,a,u);return this._bindAction(K,N),this._addInactiveAction(K,y,m),K}existingAction(n,a){const u=a||this._root,d=u.uuid,m=typeof n=="string"?Hh.findByName(u,n):n,A=m?m.uuid:n,y=this._actionsByClip[A];return y!==void 0&&y.actionByRoot[d]||null}stopAllAction(){const n=this._actions,a=this._nActiveActions;for(let u=a-1;u>=0;--u)n[u].stop();return this}update(n){n*=this.timeScale;const a=this._actions,u=this._nActiveActions,d=this.time+=n,m=Math.sign(n),A=this._accuIndex^=1;for(let N=0;N!==u;++N)a[N]._update(d,n,m,A);const y=this._bindings,k=this._nActiveBindings;for(let N=0;N!==k;++N)y[N].apply(A);return this}setTime(n){this.time=0;for(let a=0;a<this._actions.length;a++)this._actions[a].time=0;return this.update(n)}getRoot(){return this._root}uncacheClip(n){const a=this._actions,u=n.uuid,d=this._actionsByClip,m=d[u];if(m!==void 0){const A=m.knownActions;for(let y=0,k=A.length;y!==k;++y){const N=A[y];this._deactivateAction(N);const K=N._cacheIndex,$=a[a.length-1];N._cacheIndex=null,N._byClipCacheIndex=null,$._cacheIndex=K,a[K]=$,a.pop(),this._removeInactiveBindingsForAction(N)}delete d[u]}}uncacheRoot(n){const a=n.uuid,u=this._actionsByClip;for(const A in u){const y=u[A].actionByRoot,k=y[a];k!==void 0&&(this._deactivateAction(k),this._removeInactiveAction(k))}const d=this._bindingsByRootAndName,m=d[a];if(m!==void 0)for(const A in m){const y=m[A];y.restoreOriginalState(),this._removeInactiveBinding(y)}}uncacheAction(n,a){const u=this.existingAction(n,a);u!==null&&(this._deactivateAction(u),this._removeInactiveAction(u))}}class lA{constructor(n){this.value=n}clone(){return new lA(this.value.clone===void 0?this.value:this.value.clone())}}let fC=0;class mC extends io{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:fC++}),this.name="",this.usage=Yl,this.uniforms=[]}add(n){return this.uniforms.push(n),this}remove(n){const a=this.uniforms.indexOf(n);return a!==-1&&this.uniforms.splice(a,1),this}setName(n){return this.name=n,this}setUsage(n){return this.usage=n,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(n){this.name=n.name,this.usage=n.usage;const a=n.uniforms;this.uniforms.length=0;for(let u=0,d=a.length;u<d;u++)this.uniforms.push(a[u].clone());return this}clone(){return new this.constructor().copy(this)}}class gC extends rm{constructor(n,a,u=1){super(n,a),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=u}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}clone(n){const a=super.clone(n);return a.meshPerAttribute=this.meshPerAttribute,a}toJSON(n){const a=super.toJSON(n);return a.isInstancedInterleavedBuffer=!0,a.meshPerAttribute=this.meshPerAttribute,a}}class AC{constructor(n,a,u,d,m){this.isGLBufferAttribute=!0,this.buffer=n,this.type=a,this.itemSize=u,this.elementSize=d,this.count=m,this.version=0}set needsUpdate(n){n===!0&&this.version++}setBuffer(n){return this.buffer=n,this}setType(n,a){return this.type=n,this.elementSize=a,this}setItemSize(n){return this.itemSize=n,this}setCount(n){return this.count=n,this}}class vC{constructor(n,a,u=0,d=1/0){this.ray=new _a(n,a),this.near=u,this.far=d,this.camera=null,this.layers=new jr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,a){this.ray.set(n,a)}setFromCamera(n,a){a.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(a).sub(this.ray.origin).normalize(),this.camera=a):a.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(a.near+a.far)/(a.near-a.far)).unproject(a),this.ray.direction.set(0,0,-1).transformDirection(a.matrixWorld),this.camera=a):console.error("THREE.Raycaster: Unsupported camera type: "+a.type)}intersectObject(n,a=!0,u=[]){return cA(n,this,u,a),u.sort(Hv),u}intersectObjects(n,a=!0,u=[]){for(let d=0,m=n.length;d<m;d++)cA(n[d],this,u,a);return u.sort(Hv),u}}function Hv(x,n){return x.distance-n.distance}function cA(x,n,a,u){if(x.layers.test(n.layers)&&x.raycast(n,a),u===!0){const d=x.children;for(let m=0,A=d.length;m<A;m++)cA(d[m],n,a,!0)}}class yC{constructor(n=1,a=0,u=0){return this.radius=n,this.phi=a,this.theta=u,this}set(n,a,u){return this.radius=n,this.phi=a,this.theta=u,this}copy(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,a,u){return this.radius=Math.sqrt(n*n+a*a+u*u),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,u),this.phi=Math.acos(aa(a/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class bC{constructor(n=1,a=0,u=0){return this.radius=n,this.theta=a,this.y=u,this}set(n,a,u){return this.radius=n,this.theta=a,this.y=u,this}copy(n){return this.radius=n.radius,this.theta=n.theta,this.y=n.y,this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,a,u){return this.radius=Math.sqrt(n*n+u*u),this.theta=Math.atan2(n,u),this.y=a,this}clone(){return new this.constructor().copy(this)}}const Kv=new kn;class xC{constructor(n=new kn(1/0,1/0),a=new kn(-1/0,-1/0)){this.isBox2=!0,this.min=n,this.max=a}set(n,a){return this.min.copy(n),this.max.copy(a),this}setFromPoints(n){this.makeEmpty();for(let a=0,u=n.length;a<u;a++)this.expandByPoint(n[a]);return this}setFromCenterAndSize(n,a){const u=Kv.copy(a).multiplyScalar(.5);return this.min.copy(n).sub(u),this.max.copy(n).add(u),this}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(n){return this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y}getParameter(n,a){return a.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y)}clampPoint(n,a){return a.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return Kv.copy(n).clamp(this.min,this.max).sub(n).length()}intersect(n){return this.min.max(n.min),this.max.min(n.max),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const Xv=new tt,Wm=new tt;class CC{constructor(n=new tt,a=new tt){this.start=n,this.end=a}set(n,a){return this.start.copy(n),this.end.copy(a),this}copy(n){return this.start.copy(n.start),this.end.copy(n.end),this}getCenter(n){return n.addVectors(this.start,this.end).multiplyScalar(.5)}delta(n){return n.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(n,a){return this.delta(a).multiplyScalar(n).add(this.start)}closestPointToPointParameter(n,a){Xv.subVectors(n,this.start),Wm.subVectors(this.end,this.start);const u=Wm.dot(Wm);let m=Wm.dot(Xv)/u;return a&&(m=aa(m,0,1)),m}closestPointToPoint(n,a,u){const d=this.closestPointToPointParameter(n,a);return this.delta(u).multiplyScalar(d).add(this.start)}applyMatrix4(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this}equals(n){return n.start.equals(this.start)&&n.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Qv=new tt;class wC extends as{constructor(n,a){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=a,this.type="SpotLightHelper";const u=new Or,d=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let A=0,y=1,k=32;A<k;A++,y++){const N=A/k*Math.PI*2,K=y/k*Math.PI*2;d.push(Math.cos(N),Math.sin(N),1,Math.cos(K),Math.sin(K),1)}u.setAttribute("position",new Fi(d,3));const m=new Fa({fog:!1,toneMapped:!1});this.cone=new Ic(u,m),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const n=this.light.distance?this.light.distance:1e3,a=n*Math.tan(this.light.angle);this.cone.scale.set(a,a,n),Qv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Qv),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ju=new tt,Hm=new Ri,uA=new Ri;class EC extends Ic{constructor(n){const a=Zv(n),u=new Or,d=[],m=[],A=new Si(0,0,1),y=new Si(0,1,0);for(let N=0;N<a.length;N++){const K=a[N];K.parent&&K.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),m.push(A.r,A.g,A.b),m.push(y.r,y.g,y.b))}u.setAttribute("position",new Fi(d,3)),u.setAttribute("color",new Fi(m,3));const k=new Fa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(u,k),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=n,this.bones=a,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(n){const a=this.bones,u=this.geometry,d=u.getAttribute("position");uA.copy(this.root.matrixWorld).invert();for(let m=0,A=0;m<a.length;m++){const y=a[m];y.parent&&y.parent.isBone&&(Hm.multiplyMatrices(uA,y.matrixWorld),ju.setFromMatrixPosition(Hm),d.setXYZ(A,ju.x,ju.y,ju.z),Hm.multiplyMatrices(uA,y.parent.matrixWorld),ju.setFromMatrixPosition(Hm),d.setXYZ(A+1,ju.x,ju.y,ju.z),A+=2)}u.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Zv(x){const n=[];x.isBone===!0&&n.push(x);for(let a=0;a<x.children.length;a++)n.push.apply(n,Zv(x.children[a]));return n}class IC extends lo{constructor(n,a,u){const d=new Hd(a,4,2),m=new _u({wireframe:!0,fog:!1,toneMapped:!1});super(d,m),this.light=n,this.color=u,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const SC=new tt,$v=new Si,jv=new Si;class TC extends as{constructor(n,a,u){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,this.type="HemisphereLightHelper";const d=new Wd(a);d.rotateY(Math.PI*.5),this.material=new _u({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const m=d.getAttribute("position"),A=new Float32Array(m.count*3);d.setAttribute("color",new Vt(A,3)),this.add(new lo(d,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const n=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const a=n.geometry.getAttribute("color");$v.copy(this.light.color),jv.copy(this.light.groundColor);for(let u=0,d=a.count;u<d;u++){const m=u<d/2?$v:jv;a.setXYZ(u,m.r,m.g,m.b)}a.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),n.lookAt(SC.setFromMatrixPosition(this.light.matrixWorld).negate())}}class MC extends Ic{constructor(n=10,a=10,u=4473924,d=8947848){u=new Si(u),d=new Si(d);const m=a/2,A=n/a,y=n/2,k=[],N=[];for(let j=0,ne=0,le=-y;j<=a;j++,le+=A){k.push(-y,0,le,y,0,le),k.push(le,0,-y,le,0,y);const se=j===m?u:d;se.toArray(N,ne),ne+=3,se.toArray(N,ne),ne+=3,se.toArray(N,ne),ne+=3,se.toArray(N,ne),ne+=3}const K=new Or;K.setAttribute("position",new Fi(k,3)),K.setAttribute("color",new Fi(N,3));const $=new Fa({vertexColors:!0,toneMapped:!1});super(K,$),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class _C extends Ic{constructor(n=10,a=16,u=8,d=64,m=4473924,A=8947848){m=new Si(m),A=new Si(A);const y=[],k=[];if(a>1)for(let $=0;$<a;$++){const j=$/a*(Math.PI*2),ne=Math.sin(j)*n,le=Math.cos(j)*n;y.push(0,0,0),y.push(ne,0,le);const se=$&1?m:A;k.push(se.r,se.g,se.b),k.push(se.r,se.g,se.b)}for(let $=0;$<u;$++){const j=$&1?m:A,ne=n-n/u*$;for(let le=0;le<d;le++){let se=le/d*(Math.PI*2),re=Math.sin(se)*ne,ye=Math.cos(se)*ne;y.push(re,0,ye),k.push(j.r,j.g,j.b),se=(le+1)/d*(Math.PI*2),re=Math.sin(se)*ne,ye=Math.cos(se)*ne,y.push(re,0,ye),k.push(j.r,j.g,j.b)}}const N=new Or;N.setAttribute("position",new Fi(y,3)),N.setAttribute("color",new Fi(k,3));const K=new Fa({vertexColors:!0,toneMapped:!1});super(N,K),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Yv=new tt,Km=new tt,hA=new tt;class Jv extends as{constructor(n,a,u){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,this.type="DirectionalLightHelper",a===void 0&&(a=1);let d=new Or;d.setAttribute("position",new Fi([-a,a,0,a,a,0,a,-a,0,-a,-a,0,-a,a,0],3));const m=new Fa({fog:!1,toneMapped:!1});this.lightPlane=new Uu(d,m),this.add(this.lightPlane),d=new Or,d.setAttribute("position",new Fi([0,0,0,0,0,1],3)),this.targetLine=new Uu(d,m),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Yv.setFromMatrixPosition(this.light.matrixWorld),Km.setFromMatrixPosition(this.light.target.matrixWorld),hA.subVectors(Km,Yv),this.lightPlane.lookAt(Km),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Km),this.targetLine.scale.z=hA.length()}}const Xm=new tt,Ea=new wd;class RC extends Ic{constructor(n){const a=new Or,u=new Fa({color:16777215,vertexColors:!0,toneMapped:!1}),d=[],m=[],A={};y("n1","n2"),y("n2","n4"),y("n4","n3"),y("n3","n1"),y("f1","f2"),y("f2","f4"),y("f4","f3"),y("f3","f1"),y("n1","f1"),y("n2","f2"),y("n3","f3"),y("n4","f4"),y("p","n1"),y("p","n2"),y("p","n3"),y("p","n4"),y("u1","u2"),y("u2","u3"),y("u3","u1"),y("c","t"),y("p","c"),y("cn1","cn2"),y("cn3","cn4"),y("cf1","cf2"),y("cf3","cf4");function y(le,se){k(le),k(se)}function k(le){d.push(0,0,0),m.push(0,0,0),A[le]===void 0&&(A[le]=[]),A[le].push(d.length/3-1)}a.setAttribute("position",new Fi(d,3)),a.setAttribute("color",new Fi(m,3)),super(a,u),this.type="CameraHelper",this.camera=n,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=A,this.update();const N=new Si(16755200),K=new Si(16711680),$=new Si(43775),j=new Si(16777215),ne=new Si(3355443);this.setColors(N,K,$,j,ne)}setColors(n,a,u,d,m){const y=this.geometry.getAttribute("color");y.setXYZ(0,n.r,n.g,n.b),y.setXYZ(1,n.r,n.g,n.b),y.setXYZ(2,n.r,n.g,n.b),y.setXYZ(3,n.r,n.g,n.b),y.setXYZ(4,n.r,n.g,n.b),y.setXYZ(5,n.r,n.g,n.b),y.setXYZ(6,n.r,n.g,n.b),y.setXYZ(7,n.r,n.g,n.b),y.setXYZ(8,n.r,n.g,n.b),y.setXYZ(9,n.r,n.g,n.b),y.setXYZ(10,n.r,n.g,n.b),y.setXYZ(11,n.r,n.g,n.b),y.setXYZ(12,n.r,n.g,n.b),y.setXYZ(13,n.r,n.g,n.b),y.setXYZ(14,n.r,n.g,n.b),y.setXYZ(15,n.r,n.g,n.b),y.setXYZ(16,n.r,n.g,n.b),y.setXYZ(17,n.r,n.g,n.b),y.setXYZ(18,n.r,n.g,n.b),y.setXYZ(19,n.r,n.g,n.b),y.setXYZ(20,n.r,n.g,n.b),y.setXYZ(21,n.r,n.g,n.b),y.setXYZ(22,n.r,n.g,n.b),y.setXYZ(23,n.r,n.g,n.b),y.setXYZ(24,a.r,a.g,a.b),y.setXYZ(25,a.r,a.g,a.b),y.setXYZ(26,a.r,a.g,a.b),y.setXYZ(27,a.r,a.g,a.b),y.setXYZ(28,a.r,a.g,a.b),y.setXYZ(29,a.r,a.g,a.b),y.setXYZ(30,a.r,a.g,a.b),y.setXYZ(31,a.r,a.g,a.b),y.setXYZ(32,u.r,u.g,u.b),y.setXYZ(33,u.r,u.g,u.b),y.setXYZ(34,u.r,u.g,u.b),y.setXYZ(35,u.r,u.g,u.b),y.setXYZ(36,u.r,u.g,u.b),y.setXYZ(37,u.r,u.g,u.b),y.setXYZ(38,d.r,d.g,d.b),y.setXYZ(39,d.r,d.g,d.b),y.setXYZ(40,m.r,m.g,m.b),y.setXYZ(41,m.r,m.g,m.b),y.setXYZ(42,m.r,m.g,m.b),y.setXYZ(43,m.r,m.g,m.b),y.setXYZ(44,m.r,m.g,m.b),y.setXYZ(45,m.r,m.g,m.b),y.setXYZ(46,m.r,m.g,m.b),y.setXYZ(47,m.r,m.g,m.b),y.setXYZ(48,m.r,m.g,m.b),y.setXYZ(49,m.r,m.g,m.b),y.needsUpdate=!0}update(){const n=this.geometry,a=this.pointMap,u=1,d=1;Ea.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pa("c",a,n,Ea,0,0,-1),Pa("t",a,n,Ea,0,0,1),Pa("n1",a,n,Ea,-u,-d,-1),Pa("n2",a,n,Ea,u,-d,-1),Pa("n3",a,n,Ea,-u,d,-1),Pa("n4",a,n,Ea,u,d,-1),Pa("f1",a,n,Ea,-u,-d,1),Pa("f2",a,n,Ea,u,-d,1),Pa("f3",a,n,Ea,-u,d,1),Pa("f4",a,n,Ea,u,d,1),Pa("u1",a,n,Ea,u*.7,d*1.1,-1),Pa("u2",a,n,Ea,-u*.7,d*1.1,-1),Pa("u3",a,n,Ea,0,d*2,-1),Pa("cf1",a,n,Ea,-u,0,1),Pa("cf2",a,n,Ea,u,0,1),Pa("cf3",a,n,Ea,0,-d,1),Pa("cf4",a,n,Ea,0,d,1),Pa("cn1",a,n,Ea,-u,0,-1),Pa("cn2",a,n,Ea,u,0,-1),Pa("cn3",a,n,Ea,0,-d,-1),Pa("cn4",a,n,Ea,0,d,-1),n.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Pa(x,n,a,u,d,m,A){Xm.set(d,m,A).unproject(u);const y=n[x];if(y!==void 0){const k=a.getAttribute("position");for(let N=0,K=y.length;N<K;N++)k.setXYZ(y[N],Xm.x,Xm.y,Xm.z)}}const Qm=new ss;class BC extends Ic{constructor(n,a=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(8*3),m=new Or;m.setIndex(new Vt(u,1)),m.setAttribute("position",new Vt(d,3)),super(m,new Fa({color:a,toneMapped:!1})),this.object=n,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(n){if(n!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Qm.setFromObject(this.object),Qm.isEmpty())return;const a=Qm.min,u=Qm.max,d=this.geometry.attributes.position,m=d.array;m[0]=u.x,m[1]=u.y,m[2]=u.z,m[3]=a.x,m[4]=u.y,m[5]=u.z,m[6]=a.x,m[7]=a.y,m[8]=u.z,m[9]=u.x,m[10]=a.y,m[11]=u.z,m[12]=u.x,m[13]=u.y,m[14]=a.z,m[15]=a.x,m[16]=u.y,m[17]=a.z,m[18]=a.x,m[19]=a.y,m[20]=a.z,m[21]=u.x,m[22]=a.y,m[23]=a.z,d.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(n){return this.object=n,this.update(),this}copy(n,a){return super.copy(n,a),this.object=n.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class kC extends Ic{constructor(n,a=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],m=new Or;m.setIndex(new Vt(u,1)),m.setAttribute("position",new Fi(d,3)),super(m,new Fa({color:a,toneMapped:!1})),this.box=n,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(n){const a=this.box;a.isEmpty()||(a.getCenter(this.position),a.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(n))}dispose(){this.geometry.dispose(),this.material.dispose()}}class LC extends Uu{constructor(n,a=1,u=16776960){const d=u,m=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],A=new Or;A.setAttribute("position",new Fi(m,3)),A.computeBoundingSphere(),super(A,new Fa({color:d,toneMapped:!1})),this.type="PlaneHelper",this.plane=n,this.size=a;const y=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],k=new Or;k.setAttribute("position",new Fi(y,3)),k.computeBoundingSphere(),this.add(new lo(k,new _u({color:d,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(n){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const qv=new tt;let Zm,dA;class DC extends as{constructor(n=new tt(0,0,1),a=new tt(0,0,0),u=1,d=16776960,m=u*.2,A=m*.2){super(),this.type="ArrowHelper",Zm===void 0&&(Zm=new Or,Zm.setAttribute("position",new Fi([0,0,0,0,1,0],3)),dA=new Ph(0,.5,1,5,1),dA.translate(0,-.5,0)),this.position.copy(a),this.line=new Uu(Zm,new Fa({color:d,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new lo(dA,new _u({color:d,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(u,m,A)}setDirection(n){if(n.y>.99999)this.quaternion.set(0,0,0,1);else if(n.y<-.99999)this.quaternion.set(1,0,0,0);else{qv.set(n.z,0,-n.x).normalize();const a=Math.acos(n.y);this.quaternion.setFromAxisAngle(qv,a)}}setLength(n,a=n*.2,u=a*.2){this.line.scale.set(1,Math.max(1e-4,n-a),1),this.line.updateMatrix(),this.cone.scale.set(u,a,u),this.cone.position.y=n,this.cone.updateMatrix()}setColor(n){this.line.material.color.set(n),this.cone.material.color.set(n)}copy(n){return super.copy(n,!1),this.line.copy(n.line),this.cone.copy(n.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class ey extends Ic{constructor(n=1){const a=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],u=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],d=new Or;d.setAttribute("position",new Fi(a,3)),d.setAttribute("color",new Fi(u,3));const m=new Fa({vertexColors:!0,toneMapped:!1});super(d,m),this.type="AxesHelper"}setColors(n,a,u){const d=new Si,m=this.geometry.attributes.color.array;return d.set(n),d.toArray(m,0),d.toArray(m,3),d.set(a),d.toArray(m,6),d.toArray(m,9),d.set(u),d.toArray(m,12),d.toArray(m,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ty{constructor(){this.type="ShapePath",this.color=new Si,this.subPaths=[],this.currentPath=null}moveTo(n,a){return this.currentPath=new Lp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(n,a),this}lineTo(n,a){return this.currentPath.lineTo(n,a),this}quadraticCurveTo(n,a,u,d){return this.currentPath.quadraticCurveTo(n,a,u,d),this}bezierCurveTo(n,a,u,d,m,A){return this.currentPath.bezierCurveTo(n,a,u,d,m,A),this}splineThru(n){return this.currentPath.splineThru(n),this}toShapes(n){function a(ye){const Be=[];for(let Ee=0,Me=ye.length;Ee<Me;Ee++){const Fe=ye[Ee],it=new iu;it.curves=Fe.curves,Be.push(it)}return Be}function u(ye,Be){const Ee=Be.length;let Me=!1;for(let Fe=Ee-1,it=0;it<Ee;Fe=it++){let yt=Be[Fe],Le=Be[it],at=Le.x-yt.x,mt=Le.y-yt.y;if(Math.abs(mt)>Number.EPSILON){if(mt<0&&(yt=Be[it],at=-at,Le=Be[Fe],mt=-mt),ye.y<yt.y||ye.y>Le.y)continue;if(ye.y===yt.y){if(ye.x===yt.x)return!0}else{const Dt=mt*(ye.x-yt.x)-at*(ye.y-yt.y);if(Dt===0)return!0;if(Dt<0)continue;Me=!Me}}else{if(ye.y!==yt.y)continue;if(Le.x<=ye.x&&ye.x<=yt.x||yt.x<=ye.x&&ye.x<=Le.x)return!0}}return Me}const d=Sc.isClockWise,m=this.subPaths;if(m.length===0)return[];let A,y,k;const N=[];if(m.length===1)return y=m[0],k=new iu,k.curves=y.curves,N.push(k),N;let K=!d(m[0].getPoints());K=n?!K:K;const $=[],j=[];let ne=[],le=0,se;j[le]=void 0,ne[le]=[];for(let ye=0,Be=m.length;ye<Be;ye++)y=m[ye],se=y.getPoints(),A=d(se),A=n?!A:A,A?(!K&&j[le]&&le++,j[le]={s:new iu,p:se},j[le].s.curves=y.curves,K&&le++,ne[le]=[]):ne[le].push({h:y,p:se[0]});if(!j[0])return a(m);if(j.length>1){let ye=!1,Be=0;for(let Ee=0,Me=j.length;Ee<Me;Ee++)$[Ee]=[];for(let Ee=0,Me=j.length;Ee<Me;Ee++){const Fe=ne[Ee];for(let it=0;it<Fe.length;it++){const yt=Fe[it];let Le=!0;for(let at=0;at<j.length;at++)u(yt.p,j[at].p)&&(Ee!==at&&Be++,Le?(Le=!1,$[at].push(yt)):ye=!0);Le&&$[Ee].push(yt)}}Be>0&&ye===!1&&(ne=$)}let re;for(let ye=0,Be=j.length;ye<Be;ye++){k=j[ye].s,N.push(k),re=ne[ye];for(let Ee=0,Me=re.length;Ee<Me;Ee++)k.holes.push(re[Ee].h)}return N}}const hu=NC();function NC(){const x=new ArrayBuffer(4),n=new Float32Array(x),a=new Uint32Array(x),u=new Uint32Array(512),d=new Uint32Array(512);for(let k=0;k<256;++k){const N=k-127;N<-27?(u[k]=0,u[k|256]=32768,d[k]=24,d[k|256]=24):N<-14?(u[k]=1024>>-N-14,u[k|256]=1024>>-N-14|32768,d[k]=-N-1,d[k|256]=-N-1):N<=15?(u[k]=N+15<<10,u[k|256]=N+15<<10|32768,d[k]=13,d[k|256]=13):N<128?(u[k]=31744,u[k|256]=64512,d[k]=24,d[k|256]=24):(u[k]=31744,u[k|256]=64512,d[k]=13,d[k|256]=13)}const m=new Uint32Array(2048),A=new Uint32Array(64),y=new Uint32Array(64);for(let k=1;k<1024;++k){let N=k<<13,K=0;for(;!(N&8388608);)N<<=1,K-=8388608;N&=-8388609,K+=947912704,m[k]=N|K}for(let k=1024;k<2048;++k)m[k]=939524096+(k-1024<<13);for(let k=1;k<31;++k)A[k]=k<<23;A[31]=1199570944,A[32]=2147483648;for(let k=33;k<63;++k)A[k]=2147483648+(k-32<<23);A[63]=3347054592;for(let k=1;k<64;++k)k!==32&&(y[k]=1024);return{floatView:n,uint32View:a,baseTable:u,shiftTable:d,mantissaTable:m,exponentTable:A,offsetTable:y}}function FC(x){Math.abs(x)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),x=aa(x,-65504,65504),hu.floatView[0]=x;const n=hu.uint32View[0],a=n>>23&511;return hu.baseTable[a]+((n&8388607)>>hu.shiftTable[a])}function PC(x){const n=x>>10;return hu.uint32View[0]=hu.mantissaTable[hu.offsetTable[n]+(x&1023)]+hu.exponentTable[n],hu.floatView[0]}var OC=Object.freeze({__proto__:null,toHalfFloat:FC,fromHalfFloat:PC});function GC(){console.error("THREE.ImmediateRenderObject has been removed.")}class UC extends So{constructor(n,a,u){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(n,a,u),this.samples=4}}class VC extends Mu{constructor(n,a,u,d){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(n,a,u,d)}}class zC extends so{constructor(n,a,u,d){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(n,a,u,d)}}class WC extends bc{constructor(n,a,u,d,m,A){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(n,a,u,d,m,A)}}class HC extends Dp{constructor(n,a,u,d){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(n,a,u,d)}}class KC extends eu{constructor(n,a,u,d){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(n,a,u,d)}}class XC extends Vl{constructor(n,a,u,d,m,A,y){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(n,a,u,d,m,A,y)}}class QC extends Ph{constructor(n,a,u,d,m,A,y,k){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(n,a,u,d,m,A,y,k)}}class ZC extends nu{constructor(n,a){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(n,a)}}class $C extends Pp{constructor(n,a){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(n,a)}}class jC extends Op{constructor(n,a){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(n,a)}}class ny extends Od{constructor(n,a,u,d){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(n,a,u,d)}}class YC extends Wd{constructor(n,a){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(n,a)}}class JC extends Ed{constructor(n,a,u,d){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(n,a,u,d)}}class qC extends tu{constructor(n,a,u,d){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(n,a,u,d)}}class ew extends Gp{constructor(n,a,u,d,m,A){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(n,a,u,d,m,A)}}class tw extends Up{constructor(n,a){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(n,a)}}class nw extends Hd{constructor(n,a,u,d,m,A,y){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(n,a,u,d,m,A,y)}}class iw extends Gh{constructor(n,a){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(n,a)}}class rw extends Uh{constructor(n,a,u,d,m){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(n,a,u,d,m)}}class sw extends Vh{constructor(n,a,u,d,m,A){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(n,a,u,d,m,A)}}class aw extends zh{constructor(n,a,u,d,m){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(n,a,u,d,m)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:B}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=B)},"./node_modules/super-three/examples/jsm/libs/ktx-parse.module.js":(Z,te,E)=>{E.r(te),E.d(te,{KHR_DF_CHANNEL_RGBSDA_ALPHA:()=>De,KHR_DF_CHANNEL_RGBSDA_BLUE:()=>gn,KHR_DF_CHANNEL_RGBSDA_DEPTH:()=>Nt,KHR_DF_CHANNEL_RGBSDA_GREEN:()=>Dn,KHR_DF_CHANNEL_RGBSDA_RED:()=>wn,KHR_DF_CHANNEL_RGBSDA_STENCIL:()=>ui,KHR_DF_FLAG_ALPHA_PREMULTIPLIED:()=>W,KHR_DF_FLAG_ALPHA_STRAIGHT:()=>Y,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT:()=>M,KHR_DF_MODEL_ASTC:()=>V,KHR_DF_MODEL_ETC1:()=>_,KHR_DF_MODEL_ETC1S:()=>J,KHR_DF_MODEL_ETC2:()=>D,KHR_DF_MODEL_RGBSDA:()=>O,KHR_DF_MODEL_UNSPECIFIED:()=>I,KHR_DF_PRIMARIES_ACES:()=>dt,KHR_DF_PRIMARIES_ACESCC:()=>Ot,KHR_DF_PRIMARIES_ADOBERGB:()=>Pn,KHR_DF_PRIMARIES_BT2020:()=>ai,KHR_DF_PRIMARIES_BT601_EBU:()=>Wn,KHR_DF_PRIMARIES_BT601_SMPTE:()=>gi,KHR_DF_PRIMARIES_BT709:()=>yn,KHR_DF_PRIMARIES_CIEXYZ:()=>nt,KHR_DF_PRIMARIES_DISPLAYP3:()=>mn,KHR_DF_PRIMARIES_NTSC1953:()=>$t,KHR_DF_PRIMARIES_PAL525:()=>Ye,KHR_DF_PRIMARIES_UNSPECIFIED:()=>Jn,KHR_DF_SAMPLE_DATATYPE_EXPONENT:()=>Oe,KHR_DF_SAMPLE_DATATYPE_FLOAT:()=>Re,KHR_DF_SAMPLE_DATATYPE_LINEAR:()=>Qe,KHR_DF_SAMPLE_DATATYPE_SIGNED:()=>We,KHR_DF_TRANSFER_ACESCC:()=>Rt,KHR_DF_TRANSFER_ACESCCT:()=>fn,KHR_DF_TRANSFER_ADOBERGB:()=>cn,KHR_DF_TRANSFER_BT1886:()=>de,KHR_DF_TRANSFER_DCIP3:()=>Ve,KHR_DF_TRANSFER_HLG_EOTF:()=>we,KHR_DF_TRANSFER_HLG_OETF:()=>pe,KHR_DF_TRANSFER_ITU:()=>ve,KHR_DF_TRANSFER_LINEAR:()=>q,KHR_DF_TRANSFER_NTSC:()=>Ae,KHR_DF_TRANSFER_PAL625_EOTF:()=>et,KHR_DF_TRANSFER_PAL_OETF:()=>ze,KHR_DF_TRANSFER_PQ_EOTF:()=>he,KHR_DF_TRANSFER_PQ_OETF:()=>Pe,KHR_DF_TRANSFER_SLOG:()=>Se,KHR_DF_TRANSFER_SLOG2:()=>Ie,KHR_DF_TRANSFER_SRGB:()=>oe,KHR_DF_TRANSFER_ST240:()=>Tt,KHR_DF_TRANSFER_UNSPECIFIED:()=>U,KHR_DF_VENDORID_KHRONOS:()=>b,KHR_DF_VERSION:()=>S,KHR_SUPERCOMPRESSION_BASISLZ:()=>C,KHR_SUPERCOMPRESSION_NONE:()=>H,KHR_SUPERCOMPRESSION_ZLIB:()=>L,KHR_SUPERCOMPRESSION_ZSTD:()=>F,KTX2Container:()=>Vc,VK_FORMAT_A1R5G5B5_UNORM_PACK16:()=>Ue,VK_FORMAT_A2B10G10R10_SINT_PACK32:()=>Ui,VK_FORMAT_A2B10G10R10_SNORM_PACK32:()=>vi,VK_FORMAT_A2B10G10R10_UINT_PACK32:()=>An,VK_FORMAT_A2B10G10R10_UNORM_PACK32:()=>Ci,VK_FORMAT_A2R10G10B10_SINT_PACK32:()=>Fn,VK_FORMAT_A2R10G10B10_SNORM_PACK32:()=>Xt,VK_FORMAT_A2R10G10B10_UINT_PACK32:()=>En,VK_FORMAT_A2R10G10B10_UNORM_PACK32:()=>en,VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT:()=>ja,VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT:()=>Dl,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:()=>$a,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:()=>ql,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:()=>Ll,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:()=>Ac,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:()=>kn,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:()=>dp,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:()=>vd,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:()=>gd,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:()=>ro,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:()=>Qo,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:()=>vh,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:()=>pp,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:()=>ds,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:()=>Iu,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:()=>ml,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:()=>gl,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:()=>ma,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:()=>yh,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:()=>Bg,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:()=>dh,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:()=>hh,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:()=>Sf,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:()=>fh,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:()=>ph,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:()=>la,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:()=>gh,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:()=>mh,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:()=>tt,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:()=>dd,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:()=>hd,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:()=>bh,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:()=>fd,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:()=>pd,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:()=>Po,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:()=>hp,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:()=>md,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:()=>ss,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:()=>Ef,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:()=>Ah,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:()=>ca,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:()=>hs,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:()=>kl,VK_FORMAT_B10G11R11_UFLOAT_PACK32:()=>pl,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:()=>Uc,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:()=>gc,VK_FORMAT_B4G4R4A4_UNORM_PACK16:()=>Ct,VK_FORMAT_B5G5R5A1_UNORM_PACK16:()=>ae,VK_FORMAT_B5G6R5_UNORM_PACK16:()=>me,VK_FORMAT_B8G8R8A8_SINT:()=>st,VK_FORMAT_B8G8R8A8_SNORM:()=>vs,VK_FORMAT_B8G8R8A8_SRGB:()=>wt,VK_FORMAT_B8G8R8A8_UINT:()=>Ge,VK_FORMAT_B8G8R8A8_UNORM:()=>As,VK_FORMAT_B8G8R8_SINT:()=>nr,VK_FORMAT_B8G8R8_SNORM:()=>Yn,VK_FORMAT_B8G8R8_SRGB:()=>cr,VK_FORMAT_B8G8R8_UINT:()=>Gi,VK_FORMAT_B8G8R8_UNORM:()=>Oi,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:()=>Yl,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:()=>oh,VK_FORMAT_BC1_RGB_SRGB_BLOCK:()=>sd,VK_FORMAT_BC1_RGB_UNORM_BLOCK:()=>rd,VK_FORMAT_BC2_SRGB_BLOCK:()=>od,VK_FORMAT_BC2_UNORM_BLOCK:()=>ad,VK_FORMAT_BC3_SRGB_BLOCK:()=>wf,VK_FORMAT_BC3_UNORM_BLOCK:()=>Cf,VK_FORMAT_BC4_SNORM_BLOCK:()=>up,VK_FORMAT_BC4_UNORM_BLOCK:()=>cp,VK_FORMAT_BC5_SNORM_BLOCK:()=>ch,VK_FORMAT_BC5_UNORM_BLOCK:()=>lh,VK_FORMAT_BC6H_SFLOAT_BLOCK:()=>Cu,VK_FORMAT_BC6H_UFLOAT_BLOCK:()=>ld,VK_FORMAT_BC7_SRGB_BLOCK:()=>io,VK_FORMAT_BC7_UNORM_BLOCK:()=>wu,VK_FORMAT_D16_UNORM:()=>fl,VK_FORMAT_D16_UNORM_S8_UINT:()=>jl,VK_FORMAT_D24_UNORM_S8_UINT:()=>Js,VK_FORMAT_D32_SFLOAT:()=>Rl,VK_FORMAT_D32_SFLOAT_S8_UINT:()=>id,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:()=>fc,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:()=>mc,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:()=>uh,VK_FORMAT_EAC_R11_SNORM_BLOCK:()=>ud,VK_FORMAT_EAC_R11_UNORM_BLOCK:()=>cd,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:()=>Jl,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:()=>Bl,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:()=>aa,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:()=>Za,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:()=>Eu,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:()=>za,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:()=>Gc,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:()=>Tu,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:()=>So,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:()=>Ao,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:()=>Mu,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:()=>Rg,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:()=>If,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:()=>Ws,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:()=>so,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:()=>es,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:()=>Io,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:()=>oa,VK_FORMAT_R10X6_UNORM_PACK16:()=>Ad,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:()=>ec,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:()=>Si,VK_FORMAT_R12X4_UNORM_PACK16:()=>Su,VK_FORMAT_R16G16B16A16_SFLOAT:()=>Sn,VK_FORMAT_R16G16B16A16_SINT:()=>It,VK_FORMAT_R16G16B16A16_SNORM:()=>Xe,VK_FORMAT_R16G16B16A16_UINT:()=>At,VK_FORMAT_R16G16B16A16_UNORM:()=>_e,VK_FORMAT_R16G16B16_SFLOAT:()=>Ce,VK_FORMAT_R16G16B16_SINT:()=>ce,VK_FORMAT_R16G16B16_SNORM:()=>zr,VK_FORMAT_R16G16B16_UINT:()=>ie,VK_FORMAT_R16G16B16_UNORM:()=>zs,VK_FORMAT_R16G16_SFLOAT:()=>Cr,VK_FORMAT_R16G16_SINT:()=>di,VK_FORMAT_R16G16_SNORM:()=>Rs,VK_FORMAT_R16G16_UINT:()=>fa,VK_FORMAT_R16G16_UNORM:()=>Pr,VK_FORMAT_R16_SFLOAT:()=>pr,VK_FORMAT_R16_SINT:()=>Tr,VK_FORMAT_R16_SNORM:()=>ir,VK_FORMAT_R16_UINT:()=>us,VK_FORMAT_R16_UNORM:()=>Hi,VK_FORMAT_R32G32B32A32_SFLOAT:()=>Qr,VK_FORMAT_R32G32B32A32_SINT:()=>ys,VK_FORMAT_R32G32B32A32_UINT:()=>er,VK_FORMAT_R32G32B32_SFLOAT:()=>ur,VK_FORMAT_R32G32B32_SINT:()=>br,VK_FORMAT_R32G32B32_UINT:()=>Vi,VK_FORMAT_R32G32_SFLOAT:()=>Ii,VK_FORMAT_R32G32_SINT:()=>fi,VK_FORMAT_R32G32_UINT:()=>Bn,VK_FORMAT_R32_SFLOAT:()=>rn,VK_FORMAT_R32_SINT:()=>Lt,VK_FORMAT_R32_UINT:()=>vn,VK_FORMAT_R4G4B4A4_UNORM_PACK16:()=>ct,VK_FORMAT_R4G4_UNORM_PACK8:()=>vt,VK_FORMAT_R5G5B5A1_UNORM_PACK16:()=>ee,VK_FORMAT_R5G6B5_UNORM_PACK16:()=>Yt,VK_FORMAT_R64G64B64A64_SFLOAT:()=>Ml,VK_FORMAT_R64G64B64A64_SINT:()=>dl,VK_FORMAT_R64G64B64A64_UINT:()=>Fo,VK_FORMAT_R64G64B64_SFLOAT:()=>Tl,VK_FORMAT_R64G64B64_SINT:()=>no,VK_FORMAT_R64G64B64_UINT:()=>Bs,VK_FORMAT_R64G64_SFLOAT:()=>Va,VK_FORMAT_R64G64_SINT:()=>Ua,VK_FORMAT_R64G64_UINT:()=>Ps,VK_FORMAT_R64_SFLOAT:()=>Ys,VK_FORMAT_R64_SINT:()=>Is,VK_FORMAT_R64_UINT:()=>gr,VK_FORMAT_R8G8B8A8_SINT:()=>ws,VK_FORMAT_R8G8B8A8_SNORM:()=>Fr,VK_FORMAT_R8G8B8A8_SRGB:()=>vr,VK_FORMAT_R8G8B8A8_UINT:()=>$r,VK_FORMAT_R8G8B8A8_UNORM:()=>Xr,VK_FORMAT_R8G8B8_SINT:()=>hn,VK_FORMAT_R8G8B8_SNORM:()=>Dr,VK_FORMAT_R8G8B8_SRGB:()=>On,VK_FORMAT_R8G8B8_UINT:()=>ti,VK_FORMAT_R8G8B8_UNORM:()=>Vs,VK_FORMAT_R8G8_SINT:()=>_s,VK_FORMAT_R8G8_SNORM:()=>Ai,VK_FORMAT_R8G8_SRGB:()=>Fs,VK_FORMAT_R8G8_UINT:()=>lr,VK_FORMAT_R8G8_UNORM:()=>ri,VK_FORMAT_R8_SINT:()=>hi,VK_FORMAT_R8_SNORM:()=>ft,VK_FORMAT_R8_SRGB:()=>bi,VK_FORMAT_R8_UINT:()=>Ft,VK_FORMAT_R8_UNORM:()=>ht,VK_FORMAT_S8_UINT:()=>$l,VK_FORMAT_UNDEFINED:()=>Ke,VK_FORMAT_X8_D24_UNORM_PACK32:()=>_l,read:()=>tc,write:()=>Ch});var B=E("./node_modules/buffer/index.js").Buffer;const H=0,C=1,F=2,L=3,M=0,b=0,S=2,I=0,O=1,_=160,D=161,V=162,J=163,Y=0,W=1,U=0,q=1,oe=2,ve=3,Ae=4,Se=5,Ie=6,de=7,pe=8,we=9,he=10,Pe=11,Ve=12,ze=13,et=14,Tt=15,Rt=16,fn=17,cn=18,Jn=0,yn=1,Wn=2,gi=3,ai=4,nt=5,dt=6,Ot=7,$t=8,Ye=9,mn=10,Pn=11,wn=0,Dn=1,gn=2,ui=13,Nt=14,De=15,Re=128,We=64,Oe=32,Qe=16,Ke=0,vt=1,ct=2,Ct=3,Yt=4,me=5,ee=6,ae=7,Ue=8,ht=9,ft=10,Ft=13,hi=14,bi=15,ri=16,Ai=17,lr=20,_s=21,Fs=22,Vs=23,Dr=24,ti=27,hn=28,On=29,Oi=30,Yn=31,Gi=34,nr=35,cr=36,Xr=37,Fr=38,$r=41,ws=42,vr=43,As=44,vs=45,Ge=48,st=49,wt=50,en=58,Xt=59,En=62,Fn=63,Ci=64,vi=65,An=68,Ui=69,Hi=70,ir=71,us=74,Tr=75,pr=76,Pr=77,Rs=78,fa=81,di=82,Cr=83,zs=84,zr=85,ie=88,ce=89,Ce=90,_e=91,Xe=92,At=95,It=96,Sn=97,vn=98,Lt=99,rn=100,Bn=101,fi=102,Ii=103,Vi=104,br=105,ur=106,er=107,ys=108,Qr=109,gr=110,Is=111,Ys=112,Ps=113,Ua=114,Va=115,Bs=116,no=117,Tl=118,Fo=119,dl=120,Ml=121,pl=122,fc=123,fl=124,_l=125,Rl=126,$l=127,jl=128,Js=129,id=130,rd=131,sd=132,oh=133,Yl=134,ad=135,od=136,Cf=137,wf=138,cp=139,up=140,lh=141,ch=142,ld=143,Cu=144,wu=145,io=146,za=147,Eu=148,Bl=149,Jl=150,Za=151,aa=152,cd=153,ud=154,uh=155,mc=156,hh=157,dh=158,ph=159,fh=160,mh=161,gh=162,hd=163,dd=164,pd=165,fd=166,md=167,hp=168,Ah=169,Ef=170,kl=171,hs=172,dp=173,kn=174,ro=175,gd=176,pp=177,vh=178,Ll=179,ql=180,ml=181,Iu=182,yh=183,ma=184,Ad=1000156007,oa=1000156008,Io=1000156009,Gc=1000156010,Uc=1000156011,Su=1000156017,Si=1000156018,ec=1000156019,Tu=1000156020,gc=1000156021,Ao=1000054e3,Rg=1000054001,Ws=1000054002,es=1000054003,So=1000054004,Mu=1000054005,If=1000054006,so=1000054007,Bg=1000066e3,Sf=1000066001,la=1000066002,tt=1000066003,bh=1000066004,Po=1000066005,ss=1000066006,ca=1000066007,Ac=1000066008,vd=1000066009,Qo=1000066010,$a=1000066011,ds=1000066012,gl=1000066013,Dl=100034e4,ja=1000340001;class Vc{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class vc{constructor(hr,fr,Un,ts){this._dataView=new DataView(hr.buffer,hr.byteOffset+fr,Un),this._littleEndian=ts,this._offset=0}_nextUint8(){const hr=this._dataView.getUint8(this._offset);return this._offset+=1,hr}_nextUint16(){const hr=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,hr}_nextUint32(){const hr=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,hr}_nextUint64(){const hr=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,hr}_nextInt32(){const hr=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,hr}_skip(hr){return this._offset+=hr,this}_scan(hr,fr=0){const Un=this._offset;let ts=0;for(;this._dataView.getUint8(this._offset)!==fr&&ts<hr;)ts++,this._offset++;return ts<hr&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+Un,ts)}}const Nl=new Uint8Array([0]),Hs=[171,75,84,88,32,50,48,187,13,10,26,10];function xh(Ti){return typeof TextEncoder<"u"?new TextEncoder().encode(Ti):B.from(Ti)}function fp(Ti){return typeof TextDecoder<"u"?new TextDecoder().decode(Ti):B.from(Ti).toString("utf8")}function Ma(Ti){let hr=0;for(const ts of Ti)hr+=ts.byteLength;const fr=new Uint8Array(hr);let Un=0;for(const ts of Ti)fr.set(new Uint8Array(ts),Un),Un+=ts.byteLength;return fr}function tc(Ti){const hr=new Uint8Array(Ti.buffer,Ti.byteOffset,Hs.length);if(hr[0]!==Hs[0]||hr[1]!==Hs[1]||hr[2]!==Hs[2]||hr[3]!==Hs[3]||hr[4]!==Hs[4]||hr[5]!==Hs[5]||hr[6]!==Hs[6]||hr[7]!==Hs[7]||hr[8]!==Hs[8]||hr[9]!==Hs[9]||hr[10]!==Hs[10]||hr[11]!==Hs[11])throw new Error("Missing KTX 2.0 identifier.");const fr=new Vc,Un=17*Uint32Array.BYTES_PER_ELEMENT,ts=new vc(Ti,Hs.length,Un,!0);fr.vkFormat=ts._nextUint32(),fr.typeSize=ts._nextUint32(),fr.pixelWidth=ts._nextUint32(),fr.pixelHeight=ts._nextUint32(),fr.pixelDepth=ts._nextUint32(),fr.layerCount=ts._nextUint32(),fr.faceCount=ts._nextUint32();const _a=ts._nextUint32();fr.supercompressionScheme=ts._nextUint32();const Ri=ts._nextUint32(),Oo=ts._nextUint32(),Er=ts._nextUint32(),Ra=ts._nextUint32(),zc=ts._nextUint64(),vo=ts._nextUint64(),Br=new vc(Ti,Hs.length+Un,3*_a*8,!0);for(let ga=0;ga<_a;ga++)fr.levels.push({levelData:new Uint8Array(Ti.buffer,Ti.byteOffset+Br._nextUint64(),Br._nextUint64()),uncompressedByteLength:Br._nextUint64()});const Ar=new vc(Ti,Ri,Oo,!0),ks={vendorId:Ar._skip(4)._nextUint16(),descriptorType:Ar._nextUint16(),versionNumber:Ar._nextUint16(),descriptorBlockSize:Ar._nextUint16(),colorModel:Ar._nextUint8(),colorPrimaries:Ar._nextUint8(),transferFunction:Ar._nextUint8(),flags:Ar._nextUint8(),texelBlockDimension:[Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8()],bytesPlane:[Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8()],samples:[]},Zo=(ks.descriptorBlockSize/4-6)/4;for(let ga=0;ga<Zo;ga++){const bo={bitOffset:Ar._nextUint16(),bitLength:Ar._nextUint8(),channelType:Ar._nextUint8(),samplePosition:[Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8(),Ar._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&bo.channelType?(bo.sampleLower=Ar._nextInt32(),bo.sampleUpper=Ar._nextInt32()):(bo.sampleLower=Ar._nextUint32(),bo.sampleUpper=Ar._nextUint32()),ks.samples[ga]=bo}fr.dataFormatDescriptor.length=0,fr.dataFormatDescriptor.push(ks);const yo=new vc(Ti,Er,Ra,!0);for(;yo._offset<Ra;){const ga=yo._nextUint32(),bo=yo._scan(ga),$o=fp(bo),Hc=yo._scan(ga-bo.byteLength);fr.keyValue[$o]=$o.match(/^ktx/i)?fp(Hc):Hc,yo._offset%4&&yo._skip(4-yo._offset%4)}if(vo<=0)return fr;const jr=new vc(Ti,zc,vo,!0),Ks=jr._nextUint16(),Wr=jr._nextUint16(),ps=jr._nextUint32(),xa=jr._nextUint32(),Ya=jr._nextUint32(),Wc=jr._nextUint32(),nc=[];for(let ga=0;ga<_a;ga++)nc.push({imageFlags:jr._nextUint32(),rgbSliceByteOffset:jr._nextUint32(),rgbSliceByteLength:jr._nextUint32(),alphaSliceByteOffset:jr._nextUint32(),alphaSliceByteLength:jr._nextUint32()});const ao=zc+jr._offset,Go=ao+ps,Pl=Go+xa,Tf=Pl+Ya,kg=new Uint8Array(Ti.buffer,Ti.byteOffset+ao,ps),Mf=new Uint8Array(Ti.buffer,Ti.byteOffset+Go,xa),as=new Uint8Array(Ti.buffer,Ti.byteOffset+Pl,Ya),Al=new Uint8Array(Ti.buffer,Ti.byteOffset+Tf,Wc);return fr.globalData={endpointCount:Ks,selectorCount:Wr,imageDescs:nc,endpointsData:kg,selectorsData:Mf,tablesData:as,extendedData:Al},fr}function To(){return(To=Object.assign||function(Ti){for(var hr=1;hr<arguments.length;hr++){var fr=arguments[hr];for(var Un in fr)Object.prototype.hasOwnProperty.call(fr,Un)&&(Ti[Un]=fr[Un])}return Ti}).apply(this,arguments)}const Fl={keepWriter:!1};function Ch(Ti,hr={}){hr=To({},Fl,hr);let fr=new ArrayBuffer(0);if(Ti.globalData){const Ks=new ArrayBuffer(20+5*Ti.globalData.imageDescs.length*4),Wr=new DataView(Ks);Wr.setUint16(0,Ti.globalData.endpointCount,!0),Wr.setUint16(2,Ti.globalData.selectorCount,!0),Wr.setUint32(4,Ti.globalData.endpointsData.byteLength,!0),Wr.setUint32(8,Ti.globalData.selectorsData.byteLength,!0),Wr.setUint32(12,Ti.globalData.tablesData.byteLength,!0),Wr.setUint32(16,Ti.globalData.extendedData.byteLength,!0);for(let ps=0;ps<Ti.globalData.imageDescs.length;ps++){const xa=Ti.globalData.imageDescs[ps];Wr.setUint32(20+5*ps*4+0,xa.imageFlags,!0),Wr.setUint32(20+5*ps*4+4,xa.rgbSliceByteOffset,!0),Wr.setUint32(20+5*ps*4+8,xa.rgbSliceByteLength,!0),Wr.setUint32(20+5*ps*4+12,xa.alphaSliceByteOffset,!0),Wr.setUint32(20+5*ps*4+16,xa.alphaSliceByteLength,!0)}fr=Ma([Ks,Ti.globalData.endpointsData,Ti.globalData.selectorsData,Ti.globalData.tablesData,Ti.globalData.extendedData])}const Un=[];let ts=Ti.keyValue;hr.keepWriter||(ts=To({},Ti.keyValue,{KTXwriter:"KTX-Parse v0.3.1"}));for(const Ks in ts){const Wr=ts[Ks],ps=xh(Ks),xa=typeof Wr=="string"?xh(Wr):Wr,Ya=ps.byteLength+1+xa.byteLength+1,Wc=Ya%4?4-Ya%4:0;Un.push(Ma([new Uint32Array([Ya]),ps,Nl,xa,Nl,new Uint8Array(Wc).fill(0)]))}const _a=Ma(Un);if(Ti.dataFormatDescriptor.length!==1||Ti.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const Ri=Ti.dataFormatDescriptor[0],Oo=new ArrayBuffer(28+16*Ri.samples.length),Er=new DataView(Oo),Ra=24+16*Ri.samples.length;if(Er.setUint32(0,Oo.byteLength,!0),Er.setUint16(4,Ri.vendorId,!0),Er.setUint16(6,Ri.descriptorType,!0),Er.setUint16(8,Ri.versionNumber,!0),Er.setUint16(10,Ra,!0),Er.setUint8(12,Ri.colorModel),Er.setUint8(13,Ri.colorPrimaries),Er.setUint8(14,Ri.transferFunction),Er.setUint8(15,Ri.flags),!Array.isArray(Ri.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");Er.setUint8(16,Ri.texelBlockDimension[0]),Er.setUint8(17,Ri.texelBlockDimension[1]),Er.setUint8(18,Ri.texelBlockDimension[2]),Er.setUint8(19,Ri.texelBlockDimension[3]);for(let Ks=0;Ks<8;Ks++)Er.setUint8(20+Ks,Ri.bytesPlane[Ks]);for(let Ks=0;Ks<Ri.samples.length;Ks++){const Wr=Ri.samples[Ks],ps=28+16*Ks;if(Wr.channelID)throw new Error("channelID has been renamed to channelType.");Er.setUint16(ps+0,Wr.bitOffset,!0),Er.setUint8(ps+2,Wr.bitLength),Er.setUint8(ps+3,Wr.channelType),Er.setUint8(ps+4,Wr.samplePosition[0]),Er.setUint8(ps+5,Wr.samplePosition[1]),Er.setUint8(ps+6,Wr.samplePosition[2]),Er.setUint8(ps+7,Wr.samplePosition[3]),64&Wr.channelType?(Er.setInt32(ps+8,Wr.sampleLower,!0),Er.setInt32(ps+12,Wr.sampleUpper,!0)):(Er.setUint32(ps+8,Wr.sampleLower,!0),Er.setUint32(ps+12,Wr.sampleUpper,!0))}const zc=Hs.length+68+3*Ti.levels.length*8,vo=zc+Oo.byteLength;let Br=fr.byteLength>0?vo+_a.byteLength:0;Br%8&&(Br+=8-Br%8);const Ar=[],ks=new DataView(new ArrayBuffer(3*Ti.levels.length*8));let Zo=(Br||vo+_a.byteLength)+fr.byteLength;for(let Ks=0;Ks<Ti.levels.length;Ks++){const Wr=Ti.levels[Ks];Ar.push(Wr.levelData),ks.setBigUint64(24*Ks+0,BigInt(Zo),!0),ks.setBigUint64(24*Ks+8,BigInt(Wr.levelData.byteLength),!0),ks.setBigUint64(24*Ks+16,BigInt(Wr.uncompressedByteLength),!0),Zo+=Wr.levelData.byteLength}const yo=new ArrayBuffer(68),jr=new DataView(yo);return jr.setUint32(0,Ti.vkFormat,!0),jr.setUint32(4,Ti.typeSize,!0),jr.setUint32(8,Ti.pixelWidth,!0),jr.setUint32(12,Ti.pixelHeight,!0),jr.setUint32(16,Ti.pixelDepth,!0),jr.setUint32(20,Ti.layerCount,!0),jr.setUint32(24,Ti.faceCount,!0),jr.setUint32(28,Ti.levels.length,!0),jr.setUint32(32,Ti.supercompressionScheme,!0),jr.setUint32(36,zc,!0),jr.setUint32(40,Oo.byteLength,!0),jr.setUint32(44,vo,!0),jr.setUint32(48,_a.byteLength,!0),jr.setBigUint64(52,BigInt(fr.byteLength>0?Br:0),!0),jr.setBigUint64(60,BigInt(fr.byteLength),!0),new Uint8Array(Ma([new Uint8Array(Hs).buffer,yo,ks.buffer,Oo,_a,Br>0?new ArrayBuffer(Br-(vo+_a.byteLength)):new ArrayBuffer(0),fr,...Ar]))}},"./node_modules/super-three/examples/jsm/libs/zstddec.module.js":(Z,te,E)=>{E.r(te),E.d(te,{ZSTDDecoder:()=>M});var B=E("./node_modules/buffer/index.js").Buffer;let H,C,F;const L={env:{emscripten_notify_memory_growth:function(S){F=new Uint8Array(C.exports.memory.buffer)}}};class M{init(){return H||(H=typeof fetch<"u"?fetch("data:application/wasm;base64,"+b).then(I=>I.arrayBuffer()).then(I=>WebAssembly.instantiate(I,L)).then(this._init):WebAssembly.instantiate(B.from(b,"base64"),L).then(this._init),H)}_init(I){C=I.instance,L.env.emscripten_notify_memory_growth(0)}decode(I,O=0){if(!C)throw new Error("ZSTDDecoder: Await .init() before decoding.");const _=I.byteLength,D=C.exports.malloc(_);F.set(I,D),O=O||Number(C.exports.ZSTD_findDecompressedSize(D,_));const V=C.exports.malloc(O),J=C.exports.ZSTD_decompress(V,O,D,_),Y=F.slice(V,V+J);return C.exports.free(D),C.exports.free(V),Y}}const b="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"},"./node_modules/super-three/examples/jsm/lights/LightProbeGenerator.js":(Z,te,E)=>{E.r(te),E.d(te,{LightProbeGenerator:()=>H});var B=E("./node_modules/super-three/build/three.module.js");class H{static fromCubeTexture(L){let M=0;const b=new B.Vector3,S=new B.Vector3,I=new B.Color,O=[0,0,0,0,0,0,0,0,0],_=new B.SphericalHarmonics3,D=_.coefficients;for(let J=0;J<6;J++){const Y=L.image[J],W=Y.width,U=Y.height,q=document.createElement("canvas");q.width=W,q.height=U;const oe=q.getContext("2d");oe.drawImage(Y,0,0,W,U);const ve=oe.getImageData(0,0,W,U),Ae=ve.data,Se=ve.width,Ie=2/Se;for(let de=0,pe=Ae.length;de<pe;de+=4){I.setRGB(Ae[de]/255,Ae[de+1]/255,Ae[de+2]/255),C(I,L.encoding);const we=de/4,he=-1+(we%Se+.5)*Ie,Pe=1-(Math.floor(we/Se)+.5)*Ie;switch(J){case 0:b.set(-1,Pe,-he);break;case 1:b.set(1,Pe,he);break;case 2:b.set(-he,1,-Pe);break;case 3:b.set(-he,-1,Pe);break;case 4:b.set(-he,Pe,1);break;case 5:b.set(he,Pe,-1);break}const Ve=b.lengthSq(),ze=4/(Math.sqrt(Ve)*Ve);M+=ze,S.copy(b).normalize(),B.SphericalHarmonics3.getBasisAt(S,O);for(let et=0;et<9;et++)D[et].x+=O[et]*I.r*ze,D[et].y+=O[et]*I.g*ze,D[et].z+=O[et]*I.b*ze}}const V=4*Math.PI/M;for(let J=0;J<9;J++)D[J].x*=V,D[J].y*=V,D[J].z*=V;return new B.LightProbe(_)}static fromCubeRenderTarget(L,M){let b=0;const S=new B.Vector3,I=new B.Vector3,O=new B.Color,_=[0,0,0,0,0,0,0,0,0],D=new B.SphericalHarmonics3,V=D.coefficients;for(let Y=0;Y<6;Y++){const W=M.width,U=new Uint8Array(W*W*4);L.readRenderTargetPixels(M,0,0,W,W,U,Y);const q=2/W;for(let oe=0,ve=U.length;oe<ve;oe+=4){O.setRGB(U[oe]/255,U[oe+1]/255,U[oe+2]/255),C(O,M.texture.encoding);const Ae=oe/4,Se=-1+(Ae%W+.5)*q,Ie=1-(Math.floor(Ae/W)+.5)*q;switch(Y){case 0:S.set(1,Ie,-Se);break;case 1:S.set(-1,Ie,Se);break;case 2:S.set(Se,1,-Ie);break;case 3:S.set(Se,-1,Ie);break;case 4:S.set(Se,Ie,1);break;case 5:S.set(-Se,Ie,-1);break}const de=S.lengthSq(),pe=4/(Math.sqrt(de)*de);b+=pe,I.copy(S).normalize(),B.SphericalHarmonics3.getBasisAt(I,_);for(let we=0;we<9;we++)V[we].x+=_[we]*O.r*pe,V[we].y+=_[we]*O.g*pe,V[we].z+=_[we]*O.b*pe}}const J=4*Math.PI/b;for(let Y=0;Y<9;Y++)V[Y].x*=J,V[Y].y*=J,V[Y].z*=J;return new B.LightProbe(D)}}function C(F,L){switch(L){case B.sRGBEncoding:F.convertSRGBToLinear();break;case B.LinearEncoding:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.");break}return F}},"./node_modules/super-three/examples/jsm/loaders/DRACOLoader.js":(Z,te,E)=>{E.r(te),E.d(te,{DRACOLoader:()=>C});var B=E("./node_modules/super-three/build/three.module.js");const H=new WeakMap;class C extends B.Loader{constructor(M){super(M),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(M){return this.decoderPath=M,this}setDecoderConfig(M){return this.decoderConfig=M,this}setWorkerLimit(M){return this.workerLimit=M,this}load(M,b,S,I){const O=new B.FileLoader(this.manager);O.setPath(this.path),O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(M,_=>{this.decodeDracoFile(_,b).catch(I)},S,I)}decodeDracoFile(M,b,S,I){const O={attributeIDs:S||this.defaultAttributeIDs,attributeTypes:I||this.defaultAttributeTypes,useUniqueIDs:!!S};return this.decodeGeometry(M,O).then(b)}decodeGeometry(M,b){const S=JSON.stringify(b);if(H.has(M)){const V=H.get(M);if(V.key===S)return V.promise;if(M.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let I;const O=this.workerNextTaskID++,_=M.byteLength,D=this._getWorker(O,_).then(V=>(I=V,new Promise((J,Y)=>{I._callbacks[O]={resolve:J,reject:Y},I.postMessage({type:"decode",id:O,taskConfig:b,buffer:M},[M])}))).then(V=>this._createGeometry(V.geometry));return D.catch(()=>!0).then(()=>{I&&O&&this._releaseTask(I,O)}),H.set(M,{key:S,promise:D}),D}_createGeometry(M){const b=new B.BufferGeometry;M.index&&b.setIndex(new B.BufferAttribute(M.index.array,1));for(let S=0;S<M.attributes.length;S++){const I=M.attributes[S],O=I.name,_=I.array,D=I.itemSize;b.setAttribute(O,new B.BufferAttribute(_,D))}return b}_loadLibrary(M,b){const S=new B.FileLoader(this.manager);return S.setPath(this.decoderPath),S.setResponseType(b),S.setWithCredentials(this.withCredentials),new Promise((I,O)=>{S.load(M,I,void 0,O)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const M=typeof WebAssembly!="object"||this.decoderConfig.type==="js",b=[];return M?b.push(this._loadLibrary("draco_decoder.js","text")):(b.push(this._loadLibrary("draco_wasm_wrapper.js","text")),b.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(b).then(S=>{const I=S[0];M||(this.decoderConfig.wasmBinary=S[1]);const O=F.toString(),_=["/* draco decoder */",I,"","/* worker */",O.substring(O.indexOf("{")+1,O.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([_]))}),this.decoderPending}_getWorker(M,b){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const I=new Worker(this.workerSourceURL);I._callbacks={},I._taskCosts={},I._taskLoad=0,I.postMessage({type:"init",decoderConfig:this.decoderConfig}),I.onmessage=function(O){const _=O.data;switch(_.type){case"decode":I._callbacks[_.id].resolve(_);break;case"error":I._callbacks[_.id].reject(_);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+_.type+'"')}},this.workerPool.push(I)}else this.workerPool.sort(function(I,O){return I._taskLoad>O._taskLoad?-1:1});const S=this.workerPool[this.workerPool.length-1];return S._taskCosts[M]=b,S._taskLoad+=b,S})}_releaseTask(M,b){M._taskLoad-=M._taskCosts[b],delete M._callbacks[b],delete M._taskCosts[b]}debug(){console.log("Task load: ",this.workerPool.map(M=>M._taskLoad))}dispose(){for(let M=0;M<this.workerPool.length;++M)this.workerPool[M].terminate();return this.workerPool.length=0,this}}function F(){let L,M;onmessage=function(_){const D=_.data;switch(D.type){case"init":L=D.decoderConfig,M=new Promise(function(Y){L.onModuleLoaded=function(W){Y({draco:W})},DracoDecoderModule(L)});break;case"decode":const V=D.buffer,J=D.taskConfig;M.then(Y=>{const W=Y.draco,U=new W.Decoder,q=new W.DecoderBuffer;q.Init(new Int8Array(V),V.byteLength);try{const oe=b(W,U,q,J),ve=oe.attributes.map(Ae=>Ae.array.buffer);oe.index&&ve.push(oe.index.array.buffer),self.postMessage({type:"decode",id:D.id,geometry:oe},ve)}catch(oe){console.error(oe),self.postMessage({type:"error",id:D.id,error:oe.message})}finally{W.destroy(q),W.destroy(U)}});break}};function b(_,D,V,J){const Y=J.attributeIDs,W=J.attributeTypes;let U,q;const oe=D.GetEncodedGeometryType(V);if(oe===_.TRIANGULAR_MESH)U=new _.Mesh,q=D.DecodeBufferToMesh(V,U);else if(oe===_.POINT_CLOUD)U=new _.PointCloud,q=D.DecodeBufferToPointCloud(V,U);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!q.ok()||U.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+q.error_msg());const ve={index:null,attributes:[]};for(const Ae in Y){const Se=self[W[Ae]];let Ie,de;if(J.useUniqueIDs)de=Y[Ae],Ie=D.GetAttributeByUniqueId(U,de);else{if(de=D.GetAttributeId(U,_[Y[Ae]]),de===-1)continue;Ie=D.GetAttribute(U,de)}ve.attributes.push(I(_,D,U,Ae,Se,Ie))}return oe===_.TRIANGULAR_MESH&&(ve.index=S(_,D,U)),_.destroy(U),ve}function S(_,D,V){const Y=V.num_faces()*3,W=Y*4,U=_._malloc(W);D.GetTrianglesUInt32Array(V,W,U);const q=new Uint32Array(_.HEAPF32.buffer,U,Y).slice();return _._free(U),{array:q,itemSize:1}}function I(_,D,V,J,Y,W){const U=W.num_components(),oe=V.num_points()*U,ve=oe*Y.BYTES_PER_ELEMENT,Ae=O(_,Y),Se=_._malloc(ve);D.GetAttributeDataArrayForAllPoints(V,W,Ae,ve,Se);const Ie=new Y(_.HEAPF32.buffer,Se,oe).slice();return _._free(Se),{name:J,array:Ie,itemSize:U}}function O(_,D){switch(D){case Float32Array:return _.DT_FLOAT32;case Int8Array:return _.DT_INT8;case Int16Array:return _.DT_INT16;case Int32Array:return _.DT_INT32;case Uint8Array:return _.DT_UINT8;case Uint16Array:return _.DT_UINT16;case Uint32Array:return _.DT_UINT32}}}},"./node_modules/super-three/examples/jsm/loaders/GLTFLoader.js":(Z,te,E)=>{E.r(te),E.d(te,{GLTFLoader:()=>H});var B=E("./node_modules/super-three/build/three.module.js");class H extends B.Loader{constructor(De){super(De),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Re){return new S(Re)}),this.register(function(Re){return new Y(Re)}),this.register(function(Re){return new W(Re)}),this.register(function(Re){return new O(Re)}),this.register(function(Re){return new _(Re)}),this.register(function(Re){return new D(Re)}),this.register(function(Re){return new V(Re)}),this.register(function(Re){return new b(Re)}),this.register(function(Re){return new J(Re)}),this.register(function(Re){return new I(Re)}),this.register(function(Re){return new L(Re)}),this.register(function(Re){return new U(Re)}),this.register(function(Re){return new q(Re)})}load(De,Re,We,Oe){const Qe=this;let Ke;this.resourcePath!==""?Ke=this.resourcePath:this.path!==""?Ke=this.path:Ke=B.LoaderUtils.extractUrlBase(De),this.manager.itemStart(De);const vt=function(Ct){Oe?Oe(Ct):console.error(Ct),Qe.manager.itemError(De),Qe.manager.itemEnd(De)},ct=new B.FileLoader(this.manager);ct.setPath(this.path),ct.setResponseType("arraybuffer"),ct.setRequestHeader(this.requestHeader),ct.setWithCredentials(this.withCredentials),ct.load(De,function(Ct){try{Qe.parse(Ct,Ke,function(Yt){Re(Yt),Qe.manager.itemEnd(De)},vt)}catch(Yt){vt(Yt)}},We,vt)}setDRACOLoader(De){return this.dracoLoader=De,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(De){return this.ktx2Loader=De,this}setMeshoptDecoder(De){return this.meshoptDecoder=De,this}register(De){return this.pluginCallbacks.indexOf(De)===-1&&this.pluginCallbacks.push(De),this}unregister(De){return this.pluginCallbacks.indexOf(De)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(De),1),this}parse(De,Re,We,Oe){let Qe;const Ke={},vt={};if(typeof De=="string")Qe=JSON.parse(De);else if(De instanceof ArrayBuffer)if(B.LoaderUtils.decodeText(new Uint8Array(De,0,4))===oe){try{Ke[F.KHR_BINARY_GLTF]=new Se(De)}catch(Yt){Oe&&Oe(Yt);return}Qe=JSON.parse(Ke[F.KHR_BINARY_GLTF].content)}else Qe=JSON.parse(B.LoaderUtils.decodeText(new Uint8Array(De)));else Qe=De;if(Qe.asset===void 0||Qe.asset.version[0]<2){Oe&&Oe(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const ct=new Pn(Qe,{path:Re||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});ct.fileLoader.setRequestHeader(this.requestHeader);for(let Ct=0;Ct<this.pluginCallbacks.length;Ct++){const Yt=this.pluginCallbacks[Ct](ct);vt[Yt.name]=Yt,Ke[Yt.name]=!0}if(Qe.extensionsUsed)for(let Ct=0;Ct<Qe.extensionsUsed.length;++Ct){const Yt=Qe.extensionsUsed[Ct],me=Qe.extensionsRequired||[];switch(Yt){case F.KHR_MATERIALS_UNLIT:Ke[Yt]=new M;break;case F.KHR_DRACO_MESH_COMPRESSION:Ke[Yt]=new Ie(Qe,this.dracoLoader);break;case F.KHR_TEXTURE_TRANSFORM:Ke[Yt]=new de;break;case F.KHR_MESH_QUANTIZATION:Ke[Yt]=new pe;break;default:me.indexOf(Yt)>=0&&vt[Yt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+Yt+'".')}}ct.setExtensions(Ke),ct.setPlugins(vt),ct.parse(We,Oe)}parseAsync(De,Re){const We=this;return new Promise(function(Oe,Qe){We.parse(De,Re,Oe,Qe)})}}function C(){let Nt={};return{get:function(De){return Nt[De]},add:function(De,Re){Nt[De]=Re},remove:function(De){delete Nt[De]},removeAll:function(){Nt={}}}}const F={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class L{constructor(De){this.parser=De,this.name=F.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const De=this.parser,Re=this.parser.json.nodes||[];for(let We=0,Oe=Re.length;We<Oe;We++){const Qe=Re[We];Qe.extensions&&Qe.extensions[this.name]&&Qe.extensions[this.name].light!==void 0&&De._addNodeRef(this.cache,Qe.extensions[this.name].light)}}_loadLight(De){const Re=this.parser,We="light:"+De;let Oe=Re.cache.get(We);if(Oe)return Oe;const Qe=Re.json,ct=((Qe.extensions&&Qe.extensions[this.name]||{}).lights||[])[De];let Ct;const Yt=new B.Color(16777215);ct.color!==void 0&&Yt.fromArray(ct.color);const me=ct.range!==void 0?ct.range:0;switch(ct.type){case"directional":Ct=new B.DirectionalLight(Yt),Ct.target.position.set(0,0,-1),Ct.add(Ct.target);break;case"point":Ct=new B.PointLight(Yt),Ct.distance=me;break;case"spot":Ct=new B.SpotLight(Yt),Ct.distance=me,ct.spot=ct.spot||{},ct.spot.innerConeAngle=ct.spot.innerConeAngle!==void 0?ct.spot.innerConeAngle:0,ct.spot.outerConeAngle=ct.spot.outerConeAngle!==void 0?ct.spot.outerConeAngle:Math.PI/4,Ct.angle=ct.spot.outerConeAngle,Ct.penumbra=1-ct.spot.innerConeAngle/ct.spot.outerConeAngle,Ct.target.position.set(0,0,-1),Ct.add(Ct.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+ct.type)}return Ct.position.set(0,0,0),Ct.decay=2,ai(Ct,ct),ct.intensity!==void 0&&(Ct.intensity=ct.intensity),Ct.name=Re.createUniqueName(ct.name||"light_"+De),Oe=Promise.resolve(Ct),Re.cache.add(We,Oe),Oe}getDependency(De,Re){if(De==="light")return this._loadLight(Re)}createNodeAttachment(De){const Re=this,We=this.parser,Qe=We.json.nodes[De],vt=(Qe.extensions&&Qe.extensions[this.name]||{}).light;return vt===void 0?null:this._loadLight(vt).then(function(ct){return We._getNodeRef(Re.cache,vt,ct)})}}class M{constructor(){this.name=F.KHR_MATERIALS_UNLIT}getMaterialType(){return B.MeshBasicMaterial}extendParams(De,Re,We){const Oe=[];De.color=new B.Color(1,1,1),De.opacity=1;const Qe=Re.pbrMetallicRoughness;if(Qe){if(Array.isArray(Qe.baseColorFactor)){const Ke=Qe.baseColorFactor;De.color.fromArray(Ke),De.opacity=Ke[3]}Qe.baseColorTexture!==void 0&&Oe.push(We.assignTexture(De,"map",Qe.baseColorTexture,B.sRGBEncoding))}return Promise.all(Oe)}}class b{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(De,Re){const Oe=this.parser.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=Oe.extensions[this.name].emissiveStrength;return Qe!==void 0&&(Re.emissiveIntensity=Qe),Promise.resolve()}}class S{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_CLEARCOAT}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[],Ke=Oe.extensions[this.name];if(Ke.clearcoatFactor!==void 0&&(Re.clearcoat=Ke.clearcoatFactor),Ke.clearcoatTexture!==void 0&&Qe.push(We.assignTexture(Re,"clearcoatMap",Ke.clearcoatTexture)),Ke.clearcoatRoughnessFactor!==void 0&&(Re.clearcoatRoughness=Ke.clearcoatRoughnessFactor),Ke.clearcoatRoughnessTexture!==void 0&&Qe.push(We.assignTexture(Re,"clearcoatRoughnessMap",Ke.clearcoatRoughnessTexture)),Ke.clearcoatNormalTexture!==void 0&&(Qe.push(We.assignTexture(Re,"clearcoatNormalMap",Ke.clearcoatNormalTexture)),Ke.clearcoatNormalTexture.scale!==void 0)){const vt=Ke.clearcoatNormalTexture.scale;Re.clearcoatNormalScale=new B.Vector2(vt,vt)}return Promise.all(Qe)}}class I{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_IRIDESCENCE}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[],Ke=Oe.extensions[this.name];return Ke.iridescenceFactor!==void 0&&(Re.iridescence=Ke.iridescenceFactor),Ke.iridescenceTexture!==void 0&&Qe.push(We.assignTexture(Re,"iridescenceMap",Ke.iridescenceTexture)),Ke.iridescenceIor!==void 0&&(Re.iridescenceIOR=Ke.iridescenceIor),Re.iridescenceThicknessRange===void 0&&(Re.iridescenceThicknessRange=[100,400]),Ke.iridescenceThicknessMinimum!==void 0&&(Re.iridescenceThicknessRange[0]=Ke.iridescenceThicknessMinimum),Ke.iridescenceThicknessMaximum!==void 0&&(Re.iridescenceThicknessRange[1]=Ke.iridescenceThicknessMaximum),Ke.iridescenceThicknessTexture!==void 0&&Qe.push(We.assignTexture(Re,"iridescenceThicknessMap",Ke.iridescenceThicknessTexture)),Promise.all(Qe)}}class O{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_SHEEN}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[];Re.sheenColor=new B.Color(0,0,0),Re.sheenRoughness=0,Re.sheen=1;const Ke=Oe.extensions[this.name];return Ke.sheenColorFactor!==void 0&&Re.sheenColor.fromArray(Ke.sheenColorFactor),Ke.sheenRoughnessFactor!==void 0&&(Re.sheenRoughness=Ke.sheenRoughnessFactor),Ke.sheenColorTexture!==void 0&&Qe.push(We.assignTexture(Re,"sheenColorMap",Ke.sheenColorTexture,B.sRGBEncoding)),Ke.sheenRoughnessTexture!==void 0&&Qe.push(We.assignTexture(Re,"sheenRoughnessMap",Ke.sheenRoughnessTexture)),Promise.all(Qe)}}class _{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_TRANSMISSION}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[],Ke=Oe.extensions[this.name];return Ke.transmissionFactor!==void 0&&(Re.transmission=Ke.transmissionFactor),Ke.transmissionTexture!==void 0&&Qe.push(We.assignTexture(Re,"transmissionMap",Ke.transmissionTexture)),Promise.all(Qe)}}class D{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_VOLUME}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[],Ke=Oe.extensions[this.name];Re.thickness=Ke.thicknessFactor!==void 0?Ke.thicknessFactor:0,Ke.thicknessTexture!==void 0&&Qe.push(We.assignTexture(Re,"thicknessMap",Ke.thicknessTexture)),Re.attenuationDistance=Ke.attenuationDistance||1/0;const vt=Ke.attenuationColor||[1,1,1];return Re.attenuationColor=new B.Color(vt[0],vt[1],vt[2]),Promise.all(Qe)}}class V{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_IOR}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const Oe=this.parser.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=Oe.extensions[this.name];return Re.ior=Qe.ior!==void 0?Qe.ior:1.5,Promise.resolve()}}class J{constructor(De){this.parser=De,this.name=F.KHR_MATERIALS_SPECULAR}getMaterialType(De){const We=this.parser.json.materials[De];return!We.extensions||!We.extensions[this.name]?null:B.MeshPhysicalMaterial}extendMaterialParams(De,Re){const We=this.parser,Oe=We.json.materials[De];if(!Oe.extensions||!Oe.extensions[this.name])return Promise.resolve();const Qe=[],Ke=Oe.extensions[this.name];Re.specularIntensity=Ke.specularFactor!==void 0?Ke.specularFactor:1,Ke.specularTexture!==void 0&&Qe.push(We.assignTexture(Re,"specularIntensityMap",Ke.specularTexture));const vt=Ke.specularColorFactor||[1,1,1];return Re.specularColor=new B.Color(vt[0],vt[1],vt[2]),Ke.specularColorTexture!==void 0&&Qe.push(We.assignTexture(Re,"specularColorMap",Ke.specularColorTexture,B.sRGBEncoding)),Promise.all(Qe)}}class Y{constructor(De){this.parser=De,this.name=F.KHR_TEXTURE_BASISU}loadTexture(De){const Re=this.parser,We=Re.json,Oe=We.textures[De];if(!Oe.extensions||!Oe.extensions[this.name])return null;const Qe=Oe.extensions[this.name],Ke=Re.options.ktx2Loader;if(!Ke){if(We.extensionsRequired&&We.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Re.loadTextureImage(De,Qe.source,Ke)}}class W{constructor(De){this.parser=De,this.name=F.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(De){const Re=this.name,We=this.parser,Oe=We.json,Qe=Oe.textures[De];if(!Qe.extensions||!Qe.extensions[Re])return null;const Ke=Qe.extensions[Re],vt=Oe.images[Ke.source];let ct=We.textureLoader;if(vt.uri){const Ct=We.options.manager.getHandler(vt.uri);Ct!==null&&(ct=Ct)}return this.detectSupport().then(function(Ct){if(Ct)return We.loadTextureImage(De,Ke.source,ct);if(Oe.extensionsRequired&&Oe.extensionsRequired.indexOf(Re)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return We.loadTexture(De)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(De){const Re=new Image;Re.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Re.onload=Re.onerror=function(){De(Re.height===1)}})),this.isSupported}}class U{constructor(De){this.name=F.EXT_MESHOPT_COMPRESSION,this.parser=De}loadBufferView(De){const Re=this.parser.json,We=Re.bufferViews[De];if(We.extensions&&We.extensions[this.name]){const Oe=We.extensions[this.name],Qe=this.parser.getDependency("buffer",Oe.buffer),Ke=this.parser.options.meshoptDecoder;if(!Ke||!Ke.supported){if(Re.extensionsRequired&&Re.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Qe.then(function(vt){const ct=Oe.byteOffset||0,Ct=Oe.byteLength||0,Yt=Oe.count,me=Oe.byteStride,ee=new Uint8Array(vt,ct,Ct);return Ke.decodeGltfBufferAsync?Ke.decodeGltfBufferAsync(Yt,me,ee,Oe.mode,Oe.filter).then(function(ae){return ae.buffer}):Ke.ready.then(function(){const ae=new ArrayBuffer(Yt*me);return Ke.decodeGltfBuffer(new Uint8Array(ae),Yt,me,ee,Oe.mode,Oe.filter),ae})})}else return null}}class q{constructor(De){this.name=F.EXT_MESH_GPU_INSTANCING,this.parser=De}createNodeMesh(De){const Re=this.parser.json,We=Re.nodes[De];if(!We.extensions||!We.extensions[this.name]||We.mesh===void 0)return null;const Oe=Re.meshes[We.mesh];for(const Ct of Oe.primitives)if(Ct.mode!==Ve.TRIANGLES&&Ct.mode!==Ve.TRIANGLE_STRIP&&Ct.mode!==Ve.TRIANGLE_FAN&&Ct.mode!==void 0)return null;const Ke=We.extensions[this.name].attributes,vt=[],ct={};for(const Ct in Ke)vt.push(this.parser.getDependency("accessor",Ke[Ct]).then(Yt=>(ct[Ct]=Yt,ct[Ct])));return vt.length<1?null:(vt.push(this.parser.createNodeMesh(De)),Promise.all(vt).then(Ct=>{const Yt=Ct.pop(),me=Yt.isGroup?Yt.children:[Yt],ee=Ct[0].count,ae=[];for(const Ue of me){const ht=new B.Matrix4,ft=new B.Vector3,Ft=new B.Quaternion,hi=new B.Vector3(1,1,1),bi=new B.InstancedMesh(Ue.geometry,Ue.material,ee);for(let ri=0;ri<ee;ri++)ct.TRANSLATION&&ft.fromBufferAttribute(ct.TRANSLATION,ri),ct.ROTATION&&Ft.fromBufferAttribute(ct.ROTATION,ri),ct.SCALE&&hi.fromBufferAttribute(ct.SCALE,ri),bi.setMatrixAt(ri,ht.compose(ft,Ft,hi));for(const ri in ct)ri!=="TRANSLATION"&&ri!=="ROTATION"&&ri!=="SCALE"&&Ue.geometry.setAttribute(ri,ct[ri]);B.Object3D.prototype.copy.call(bi,Ue),bi.frustumCulled=!1,this.parser.assignFinalMaterial(bi),ae.push(bi)}return Yt.isGroup?(Yt.clear(),Yt.add(...ae),Yt):ae[0]}))}}const oe="glTF",ve=12,Ae={JSON:1313821514,BIN:5130562};class Se{constructor(De){this.name=F.KHR_BINARY_GLTF,this.content=null,this.body=null;const Re=new DataView(De,0,ve);if(this.header={magic:B.LoaderUtils.decodeText(new Uint8Array(De.slice(0,4))),version:Re.getUint32(4,!0),length:Re.getUint32(8,!0)},this.header.magic!==oe)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const We=this.header.length-ve,Oe=new DataView(De,ve);let Qe=0;for(;Qe<We;){const Ke=Oe.getUint32(Qe,!0);Qe+=4;const vt=Oe.getUint32(Qe,!0);if(Qe+=4,vt===Ae.JSON){const ct=new Uint8Array(De,ve+Qe,Ke);this.content=B.LoaderUtils.decodeText(ct)}else if(vt===Ae.BIN){const ct=ve+Qe;this.body=De.slice(ct,ct+Ke)}Qe+=Ke}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ie{constructor(De,Re){if(!Re)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=F.KHR_DRACO_MESH_COMPRESSION,this.json=De,this.dracoLoader=Re,this.dracoLoader.preload()}decodePrimitive(De,Re){const We=this.json,Oe=this.dracoLoader,Qe=De.extensions[this.name].bufferView,Ke=De.extensions[this.name].attributes,vt={},ct={},Ct={};for(const Yt in Ke){const me=fn[Yt]||Yt.toLowerCase();vt[me]=Ke[Yt]}for(const Yt in De.attributes){const me=fn[Yt]||Yt.toLowerCase();if(Ke[Yt]!==void 0){const ee=We.accessors[De.attributes[Yt]],ae=ze[ee.componentType];Ct[me]=ae.name,ct[me]=ee.normalized===!0}}return Re.getDependency("bufferView",Qe).then(function(Yt){return new Promise(function(me){Oe.decodeDracoFile(Yt,function(ee){for(const ae in ee.attributes){const Ue=ee.attributes[ae],ht=ct[ae];ht!==void 0&&(Ue.normalized=ht)}me(ee)},vt,Ct)})})}}class de{constructor(){this.name=F.KHR_TEXTURE_TRANSFORM}extendTexture(De,Re){return Re.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Re.offset===void 0&&Re.rotation===void 0&&Re.scale===void 0||(De=De.clone(),Re.offset!==void 0&&De.offset.fromArray(Re.offset),Re.rotation!==void 0&&(De.rotation=Re.rotation),Re.scale!==void 0&&De.repeat.fromArray(Re.scale),De.needsUpdate=!0),De}}class pe{constructor(){this.name=F.KHR_MESH_QUANTIZATION}}class we extends B.Interpolant{constructor(De,Re,We,Oe){super(De,Re,We,Oe)}copySampleValue_(De){const Re=this.resultBuffer,We=this.sampleValues,Oe=this.valueSize,Qe=De*Oe*3+Oe;for(let Ke=0;Ke!==Oe;Ke++)Re[Ke]=We[Qe+Ke];return Re}interpolate_(De,Re,We,Oe){const Qe=this.resultBuffer,Ke=this.sampleValues,vt=this.valueSize,ct=vt*2,Ct=vt*3,Yt=Oe-Re,me=(We-Re)/Yt,ee=me*me,ae=ee*me,Ue=De*Ct,ht=Ue-Ct,ft=-2*ae+3*ee,Ft=ae-ee,hi=1-ft,bi=Ft-ee+me;for(let ri=0;ri!==vt;ri++){const Ai=Ke[ht+ri+vt],lr=Ke[ht+ri+ct]*Yt,_s=Ke[Ue+ri+vt],Fs=Ke[Ue+ri]*Yt;Qe[ri]=hi*Ai+bi*lr+ft*_s+Ft*Fs}return Qe}}const he=new B.Quaternion;class Pe extends we{interpolate_(De,Re,We,Oe){const Qe=super.interpolate_(De,Re,We,Oe);return he.fromArray(Qe).normalize().toArray(Qe),Qe}}const Ve={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ze={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},et={9728:B.NearestFilter,9729:B.LinearFilter,9984:B.NearestMipmapNearestFilter,9985:B.LinearMipmapNearestFilter,9986:B.NearestMipmapLinearFilter,9987:B.LinearMipmapLinearFilter},Tt={33071:B.ClampToEdgeWrapping,33648:B.MirroredRepeatWrapping,10497:B.RepeatWrapping},Rt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},cn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Jn={CUBICSPLINE:void 0,LINEAR:B.InterpolateLinear,STEP:B.InterpolateDiscrete},yn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Wn(Nt){return Nt.DefaultMaterial===void 0&&(Nt.DefaultMaterial=new B.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:B.FrontSide})),Nt.DefaultMaterial}function gi(Nt,De,Re){for(const We in Re.extensions)Nt[We]===void 0&&(De.userData.gltfExtensions=De.userData.gltfExtensions||{},De.userData.gltfExtensions[We]=Re.extensions[We])}function ai(Nt,De){De.extras!==void 0&&(typeof De.extras=="object"?Object.assign(Nt.userData,De.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+De.extras))}function nt(Nt,De,Re){let We=!1,Oe=!1,Qe=!1;for(let Ct=0,Yt=De.length;Ct<Yt;Ct++){const me=De[Ct];if(me.POSITION!==void 0&&(We=!0),me.NORMAL!==void 0&&(Oe=!0),me.COLOR_0!==void 0&&(Qe=!0),We&&Oe&&Qe)break}if(!We&&!Oe&&!Qe)return Promise.resolve(Nt);const Ke=[],vt=[],ct=[];for(let Ct=0,Yt=De.length;Ct<Yt;Ct++){const me=De[Ct];if(We){const ee=me.POSITION!==void 0?Re.getDependency("accessor",me.POSITION):Nt.attributes.position;Ke.push(ee)}if(Oe){const ee=me.NORMAL!==void 0?Re.getDependency("accessor",me.NORMAL):Nt.attributes.normal;vt.push(ee)}if(Qe){const ee=me.COLOR_0!==void 0?Re.getDependency("accessor",me.COLOR_0):Nt.attributes.color;ct.push(ee)}}return Promise.all([Promise.all(Ke),Promise.all(vt),Promise.all(ct)]).then(function(Ct){const Yt=Ct[0],me=Ct[1],ee=Ct[2];return We&&(Nt.morphAttributes.position=Yt),Oe&&(Nt.morphAttributes.normal=me),Qe&&(Nt.morphAttributes.color=ee),Nt.morphTargetsRelative=!0,Nt})}function dt(Nt,De){if(Nt.updateMorphTargets(),De.weights!==void 0)for(let Re=0,We=De.weights.length;Re<We;Re++)Nt.morphTargetInfluences[Re]=De.weights[Re];if(De.extras&&Array.isArray(De.extras.targetNames)){const Re=De.extras.targetNames;if(Nt.morphTargetInfluences.length===Re.length){Nt.morphTargetDictionary={};for(let We=0,Oe=Re.length;We<Oe;We++)Nt.morphTargetDictionary[Re[We]]=We}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ot(Nt){const De=Nt.extensions&&Nt.extensions[F.KHR_DRACO_MESH_COMPRESSION];let Re;return De?Re="draco:"+De.bufferView+":"+De.indices+":"+$t(De.attributes):Re=Nt.indices+":"+$t(Nt.attributes)+":"+Nt.mode,Re}function $t(Nt){let De="";const Re=Object.keys(Nt).sort();for(let We=0,Oe=Re.length;We<Oe;We++)De+=Re[We]+":"+Nt[Re[We]]+";";return De}function Ye(Nt){switch(Nt){case Int8Array:return .007874015748031496;case Uint8Array:return .00392156862745098;case Int16Array:return 3051850947599719e-20;case Uint16Array:return 15259021896696422e-21;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function mn(Nt){return Nt.search(/\.jpe?g($|\?)/i)>0||Nt.search(/^data\:image\/jpeg/)===0?"image/jpeg":Nt.search(/\.webp($|\?)/i)>0||Nt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Pn{constructor(De={},Re={}){this.json=De,this.extensions={},this.plugins={},this.options=Re,this.cache=new C,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let We=!1,Oe=!1,Qe=-1;typeof navigator<"u"&&(We=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,Oe=navigator.userAgent.indexOf("Firefox")>-1,Qe=Oe?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||We||Oe&&Qe<98?this.textureLoader=new B.TextureLoader(this.options.manager):this.textureLoader=new B.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new B.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(De){this.extensions=De}setPlugins(De){this.plugins=De}parse(De,Re){const We=this,Oe=this.json,Qe=this.extensions;this.cache.removeAll(),this._invokeAll(function(Ke){return Ke._markDefs&&Ke._markDefs()}),Promise.all(this._invokeAll(function(Ke){return Ke.beforeRoot&&Ke.beforeRoot()})).then(function(){return Promise.all([We.getDependencies("scene"),We.getDependencies("animation"),We.getDependencies("camera")])}).then(function(Ke){const vt={scene:Ke[0][Oe.scene||0],scenes:Ke[0],animations:Ke[1],cameras:Ke[2],asset:Oe.asset,parser:We,userData:{}};gi(Qe,vt,Oe),ai(vt,Oe),Promise.all(We._invokeAll(function(ct){return ct.afterRoot&&ct.afterRoot(vt)})).then(function(){De(vt)})}).catch(Re)}_markDefs(){const De=this.json.nodes||[],Re=this.json.skins||[],We=this.json.meshes||[];for(let Oe=0,Qe=Re.length;Oe<Qe;Oe++){const Ke=Re[Oe].joints;for(let vt=0,ct=Ke.length;vt<ct;vt++)De[Ke[vt]].isBone=!0}for(let Oe=0,Qe=De.length;Oe<Qe;Oe++){const Ke=De[Oe];Ke.mesh!==void 0&&(this._addNodeRef(this.meshCache,Ke.mesh),Ke.skin!==void 0&&(We[Ke.mesh].isSkinnedMesh=!0)),Ke.camera!==void 0&&this._addNodeRef(this.cameraCache,Ke.camera)}}_addNodeRef(De,Re){Re!==void 0&&(De.refs[Re]===void 0&&(De.refs[Re]=De.uses[Re]=0),De.refs[Re]++)}_getNodeRef(De,Re,We){if(De.refs[Re]<=1)return We;const Oe=We.clone(),Qe=(Ke,vt)=>{const ct=this.associations.get(Ke);ct!=null&&this.associations.set(vt,ct);for(const[Ct,Yt]of Ke.children.entries())Qe(Yt,vt.children[Ct])};return Qe(We,Oe),Oe.name+="_instance_"+De.uses[Re]++,Oe}_invokeOne(De){const Re=Object.values(this.plugins);Re.push(this);for(let We=0;We<Re.length;We++){const Oe=De(Re[We]);if(Oe)return Oe}return null}_invokeAll(De){const Re=Object.values(this.plugins);Re.unshift(this);const We=[];for(let Oe=0;Oe<Re.length;Oe++){const Qe=De(Re[Oe]);Qe&&We.push(Qe)}return We}getDependency(De,Re){const We=De+":"+Re;let Oe=this.cache.get(We);if(!Oe){switch(De){case"scene":Oe=this.loadScene(Re);break;case"node":Oe=this.loadNode(Re);break;case"mesh":Oe=this._invokeOne(function(Qe){return Qe.loadMesh&&Qe.loadMesh(Re)});break;case"accessor":Oe=this.loadAccessor(Re);break;case"bufferView":Oe=this._invokeOne(function(Qe){return Qe.loadBufferView&&Qe.loadBufferView(Re)});break;case"buffer":Oe=this.loadBuffer(Re);break;case"material":Oe=this._invokeOne(function(Qe){return Qe.loadMaterial&&Qe.loadMaterial(Re)});break;case"texture":Oe=this._invokeOne(function(Qe){return Qe.loadTexture&&Qe.loadTexture(Re)});break;case"skin":Oe=this.loadSkin(Re);break;case"animation":Oe=this._invokeOne(function(Qe){return Qe.loadAnimation&&Qe.loadAnimation(Re)});break;case"camera":Oe=this.loadCamera(Re);break;default:if(Oe=this._invokeOne(function(Qe){return Qe!=this&&Qe.getDependency&&Qe.getDependency(De,Re)}),!Oe)throw new Error("Unknown type: "+De);break}this.cache.add(We,Oe)}return Oe}getDependencies(De){let Re=this.cache.get(De);if(!Re){const We=this,Oe=this.json[De+(De==="mesh"?"es":"s")]||[];Re=Promise.all(Oe.map(function(Qe,Ke){return We.getDependency(De,Ke)})),this.cache.add(De,Re)}return Re}loadBuffer(De){const Re=this.json.buffers[De],We=this.fileLoader;if(Re.type&&Re.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+Re.type+" buffer type is not supported.");if(Re.uri===void 0&&De===0)return Promise.resolve(this.extensions[F.KHR_BINARY_GLTF].body);const Oe=this.options;return new Promise(function(Qe,Ke){We.load(B.LoaderUtils.resolveURL(Re.uri,Oe.path),Qe,void 0,function(){Ke(new Error('THREE.GLTFLoader: Failed to load buffer "'+Re.uri+'".'))})})}loadBufferView(De){const Re=this.json.bufferViews[De];return this.getDependency("buffer",Re.buffer).then(function(We){const Oe=Re.byteLength||0,Qe=Re.byteOffset||0;return We.slice(Qe,Qe+Oe)})}loadAccessor(De){const Re=this,We=this.json,Oe=this.json.accessors[De];if(Oe.bufferView===void 0&&Oe.sparse===void 0){const Ke=Rt[Oe.type],vt=ze[Oe.componentType],ct=Oe.normalized===!0,Ct=new vt(Oe.count*Ke);return Promise.resolve(new B.BufferAttribute(Ct,Ke,ct))}const Qe=[];return Oe.bufferView!==void 0?Qe.push(this.getDependency("bufferView",Oe.bufferView)):Qe.push(null),Oe.sparse!==void 0&&(Qe.push(this.getDependency("bufferView",Oe.sparse.indices.bufferView)),Qe.push(this.getDependency("bufferView",Oe.sparse.values.bufferView))),Promise.all(Qe).then(function(Ke){const vt=Ke[0],ct=Rt[Oe.type],Ct=ze[Oe.componentType],Yt=Ct.BYTES_PER_ELEMENT,me=Yt*ct,ee=Oe.byteOffset||0,ae=Oe.bufferView!==void 0?We.bufferViews[Oe.bufferView].byteStride:void 0,Ue=Oe.normalized===!0;let ht,ft;if(ae&&ae!==me){const Ft=Math.floor(ee/ae),hi="InterleavedBuffer:"+Oe.bufferView+":"+Oe.componentType+":"+Ft+":"+Oe.count;let bi=Re.cache.get(hi);bi||(ht=new Ct(vt,Ft*ae,Oe.count*ae/Yt),bi=new B.InterleavedBuffer(ht,ae/Yt),Re.cache.add(hi,bi)),ft=new B.InterleavedBufferAttribute(bi,ct,ee%ae/Yt,Ue)}else vt===null?ht=new Ct(Oe.count*ct):ht=new Ct(vt,ee,Oe.count*ct),ft=new B.BufferAttribute(ht,ct,Ue);if(Oe.sparse!==void 0){const Ft=Rt.SCALAR,hi=ze[Oe.sparse.indices.componentType],bi=Oe.sparse.indices.byteOffset||0,ri=Oe.sparse.values.byteOffset||0,Ai=new hi(Ke[1],bi,Oe.sparse.count*Ft),lr=new Ct(Ke[2],ri,Oe.sparse.count*ct);vt!==null&&(ft=new B.BufferAttribute(ft.array.slice(),ft.itemSize,ft.normalized));for(let _s=0,Fs=Ai.length;_s<Fs;_s++){const Vs=Ai[_s];if(ft.setX(Vs,lr[_s*ct]),ct>=2&&ft.setY(Vs,lr[_s*ct+1]),ct>=3&&ft.setZ(Vs,lr[_s*ct+2]),ct>=4&&ft.setW(Vs,lr[_s*ct+3]),ct>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return ft})}loadTexture(De){const Re=this.json,We=this.options,Qe=Re.textures[De].source,Ke=Re.images[Qe];let vt=this.textureLoader;if(Ke.uri){const ct=We.manager.getHandler(Ke.uri);ct!==null&&(vt=ct)}return this.loadTextureImage(De,Qe,vt)}loadTextureImage(De,Re,We){const Oe=this,Qe=this.json,Ke=Qe.textures[De],vt=Qe.images[Re],ct=(vt.uri||vt.bufferView)+":"+Ke.sampler;if(this.textureCache[ct])return this.textureCache[ct];const Ct=this.loadImageSource(Re,We).then(function(Yt){Yt.flipY=!1,Yt.name=Ke.name||vt.name||"";const ee=(Qe.samplers||{})[Ke.sampler]||{};return Yt.magFilter=et[ee.magFilter]||B.LinearFilter,Yt.minFilter=et[ee.minFilter]||B.LinearMipmapLinearFilter,Yt.wrapS=Tt[ee.wrapS]||B.RepeatWrapping,Yt.wrapT=Tt[ee.wrapT]||B.RepeatWrapping,Oe.associations.set(Yt,{textures:De}),Yt}).catch(function(){return null});return this.textureCache[ct]=Ct,Ct}loadImageSource(De,Re){const We=this,Oe=this.json,Qe=this.options;if(this.sourceCache[De]!==void 0)return this.sourceCache[De].then(me=>me.clone());const Ke=Oe.images[De],vt=self.URL||self.webkitURL;let ct=Ke.uri||"",Ct=!1;if(Ke.bufferView!==void 0)ct=We.getDependency("bufferView",Ke.bufferView).then(function(me){Ct=!0;const ee=new Blob([me],{type:Ke.mimeType});return ct=vt.createObjectURL(ee),ct});else if(Ke.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+De+" is missing URI and bufferView");const Yt=Promise.resolve(ct).then(function(me){return new Promise(function(ee,ae){let Ue=ee;Re.isImageBitmapLoader===!0&&(Ue=function(ht){const ft=new B.Texture(ht);ft.needsUpdate=!0,ee(ft)}),Re.load(B.LoaderUtils.resolveURL(me,Qe.path),Ue,void 0,ae)})}).then(function(me){return Ct===!0&&vt.revokeObjectURL(ct),me.userData.mimeType=Ke.mimeType||mn(Ke.uri),me}).catch(function(me){throw console.error("THREE.GLTFLoader: Couldn't load texture",ct),me});return this.sourceCache[De]=Yt,Yt}assignTexture(De,Re,We,Oe){const Qe=this;return this.getDependency("texture",We.index).then(function(Ke){if(!Ke)return null;if(We.texCoord!==void 0&&We.texCoord!=0&&!(Re==="aoMap"&&We.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+We.texCoord+" for texture "+Re+" not yet supported."),Qe.extensions[F.KHR_TEXTURE_TRANSFORM]){const vt=We.extensions!==void 0?We.extensions[F.KHR_TEXTURE_TRANSFORM]:void 0;if(vt){const ct=Qe.associations.get(Ke);Ke=Qe.extensions[F.KHR_TEXTURE_TRANSFORM].extendTexture(Ke,vt),Qe.associations.set(Ke,ct)}}return Oe!==void 0&&(Ke.encoding=Oe),De[Re]=Ke,Ke})}assignFinalMaterial(De){const Re=De.geometry;let We=De.material;const Oe=Re.attributes.tangent===void 0,Qe=Re.attributes.color!==void 0,Ke=Re.attributes.normal===void 0;if(De.isPoints){const vt="PointsMaterial:"+We.uuid;let ct=this.cache.get(vt);ct||(ct=new B.PointsMaterial,B.Material.prototype.copy.call(ct,We),ct.color.copy(We.color),ct.map=We.map,ct.sizeAttenuation=!1,this.cache.add(vt,ct)),We=ct}else if(De.isLine){const vt="LineBasicMaterial:"+We.uuid;let ct=this.cache.get(vt);ct||(ct=new B.LineBasicMaterial,B.Material.prototype.copy.call(ct,We),ct.color.copy(We.color),this.cache.add(vt,ct)),We=ct}if(Oe||Qe||Ke){let vt="ClonedMaterial:"+We.uuid+":";Oe&&(vt+="derivative-tangents:"),Qe&&(vt+="vertex-colors:"),Ke&&(vt+="flat-shading:");let ct=this.cache.get(vt);ct||(ct=We.clone(),Qe&&(ct.vertexColors=!0),Ke&&(ct.flatShading=!0),Oe&&(ct.normalScale&&(ct.normalScale.y*=-1),ct.clearcoatNormalScale&&(ct.clearcoatNormalScale.y*=-1)),this.cache.add(vt,ct),this.associations.set(ct,this.associations.get(We))),We=ct}We.aoMap&&Re.attributes.uv2===void 0&&Re.attributes.uv!==void 0&&Re.setAttribute("uv2",Re.attributes.uv),De.material=We}getMaterialType(){return B.MeshStandardMaterial}loadMaterial(De){const Re=this,We=this.json,Oe=this.extensions,Qe=We.materials[De];let Ke;const vt={},ct=Qe.extensions||{},Ct=[];if(ct[F.KHR_MATERIALS_UNLIT]){const me=Oe[F.KHR_MATERIALS_UNLIT];Ke=me.getMaterialType(),Ct.push(me.extendParams(vt,Qe,Re))}else{const me=Qe.pbrMetallicRoughness||{};if(vt.color=new B.Color(1,1,1),vt.opacity=1,Array.isArray(me.baseColorFactor)){const ee=me.baseColorFactor;vt.color.fromArray(ee),vt.opacity=ee[3]}me.baseColorTexture!==void 0&&Ct.push(Re.assignTexture(vt,"map",me.baseColorTexture,B.sRGBEncoding)),vt.metalness=me.metallicFactor!==void 0?me.metallicFactor:1,vt.roughness=me.roughnessFactor!==void 0?me.roughnessFactor:1,me.metallicRoughnessTexture!==void 0&&(Ct.push(Re.assignTexture(vt,"metalnessMap",me.metallicRoughnessTexture)),Ct.push(Re.assignTexture(vt,"roughnessMap",me.metallicRoughnessTexture))),Ke=this._invokeOne(function(ee){return ee.getMaterialType&&ee.getMaterialType(De)}),Ct.push(Promise.all(this._invokeAll(function(ee){return ee.extendMaterialParams&&ee.extendMaterialParams(De,vt)})))}Qe.doubleSided===!0&&(vt.side=B.DoubleSide);const Yt=Qe.alphaMode||yn.OPAQUE;if(Yt===yn.BLEND?(vt.transparent=!0,vt.depthWrite=!1):(vt.transparent=!1,Yt===yn.MASK&&(vt.alphaTest=Qe.alphaCutoff!==void 0?Qe.alphaCutoff:.5)),Qe.normalTexture!==void 0&&Ke!==B.MeshBasicMaterial&&(Ct.push(Re.assignTexture(vt,"normalMap",Qe.normalTexture)),vt.normalScale=new B.Vector2(1,1),Qe.normalTexture.scale!==void 0)){const me=Qe.normalTexture.scale;vt.normalScale.set(me,me)}return Qe.occlusionTexture!==void 0&&Ke!==B.MeshBasicMaterial&&(Ct.push(Re.assignTexture(vt,"aoMap",Qe.occlusionTexture)),Qe.occlusionTexture.strength!==void 0&&(vt.aoMapIntensity=Qe.occlusionTexture.strength)),Qe.emissiveFactor!==void 0&&Ke!==B.MeshBasicMaterial&&(vt.emissive=new B.Color().fromArray(Qe.emissiveFactor)),Qe.emissiveTexture!==void 0&&Ke!==B.MeshBasicMaterial&&Ct.push(Re.assignTexture(vt,"emissiveMap",Qe.emissiveTexture,B.sRGBEncoding)),Promise.all(Ct).then(function(){const me=new Ke(vt);return Qe.name&&(me.name=Qe.name),ai(me,Qe),Re.associations.set(me,{materials:De}),Qe.extensions&&gi(Oe,me,Qe),me})}createUniqueName(De){const Re=B.PropertyBinding.sanitizeNodeName(De||"");let We=Re;for(let Oe=1;this.nodeNamesUsed[We];++Oe)We=Re+"_"+Oe;return this.nodeNamesUsed[We]=!0,We}loadGeometries(De){const Re=this,We=this.extensions,Oe=this.primitiveCache;function Qe(vt){return We[F.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(vt,Re).then(function(ct){return gn(ct,vt,Re)})}const Ke=[];for(let vt=0,ct=De.length;vt<ct;vt++){const Ct=De[vt],Yt=Ot(Ct),me=Oe[Yt];if(me)Ke.push(me.promise);else{let ee;Ct.extensions&&Ct.extensions[F.KHR_DRACO_MESH_COMPRESSION]?ee=Qe(Ct):ee=gn(new B.BufferGeometry,Ct,Re),Oe[Yt]={primitive:Ct,promise:ee},Ke.push(ee)}}return Promise.all(Ke)}loadMesh(De){const Re=this,We=this.json,Oe=this.extensions,Qe=We.meshes[De],Ke=Qe.primitives,vt=[];for(let ct=0,Ct=Ke.length;ct<Ct;ct++){const Yt=Ke[ct].material===void 0?Wn(this.cache):this.getDependency("material",Ke[ct].material);vt.push(Yt)}return vt.push(Re.loadGeometries(Ke)),Promise.all(vt).then(function(ct){const Ct=ct.slice(0,ct.length-1),Yt=ct[ct.length-1],me=[];for(let ae=0,Ue=Yt.length;ae<Ue;ae++){const ht=Yt[ae],ft=Ke[ae];let Ft;const hi=Ct[ae];if(ft.mode===Ve.TRIANGLES||ft.mode===Ve.TRIANGLE_STRIP||ft.mode===Ve.TRIANGLE_FAN||ft.mode===void 0)Ft=Qe.isSkinnedMesh===!0?new B.SkinnedMesh(ht,hi):new B.Mesh(ht,hi),Ft.isSkinnedMesh===!0&&!Ft.geometry.attributes.skinWeight.normalized&&Ft.normalizeSkinWeights(),ft.mode===Ve.TRIANGLE_STRIP?Ft.geometry=ui(Ft.geometry,B.TriangleStripDrawMode):ft.mode===Ve.TRIANGLE_FAN&&(Ft.geometry=ui(Ft.geometry,B.TriangleFanDrawMode));else if(ft.mode===Ve.LINES)Ft=new B.LineSegments(ht,hi);else if(ft.mode===Ve.LINE_STRIP)Ft=new B.Line(ht,hi);else if(ft.mode===Ve.LINE_LOOP)Ft=new B.LineLoop(ht,hi);else if(ft.mode===Ve.POINTS)Ft=new B.Points(ht,hi);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+ft.mode);Object.keys(Ft.geometry.morphAttributes).length>0&&dt(Ft,Qe),Ft.name=Re.createUniqueName(Qe.name||"mesh_"+De),ai(Ft,Qe),ft.extensions&&gi(Oe,Ft,ft),Re.assignFinalMaterial(Ft),me.push(Ft)}for(let ae=0,Ue=me.length;ae<Ue;ae++)Re.associations.set(me[ae],{meshes:De,primitives:ae});if(me.length===1)return me[0];const ee=new B.Group;Re.associations.set(ee,{meshes:De});for(let ae=0,Ue=me.length;ae<Ue;ae++)ee.add(me[ae]);return ee})}loadCamera(De){let Re;const We=this.json.cameras[De],Oe=We[We.type];if(!Oe){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return We.type==="perspective"?Re=new B.PerspectiveCamera(B.MathUtils.radToDeg(Oe.yfov),Oe.aspectRatio||1,Oe.znear||1,Oe.zfar||2e6):We.type==="orthographic"&&(Re=new B.OrthographicCamera(-Oe.xmag,Oe.xmag,Oe.ymag,-Oe.ymag,Oe.znear,Oe.zfar)),We.name&&(Re.name=this.createUniqueName(We.name)),ai(Re,We),Promise.resolve(Re)}loadSkin(De){const Re=this.json.skins[De],We=[];for(let Oe=0,Qe=Re.joints.length;Oe<Qe;Oe++)We.push(this.getDependency("node",Re.joints[Oe]));return Re.inverseBindMatrices!==void 0?We.push(this.getDependency("accessor",Re.inverseBindMatrices)):We.push(null),Promise.all(We).then(function(Oe){const Qe=Oe.pop(),Ke=Oe,vt=[],ct=[];for(let Ct=0,Yt=Ke.length;Ct<Yt;Ct++){const me=Ke[Ct];if(me){vt.push(me);const ee=new B.Matrix4;Qe!==null&&ee.fromArray(Qe.array,Ct*16),ct.push(ee)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',Re.joints[Ct])}return new B.Skeleton(vt,ct)})}loadAnimation(De){const We=this.json.animations[De],Oe=[],Qe=[],Ke=[],vt=[],ct=[];for(let Ct=0,Yt=We.channels.length;Ct<Yt;Ct++){const me=We.channels[Ct],ee=We.samplers[me.sampler],ae=me.target,Ue=ae.node,ht=We.parameters!==void 0?We.parameters[ee.input]:ee.input,ft=We.parameters!==void 0?We.parameters[ee.output]:ee.output;Oe.push(this.getDependency("node",Ue)),Qe.push(this.getDependency("accessor",ht)),Ke.push(this.getDependency("accessor",ft)),vt.push(ee),ct.push(ae)}return Promise.all([Promise.all(Oe),Promise.all(Qe),Promise.all(Ke),Promise.all(vt),Promise.all(ct)]).then(function(Ct){const Yt=Ct[0],me=Ct[1],ee=Ct[2],ae=Ct[3],Ue=Ct[4],ht=[];for(let Ft=0,hi=Yt.length;Ft<hi;Ft++){const bi=Yt[Ft],ri=me[Ft],Ai=ee[Ft],lr=ae[Ft],_s=Ue[Ft];if(bi===void 0)continue;bi.updateMatrix();let Fs;switch(cn[_s.path]){case cn.weights:Fs=B.NumberKeyframeTrack;break;case cn.rotation:Fs=B.QuaternionKeyframeTrack;break;case cn.position:case cn.scale:default:Fs=B.VectorKeyframeTrack;break}const Vs=bi.name?bi.name:bi.uuid,Dr=lr.interpolation!==void 0?Jn[lr.interpolation]:B.InterpolateLinear,ti=[];cn[_s.path]===cn.weights?bi.traverse(function(On){On.morphTargetInfluences&&ti.push(On.name?On.name:On.uuid)}):ti.push(Vs);let hn=Ai.array;if(Ai.normalized){const On=Ye(hn.constructor),Oi=new Float32Array(hn.length);for(let Yn=0,Gi=hn.length;Yn<Gi;Yn++)Oi[Yn]=hn[Yn]*On;hn=Oi}for(let On=0,Oi=ti.length;On<Oi;On++){const Yn=new Fs(ti[On]+"."+cn[_s.path],ri.array,hn,Dr);lr.interpolation==="CUBICSPLINE"&&(Yn.createInterpolant=function(nr){const cr=this instanceof B.QuaternionKeyframeTrack?Pe:we;return new cr(this.times,this.values,this.getValueSize()/3,nr)},Yn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),ht.push(Yn)}}const ft=We.name?We.name:"animation_"+De;return new B.AnimationClip(ft,void 0,ht)})}createNodeMesh(De){const Re=this.json,We=this,Oe=Re.nodes[De];return Oe.mesh===void 0?null:We.getDependency("mesh",Oe.mesh).then(function(Qe){const Ke=We._getNodeRef(We.meshCache,Oe.mesh,Qe);return Oe.weights!==void 0&&Ke.traverse(function(vt){if(vt.isMesh)for(let ct=0,Ct=Oe.weights.length;ct<Ct;ct++)vt.morphTargetInfluences[ct]=Oe.weights[ct]}),Ke})}loadNode(De){const Re=this.json,We=this.extensions,Oe=this,Qe=Re.nodes[De],Ke=Qe.name?Oe.createUniqueName(Qe.name):"";return function(){const vt=[],ct=Oe._invokeOne(function(Ct){return Ct.createNodeMesh&&Ct.createNodeMesh(De)});return ct&&vt.push(ct),Qe.camera!==void 0&&vt.push(Oe.getDependency("camera",Qe.camera).then(function(Ct){return Oe._getNodeRef(Oe.cameraCache,Qe.camera,Ct)})),Oe._invokeAll(function(Ct){return Ct.createNodeAttachment&&Ct.createNodeAttachment(De)}).forEach(function(Ct){vt.push(Ct)}),Promise.all(vt)}().then(function(vt){let ct;if(Qe.isBone===!0?ct=new B.Bone:vt.length>1?ct=new B.Group:vt.length===1?ct=vt[0]:ct=new B.Object3D,ct!==vt[0])for(let Ct=0,Yt=vt.length;Ct<Yt;Ct++)ct.add(vt[Ct]);if(Qe.name&&(ct.userData.name=Qe.name,ct.name=Ke),ai(ct,Qe),Qe.extensions&&gi(We,ct,Qe),Qe.matrix!==void 0){const Ct=new B.Matrix4;Ct.fromArray(Qe.matrix),ct.applyMatrix4(Ct)}else Qe.translation!==void 0&&ct.position.fromArray(Qe.translation),Qe.rotation!==void 0&&ct.quaternion.fromArray(Qe.rotation),Qe.scale!==void 0&&ct.scale.fromArray(Qe.scale);return Oe.associations.has(ct)||Oe.associations.set(ct,{}),Oe.associations.get(ct).nodes=De,ct})}loadScene(De){const Re=this.json,We=this.extensions,Oe=this.json.scenes[De],Qe=this,Ke=new B.Group;Oe.name&&(Ke.name=Qe.createUniqueName(Oe.name)),ai(Ke,Oe),Oe.extensions&&gi(We,Ke,Oe);const vt=Oe.nodes||[],ct=[];for(let Ct=0,Yt=vt.length;Ct<Yt;Ct++)ct.push(wn(vt[Ct],Ke,Re,Qe));return Promise.all(ct).then(function(){const Ct=Yt=>{const me=new Map;for(const[ee,ae]of Qe.associations)(ee instanceof B.Material||ee instanceof B.Texture)&&me.set(ee,ae);return Yt.traverse(ee=>{const ae=Qe.associations.get(ee);ae!=null&&me.set(ee,ae)}),me};return Qe.associations=Ct(Ke),Ke})}}function wn(Nt,De,Re,We){const Oe=Re.nodes[Nt];return We.getDependency("node",Nt).then(function(Qe){return Oe.skin===void 0?Qe:We.getDependency("skin",Oe.skin).then(function(Ke){return Qe.traverse(function(vt){vt.isSkinnedMesh&&vt.bind(Ke,vt.matrixWorld)}),Qe})}).then(function(Qe){De.add(Qe);const Ke=[];if(Oe.children){const vt=Oe.children;for(let ct=0,Ct=vt.length;ct<Ct;ct++){const Yt=vt[ct];Ke.push(wn(Yt,Qe,Re,We))}}return Promise.all(Ke)})}function Dn(Nt,De,Re){const We=De.attributes,Oe=new B.Box3;if(We.POSITION!==void 0){const vt=Re.json.accessors[We.POSITION],ct=vt.min,Ct=vt.max;if(ct!==void 0&&Ct!==void 0){if(Oe.set(new B.Vector3(ct[0],ct[1],ct[2]),new B.Vector3(Ct[0],Ct[1],Ct[2])),vt.normalized){const Yt=Ye(ze[vt.componentType]);Oe.min.multiplyScalar(Yt),Oe.max.multiplyScalar(Yt)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const Qe=De.targets;if(Qe!==void 0){const vt=new B.Vector3,ct=new B.Vector3;for(let Ct=0,Yt=Qe.length;Ct<Yt;Ct++){const me=Qe[Ct];if(me.POSITION!==void 0){const ee=Re.json.accessors[me.POSITION],ae=ee.min,Ue=ee.max;if(ae!==void 0&&Ue!==void 0){if(ct.setX(Math.max(Math.abs(ae[0]),Math.abs(Ue[0]))),ct.setY(Math.max(Math.abs(ae[1]),Math.abs(Ue[1]))),ct.setZ(Math.max(Math.abs(ae[2]),Math.abs(Ue[2]))),ee.normalized){const ht=Ye(ze[ee.componentType]);ct.multiplyScalar(ht)}vt.max(ct)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Oe.expandByVector(vt)}Nt.boundingBox=Oe;const Ke=new B.Sphere;Oe.getCenter(Ke.center),Ke.radius=Oe.min.distanceTo(Oe.max)/2,Nt.boundingSphere=Ke}function gn(Nt,De,Re){const We=De.attributes,Oe=[];function Qe(Ke,vt){return Re.getDependency("accessor",Ke).then(function(ct){Nt.setAttribute(vt,ct)})}for(const Ke in We){const vt=fn[Ke]||Ke.toLowerCase();vt in Nt.attributes||Oe.push(Qe(We[Ke],vt))}if(De.indices!==void 0&&!Nt.index){const Ke=Re.getDependency("accessor",De.indices).then(function(vt){Nt.setIndex(vt)});Oe.push(Ke)}return ai(Nt,De),Dn(Nt,De,Re),Promise.all(Oe).then(function(){return De.targets!==void 0?nt(Nt,De.targets,Re):Nt})}function ui(Nt,De){let Re=Nt.getIndex();if(Re===null){const Ke=[],vt=Nt.getAttribute("position");if(vt!==void 0){for(let ct=0;ct<vt.count;ct++)Ke.push(ct);Nt.setIndex(Ke),Re=Nt.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Nt}const We=Re.count-2,Oe=[];if(De===B.TriangleFanDrawMode)for(let Ke=1;Ke<=We;Ke++)Oe.push(Re.getX(0)),Oe.push(Re.getX(Ke)),Oe.push(Re.getX(Ke+1));else for(let Ke=0;Ke<We;Ke++)Ke%2===0?(Oe.push(Re.getX(Ke)),Oe.push(Re.getX(Ke+1)),Oe.push(Re.getX(Ke+2))):(Oe.push(Re.getX(Ke+2)),Oe.push(Re.getX(Ke+1)),Oe.push(Re.getX(Ke)));Oe.length/3!==We&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const Qe=Nt.clone();return Qe.setIndex(Oe),Qe}},"./node_modules/super-three/examples/jsm/loaders/KTX2Loader.js":(Z,te,E)=>{E.r(te),E.d(te,{KTX2Loader:()=>S});var B=E("./node_modules/super-three/build/three.module.js"),H=E("./node_modules/super-three/examples/jsm/utils/WorkerPool.js"),C=E("./node_modules/super-three/examples/jsm/libs/ktx-parse.module.js"),F=E("./node_modules/super-three/examples/jsm/libs/zstddec.module.js");const L=new WeakMap;let M=0,b;class S extends B.Loader{constructor(J){super(J),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new H.WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(J){return this.transcoderPath=J,this}setWorkerLimit(J){return this.workerPool.setWorkerLimit(J),this}detectSupport(J){return this.workerConfig={astcSupported:J.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:J.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:J.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:J.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:J.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:J.extensions.has("WEBGL_compressed_texture_pvrtc")||J.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},J.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const J=new B.FileLoader(this.manager);J.setPath(this.transcoderPath),J.setWithCredentials(this.withCredentials);const Y=J.loadAsync("basis_transcoder.js"),W=new B.FileLoader(this.manager);W.setPath(this.transcoderPath),W.setResponseType("arraybuffer"),W.setWithCredentials(this.withCredentials);const U=W.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([Y,U]).then(([q,oe])=>{const ve=S.BasisWorker.toString(),Ae=["/* constants */","let _EngineFormat = "+JSON.stringify(S.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(S.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(S.BasisFormat),"/* basis_transcoder.js */",q,"/* worker */",ve.substring(ve.indexOf("{")+1,ve.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([Ae])),this.transcoderBinary=oe,this.workerPool.setWorkerCreator(()=>{const Se=new Worker(this.workerSourceURL),Ie=this.transcoderBinary.slice(0);return Se.postMessage({type:"init",config:this.workerConfig,transcoderBinary:Ie},[Ie]),Se})}),M>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),M++}return this.transcoderPending}load(J,Y,W,U){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const q=new B.FileLoader(this.manager);q.setResponseType("arraybuffer"),q.setWithCredentials(this.withCredentials),q.load(J,oe=>{if(L.has(oe))return L.get(oe).promise.then(Y).catch(U);this._createTexture(oe).then(ve=>Y?Y(ve):null).catch(U)},W,U)}_createTextureFrom(J,Y){const{mipmaps:W,width:U,height:q,format:oe,type:ve,error:Ae,dfdTransferFn:Se,dfdFlags:Ie}=J;if(ve==="error")return Promise.reject(Ae);const de=Y.layerCount>1?new B.CompressedArrayTexture(W,U,q,Y.layerCount,oe,B.UnsignedByteType):new B.CompressedTexture(W,U,q,oe,B.UnsignedByteType);return de.minFilter=W.length===1?B.LinearFilter:B.LinearMipmapLinearFilter,de.magFilter=B.LinearFilter,de.generateMipmaps=!1,de.needsUpdate=!0,de.encoding=Se===C.KHR_DF_TRANSFER_SRGB?B.sRGBEncoding:B.LinearEncoding,de.premultiplyAlpha=!!(Ie&C.KHR_DF_FLAG_ALPHA_PREMULTIPLIED),de}async _createTexture(J,Y={}){const W=(0,C.read)(new Uint8Array(J));if(W.vkFormat!==C.VK_FORMAT_UNDEFINED)return D(W);const U=Y,q=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:J,taskConfig:U},[J])).then(oe=>this._createTextureFrom(oe.data,W));return L.set(J,{promise:q}),q}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),M--,this}}S.BasisFormat={ETC1S:0,UASTC_4x4:1},S.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},S.EngineFormat={RGBAFormat:B.RGBAFormat,RGBA_ASTC_4x4_Format:B.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:B.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:B.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:B.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:B.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:B.RGB_ETC1_Format,RGB_ETC2_Format:B.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:B.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:B.RGB_S3TC_DXT1_Format},S.BasisWorker=function(){let V,J,Y;const W=_EngineFormat,U=_TranscoderFormat,q=_BasisFormat;self.addEventListener("message",function(he){const Pe=he.data;switch(Pe.type){case"init":V=Pe.config,oe(Pe.transcoderBinary);break;case"transcode":J.then(()=>{try{const{width:Ve,height:ze,hasAlpha:et,mipmaps:Tt,format:Rt,dfdTransferFn:fn,dfdFlags:cn}=ve(Pe.buffer),Jn=[];for(let yn=0;yn<Tt.length;++yn)Jn.push(Tt[yn].data.buffer);self.postMessage({type:"transcode",id:Pe.id,width:Ve,height:ze,hasAlpha:et,mipmaps:Tt,format:Rt,dfdTransferFn:fn,dfdFlags:cn},Jn)}catch(Ve){console.error(Ve),self.postMessage({type:"error",id:Pe.id,error:Ve.message})}});break}});function oe(he){J=new Promise(Pe=>{Y={wasmBinary:he,onRuntimeInitialized:Pe},BASIS(Y)}).then(()=>{Y.initializeBasis(),Y.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function ve(he){const Pe=new Y.KTX2File(new Uint8Array(he));function Ve(){Pe.close(),Pe.delete()}if(!Pe.isValid())throw Ve(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const ze=Pe.isUASTC()?q.UASTC_4x4:q.ETC1S,et=Pe.getWidth(),Tt=Pe.getHeight(),Rt=Pe.getLayers()||1,fn=Pe.getLevels(),cn=Pe.getHasAlpha(),Jn=Pe.getDFDTransferFunc(),yn=Pe.getDFDFlags(),{transcoderFormat:Wn,engineFormat:gi}=de(ze,et,Tt,cn);if(!et||!Tt||!fn)throw Ve(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Pe.startTranscoding())throw Ve(),new Error("THREE.KTX2Loader: .startTranscoding failed");const ai=[];for(let nt=0;nt<fn;nt++){const dt=[];let Ot,$t;for(let Ye=0;Ye<Rt;Ye++){const mn=Pe.getImageLevelInfo(nt,Ye,0);Ot=mn.origWidth,$t=mn.origHeight;const Pn=new Uint8Array(Pe.getImageTranscodedSizeInBytes(nt,Ye,0,Wn));if(!Pe.transcodeImage(Pn,nt,Ye,0,Wn,0,-1,-1))throw Ve(),new Error("THREE.KTX2Loader: .transcodeImage failed.");dt.push(Pn)}ai.push({data:we(dt),width:Ot,height:$t})}return Ve(),{width:et,height:Tt,hasAlpha:cn,mipmaps:ai,format:gi,dfdTransferFn:Jn,dfdFlags:yn}}const Ae=[{if:"astcSupported",basisFormat:[q.UASTC_4x4],transcoderFormat:[U.ASTC_4x4,U.ASTC_4x4],engineFormat:[W.RGBA_ASTC_4x4_Format,W.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[q.ETC1S,q.UASTC_4x4],transcoderFormat:[U.BC7_M5,U.BC7_M5],engineFormat:[W.RGBA_BPTC_Format,W.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[q.ETC1S,q.UASTC_4x4],transcoderFormat:[U.BC1,U.BC3],engineFormat:[W.RGB_S3TC_DXT1_Format,W.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[q.ETC1S,q.UASTC_4x4],transcoderFormat:[U.ETC1,U.ETC2],engineFormat:[W.RGB_ETC2_Format,W.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[q.ETC1S,q.UASTC_4x4],transcoderFormat:[U.ETC1],engineFormat:[W.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[q.ETC1S,q.UASTC_4x4],transcoderFormat:[U.PVRTC1_4_RGB,U.PVRTC1_4_RGBA],engineFormat:[W.RGB_PVRTC_4BPPV1_Format,W.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],Se=Ae.sort(function(he,Pe){return he.priorityETC1S-Pe.priorityETC1S}),Ie=Ae.sort(function(he,Pe){return he.priorityUASTC-Pe.priorityUASTC});function de(he,Pe,Ve,ze){let et,Tt;const Rt=he===q.ETC1S?Se:Ie;for(let fn=0;fn<Rt.length;fn++){const cn=Rt[fn];if(V[cn.if]&&cn.basisFormat.includes(he)&&!(ze&&cn.transcoderFormat.length<2)&&!(cn.needsPowerOfTwo&&!(pe(Pe)&&pe(Ve))))return et=cn.transcoderFormat[ze?1:0],Tt=cn.engineFormat[ze?1:0],{transcoderFormat:et,engineFormat:Tt}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),et=U.RGBA32,Tt=W.RGBAFormat,{transcoderFormat:et,engineFormat:Tt}}function pe(he){return he<=2?!0:(he&he-1)===0&&he!==0}function we(he){let Pe=0;for(const et of he)Pe+=et.byteLength;const Ve=new Uint8Array(Pe);let ze=0;for(const et of he)Ve.set(et,ze),ze+=et.byteLength;return Ve}};const I={[C.VK_FORMAT_R32G32B32A32_SFLOAT]:B.RGBAFormat,[C.VK_FORMAT_R16G16B16A16_SFLOAT]:B.RGBAFormat,[C.VK_FORMAT_R8G8B8A8_UNORM]:B.RGBAFormat,[C.VK_FORMAT_R8G8B8A8_SRGB]:B.RGBAFormat,[C.VK_FORMAT_R32G32_SFLOAT]:B.RGFormat,[C.VK_FORMAT_R16G16_SFLOAT]:B.RGFormat,[C.VK_FORMAT_R8G8_UNORM]:B.RGFormat,[C.VK_FORMAT_R8G8_SRGB]:B.RGFormat,[C.VK_FORMAT_R32_SFLOAT]:B.RedFormat,[C.VK_FORMAT_R16_SFLOAT]:B.RedFormat,[C.VK_FORMAT_R8_SRGB]:B.RedFormat,[C.VK_FORMAT_R8_UNORM]:B.RedFormat},O={[C.VK_FORMAT_R32G32B32A32_SFLOAT]:B.FloatType,[C.VK_FORMAT_R16G16B16A16_SFLOAT]:B.HalfFloatType,[C.VK_FORMAT_R8G8B8A8_UNORM]:B.UnsignedByteType,[C.VK_FORMAT_R8G8B8A8_SRGB]:B.UnsignedByteType,[C.VK_FORMAT_R32G32_SFLOAT]:B.FloatType,[C.VK_FORMAT_R16G16_SFLOAT]:B.HalfFloatType,[C.VK_FORMAT_R8G8_UNORM]:B.UnsignedByteType,[C.VK_FORMAT_R8G8_SRGB]:B.UnsignedByteType,[C.VK_FORMAT_R32_SFLOAT]:B.FloatType,[C.VK_FORMAT_R16_SFLOAT]:B.HalfFloatType,[C.VK_FORMAT_R8_SRGB]:B.UnsignedByteType,[C.VK_FORMAT_R8_UNORM]:B.UnsignedByteType},_={[C.VK_FORMAT_R8G8B8A8_SRGB]:B.sRGBEncoding,[C.VK_FORMAT_R8G8_SRGB]:B.sRGBEncoding,[C.VK_FORMAT_R8_SRGB]:B.sRGBEncoding};async function D(V){const{vkFormat:J,pixelWidth:Y,pixelHeight:W,pixelDepth:U}=V;if(I[J]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const q=V.levels[0];let oe,ve;if(V.supercompressionScheme===C.KHR_SUPERCOMPRESSION_NONE)oe=q.levelData;else if(V.supercompressionScheme===C.KHR_SUPERCOMPRESSION_ZSTD)b||(b=new Promise(async Se=>{const Ie=new F.ZSTDDecoder;await Ie.init(),Se(Ie)})),oe=(await b).decode(q.levelData,q.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");O[J]===B.FloatType?ve=new Float32Array(oe.buffer,oe.byteOffset,oe.byteLength/Float32Array.BYTES_PER_ELEMENT):O[J]===B.HalfFloatType?ve=new Uint16Array(oe.buffer,oe.byteOffset,oe.byteLength/Uint16Array.BYTES_PER_ELEMENT):ve=oe;const Ae=U===0?new B.DataTexture(ve,Y,W):new B.Data3DTexture(ve,Y,W,U);return Ae.type=O[J],Ae.format=I[J],Ae.encoding=_[J]||B.LinearEncoding,Ae.needsUpdate=!0,Promise.resolve(Ae)}},"./node_modules/super-three/examples/jsm/loaders/MTLLoader.js":(Z,te,E)=>{E.r(te),E.d(te,{MTLLoader:()=>H});var B=E("./node_modules/super-three/build/three.module.js");class H extends B.Loader{constructor(L){super(L)}load(L,M,b,S){const I=this,O=this.path===""?B.LoaderUtils.extractUrlBase(L):this.path,_=new B.FileLoader(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(L,function(D){try{M(I.parse(D,O))}catch(V){S?S(V):console.error(V),I.manager.itemError(L)}},b,S)}setMaterialOptions(L){return this.materialOptions=L,this}parse(L,M){const b=L.split(`
`);let S={};const I=/\s+/,O={};for(let D=0;D<b.length;D++){let V=b[D];if(V=V.trim(),V.length===0||V.charAt(0)==="#")continue;const J=V.indexOf(" ");let Y=J>=0?V.substring(0,J):V;Y=Y.toLowerCase();let W=J>=0?V.substring(J+1):"";if(W=W.trim(),Y==="newmtl")S={name:W},O[W]=S;else if(Y==="ka"||Y==="kd"||Y==="ks"||Y==="ke"){const U=W.split(I,3);S[Y]=[parseFloat(U[0]),parseFloat(U[1]),parseFloat(U[2])]}else S[Y]=W}const _=new C(this.resourcePath||M,this.materialOptions);return _.setCrossOrigin(this.crossOrigin),_.setManager(this.manager),_.setMaterials(O),_}}class C{constructor(L="",M={}){this.baseUrl=L,this.options=M,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:B.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:B.RepeatWrapping}setCrossOrigin(L){return this.crossOrigin=L,this}setManager(L){this.manager=L}setMaterials(L){this.materialsInfo=this.convert(L),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(L){if(!this.options)return L;const M={};for(const b in L){const S=L[b],I={};M[b]=I;for(const O in S){let _=!0,D=S[O];const V=O.toLowerCase();switch(V){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(D=[D[0]/255,D[1]/255,D[2]/255]),this.options&&this.options.ignoreZeroRGBs&&D[0]===0&&D[1]===0&&D[2]===0&&(_=!1);break}_&&(I[V]=D)}}return M}preload(){for(const L in this.materialsInfo)this.create(L)}getIndex(L){return this.nameLookup[L]}getAsArray(){let L=0;for(const M in this.materialsInfo)this.materialsArray[L]=this.create(M),this.nameLookup[M]=L,L++;return this.materialsArray}create(L){return this.materials[L]===void 0&&this.createMaterial_(L),this.materials[L]}createMaterial_(L){const M=this,b=this.materialsInfo[L],S={name:L,side:this.side};function I(_,D){return typeof D!="string"||D===""?"":/^https?:\/\//i.test(D)?D:_+D}function O(_,D){if(S[_])return;const V=M.getTextureParams(D,S),J=M.loadTexture(I(M.baseUrl,V.url));J.repeat.copy(V.scale),J.offset.copy(V.offset),J.wrapS=M.wrap,J.wrapT=M.wrap,(_==="map"||_==="emissiveMap")&&(J.encoding=B.sRGBEncoding),S[_]=J}for(const _ in b){const D=b[_];let V;if(D!=="")switch(_.toLowerCase()){case"kd":S.color=new B.Color().fromArray(D).convertSRGBToLinear();break;case"ks":S.specular=new B.Color().fromArray(D).convertSRGBToLinear();break;case"ke":S.emissive=new B.Color().fromArray(D).convertSRGBToLinear();break;case"map_kd":O("map",D);break;case"map_ks":O("specularMap",D);break;case"map_ke":O("emissiveMap",D);break;case"norm":O("normalMap",D);break;case"map_bump":case"bump":O("bumpMap",D);break;case"map_d":O("alphaMap",D),S.transparent=!0;break;case"ns":S.shininess=parseFloat(D);break;case"d":V=parseFloat(D),V<1&&(S.opacity=V,S.transparent=!0);break;case"tr":V=parseFloat(D),this.options&&this.options.invertTrProperty&&(V=1-V),V>0&&(S.opacity=1-V,S.transparent=!0);break}}return this.materials[L]=new B.MeshPhongMaterial(S),this.materials[L]}getTextureParams(L,M){const b={scale:new B.Vector2(1,1),offset:new B.Vector2(0,0)},S=L.split(/\s+/);let I;return I=S.indexOf("-bm"),I>=0&&(M.bumpScale=parseFloat(S[I+1]),S.splice(I,2)),I=S.indexOf("-s"),I>=0&&(b.scale.set(parseFloat(S[I+1]),parseFloat(S[I+2])),S.splice(I,4)),I=S.indexOf("-o"),I>=0&&(b.offset.set(parseFloat(S[I+1]),parseFloat(S[I+2])),S.splice(I,4)),b.url=S.join(" ").trim(),b}loadTexture(L,M,b,S,I){const O=this.manager!==void 0?this.manager:B.DefaultLoadingManager;let _=O.getHandler(L);_===null&&(_=new B.TextureLoader(O)),_.setCrossOrigin&&_.setCrossOrigin(this.crossOrigin);const D=_.load(L,b,S,I);return M!==void 0&&(D.mapping=M),D}}},"./node_modules/super-three/examples/jsm/loaders/OBJLoader.js":(Z,te,E)=>{E.r(te),E.d(te,{OBJLoader:()=>J});var B=E("./node_modules/super-three/build/three.module.js");const H=/^[og]\s*(.+)?/,C=/^mtllib /,F=/^usemtl /,L=/^usemap /,M=/\s+/,b=new B.Vector3,S=new B.Vector3,I=new B.Vector3,O=new B.Vector3,_=new B.Vector3,D=new B.Color;function V(){const Y={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(W,U){if(this.object&&this.object.fromDeclaration===!1){this.object.name=W,this.object.fromDeclaration=U!==!1;return}const q=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:W||"",fromDeclaration:U!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(oe,ve){const Ae=this._finalize(!1);Ae&&(Ae.inherited||Ae.groupCount<=0)&&this.materials.splice(Ae.index,1);const Se={index:this.materials.length,name:oe||"",mtllib:Array.isArray(ve)&&ve.length>0?ve[ve.length-1]:"",smooth:Ae!==void 0?Ae.smooth:this.smooth,groupStart:Ae!==void 0?Ae.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(Ie){const de={index:typeof Ie=="number"?Ie:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return de.clone=this.clone.bind(de),de}};return this.materials.push(Se),Se},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(oe){const ve=this.currentMaterial();if(ve&&ve.groupEnd===-1&&(ve.groupEnd=this.geometry.vertices.length/3,ve.groupCount=ve.groupEnd-ve.groupStart,ve.inherited=!1),oe&&this.materials.length>1)for(let Ae=this.materials.length-1;Ae>=0;Ae--)this.materials[Ae].groupCount<=0&&this.materials.splice(Ae,1);return oe&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),ve}},q&&q.name&&typeof q.clone=="function"){const oe=q.clone(0);oe.inherited=!0,this.object.materials.push(oe)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(W,U){const q=parseInt(W,10);return(q>=0?q-1:q+U/3)*3},parseNormalIndex:function(W,U){const q=parseInt(W,10);return(q>=0?q-1:q+U/3)*3},parseUVIndex:function(W,U){const q=parseInt(W,10);return(q>=0?q-1:q+U/2)*2},addVertex:function(W,U,q){const oe=this.vertices,ve=this.object.geometry.vertices;ve.push(oe[W+0],oe[W+1],oe[W+2]),ve.push(oe[U+0],oe[U+1],oe[U+2]),ve.push(oe[q+0],oe[q+1],oe[q+2])},addVertexPoint:function(W){const U=this.vertices;this.object.geometry.vertices.push(U[W+0],U[W+1],U[W+2])},addVertexLine:function(W){const U=this.vertices;this.object.geometry.vertices.push(U[W+0],U[W+1],U[W+2])},addNormal:function(W,U,q){const oe=this.normals,ve=this.object.geometry.normals;ve.push(oe[W+0],oe[W+1],oe[W+2]),ve.push(oe[U+0],oe[U+1],oe[U+2]),ve.push(oe[q+0],oe[q+1],oe[q+2])},addFaceNormal:function(W,U,q){const oe=this.vertices,ve=this.object.geometry.normals;b.fromArray(oe,W),S.fromArray(oe,U),I.fromArray(oe,q),_.subVectors(I,S),O.subVectors(b,S),_.cross(O),_.normalize(),ve.push(_.x,_.y,_.z),ve.push(_.x,_.y,_.z),ve.push(_.x,_.y,_.z)},addColor:function(W,U,q){const oe=this.colors,ve=this.object.geometry.colors;oe[W]!==void 0&&ve.push(oe[W+0],oe[W+1],oe[W+2]),oe[U]!==void 0&&ve.push(oe[U+0],oe[U+1],oe[U+2]),oe[q]!==void 0&&ve.push(oe[q+0],oe[q+1],oe[q+2])},addUV:function(W,U,q){const oe=this.uvs,ve=this.object.geometry.uvs;ve.push(oe[W+0],oe[W+1]),ve.push(oe[U+0],oe[U+1]),ve.push(oe[q+0],oe[q+1])},addDefaultUV:function(){const W=this.object.geometry.uvs;W.push(0,0),W.push(0,0),W.push(0,0)},addUVLine:function(W){const U=this.uvs;this.object.geometry.uvs.push(U[W+0],U[W+1])},addFace:function(W,U,q,oe,ve,Ae,Se,Ie,de){const pe=this.vertices.length;let we=this.parseVertexIndex(W,pe),he=this.parseVertexIndex(U,pe),Pe=this.parseVertexIndex(q,pe);if(this.addVertex(we,he,Pe),this.addColor(we,he,Pe),Se!==void 0&&Se!==""){const Ve=this.normals.length;we=this.parseNormalIndex(Se,Ve),he=this.parseNormalIndex(Ie,Ve),Pe=this.parseNormalIndex(de,Ve),this.addNormal(we,he,Pe)}else this.addFaceNormal(we,he,Pe);if(oe!==void 0&&oe!==""){const Ve=this.uvs.length;we=this.parseUVIndex(oe,Ve),he=this.parseUVIndex(ve,Ve),Pe=this.parseUVIndex(Ae,Ve),this.addUV(we,he,Pe),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(W){this.object.geometry.type="Points";const U=this.vertices.length;for(let q=0,oe=W.length;q<oe;q++){const ve=this.parseVertexIndex(W[q],U);this.addVertexPoint(ve),this.addColor(ve)}},addLineGeometry:function(W,U){this.object.geometry.type="Line";const q=this.vertices.length,oe=this.uvs.length;for(let ve=0,Ae=W.length;ve<Ae;ve++)this.addVertexLine(this.parseVertexIndex(W[ve],q));for(let ve=0,Ae=U.length;ve<Ae;ve++)this.addUVLine(this.parseUVIndex(U[ve],oe))}};return Y.startObject("",!1),Y}class J extends B.Loader{constructor(W){super(W),this.materials=null}load(W,U,q,oe){const ve=this,Ae=new B.FileLoader(this.manager);Ae.setPath(this.path),Ae.setRequestHeader(this.requestHeader),Ae.setWithCredentials(this.withCredentials),Ae.load(W,function(Se){try{U(ve.parse(Se))}catch(Ie){oe?oe(Ie):console.error(Ie),ve.manager.itemError(W)}},q,oe)}setMaterials(W){return this.materials=W,this}parse(W){const U=new V;W.indexOf(`\r
`)!==-1&&(W=W.replace(/\r\n/g,`
`)),W.indexOf(`\\
`)!==-1&&(W=W.replace(/\\\n/g,""));const q=W.split(`
`);let oe=[];for(let Se=0,Ie=q.length;Se<Ie;Se++){const de=q[Se].trimStart();if(de.length===0)continue;const pe=de.charAt(0);if(pe!=="#")if(pe==="v"){const we=de.split(M);switch(we[0]){case"v":U.vertices.push(parseFloat(we[1]),parseFloat(we[2]),parseFloat(we[3])),we.length>=7?(D.setRGB(parseFloat(we[4]),parseFloat(we[5]),parseFloat(we[6])).convertSRGBToLinear(),U.colors.push(D.r,D.g,D.b)):U.colors.push(void 0,void 0,void 0);break;case"vn":U.normals.push(parseFloat(we[1]),parseFloat(we[2]),parseFloat(we[3]));break;case"vt":U.uvs.push(parseFloat(we[1]),parseFloat(we[2]));break}}else if(pe==="f"){const he=de.slice(1).trim().split(M),Pe=[];for(let ze=0,et=he.length;ze<et;ze++){const Tt=he[ze];if(Tt.length>0){const Rt=Tt.split("/");Pe.push(Rt)}}const Ve=Pe[0];for(let ze=1,et=Pe.length-1;ze<et;ze++){const Tt=Pe[ze],Rt=Pe[ze+1];U.addFace(Ve[0],Tt[0],Rt[0],Ve[1],Tt[1],Rt[1],Ve[2],Tt[2],Rt[2])}}else if(pe==="l"){const we=de.substring(1).trim().split(" ");let he=[];const Pe=[];if(de.indexOf("/")===-1)he=we;else for(let Ve=0,ze=we.length;Ve<ze;Ve++){const et=we[Ve].split("/");et[0]!==""&&he.push(et[0]),et[1]!==""&&Pe.push(et[1])}U.addLineGeometry(he,Pe)}else if(pe==="p"){const he=de.slice(1).trim().split(" ");U.addPointGeometry(he)}else if((oe=H.exec(de))!==null){const we=(" "+oe[0].slice(1).trim()).slice(1);U.startObject(we)}else if(F.test(de))U.object.startMaterial(de.substring(7).trim(),U.materialLibraries);else if(C.test(de))U.materialLibraries.push(de.substring(7).trim());else if(L.test(de))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(pe==="s"){if(oe=de.split(" "),oe.length>1){const he=oe[1].trim().toLowerCase();U.object.smooth=he!=="0"&&he!=="off"}else U.object.smooth=!0;const we=U.object.currentMaterial();we&&(we.smooth=U.object.smooth)}else{if(de==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+de+'"')}}U.finalize();const ve=new B.Group;if(ve.materialLibraries=[].concat(U.materialLibraries),!(U.objects.length===1&&U.objects[0].geometry.vertices.length===0)===!0)for(let Se=0,Ie=U.objects.length;Se<Ie;Se++){const de=U.objects[Se],pe=de.geometry,we=de.materials,he=pe.type==="Line",Pe=pe.type==="Points";let Ve=!1;if(pe.vertices.length===0)continue;const ze=new B.BufferGeometry;ze.setAttribute("position",new B.Float32BufferAttribute(pe.vertices,3)),pe.normals.length>0&&ze.setAttribute("normal",new B.Float32BufferAttribute(pe.normals,3)),pe.colors.length>0&&(Ve=!0,ze.setAttribute("color",new B.Float32BufferAttribute(pe.colors,3))),pe.hasUVIndices===!0&&ze.setAttribute("uv",new B.Float32BufferAttribute(pe.uvs,2));const et=[];for(let Rt=0,fn=we.length;Rt<fn;Rt++){const cn=we[Rt],Jn=cn.name+"_"+cn.smooth+"_"+Ve;let yn=U.materials[Jn];if(this.materials!==null){if(yn=this.materials.create(cn.name),he&&yn&&!(yn instanceof B.LineBasicMaterial)){const Wn=new B.LineBasicMaterial;B.Material.prototype.copy.call(Wn,yn),Wn.color.copy(yn.color),yn=Wn}else if(Pe&&yn&&!(yn instanceof B.PointsMaterial)){const Wn=new B.PointsMaterial({size:10,sizeAttenuation:!1});B.Material.prototype.copy.call(Wn,yn),Wn.color.copy(yn.color),Wn.map=yn.map,yn=Wn}}yn===void 0&&(he?yn=new B.LineBasicMaterial:Pe?yn=new B.PointsMaterial({size:1,sizeAttenuation:!1}):yn=new B.MeshPhongMaterial,yn.name=cn.name,yn.flatShading=!cn.smooth,yn.vertexColors=Ve,U.materials[Jn]=yn),et.push(yn)}let Tt;if(et.length>1){for(let Rt=0,fn=we.length;Rt<fn;Rt++){const cn=we[Rt];ze.addGroup(cn.groupStart,cn.groupCount,Rt)}he?Tt=new B.LineSegments(ze,et):Pe?Tt=new B.Points(ze,et):Tt=new B.Mesh(ze,et)}else he?Tt=new B.LineSegments(ze,et[0]):Pe?Tt=new B.Points(ze,et[0]):Tt=new B.Mesh(ze,et[0]);Tt.name=de.name,ve.add(Tt)}else if(U.vertices.length>0){const Se=new B.PointsMaterial({size:1,sizeAttenuation:!1}),Ie=new B.BufferGeometry;Ie.setAttribute("position",new B.Float32BufferAttribute(U.vertices,3)),U.colors.length>0&&U.colors[0]!==void 0&&(Ie.setAttribute("color",new B.Float32BufferAttribute(U.colors,3)),Se.vertexColors=!0);const de=new B.Points(Ie,Se);ve.add(de)}return ve}}},"./node_modules/super-three/examples/jsm/utils/BufferGeometryUtils.js":(Z,te,E)=>{E.r(te),E.d(te,{computeMikkTSpaceTangents:()=>C,computeMorphedAttributes:()=>V,computeTangents:()=>H,deepCloneAttribute:()=>M,deinterleaveAttribute:()=>S,deinterleaveGeometry:()=>I,estimateBytesUsed:()=>O,interleaveAttributes:()=>b,mergeBufferAttributes:()=>L,mergeBufferGeometries:()=>F,mergeGroups:()=>J,mergeVertices:()=>_,toCreasedNormals:()=>Y,toTrianglesDrawMode:()=>D});var B=E("./node_modules/super-three/build/three.module.js");function H(){throw new Error("BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.")}function C(W,U,q=!0){if(!U||!U.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!W.hasAttribute("position")||!W.hasAttribute("normal")||!W.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function oe(Se){if(Se.normalized||Se.isInterleavedBufferAttribute){const Ie=new Float32Array(Se.getCount()*Se.itemSize);for(let de=0,pe=0;de<Se.getCount();de++)Ie[pe++]=Se.getX(de),Ie[pe++]=Se.getY(de),Se.itemSize>2&&(Ie[pe++]=Se.getZ(de));return Ie}return Se.array instanceof Float32Array?Se.array:new Float32Array(Se.array)}const ve=W.index?W.toNonIndexed():W,Ae=U.generateTangents(oe(ve.attributes.position),oe(ve.attributes.normal),oe(ve.attributes.uv));if(q)for(let Se=3;Se<Ae.length;Se+=4)Ae[Se]*=-1;return ve.setAttribute("tangent",new B.BufferAttribute(Ae,4)),W!==ve&&W.copy(ve),W}function F(W,U=!1){const q=W[0].index!==null,oe=new Set(Object.keys(W[0].attributes)),ve=new Set(Object.keys(W[0].morphAttributes)),Ae={},Se={},Ie=W[0].morphTargetsRelative,de=new B.BufferGeometry;let pe=0;for(let we=0;we<W.length;++we){const he=W[we];let Pe=0;if(q!==(he.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const Ve in he.attributes){if(!oe.has(Ve))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+'. All geometries must have compatible attributes; make sure "'+Ve+'" attribute exists among all geometries, or in none of them.'),null;Ae[Ve]===void 0&&(Ae[Ve]=[]),Ae[Ve].push(he.attributes[Ve]),Pe++}if(Pe!==oe.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+". Make sure all geometries have the same number of attributes."),null;if(Ie!==he.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const Ve in he.morphAttributes){if(!ve.has(Ve))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+".  .morphAttributes must be consistent throughout all geometries."),null;Se[Ve]===void 0&&(Se[Ve]=[]),Se[Ve].push(he.morphAttributes[Ve])}if(U){let Ve;if(q)Ve=he.index.count;else if(he.attributes.position!==void 0)Ve=he.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+we+". The geometry must have either an index or a position attribute"),null;de.addGroup(pe,Ve,we),pe+=Ve}}if(q){let we=0;const he=[];for(let Pe=0;Pe<W.length;++Pe){const Ve=W[Pe].index;for(let ze=0;ze<Ve.count;++ze)he.push(Ve.getX(ze)+we);we+=W[Pe].attributes.position.count}de.setIndex(he)}for(const we in Ae){const he=L(Ae[we]);if(!he)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+we+" attribute."),null;de.setAttribute(we,he)}for(const we in Se){const he=Se[we][0].length;if(he===0)break;de.morphAttributes=de.morphAttributes||{},de.morphAttributes[we]=[];for(let Pe=0;Pe<he;++Pe){const Ve=[];for(let et=0;et<Se[we].length;++et)Ve.push(Se[we][et][Pe]);const ze=L(Ve);if(!ze)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+we+" morphAttribute."),null;de.morphAttributes[we].push(ze)}}return de}function L(W){let U,q,oe,ve=0;for(let Ie=0;Ie<W.length;++Ie){const de=W[Ie];if(de.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(U===void 0&&(U=de.array.constructor),U!==de.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(q===void 0&&(q=de.itemSize),q!==de.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(oe===void 0&&(oe=de.normalized),oe!==de.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;ve+=de.array.length}const Ae=new U(ve);let Se=0;for(let Ie=0;Ie<W.length;++Ie)Ae.set(W[Ie].array,Se),Se+=W[Ie].array.length;return new B.BufferAttribute(Ae,q,oe)}function M(W){return W.isInstancedInterleavedBufferAttribute||W.isInterleavedBufferAttribute?S(W):W.isInstancedBufferAttribute?new B.InstancedBufferAttribute().copy(W):new B.BufferAttribute().copy(W)}function b(W){let U,q=0,oe=0;for(let pe=0,we=W.length;pe<we;++pe){const he=W[pe];if(U===void 0&&(U=he.array.constructor),U!==he.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;q+=he.array.length,oe+=he.itemSize}const ve=new B.InterleavedBuffer(new U(q),oe);let Ae=0;const Se=[],Ie=["getX","getY","getZ","getW"],de=["setX","setY","setZ","setW"];for(let pe=0,we=W.length;pe<we;pe++){const he=W[pe],Pe=he.itemSize,Ve=he.count,ze=new B.InterleavedBufferAttribute(ve,Pe,Ae,he.normalized);Se.push(ze),Ae+=Pe;for(let et=0;et<Ve;et++)for(let Tt=0;Tt<Pe;Tt++)ze[de[Tt]](et,he[Ie[Tt]](et))}return Se}function S(W){const U=W.data.array.constructor,q=W.count,oe=W.itemSize,ve=W.normalized,Ae=new U(q*oe);let Se;W.isInstancedInterleavedBufferAttribute?Se=new B.InstancedBufferAttribute(Ae,oe,ve,W.meshPerAttribute):Se=new B.BufferAttribute(Ae,oe,ve);for(let Ie=0;Ie<q;Ie++)Se.setX(Ie,W.getX(Ie)),oe>=2&&Se.setY(Ie,W.getY(Ie)),oe>=3&&Se.setZ(Ie,W.getZ(Ie)),oe>=4&&Se.setW(Ie,W.getW(Ie));return Se}function I(W){const U=W.attributes,q=W.morphTargets,oe=new Map;for(const ve in U){const Ae=U[ve];Ae.isInterleavedBufferAttribute&&(oe.has(Ae)||oe.set(Ae,S(Ae)),U[ve]=oe.get(Ae))}for(const ve in q){const Ae=q[ve];Ae.isInterleavedBufferAttribute&&(oe.has(Ae)||oe.set(Ae,S(Ae)),q[ve]=oe.get(Ae))}}function O(W){let U=0;for(const oe in W.attributes){const ve=W.getAttribute(oe);U+=ve.count*ve.itemSize*ve.array.BYTES_PER_ELEMENT}const q=W.getIndex();return U+=q?q.count*q.itemSize*q.array.BYTES_PER_ELEMENT:0,U}function _(W,U=1e-4){U=Math.max(U,Number.EPSILON);const q={},oe=W.getIndex(),ve=W.getAttribute("position"),Ae=oe?oe.count:ve.count;let Se=0;const Ie=Object.keys(W.attributes),de={},pe={},we=[],he=["getX","getY","getZ","getW"],Pe=["setX","setY","setZ","setW"];for(let Tt=0,Rt=Ie.length;Tt<Rt;Tt++){const fn=Ie[Tt],cn=W.attributes[fn];de[fn]=new B.BufferAttribute(new cn.array.constructor(cn.count*cn.itemSize),cn.itemSize,cn.normalized);const Jn=W.morphAttributes[fn];Jn&&(pe[fn]=new B.BufferAttribute(new Jn.array.constructor(Jn.count*Jn.itemSize),Jn.itemSize,Jn.normalized))}const Ve=Math.log10(1/U),ze=Math.pow(10,Ve);for(let Tt=0;Tt<Ae;Tt++){const Rt=oe?oe.getX(Tt):Tt;let fn="";for(let cn=0,Jn=Ie.length;cn<Jn;cn++){const yn=Ie[cn],Wn=W.getAttribute(yn),gi=Wn.itemSize;for(let ai=0;ai<gi;ai++)fn+=`${~~(Wn[he[ai]](Rt)*ze)},`}if(fn in q)we.push(q[fn]);else{for(let cn=0,Jn=Ie.length;cn<Jn;cn++){const yn=Ie[cn],Wn=W.getAttribute(yn),gi=W.morphAttributes[yn],ai=Wn.itemSize,nt=de[yn],dt=pe[yn];for(let Ot=0;Ot<ai;Ot++){const $t=he[Ot],Ye=Pe[Ot];if(nt[Ye](Se,Wn[$t](Rt)),gi)for(let mn=0,Pn=gi.length;mn<Pn;mn++)dt[mn][Ye](Se,gi[mn][$t](Rt))}}q[fn]=Se,we.push(Se),Se++}}const et=W.clone();for(const Tt in W.attributes){const Rt=de[Tt];if(et.setAttribute(Tt,new B.BufferAttribute(Rt.array.slice(0,Se*Rt.itemSize),Rt.itemSize,Rt.normalized)),Tt in pe)for(let fn=0;fn<pe[Tt].length;fn++){const cn=pe[Tt][fn];et.morphAttributes[Tt][fn]=new B.BufferAttribute(cn.array.slice(0,Se*cn.itemSize),cn.itemSize,cn.normalized)}}return et.setIndex(we),et}function D(W,U){if(U===B.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),W;if(U===B.TriangleFanDrawMode||U===B.TriangleStripDrawMode){let q=W.getIndex();if(q===null){const Se=[],Ie=W.getAttribute("position");if(Ie!==void 0){for(let de=0;de<Ie.count;de++)Se.push(de);W.setIndex(Se),q=W.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),W}const oe=q.count-2,ve=[];if(U===B.TriangleFanDrawMode)for(let Se=1;Se<=oe;Se++)ve.push(q.getX(0)),ve.push(q.getX(Se)),ve.push(q.getX(Se+1));else for(let Se=0;Se<oe;Se++)Se%2===0?(ve.push(q.getX(Se)),ve.push(q.getX(Se+1)),ve.push(q.getX(Se+2))):(ve.push(q.getX(Se+2)),ve.push(q.getX(Se+1)),ve.push(q.getX(Se)));ve.length/3!==oe&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const Ae=W.clone();return Ae.setIndex(ve),Ae.clearGroups(),Ae}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",U),W}function V(W){if(W.geometry.isBufferGeometry!==!0)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const U=new B.Vector3,q=new B.Vector3,oe=new B.Vector3,ve=new B.Vector3,Ae=new B.Vector3,Se=new B.Vector3,Ie=new B.Vector3,de=new B.Vector3,pe=new B.Vector3;function we(ui,Nt,De,Re,We,Oe,Qe,Ke){U.fromBufferAttribute(Nt,We),q.fromBufferAttribute(Nt,Oe),oe.fromBufferAttribute(Nt,Qe);const vt=ui.morphTargetInfluences;if(De&&vt){Ie.set(0,0,0),de.set(0,0,0),pe.set(0,0,0);for(let ct=0,Ct=De.length;ct<Ct;ct++){const Yt=vt[ct],me=De[ct];Yt!==0&&(ve.fromBufferAttribute(me,We),Ae.fromBufferAttribute(me,Oe),Se.fromBufferAttribute(me,Qe),Re?(Ie.addScaledVector(ve,Yt),de.addScaledVector(Ae,Yt),pe.addScaledVector(Se,Yt)):(Ie.addScaledVector(ve.sub(U),Yt),de.addScaledVector(Ae.sub(q),Yt),pe.addScaledVector(Se.sub(oe),Yt)))}U.add(Ie),q.add(de),oe.add(pe)}ui.isSkinnedMesh&&(ui.boneTransform(We,U),ui.boneTransform(Oe,q),ui.boneTransform(Qe,oe)),Ke[We*3+0]=U.x,Ke[We*3+1]=U.y,Ke[We*3+2]=U.z,Ke[Oe*3+0]=q.x,Ke[Oe*3+1]=q.y,Ke[Oe*3+2]=q.z,Ke[Qe*3+0]=oe.x,Ke[Qe*3+1]=oe.y,Ke[Qe*3+2]=oe.z}const he=W.geometry,Pe=W.material;let Ve,ze,et;const Tt=he.index,Rt=he.attributes.position,fn=he.morphAttributes.position,cn=he.morphTargetsRelative,Jn=he.attributes.normal,yn=he.morphAttributes.position,Wn=he.groups,gi=he.drawRange;let ai,nt,dt,Ot,$t,Ye,mn;const Pn=new Float32Array(Rt.count*Rt.itemSize),wn=new Float32Array(Jn.count*Jn.itemSize);if(Tt!==null)if(Array.isArray(Pe))for(ai=0,dt=Wn.length;ai<dt;ai++)for($t=Wn[ai],Ye=Math.max($t.start,gi.start),mn=Math.min($t.start+$t.count,gi.start+gi.count),nt=Ye,Ot=mn;nt<Ot;nt+=3)Ve=Tt.getX(nt),ze=Tt.getX(nt+1),et=Tt.getX(nt+2),we(W,Rt,fn,cn,Ve,ze,et,Pn),we(W,Jn,yn,cn,Ve,ze,et,wn);else for(Ye=Math.max(0,gi.start),mn=Math.min(Tt.count,gi.start+gi.count),ai=Ye,dt=mn;ai<dt;ai+=3)Ve=Tt.getX(ai),ze=Tt.getX(ai+1),et=Tt.getX(ai+2),we(W,Rt,fn,cn,Ve,ze,et,Pn),we(W,Jn,yn,cn,Ve,ze,et,wn);else if(Array.isArray(Pe))for(ai=0,dt=Wn.length;ai<dt;ai++)for($t=Wn[ai],Ye=Math.max($t.start,gi.start),mn=Math.min($t.start+$t.count,gi.start+gi.count),nt=Ye,Ot=mn;nt<Ot;nt+=3)Ve=nt,ze=nt+1,et=nt+2,we(W,Rt,fn,cn,Ve,ze,et,Pn),we(W,Jn,yn,cn,Ve,ze,et,wn);else for(Ye=Math.max(0,gi.start),mn=Math.min(Rt.count,gi.start+gi.count),ai=Ye,dt=mn;ai<dt;ai+=3)Ve=ai,ze=ai+1,et=ai+2,we(W,Rt,fn,cn,Ve,ze,et,Pn),we(W,Jn,yn,cn,Ve,ze,et,wn);const Dn=new B.Float32BufferAttribute(Pn,3),gn=new B.Float32BufferAttribute(wn,3);return{positionAttribute:Rt,normalAttribute:Jn,morphedPositionAttribute:Dn,morphedNormalAttribute:gn}}function J(W){if(W.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),W;let U=W.groups;if(U=U.sort((Se,Ie)=>Se.materialIndex!==Ie.materialIndex?Se.materialIndex-Ie.materialIndex:Se.start-Ie.start),W.getIndex()===null){const Se=W.getAttribute("position"),Ie=[];for(let de=0;de<Se.count;de+=3)Ie.push(de,de+1,de+2);W.setIndex(Ie)}const q=W.getIndex(),oe=[];for(let Se=0;Se<U.length;Se++){const Ie=U[Se],de=Ie.start,pe=de+Ie.count;for(let we=de;we<pe;we++)oe.push(q.getX(we))}W.dispose(),W.setIndex(oe);let ve=0;for(let Se=0;Se<U.length;Se++){const Ie=U[Se];Ie.start=ve,ve+=Ie.count}let Ae=U[0];W.groups=[Ae];for(let Se=1;Se<U.length;Se++){const Ie=U[Se];Ae.materialIndex===Ie.materialIndex?Ae.count+=Ie.count:(Ae=Ie,W.groups.push(Ae))}return W}function Y(W,U=Math.PI/3){const q=Math.cos(U),oe=(1+1e-10)*100,ve=[new B.Vector3,new B.Vector3,new B.Vector3],Ae=new B.Vector3,Se=new B.Vector3,Ie=new B.Vector3,de=new B.Vector3;function pe(et){const Tt=~~(et.x*oe),Rt=~~(et.y*oe),fn=~~(et.z*oe);return`${Tt},${Rt},${fn}`}const we=W.toNonIndexed(),he=we.attributes.position,Pe={};for(let et=0,Tt=he.count/3;et<Tt;et++){const Rt=3*et,fn=ve[0].fromBufferAttribute(he,Rt+0),cn=ve[1].fromBufferAttribute(he,Rt+1),Jn=ve[2].fromBufferAttribute(he,Rt+2);Ae.subVectors(Jn,cn),Se.subVectors(fn,cn);const yn=new B.Vector3().crossVectors(Ae,Se).normalize();for(let Wn=0;Wn<3;Wn++){const gi=ve[Wn],ai=pe(gi);ai in Pe||(Pe[ai]=[]),Pe[ai].push(yn)}}const Ve=new Float32Array(he.count*3),ze=new B.BufferAttribute(Ve,3,!1);for(let et=0,Tt=he.count/3;et<Tt;et++){const Rt=3*et,fn=ve[0].fromBufferAttribute(he,Rt+0),cn=ve[1].fromBufferAttribute(he,Rt+1),Jn=ve[2].fromBufferAttribute(he,Rt+2);Ae.subVectors(Jn,cn),Se.subVectors(fn,cn),Ie.crossVectors(Ae,Se).normalize();for(let yn=0;yn<3;yn++){const Wn=ve[yn],gi=pe(Wn),ai=Pe[gi];de.set(0,0,0);for(let nt=0,dt=ai.length;nt<dt;nt++){const Ot=ai[nt];Ie.dot(Ot)>q&&de.add(Ot)}de.normalize(),ze.setXYZ(Rt+yn,de.x,de.y,de.z)}}return we.setAttribute("normal",ze),we}},"./node_modules/super-three/examples/jsm/utils/WorkerPool.js":(Z,te,E)=>{E.r(te),E.d(te,{WorkerPool:()=>B});class B{constructor(C=4){this.pool=C,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(C){if(!this.workers[C]){const F=this.workerCreator();F.addEventListener("message",this._onMessage.bind(this,C)),this.workers[C]=F}}_getIdleWorker(){for(let C=0;C<this.pool;C++)if(!(this.workerStatus&1<<C))return C;return-1}_onMessage(C,F){const L=this.workersResolve[C];if(L&&L(F),this.queue.length){const{resolve:M,msg:b,transfer:S}=this.queue.shift();this.workersResolve[C]=M,this.workers[C].postMessage(b,S)}else this.workerStatus^=1<<C}setWorkerCreator(C){this.workerCreator=C}setWorkerLimit(C){this.pool=C}postMessage(C,F){return new Promise(L=>{const M=this._getIdleWorker();M!==-1?(this._initWorker(M),this.workerStatus|=1<<M,this.workersResolve[M]=L,this.workers[M].postMessage(C,F)):this.queue.push({resolve:L,msg:C,transfer:F})})}dispose(){this.workers.forEach(C=>C.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}},"./package.json":Z=>{Z.exports=JSON.parse('{"name":"aframe","version":"1.4.1","description":"A web framework for building virtual reality experiences.","homepage":"https://aframe.io/","main":"dist/aframe-master.js","scripts":{"dev":"cross-env INSPECTOR_VERSION=dev webpack serve --port 8080","dist":"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"webpack --config webpack.config.js","dist:min":"webpack --config webpack.prod.config.js","docs":"markserv --dir docs --port 9001","preghpages":"node ./scripts/preghpages.js","ghpages":"ghpages -p gh-pages/","lint":"semistandard -v | snazzy","lint:fix":"semistandard --fix","precommit":"npm run lint","prepush":"node scripts/testOnlyCheck.js","prerelease":"node scripts/release.js 1.3.0 1.4.0","start":"npm run dev","start:https":"npm run dev -- --server-type https","test":"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"mocha --ui tdd tests/node"},"repository":"aframevr/aframe","license":"MIT","files":["dist/*","docs/**/*","src/**/*","vendor/**/*"],"dependencies":{"buffer":"^6.0.3","custom-event-polyfill":"^1.0.6","debug":"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","@ungap/custom-elements":"^1.1.0","load-bmfont":"^1.2.3","object-assign":"^4.0.1","present":"0.0.6","promise-polyfill":"^3.1.0","super-animejs":"^3.1.0","super-three":"^0.147.1","three-bmfont-text":"dmarcos/three-bmfont-text#21d017046216e318362c48abd1a48bddfb6e0733","webvr-polyfill":"^0.10.12"},"devDependencies":{"@babel/core":"^7.17.10","babel-loader":"^8.2.5","babel-plugin-istanbul":"^6.1.1","chai":"^4.3.6","chai-shallow-deep-equal":"^1.4.0","chalk":"^1.1.3","cross-env":"^7.0.3","css-loader":"^6.7.1","ghpages":"0.0.8","git-rev":"^0.2.1","glob":"^8.0.3","husky":"^0.11.7","jsdom":"^20.0.0","karma":"^6.4.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sinon-chai":"^2.0.2","karma-webpack":"^5.0.0","markserv":"github:sukima/markserv#feature/fix-broken-websoketio-link","mocha":"^10.0.0","replace-in-file":"^2.5.3","semistandard":"^9.0.0","shelljs":"^0.7.7","shx":"^0.2.2","sinon":"<12.0.0","sinon-chai":"^3.7.0","snazzy":"^5.0.0","style-loader":"^3.3.1","too-wordy":"ngokevin/too-wordy","webpack":"^5.73.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.11.0","webpack-merge":"^5.8.0","write-good":"^1.0.8"},"link":true,"semistandard":{"ignore":["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},"keywords":["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"engines":{"node":">= 4.6.0","npm":">= 2.15.9"}}')}},xe={};function Te(Z){var te=xe[Z];if(te!==void 0)return te.exports;var E=xe[Z]={id:Z,exports:{}};return ue[Z].call(E.exports,E,E.exports,Te),E.exports}Te.m=ue,Te.n=Z=>{var te=Z&&Z.__esModule?()=>Z.default:()=>Z;return Te.d(te,{a:te}),te},Te.d=(Z,te)=>{for(var E in te)Te.o(te,E)&&!Te.o(Z,E)&&Object.defineProperty(Z,E,{enumerable:!0,get:te[E]})},Te.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),Te.o=(Z,te)=>Object.prototype.hasOwnProperty.call(Z,te),Te.r=Z=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Z,"__esModule",{value:!0})},Te.b=document.baseURI||self.location.href,Te.nc=void 0;var Ne=Te("./src/index.js");return Ne})())})(AZ);var XA={},vZ={get exports(){return XA},set exports(T){XA=T}},R_;function yZ(){return R_||(R_=1,function(T,Q){var ue=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof yg<"u")return yg;throw new Error("unable to locate global object")},xe=ue();T.exports=Q=xe.fetch,xe.fetch&&(Q.default=xe.fetch.bind(xe)),Q.Headers=xe.Headers,Q.Request=xe.Request,Q.Response=xe.Response}(vZ,XA)),XA}const bZ={},xZ=Object.freeze(Object.defineProperty({__proto__:null,default:bZ},Symbol.toStringTag,{value:"Module"})),CZ=gZ(xZ);(function(){function T(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(i,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Q=1e-7,ue=1e-4;class xe{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Te{refCount(e){return Ne("refCount")}incRef(e){return Ne("incRef")}timerAvailable(){return!0}time(e){return Ne("time")}read(e){return Ne("read")}readSync(e){return Ne("readSync")}readToGPU(e,t){return Ne("readToGPU")}numDataIds(){return Ne("numDataIds")}disposeData(e,t){return Ne("disposeData")}write(e,t,r){return Ne("write")}move(e,t,r,s,o){return Ne("move")}memory(){return Ne("memory")}floatPrecision(){return Ne("floatPrecision")}epsilon(){return this.floatPrecision()===32?Q:ue}dispose(){return Ne("dispose")}}function Ne(i){throw new Error(`'${i}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z(i){let e=i.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,B(i,e,t)}function te(i,e,t){return Math.max(i,Math.min(e,t))}function E(i){return i%2===0?i:i+1}function B(i,e,t){const r=i[e];i[e]=i[t],i[t]=r}function H(i){let e=0;for(let t=0;t<i.length;t++)e+=i[t];return e}function C(i,e){if(!i)throw new Error(typeof e=="string"?e:e())}function F(i,e,t=""){C(S(i,e),()=>t+` Shapes ${i} and ${e} must match`)}function L(i){C(i!=null,()=>"The input to the tensor constructor must be a non-null value.")}function M(i,e=[],t=!1){if(e==null&&(e=[]),Array.isArray(i)||Ae(i)&&!t)for(let r=0;r<i.length;++r)M(i[r],e,t);else e.push(i);return e}function b(i){if(i.length===0)return 1;let e=i[0];for(let t=1;t<i.length;t++)e*=i[t];return e}function S(i,e){if(i===e)return!0;if(i==null||e==null||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function I(i){return i%1===0}function O(i){const e=Math.ceil(Math.sqrt(i));return[e,Math.ceil(i/e)]}function _(i,e){return e<=i.length?i:i+" ".repeat(e-i.length)}function D(i,e=s=>0,t,r=setTimeout){return new Promise((s,o)=>{let l=0;const c=()=>{if(i()){s();return}l++;const h=e(l);if(t!=null&&l>=t){o();return}r(c,h)};c()})}function V(i,e){let t=1,r=-1;for(let o=0;o<i.length;++o)if(i[o]>=0)t*=i[o];else if(i[o]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${o}`);r=o}else if(i[o]<0)throw Error(`Shapes can not be < 0. Found ${i[o]} at dim ${o}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${i}`);return i}if(t===0)throw Error(`Cannot infer the missing size in [${i}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=i.slice();return s[r]=e/t,s}function J(i,e){const t=e.length;return i=i==null?e.map((r,s)=>s):[].concat(i),C(i.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${i}`),C(i.every(r=>I(r)),()=>`All values in axis param must be integers but got axis ${i}`),i.map(r=>r<0?t+r:r)}function Y(i,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||s?null:J(e,i).sort();let l=0;for(let c=0;c<i.length;++c){if(o!=null){if(o[l]===c&&i[c]!==1)throw new Error(`Can't squeeze axis ${c} since its dim '${i[c]}' is not 1`);(o[l]==null||o[l]>c)&&i[c]===1&&(t.push(i[c]),r.push(c)),o[l]<=c&&l++}i[c]!==1&&(t.push(i[c]),r.push(c))}return{newShape:t,keptDims:r}}function W(i,e){let t=null;if(i==null||i==="float32")t=new Float32Array(e);else if(i==="int32")t=new Int32Array(e);else if(i==="bool")t=new Uint8Array(e);else throw new Error(`Unknown data type ${i}`);return t}function U(i,e){let t=null;if(i==null||i==="float32")t=new Float32Array(e);else if(i==="int32")t=new Int32Array(e);else if(i==="bool")t=new Uint8Array(e);else if(i==="string")t=new Array(e);else throw new Error(`Unknown data type ${i}`);return t}function q(i,e){for(let t=0;t<i.length;t++){const r=i[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function oe(i){return i==="bool"||i==="complex64"||i==="float32"||i==="int32"||i==="string"}function ve(i,e){return!(e==="complex64"||e==="float32"&&i!=="complex64"||e==="int32"&&i!=="float32"&&i!=="complex64"||e==="bool"&&i==="bool")}function Ae(i){return i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray}function Se(i){if(i==="float32"||i==="int32")return 4;if(i==="complex64")return 8;if(i==="bool")return 1;throw new Error(`Unknown dtype ${i}`)}function Ie(i){if(i==null)return 0;let e=0;return i.forEach(t=>e+=t.length),e}function de(i){return typeof i=="string"||i instanceof String}function pe(i){return typeof i=="boolean"}function we(i){return typeof i=="number"}function he(i){return Array.isArray(i)?he(i[0]):i instanceof Float32Array?"float32":i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray?"int32":we(i)?"float32":de(i)?"string":pe(i)?"bool":"float32"}function Pe(i){return!!(i&&i.constructor&&i.call&&i.apply)}function Ve(i,e){for(let t=e;t<i;++t)if(i%t===0)return t;return i}function ze(i){const e=i.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=i[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*i[r+1];return t}function et(i,e,t,r=!1){const s=new Array;if(e.length===1){const o=e[0]*(r?2:1);for(let l=0;l<o;l++)s[l]=t[i+l]}else{const o=e[0],l=e.slice(1),c=l.reduce((h,p)=>h*p)*(r?2:1);for(let h=0;h<o;h++)s[h]=et(i+h*c,l,t,r)}return s}function Tt(i,e,t=!1){if(i.length===0)return e[0];const r=i.reduce((s,o)=>s*o)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${i}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return et(0,i,e,t)}function Rt(i,e){const t=fn(i,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function fn(i,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(i);if(e==="int32")return new Int32Array(i);if(e==="bool")return new Uint8Array(i);throw new Error(`Unknown data type ${e}`)}function cn(i,e){const t=i.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return Tt(i,new Float32Array(t));if(e==="int32")return Tt(i,new Int32Array(t));if(e==="bool")return Tt(i,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Jn(i){i.forEach(e=>{C(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${i}].`)})}function yn(i,e,t){if(e===0)return 0;if(e===1)return i[0];let r=i[i.length-1];for(let s=0;s<i.length-1;++s)r+=t[s]*i[s];return r}function Wn(i,e,t){if(e===0)return[];if(e===1)return[i];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(i/t[s]),i-=r[s]*t[s];return r[r.length-1]=i,r}function gi(i){return i&&i.then&&typeof i.then=="function"}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ai="tfjsflags";class nt{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=dt,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Ye().getBool("IS_TEST")||Ye().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];Ye().getBool("IS_TEST")||Ye().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(gi(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);ai in e&&e[ai].split(",").forEach(t=>{const[r,s]=t.split(":");this.urlFlags[r]=$t(r,s)})}}function dt(i){const e={};return i.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(Ot(e,r[0],r[1]),r.join("="))),e}function Ot(i,e,t){i[decodeURIComponent(e)]=decodeURIComponent(t||"")}function $t(i,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${i}.`)}function Ye(){return mn}let mn=null;function Pn(i){mn=i}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let wn;function Dn(){if(wn==null){let i;if(typeof window<"u")i=window;else if(typeof yg<"u")i=yg;else if(typeof process<"u")i=process;else if(typeof self<"u")i=self;else throw new Error("Could not find a global object");wn=i}return wn}function gn(){const i=Dn();return i._tfGlobals==null&&(i._tfGlobals=new Map),i._tfGlobals}function ui(i,e){const t=gn();if(t.has(i))return t.get(i);{const r=e();return t.set(i,r),t.get(i)}}const Nt="Abs",De="Acos",Re="Acosh",We="Add",Oe="AddN",Qe="All",Ke="Any",vt="ArgMax",ct="ArgMin",Ct="Asin",Yt="Asinh",me="Atan",ee="Atanh",ae="Atan2",Ue="AvgPool",ht="AvgPoolGrad",ft="AvgPool3D",Ft="AvgPool3DGrad",hi="BatchMatMul",bi="BatchToSpaceND",ri="Bincount",Ai="BroadcastTo",lr="BroadcastArgs",_s="Cast",Fs="Ceil",Vs="ClipByValue",Dr="Complex",ti="ComplexAbs",hn="Concat",On="Conv2D",Oi="Conv2DBackpropFilter",Yn="Conv2DBackpropInput",Gi="Conv3D",nr="Conv3DBackpropFilterV2",cr="Conv3DBackpropInputV2",Xr="Cos",Fr="Cosh",$r="Cumprod",ws="Cumsum",vr="CropAndResize",As="DenseBincount",vs="DepthToSpace",Ge="DepthwiseConv2dNative",st="DepthwiseConv2dNativeBackpropFilter",wt="DepthwiseConv2dNativeBackpropInput",en="Diag",Xt="Dilation2D",En="Dilation2DBackpropInput",Fn="Dilation2DBackpropFilter",Ci="RealDiv",vi="Einsum",An="Elu",Ui="EluGrad",Hi="Erf",ir="Equal",us="Exp",Tr="ExpandDims",pr="Expm1",Pr="FFT",Rs="Fill",fa="FlipLeftRight",di="Floor",Cr="FloorDiv",zs="FusedBatchNorm",zr="GatherV2",ie="GatherNd",ce="Greater",Ce="GreaterEqual",_e="Identity",Xe="IFFT",At="Imag",It="IsFinite",Sn="IsInf",vn="IsNan",Lt="LeakyRelu",rn="Less",Bn="LessEqual",fi="LinSpace",Ii="Log",Vi="Log1p",br="LogicalAnd",ur="LogicalNot",er="LogicalOr",ys="LogSoftmax",Qr="LRN",gr="LRNGrad",Is="Max",Ys="Maximum",Ps="MaxPool",Ua="MaxPoolGrad",Va="MaxPool3D",Bs="MaxPool3DGrad",no="MaxPoolWithArgmax",Tl="Mean",Fo="Min",dl="Minimum",Ml="MirrorPad",pl="Mod",fc="Multinomial",fl="Multiply",_l="Neg",Rl="NotEqual",$l="NonMaxSuppressionV3",jl="NonMaxSuppressionV4",Js="NonMaxSuppressionV5",id="OnesLike",rd="OneHot",sd="Pack",oh="PadV2",Yl="Pow",ad="Prelu",od="Prod",Cf="RaggedGather",wf="RaggedTensorToTensor",cp="Range",up="Real",lh="Reciprocal",ch="Relu",ld="Reshape",Cu="ResizeNearestNeighbor",wu="ResizeNearestNeighborGrad",io="ResizeBilinear",za="ResizeBilinearGrad",Eu="Relu6",Bl="Reverse",Jl="Round",Za="Rsqrt",aa="ScatterNd",cd="SearchSorted",ud="Select",uh="Selu",mc="Slice",hh="Sin",dh="Sinh",ph="Sign",fh="Sigmoid",mh="Softplus",gh="Sqrt",hd="Sum",dd="SpaceToBatchND",pd="SplitV",fd="Softmax",md="SparseFillEmptyRows",hp="SparseReshape",Ah="SparseSegmentMean",Ef="SparseSegmentSum",kl="SparseToDense",hs="SquaredDifference",dp="Square",kn="StridedSlice",ro="StringNGrams",gd="StringSplit",pp="StringToHashBucketFast",vh="Sub",Ll="Tan",ql="Tanh",ml="Tile",Iu="TopK",yh="Transform",ma="Transpose",Ad="Unique",oa="Unpack",Io="UnsortedSegmentSum",Gc="ZerosLike",Uc="Step",Su="FromPixels",Si="RotateWithOffset",ec="_FusedMatMul",Tu="FusedConv2D",gc="FusedDepthwiseConv2D";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ao(...i){Ye().getBool("IS_TEST")||Ye().getBool("PROD")||console.warn(...i)}function Rg(...i){Ye().getBool("IS_TEST")||Ye().getBool("PROD")||console.log(...i)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ws=ui("kernelRegistry",()=>new Map),es=ui("gradRegistry",()=>new Map);function So(i,e){const t=Sf(i,e);return Ws.get(t)}function Mu(i){return es.get(i)}function If(i){const e=Ws.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,l]=s,[c]=o.split("_");c===i&&t.push(l)}return t}function so(i){const{kernelName:e,backendName:t}=i,r=Sf(e,t);Ws.has(r)&&Ao(`The kernel '${e}' for backend '${t}' is already registered`),Ws.set(r,i)}function Bg(i){const{kernelName:e}=i;es.has(e)&&Ye().getBool("DEBUG")&&Ao(`Overriding the gradient for '${e}'`),es.set(e,i)}function Sf(i,e){return`${e}_${i}`}var la=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof yg<"u"?yg:typeof self<"u"?self:{};function tt(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function r(){if(this instanceof r){var s=[null];s.push.apply(s,arguments);var o=Function.bind.apply(e,s);return new o}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),t}var bh=ss,Po=null;try{Po=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ss(i,e,t){this.low=i|0,this.high=e|0,this.unsigned=!!t}ss.prototype.__isLong__,Object.defineProperty(ss.prototype,"__isLong__",{value:!0});function ca(i){return(i&&i.__isLong__)===!0}ss.isLong=ca;var Ac={},vd={};function Qo(i,e){var t,r,s;return e?(i>>>=0,(s=0<=i&&i<256)&&(r=vd[i],r)?r:(t=ds(i,(i|0)<0?-1:0,!0),s&&(vd[i]=t),t)):(i|=0,(s=-128<=i&&i<128)&&(r=Ac[i],r)?r:(t=ds(i,i<0?-1:0,!1),s&&(Ac[i]=t),t))}ss.fromInt=Qo;function $a(i,e){if(isNaN(i))return e?tc:Ma;if(e){if(i<0)return tc;if(i>=Hs)return hr}else{if(i<=-xh)return fr;if(i+1>=xh)return Ti}return i<0?$a(-i,e).neg():ds(i%Nl|0,i/Nl|0,e)}ss.fromNumber=$a;function ds(i,e,t){return new ss(i,e,t)}ss.fromBits=ds;var gl=Math.pow;function Dl(i,e,t){if(i.length===0)throw Error("empty string");if(i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return Ma;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Dl(i.substring(1),e,t).neg();for(var s=$a(gl(t,8)),o=Ma,l=0;l<i.length;l+=8){var c=Math.min(8,i.length-l),h=parseInt(i.substring(l,l+c),t);if(c<8){var p=$a(gl(t,c));o=o.mul(p).add($a(h))}else o=o.mul(s),o=o.add($a(h))}return o.unsigned=e,o}ss.fromString=Dl;function ja(i,e){return typeof i=="number"?$a(i,e):typeof i=="string"?Dl(i,e):ds(i.low,i.high,typeof e=="boolean"?e:i.unsigned)}ss.fromValue=ja;var Vc=1<<16,vc=1<<24,Nl=Vc*Vc,Hs=Nl*Nl,xh=Hs/2,fp=Qo(vc),Ma=Qo(0);ss.ZERO=Ma;var tc=Qo(0,!0);ss.UZERO=tc;var To=Qo(1);ss.ONE=To;var Fl=Qo(1,!0);ss.UONE=Fl;var Ch=Qo(-1);ss.NEG_ONE=Ch;var Ti=ds(-1,2147483647,!1);ss.MAX_VALUE=Ti;var hr=ds(-1,-1,!0);ss.MAX_UNSIGNED_VALUE=hr;var fr=ds(0,-2147483648,!1);ss.MIN_VALUE=fr;var Un=ss.prototype;Un.toInt=function(){return this.unsigned?this.low>>>0:this.low},Un.toNumber=function(){return this.unsigned?(this.high>>>0)*Nl+(this.low>>>0):this.high*Nl+(this.low>>>0)},Un.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(fr)){var e=$a(i),t=this.div(e),r=t.mul(e).sub(this);return t.toString(i)+r.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var s=$a(gl(i,6),this.unsigned),o=this,l="";;){var c=o.div(s),h=o.sub(c.mul(s)).toInt()>>>0,p=h.toString(i);if(o=c,o.isZero())return p+l;for(;p.length<6;)p="0"+p;l=""+p+l}},Un.getHighBits=function(){return this.high},Un.getHighBitsUnsigned=function(){return this.high>>>0},Un.getLowBits=function(){return this.low},Un.getLowBitsUnsigned=function(){return this.low>>>0},Un.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fr)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,e=31;e>0&&!(i&1<<e);e--);return this.high!=0?e+33:e+1},Un.isZero=function(){return this.high===0&&this.low===0},Un.eqz=Un.isZero,Un.isNegative=function(){return!this.unsigned&&this.high<0},Un.isPositive=function(){return this.unsigned||this.high>=0},Un.isOdd=function(){return(this.low&1)===1},Un.isEven=function(){return(this.low&1)===0},Un.equals=function(i){return ca(i)||(i=ja(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low},Un.eq=Un.equals,Un.notEquals=function(i){return!this.eq(i)},Un.neq=Un.notEquals,Un.ne=Un.notEquals,Un.lessThan=function(i){return this.comp(i)<0},Un.lt=Un.lessThan,Un.lessThanOrEqual=function(i){return this.comp(i)<=0},Un.lte=Un.lessThanOrEqual,Un.le=Un.lessThanOrEqual,Un.greaterThan=function(i){return this.comp(i)>0},Un.gt=Un.greaterThan,Un.greaterThanOrEqual=function(i){return this.comp(i)>=0},Un.gte=Un.greaterThanOrEqual,Un.ge=Un.greaterThanOrEqual,Un.compare=function(i){if(ca(i)||(i=ja(i)),this.eq(i))return 0;var e=this.isNegative(),t=i.isNegative();return e&&!t?-1:!e&&t?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1},Un.comp=Un.compare,Un.negate=function(){return!this.unsigned&&this.eq(fr)?fr:this.not().add(To)},Un.neg=Un.negate,Un.add=function(i){ca(i)||(i=ja(i));var e=this.high>>>16,t=this.high&65535,r=this.low>>>16,s=this.low&65535,o=i.high>>>16,l=i.high&65535,c=i.low>>>16,h=i.low&65535,p=0,f=0,g=0,v=0;return v+=s+h,g+=v>>>16,v&=65535,g+=r+c,f+=g>>>16,g&=65535,f+=t+l,p+=f>>>16,f&=65535,p+=e+o,p&=65535,ds(g<<16|v,p<<16|f,this.unsigned)},Un.subtract=function(i){return ca(i)||(i=ja(i)),this.add(i.neg())},Un.sub=Un.subtract,Un.multiply=function(i){if(this.isZero())return Ma;if(ca(i)||(i=ja(i)),Po){var e=Po.mul(this.low,this.high,i.low,i.high);return ds(e,Po.get_high(),this.unsigned)}if(i.isZero())return Ma;if(this.eq(fr))return i.isOdd()?fr:Ma;if(i.eq(fr))return this.isOdd()?fr:Ma;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(fp)&&i.lt(fp))return $a(this.toNumber()*i.toNumber(),this.unsigned);var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,o=this.low&65535,l=i.high>>>16,c=i.high&65535,h=i.low>>>16,p=i.low&65535,f=0,g=0,v=0,w=0;return w+=o*p,v+=w>>>16,w&=65535,v+=s*p,g+=v>>>16,v&=65535,v+=o*h,g+=v>>>16,v&=65535,g+=r*p,f+=g>>>16,g&=65535,g+=s*h,f+=g>>>16,g&=65535,g+=o*c,f+=g>>>16,g&=65535,f+=t*p+r*h+s*c+o*l,f&=65535,ds(v<<16|w,f<<16|g,this.unsigned)},Un.mul=Un.multiply,Un.divide=function(i){if(ca(i)||(i=ja(i)),i.isZero())throw Error("division by zero");if(Po){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var e=(this.unsigned?Po.div_u:Po.div_s)(this.low,this.high,i.low,i.high);return ds(e,Po.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?tc:Ma;var t,r,s;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return tc;if(i.gt(this.shru(1)))return Fl;s=tc}else{if(this.eq(fr)){if(i.eq(To)||i.eq(Ch))return fr;if(i.eq(fr))return To;var o=this.shr(1);return t=o.div(i).shl(1),t.eq(Ma)?i.isNegative()?To:Ch:(r=this.sub(i.mul(t)),s=t.add(r.div(i)),s)}else if(i.eq(fr))return this.unsigned?tc:Ma;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();s=Ma}for(r=this;r.gte(i);){t=Math.max(1,Math.floor(r.toNumber()/i.toNumber()));for(var l=Math.ceil(Math.log(t)/Math.LN2),c=l<=48?1:gl(2,l-48),h=$a(t),p=h.mul(i);p.isNegative()||p.gt(r);)t-=c,h=$a(t,this.unsigned),p=h.mul(i);h.isZero()&&(h=To),s=s.add(h),r=r.sub(p)}return s},Un.div=Un.divide,Un.modulo=function(i){if(ca(i)||(i=ja(i)),Po){var e=(this.unsigned?Po.rem_u:Po.rem_s)(this.low,this.high,i.low,i.high);return ds(e,Po.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))},Un.mod=Un.modulo,Un.rem=Un.modulo,Un.not=function(){return ds(~this.low,~this.high,this.unsigned)},Un.and=function(i){return ca(i)||(i=ja(i)),ds(this.low&i.low,this.high&i.high,this.unsigned)},Un.or=function(i){return ca(i)||(i=ja(i)),ds(this.low|i.low,this.high|i.high,this.unsigned)},Un.xor=function(i){return ca(i)||(i=ja(i)),ds(this.low^i.low,this.high^i.high,this.unsigned)},Un.shiftLeft=function(i){return ca(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?ds(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):ds(0,this.low<<i-32,this.unsigned)},Un.shl=Un.shiftLeft,Un.shiftRight=function(i){return ca(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?ds(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):ds(this.high>>i-32,this.high>=0?0:-1,this.unsigned)},Un.shr=Un.shiftRight,Un.shiftRightUnsigned=function(i){if(ca(i)&&(i=i.toInt()),i&=63,i===0)return this;var e=this.high;if(i<32){var t=this.low;return ds(t>>>i|e<<32-i,e>>>i,this.unsigned)}else return i===32?ds(e,0,this.unsigned):ds(e>>>i-32,0,this.unsigned)},Un.shru=Un.shiftRightUnsigned,Un.shr_u=Un.shiftRightUnsigned,Un.toSigned=function(){return this.unsigned?ds(this.low,this.high,!1):this},Un.toUnsigned=function(){return this.unsigned?this:ds(this.low,this.high,!0)},Un.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()},Un.toBytesLE=function(){var i=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]},Un.toBytesBE=function(){var i=this.high,e=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},ss.fromBytes=function(i,e,t){return t?ss.fromBytesLE(i,e):ss.fromBytesBE(i,e)},ss.fromBytesLE=function(i,e){return new ss(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,e)},ss.fromBytesBE=function(i,e){return new ss(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],e)};const ts=T({__proto__:null,default:bh},[bh]);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _a=bh||ts;function Ri(i){return _a.fromString(i,!0,16)}const Oo=Ri("c3a5c85c97cb3127"),Er=Ri("b492b66fbe98f273"),Ra=Ri("9ae16a3b2f90404f");function zc(i){return i.xor(i.shru(47))}function vo(i,e,t){const r=i.slice(e,e+t);return _a.fromBytes(Array.from(r),!0,!0)}function Br(i,e){return vo(i,e,8)}function Ar(i,e){return vo(i,e,4)}function ks(i,e){return e===0?i:i.shru(e).or(i.shl(64-e))}function Zo(i,e,t=Ri("9ddfea08eb382d69")){let r=i.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function yo(i,e,t,r,s,o){s=s.add(i),o=ks(o.add(s).add(r),21);const l=s;return s=s.add(e),s=s.add(t),o=o.add(ks(s,44)),[s.add(r),o.add(l)]}function jr(i,e,t,r){return yo(Br(i,e),Br(i,e+8),Br(i,e+16),Br(i,e+24),t,r)}function Ks(i,e=i.length){if(e>=8){const t=Ra.add(e*2),r=Br(i,0).add(Ra),s=Br(i,e-8),o=ks(s,37).mul(t).add(r),l=ks(r,25).add(s).mul(t);return Zo(o,l,t)}if(e>=4){const t=Ra.add(e*2),r=Ar(i,0);return Zo(r.shl(3).add(e),Ar(i,e-4),t)}if(e>0){const t=i[0],r=i[e>>1],s=i[e-1],o=t+(r<<8),l=e+(s<<2);return zc(Ra.mul(o).xor(Oo.mul(l))).mul(Ra)}return Ra}function Wr(i,e=i.length){const t=Ra.add(e*2),r=Br(i,0).mul(Er),s=Br(i,8),o=Br(i,e-8).mul(t),l=Br(i,e-16).mul(Ra);return Zo(ks(r.add(s),43).add(ks(o,30)).add(l),r.add(ks(s.add(Ra),18)).add(o),t)}function ps(i,e=i.length){const t=Ra.add(e*2),r=Br(i,0).mul(Ra),s=Br(i,8),o=Br(i,e-8).mul(t),l=Br(i,e-16).mul(Ra),c=ks(r.add(s),43).add(ks(o,30)).add(l),h=Zo(c,r.add(ks(s.add(Ra),18)).add(o),t),p=Br(i,16).mul(t),f=Br(i,24),g=c.add(Br(i,e-32)).mul(t),v=h.add(Br(i,e-24)).mul(t);return Zo(ks(p.add(f),43).add(ks(g,30)).add(v),p.add(ks(f.add(r),18)).add(g),t)}function xa(i,e=i.length){const t=_a.fromNumber(81,!0);if(e<=32)return e<=16?Ks(i,e):Wr(i,e);if(e<=64)return ps(i,e);let r=t,s=t.mul(Er).add(113),o=zc(s.mul(Ra).add(113)).mul(Ra),l=[_a.UZERO,_a.UZERO],c=[_a.UZERO,_a.UZERO];r=r.mul(Ra).add(Br(i,0));let h=0;const p=(e-1>>6)*64,f=p+(e-1&63)-63;do r=ks(r.add(s).add(l[0]).add(Br(i,h+8)),37).mul(Er),s=ks(s.add(l[1]).add(Br(i,h+48)),42).mul(Er),r=r.xor(c[1]),s=s.add(l[0]).add(Br(i,h+40)),o=ks(o.add(c[0]),33).mul(Er),l=jr(i,h,l[1].mul(Er),r.add(c[0])),c=jr(i,h+32,o.add(c[1]),s.add(Br(i,h+16))),[o,r]=[r,o],h+=64;while(h!==p);const g=Er.add(o.and(255).shl(1));return h=f,c[0]=c[0].add(e-1&63),l[0]=l[0].add(c[0]),c[0]=c[0].add(l[0]),r=ks(r.add(s).add(l[0]).add(Br(i,h+8)),37).mul(g),s=ks(s.add(l[1]).add(Br(i,h+48)),42).mul(g),r=r.xor(c[1].mul(9)),s=s.add(l[0].mul(9).add(Br(i,h+40))),o=ks(o.add(c[0]),33).mul(g),l=jr(i,h,l[1].mul(g),r.add(c[0])),c=jr(i,h+32,o.add(c[1]),s.add(Br(i,h+16))),[o,r]=[r,o],Zo(Zo(l[0],c[0],g).add(zc(s).mul(Oo)).add(o),Zo(l[1],c[1],g).add(r),g)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ya(i,e){return e==="string"?Go(i):nc([i],e)}function Wc(i,e){return i instanceof Float32Array&&e==="float32"||i instanceof Int32Array&&e==="int32"||i instanceof Uint8Array&&e==="bool"}function nc(i,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(i)&&(i=M(i)),Ye().getBool("DEBUG")&&q(i,e),Wc(i,e))return i;if(e==null||e==="float32"||e==="complex64")return new Float32Array(i);if(e==="int32")return new Int32Array(i);if(e==="bool"){const t=new Uint8Array(i.length);for(let r=0;r<t.length;++r)Math.round(i[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ao(){return Ye().platform.now()}function Go(i,e="utf-8"){return e=e||"utf-8",Ye().platform.encode(i,e)}function Pl(i,e="utf-8"){return e=e||"utf-8",Ye().platform.decode(i,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Tf{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Mf)}profileKernel(e,t,r){let s;const o=()=>{s=r()};let l;const c=ao();if(this.backendTimer.timerAvailable())l=this.backendTimer.time(o);else{o();for(const h of s)h.dataSync();l=Promise.resolve({kernelMs:ao()-c})}if(Ye().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let h=0;h<s.length;h++){const p=s[h];p.data().then(f=>{kg(f,p.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:l.then(h=>h.kernelMs),extraInfo:l.then(h=>h.getExtraProfileInfo!=null?h.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:o,extraInfo:l}=e;r.forEach(c=>{Promise.all([c.data(),s,l]).then(h=>{this.logger.logKernelProfile(t,c,h[0],h[1],o,h[2])})})}}function kg(i,e,t){if(e!=="float32")return!1;for(let r=0;r<i.length;r++){const s=i[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class Mf{logKernelProfile(e,t,r,s,o,l){const c=typeof s=="number"?_(`${s}ms`,9):s.error,h=_(e,25),p=t.rank,f=t.size,g=_(t.shape.toString(),14);let v="";for(const w in o){const R=o[w];if(R!=null){const P=R.shape||t.shape,z=P.length;v+=`${w}: ${z}D ${z>0?P:""} `}}console.log(`%c${h}	%c${c}	%c${p}D ${g}	%c${f}	%c${v}	%c${l}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function as(i,e,t){const r={},s={};for(let h=0;h<e.length;h++)r[e[h].id]=!0;for(let h=0;h<i.length;h++){const p=i[h],f=p.inputs;for(const g in f){const v=f[g];let w=!1;for(let R=0;R<e.length;R++)if(r[v.id]){p.outputs.forEach(P=>r[P.id]=!0),w=!0,s[p.id]=!0;break}if(w)break}}const o={};o[t.id]=!0;const l={};for(let h=i.length-1;h>=0;h--){const p=i[h],f=p.inputs;for(let g=0;g<p.outputs.length;g++)if(o[p.outputs[g].id]){for(const v in f)o[f[v].id]=!0,l[p.id]=!0;break}}const c=[];for(let h=0;h<i.length;h++){const p=i[h];if(s[p.id]&&l[p.id]){const f={};for(const v in p.inputs){const w=p.inputs[v];r[w.id]&&(f[v]=w)}const g=Object.assign({},p);g.inputs=f,g.outputs=p.outputs,c.push(g)}}return c}function Al(i,e,t,r){for(let s=e.length-1;s>=0;s--){const o=e[s],l=[];if(o.outputs.forEach(h=>{const p=i[h.id];p!=null?l.push(p):l.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const c=o.gradient(l);for(const h in o.inputs){if(!(h in c))throw new Error(`Cannot backprop through input ${h}. Available gradients found: ${Object.keys(c)}.`);const p=t(()=>c[h]());if(p.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${h} must have 'float32' dtype, but has '${p.dtype}'`);const f=o.inputs[h];if(!S(p.shape,f.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${h}' has shape '${p.shape}', which does not match the shape of the input '${f.shape}'`);if(i[f.id]==null)i[f.id]=p;else{const g=i[f.id];i[f.id]=r(g,p),g.dispose()}}}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ga=20,bo=3,$o=7;function Hc(i,e,t,r){const s=ze(e),o=yd(i,e,t,s),l=e.length,c=xd(i,e,t,s,o),h=["Tensor"];return r&&(h.push(`  dtype: ${t}`),h.push(`  rank: ${l}`),h.push(`  shape: [${e}]`),h.push("  values:")),h.push(c.map(p=>"    "+p).join(`
`)),h.join(`
`)}function yd(i,e,t,r){const s=b(e),o=r[r.length-1],l=new Array(o).fill(0),c=e.length,h=t==="complex64"?wh(i):i;if(c>1)for(let p=0;p<s/o;p++){const f=p*o;for(let g=0;g<o;g++)l[g]=Math.max(l[g],bd(h[f+g],0,t).length)}return l}function bd(i,e,t){let r;return Array.isArray(i)?r=`${parseFloat(i[0].toFixed($o))} + ${parseFloat(i[1].toFixed($o))}j`:de(i)?r=`'${i}'`:t==="bool"?r=_f(i):r=parseFloat(i.toFixed($o)).toString(),_(r,e)}function _f(i){return i===0?"false":"true"}function xd(i,e,t,r,s,o=!0){const l=t==="complex64"?2:1,c=e[0],h=e.length;if(h===0){if(t==="complex64"){const P=wh(i);return[bd(P[0],0,t)]}return t==="bool"?[_f(i[0])]:[i[0].toString()]}if(h===1){if(c>ga){const P=bo*l;let z=Array.from(i.slice(0,P)),G=Array.from(i.slice((c-bo)*l,c*l));return t==="complex64"&&(z=wh(z),G=wh(G)),["["+z.map((X,fe)=>bd(X,s[fe],t)).join(", ")+", ..., "+G.map((X,fe)=>bd(X,s[c-bo+fe],t)).join(", ")+"]"]}return["["+(t==="complex64"?wh(i):Array.from(i)).map((P,z)=>bd(P,s[z],t)).join(", ")+"]"]}const p=e.slice(1),f=r.slice(1),g=r[0]*l,v=[];if(c>ga){for(let P=0;P<bo;P++){const z=P*g,G=z+g;v.push(...xd(i.slice(z,G),p,t,f,s,!1))}v.push("...");for(let P=c-bo;P<c;P++){const z=P*g,G=z+g;v.push(...xd(i.slice(z,G),p,t,f,s,P===c-1))}}else for(let P=0;P<c;P++){const z=P*g,G=z+g;v.push(...xd(i.slice(z,G),p,t,f,s,P===c-1))}const w=h===2?",":"";v[0]="["+v[0]+w;for(let P=1;P<v.length-1;P++)v[P]=" "+v[P]+w;let R=`,
`;for(let P=2;P<h;P++)R+=`
`;return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":R),v}function wh(i){const e=[];for(let t=0;t<i.length;t+=2)e.push([i[t],i[t+1]]);return e}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Ss{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=b(e),r!=null){const s=r.length;C(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||U(t,this.size),this.strides=ze(e)}set(e,...t){t.length===0&&(t=[0]),C(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return ic().makeTensor(this.values,this.shape,this.dtype)}}let ic=null,Ba=null;function _u(i){ic=i}function Wa(i){Ba=i}class ua{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=b(e),this.strides=ze(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ba.buffer(this.shape,this.dtype,e)}bufferSync(){return Ba.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Tt(this.shape,e,this.dtype==="complex64")}arraySync(){return Tt(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=ic().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>Pl(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ic().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=ic().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Pl(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await ic().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(ic().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ba.print(this,e)}clone(){return this.throwIfDisposed(),Ba.clone(this)}toString(e=!1){const t=this.dataSync();return Hc(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ba.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),ic().makeVariable(this,e,t,r)}}Object.defineProperty(ua,Symbol.hasInstance,{value:i=>!!i&&i.data!=null&&i.dataSync!=null&&i.throwIfDisposed!=null});function Vt(){return ui("Tensor",()=>ua)}Vt();class Rf extends ua{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!S(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ic().disposeTensor(this),this.dataId=e.dataId,ic().incRef(this,null)}dispose(){ic().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Rf,Symbol.hasInstance,{value:i=>i instanceof ua&&i.assign!=null&&i.assign instanceof Function});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var JA;(function(i){i.R0="R0",i.R1="R1",i.R2="R2",i.R3="R3",i.R4="R4",i.R5="R5",i.R6="R6"})(JA||(JA={}));var Lg;(function(i){i.float32="float32",i.int32="int32",i.bool="int32",i.complex64="complex64"})(Lg||(Lg={}));var Dg;(function(i){i.float32="float32",i.int32="int32",i.bool="bool",i.complex64="complex64"})(Dg||(Dg={}));var mp;(function(i){i.float32="float32",i.int32="float32",i.bool="float32",i.complex64="complex64"})(mp||(mp={}));var Ng;(function(i){i.float32="complex64",i.int32="complex64",i.bool="complex64",i.complex64="complex64"})(Ng||(Ng={}));const Fg={float32:mp,int32:Lg,bool:Dg,complex64:Ng};function Uo(i,e){if(i==="string"||e==="string"){if(i==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${i} with ${e}`)}return Fg[i][e]}function Fi(i){return Uo(i,"int32")}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ca(i,e){if(i.dtype===e.dtype)return[i,e];const t=Uo(i.dtype,e.dtype);return[i.cast(t),e.cast(t)]}function qA(i){const e=[];return vl(i,e,new Set),e}function vl(i,e,t){if(i==null)return;if(i instanceof ua){e.push(i);return}if(!Pg(i))return;const r=i;for(const s in r){const o=r[s];t.has(o)||(t.add(o),vl(o,e,t))}}function Pg(i){return Array.isArray(i)||typeof i=="object"}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ru(i){return i.kernelName!=null}class jo{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class yc{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new jo}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Ao(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Tf(this.backendInstance),!0}setupRegisteredKernels(){If(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){If(e).forEach(t=>{t.disposeFunc!=null&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof Te)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,o=r.then(l=>s<this.pendingBackendInitId?!1:(this.registry[e]=l,this.pendingBackendInit=null,!0)).catch(l=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Ao(`Initialization of backend ${e} failed`),Ao(l.stack||l.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Ao(`Initialization of backend ${e} failed`),Ao(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:o}=this.initializeBackend(r);if(o||s)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,o=this.readSync(t),l=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,o,r.shape,r.dtype,l),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return yc.nextTensorId++}nextVariableId(){return yc.nextVariableId++}clone(e){const t=Et.runKernel(_e,{x:e}),r={x:e},s=l=>({x:()=>{const c="float32",h={x:l},p={dtype:c};return Et.runKernel(_s,h,p)}}),o=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,o,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,So(e,this.backendName)==null)throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let o=0;r.forEach(h=>{o+=h.dtype==="complex64"?3:1});const l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],c=s-t-o-l;if(c>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${c} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),o=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let c;this.backendName==null&&this.backend;let h;const p=Ru(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Ru(e)){const{kernelName:R,inputs:P,attrs:z}=e;this.backendName==null&&this.backend;const G=So(R,this.backendName);C(G!=null,()=>`Cannot find registered kernel '${R}' for backend '${this.backendName}'`),c=()=>{const X=this.backend.numDataIds();h=G.kernelFunc({inputs:P,attrs:z,backend:this.backend});const fe=Array.isArray(h)?h:[h];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(R,X,fe);const ge=fe.map(be=>be.rank!=null?be:this.makeTensorFromTensorInfo(be));if(s){const be=this.getTensorsForGradient(R,P,ge);r=this.saveTensorsForBackwardMode(be)}return ge}}else{const{forwardFunc:R}=e,P=z=>{s&&(r=z.map(G=>this.keep(this.clone(G))))};c=()=>{const z=this.backend.numDataIds();h=this.tidy(()=>R(this.backend,P));const G=Array.isArray(h)?h:[h];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,z,G),G}}const{inputs:f,attrs:g}=e,v=Ru(e)?null:e.backwardsFunc;let w;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=c():(w=this.profiler.profileKernel(p,f,()=>c()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(w),t=w.outputs)}),s&&this.addTapeNode(p,f,t,v,r,g),this.state.profiling&&this.state.activeProfile.kernels.push({name:p,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(f).map(R=>f[R]!=null?f[R].shape:null),outputShapes:t.map(R=>R.shape),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(h)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(t=>this.keep(this.clone(t)))}getTensorsForGradient(e,t,r){const s=Mu(e);if(s!=null){const o=s.inputsToSave||[],l=s.outputsToSave||[];let c;s.saveAllInputs?(C(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),c=Object.keys(t).map(p=>t[p])):c=o.map(p=>t[p]);const h=r.filter((p,f)=>l[f]);return c.concat(h)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let o=e;r==="string"&&de(e[0])&&(o=e.map(h=>Go(h)));const l=s.write(o,t,r),c=new ua(t,r,l,this.nextTensorId());if(this.trackTensor(c,s),r==="string"){const h=this.state.tensorInfo.get(l),p=Ie(o);this.state.numBytes+=p-h.bytes,h.bytes=p}return c}makeTensorFromDataId(e,t,r,s){r=r||"float32";const o={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(o,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:o}=e,l=new ua(s,o,r,this.nextTensorId());return this.trackTensor(l,t),l}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const o=new Rf(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Se(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Rf||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*Se(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,o,l){const c={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},h=Mu(e);h!=null&&(s=h.gradFunc),s!=null&&(c.gradient=p=>(p=p.map((f,g)=>{if(f==null){const v=r[g],w=fn(v.size,v.dtype);return this.makeTensor(w,v.shape,v.dtype)}return f}),s(p.length>1?p:p[0],o,l))),this.state.activeTape.push(c)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=qA(e),r=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const l=this.state.activeScope.track[o];!l.kept&&!r.has(l.id)&&l.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===s.id&&this.track(o)})}gradients(e,t,r,s=!1){if(C(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));C(o instanceof ua,()=>"The result y returned by f() must be a tensor.");const l=as(this.state.activeTape,t,o);if(!s&&l.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const c={};c[o.id]=r??oo(o.shape),Al(c,l,p=>this.tidy(p),Cd);const h=t.map(p=>c[p.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(p=>{for(const f of p.saved)f.dispose()}),this.state.activeTape=null),{value:o,grads:h}})}customGrad(e){return C(Pe(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{C(t.every(c=>c instanceof ua),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((c,h)=>{s[h]=c});const o=(c,h)=>(r=e(...t,h),C(r.value instanceof ua,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),C(Pe(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),l=(c,h)=>{const p=r.gradFunc(c,h),f=Array.isArray(p)?p:[p];C(f.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),C(f.every(v=>v instanceof ua),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const g={};return f.forEach((v,w)=>{g[w]=()=>v}),g};return this.runKernelFunc({forwardFunc:o,backwardsFunc:l,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ao(),r=await this.backend.time(e);return r.wallMs=ao()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new jo;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}yc.nextTensorId=0,yc.nextVariableId=0;function oo(i){const e=Rt(b(i),"float32");return Et.makeTensor(e,i,"float32")}function Or(){const i=Dn();if(i._tfengine==null){const e=new nt(i);i._tfengine=new yc(e)}return Pn(i._tfengine.ENV),_u(()=>i._tfengine),i._tfengine}const Et=Or();function Cd(i,e){const t={a:i,b:e};return Et.runKernel(We,t)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Og(){return typeof navigator<"u"&&navigator!=null}function Kc(i){if(i||Og()){if(i||(i=navigator),i.product==="ReactNative")return!0;const e=i.userAgent||i.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=i;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Xc(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ka=Ye();ka.registerFlag("DEBUG",()=>!1,i=>{i&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ka.registerFlag("IS_BROWSER",()=>Xc()),ka.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),ka.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),ka.registerFlag("PROD",()=>!1),ka.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ka.getBool("DEBUG")),ka.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),ka.registerFlag("IS_TEST",()=>!1),ka.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0),ka.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),ka.registerFlag("ENGINE_COMPILE_ONLY",()=>!1),ka.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),ka.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Eh(i,e){let t=i;if(Ae(i))return e==="string"?[]:[i.length];if(!Array.isArray(i))return[];const r=[];for(;Array.isArray(t)||Ae(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(i)&&Ye().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Bf(i,r,[]),r}function Bf(i,e,t){if(t=t||[],!Array.isArray(i)&&!Ae(i)){C(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}C(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${i.length} elements`),C(i.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${i.length} elements`);const r=e.slice(1);for(let s=0;s<i.length;++s)Bf(i[s],r,t.concat(s))}function kf(i,e,t,r){if(i!=="string_or_numeric"){if(i==null)throw new Error("Expected dtype cannot be null.");if(i!=="numeric"&&i!==e||i==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${i} tensor, but got ${e} tensor`)}}function ut(i,e,t,r="numeric"){if(i instanceof ua)return kf(r,i.dtype,e,t),i;let s=he(i);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),kf(r,s,e,t),i==null||!Ae(i)&&!Array.isArray(i)&&typeof i!="number"&&typeof i!="boolean"&&typeof i!="string"){const c=i==null?"null":i.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const o=Eh(i,s);!Ae(i)&&!Array.isArray(i)&&(i=[i]);const l=s!=="string"?nc(i,s):M(i,[],!0);return Et.makeTensor(l,o,s)}function gp(i,e,t,r="numeric"){if(!Array.isArray(i))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return i.map((s,o)=>ut(s,`${e}[${o}]`,t,r))}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Lf="__op";function Bt(i){const e=Object.keys(i);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=i[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Lf;const s=(...o)=>{Et.startScope(t);try{const l=r(...o);return gi(l)&&console.error("Cannot return a Promise inside of tidy."),Et.endScope(l),l}catch(l){throw Et.endScope(null),l}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Df(i,e){const t=ut(i,"real","complex"),r=ut(e,"imag","complex");F(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return Et.runKernel(Dr,s)}const Qc=Bt({complex_:Df});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ih(i,e,t,r){if(r==null&&(r=he(i)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ae(i)&&!Array.isArray(i)&&typeof i!="number"&&typeof i!="boolean"&&typeof i!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Jn(e);const s=b(e),o=b(t);C(s===o,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${o}`);for(let l=0;l<t.length;++l){const c=t[l],h=l===t.length-1?c!==b(e.slice(l)):!0;C(t[l]===e[l]||!h,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Ae(i)&&!Array.isArray(i)&&(i=[i]),e=e||t,i=r!=="string"?nc(i,r):M(i,[],!0),Et.makeTensor(i,e,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vo(i,e,t){const r=Eh(i,t);return Ih(i,e,r,t)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lo=4;async function e1(i,e){const t=[],r=[],s=Array.isArray(i)?i.map(l=>l.name):Object.keys(i);for(let l=0;l<s.length;++l){const c=s[l],h=Array.isArray(i)?i[l].tensor:i[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${c}': ${h.dtype}`);const p={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){const f=new Promise(async g=>{const v=await h.bytes(),w=v.reduce((z,G)=>z+G.length,0)+lo*v.length,R=new Uint8Array(w);let P=0;for(let z=0;z<v.length;z++){const G=v[z],X=new Uint8Array(new Uint32Array([G.length]).buffer);R.set(X,P),P+=lo,R.set(G,P),P+=G.length}g(R)});r.push(f)}else r.push(h.data());e!=null&&(p.group=e),t.push(p)}const o=await Promise.all(r);return{data:Nf(o),specs:t}}function Nf(i){if(i===null)throw new Error(`Invalid input value: ${JSON.stringify(i)}`);let e=0;const t=[];i.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(o=>{r.set(new Uint8Array(o.buffer),s),s+=o.byteLength}),r.buffer}const bc=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Sh(i){return bc?Buffer.byteLength(i):new Blob([i]).size}function zo(i){if(bc)return Buffer.from(i).toString("base64");const e=new Uint8Array(i);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function xb(i){if(bc){const r=Buffer.from(i,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(i),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function t1(i){if(i.length===1)return i[0];let e=0;i.forEach(s=>{e+=s.byteLength});const t=new Uint8Array(e);let r=0;return i.forEach(s=>{t.set(new Uint8Array(s),r),r+=s.byteLength}),t.buffer}function Gg(i){if(i.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:i.modelTopology==null?0:Sh(JSON.stringify(i.modelTopology)),weightSpecsBytes:i.weightSpecs==null?0:Sh(JSON.stringify(i.weightSpecs)),weightDataBytes:i.weightData==null?0:i.weightData.byteLength}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Mo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Mo.instance==null&&(Mo.instance=new Mo),Mo.instance}static registerSaveRouter(e){Mo.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Mo.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Mo.getHandlers(e,"save")}static getLoadHandlers(e,t){return Mo.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?Mo.getInstance().loadRouters:Mo.getInstance().saveRouters).forEach(o=>{const l=o(e,r);l!==null&&s.push(l)}),s}}const Cb=i=>Mo.getSaveHandlers(i);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ol="tensorflowjs",wd=1,qs="models_store",yl="model_info_store";function Th(){if(!Ye().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const i=typeof window>"u"?self:window,e=i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB||i.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Ff(i){const e=i.result;e.createObjectStore(qs,{keyPath:"modelPath"}),e.createObjectStore(yl,{keyPath:"modelPath"})}class rc{constructor(e){if(this.indexedDB=Th(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const o=this.indexedDB.open(Ol,wd);o.onupgradeneeded=()=>Ff(o),o.onsuccess=()=>{const l=o.result;if(t==null){const c=l.transaction(qs,"readonly"),h=c.objectStore(qs).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return l.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(h.result.modelArtifacts)},h.onerror=p=>(l.close(),s(h.error)),c.oncomplete=()=>l.close()}else{const c=Gg(t),h=l.transaction(yl,"readwrite");let p=h.objectStore(yl);const f=p.put({modelPath:this.modelPath,modelArtifactsInfo:c});let g;f.onsuccess=()=>{g=l.transaction(qs,"readwrite");const v=g.objectStore(qs).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:c});v.onsuccess=()=>r({modelArtifactsInfo:c}),v.onerror=w=>{p=h.objectStore(yl);const R=p.delete(this.modelPath);R.onsuccess=()=>(l.close(),s(v.error)),R.onerror=P=>(l.close(),s(v.error))}},f.onerror=v=>(l.close(),s(f.error)),h.oncomplete=()=>{g==null?l.close():g.oncomplete=()=>l.close()}}},o.onerror=l=>s(o.error)})}}rc.URL_SCHEME="indexeddb://";const Ug=i=>Ye().getBool("IS_BROWSER")&&!Array.isArray(i)&&i.startsWith(rc.URL_SCHEME)?Vg(i.slice(rc.URL_SCHEME.length)):null;Mo.registerSaveRouter(Ug),Mo.registerLoadRouter(Ug);function Vg(i){return new rc(i)}function wb(i){return i.startsWith(rc.URL_SCHEME)?i.slice(rc.URL_SCHEME.length):i}class Eb{constructor(){this.indexedDB=Th()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(Ol,wd);r.onupgradeneeded=()=>Ff(r),r.onsuccess=()=>{const s=r.result,o=s.transaction(yl,"readonly"),l=o.objectStore(yl).getAll();l.onsuccess=()=>{const c={};for(const h of l.result)c[h.modelPath]=h.modelArtifactsInfo;e(c)},l.onerror=c=>(s.close(),t(l.error)),o.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=wb(e),new Promise((t,r)=>{const s=this.indexedDB.open(Ol,wd);s.onupgradeneeded=()=>Ff(s),s.onsuccess=()=>{const o=s.result,l=o.transaction(yl,"readwrite"),c=l.objectStore(yl),h=c.get(e);let p;h.onsuccess=()=>{if(h.result==null)return o.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const f=c.delete(e),g=()=>{p=o.transaction(qs,"readwrite");const v=p.objectStore(qs).delete(e);v.onsuccess=()=>t(h.result.modelArtifactsInfo),v.onerror=w=>r(h.error)};f.onsuccess=g,f.onerror=v=>(g(),o.close(),r(h.error))}},h.onerror=f=>(o.close(),r(h.error)),l.oncomplete=()=>{p==null?o.close():p.oncomplete=()=>o.close()}},s.onerror=o=>r(s.error)})}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _o="/",sc="tensorflowjs_models",Ap="info",Pf="model_topology",zg="weight_specs",Ib="weight_data",Ed="model_metadata";function n1(i){return{info:[sc,i,Ap].join(_o),topology:[sc,i,Pf].join(_o),weightSpecs:[sc,i,zg].join(_o),weightData:[sc,i,Ib].join(_o),modelMetadata:[sc,i,Ed].join(_o)}}function i1(i){for(const e of Object.values(i))window.localStorage.removeItem(e)}function Sb(i){const e=i.split(_o);if(e.length<3)throw new Error(`Invalid key format: ${i}`);return e.slice(1,e.length-1).join(_o)}function Tb(i){return i.startsWith(Mh.URL_SCHEME)?i.slice(Mh.URL_SCHEME.length):i}class Mh{constructor(e){if(!Ye().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=n1(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=Gg(e);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,zo(e.weightData));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:s}}catch{throw i1(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const c=JSON.parse(o);t.format=c.format,t.generatedBy=c.generatedBy,t.convertedBy=c.convertedBy,c.signature!=null&&(t.signature=c.signature),c.userDefinedMetadata!=null&&(t.userDefinedMetadata=c.userDefinedMetadata),c.modelInitializer!=null&&(t.modelInitializer=c.modelInitializer),c.trainingConfig!=null&&(t.trainingConfig=c.trainingConfig)}const l=this.LS.getItem(this.keys.weightData);if(l==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=xb(l),t}}Mh.URL_SCHEME="localstorage://";const r1=i=>Ye().getBool("IS_BROWSER")&&!Array.isArray(i)&&i.startsWith(Mh.URL_SCHEME)?Mb(i.slice(Mh.URL_SCHEME.length)):null;Mo.registerSaveRouter(r1),Mo.registerLoadRouter(r1);function Mb(i){return new Mh(i)}class _b{constructor(){C(Ye().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),C(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=sc+_o,r=_o+Ap;for(let s=0;s<this.LS.length;++s){const o=this.LS.key(s);if(o.startsWith(t)&&o.endsWith(r)){const l=Sb(o);e[l]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=Tb(e);const t=n1(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return i1(t),r}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const s1="://";class xc{constructor(){this.managers={}}static getInstance(){return xc.instance==null&&(xc.instance=new xc),xc.instance}static registerManager(e,t){C(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(s1)&&(e=e.slice(0,e.indexOf(s1))),C(e.length>0,()=>"scheme must not be an empty string.");const r=xc.getInstance();C(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=xc.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(xc.getInstance().managers)}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Rb{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(!window||!Ye().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}}if(Ye().get("IS_BROWSER")){Ye().setPlatform("browser",new Rb);try{xc.registerManager(Mh.URL_SCHEME,new _b)}catch{}try{xc.registerManager(rc.URL_SCHEME,new Eb)}catch{}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bb={importFetch:()=>yZ()};let Wg;class kb{constructor(){this.util=CZ,this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Ye().global.fetch!=null?Ye().global.fetch(e,t):(Wg==null&&(Wg=Bb.importFetch()),Wg(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}}Ye().get("IS_NODE")&&!Ye().get("IS_BROWSER")&&Ye().setPlatform("node",new kb);/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dr(i,e="float32",t){return e=e||"float32",Jn(i),new Ss(i,e,t)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lb(i,e){const t=ut(i,"x","cast");if(!oe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return Et.runKernel(_s,r,s)}const wi=Bt({cast_:Lb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Db(i){const e={x:ut(i,"x","clone","string_or_numeric")};return Et.runKernel(_e,e)}const _h=Bt({clone_:Db});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nb(i,e=!1){console.log(i.toString(e))}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Or(),Wa({buffer:dr,cast:wi,clone:_h,print:Nb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fb(i,e,t=!1,r=!1){let s=ut(i,"a","matMul"),o=ut(e,"b","matMul");[s,o]=Ca(s,o);const l={a:s,b:o},c={transposeA:t,transposeB:r};return Et.runKernel(hi,l,c)}const bs=Bt({matMul_:Fb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pb(i,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:ut(i,"indices","oneHot","int32")},l={dtype:s,depth:e,onValue:t,offValue:r};return Et.runKernel(rd,o,l)}const a1=Bt({oneHot_:Pb});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ea(){return Et}function Of(){return Et.memory()}function Pt(i,e){return Et.tidy(i,e)}function Hr(i){qA(i).forEach(e=>e.dispose())}function bl(i){return Et.keep(i)}function o1(i,e,t=1){return Et.registerBackend(i,e,t)}function Bu(){return Et.backend}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ob(i){const e={input:ut(i,"input","imag")};return Et.runKernel(At,e)}const Hg=Bt({imag_:Ob});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gb(i){const e={x:ut(i,"x","neg")};return Et.runKernel(_l,e)}const La=Bt({neg_:Gb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ub(i){const e={input:ut(i,"input","real")};return Et.runKernel(up,e)}const Gf=Bt({real_:Ub});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vb(i,e,t){const r=ut(i,"x","transpose");if(e==null&&(e=r.shape.map((l,c)=>c).reverse()),C(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(l=>{C(l>=0&&l<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return r.dtype==="complex64"?Pt(()=>{let l=Gf(r),c=Hg(r);return l=Et.runKernel(ma,{x:l},o),c=Et.runKernel(ma,{x:c},o),t&&(c=La(c)),Qc(l,c)}):Et.runKernel(ma,s,o)}const Yr=Bt({transpose_:Vb});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ku(i,e){const t=i.length,r=[];for(let s=0;s<t;s++){const o=t-1-s,l=i[o]||1;(e[e.length-1-s]||1)>1&&l===1&&r.unshift(o)}return r}function Ha(i,e){const t=[];for(let r=0;r<e.length;r++){const s=i[i.length-r-1],o=e.length-r-1,l=e[o];(s==null||s===1&&l>1)&&t.unshift(o)}return t}function Ir(i,e){const t=[],r=Math.max(i.length,e.length);for(let s=0;s<r;s++){let o=i[i.length-s-1];o==null&&(o=1);let l=e[e.length-s-1];if(l==null&&(l=1),o===1)t.unshift(l);else if(l===1)t.unshift(o);else if(o!==l){const c=`Operands could not be broadcast together with shapes ${i} and ${e}.`;throw Error(c)}else t.unshift(o)}return t}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zb(i,e,t){if(L(i),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Eh(i,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ih(i,e,r,t)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let Rh;function Wb(i,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(i==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,r=!1,s=!1,o=!1,l=!1,c=!1;if(i.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&i instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)o=!0;else if(i.getContext!=null)l=!0;else if(typeof ImageBitmap<"u"&&i instanceof ImageBitmap)c=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${i.constructor.name}`);if(So(Su,Et.backendName)!=null){const v={pixels:i},w={numChannels:e};return Et.runKernel(Su,v,w)}const[h,p]=s?[i.videoWidth,i.videoHeight]:[i.width,i.height];let f;if(l)f=i.getContext("2d").getImageData(0,0,h,p).data;else if(r||t)f=i.data;else if(o||s||c){if(Rh==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Rh=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Rh=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Rh.canvas.width=h,Rh.canvas.height=p,Rh.drawImage(i,0,0,h,p),f=Rh.getImageData(0,0,h,p).data}let g;if(e===4)g=new Int32Array(f);else{const v=h*p;g=new Int32Array(v*e);for(let w=0;w<v;w++)for(let R=0;R<e;++R)g[w*e+R]=f[w*4+R]}return zb(g,[p,h,e],"int32")}const Hb=Bt({fromPixels_:Wb});function Kg(i,e){const t=i.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(b(i.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${i.shape}.`);const s=e.shape,o=s[s.length-1];let l=1;for(let g=0;g<s.length-1;++g)l*=s[g];const c=i.shape,h=s.slice();h.pop();let p=1;for(let g=o;g<t;++g)p*=c[g],h.push(c[g]);const f=[...ze(i.shape).map(g=>g/p),1].slice(0,o);return[h,l,p,f]}function l1(i,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${i}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(o+` update.rank < ${s}. `);if(i.length<r+(t.rank-s))throw new Error(o+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+i.length-r)throw new Error(o+` update.rank != ${s+i.length-r}`);for(let l=0;l<s;++l)if(t.shape[l]!==e.shape[l])throw new Error(o+` updates.shape[${l}] (${t.shape[l]}) != indices.shape[${l}] (${e.shape[l]}).`);for(let l=0;l<t.rank-s;++l)if(t.shape[l+s]!==i[l+r])throw new Error(o+` updates.shape[${l+s}] (${t.shape[l+s]}) != shape[${l+s}] (${i[l+s]})`)}function Kb(i,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(i.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${i.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(i.size===0)throw new Error(`Updates specified for empty output. updates shape: ${i.shape}`)}l1(t,e,i)}function vp(i,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=t.length;let l=1;for(let g=s;g<o;++g)l*=t[g];const c=s<1?1:s,h=b(e.shape)/c,p=[...ze(t.slice(0,s)),1],f=b(t);return{sliceRank:s,numUpdates:h,sliceSize:l,strides:p,outputSize:f}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xg=-2,Xb=-1;function Qg(i,e,t){const r=i.shape.length;C(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),C(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)C(e[s]+t[s]<=i.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${i.shape[s]})`)}function Qb(i){const e=[];let t=0;for(;i>0;)i&1&&e.push(t),i/=2,t++;return e}function Zg(i,e,t){const r=[];for(let s=0;s<i.length;s++)r[s]=Math.ceil((e[s]-i[s])/t[s]);return r}function c1(i,e,t,r){const s=[...i];for(let o=s.length;o<r.length;o++)s.push(1);for(let o=0;o<t;o++)o===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function u1(i,e,t){return t<=i?t:t-(e-1)}function h1(i,e){const t=[];for(let r=0;r<i;r++)t.push(e+r);return t}function Zb(i,e,t,r,s,o,l,c,h){const p=i.length;let f=new Array(p),g=new Array(p),v=new Array(p);if(e.length&&t>0){const w=e[0],R=t+1;f=d1(l,w,R,r,i),g=p1(c,w,R,s,i),v=c1(o,w,R,i)}else for(let w=0;w<p;w++)f[w]=m1(l,r,o,i,w,h),g[w]=g1(c,s,o,i,w,h),v[w]=f1(o,w,h);return{begin:f,end:g,strides:v}}function d1(i,e,t,r,s){const o=[...s],l=h1(t,e);for(let c=0;c<o.length;c++)if(l.indexOf(c)>-1)o[c]=0;else{const h=u1(e,t,c);let p=r[h];i&1<<h&&(p=0),o[c]=p}return o}function p1(i,e,t,r,s){const o=[...s],l=h1(t,e);for(let c=0;c<o.length;c++)if(l.indexOf(c)>-1)o[c]=Number.MAX_SAFE_INTEGER;else{const h=u1(e,t,c);let p=r[h];i&1<<h&&(p=Number.MAX_SAFE_INTEGER),o[c]=p}for(let c=0;c<o.length;c++){const h=s[c];o[c]<0&&(o[c]+=h),o[c]=te(0,o[c],s[c])}return o}function f1(i,e,t){let r=i[e];return(t&1<<e||r==null)&&(r=1),r}function m1(i,e,t,r,s,o){let l=e[s];const c=t[s]||1;(i&1<<s||o&1<<s||l==null)&&(c>0?l=Number.MIN_SAFE_INTEGER:l=Number.MAX_SAFE_INTEGER);const h=r[s];return l<0&&(l+=h),l=te(0,l,h-1),l}function g1(i,e,t,r,s,o){let l=e[s];const c=t[s]||1;(i&1<<s||o&1<<s||l==null)&&(c>0?l=Number.MAX_SAFE_INTEGER:l=Number.MIN_SAFE_INTEGER);const h=r[s];return l<0&&(l+=h),c>0?l=te(0,l,h):l=te(-1,l,h-1),l}function Uf(i,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==i[s])return!1;return!0}function Vf(i,e){let t=i.length>0?i[i.length-1]:1;for(let r=0;r<i.length-1;r++)t+=i[r]*e[r];return t}function zf(i,e,t){let r;const s=i.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(l=>{C(l!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(s).fill(-1):typeof t=="number"?o=[t,...new Array(s-1).fill(-1)]:t.length<s?o=t.concat(new Array(s-t.length).fill(-1)):o=t,o=o.map((l,c)=>l>=0?l:(C(l===-1,()=>`Negative size values should be exactly -1 but got ${l} for the slice() size at index ${c}.`),i.shape[c]-r[c])),[r,o]}function $g(i,e,t,r,s,o,l,c,h){let p;if(r==null?(p=new Array(e.length),p.fill(1)):p=r,l!=null&&l&l-1)throw new Error("Multiple ellipses in slice is not allowed.");let f=!1;const g={dims:p.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:p.slice(),beginMask:s,endMask:o,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:h};for(let X=0;X<g.dims;X++)f&&1<<X&c&&g.numAddAxisAfterEllipsis++,1<<X&l&&(f=!0);f||(g.ellipsisMask|=1<<g.dims,g.dims++);const v={dims:i.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};$b(g,v);let w=!0,R=!0,P=!0;const z=[],G=[];for(let X=0;X<i.length;++X){if(v.strides[X]===0)throw Error(`strides[${X}] must be non-zero`);const fe=!!(v.shrinkAxisMask&1<<X),ge=i[X];if(ge===-1){z.push(fe?1:-1);continue}const be=[v.beginMask&1<<X,v.endMask&1<<X],He=[v.strides[X]>0?0:-1,v.strides[X]>0?ge:ge-1];if(fe&&v.strides[X]<=0)throw Error("only stride 1 allowed on non-range indexing.");P=P&&v.strides[X]===1;const Je=!!(v.beginMask&1<<X&&v.endMask&1<<X);if(v.beginValid&&v.endValid){if(fe){const Gt=v.begin[X]<0?ge+v.begin[X]:v.begin[X];if(v.begin[X]=Gt,v.end[X]=v.begin[X]+1,Gt<0||Gt>=ge)throw Error(`slice index ${v.begin[X]} of dimension ${X} out of bounds.`)}else v.begin[X]=A1(v.begin[X],0,v.strides[X],ge,be,He),v.end[X]=A1(v.end[X],1,v.strides[X],ge,be,He);const pt=v.strides[X]===1&&v.begin[X]===0&&v.end[X]===ge;w=w&&pt,R=R&&(X===0&&v.strides[X]===1||pt)}else w=w&&v.strides[X]===1&&Je,R=R&&(X===0&&v.strides[X]===1||Je);let $e,rt=!1;if(v.beginValid&&v.endValid?($e=v.end[X]-v.begin[X],rt=!0):fe?($e=1,rt=!0):Je&&ge>=0&&(v.strides[X]<0?$e=-ge:$e=ge,rt=!0),rt){let pt;$e===0||$e<0!=v.strides[X]<0?pt=0:pt=Math.trunc($e/v.strides[X])+($e%v.strides[X]!==0?1:0),z.push(pt)}else z.push(-1)}for(let X=0;X<v.finalShapeGatherIndices.length;++X){const fe=v.finalShapeGatherIndices[X];fe>=0?G.push(z[fe]):fe===Xg&&G.push(1)}return{finalShapeSparse:G.filter((X,fe)=>v.finalShapeGatherIndices[fe]!==Xg),finalShape:G,isIdentity:w,sliceDim0:R,isSimpleSlice:P,begin:v.begin,end:v.end,strides:v.strides}}function $b(i,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=i.begin!=null,e.endValid=i.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<i.dims;r++)if(1<<r&i.ellipsisMask){const s=Math.min(e.dims-(i.dims-r)+1+i.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&i.newAxisMask)e.finalShapeGatherIndices.push(Xg),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);i.begin!=null&&(e.begin[t]=i.begin[r]),i.end!=null&&(e.end[t]=i.end[r]),e.strides[t]=i.strides[r],i.beginMask&1<<r&&(e.beginMask|=1<<t),i.endMask&1<<r&&(e.endMask|=1<<t),i.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(Xb),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function A1(i,e,t,r,s,o){if(s[e])return t>0?o[e]:o[e+1&1];{const l=i<0?r+i:i;return l<o[0]?o[0]:l>o[1]?o[1]:l}}const jb=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Qg,computeFlatOffset:Vf,computeOutShape:Zg,getNormalizedAxes:Zb,isSliceContinous:Uf,maskToAxes:Qb,parseSliceParams:zf,sliceInfo:$g,startForAxis:m1,startIndicesWithElidedDims:d1,stopForAxis:g1,stopIndicesWithElidedDims:p1,stridesForAxis:f1,stridesWithElidedDims:c1},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Id{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Gl{constructor(){this.classNameMap={}}static getMap(){return Gl.instance==null&&(Gl.instance=new Gl),Gl.instance}static register(e){Gl.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Nn(i){C(i.className!=null,()=>"Class being registered does not have the static className property defined."),C(typeof i.className=="string",()=>"className is required to be a string, but got type "+typeof i.className),C(i.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Gl.register(i)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yb(i,e){let t=ut(i,"a","add"),r=ut(e,"b","add");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(We,s)}const Hn=Bt({add_:Yb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jb(i,e){let t=ut(i,"a","floorDiv"),r=ut(e,"b","floorDiv");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(Cr,s)}const v1=Bt({floorDiv_:Jb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qb(i,e){let t=ut(i,"a","div"),r=ut(e,"b","div");if([t,r]=Ca(t,r),t.dtype==="int32"&&r.dtype==="int32")return v1(t,r);const s={a:t,b:r},o={};return Et.runKernel(Ci,s,o)}const rr=Bt({div_:qb});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ex(i,e){let t=ut(i,"a","mul"),r=ut(e,"b","mul");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(fl,s)}const St=Bt({mul_:ex});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tx(i){const e=ut(i,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Et.runKernel(ti,t)}else{const t={x:e};return Et.runKernel(Nt,t)}}const Ro=Bt({abs_:tx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nx(i){const e={x:ut(i,"x","acos")};return Et.runKernel(De,e)}const ix=Bt({acos_:nx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rx(i){const e={x:ut(i,"x","acosh")};return Et.runKernel(Re,e)}const sx=Bt({acosh_:rx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ax(i,e=null,t=!1){const r={x:ut(i,"x","all","bool")},s={axis:e,keepDims:t};return Et.runKernel(Qe,r,s)}const y1=Bt({all_:ax});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ox(i,e=null,t=!1){const r={x:ut(i,"x","any","bool")},s={axis:e,keepDims:t};return Et.runKernel(Ke,r,s)}const jg=Bt({any_:ox});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lx(i,e=0){const t={x:ut(i,"x","argMax")},r={axis:e};return Et.runKernel(vt,t,r)}const yp=Bt({argMax_:lx});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cx(i,e=0){const t={x:ut(i,"x","argMin")},r={axis:e};return Et.runKernel(ct,t,r)}const ux=Bt({argMin_:cx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hx(i){const e={x:ut(i,"x","asin")};return Et.runKernel(Ct,e)}const dx=Bt({asin_:hx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function px(i){const e={x:ut(i,"x","asinh")};return Et.runKernel(Yt,e)}const fx=Bt({asinh_:px});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mx(i){const e={x:ut(i,"x","atan")};return Et.runKernel(me,e)}const gx=Bt({atan_:mx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ax(i,e){let t=ut(i,"a","atan2"),r=ut(e,"b","atan2");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(ae,s)}const vx=Bt({atan2_:Ax});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yx(i){const e={x:ut(i,"x","atanh")};return Et.runKernel(ee,e)}const bx=Bt({atanh_:yx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wf(i,e,t,r,s="NHWC",o){const l=i[3],c=[...e,l],h=Du(s);return xo(i,c,t,o,r,null,null,h)}function ac(i,e,t,r,s,o,l="channelsLast"){const[c,h]=Yg(e);let p;if(l==="channelsLast")p=[c,h,i[3],i[3]];else if(l==="channelsFirst")p=[c,h,i[1],i[1]];else throw new Error(`Unknown dataFormat ${l}`);return xo(i,p,t,r,s,o,!1,l)}function Lu(i,e,t,r,s,o,l="NDHWC"){const[c,h,p]=x1(e);let f,g;if(l==="NDHWC")g="channelsLast",f=[c,h,p,i[4],i[4]];else if(l==="NCDHW")g="channelsFirst",f=[c,h,p,i[1],i[1]];else throw new Error(`Unknown dataFormat ${l}`);return Bh(i,f,t,r,s,!1,g,o)}function xo(i,e,t,r,s,o,l=!1,c="channelsLast"){let[h,p,f,g]=[-1,-1,-1,-1];if(c==="channelsLast")[h,p,f,g]=i;else if(c==="channelsFirst")[h,g,p,f]=i;else throw new Error(`Unknown dataFormat ${c}`);const[v,w,,R]=e,[P,z]=Yg(t),[G,X]=Yg(r),fe=bp(v,G),ge=bp(w,X),{padInfo:be,outHeight:He,outWidth:Je}=gI(s,p,f,P,z,fe,ge,o,c),$e=l?R*g:R;let rt;return c==="channelsFirst"?rt=[h,$e,He,Je]:c==="channelsLast"&&(rt=[h,He,Je,$e]),{batchSize:h,dataFormat:c,inHeight:p,inWidth:f,inChannels:g,outHeight:He,outWidth:Je,outChannels:$e,padInfo:be,strideHeight:P,strideWidth:z,filterHeight:v,filterWidth:w,effectiveFilterHeight:fe,effectiveFilterWidth:ge,dilationHeight:G,dilationWidth:X,inShape:i,outShape:rt,filterShape:e}}function Bh(i,e,t,r,s,o=!1,l="channelsLast",c){let[h,p,f,g,v]=[-1,-1,-1,-1,-1];if(l==="channelsLast")[h,p,f,g,v]=i;else if(l==="channelsFirst")[h,v,p,f,g]=i;else throw new Error(`Unknown dataFormat ${l}`);const[w,R,P,,z]=e,[G,X,fe]=x1(t),[ge,be,He]=x1(r),Je=bp(w,ge),$e=bp(R,be),rt=bp(P,He),{padInfo:pt,outDepth:Gt,outHeight:zt,outWidth:Kt}=AI(s,p,f,g,G,X,fe,Je,$e,rt,c),tn=o?z*v:z;let qt;return l==="channelsFirst"?qt=[h,tn,Gt,zt,Kt]:l==="channelsLast"&&(qt=[h,Gt,zt,Kt,tn]),{batchSize:h,dataFormat:l,inDepth:p,inHeight:f,inWidth:g,inChannels:v,outDepth:Gt,outHeight:zt,outWidth:Kt,outChannels:tn,padInfo:pt,strideDepth:G,strideHeight:X,strideWidth:fe,filterDepth:w,filterHeight:R,filterWidth:P,effectiveFilterDepth:Je,effectiveFilterHeight:$e,effectiveFilterWidth:rt,dilationDepth:ge,dilationHeight:be,dilationWidth:He,inShape:i,outShape:qt,filterShape:e}}function fI(i,e,t,r,s){r==null&&(r=b1(i,e,t));const o=i[0],l=i[1],c=Sd((o-e+2*r)/t+1,s),h=Sd((l-e+2*r)/t+1,s);return[c,h]}function mI(i,e,t,r,s,o){s==null&&(s=b1(i,e,r));const l=i[0],c=i[1],h=i[2],p=Sd((l-e+2*s)/r+1,o),f=Sd((c-e+2*s)/r+1,o),g=Sd((h-e+2*s)/r+1,o);return[p,f,g,t]}function b1(i,e,t,r=1){const s=bp(e,r);return Math.floor((i[0]*(t-1)-t+s)/2)}function Yg(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}function x1(i){return typeof i=="number"?[i,i,i]:i}function bp(i,e){return e<=1?i:i+(i-1)*(e-1)}function gI(i,e,t,r,s,o,l,c,h){let p,f,g;if(typeof i=="number"){p={top:i,bottom:i,left:i,right:i,type:i===0?"VALID":"NUMBER"};const v=fI([e,t],o,r,i,c);f=v[0],g=v[1]}else if(i==="same"){f=Math.ceil(e/r),g=Math.ceil(t/s);const v=Math.max(0,(f-1)*r+o-e),w=Math.max(0,(g-1)*s+l-t),R=Math.floor(v/2),P=v-R,z=Math.floor(w/2),G=w-z;p={top:R,bottom:P,left:z,right:G,type:"SAME"}}else if(i==="valid")p={top:0,bottom:0,left:0,right:0,type:"VALID"},f=Math.ceil((e-o+1)/r),g=Math.ceil((t-l+1)/s);else if(typeof i=="object"){const v=h==="channelsLast"?i[1][0]:i[2][0],w=h==="channelsLast"?i[1][1]:i[2][1],R=h==="channelsLast"?i[2][0]:i[3][0],P=h==="channelsLast"?i[2][1]:i[3][1];p={top:v,bottom:w,left:R,right:P,type:v===0&&w===0&&R===0&&P===0?"VALID":"EXPLICIT"},f=Sd((e-o+v+w)/r+1,c),g=Sd((t-l+R+P)/s+1,c)}else throw Error(`Unknown padding parameter: ${i}`);return{padInfo:p,outHeight:f,outWidth:g}}function AI(i,e,t,r,s,o,l,c,h,p,f){let g,v,w,R;if(typeof i=="number"){g={top:i,bottom:i,left:i,right:i,front:i,back:i,type:i===0?"VALID":"NUMBER"};const P=mI([e,t,r,1],c,1,s,i,f);v=P[0],w=P[1],R=P[2]}else if(i==="same"){v=Math.ceil(e/s),w=Math.ceil(t/o),R=Math.ceil(r/l);const P=(v-1)*s+c-e,z=(w-1)*o+h-t,G=(R-1)*l+p-r,X=Math.floor(P/2),fe=P-X,ge=Math.floor(z/2),be=z-ge,He=Math.floor(G/2),Je=G-He;g={top:ge,bottom:be,left:He,right:Je,front:X,back:fe,type:"SAME"}}else if(i==="valid")g={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},v=Math.ceil((e-c+1)/s),w=Math.ceil((t-h+1)/o),R=Math.ceil((r-p+1)/l);else throw Error(`Unknown padding parameter: ${i}`);return{padInfo:g,outDepth:v,outHeight:w,outWidth:R}}function Sd(i,e){if(!e)return Math.trunc(i);switch(e){case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"floor":return Math.floor(i);default:throw new Error(`Unknown roundingMode ${e}`)}}function Td(i){const[e,t,r]=Yg(i);return e===1&&t===1&&r===1}function Bo(i,e){return Td(i)||Td(e)}function Du(i){if(i==="NHWC")return"channelsLast";if(i==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${i}`)}function Yo(i,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${i}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")C(I(e),()=>`Error in ${i}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{C(I(s),()=>`Error in ${i}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${i}: Unknown padding parameter: ${e}`)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vI(i,e){const t={x:ut(i,"x","reshape","string_or_numeric")},r={shape:e};return Et.runKernel(ld,t,r)}const kt=Bt({reshape_:vI});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yI(i,e,t,r,s){const o=ut(i,"x","avgPool","float32"),l=1;C(Bo(t,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${l}'`);let c=o,h=!1;o.rank===3&&(h=!0,c=kt(o,[1,o.shape[0],o.shape[1],o.shape[2]])),C(c.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${c.rank}.`),Yo("avgPool",r,s);const p={x:c},f={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let g=Et.runKernel(Ue,p,f);return g=wi(g,o.dtype),h?kt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const C1=Bt({avgPool_:yI});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bI(i,e,t,r,s,o="NDHWC"){const l=ut(i,"x","avgPool3d","float32");let c=l,h=!1;l.rank===4&&(h=!0,c=kt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),C(c.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${c.rank}.`),C(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Yo("avgPool3d",r,s);const p={x:c},f={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:o};let g=Et.runKernel(ft,p,f);return g=wi(g,c.dtype),h?kt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const xI=Bt({avgPool3d_:bI});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CI(i,e=0){C(i.length>=1,()=>"Pass at least one tensor to concat");const t=gp(i,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return _h(t[0]);const r=t,s={axis:e};return Et.runKernel(hn,r,s)}const Jo=Bt({concat_:CI});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wI(i){const e={x:ut(i,"x","sigmoid","float32")};return Et.runKernel(fh,e)}const xp=Bt({sigmoid_:wI});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EI(i,e,t){const r=ut(i,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:t};return Et.runKernel(mc,s,o)}const Xs=Bt({slice_:EI});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function II(i){const e={x:ut(i,"x","tanh","float32")};return Et.runKernel(ql,e)}const w1=Bt({tanh_:II});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SI(i,e,t){const r=ut(i,"x","batchToSpaceND"),s=e.reduce((c,h)=>c*h);C(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),C(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),C(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const o={x:r},l={blockShape:e,crops:t};return Et.runKernel(bi,o,l)}const E1=Bt({batchToSpaceND_:SI});function Gr(i){let e;return i.rank===0||i.rank===1?e=kt(i,[1,1,1,i.size]):i.rank===2?e=kt(i,[1,1,i.shape[0],i.shape[1]]):i.rank===3?e=kt(i,[1,i.shape[0],i.shape[1],i.shape[2]]):e=i,e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pi(i,e,t,r,s,o){o==null&&(o=.001);const l=ut(i,"x","batchNorm"),c=ut(e,"mean","batchNorm"),h=ut(t,"variance","batchNorm");let p;s!=null&&(p=ut(s,"scale","batchNorm"));let f;r!=null&&(f=ut(r,"offset","batchNorm")),C(c.rank===h.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(f==null||c.rank===f.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(p==null||c.rank===p.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const g={x:Gr(l),scale:p,offset:f,mean:c,variance:h},v={varianceEpsilon:o},w=Et.runKernel(zs,g,v);return kt(w,l.shape)}const qo=Bt({batchNorm_:pi});function Hf(i,e,t,r,s,o){const l=ut(i,"x","batchNorm"),c=ut(e,"mean","batchNorm"),h=ut(t,"variance","batchNorm");let p;s!=null&&(p=ut(s,"scale","batchNorm"));let f;return r!=null&&(f=ut(r,"offset","batchNorm")),C(l.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),C(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${c.rank}.`),C(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${h.rank}.`),p!=null&&C(p.rank===2||p.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${p.rank}.`),f!=null&&C(f.rank===2||f.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${f.rank}.`),qo(l,c,h,f,p,o)}const xx=Bt({batchNorm2d_:Hf});function Cx(i,e,t,r,s,o){const l=ut(i,"x","batchNorm"),c=ut(e,"mean","batchNorm"),h=ut(t,"variance","batchNorm");let p;s!=null&&(p=ut(s,"scale","batchNorm"));let f;return r!=null&&(f=ut(r,"offset","batchNorm")),C(l.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),C(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${c.rank}.`),C(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${h.rank}.`),p!=null&&C(p.rank===3||p.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${p.rank}.`),f!=null&&C(f.rank===3||f.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${f.rank}.`),qo(l,c,h,f,p,o)}const wx=Bt({batchNorm3d_:Cx});function Ex(i,e,t,r,s,o){const l=ut(i,"x","batchNorm"),c=ut(e,"mean","batchNorm"),h=ut(t,"variance","batchNorm");let p;s!=null&&(p=ut(s,"scale","batchNorm"));let f;return r!=null&&(f=ut(r,"offset","batchNorm")),C(l.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),C(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${c.rank}.`),C(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${h.rank}.`),p!=null&&C(p.rank===4||p.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${p.rank}.`),f!=null&&C(f.rank===4||f.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${f.rank}.`),qo(l,c,h,f,p,o)}const Ix=Bt({batchNorm4d_:Ex});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sx(i,e,t){const r=ut(i,"x","bincount"),s=ut(e,"weights","bincount");C(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),C(t>=0,()=>`size must be non-negative, but got ${t}.`),C(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const o={x:r,weights:s},l={size:t};return Et.runKernel(ri,o,l)}const Kf=Bt({bincount_:Sx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Md(i,e){let t=ut(i,"broadcastTo","x");const r=t.shape;if(e.some(h=>!(h>0)||h%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const h=t.shape.slice();for(;h.length<e.length;)h.unshift(1);t=kt(t,h)}const s=t.shape,o=Array.from(e);for(let h=e.length-1;h>=0;h--)if(s[h]===e[h])o[h]=1;else if(t.shape[h]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(o.map((h,p)=>h>1?p:-1).filter(h=>h>=0).length===0)return _h(t);const l={x:t},c={reps:o};return Et.runKernel(ml,l,c)}const kh=Bt({broadcastTo_:Md});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lh(i){const e={x:ut(i,"x","ceil","float32")};return Et.runKernel(Fs,e)}const Jg=Bt({ceil_:Lh});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cp(i,e,t){const r={shape:i,value:e,dtype:t};return Et.runKernel(Rs,{},r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qg(i,e,t){const r=ut(i,"x","clipByValue");if(C(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Cp(r.shape,e,r.dtype);const s={x:r},o={clipValueMin:e,clipValueMax:t};return Et.runKernel(Vs,s,o)}const Ja=Bt({clipByValue_:qg});function _d(i){return Jo(i,0)}const I1=Bt({concat1d_:_d});function e0(i,e){return Jo(i,e)}const Tx=Bt({concat2d_:e0});function S1(i,e){return Jo(i,e)}const Xf=Bt({concat3d_:S1});function Mx(i,e){return Jo(i,e)}const T1=Bt({concat4d_:Mx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M1(i,e,t,r,s="NHWC",o=[1,1],l){const c=ut(i,"x","conv2d","float32"),h=ut(e,"filter","conv2d","float32");let p=c,f=!1;c.rank===3&&(f=!0,p=kt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),C(p.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${p.rank}.`),C(h.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${h.rank}.`),Yo("conv2d",r,l);const g=s==="NHWC"?p.shape[3]:p.shape[1];C(g===h.shape[2],()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${h.shape[2]}.`),C(Bo(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const v={x:p,filter:h},w={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:l},R=Et.runKernel(On,v,w);return f?kt(R,[R.shape[1],R.shape[2],R.shape[3]]):R}const Zc=Bt({conv2d_:M1});function _x(i,e,t,r,s="NWC",o=1,l){const c=ut(i,"x","conv1d"),h=ut(e,"filter","conv1d");let p=c,f=!1;c.rank===2&&(f=!0,p=kt(c,[1,c.shape[0],c.shape[1]])),C(p.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${p.rank}.`),C(h.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${h.rank}.`),Yo("conv1d",r,l),C(p.shape[2]===h.shape[1],()=>`Error in conv1d: depth of input (${p.shape[2]}) must match input depth for filter ${h.shape[1]}.`),C(Bo(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),C(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const g=kt(h,[1,h.shape[0],h.shape[1],h.shape[2]]),v=kt(p,[p.shape[0],1,p.shape[1],p.shape[2]]),w=Zc(v,g,[1,t],r,"NHWC",[1,o],l);return f?kt(w,[w.shape[2],w.shape[3]]):kt(w,[w.shape[0],w.shape[2],w.shape[3]])}const _1=Bt({conv1d_:_x});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rx(i,e,t,r,s,o="NHWC",l){C(i.length===e.rank,()=>`Length of inShape (${i.length}) and rank of dy (${e.rank}) must match`);let c=i,h=e,p=!1;e.rank===3&&(p=!0,h=kt(e,[1,e.shape[0],e.shape[1],e.shape[2]]),c=[1,i[0],i[1],i[2]]),C(c.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${c.length}.`),C(h.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${h.rank}`),C(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const f=o==="NHWC"?c[3]:c[1],g=o==="NHWC"?h.shape[3]:h.shape[1];C(f===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${f}) must match input depth for filter ${t.shape[2]}.`),C(g===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${g}) must match output depth for filter ${t.shape[3]}.`),Yo("conv2dDerInput",s,l);const v={dy:h,filter:t},w={strides:r,pad:s,dataFormat:o,dimRoundingMode:l,inputShape:c},R=Et.runKernel(Yn,v,w);return p?kt(R,[R.shape[1],R.shape[2],R.shape[3]]):R}const t0=Bt({conv2DBackpropInput_:Rx});function Bx(i,e,t,r,s,o){const l=ut(i,"x","conv2dTranspose"),c=ut(e,"filter","conv2dTranspose");return t0(t,l,c,r,s,"NHWC",o)}const R1=Bt({conv2dTranspose_:Bx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kx(i,e,t,r,s="NDHWC",o=[1,1,1]){const l=ut(i,"x","conv3d"),c=ut(e,"filter","conv3d");let h=l,p=!1;l.rank===4&&(p=!0,h=kt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),C(h.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${h.rank}.`),C(c.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${c.rank}.`),C(h.shape[4]===c.shape[3],()=>`Error in conv3d: depth of input (${h.shape[4]}) must match input depth for filter ${c.shape[3]}.`),C(Bo(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),C(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`);const f={x:h,filter:c},g={strides:t,pad:r,dataFormat:s,dilations:o},v=Et.runKernel(Gi,f,g);return p?kt(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const Lx=Bt({conv3d_:kx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dx(i,e,t,r,s){C(i.length===e.rank,()=>`Length of inShape (${i.length}) and rank of dy (${e.rank}) must match`);let o=i,l=e,c=!1;e.rank===4&&(c=!0,l=kt(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,i[0],i[1],i[2],i[3]]);const h=o[4],p=l.shape[4];C(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),C(l.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${l.rank}`),C(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),C(h===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[3]}.`),C(p===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[4]}.`);const f={dy:l,filter:t},g={pad:s,strides:r,inputShape:o},v=Et.runKernel(cr,f,g);return c?kt(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const n0=Bt({conv3DBackpropInput_:Dx});function B1(i,e,t,r,s){const o=ut(i,"x","conv3dTranspose"),l=ut(e,"filter","conv3dTranspose");return n0(t,o,l,r,s)}const k1=Bt({conv3dTranspose_:B1});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L1(i){const e={x:ut(i,"x","cos","float32")};return Et.runKernel(Xr,e)}const Qf=Bt({cos_:L1});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D1(i){const e={x:ut(i,"x","cosh","float32")};return Et.runKernel(Fr,e)}const i0=Bt({cosh_:D1});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N1(i,e=0,t=!1,r=!1){const s={x:ut(i,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return Et.runKernel($r,s,o)}const Zf=Bt({cumprod_:N1});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rd(i,e=0,t=!1,r=!1){const s={x:ut(i,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return Et.runKernel(ws,s,o)}const Ka=Bt({cumsum_:Rd});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qa(i,e,t="NHWC"){const r=ut(i,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],l=t==="NHWC"?r.shape[3]:r.shape[1];C(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),C(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),C(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${r.shape}`),C(l%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${l} for depthToSpace with input shape ${r.shape}`);const c={x:r},h={blockSize:e,dataFormat:t};return Et.runKernel(vs,c,h)}const $f=Bt({depthToSpace_:qa});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nx(i,e,t,r,s="NHWC",o=[1,1],l){const c=ut(i,"x","depthwiseConv2d","float32"),h=ut(e,"filter","depthwiseConv2d","float32");let p=c,f=!1;c.rank===3&&(f=!0,p=kt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),C(p.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),C(h.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`);const g=s==="NHWC"?p.shape[3]:p.shape[1];C(g===h.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${g}) must match the inChannels dimension in filter ${h.shape[2]}.`),Yo("depthwiseConv2d",r,l);const v={x:p,filter:h},w={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:l},R=Et.runKernel(Ge,v,w);return f?kt(R,[R.shape[1],R.shape[2],R.shape[3]]):R}const r0=Bt({depthwiseConv2d_:Nx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fx(i,e,t,r,s=[1,1],o="NHWC"){const l=ut(i,"x","dilation2d"),c=ut(e,"filter","dilation2d");C(l.rank===3||l.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${l.rank}.`),C(c.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${c.rank}.`),C(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let h=l,p=!1;l.rank===3&&(h=kt(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=!0);const f={x:h,filter:c},g={strides:t,pad:r,dilations:s},v=Et.runKernel(Xt,f,g);return p?kt(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const Px=Bt({dilation2d_:Fx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ox(i,e){let t=ut(i,"a","equal","string_or_numeric"),r=ut(e,"b","equal","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(ir,s)}const Cc=Bt({equal_:Ox});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gx(i,e,t){const r=ut(e,"a","where"),s=ut(t,"b","where"),o=ut(i,"condition","where","bool"),l=Ir(Ir(o.shape,r.shape),s.shape),c=kh(o,l),h=kh(r,l),p=kh(s,l),f={condition:c,t:h,e:p};return Et.runKernel(ud,f)}const el=Bt({where_:Gx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ux(i){const e={x:ut(i,"x","zerosLike")};return Et.runKernel(Gc,e)}const ns=Bt({zerosLike_:Ux});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vx(i,e){let t=ut(i,"a","div"),r=ut(e,"b","div");[t,r]=Ca(t,r);const s=rr(t,r),o=ns(s),l=Cc(r,o);return el(l,o,s)}const zx=Bt({divNoNan_:Vx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wx(i,e){const t=ut(i,"t1","dot"),r=ut(e,"t2","dot");C((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];if(C(s===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`),t.rank===1&&r.rank===1){const l=kt(t,[1,-1]),c=kt(r,[-1,1]),h=bs(l,c);return kt(h,[])}else if(t.rank===1&&r.rank===2){const l=kt(t,[1,-1]),c=kt(r,[r.shape[0],r.shape[1]]),h=bs(l,c);return kt(h,[h.size])}else if(t.rank===2&&r.rank===1){const l=kt(r,[-1,1]),c=bs(t,l);return kt(c,[c.size])}else{const l=kt(r,[r.shape[0],r.shape[1]]);return bs(t,l)}}const Hx=Bt({dot_:Wx});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kx(i){const e={x:ut(i,"x","elu","float32")};return Et.runKernel(An,e)}const jf=Bt({elu_:Kx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xx(i){let e=ut(i,"x","erf");C(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=wi(e,"float32"));const t={x:e};return Et.runKernel(Hi,t)}const Qx=Bt({erf_:Xx});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function s0(i,e){for(let t=0;t<i.length;++t)if(i[i.length-t-1]!==e-1-t)return!1;return!0}function F1(i,e,t){const r=i.length+e.length,s=[];let o=0,l=0;for(let c=0;c<r;c++)t.indexOf(c)===-1?s.push(i[o++]):s.push(e[l++]);return s}function Xa(i,e){const t=[],r=i.length;for(let o=0;o<r;o++)e.indexOf(o)===-1&&t.push(i[o]);const s=e.map(o=>i[o]);return[t,s]}function Da(i,e){const t=e.map(r=>1);return F1(i,t,e)}function co(i,e,t){C(s0(e,t),()=>`${i} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function ha(i,e){if(s0(i,e))return null;const t=[];for(let r=0;r<e;++r)i.indexOf(r)===-1&&t.push(r);return i.forEach(r=>t.push(r)),t}function Nu(i){return i.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function wa(i,e){const t=[];for(let r=e-i;r<e;++r)t.push(r);return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zx(i,e=null,t=!1){const r={x:ut(i,"x","max")},s={reductionIndices:e,keepDims:t};return Et.runKernel(Is,r,s)}const wc=Bt({max_:Zx});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $x(i,e=null,t=!1){const r={x:ut(i,"x","min")},s={axis:e,keepDims:t};return Et.runKernel(Fo,r,s)}const a0=Bt({min_:$x});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jx(i,e){let t=ut(i,"base","pow"),r=ut(e,"exp","pow");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(Yl,s)}const Bd=Bt({pow_:jx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xs(i,e){if((Ae(i)&&e!=="string"||Array.isArray(i))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ae(i)&&!(i instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ih(i,[],[],e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yx(i){const e={x:ut(i,"x","sqrt","float32")};return Et.runKernel(gh,e)}const ko=Bt({sqrt_:Yx});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jx(i){const e=ut(i,"x","square"),t={};return Et.runKernel("Square",{x:e},t)}const Qs=Bt({square_:Jx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qx(i,e=null,t=!1){let r=ut(i,"x","sum");r.dtype==="bool"&&(r=wi(r,"int32"));const s={x:r},o={axis:e,keepDims:t};return Et.runKernel(hd,s,o)}const Ji=Bt({sum_:qx});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function e2(i,e="euclidean",t=null,r=!1){i=ut(i,"x","norm");const s=P1(i,e,t);let o=s.shape;if(r){const l=J(t,i.shape);o=Da(s.shape,l)}return kt(s,o)}function P1(i,e,t=null){if(i.rank===0)return Ro(i);if(i.rank!==1&&t===null)return P1(kt(i,[-1]),e,t);if(i.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ji(Ro(i),t);if(e===1/0)return wc(Ro(i),t);if(e===-1/0)return a0(Ro(i),t);if(e==="euclidean"||e===2)return ko(Ji(Bd(Ro(i),xs(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return wc(Ji(Ro(i),t[0]),t[1]-1);if(e===1/0)return wc(Ji(Ro(i),t[1]),t[0]);if(e===-1/0)return a0(Ji(Ro(i),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ko(Ji(Qs(i),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Yf=Bt({norm_:e2});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function t2(i,e=null,t=!1){return Yf(i,"euclidean",e,t)}const o0=Bt({euclideanNorm_:t2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O1(i){const e={x:ut(i,"x","exp")};return Et.runKernel(us,e)}const $c=Bt({exp_:O1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jf(i,e=0){const t=ut(i,"x","expandDims","string_or_numeric");C(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return Et.runKernel(Tr,r,s)}const xl=Bt({expandDims_:Jf});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function n2(i){const e={x:ut(i,"x","expm1")};return Et.runKernel(pr,e)}const i2=Bt({expm1_:n2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r2(i,e){const t=ut(i,"x","tile","string_or_numeric");C(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return Et.runKernel(ml,r,s)}const Ul=Bt({tile_:r2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function s2(i,e,t,r="float32"){e==null&&(e=i);const s=dr([i,e],r),o=i<=e?i:e;for(let c=0;c<o;++c)s.set(1,c,c);const l=kt(s.toTensor(),[i,e]);if(t==null)return l;if(t.length===1)return Ul(xl(l,0),[t[0],1,1]);if(t.length===2)return Ul(xl(xl(l,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ul(xl(xl(xl(l,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const G1=Bt({eye_:s2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a2(i){const e={x:ut(i,"x","floor","float32")};return Et.runKernel(di,e)}const qf=Bt({floor_:a2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function o2(i,e,t=0,r=0){const s=ut(i,"x","gather"),o=ut(e,"indices","gather","int32"),l={x:s,indices:o},c={axis:t,batchDims:r};return Et.runKernel(zr,l,c)}const Dh=Bt({gather_:o2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U1(i,e){let t=ut(i,"a","greater","string_or_numeric"),r=ut(e,"b","greater","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(ce,s)}const Cl=Bt({greater_:U1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l2(i,e){let t=ut(i,"a","greaterEqual","string_or_numeric"),r=ut(e,"b","greaterEqual","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(Ce,s)}const Fu=Bt({greaterEqual_:l2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c2(i){const e={x:ut(i,"x","isFinite")};return Et.runKernel(It,e)}const u2=Bt({isFinite_:c2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V1(i){const e={x:ut(i,"x","isInf")};return Et.runKernel(Sn,e)}const h2=Bt({isInf_:V1});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z1(i){const e={x:ut(i,"x","isNaN")};return Et.runKernel(vn,e)}const d2=Bt({isNaN_:z1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function p2(i,e=.2){const t={x:ut(i,"x","leakyRelu")},r={alpha:e};return Et.runKernel(Lt,t,r)}const l0=Bt({leakyRelu_:p2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f2(i,e){let t=ut(i,"a","less","string_or_numeric"),r=ut(e,"b","less","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(rn,s)}const W1=Bt({less_:f2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m2(i,e){let t=ut(i,"a","lessEqual","string_or_numeric"),r=ut(e,"b","lessEqual","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(Bn,s)}const kd=Bt({lessEqual_:m2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g2(i,e=5,t=1,r=1,s=.5){const o=ut(i,"x","localResponseNormalization");C(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),C(I(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let l=o,c=!1;o.rank===3&&(c=!0,l=kt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const h={x:l},p={depthRadius:e,bias:t,alpha:r,beta:s},f=Et.runKernel(Qr,h,p);return c?kt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const A2=Bt({localResponseNormalization_:g2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v2(i){const e={x:ut(i,"x","log","float32")};return Et.runKernel(Ii,e)}const Ec=Bt({log_:v2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y2(i){const e={x:ut(i,"x","log1p")};return Et.runKernel(Vi,e)}const c0=Bt({log1p_:y2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H1(i,e){C(Pe(i),()=>"The f passed in variableGrads(f) must be a function"),C(e==null||Array.isArray(e)&&e.every(p=>p instanceof Rf),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const p in Et.registeredVariables)e.push(Et.registeredVariables[p])}const r=t?e.filter(p=>!p.trainable):null,s=e.length;e=e.filter(p=>p.trainable),C(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const o=!0,{value:l,grads:c}=Et.gradients(i,e,null,o);C(c.some(p=>p!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),C(l.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${l.rank} tensor`);const h={};return e.forEach((p,f)=>{c[f]!=null&&(h[p.name]=c[f])}),r!=null&&r.forEach(p=>h[p.name]=null),{value:l,grads:h}}function Ld(i){return Et.customGrad(i)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b2(i){const e={x:ut(i,"x","softplus")};return Et.runKernel(mh,e)}const wp=Bt({softplus_:b2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x2(i){const e=ut(i,"x","logSigmoid");return Ld(t=>({value:La(wp(La(t))),gradFunc:r=>St(r,xp(La(t)))}))(e)}const C2=Bt({logSigmoid_:x2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w2(i,e){let t=ut(i,"a","sub"),r=ut(e,"b","sub");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(vh,s)}const mr=Bt({sub_:w2});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E2(i,e=-1){const t=ut(i,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Ld((r,s)=>{const o=wc(r,e,!0),l=mr(r,o),c=mr(wi(l,"float32"),Ec(Ji($c(l),e,!0)));return s([c]),{value:c,gradFunc:(h,p)=>{const[f]=p,g=!0,v=$c(f);return mr(h,St(Ji(h,e,g),v))}}})(t)}const em=Bt({logSoftmax_:E2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u0(i,e=null,t=!1){const r=ut(i,"x","logSumExp"),s=J(e,r.shape),o=wc(r,s,!0),l=mr(r,o),c=$c(l),h=Ji(c,s),p=Ec(h),f=Hn(kt(o,p.shape),p);if(t){const g=Da(f.shape,s);return kt(f,g)}return f}const I2=Bt({logSumExp_:u0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S2(i,e){const t=ut(i,"a","logicalAnd","bool"),r=ut(e,"b","logicalAnd","bool");Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(br,s)}const jc=Bt({logicalAnd_:S2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T2(i){const e={x:ut(i,"x","logicalNot","bool")};return Et.runKernel(ur,e)}const h0=Bt({logicalNot_:T2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K1(i,e){const t=ut(i,"a","logicalOr","bool"),r=ut(e,"b","logicalOr","bool");Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(er,s)}const Pu=Bt({logicalOr_:K1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function d0(i,e){const t=ut(i,"a","logicalXor","bool"),r=ut(e,"b","logicalXor","bool");return Ir(t.shape,r.shape),jc(Pu(i,e),h0(jc(i,e)))}const X1=Bt({logicalXor_:d0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q1(i,e,t,r,s){const o=ut(i,"x","maxPool"),l=1;let c=o,h=!1;o.rank===3&&(h=!0,c=kt(o,[1,o.shape[0],o.shape[1],o.shape[2]])),C(c.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${c.rank}.`),C(Bo(t,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${l}'`),Yo("maxPool",r,s);const p={x:c},f={filterSize:e,strides:t,pad:r,dimRoundingMode:s},g=Et.runKernel(Ps,p,f);return h?kt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const p0=Bt({maxPool_:Q1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z1(i,e=[1,1,1],t,r,s,o="NDHWC"){const l=ut(i,"x","maxPool3d");let c=l,h=!1;l.rank===4&&(h=!0,c=kt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),C(c.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${c.rank}.`),C(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Yo("maxPool3d",r,s);const p={x:c},f={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:o},g=Et.runKernel(Va,p,f);return h?kt(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const M2=Bt({maxPool3d_:Z1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f0(i,e){let t=ut(i,"a","maximum"),r=ut(e,"b","maximum");[t,r]=Ca(t,r),t.dtype==="bool"&&(t=wi(t,"int32"),r=wi(r,"int32")),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(Ys,s)}const Yc=Bt({maximum_:f0});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _2(i,e=null,t=!1){const r={x:ut(i,"x","mean")},s={axis:e,keepDims:t};return Et.runKernel(Tl,r,s)}const Na=Bt({mean_:_2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eo(i,e="float32"){if(e==="complex64"){const r=eo(i,"float32"),s=eo(i,"float32");return Qc(r,s)}const t=fn(b(i),e);return Et.makeTensor(t,i,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nh(i,e="float32"){if(e==="complex64"){const r=Nh(i,"float32"),s=eo(i,"float32");return Qc(r,s)}const t=Rt(b(i),e);return Et.makeTensor(t,i,e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $1(i,e){let t=ut(i,"a","minimum"),r=ut(e,"b","minimum");[t,r]=Ca(t,r),t.dtype==="bool"&&(t=wi(t,"int32"),r=wi(r,"int32")),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(dl,s)}const tm=Bt({minimum_:$1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nm(i,e,t){C(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=ut(i,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");C(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let c=0;c<r.rank;c++)C(e[c].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),C(e[c][0]>=0&&e[c][0]<=r.shape[c]-s&&e[c][1]>=0&&e[c][1]<=r.shape[c]-s,()=>`Padding in dimension ${c} cannot be greater than or equal to ${r.shape[c]-s} or less than 0 for input of shape ${r.shape}`);const o={paddings:e,mode:t},l={x:r};return Et.runKernel(Ml,l,o)}const im=Bt({mirrorPad_:nm});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j1(i,e){let t=ut(i,"a","mod"),r=ut(e,"b","mod");[t,r]=Ca(t,r);const s={a:t,b:r};return Et.runKernel(pl,s)}const rm=Bt({mod_:j1});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wo(i,e=null,t=!1){i=ut(i,"x","moments");const r=J(e,i.shape),s=Na(i,r,t);let o=s.shape;t||(o=Da(s.shape,r));const l=Qs(mr(wi(i,"float32"),kt(s,o))),c=Na(l,r,t);return{mean:s,variance:c}}const Jc=Bt({moments_:Wo});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m0(i,e){let t=ut(i,"a","notEqual","string_or_numeric"),r=ut(e,"b","notEqual","string_or_numeric");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r};return Et.runKernel(Rl,s)}const qc=Bt({notEqual_:m0});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ep(i){const e={x:ut(i,"x","onesLike")};return Et.runKernel(id,e)}const Co=Bt({onesLike_:Ep});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dd(i,e,t=0){const r=ut(i,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},o={x:r};return Et.runKernel(oh,o,s)}const Ou=Bt({pad_:Dd});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ip(i,e,t){const r=ut(i,"x","spaceToBatchND");C(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),C(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),C(r.shape.reduce((l,c,h)=>h>0&&h<=e.length?l&&(c+t[h-1][0]+t[h-1][1])%e[h-1]===0:l,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},o={blockShape:e,paddings:t};return Et.runKernel(dd,s,o)}const sm=Bt({spaceToBatchND_:Ip});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function am(i,e,t,r,s,o,l){s==null&&(s=[1,1]),o==null&&(o=1),r===0&&(r="valid");const c=ut(i,"x","maxPool");let h=c,p=!1;c.rank===3&&(p=!0,h=kt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),C(Bo(o,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`);const f=ac(h.shape,e,o,s,r),g=[f.dilationHeight,f.dilationWidth];let v;r==="same"?v=om([f.filterHeight,f.filterWidth],g):v=[[0,0],[0,0]];const w=g[0]===1&&g[1]===1,[R,P]=Sp([f.inHeight,f.inWidth],g,v),z=w?r:"valid",G=w?h:sm(h,g,R),X=(t==="avg"?()=>C1(G,e,o,z,l):()=>p0(G,e,o,z,l))(),fe=w?X:E1(X,g,P);return p?kt(fe,[fe.shape[1],fe.shape[2],fe.shape[3]]):fe}function Sp(i,e,t){const r=t.map(f=>f[0]),s=t.map(f=>f[1]),o=i.concat(r,s),l=e.map((f,g)=>(f-o[g]%f)%f),c=s.map((f,g)=>f+l[g]),h=e.map((f,g)=>[r[g],c[g]]),p=e.map((f,g)=>[0,l[g]]);return[h,p]}function om(i,e){const t=i.map((o,l)=>o+(o-1)*(e[l]-1)).map(o=>o-1),r=t.map(o=>Math.floor(o/2)),s=t.map((o,l)=>o-r[l]);return t.map((o,l)=>[r[l],s[l]])}const Y1=Bt({pool_:am});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g0(i,e){const t=ut(i,"x","prelu"),r=ut(e,"alpha","prelu"),s={x:t,alpha:r};return Et.runKernel(ad,s)}const lm=Bt({prelu_:g0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J1(i,e=null,t=!1){let r=ut(i,"x","prod");r.dtype==="bool"&&(r=wi(r,"int32"));const s={x:r},o={axis:e,keepDims:t};return Et.runKernel(od,s,o)}const cm=Bt({prod_:J1});var Nd={},q1={get exports(){return Nd},set exports(i){Nd=i}};(function(i){(function(e,t,r){function s(h){var p=this,f=c();p.next=function(){var g=2091639*p.s0+p.c*23283064365386963e-26;return p.s0=p.s1,p.s1=p.s2,p.s2=g-(p.c=g|0)},p.c=1,p.s0=f(" "),p.s1=f(" "),p.s2=f(" "),p.s0-=f(h),p.s0<0&&(p.s0+=1),p.s1-=f(h),p.s1<0&&(p.s1+=1),p.s2-=f(h),p.s2<0&&(p.s2+=1),f=null}function o(h,p){return p.c=h.c,p.s0=h.s0,p.s1=h.s1,p.s2=h.s2,p}function l(h,p){var f=new s(h),g=p&&p.state,v=f.next;return v.int32=function(){return f.next()*4294967296|0},v.double=function(){return v()+(v()*2097152|0)*11102230246251565e-32},v.quick=v,g&&(typeof g=="object"&&o(g,f),v.state=function(){return o(f,{})}),v}function c(){var h=4022871197,p=function(f){f=String(f);for(var g=0;g<f.length;g++){h+=f.charCodeAt(g);var v=.02519603282416938*h;h=v>>>0,v-=h,v*=h,h=v>>>0,v-=h,h+=v*4294967296}return(h>>>0)*23283064365386963e-26};return p}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.alea=l})(la,i,!1)})(q1);var um={},ev={get exports(){return um},set exports(i){um=i}};(function(i){(function(e,t,r){function s(c){var h=this,p="";h.x=0,h.y=0,h.z=0,h.w=0,h.next=function(){var g=h.x^h.x<<11;return h.x=h.y,h.y=h.z,h.z=h.w,h.w^=h.w>>>19^g^g>>>8},c===(c|0)?h.x=c:p+=c;for(var f=0;f<p.length+64;f++)h.x^=p.charCodeAt(f)|0,h.next()}function o(c,h){return h.x=c.x,h.y=c.y,h.z=c.z,h.w=c.w,h}function l(c,h){var p=new s(c),f=h&&h.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var v=p.next()>>>11,w=(p.next()>>>0)/4294967296,R=(v+w)/(1<<21);while(R===0);return R},g.int32=p.next,g.quick=g,f&&(typeof f=="object"&&o(f,p),g.state=function(){return o(p,{})}),g}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.xor128=l})(la,i,!1)})(ev);var hm={},tv={get exports(){return hm},set exports(i){hm=i}};(function(i){(function(e,t,r){function s(c){var h=this,p="";h.next=function(){var g=h.x^h.x>>>2;return h.x=h.y,h.y=h.z,h.z=h.w,h.w=h.v,(h.d=h.d+362437|0)+(h.v=h.v^h.v<<4^(g^g<<1))|0},h.x=0,h.y=0,h.z=0,h.w=0,h.v=0,c===(c|0)?h.x=c:p+=c;for(var f=0;f<p.length+64;f++)h.x^=p.charCodeAt(f)|0,f==p.length&&(h.d=h.x<<10^h.x>>>4),h.next()}function o(c,h){return h.x=c.x,h.y=c.y,h.z=c.z,h.w=c.w,h.v=c.v,h.d=c.d,h}function l(c,h){var p=new s(c),f=h&&h.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var v=p.next()>>>11,w=(p.next()>>>0)/4294967296,R=(v+w)/(1<<21);while(R===0);return R},g.int32=p.next,g.quick=g,f&&(typeof f=="object"&&o(f,p),g.state=function(){return o(p,{})}),g}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.xorwow=l})(la,i,!1)})(tv);var A0={},nv={get exports(){return A0},set exports(i){A0=i}};(function(i){(function(e,t,r){function s(c){var h=this;h.next=function(){var f=h.x,g=h.i,v,w;return v=f[g],v^=v>>>7,w=v^v<<24,v=f[g+1&7],w^=v^v>>>10,v=f[g+3&7],w^=v^v>>>3,v=f[g+4&7],w^=v^v<<7,v=f[g+7&7],v=v^v<<13,w^=v^v<<9,f[g]=w,h.i=g+1&7,w};function p(f,g){var v,w=[];if(g===(g|0))w[0]=g;else for(g=""+g,v=0;v<g.length;++v)w[v&7]=w[v&7]<<15^g.charCodeAt(v)+w[v+1&7]<<13;for(;w.length<8;)w.push(0);for(v=0;v<8&&w[v]===0;++v);for(v==8?w[7]=-1:w[v],f.x=w,f.i=0,v=256;v>0;--v)f.next()}p(h,c)}function o(c,h){return h.x=c.x.slice(),h.i=c.i,h}function l(c,h){c==null&&(c=+new Date);var p=new s(c),f=h&&h.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var v=p.next()>>>11,w=(p.next()>>>0)/4294967296,R=(v+w)/(1<<21);while(R===0);return R},g.int32=p.next,g.quick=g,f&&(f.x&&o(f,p),g.state=function(){return o(p,{})}),g}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.xorshift7=l})(la,i,!1)})(nv);var dm={},v0={get exports(){return dm},set exports(i){dm=i}};(function(i){(function(e,t,r){function s(c){var h=this;h.next=function(){var f=h.w,g=h.X,v=h.i,w,R;return h.w=f=f+1640531527|0,R=g[v+34&127],w=g[v=v+1&127],R^=R<<13,w^=w<<17,R^=R>>>15,w^=w>>>12,R=g[v]=R^w,h.i=v,R+(f^f>>>16)|0};function p(f,g){var v,w,R,P,z,G=[],X=128;for(g===(g|0)?(w=g,g=null):(g=g+"\0",w=0,X=Math.max(X,g.length)),R=0,P=-32;P<X;++P)g&&(w^=g.charCodeAt((P+32)%g.length)),P===0&&(z=w),w^=w<<10,w^=w>>>15,w^=w<<4,w^=w>>>13,P>=0&&(z=z+1640531527|0,v=G[P&127]^=w+z,R=v==0?R+1:0);for(R>=128&&(G[(g&&g.length||0)&127]=-1),R=127,P=4*128;P>0;--P)w=G[R+34&127],v=G[R=R+1&127],w^=w<<13,v^=v<<17,w^=w>>>15,v^=v>>>12,G[R]=w^v;f.w=z,f.X=G,f.i=R}p(h,c)}function o(c,h){return h.i=c.i,h.w=c.w,h.X=c.X.slice(),h}function l(c,h){c==null&&(c=+new Date);var p=new s(c),f=h&&h.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var v=p.next()>>>11,w=(p.next()>>>0)/4294967296,R=(v+w)/(1<<21);while(R===0);return R},g.int32=p.next,g.quick=g,f&&(f.X&&o(f,p),g.state=function(){return o(p,{})}),g}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.xor4096=l})(la,i,!1)})(v0);var Gu={},iv={get exports(){return Gu},set exports(i){Gu=i}};(function(i){(function(e,t,r){function s(c){var h=this,p="";h.next=function(){var g=h.b,v=h.c,w=h.d,R=h.a;return g=g<<25^g>>>7^v,v=v-w|0,w=w<<24^w>>>8^R,R=R-g|0,h.b=g=g<<20^g>>>12^v,h.c=v=v-w|0,h.d=w<<16^v>>>16^R,h.a=R-g|0},h.a=0,h.b=0,h.c=-1640531527,h.d=1367130551,c===Math.floor(c)?(h.a=c/4294967296|0,h.b=c|0):p+=c;for(var f=0;f<p.length+20;f++)h.b^=p.charCodeAt(f)|0,h.next()}function o(c,h){return h.a=c.a,h.b=c.b,h.c=c.c,h.d=c.d,h}function l(c,h){var p=new s(c),f=h&&h.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var v=p.next()>>>11,w=(p.next()>>>0)/4294967296,R=(v+w)/(1<<21);while(R===0);return R},g.int32=p.next,g.quick=g,f&&(typeof f=="object"&&o(f,p),g.state=function(){return o(p,{})}),g}t&&t.exports?t.exports=l:r&&r.amd?r(function(){return l}):this.tychei=l})(la,i,!1)})(iv);var y0={},pm={get exports(){return y0},set exports(i){y0=i}};const Fd=tt(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(i){(function(e,t,r){var s=256,o=6,l=52,c="random",h=r.pow(s,o),p=r.pow(2,l),f=p*2,g=s-1,v;function w(ge,be,He){var Je=[];be=be==!0?{entropy:!0}:be||{};var $e=G(z(be.entropy?[ge,fe(t)]:ge??X(),3),Je),rt=new R(Je),pt=function(){for(var Gt=rt.g(o),zt=h,Kt=0;Gt<p;)Gt=(Gt+Kt)*s,zt*=s,Kt=rt.g(1);for(;Gt>=f;)Gt/=2,zt/=2,Kt>>>=1;return(Gt+Kt)/zt};return pt.int32=function(){return rt.g(4)|0},pt.quick=function(){return rt.g(4)/4294967296},pt.double=pt,G(fe(rt.S),t),(be.pass||He||function(Gt,zt,Kt,tn){return tn&&(tn.S&&P(tn,rt),Gt.state=function(){return P(rt,{})}),Kt?(r[c]=Gt,zt):Gt})(pt,$e,"global"in be?be.global:this==r,be.state)}function R(ge){var be,He=ge.length,Je=this,$e=0,rt=Je.i=Je.j=0,pt=Je.S=[];for(He||(ge=[He++]);$e<s;)pt[$e]=$e++;for($e=0;$e<s;$e++)pt[$e]=pt[rt=g&rt+ge[$e%He]+(be=pt[$e])],pt[rt]=be;(Je.g=function(Gt){for(var zt,Kt=0,tn=Je.i,qt=Je.j,sn=Je.S;Gt--;)zt=sn[tn=g&tn+1],Kt=Kt*s+sn[g&(sn[tn]=sn[qt=g&qt+zt])+(sn[qt]=zt)];return Je.i=tn,Je.j=qt,Kt})(s)}function P(ge,be){return be.i=ge.i,be.j=ge.j,be.S=ge.S.slice(),be}function z(ge,be){var He=[],Je=typeof ge,$e;if(be&&Je=="object")for($e in ge)try{He.push(z(ge[$e],be-1))}catch{}return He.length?He:Je=="string"?ge:ge+"\0"}function G(ge,be){for(var He=ge+"",Je,$e=0;$e<He.length;)be[g&$e]=g&(Je^=be[g&$e]*19)+He.charCodeAt($e++);return fe(be)}function X(){try{var ge;return v&&(ge=v.randomBytes)?ge=ge(s):(ge=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(ge)),fe(ge)}catch{var be=e.navigator,He=be&&be.plugins;return[+new Date,e,He,e.screen,fe(t)]}}function fe(ge){return String.fromCharCode.apply(0,ge)}if(G(r.random(),t),i.exports){i.exports=w;try{v=Fd}catch{}}else r["seed"+c]=w})(typeof self<"u"?self:la,[],Math)})(pm);var rv=Nd,sv=um,fm=hm,R2=A0,Tp=dm,av=Gu,Fa=y0;Fa.alea=rv,Fa.xor128=sv,Fa.xorwow=fm,Fa.xorshift7=R2,Fa.xor4096=Tp,Fa.tychei=av;var mm=Fa;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class b0{constructor(e,t,r,s,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const l=o||Math.random();this.random=mm.alea(l.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,o,l;do s=2*this.random()-1,o=2*this.random()-1,l=s*s+o*o;while(l>=1||l===0);const c=Math.sqrt(-2*Math.log(l)/l);e=this.mean+this.stdDev*s*c,t=this.mean+this.stdDev*o*c,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class ov{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=mm.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x0(i,e=0,t=1,r,s){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const o=new b0(e,t,r,!1,s),l=dr(i,r);for(let c=0;c<l.values.length;c++)l.values[c]=o.nextValue();return l.toTensor()}const gm=Bt({randomNormal_:x0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Uu(i,e=0,t=1,r="float32",s){const o=dr(i,r),l=new ov(e,t,null,s);for(let c=0;c<o.values.length;c++)o.values[c]=l.nextValue();return o.toTensor()}const Mp=Bt({randomUniform_:Uu});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _p(i,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:i,stop:e,step:t,dtype:r};return Et.runKernel(cp,{},s)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ic(i){const e={x:ut(i,"x","reciprocal")};return Et.runKernel(lh,e)}const lv=Bt({reciprocal_:Ic});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C0(i){const e={x:ut(i,"x","relu")};return Et.runKernel(ch,e)}const Vu=Bt({relu_:C0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w0(i){const e={x:ut(i,"x","relu6")};return Et.runKernel(Eu,e)}const Rp=Bt({relu6_:w0});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Am(i,e){const t={x:ut(i,"x","reverse")},r={dims:e};return Et.runKernel(Bl,t,r)}const zu=Bt({reverse_:Am});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cv(i){const e={x:ut(i,"x","round")};return Et.runKernel(Jl,e)}const uv=Bt({round_:cv});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B2(i){const e={x:ut(i,"x","rsqrt","float32")};return Et.runKernel(Za,e)}const vm=Bt({rsqrt_:B2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k2(i){const e={x:ut(i,"x","selu")};return Et.runKernel(uh,e)}const hv=Bt({selu_:k2});function oc(i,e,t,r,s,o=[1,1],l="NHWC"){const c=ut(i,"x","separableConv2d"),h=ut(e,"depthwiseFilter","separableConv2d"),p=ut(t,"pointwiseFilter","separableConv2d");let f=c,g=!1;if(c.rank===3&&(g=!0,f=kt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(f.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${f.rank}.`),C(h.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${h.rank}.`),C(p.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${h.rank}.`),C(p.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${p.shape[0]}.`),C(p.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${p.shape[1]}.`);const v=h.shape[2],w=h.shape[3];C(p.shape[2]===v*w,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${v*w}, but got ${p.shape[2]}.`);const R=r0(f,h,r,s,l,o),P=Zc(R,p,1,"valid",l);return g?kt(P,[P.shape[1],P.shape[2],P.shape[3]]):P}const Bp=Bt({separableConv2d_:oc});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dv(i){const e={x:ut(i,"x","sign")};return Et.runKernel(ph,e)}const E0=Bt({sign_:dv});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ym(i){const e={x:ut(i,"x","sin","float32")};return Et.runKernel(hh,e)}const bm=Bt({sin_:ym});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I0(i){const e={x:ut(i,"x","sinh")};return Et.runKernel(dh,e)}const xm=Bt({sinh_:I0});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pv(i,e,t){const r=ut(i,"x","slice1d");return C(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Xs(r,[e],[t])}const Cm=Bt({slice1d_:pv});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L2(i,e,t){const r=ut(i,"x","slice2d");return C(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Xs(r,e,t)}const fv=Bt({slice2d_:L2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D2(i,e,t){const r=ut(i,"x","slice3d");return C(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Xs(r,e,t)}const Fh=Bt({slice3d_:D2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N2(i,e,t){const r=ut(i,"x","slice4d");return C(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Xs(r,e,t)}const wm=Bt({slice4d_:N2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F2(i,e=-1){const t=ut(i,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return Et.runKernel(fd,r,s)}const S0=Bt({softmax_:F2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kp(i){C(i.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${i.dtype}.`);const e={input:i};return Et.runKernel(Pr,e)}const Em=Bt({fft_:kp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mv(i){C(i.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${i.dtype}.`);const e={input:i};return Et.runKernel(Xe,e)}const Pd=Bt({ifft_:mv});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gv(i){const e=i.shape[i.shape.length-1],t=i.size/e;let r;if(e<=2){const s=kt(i,[t,e]);r=Pd(s)}else{const s=[t,2*(e-1)],o=kt(Gf(i),[t,e]),l=kt(Hg(i),[t,e]),c=zu(Xs(o,[0,1],[t,e-2]),1),h=St(zu(Xs(l,[0,1],[t,e-2]),1),xs(-1)),p=Jo([o,c],1),f=Jo([l,h],1),g=kt(Qc(p,f),[s[0],s[1]]);r=Pd(g)}if(r=Gf(r),i.rank===3&&i.shape[0]!==0){const s=r,o=i.shape[0];r=kt(r,[o,r.shape[0]/o,r.shape[1]]),s.dispose()}return r}const T0=Bt({irfft_:gv});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M0(i,e,t=0){const r={x:ut(i,"x","split")},s={numOrSizeSplits:e,axis:t};return Et.runKernel(pd,r,s)}const Ho=Bt({split_:M0});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _0(i,e){C(i.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${i.dtype}`);let t=i.shape[i.shape.length-1];const r=i.size/t;let s;if(e!=null&&e<t){const R=i.shape.map(z=>0),P=i.shape.map(z=>z);P[i.shape.length-1]=e,s=Xs(i,R,P),t=e}else if(e!=null&&e>t){const R=i.shape.map(P=>P);R[i.shape.length-1]=e-t,s=Jo([i,eo(R)],i.shape.length-1),t=e}else s=i;const o=ns(s),l=kt(Qc(s,o),[r,t]),c=Em(l),h=Math.floor(t/2)+1,p=Gf(c),f=Hg(c),g=Ho(p,[h,t-h],p.shape.length-1),v=Ho(f,[h,t-h],f.shape.length-1),w=s.shape.slice();return w[s.shape.length-1]=h,kt(Qc(g[0],v[0]),w)}const Av=Bt({rfft_:_0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lp(i,e){let t=ut(i,"a","squaredDifference"),r=ut(e,"b","squaredDifference");[t,r]=Ca(t,r),Ir(t.shape,r.shape);const s={a:t,b:r},o={};return Et.runKernel(hs,s,o)}const Od=Bt({squaredDifference_:Lp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dp(i,e){const t=ut(i,"x","squeeze","string_or_numeric");return kt(t,Y(t.shape,e).newShape)}const eu=Bt({squeeze_:Dp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ph(i,e=0){const t=gp(i,"tensors","stack","string_or_numeric");C(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&C(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return Et.runKernel(sd,r,s)}const Vl=Bt({stack_:Ph});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tu(i,e=0){const t={x:ut(i,"x","step")},r={alpha:e};return Et.runKernel(Uc,t,r)}const nu=Bt({step_:tu});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Im(i,e,t,r,s=0,o=0,l=0,c=0,h=0){const p={x:ut(i,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:r,beginMask:s,endMask:o,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:h};return Et.runKernel(kn,p,f)}const Sm=Bt({stridedSlice_:Im});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R0(i){const e={x:ut(i,"x","tan","float32")};return Et.runKernel(Ll,e)}const Tm=Bt({tan_:R0});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tl(i,e){L(i);const t=Eh(i,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ih(i,null,t,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iu(i,e,t){if(L(i),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Eh(i,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ih(i,e,r,t)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P2(i,e=1,t=!0){const r=ut(i,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},l={k:e,sorted:t},[c,h]=Et.runKernel(Iu,o,l);return{values:c,indices:h}}const vv=Bt({topk_:P2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oh(i,e=0,t=1,r,s){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new b0(e,t,r,!0,s),l=dr(i,r);for(let c=0;c<l.values.length;c++)l.values[c]=o.nextValue();return l.toTensor()}const Gd=Bt({truncatedNormal_:Oh});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O2(i,e=0){const t=ut(i,"x","unique","string_or_numeric");C(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[o,l]=Et.runKernel(Ad,r,s);return{values:o,indices:l}}const G2=Bt({unique_:O2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U2(i,e,t){const r=ut(i,"x","unsortedSegmentSum"),s=ut(e,"segmentIds","unsortedSegmentSum","int32");C(I(t),()=>"numSegments must be of dtype int");const o={x:r,segmentIds:s},l={numSegments:t};return Et.runKernel(Io,o,l)}const yv=Bt({unsortedSegmentSum_:U2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V2(i,e=0){const t=ut(i,"x","unstack","string_or_numeric");C(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return Et.runKernel(oa,r,s)}const Ud=Bt({unstack_:V2});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z2(i,e=!0,t,r){return Et.makeVariable(i,e,t,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bv(i,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const r=dr(i,"int32"),s=dr([t.length,i.length],"int32");for(let o=0;o<t.length;o++){const l=r.indexToLoc(t[o]),c=o*i.length;s.values.set(l,c)}return s.toTensor()}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function W2(i,e){if(e==null)return i.shape.slice();if(S(i.shape,e))return e;if(i.shape.length===e.length){const t=[];for(let r=0;r<i.shape.length;r++)e[r]==null&&i.shape[r]!=null?t.push(i.shape[r]):t.push(e[r]);return t}return e}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H2(i,e,t,r){const s=ut(i,"x","dropout");if(C(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),C(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return i instanceof ua?s.clone():s;const o=W2(s,t),l=1-e,c=rr(qf(Hn(Mp(o,0,1,"float32",r),l)),l);return St(s,c)}const K2=Bt({dropout_:H2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B0(i,e,t,r,s,o="NHWC",l){let c=i;i.rank===3&&(c=kt(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let h=e;h.rank===3&&(h=kt(e,[1,e.shape[0],e.shape[1],e.shape[2]])),C(c.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${c.shape}.`),C(h.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${h.shape}.`),C(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const p=o==="NHWC"?c.shape[3]:c.shape[1],f=o==="NHWC"?h.shape[3]:h.shape[1];C(p===t[2],()=>`Error in conv2dDerFilter: depth of input ${p}) must match input depth in filter (${t[2]}.`),C(f===t[3],()=>`Error in conv2dDerFilter: depth of dy (${f}) must match output depth for filter (${t[3]}).`),Yo("conv2dDerFilter",s,l);const g={x:c,dy:h},v={strides:r,pad:s,dataFormat:o,dimRoundingMode:l,filterShape:t};return Et.runKernel(Oi,g,v)}const k0=Bt({conv2DBackpropFilter_:B0});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wu(i,e,t){if(t==null||t==="linear")return i;if(t==="relu")return St(i,nu(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function L0(i,e){let t=e;const r=Ha(i.shape,e.shape);return r.length>0&&(t=Ji(t,r)),kt(t,i.shape)}function ta(i,e,t,r){if(e==="linear")return i;if(e==="relu")return Vu(i);if(e==="elu")return jf(i);if(e==="relu6")return Rp(i);if(e==="prelu")return lm(i,t);if(e==="leakyrelu")return l0(i,r);if(e==="sigmoid")return xp(i);throw new Error(`Unknown fused activation ${e}.`)}const Vd=(i,e)=>!(i>0)||e==="linear";/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xv({x:i,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:l,bias:c,activation:h="linear",preluActivationWeights:p,leakyreluAlpha:f}){if(h=h||"linear",Vd(Et.state.gradientDepth,h)===!1){C(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let He=Zc(i,e,t,r,s,o,l);return c!=null&&(He=Hn(He,c)),ta(He,h,p,f)}const g=ut(i,"x","conv2d","float32"),v=ut(e,"filter","conv2d","float32");let w=g,R=!1;g.rank===3&&(R=!0,w=kt(g,[1,g.shape[0],g.shape[1],g.shape[2]])),C(w.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${w.rank}.`),C(v.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${v.rank}.`),Yo("fused conv2d",r,l);const P=s==="NHWC"?w.shape[3]:w.shape[1];C(v.shape[2]===P,()=>`Error in conv2d: depth of input (${P}) must match input depth for filter ${v.shape[2]}.`),C(Bo(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const z=xo(w.shape,v.shape,t,o,r,l);let G;c!=null&&(G=ut(c,"bias","fused conv2d"),[G]=Ca(G,g),s==="NHWC"?Ir(z.outShape,G.shape):(C(G.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${G.shape.length}.`),C(G.shape.length===0||G.shape[0]===z.outChannels||G.shape[0]===1,()=>`Error in fused conv2d: bias shape (${G.shape}) is not compatible with the number of output channels (${z.outChannels})`)));let X;if(p!=null){const He=p.shape;if(C(He.length<=1||He.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${He.length}.`),He.length===1)C(He[0]===1||He[0]===z.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${He}) is not compatible with the number of output channels (${z.outChannels}).`);else if(He.length===3)try{Ir(He,z.outShape)}catch{const Je=`Error in fused conv2d: PReLU activation weights (${He}) is not compatible with the output shape of the conv2d (${z.outShape}).`;throw Error(Je)}X=ut(p,"prelu weights","fused conv2d")}const fe=(He,Je)=>{C(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[$e,rt,pt,Gt]=Je,zt=Wu(He,pt,h);C(Td(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const Kt=t0(rt.shape,zt,$e,t,r),tn=k0(rt,zt,$e.shape,t,r),qt=[Kt,tn];if(Gt!=null){const sn=L0(Gt,zt);qt.push(sn)}return qt},ge={x:w,filter:v,bias:G,preluActivationWeights:X},be={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:l,activation:h,leakyreluAlpha:f};return c==null?Ld((He,Je,$e)=>{let rt=Et.runKernel(Tu,ge,be);return $e([Je,He,rt]),R&&(rt=kt(rt,[rt.shape[1],rt.shape[2],rt.shape[3]])),{value:rt,gradFunc:fe}})(w,v):Ld((He,Je,$e,rt)=>{let pt=Et.runKernel(Tu,ge,be);return rt([Je,He,pt,$e]),R&&(pt=kt(pt,[pt.shape[1],pt.shape[2],pt.shape[3]])),{value:pt,gradFunc:fe}})(w,v,G)}const Mm=Bt({fusedConv2d_:xv});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _m(i,e,t,r,s,o=[1,1],l){let c=i;i.rank===3&&(c=kt(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let h=e;h.rank===3&&(h=kt(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const p={x:c,dy:h},f={strides:r,pad:s,dimRoundingMode:l,dilations:o,filterShape:t};return Et.runKernel(st,p,f)}const X2=Bt({depthwiseConv2dNativeBackpropFilter_:_m});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Np(i,e,t,r,s,o=[1,1],l){let c=e,h=!1;e.rank===3&&(h=!0,c=kt(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const p={dy:c,filter:t},f={strides:r,pad:s,dimRoundingMode:l,dilations:o,inputShape:i},g=Et.runKernel(wt,p,f);return h?kt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Q2=Bt({depthwiseConv2dNativeBackpropInput_:Np});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cv({a:i,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:l,leakyreluAlpha:c=.2}){if(Vd(Et.state.gradientDepth,o)===!1){let pt=bs(i,e,t,r);return s!=null&&(pt=Hn(pt,s)),ta(pt,o,l,c)}let h=ut(i,"a","fused matMul"),p=ut(e,"b","fused matMul");[h,p]=Ca(h,p);const f=t?h.shape[h.rank-2]:h.shape[h.rank-1],g=r?p.shape[p.rank-1]:p.shape[p.rank-2],v=t?h.shape[h.rank-1]:h.shape[h.rank-2],w=r?p.shape[p.rank-2]:p.shape[p.rank-1],R=h.shape.slice(0,-2),P=p.shape.slice(0,-2),z=b(R),G=b(P);C(f===g,()=>`Error in fused matMul: inner shapes (${f}) and (${g}) of Tensors with shapes ${h.shape} and ${p.shape} and transposeA=${t} and transposeB=${r} must match.`);const X=Ir(h.shape.slice(0,-2),p.shape.slice(0,-2)).concat([v,w]),fe=t?kt(h,[z,f,v]):kt(h,[z,v,f]),ge=r?kt(p,[G,w,g]):kt(p,[G,g,w]);let be;s!=null&&(be=ut(s,"bias","fused matMul"),[be]=Ca(be,h),Ir(X,be.shape));let He;l!=null&&(He=ut(l,"prelu weights","fused matMul"));const Je=(pt,Gt)=>{const[zt,Kt,tn,qt]=Gt,sn=Wu(kt(pt,tn.shape),tn,o);let xn,dn;if(!t&&!r?(xn=bs(sn,Kt,!1,!0),dn=bs(zt,sn,!0,!1)):!t&&r?(xn=bs(sn,Kt,!1,!1),dn=bs(sn,zt,!0,!1)):t&&!r?(xn=bs(Kt,sn,!1,!0),dn=bs(zt,sn,!1,!1)):(xn=bs(Kt,sn,!0,!0),dn=bs(sn,zt,!0,!0)),s!=null){const Mn=L0(qt,sn);return[xn,dn,Mn]}else return[xn,dn]},$e={a:fe,b:ge,bias:be,preluActivationWeights:He},rt={transposeA:t,transposeB:r,activation:o,leakyreluAlpha:c};return s==null?Ld((pt,Gt,zt)=>{const Kt=Et.runKernel(ec,$e,rt);return zt([pt,Gt,Kt]),{value:kt(Kt,X),gradFunc:Je}})(fe,ge):Ld((pt,Gt,zt,Kt)=>{const tn=Et.runKernel(ec,$e,rt);return Kt([pt,Gt,tn,zt]),{value:kt(tn,X),gradFunc:Je}})(fe,ge,be)}const D0=Bt({fusedMatMul_:Cv});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fp(i,e,t,r,s="bilinear",o=0){const l=ut(i,"image","cropAndResize"),c=ut(e,"boxes","cropAndResize","float32"),h=ut(t,"boxInd","cropAndResize","int32"),p=c.shape[0];C(l.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${l.rank}.`),C(c.rank===2&&c.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${p},4] but had shape ${c.shape}.`),C(h.rank===1&&h.shape[0]===p,()=>`Error in cropAndResize: boxInd must be have size [${p}] but had shape ${c.shape}.`),C(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),C(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),C(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const f={image:l,boxes:c,boxInd:h},g={method:s,extrapolationValue:o,cropSize:r};return Et.runKernel(vr,f,g)}const N0=Bt({cropAndResize_:Fp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z2(i){const e=ut(i,"image","flipLeftRight","float32");C(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Et.runKernel(fa,t,{})}const Sc=Bt({flipLeftRight_:Z2});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wv(i){const e=ut(i,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];C(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),C(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,Ul(e,s)}const Ev=Bt({grayscaleToRGB_:wv});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pp(i,e,t=0,r=.5){const s=ut(i,"image","rotateWithOffset","float32");C(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const o={image:s},l={radians:e,fillValue:t,center:r};return Et.runKernel(Si,o,l)}const $2=Bt({rotateWithOffset_:Pp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zd(i,e,t,r,s,o){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),o==null&&(o=0);const l=i.shape[0];return t=Math.min(t,l),C(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),C(i.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${i.rank}'`),C(i.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${i.shape[1]}`),C(e.rank===1,()=>"scores must be a 1D tensor"),C(e.shape[0]===l,()=>`scores has incompatible shape with boxes. Expected ${l}, but was ${e.shape[0]}`),C(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Op(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const o=ut(i,"boxes","nonMaxSuppression","float32"),l=ut(e,"scores","nonMaxSuppression","float32"),c=zd(o,l,t,r,s);t=c.maxOutputSize,r=c.iouThreshold,s=c.scoreThreshold;const h={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return Et.runKernel($l,{boxes:o,scores:l},h)}const Wd=Bt({nonMaxSuppression_:Op});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gp(i,e,t){const r=Up(i,e,t),s=r<0?-(r+1):r;i.splice(s,0,e)}function Up(i,e,t){return Hd(i,e,t||j2)}function j2(i,e){return i>e?1:i<e?-1:0}function Hd(i,e,t){let r=0,s=i.length,o=0,l=!1;for(;r<s;){o=r+(s-r>>>1);const c=t(e,i[o]);c>0?r=o+1:(s=o,l=!c)}return l?r:-r-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gh(i,e,t,r,s){return zh(i,e,t,r,s,0)}function Uh(i,e,t,r,s,o){return zh(i,e,t,r,s,0,!1,o,!0)}function Vh(i,e,t,r,s,o){return zh(i,e,t,r,s,o,!0)}function zh(i,e,t,r,s,o,l=!1,c=!1,h=!1){const p=[];for(let z=0;z<e.length;z++)e[z]>s&&p.push({score:e[z],boxIndex:z,suppressBeginIndex:0});p.sort(F0);const f=o>0?-.5/o:0,g=[],v=[];for(;g.length<t&&p.length>0;){const z=p.pop(),{score:G,boxIndex:X,suppressBeginIndex:fe}=z;if(G<s)break;let ge=!1;for(let be=g.length-1;be>=fe;--be){const He=Iv(i,X,g[be]);if(He>=r){ge=!0;break}if(z.score=z.score*Sv(r,f,He),z.score<=s)break}z.suppressBeginIndex=g.length,ge||(z.score===G?(g.push(X),v.push(z.score)):z.score>s&&Gp(p,z,F0))}const w=g.length,R=t-w;c&&R>0&&(g.push(...new Array(R).fill(0)),v.push(...new Array(R).fill(0)));const P={selectedIndices:g};return l&&(P.selectedScores=v),h&&(P.validOutputs=w),P}function Iv(i,e,t){const r=i.subarray(e*4,e*4+4),s=i.subarray(t*4,t*4+4),o=Math.min(r[0],r[2]),l=Math.min(r[1],r[3]),c=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),p=Math.min(s[0],s[2]),f=Math.min(s[1],s[3]),g=Math.max(s[0],s[2]),v=Math.max(s[1],s[3]),w=(c-o)*(h-l),R=(g-p)*(v-f);if(w<=0||R<=0)return 0;const P=Math.max(o,p),z=Math.max(l,f),G=Math.min(c,g),X=Math.min(h,v),fe=Math.max(G-P,0)*Math.max(X-z,0);return fe/(w+R-fe)}function Sv(i,e,t){const r=Math.exp(e*t*t);return t<=i?r:0}function F0(i,e){return i.score-e.score||i.score===e.score&&e.boxIndex-i.boxIndex}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function Tv(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const o=ut(i,"boxes","nonMaxSuppressionAsync"),l=ut(e,"scores","nonMaxSuppressionAsync"),c=zd(o,l,t,r,s);t=c.maxOutputSize,r=c.iouThreshold,s=c.scoreThreshold;const h=await Promise.all([o.data(),l.data()]),p=h[0],f=h[1],{selectedIndices:g}=Gh(p,f,t,r,s);return o!==i&&o.dispose(),l!==e&&l.dispose(),tl(g,"int32")}const Mv=Tv;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P0(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const l=ut(i,"boxes","nonMaxSuppression"),c=ut(e,"scores","nonMaxSuppression"),h=zd(l,c,t,r,s,o);t=h.maxOutputSize,r=h.iouThreshold,s=h.scoreThreshold,o=h.softNmsSigma;const p={boxes:l,scores:c},f={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:o},g=Et.runKernel(Js,p,f);return{selectedIndices:g[0],selectedScores:g[1]}}const _v=Bt({nonMaxSuppressionWithScore_:P0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function Rv(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const l=ut(i,"boxes","nonMaxSuppressionAsync"),c=ut(e,"scores","nonMaxSuppressionAsync"),h=zd(l,c,t,r,s,o);t=h.maxOutputSize,r=h.iouThreshold,s=h.scoreThreshold,o=h.softNmsSigma;const p=await Promise.all([l.data(),c.data()]),f=p[0],g=p[1],{selectedIndices:v,selectedScores:w}=Vh(f,g,t,r,s,o);return l!==i&&l.dispose(),c!==e&&c.dispose(),{selectedIndices:tl(v,"int32"),selectedScores:tl(w)}}const Bv=Rv;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kv(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const l=ut(i,"boxes","nonMaxSuppression"),c=ut(e,"scores","nonMaxSuppression"),h=zd(l,c,t,r,s,null),p=h.maxOutputSize,f=h.iouThreshold,g=h.scoreThreshold,v={boxes:l,scores:c},w={maxOutputSize:p,iouThreshold:f,scoreThreshold:g,padToMaxOutputSize:o},R=Et.runKernel(jl,v,w);return{selectedIndices:R[0],validOutputs:R[1]}}const Lv=Bt({nonMaxSuppressionPadded_:kv});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function Dv(i,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const l=ut(i,"boxes","nonMaxSuppressionAsync"),c=ut(e,"scores","nonMaxSuppressionAsync"),h=zd(l,c,t,r,s,null),p=h.maxOutputSize,f=h.iouThreshold,g=h.scoreThreshold,[v,w]=await Promise.all([l.data(),c.data()]),{selectedIndices:R,validOutputs:P}=Uh(v,w,p,f,g,o);return l!==i&&l.dispose(),c!==e&&c.dispose(),{selectedIndices:tl(R,"int32"),validOutputs:xs(P,"int32")}}const Nv=Dv;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zl(i,e,t=!1,r=!1){const s=ut(i,"images","resizeBilinear");C(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),C(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),C(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=s,l=!1;s.rank===3&&(l=!0,o=kt(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const c={images:o},h={alignCorners:t,halfPixelCenters:r,size:e},p=Et.runKernel(io,c,h);return l?kt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Hu=Bt({resizeBilinear_:zl});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O0(i,e,t=!1,r=!1){const s=ut(i,"images","resizeNearestNeighbor");C(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),C(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),C(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),C(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=s,l=!1;s.rank===3&&(l=!0,o=kt(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const c={images:o},h={alignCorners:t,halfPixelCenters:r,size:e},p=Et.runKernel(Cu,c,h);return l?kt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const G0=Bt({resizeNearestNeighbor_:O0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U0(i,e="binary",t=!1,r=.5){const s=ut(i,"image","threshold"),o=.2989,l=.587,c=.114,h=s.shape[0]*s.shape[1];let p=St(tl([r]),255),f,g,v,w;if(C(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),C(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),C(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),C(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[f,g,v]=Ho(s,[1,1,1],-1);const P=St(f,o),z=St(g,l),G=St(v,c);w=Hn(Hn(P,z),G)}else w=i;if(e==="otsu"){const P=Kf(wi(uv(w),"int32"),Vo([]),256);p=V0(P,h)}const R=t?kd(w,p):Cl(w,p);return wi(St(R,255),"int32")}function V0(i,e){let t=tl([-1]),r=tl([0]),s=tl([0]),o,l,c,h,p,f;for(let g=0;g<i.size-1;g++){o=Xs(i,0,g+1),l=Xs(i,g+1),p=rr(Ji(o),e),f=rr(Ji(l),e);const v=Ji(St(o,_p(0,o.size)));c=rr(v,Ji(o));const w=Cp(l.shape,o.size),R=Hn(_p(0,l.size),w),P=St(l,R);h=rr(Ji(P),Ji(l));const z=mr(c,h),G=mr(c,h),X=St(p,f);s=St(St(X,z),G);const fe=Cl(s,r);r=el(fe,s,r),t=el(fe,tl([g]),t)}return t}const Y2=Bt({threshold_:U0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J2(i,e,t="nearest",r="constant",s=0,o){const l=ut(i,"image","transform","float32"),c=ut(e,"transforms","transform","float32");C(l.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${l.rank}.`),C(c.rank===2&&(c.shape[0]===l.shape[0]||c.shape[0]===1)&&c.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),C(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const h={image:l,transforms:c},p={interpolation:t,fillMode:r,fillValue:s,outputShape:o};return Et.runKernel(yh,h,p)}const q2=Bt({transform_:J2});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vp(i,e,t){C(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),C(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`);const r=ut(i,"a","bandPart");C(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[o,l]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(t<=l))throw new Error(`bandPart(): numUpper (${t}) must not be greater than the number of columns (${l}).`);e<0&&(e=o),t<0&&(t=l);const c=kt(_p(0,o,1,"int32"),[-1,1]),h=_p(0,l,1,"int32"),p=mr(c,h),f=jc(kd(p,xs(+e,"int32")),Fu(p,xs(-t,"int32"))),g=eo([o,l],r.dtype);return kt(Vl(Ud(kt(r,[-1,o,l])).map(v=>el(f,v,g))),s)}const Fv=Bt({bandPart_:Vp});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z0(i){let e;if(Array.isArray(i)){e=!1,C(i!=null&&i.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=i[0].shape[0];for(let o=1;o<i.length;++o)C(i[o].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${i[o].shape[0]} vs. ${s})`)}else e=!0,i=Ho(i,i.shape[0],0).map(s=>eu(s,[0]));C(i.length<=i[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${i.length}) exceeds number of dimensions (${i[0].shape[0]}).`);const t=[],r=i;for(let s=0;s<i.length;++s)t.push(Et.tidy(()=>{let o=r[s];if(s>0)for(let l=0;l<s;++l){const c=St(Ji(St(t[l],o)),t[l]);o=mr(o,c)}return rr(o,Yf(o,"euclidean"))}));return e?Vl(t,0):t}const Pv=Bt({gramSchmidt_:z0});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lc(i,e=!1){if(C(i.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${i.rank}`),i.rank===2)return Ku(i,e);{const t=i.shape.slice(0,i.shape.length-2).reduce((h,p)=>h*p),r=Ud(kt(i,[t,i.shape[i.shape.length-2],i.shape[i.shape.length-1]]),0),s=[],o=[];r.forEach(h=>{const[p,f]=Ku(h,e);s.push(p),o.push(f)});const l=kt(Vl(s,0),i.shape),c=kt(Vl(o,0),i.shape);return[l,c]}}function Ku(i,e=!1){return Et.tidy(()=>{C(i.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${i.shape.length}D Tensor.`);const t=i.shape[0],r=i.shape[1];let s=G1(t),o=_h(i);const l=iu([[1]],[1,1]);let c=_h(l);const h=t>=r?r:t;for(let p=0;p<h;++p){const f=o,g=c,v=s;[c,o,s]=Et.tidy(()=>{const w=Xs(o,[p,p],[t-p,1]),R=Yf(w),P=Xs(o,[p,p],[1,1]),z=el(Cl(P,0),iu([[-1]]),iu([[1]])),G=mr(P,St(z,R)),X=rr(w,G);X.shape[0]===1?c=_h(l):c=Jo([l,Xs(X,[1,0],[X.shape[0]-1,X.shape[1]])],0);const fe=La(rr(bs(z,G),R)),ge=Xs(o,[p,0],[t-p,r]),be=St(fe,c),He=Yr(c);if(p===0)o=mr(ge,bs(be,bs(He,ge)));else{const rt=mr(ge,bs(be,bs(He,ge)));o=Jo([Xs(o,[0,0],[p,r]),rt],0)}const Je=Yr(be),$e=Xs(s,[0,p],[t,s.shape[1]-p]);if(p===0)s=mr($e,bs(bs($e,c),Je));else{const rt=mr($e,bs(bs($e,c),Je));s=Jo([Xs(s,[0,0],[t,p]),rt],1)}return[c,o,s]}),Hr([f,g,v])}return!e&&t>r&&(s=Xs(s,[0,0],[t,r]),o=Xs(o,[0,0],[r,r])),[s,o]})}const W0=Bt({qr_:lc});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xu={flipLeftRight:Sc,grayscaleToRGB:Ev,resizeNearestNeighbor:G0,resizeBilinear:Hu,rotateWithOffset:$2,cropAndResize:N0,nonMaxSuppression:Wd,nonMaxSuppressionAsync:Mv,nonMaxSuppressionWithScore:_v,nonMaxSuppressionWithScoreAsync:Bv,nonMaxSuppressionPadded:Lv,nonMaxSuppressionPaddedAsync:Nv,threshold:Y2,transform:q2},Ov={bandPart:Fv,gramSchmidt:Pv,qr:W0};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wl extends Id{minimize(e,t=!1,r){const{value:s,grads:o}=this.computeGradients(e,r);if(r!=null){const l=r.map(c=>({name:c.name,tensor:o[c.name]}));this.applyGradients(l)}else this.applyGradients(o);return Hr(o),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return H1(e,t)}dispose(){this.iterations_!=null&&Hr(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:xs(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(wl,Symbol.hasInstance,{value:i=>i.minimize!=null&&i.computeGradients!=null&&i.applyGradients!=null});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ru extends wl{constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=Et.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Et.registeredVariables[t],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${t}/accum_grad`,variable:Pt(()=>ns(s).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${t}/accum_var`,variable:Pt(()=>ns(s).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[t];if(l==null)return;const c=this.accumulatedGrads[r].variable,h=this.accumulatedUpdates[r].variable;Pt(()=>{const p=Hn(St(c,this.rho),St(Qs(l),1-this.rho)),f=St(rr(ko(Hn(h,this.epsilon)),ko(Hn(c,this.epsilon))),l),g=Hn(St(h,this.rho),St(Qs(f),1-this.rho));c.assign(p),h.assign(g);const v=Hn(St(f,-this.learningRate),s);s.assign(v)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Hr(this.accumulatedGrads.map(e=>e.variable)),Hr(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}ru.className="Adadelta",Nn(ru);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Wh extends wl{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Et.registeredVariables[t];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${t}/accumulator`,variable:Pt(()=>Cp(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[t];if(o==null)return;const l=this.accumulatedGrads[r].variable;Pt(()=>{const c=Hn(l,Qs(o));l.assign(c);const h=Hn(St(rr(o,ko(Hn(c,Et.backend.epsilon()))),-this.learningRate),s);s.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Hr(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}Wh.className="Adagrad",Nn(Wh);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Hh extends wl{constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Pt(()=>{this.accBeta1=xs(t).variable(),this.accBeta2=xs(r).variable()}),s==null&&(this.epsilon=Et.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Pt(()=>{const r=mr(1,this.accBeta1),s=mr(1,this.accBeta2);t.forEach((o,l)=>{const c=Et.registeredVariables[o],h=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${o}/m`,variable:Pt(()=>ns(c).variable(h))}),this.accumulatedSecondMoment[l]==null&&(this.accumulatedSecondMoment[l]={originalName:`${o}/v`,variable:Pt(()=>ns(c).variable(h))});const p=Array.isArray(e)?e[l].tensor:e[o];if(p==null)return;const f=this.accumulatedFirstMoment[l].variable,g=this.accumulatedSecondMoment[l].variable,v=Hn(St(f,this.beta1),St(p,1-this.beta1)),w=Hn(St(g,this.beta2),St(Qs(p),1-this.beta2)),R=rr(v,r),P=rr(w,s);f.assign(v),g.assign(w);const z=Hn(St(rr(R,Hn(ko(P),this.epsilon)),-this.learningRate),c);c.assign(z)}),this.accBeta1.assign(St(this.accBeta1,this.beta1)),this.accBeta2.assign(St(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Hr(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Hr(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),Pt(()=>{this.accBeta1.assign(Bd(this.beta1,this.iterations_+1)),this.accBeta2.assign(Bd(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}Hh.className="Adam",Nn(Hh);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class H0 extends wl{constructor(e,t,r,s=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Pt(()=>{this.iteration=xs(0).variable(),this.accBeta1=xs(t).variable()}),s==null&&(this.epsilon=Et.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Pt(()=>{const r=mr(1,this.accBeta1),s=rr(-this.learningRate,Hn(St(this.iteration,this.decay),1));t.forEach((o,l)=>{const c=Et.registeredVariables[o],h=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${o}/m`,variable:ns(c).variable(h)}),this.accumulatedWeightedInfNorm[l]==null&&(this.accumulatedWeightedInfNorm[l]={originalName:`${o}/v`,variable:ns(c).variable(h)});const p=Array.isArray(e)?e[l].tensor:e[o];if(p==null)return;const f=this.accumulatedFirstMoment[l].variable,g=this.accumulatedWeightedInfNorm[l].variable,v=Hn(St(f,this.beta1),St(p,1-this.beta1)),w=St(g,this.beta2),R=Ro(p),P=Yc(w,R);f.assign(v),g.assign(P);const z=Hn(St(rr(s,r),rr(v,Hn(P,this.epsilon))),c);c.assign(z)}),this.iteration.assign(Hn(this.iteration,1)),this.accBeta1.assign(St(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Hr(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Hr(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}H0.className="Adamax",Nn(H0);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Rm extends wl{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Array.isArray(e)?e[r].tensor:e[t];if(s==null)return;const o=Et.registeredVariables[t];Pt(()=>{const l=Hn(St(this.c,s),o);o.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=bl(xs(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}Rm.className="SGD",Nn(Rm);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class su extends Rm{constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=xs(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Et.registeredVariables[t];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${t}/momentum`,variable:Pt(()=>ns(s).variable(!1))});const o=this.accumulations[r].variable,l=Array.isArray(e)?e[r].tensor:e[t];l!=null&&Pt(()=>{let c;const h=Hn(St(this.m,o),l);this.useNesterov?c=Hn(St(this.c,Hn(l,St(h,this.m))),s):c=Hn(St(this.c,h),s),o.assign(h),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Hr(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}su.className="Momentum",Nn(su);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zp extends wl{constructor(e,t=.9,r=0,s=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,s==null&&(this.epsilon=Et.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Et.registeredVariables[t],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${t}/rms`,variable:Pt(()=>ns(s).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${t}/momentum`,variable:Pt(()=>ns(s).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${t}/mg`,variable:Pt(()=>ns(s).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[t];if(l==null)return;const c=this.accumulatedMeanSquares[r].variable,h=this.accumulatedMoments[r].variable;Pt(()=>{const p=Hn(St(c,this.decay),St(Qs(l),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,g=Hn(St(f,this.decay),St(l,1-this.decay)),v=rr(St(l,this.learningRate),ko(mr(p,Hn(Qs(g),this.epsilon)))),w=Hn(St(h,this.momentum),v);c.assign(p),f.assign(g),h.assign(w);const R=mr(s,w);s.assign(R)}else{const f=Hn(St(c,this.decay),St(Qs(l),1-this.decay)),g=Hn(St(h,this.momentum),rr(St(l,this.learningRate),ko(Hn(f,this.epsilon))));c.assign(f),h.assign(g);const v=mr(s,g);s.assign(v)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Hr(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Hr(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Hr(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}zp.className="RMSProp",Nn(zp);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Qu{static sgd(e){return new Rm(e)}static momentum(e,t,r=!1){return new su(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,o=!1){return new zp(e,t,r,s,o)}static adam(e=.001,t=.9,r=.999,s=null){return new Hh(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new ru(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,o=0){return new H0(e,t,r,s,o)}static adagrad(e,t=.1){return new Wh(e,t)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uo={sgd:Qu.sgd,momentum:Qu.momentum,adadelta:Qu.adadelta,adagrad:Qu.adagrad,rmsprop:Qu.rmsprop,adamax:Qu.adamax,adam:Qu.adam};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const au=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:i=>i())();function Bm(){return new Promise(i=>au(()=>i()))}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cc(i,e){const t=i[0].length;i.forEach((s,o)=>{C(s.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),C(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=i[0];i.forEach((s,o)=>{for(let l=0;l<t;l++)C(l===e||s[l]===r[l],()=>`Error in concat${t}D: Shape of tensors[${o}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${o}.`)})}function Tc(i,e){const t=i[0].slice();for(let r=1;r<i.length;r++)t[e]+=i[r][e];return t}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Wl;(function(i){i[i.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",i[i.VALUE_ROWIDS=1]="VALUE_ROWIDS",i[i.ROW_LENGTHS=2]="ROW_LENGTHS",i[i.ROW_SPLITS=3]="ROW_SPLITS",i[i.ROW_LIMITS=4]="ROW_LIMITS",i[i.ROW_STARTS=5]="ROW_STARTS"})(Wl||(Wl={}));function Kh(i,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<i+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(i+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${i+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const o=t[s],l=r[r.length-t.length+s],c=r[l];if(o>=0)if(c>=0){if(c!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+i}] = ${o} but shape[${s+i}] = ${c}`)}else r[l]=o}return r}function K0(i){const e={FIRST_DIM_SIZE:Wl.FIRST_DIM_SIZE,VALUE_ROWIDS:Wl.VALUE_ROWIDS,ROW_LENGTHS:Wl.ROW_LENGTHS,ROW_SPLITS:Wl.ROW_SPLITS,ROW_LIMITS:Wl.ROW_LIMITS,ROW_STARTS:Wl.ROW_STARTS},t=[];for(const r of i)if(r in e)t.push(e[r]);else break;return t}function X0(i){return i.length===0?0:i[0]===Wl.FIRST_DIM_SIZE?i.length-1:i.length}function Q0(i,e){if(i==null||e==null)return;const t=i.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${i} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const o=i[s],l=e[s+1];if(o>=0&&l>=0&&o!==1&&o!==l)throw new Error(`defaultValue.shape=${i}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-i.length}] = ${o} but ragged tensor input.flatValues.shape[${s-i.length}] = ${l}`)}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mc=30;function Wp(i){return i<=Mc?i:Ve(i,Math.floor(Math.sqrt(i)))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hp(i,e,t){const r=t*(typeof i=="number"?i:i[0]),s=e*(typeof i=="number"?i:i[1]);return[r,s]}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kd(i,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(i[0]/t),s=s.concat(i.slice(1));else{s=s.concat(i[0]);const o=e.length;for(let l=0;l<o;++l)s=s.concat([i[l+1]/e[l],e[l]]);s=s.concat(i.slice(o+1))}return s}function Xd(i,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<i;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],o=[];for(let l=1;l<i;++l)l>=e*2+1||l%2===1?o.push(l):s.push(l);r.push(...s),r.push(0),r.push(...o)}return r}function Xh(i,e,t,r=!0){const s=[];r?s.push(i[0]/t):s.push(i[0]*t);for(let o=1;o<i.length;++o)o<=e.length?r?s.push(e[o-1]*i[o]):s.push(i[o]/e[o-1]):s.push(i[o]);return s}function Z0(i,e){const t=[0];for(let r=0;r<e;++r)t.push(i[r][0]);return t}function km(i,e,t){const r=i.slice(0,1);for(let s=0;s<t;++s)r.push(i[s+1]-e[s][0]-e[s][1]);return r}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kp=1.7580993408473768,Zu=1.0507009873554805;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xp=.3275911,$0=.254829592,Lm=-.284496736,j0=1.421413741,Dm=-1.453152027,Nm=1.061405429;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _c(i,e){if(i.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${i.length}, imag: ${e.length}.`);const t=new Float32Array(i.length*2);for(let r=0;r<t.length;r+=2)t[r]=i[r/2],t[r+1]=e[r/2];return t}function Y0(i){const e=new Float32Array(i.length/2),t=new Float32Array(i.length/2);for(let r=0;r<i.length;r+=2)e[r/2]=i[r],t[r/2]=i[r+1];return{real:e,imag:t}}function Qp(i){const e=Math.ceil(i.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<i.length;s+=4)t[Math.floor(s/4)]=i[s],r[Math.floor(s/4)]=i[s+1];return{real:t,imag:r}}function Zp(i){const e=Math.floor(i.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<i.length;s+=4)t[Math.floor(s/4)]=i[s],r[Math.floor(s/4)]=i[s+1];return{real:t,imag:r}}function $p(i,e){const t=i[e*2],r=i[e*2+1];return{real:t,imag:r}}function J0(i,e,t,r){i[r*2]=e,i[r*2+1]=t}function q0(i,e){const t=new Float32Array(i/2),r=new Float32Array(i/2);for(let s=0;s<Math.ceil(i/2);s++){const o=(e?2:-2)*Math.PI*(s/i);t[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:t,imag:r}}function Gv(i,e,t){const r=(t?2:-2)*Math.PI*(i/e),s=Math.cos(r),o=Math.sin(r);return{real:s,imag:o}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eA="->",Uv=/->/g,tA=",",Vv="...";function Qd(i,e){i=i.replace(/\s/g,"");const t=(i.length-i.replace(Uv,"").length)/eA.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${eA}").`);const[r,s]=i.split(eA);C(r.indexOf(Vv)===-1,()=>`The ellipsis notation ("${Vv}") is not supported yet.`);const o=r.split(tA),l=o.length;if(e!==l)throw new Error(`Expected ${l} input tensors, received ${e}`);if(l>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const c=[];for(let v=0;v<s.length;++v){const w=s[v];if(!o.some(R=>R.indexOf(w)!==-1))throw new Error(`Output subscripts contain the label ${w} not present in the input subscripts.`);c.indexOf(w)===-1&&c.push(w)}for(let v=0;v<r.length;++v){const w=r[v];c.indexOf(w)===-1&&w!==tA&&c.push(w)}const h=new Array(o.length);for(let v=0;v<l;++v){if(new Set(o[v].split("")).size!==o[v].length)throw new Error(`Found duplicate axes in input component ${o[v]}. Support for duplicate axes in input is not implemented yet.`);h[v]=[];for(let w=0;w<o[v].length;++w)h[v].push(c.indexOf(o[v][w]))}const p=c.length,f=s.length,g=[];for(let v=f;v<p;++v)g.push(v);return{allDims:c,summedDims:g,idDims:h}}function jp(i,e){let t=new Array(i);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<i;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function nA(i,e,t){const r=new Array(i);for(let s=0;s<t.length;++s){const o=t[s].shape;for(let l=0;l<e[s].length;++l)r[e[s][l]]===void 0?r[e[s][l]]=o[l]:C(r[e[s][l]]===o[l],()=>`Expected dimension ${r[e[s][l]]} at axis ${l} of input shaped ${JSON.stringify(o)}, but got dimension ${o[l]}`)}}function iA(i,e){const t=i,r=[];let s=0;i.length===0&&t.push(-1),s=i.length+1;for(let l=0;l<s;++l)r.push([]);const o=[];for(let l=0;l<t.length;++l){const c=t[l],h=zv(e,c);for(const p of h)o.indexOf(p)===-1&&(r[l].push(p),o.push(p))}return{path:t,steps:r}}function rA(i){return i.every((e,t)=>e===t)}function zv(i,e){const t=[];for(let r=0;r<i.length;++r)(i[r].length===0||i[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Fm(i,e,t=0){let r=[];if(typeof e=="number")C(i.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(i.shape[t]/e);else{const s=e.reduce((l,c)=>(c===-1&&(l+=1),l),0);C(s<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const l=e.reduce((c,h)=>h>0?c+h:c);e[o]=i.shape[t]-l}C(i.shape[t]===e.reduce((l,c)=>l+c),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ou(i){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${i}`}function sA(i,e){return`indices(${i}, 0) is invalid: ${e} < 0`}function Pm(i,e,t){return`indices(${i}, 0) is invalid: ${e} >= ${t}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Om(i,e){return`only one output dimension may be -1, not both ${i} and ${e}`}function lu(i,e){return`size ${i} must be non-negative, not ${e}`}function Gm(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function aA(i,e){const t=b(i),r=b(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${i} outputShape= ${e}`}function cu(i,e){const t=b(i),r=b(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${i} outputShape=${e}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yp(){return"segment ids must be >= 0"}function Um(){return"segment ids are not increasing"}function uu(i,e){return`Segment id ${i} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Vm(i,e,t){return`Bad: indices[${i}] == ${e} out of range [0, ${t})`}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wv(i,e){let t=!1,r;for(i<=Mc?(r=i,t=!0):r=Ve(i,Math.floor(Math.sqrt(i)));!t;)r>e||r===i?t=!0:r=Ve(i,r+1);return r}function $u(i,e,t){const r=[],s=i.length;for(let o=0;o<s;o++)o!==e?r.push(i[o]):r.push(t);return r}function oA(i,e,t,r){const s=e.shape.length,o=i.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${o}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let g=0;g<r;++g)if(i.shape[g]!==e.shape[g])throw new Error(`x.shape[${g}]: ${i.shape[g]} should be equal to indices.shape[${g}]: ${e.shape[g]}.`);const l=i.shape[t],c=[];let h=1,p=1,f=1;for(let g=0;g<r;++g)c.push(i.shape[g]),h*=i.shape[g];for(let g=r;g<t;g++)c.push(i.shape[g]),p*=i.shape[g];for(let g=r;g<s;g++)c.push(e.shape[g]);for(let g=t+1;g<o;g++)c.push(i.shape[g]),f*=i.shape[g];return{batchSize:h,sliceSize:f,outerSize:p,dimSize:l,outputShape:c}}const eC=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:oA,computeOutShape:$u,segOpComputeOptimalWindowSize:Wv},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rc(i){try{return i.map(e=>Pl(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Jp(i){return i.map(e=>Go(e))}const tC=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:$0,ERF_A2:Lm,ERF_A3:j0,ERF_A4:Dm,ERF_A5:Nm,ERF_P:Xp,PARALLELIZE_THRESHOLD:Mc,get RowPartitionType(){return Wl},SELU_SCALE:Zu,SELU_SCALEALPHA:Kp,applyActivation:ta,assertAndGetBroadcastShape:Ir,assertAxesAreInnerMostDims:co,assertParamsConsistent:cc,assignToTypedArray:J0,axesAreInnerMostDims:s0,calculateShapes:vp,checkEinsumDimSizes:nA,checkPadOnDimRoundingMode:Yo,combineLocations:F1,combineRaggedTensorToTensorShapes:Kh,complexWithEvenIndex:Qp,complexWithOddIndex:Zp,computeConv2DInfo:xo,computeConv3DInfo:Bh,computeDefaultPad:b1,computeDilation2DInfo:Wf,computeOptimalWindowSize:Wp,computeOutAndReduceShapes:Xa,computeOutShape:Tc,computePool2DInfo:ac,computePool3DInfo:Lu,convertConv2DDataFormat:Du,decodeEinsumEquation:Qd,eitherStridesOrDilationsAreOne:Bo,expandShapeToKeepDim:Da,exponent:Gv,exponents:q0,fromStringArrayToUint8:Jp,fromUint8ToStringArray:Rc,getAxesPermutation:ha,getBroadcastDims:ku,getComplexWithIndex:$p,getEinsumComputePath:iA,getEinsumPermutation:jp,getFusedBiasGradient:L0,getFusedDyActivation:Wu,getImageCenter:Hp,getInnerMostAxes:wa,getPermuted:Xd,getRaggedRank:X0,getReductionAxes:Ha,getReshaped:Kd,getReshapedPermuted:Xh,getRowPartitionTypesHelper:K0,getSliceBeginCoords:Z0,getSliceSize:km,getSparseFillEmptyRowsIndicesDenseShapeMismatch:ou,getSparseFillEmptyRowsNegativeIndexErrorMessage:sA,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Pm,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Gm,getSparseReshapeInputOutputMismatchErrorMessage:cu,getSparseReshapeInputOutputMultipleErrorMessage:aA,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Om,getSparseReshapeNegativeOutputDimErrorMessage:lu,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Vm,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Yp,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Um,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:uu,getUndoAxesPermutation:Nu,isIdentityPermutation:rA,log:Rg,mergeRealAndImagArrays:_c,prepareAndValidate:Kg,prepareSplitSize:Fm,segment_util:eC,shouldFuse:Vd,slice_util:jb,splitRealAndImagArrays:Y0,tupleValuesAreOne:Td,upcastType:Uo,validateDefaultValueShape:Q0,validateInput:Kb,validateUpdateShape:l1,warn:Ao},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zm={kernelName:Nt,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,nu(wi(t,"float32"),-1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nC={kernelName:De,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>{const r=Qs(wi(t,"float32")),s=ko(mr(xs(1),r));return La(rr(i,s))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iC={kernelName:Re,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>{const r=ko(mr(Qs(wi(t,"float32")),1));return rr(i,r)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rC={kernelName:We,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{let o=i;const l=Ha(t.shape,s);return l.length>0&&(o=Ji(o,l)),kt(o,t.shape)},b:()=>{let o=i;const l=Ha(r.shape,s);return l.length>0&&(o=Ji(o,l)),kt(o,r.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sC={kernelName:Oe,saveAllInputs:!0,gradFunc:(i,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>i.clone()}),t}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aC={kernelName:vt,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>ns(t)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oC={kernelName:ct,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>ns(t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lC={kernelName:Ct,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,ko(mr(xs(1),Qs(wi(t,"float32")))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cC={kernelName:Yt,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>{const r=ko(Hn(xs(1),Qs(wi(t,"float32"))));return rr(i,r)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fs={kernelName:ae,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{const o=Hn(Qs(t),Qs(r));let l=St(i,rr(r,o));const c=Ha(t.shape,s);return c.length>0&&(l=Ji(l,c)),kt(l,t.shape)},b:()=>{const o=Hn(Qs(t),Qs(r));let l=La(St(i,rr(t,o)));const c=Ha(r.shape,s);return c.length>0&&(l=Ji(l,c)),kt(l,r.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uC={kernelName:me,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,Hn(Qs(wi(t,"float32")),1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hC={kernelName:ee,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,mr(xs(1),Qs(wi(t,"float32"))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dC(i,e,t,r,s,o){const l=ut(i,"dy","avgPool3dGrad"),c=ut(e,"input","avgPool3dGrad");let h=l,p=c,f=!1;c.rank===4&&(f=!0,h=kt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=kt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),C(h.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),C(p.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),Yo("avgPool3dGrad",s,o);const g={dy:h,input:p},v={filterSize:t,strides:r,pad:s,dimRoundingMode:o},w=Et.runKernel(Ft,g,v);return f?kt(w,[w.shape[1],w.shape[2],w.shape[3],w.shape[4]]):w}const pC=Bt({avgPool3dGrad_:dC});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lA={kernelName:ft,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=t;return{x:()=>pC(i,r,s,o,l,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fC(i,e,t,r,s){const o=ut(i,"dy","avgPoolGrad"),l=ut(e,"input","avgPoolGrad");C(l.rank===o.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`);let c=l,h=o,p=!1;l.rank===3&&(p=!0,c=kt(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=kt(o,[1,o.shape[0],o.shape[1],o.shape[2]])),C(h.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${h.rank}.`),C(c.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${c.rank}.`);const f={dy:h,input:c},g={filterSize:t,strides:r,pad:s},v=Et.runKernel(ht,f,g);return p?kt(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const mC=Bt({avgPoolGrad_:fC});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gC={kernelName:Ue,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{filterSize:s,strides:o,pad:l}=t;return{x:()=>mC(i,r,s,o,l)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AC={kernelName:hi,inputsToSave:["a","b"],gradFunc:(i,e,t)=>{const[r,s]=e,{transposeA:o,transposeB:l}=t;return!o&&!l?{a:()=>bs(i,s,!1,!0),b:()=>bs(r,i,!0,!1)}:!o&&l?{a:()=>bs(i,s,!1,!1),b:()=>bs(i,r,!0,!1)}:o&&!l?{a:()=>bs(s,i,!1,!0),b:()=>bs(r,i,!1,!1)}:{a:()=>bs(s,i,!0,!0),b:()=>bs(i,r,!0,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vC={kernelName:bi,gradFunc:(i,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>sm(i,r,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Hv={kernelName:Ai,gradFunc:(i,e,t)=>{const r=t,s=r.inputShape,o=r.shape,l=Array.from(o);for(let h=s.length-1;h>=0;h--)if(s[h]===o[h])l[h]=1;else if(s[h]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${o}].`);const c=[];for(let h=0;h<l.length;h++)l[h]>1&&c.push(h);return{x:()=>Ji(i,c,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cA={kernelName:_s,gradFunc:i=>({x:()=>i.clone()})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yC={kernelName:Fs,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bC={kernelName:Vs,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:o}=t;return{x:()=>el(jc(Fu(r,s),kd(r,o)),i,ns(i))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kv={kernelName:ti,inputsToSave:["x"],gradFunc:zm.gradFunc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xC={kernelName:hn,saveAllInputs:!0,gradFunc:(i,e,t)=>{const r=e.map(c=>c.shape),{axis:s}=t,o=J(s,e[0].shape)[0],l=r.map(c=>c[o]);return Ho(i,l,o).map(c=>()=>c)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xv={kernelName:On,inputsToSave:["x","filter"],gradFunc:(i,e,t)=>{const[r,s]=e,{dilations:o,strides:l,pad:c,dataFormat:h}=t;return C(Td(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>t0(r.shape,i,s,l,c,h),filter:()=>k0(r,i,s.shape,l,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Wm={kernelName:Yn,inputsToSave:["dy","filter"],gradFunc:(i,e,t)=>{const[r,s]=e,{strides:o,pad:l,dataFormat:c,dimRoundingMode:h}=t;return{dy:()=>Zc(i,s,o,l,c,1,h),filter:()=>k0(i,r,s.shape,o,l,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CC(i,e,t,r,s){let o=i;i.rank===4&&(o=kt(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]));let l=e;l.rank===4&&(l=kt(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),C(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),C(l.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${l.shape}.`),C(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),C(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),C(l.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${l.shape[4]}) must match output depth for filter (${t[4]}).`);const c={x:o,dy:l},h={strides:r,pad:s,filterShape:t};return Et.runKernel(nr,c,h)}const Qv=Bt({conv3DBackpropFilter_:CC});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wC={kernelName:Gi,inputsToSave:["x","filter"],gradFunc:(i,e,t)=>{const{dilations:r,strides:s,pad:o}=t;C(Td(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[l,c]=e;return{x:()=>n0(l.shape,i,c,s,o),filter:()=>Qv(l,i,c.shape,s,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ju={kernelName:Xr,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(La(bm(wi(t,"float32"))),i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Hm={kernelName:Fr,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(xm(wi(t,"float32")),i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uA={kernelName:ws,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{axis:s,exclusive:o,reverse:l}=t;return{x:()=>{const c=ha([s],r.rank);let h=Ka(i,s,o,!l);return c!=null&&(h=Yr(h,c)),h}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EC={kernelName:Ge,inputsToSave:["x","filter"],gradFunc:(i,e,t)=>{const{dilations:r,strides:s,pad:o,dimRoundingMode:l}=t,c=r??[1,1];C(Td(c),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${c}'`);const[h,p]=e;return C(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${h.rank}.`),C(p.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${p.rank}.`),C(h.shape[3]===p.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${h.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),C(Bo(s,c),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${c}'.`),Yo("depthwiseConv2d",o,l),{x:()=>Q2(h.shape,i,p,s,o,c,l),filter:()=>X2(h,i,p.shape,s,o,c,l)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zv={kernelName:Xt,inputsToSave:["x","filter"],gradFunc:(i,e,t)=>{const[r,s]=e,o={x:r,filter:s,dy:i},l={x:r,filter:s,dy:i};return{x:()=>Et.runKernel(En,o,t),filter:()=>Et.runKernel(Fn,l,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IC={kernelName:An,outputsToSave:[!0],gradFunc:(i,e)=>{const[t]=e,r={dy:i,y:t};return{x:()=>Et.runKernel(Ui,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SC={kernelName:Hi,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e,r=St($c(La(Qs(t))),2/Math.sqrt(Math.PI));return{x:()=>St(i,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $v={kernelName:us,outputsToSave:[!0],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jv={kernelName:Tr,inputsToSave:["input"],gradFunc:(i,e)=>{const[t]=e;return{input:()=>kt(i,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TC={kernelName:pr,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,$c(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MC={kernelName:di,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _C={kernelName:Cr,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{const o=rr(i,wi(r,"float32")),l=Ha(t.shape,s);return l.length>0?kt(Ji(o,l),t.shape):o},b:()=>{let o=St(i,wi(t,"float32"));const l=Ha(r.shape,s);l.length>0&&(o=kt(Ji(o,l),r.shape));const c=Qs(r);return La(rr(o,wi(c,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yv={kernelName:zs,inputsToSave:["x","mean","variance","scale"],gradFunc:(i,e,t)=>{const{varianceEpsilon:r}=t,[s,o,l,c]=e,h=c??xs(1),p=Ha(o.shape,s.shape),f=[];if(o.rank===1){for(let P=0;P<s.shape.length-1;++P)f.push(s.shape[P]);f.push(1)}const g=mr(s,o),v=St(i,h),w=vm(Hn(l,xs(r))),R=St(St(St(w,w),w),xs(-.5));return{x:()=>o.rank===1?kt(St(St(i,Ul(kt(w,[1,1,1,o.shape[0]]),f)),h),s.shape):kt(St(St(i,w),h),s.shape),mean:()=>{let P=St(St(w,xs(-1)),v);return o.rank===1&&(P=Ji(P,p)),kt(P,o.shape)},variance:()=>{let P=St(St(R,g),v);return o.rank===1&&(P=Ji(P,p)),kt(P,o.shape)},scale:()=>{const P=St(g,w);let z=St(i,P);return o.rank===1&&(z=Ji(z,p)),kt(z,o.shape)},offset:()=>{let P=i;return o.rank===1&&(P=Ji(P,p)),kt(P,o.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Km={kernelName:zr,inputsToSave:["x","indices"],gradFunc:(i,e,t)=>{const[r,s]=e,{axis:o}=t,l=J(o,r.shape)[0];return{x:()=>{const c=r.shape,h=s.size,p=c.slice(0,l),f=p.length,g=c.slice(o,c.length).slice(1),v=g.length,w=hA(0,f),R=hA(f+1,f+1+v),P=Jv([p,[h],g]),z=kt(i,P),G=kt(s,[h]),X=Jv([[f],w,R]),fe=Yr(z,X);let ge=yv(fe,G,r.shape[l]);const be=Nu(X);return ge=Yr(ge,be),ge},indices:()=>s}}};function hA(i,e){const t=[];for(let r=i;r<e;++r)t.push(r);return t}function Jv(i){const e=[];for(let t=0;t<i.length;++t)for(let r=0;r<i[t].length;++r)e.push(i[t][r]);return e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xm={kernelName:Ce,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e;return{a:()=>ns(t),b:()=>ns(r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ea={kernelName:_e,gradFunc:i=>({x:()=>wi(i,"float32")})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RC={kernelName:It,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pa={kernelName:Sn,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qm={kernelName:vn,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BC={kernelName:Lt,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{alpha:s}=t,o=Cl(r,0);return{x:()=>el(o,i,St(i,s))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kC={kernelName:Vi,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,Hn(t,1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LC={kernelName:Ii,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,wi(t,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qv={kernelName:ys,inputsToSave:[],outputsToSave:[!0],gradFunc:(i,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const o=$c(r);return mr(i,St(Ji(i,s,!0),o))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zm(i,e,t,r=5,s=1,o=1,l=.5){const c={x:i,y:e,dy:t},h={depthRadius:r,bias:s,alpha:o,beta:l};return Et.runKernel(gr,c,h)}const dA=Bt({localResponseNormalizationBackprop_:Zm});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DC={kernelName:Qr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,e,t)=>{const[r,s]=e,{depthRadius:o,bias:l,alpha:c,beta:h}=t;return{x:()=>dA(r,s,i,o,l,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ey(i,e,t,r){return e.rank<t.rank&&(e=kt(e,Da(e.shape,r))),i.rank<t.rank&&(i=kt(i,Da(i.shape,r))),{x:()=>St(i,wi(Cc(t,e),i.dtype))}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ty={kernelName:Is,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,e,t)=>{const r=t,{reductionIndices:s}=r,o=e[0],l=e[1],c=J(s,o.shape),h=ey(i,l,o,c);return{x:()=>h.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hu={kernelName:Ys,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e;return{a:()=>St(i,wi(Fu(t,r),"float32")),b:()=>St(i,wi(W1(t,r),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NC(i,e,t,r,s,o,l){const c=ut(i,"dy","maxPool3dGrad"),h=ut(e,"input","maxPool3dGrad"),p=ut(t,"output","maxPool3dGrad");let f=c,g=h,v=p,w=!1;h.rank===4&&(w=!0,f=kt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),g=kt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]]),v=kt(p,[1,p.shape[0],p.shape[1],p.shape[2],p.shape[3]])),C(f.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${f.rank}.`),C(g.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${g.rank}.`),C(v.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${v.rank}.`),Yo("maxPool3dGrad",o,l);const R={dy:f,input:g,output:v},P={filterSize:r,strides:s,pad:o,dimRoundingMode:l},z=Et.runKernel(Bs,R,P);return w?kt(z,[z.shape[1],z.shape[2],z.shape[3],z.shape[4]]):z}const FC=Bt({maxPool3dGrad_:NC});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PC={kernelName:Va,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,e,t)=>{const[r,s]=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=t;return{x:()=>FC(i,r,s,o,l,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OC(i,e,t,r,s,o,l){const c=ut(i,"dy","maxPoolGrad"),h=ut(e,"input","maxPoolGrad"),p=ut(t,"output","maxPoolGrad");C(h.rank===c.rank,()=>`Rank of input (${h.rank}) does not match rank of dy (${c.rank})`),C(c.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),C(h.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${h.rank}.`),Yo("maxPoolGrad",o,l);const f={dy:c,input:h,output:p},g={filterSize:r,strides:s,pad:o,dimRoundingMode:l};return Et.runKernel(Ua,f,g)}const GC=Bt({maxPoolGrad_:OC});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UC={kernelName:Ps,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,e,t)=>{const[r,s]=e,{filterSize:o,strides:l,pad:c}=t;return{x:()=>GC(i,r,s,o,l,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VC={kernelName:Tl,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{axis:s}=t,o=J(s,r.shape),l=Xa(r.shape,o)[1],c=b(l);return{x:()=>{const h=r.shape.slice();o.forEach(f=>{h[f]=1});const p=kt(i,h);return rr(St(p,Nh(r.shape,"float32")),c)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zC={kernelName:Fo,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(i,e,t)=>{const r=t,{axis:s}=r,[o,l]=e,c=J(s,o.shape),h=ey(i,l,o,c);return{x:()=>h.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WC={kernelName:dl,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e;return{a:()=>St(i,wi(kd(t,r),"float32")),b:()=>St(i,wi(Cl(t,r),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HC={kernelName:Ml,inputsToSave:["x"],gradFunc:(i,e,t)=>{const r=e[0],{paddings:s}=t,o=s.map(l=>l[0]);return{x:()=>Xs(i,o,r.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KC={kernelName:pl,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{const o=Ha(t.shape,s);return o.length>0?kt(Ji(i,o),t.shape):i},b:()=>{const o=St(i,La(qf(rr(t,r)))),l=Ha(r.shape,s);return l.length>0?kt(Ji(o,l),r.shape):o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XC={kernelName:fl,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{const o=St(i,wi(r,"float32")),l=Ha(t.shape,s);return l.length>0?kt(Ji(o,l),t.shape):o},b:()=>{const o=St(i,wi(t,"float32")),l=Ha(r.shape,s);return l.length>0?kt(Ji(o,l),r.shape):o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QC={kernelName:_l,gradFunc:i=>({x:()=>La(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZC={kernelName:rd,inputsToSave:["indices"],gradFunc:(i,e)=>{const t=e[0];return{indices:()=>eo(t.shape,"float32")}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $C={kernelName:id,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jC={kernelName:sd,saveAllInputs:!0,gradFunc:(i,e,t)=>{const{axis:r}=t;return Ud(i,r).map(s=>()=>s)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ny={kernelName:oh,inputsToSave:["x"],gradFunc:(i,e,t)=>{const r=e[0],{paddings:s}=t,o=s.map(l=>l[0]);return{x:()=>Xs(i,o,r.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YC={kernelName:Yl,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(i,e)=>{const[t,r,s]=e,o=t,l=r,c=Ir(o.shape,l.shape);return{a:()=>{const h=wi(l,"float32");let p=St(i,St(h,Bd(o,mr(h,xs(1)))));const f=Ha(o.shape,c);return f.length>0&&(p=Ji(p,f)),kt(p,o.shape)},b:()=>{const h=Cl(o,0),p=el(h,Ec(o),ns(o));let f=St(i,St(s,p));const g=Ha(l.shape,c);return g.length>0&&(f=Ji(f,g)),kt(f,l.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JC={kernelName:ad,inputsToSave:["x","alpha"],gradFunc:(i,e)=>{const[t,r]=e,s=Cl(t,0);return{x:()=>el(s,i,St(i,r)),alpha:()=>{let o=el(s,ns(i),St(i,t));const l=Ha(r.shape,i.shape);return l.length>0&&(o=Ji(o,l)),kt(o,r.shape)}}}};/**
* @license
* Copyright 2022 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qC(i,e,t){const r=i.shape.slice();r[t]=1;const s=kt(e,r),o=Zf(i,t,!0,!1),l=Zf(i,t,!0,!0),c=St(o,l);return St(s,c)}function ew(i,e,t){const r=i.shape.length,s=r-t.length,o=ha(t,r);let l=i;o!=null&&(l=Yr(i,o));const c=l.shape.slice(),h=c.splice(r-t.length,t.length).reduce((g,v)=>g*v,1);c.push(h);const p=l.reshape(c);let f=qC(p,e,s);if(f=f.reshape(l.shape),o!=null){const g=Nu(o);f=Yr(f,g)}return f}const tw={kernelName:od,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{axis:s}=t;let o=[];return s==null?o=r.shape.map((l,c)=>c):typeof s=="number"?o=[s]:o=s,{x:()=>ew(r,i,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nw={kernelName:Ci,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{const o=rr(i,wi(r,"float32")),l=Ha(t.shape,s);return l.length>0?kt(Ji(o,l),t.shape):o},b:()=>{let o=St(i,wi(t,"float32"));const l=Ha(r.shape,s);l.length>0&&(o=kt(Ji(o,l),r.shape));const c=Qs(r);return La(rr(o,wi(c,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iw={kernelName:lh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,La(Qs(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rw={kernelName:Eu,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e,r=St(kd(t,6),nu(t));return{x:()=>St(i,wi(r,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sw={kernelName:ch,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,wi(nu(t),"float32"))}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aw={kernelName:ld,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>kt(i,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const x={kernelName:io,inputsToSave:["images"],gradFunc:(i,e,t)=>{const[r]=e,s={dy:i,images:r};return{images:()=>Et.runKernel(za,s,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const n={kernelName:Cu,inputsToSave:["images"],gradFunc:(i,e,t)=>{const[r]=e,s={dy:i,images:r};return{images:()=>Et.runKernel(wu,s,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const a={kernelName:Bl,gradFunc:(i,e,t)=>{const{dims:r}=t,s=J(r,i.shape);return{x:()=>zu(i,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const u={kernelName:Jl,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const d={kernelName:Za,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>La(rr(i,St(Bd(t,1.5),2)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m={kernelName:ud,inputsToSave:["condition"],gradFunc:(i,e)=>{const[t]=e;return{condition:()=>wi(ns(t),"float32"),t:()=>St(i,wi(t,i.dtype)),e:()=>St(i,wi(h0(t),i.dtype))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const A={kernelName:uh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>{const r=Cl(t,xs(0)),s=xs(Kp),o=xs(Zu),l=St(i,o),c=St(St(i,s),$c(wi(t,"float32")));return el(r,l,c)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y={kernelName:fh,outputsToSave:[!0],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,St(t,mr(xs(1),t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const k={kernelName:ph,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const N={kernelName:hh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(Qf(wi(t,"float32")),i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const K={kernelName:dh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i0(wi(t,"float32")),i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $={kernelName:mc,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{begin:s,size:o}=t,l=r.shape,[c,h]=zf(r,s,o),p=[];for(let f=0;f<i.rank;f++)p.push([c[f],l[f]-c[f]-h[f]]);return{x:()=>Ou(i,p)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const j={kernelName:fd,outputsToSave:[!0],gradFunc:(i,e,t)=>{const[r]=e,{dim:s}=t,o=!0,l=St(i,r);return{logits:()=>mr(l,St(Ji(l,[s],o),r))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ne={kernelName:mh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,xp(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const le={kernelName:dd,gradFunc:(i,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>E1(i,r,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const se={kernelName:pd,gradFunc:(i,e,t)=>{const{axis:r}=t;return{x:()=>Jo(i,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const re={kernelName:gh,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,St(ko(wi(t,"float32")),2))}}};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ye={kernelName:dp,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(i,St(wi(t,"float32"),2))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Be={kernelName:hs,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=xs(2);return{a:()=>St(i,St(s,mr(t,r))),b:()=>St(i,St(s,mr(r,t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ee={kernelName:Uc,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Me={kernelName:vh,inputsToSave:["a","b"],gradFunc:(i,e)=>{const[t,r]=e,s=Ir(t.shape,r.shape);return{a:()=>{let o=i;const l=Ha(t.shape,s);return l.length>0&&(o=Ji(o,l)),kt(o,t.shape)},b:()=>{let o=i;const l=Ha(r.shape,s);return l.length>0&&(o=Ji(o,l)),kt(La(o),r.shape)}}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Fe={kernelName:hd,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:o}=t;J(o,r.shape).forEach(h=>{s[h]=1});const l=kt(i,s),c=St(l,Nh(r.shape,"float32"));return{x:()=>c}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const it={kernelName:Ll,inputsToSave:["x"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>rr(i,Qs(Qf(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yt={kernelName:ql,outputsToSave:[!0],gradFunc:(i,e)=>{const[t]=e;return{x:()=>St(mr(xs(1),Qs(t)),i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Le={kernelName:ml,inputsToSave:["x"],gradFunc:(i,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let o=ns(r);if(r.rank===1)for(let l=0;l<s[0];++l)o=Hn(o,Xs(i,[l*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let l=0;l<s[0];++l)for(let c=0;c<s[1];++c)o=Hn(o,Xs(i,[l*r.shape[0],c*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let l=0;l<s[0];++l)for(let c=0;c<s[1];++c)for(let h=0;h<s[2];++h)o=Hn(o,Xs(i,[l*r.shape[0],c*r.shape[1],h*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let l=0;l<s[0];++l)for(let c=0;c<s[1];++c)for(let h=0;h<s[2];++h)for(let p=0;p<s[3];++p)o=Hn(o,Xs(i,[l*r.shape[0],c*r.shape[1],h*r.shape[2],p*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const at={kernelName:ma,gradFunc:(i,e,t)=>{const r=t,{perm:s}=r,o=Nu(s);return{x:()=>Yr(i,o)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mt={kernelName:oa,gradFunc:(i,e,t)=>{const r=t,{axis:s}=r;return{value:()=>Vl(i,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Dt={kernelName:Io,inputsToSave:["segmentIds"],gradFunc:(i,e)=>{const[t]=e;return{x:()=>on(i,t)}}};function on(i,e){const t=Yc(e,ns(e)),r=Dh(i,t);let s=Fu(e,xs(0,"int32"));const o=r.rank-s.rank;for(let c=0;c<o;++c)s=xl(s,c+1);s=jc(s,Nh(r.shape,"bool"));const l=ns(r);return el(s,r,l)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ut={kernelName:Gc,gradFunc:i=>({x:()=>ns(i)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _t=[zm,nC,iC,rC,sC,aC,oC,lC,cC,fs,uC,hC,lA,gC,AC,vC,Hv,cA,yC,bC,Kv,xC,Wm,Xv,wC,ju,Hm,uA,EC,Zv,nw,IC,SC,$v,jv,TC,_C,MC,Yv,Km,Xm,Ea,RC,Pa,Qm,BC,kC,LC,qv,DC,ty,ty,hu,PC,UC,VC,zC,WC,HC,KC,XC,QC,ZC,$C,jC,ny,ny,YC,JC,tw,iw,rw,sw,aw,x,n,a,u,d,m,A,y,k,N,K,$,j,ne,le,le,se,se,re,Be,ye,Ee,Me,Fe,it,yt,Le,at,mt,Dt,Ut];for(const i of _t)Bg(i);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.abs=function(){return this.throwIfDisposed(),Ro(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.acos=function(){return this.throwIfDisposed(),ix(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.acosh=function(){return this.throwIfDisposed(),sx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.add=function(i){return this.throwIfDisposed(),Hn(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.all=function(i,e){return this.throwIfDisposed(),y1(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.any=function(i,e){return this.throwIfDisposed(),jg(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.argMax=function(i){return this.throwIfDisposed(),yp(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.argMin=function(i){return this.throwIfDisposed(),ux(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.asScalar=function(){return this.throwIfDisposed(),C(this.size===1,()=>"The array must have only 1 element."),kt(this,[])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.asType=function(i){return this.throwIfDisposed(),wi(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.as1D=function(){return this.throwIfDisposed(),kt(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.as2D=function(i,e){return this.throwIfDisposed(),kt(this,[i,e])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.as3D=function(i,e,t){return this.throwIfDisposed(),kt(this,[i,e,t])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.as4D=function(i,e,t,r){return this.throwIfDisposed(),kt(this,[i,e,t,r])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.as5D=function(i,e,t,r,s){return this.throwIfDisposed(),kt(this,[i,e,t,r,s])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.asin=function(){return this.throwIfDisposed(),dx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.asinh=function(){return this.throwIfDisposed(),fx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.atan=function(){return this.throwIfDisposed(),gx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.atan2=function(i){return this.throwIfDisposed(),vx(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.atanh=function(){return this.throwIfDisposed(),bx(this)},Vt().prototype.avgPool=function(i,e,t,r){return this.throwIfDisposed(),C1(this,i,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.batchToSpaceND=function(i,e){return this.throwIfDisposed(),E1(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.batchNorm=function(i,e,t,r,s){return this.throwIfDisposed(),qo(this,i,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.broadcastTo=function(i){return this.throwIfDisposed(),kh(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.cast=function(i){return this.throwIfDisposed(),wi(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.ceil=function(){return this.throwIfDisposed(),Jg(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.clipByValue=function(i,e){return this.throwIfDisposed(),Ja(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.concat=function(i,e){return this.throwIfDisposed(),i instanceof ua&&(i=[i]),Jo([this,...i],e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.conv1d=function(i,e,t,r,s,o){return this.throwIfDisposed(),_1(this,i,e,t,r,s,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.conv2dTranspose=function(i,e,t,r,s){return this.throwIfDisposed(),R1(this,i,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.conv2d=function(i,e,t,r,s,o){return this.throwIfDisposed(),Zc(this,i,e,t,r,s,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.cos=function(){return this.throwIfDisposed(),Qf(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.cosh=function(){return this.throwIfDisposed(),i0(this)};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.cumprod=function(i,e,t){return this.throwIfDisposed(),Zf(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.cumsum=function(i,e,t){return this.throwIfDisposed(),Ka(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.depthToSpace=function(i,e){return this.throwIfDisposed(),$f(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.depthwiseConv2d=function(i,e,t,r,s,o){return this.throwIfDisposed(),r0(this,i,e,t,r,s,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.dilation2d=function(i,e,t,r,s){return this.throwIfDisposed(),Px(this,i,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.divNoNan=function(i){return this.throwIfDisposed(),zx(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.div=function(i){return this.throwIfDisposed(),rr(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.dot=function(i){return this.throwIfDisposed(),Hx(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.elu=function(){return this.throwIfDisposed(),jf(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.equal=function(i){return this.throwIfDisposed(),Cc(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.erf=function(){return this.throwIfDisposed(),Qx(this)};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.euclideanNorm=function(i,e){return this.throwIfDisposed(),o0(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.exp=function(){return this.throwIfDisposed(),$c(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.expandDims=function(i){return this.throwIfDisposed(),xl(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.expm1=function(){return this.throwIfDisposed(),i2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.fft=function(){return this.throwIfDisposed(),Em(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.flatten=function(){return this.throwIfDisposed(),kt(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.floor=function(){return this.throwIfDisposed(),qf(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.floorDiv=function(i){return this.throwIfDisposed(),v1(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.gather=function(i,e){return this.throwIfDisposed(),Dh(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.greaterEqual=function(i){return this.throwIfDisposed(),Fu(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.greater=function(i){return this.throwIfDisposed(),Cl(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.ifft=function(){return this.throwIfDisposed(),Pd(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.irfft=function(){return this.throwIfDisposed(),T0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.isFinite=function(){return this.throwIfDisposed(),u2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.isInf=function(){return this.throwIfDisposed(),h2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.isNaN=function(){return this.throwIfDisposed(),d2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.leakyRelu=function(i){return this.throwIfDisposed(),l0(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.lessEqual=function(i){return this.throwIfDisposed(),kd(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.less=function(i){return this.throwIfDisposed(),W1(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.localResponseNormalization=function(i,e,t,r){return this.throwIfDisposed(),A2(this,i,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logSigmoid=function(){return this.throwIfDisposed(),C2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logSoftmax=function(i){return this.throwIfDisposed(),em(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logSumExp=function(i,e){return this.throwIfDisposed(),I2(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.log=function(){return this.throwIfDisposed(),Ec(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.log1p=function(){return this.throwIfDisposed(),c0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logicalAnd=function(i){return this.throwIfDisposed(),jc(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logicalNot=function(){return this.throwIfDisposed(),h0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logicalOr=function(i){return this.throwIfDisposed(),Pu(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.logicalXor=function(i){return this.throwIfDisposed(),X1(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.matMul=function(i,e,t){return this.throwIfDisposed(),bs(this,i,e,t)},Vt().prototype.maxPool=function(i,e,t,r){return this.throwIfDisposed(),p0(this,i,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.max=function(i,e){return this.throwIfDisposed(),wc(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.maximum=function(i){return this.throwIfDisposed(),Yc(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.mean=function(i,e){return this.throwIfDisposed(),Na(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.min=function(i,e){return this.throwIfDisposed(),a0(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.minimum=function(i){return this.throwIfDisposed(),tm(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.mirrorPad=function(i,e){return this.throwIfDisposed(),im(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.mod=function(i){return this.throwIfDisposed(),rm(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.mul=function(i){return this.throwIfDisposed(),St(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.neg=function(){return this.throwIfDisposed(),La(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.norm=function(i,e,t){return this.throwIfDisposed(),Yf(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.notEqual=function(i){return this.throwIfDisposed(),qc(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.oneHot=function(i,e=1,t=0){return this.throwIfDisposed(),a1(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.onesLike=function(){return this.throwIfDisposed(),Co(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.pad=function(i,e){return this.throwIfDisposed(),Ou(this,i,e)},Vt().prototype.pool=function(i,e,t,r,s,o){return this.throwIfDisposed(),Y1(this,i,e,t,r,s,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.pow=function(i){return this.throwIfDisposed(),Bd(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.prelu=function(i){return this.throwIfDisposed(),lm(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.prod=function(i,e){return this.throwIfDisposed(),cm(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.reciprocal=function(){return this.throwIfDisposed(),lv(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.relu=function(){return this.throwIfDisposed(),Vu(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.relu6=function(){return this.throwIfDisposed(),Rp(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.reshapeAs=function(i){return this.throwIfDisposed(),kt(this,i.shape)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.reshape=function(i){return this.throwIfDisposed(),kt(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.resizeBilinear=function(i,e,t){return this.throwIfDisposed(),Hu(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.resizeNearestNeighbor=function(i,e,t){return this.throwIfDisposed(),G0(this,i,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.reverse=function(i){return this.throwIfDisposed(),zu(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.rfft=function(){return this.throwIfDisposed(),Av(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.round=function(){return this.throwIfDisposed(),uv(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.rsqrt=function(){return this.throwIfDisposed(),vm(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.selu=function(){return this.throwIfDisposed(),hv(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.separableConv2d=function(i,e,t,r,s,o){return this.throwIfDisposed(),Bp(this,i,e,t,r,s,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sigmoid=function(){return this.throwIfDisposed(),xp(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sign=function(){return this.throwIfDisposed(),E0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sin=function(){return this.throwIfDisposed(),bm(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sinh=function(){return this.throwIfDisposed(),xm(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.slice=function(i,e){return this.throwIfDisposed(),Xs(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.softmax=function(i){return this.throwIfDisposed(),S0(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.softplus=function(){return this.throwIfDisposed(),wp(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.spaceToBatchND=function(i,e){return this.throwIfDisposed(),sm(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.split=function(i,e){return this.throwIfDisposed(),Ho(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sqrt=function(){return this.throwIfDisposed(),ko(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.square=function(){return this.throwIfDisposed(),Qs(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.squaredDifference=function(i){return this.throwIfDisposed(),Od(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.squeeze=function(i){return this.throwIfDisposed(),eu(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.stack=function(i,e){this.throwIfDisposed();const t=i instanceof ua?[this,i]:[this,...i];return Vl(t,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.step=function(i){return this.throwIfDisposed(),nu(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.stridedSlice=function(i,e,t,r,s,o,l,c){return this.throwIfDisposed(),Sm(this,i,e,t,r,s,o,l,c)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sub=function(i){return this.throwIfDisposed(),mr(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.sum=function(i,e){return this.throwIfDisposed(),Ji(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.tan=function(){return this.throwIfDisposed(),Tm(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.tanh=function(){return this.throwIfDisposed(),w1(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.tile=function(i){return this.throwIfDisposed(),Ul(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.toBool=function(){return this.throwIfDisposed(),wi(this,"bool")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.toFloat=function(){return this.throwIfDisposed(),wi(this,"float32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.toInt=function(){return this.throwIfDisposed(),wi(this,"int32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.topk=function(i,e){return this.throwIfDisposed(),vv(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.transpose=function(i){return this.throwIfDisposed(),Yr(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.unique=function(i){return this.throwIfDisposed(),G2(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.unsortedSegmentSum=function(i,e){return this.throwIfDisposed(),yv(this,i,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.unstack=function(i){return this.throwIfDisposed(),Ud(this,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.where=function(i,e){return this.throwIfDisposed(),el(i,this,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Vt().prototype.zerosLike=function(){return this.throwIfDisposed(),ns(this)};/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Qt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qt.prototype)}}class bn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bn.prototype)}}class je extends Error{constructor(e){super(e),Object.setPrototypeOf(this,je.prototype)}}class Zt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zt.prototype)}}class Qn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qn.prototype)}}/**
* @license
* Copyright 2022 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Kn{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function xi(i,e){if(Array.isArray(i)){let t=[];for(let r=0;r<e;r++)t=t.concat(i);return t}else{const t=new Array(e);return t.fill(i),t}}function li(i,e){if(!i)throw new Qn(e)}function pn(i,e){let t=0;for(const r of i)r===e&&t++;return t}function Rn(i){return i.length===1?i[0]:i}function Vn(i){return Array.isArray(i)?i:[i]}function Jt(i){const e=i.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ei(i){return i.length<=1||i.indexOf("_")===-1?i:i.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ii={};function tr(i){if(i==null)return null;const e={};return e.className=i.getClassName(),e.config=i.getConfig(),e}function ni(i){if(!(i==null||typeof i!="object"))if(Array.isArray(i))i.forEach(e=>ni(e));else{const e=Object.keys(i);for(const t of e){const r=i[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?i[t]=r.value:ni(r))}}}function Mr(i,e={},t={},r="object",s=!1){if(typeof i=="string"){const o=i;let l;if(o in t)l=t[o];else if(o in ii)l=ii[o];else if(l=e[o],l==null)throw new je(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return l}else{const o=i;if(o.className==null||o.config==null)throw new je(`${r}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const l=o.className;let c,h;if(l in t?[c,h]=t[l]:l in ii?[c,h]=ii.className:l in e&&([c,h]=e[l]),c==null)throw new je(`Unknown ${r}: ${l}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(h!=null){const p={};for(const w of Object.keys(ii))p[w]=ii[w];for(const w of Object.keys(t))p[w]=t[w];const f=o.config;f.customObjects=p;const g=Object.assign({},ii);for(const w of Object.keys(t))ii[w]=t[w];ni(o.config);const v=h(c,o.config,t,s);return ii=Object.assign({},g),v}else{const p=Object.assign({},ii);for(const g of Object.keys(t))ii[g]=t[g];const f=new c(o.config);return ii=Object.assign({},p),f}}}function Ln(i,e){return i<e?-1:i>e?1:0}function Tn(i,e){return-1*Ln(i,e)}function qn(i){if(i==null)return i;const e=[];for(const t of i)e.indexOf(t)===-1&&e.push(t);return e}function $i(i){if(i==null)throw new je(`Invalid value in obj: ${JSON.stringify(i)}`);for(const e in i)if(i.hasOwnProperty(e))return!1;return!0}function mi(i,e,t){if(t!=null&&i.indexOf(t)<0)throw new je(`${t} is not a valid ${e}.  Valid values are ${i} or null/undefined.`)}function wr(i,e,t=0,r=1/0){return li(t>=0),li(r>=t),Array.isArray(i)&&i.length>=t&&i.length<=r&&i.every(s=>typeof s===e)}function ki(i,e){Array.isArray(i)?(C(i.length>0,()=>`${e} is unexpectedly an empty array.`),i.forEach((t,r)=>ki(t,`element ${r+1} of ${e}`))):C(Number.isInteger(i)&&i>0,()=>`Expected ${e} to be a positive integer, but got ${sr(i)}.`)}function sr(i){return i===null?"null":Array.isArray(i)?"["+i.map(e=>sr(e)).join(",")+"]":typeof i=="string"?`"${i}"`:`${i}`}function Os(i,e,t){let r=t!=null?t():ao(),s;return(...o)=>{const l=t!=null?t():ao();return l-r<e||(r=l,s=i(...o)),s}}function Ts(i){return i==="relu"?"relu":i==="linear"?"linear":i==="elu"?"elu":null}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let ot=0;function Ze(){return ot++}const ln={};function Xn(i=""){return i in ln||(ln[i]=0),ln[i]+=1,i+ln[i].toString()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const oi=["channelsFirst","channelsLast"],Mi=["nearest","bilinear"],Sr=["valid","same","causal"],_i=["max","avg"],_n=["sum","mul","concat","ave"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const ji=new Map;function Bi(i){mi(oi,"DataFormat",i)}function Ki(i){mi(Mi,"InterpolationFormat",i)}function zi(i){mi(Sr,"PaddingMode",i)}function ar(i){mi(_i,"PoolMode",i)}const Jr=[],na="/";function da(i,e){Jr.push(i);try{const t=e();return Jr.pop(),t}catch(t){throw Jr.pop(),t}}function Mt(){return Jr.length===0?"":Jr.join(na)+na}function Cn(i){if(!qi(i))throw new Error("Not a valid tensor name: '"+i+"'");return Mt()+i}function Zn(i){if(!qi(i))throw new Error("Not a valid tensor name: '"+i+"'");ji.has(i)||ji.set(i,0);const e=ji.get(i);if(ji.set(i,ji.get(i)+1),e>0){const t=`${i}_${e}`;return ji.set(t,1),t}else return i}const Li=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function qi(i){return!!i.match(Li)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Ms(i){return i===parseInt(i.toString(),10)}function ia(i,e,t){e==null&&(e=0),t==null&&(t=i.length);let r=1;for(let s=e;s<t;++s)r*=i[s];return r}function Oa(i){if(i.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<i.length;t++){const r=i[t];r<e&&(e=r)}return e}function nl(i){if(i.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<i.length;t++){const r=i[t];r>e&&(e=r)}return e}function os(i,e){if(e<i)throw new je(`end (${e}) < begin (${i}) is forbidden.`);const t=[];for(let r=i;r<e;++r)t.push(r);return t}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let uc;function Es(){return uc==null&&(uc=Bu().epsilon()),uc}function Hl(){return"channelsLast"}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function qp(i,e){return wi(i,e)}function ef(i,e=-1){const t=i.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),kt(i,t)}function ow(i,e){return Pt(()=>{if(i.shape.length!==2)throw new je(`repeat() expects a rank-2 tensor, but received a rank-${i.shape.length} tensor.`);const t=ef(i,1);return Ur(t,[1,e,1])})}function qe(i){const e=[ia(i.shape)];return kt(i,e)}function jt(i){if(i.rank<=1)throw new je(`batchFlatten requires a minimum rank of 2. Got rank: ${i.rank}.`);const e=[i.shape[0],ia(i.shape,1)];return kt(i,e)}function un(i,e,t){return Pt(()=>{switch(i.rank){case 1:return Cm(i,e,t);case 2:return fv(i,[e,0],[t,i.shape[1]]);case 3:return Fh(i,[e,0,0],[t,i.shape[1],i.shape[2]]);case 4:return wm(i,[e,0,0,0],[t,i.shape[1],i.shape[2],i.shape[3]]);case 5:return Xs(i,[e,0,0,0,0],[t,i.shape[1],i.shape[2],i.shape[3],i.shape[4]]);case 6:return Xs(i,[e,0,0,0,0,0],[t,i.shape[1],i.shape[2],i.shape[3],i.shape[4],i.shape[5]]);default:throw new je(`sliceAlongFirstAxis() received an unsupported tensor rank: ${i.rank}`)}})}function Ht(i,e,t){return Pt(()=>{switch(i.rank){case 1:return Cm(i,e,t);case 2:return fv(i,[0,e],[i.shape[0],t]);case 3:return Fh(i,[0,0,e],[i.shape[0],i.shape[1],t]);case 4:return wm(i,[0,0,0,e],[i.shape[0],i.shape[1],i.shape[2],t]);default:throw new je(`sliceAlongLastAxis() received an unsupported tensor rank: ${i.rank}`)}})}function In(i,e,t,r){return Pt(()=>{switch(i.rank){case 1:return Cm(i,e,t);case 2:switch(r){case 1:return un(i,e,t);case 2:return Ht(i,e,t);default:throw new je(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return un(i,e,t);case 2:return Fh(i,[0,e,0],[i.shape[0],t,i.shape[2]]);case 3:return Ht(i,e,t);default:throw new je(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return un(i,e,t);case 2:return wm(i,[0,e,0,0],[i.shape[0],t,i.shape[2],i.shape[3]]);case 3:return wm(i,[0,0,e,0],[i.shape[0],i.shape[1],t,i.shape[3]]);case 4:return Ht(i,e,t);default:throw new je(`The axis is not within the rank of the tensor ${r}`)}default:throw new je(`sliceAlongLastAxis() received an unsupported tensor rank: ${i.rank}`)}})}function or(i,e=-1){let t;return e<0&&(t=i[0].rank,t!==0?e=t:e=0),e===i[0].rank&&(e=-1),Jo(i,e)}function _r(i,e){switch(i.rank){case 1:return I1([i,e]);case 2:return Tx([i,e],0);case 3:return Xf([i,e],0);case 4:return T1([i,e],0);default:throw new je(`concatAlongFirstAxis() received an unsupported tensor rank: ${i.rank}`)}}function Ur(i,e){if(Array.isArray(e)||(e=[e]),i.rank!==e.length)throw new je(`The length of input n (${e.length}) does not match the number of dimensions in input x (${i.rank})`);return Ul(i,e)}function Vr(i,e=0,t=1,r,s){return gm(i,e,t,r,s)}function Nr(i,e,t,r){if(i.rank<2||e.rank<2)throw new Zt(`dot requires both inputs to be rank >= 2 but got x shape = ${i.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=i.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(s!==o)throw new Zt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${i.shape} and  y shape = ${e.shape}`)}if(i.rank===2&&e.rank===2)return D0({a:i,b:e,transposeA:!1,transposeB:!1,bias:r?Ia(i.rank,r,Hl()):null,activation:t});{const s=i.shape.slice(),o=s.pop();i=kt(i,[-1,o]);const l=e.shape.slice(),c=l.pop(),h=l.pop(),p=[...l,c],f=Array.from({length:e.rank},(v,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=kt(Yr(e,f),[h,-1]);const g=[...s,...p];return kt(D0({a:i,b:e,transposeA:!1,transposeB:!1,bias:r?Ia(i.rank,r,Hl()):null,activation:t}),g)}}function is(i,e,t){return Pt(()=>(Array.isArray(e)?e=tl(e,"int32"):e=wi(e,"int32"),Dh(i,e,t)))}function Zr(i){return St(i,i)}function Ia(i,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==i)throw new je(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${i}`);if(i===5){if(t==="channelsFirst")return r.length===1?kt(e,[1,r[0],1,1,1]):kt(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?kt(e,[1,1,1,1,r[0]]):kt(e,[1].concat(r))}else if(i===4){if(t==="channelsFirst")return r.length===1?kt(e,[1,r[0],1,1]):kt(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?kt(e,[1,1,1,r[0]]):kt(e,[1].concat(r))}else if(i===3){if(t==="channelsFirst")return r.length===1?kt(e,[1,r[0],1]):kt(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?kt(e,[1,1,r[0]]):kt(e,[1].concat(r))}else if(i<3)return e;throw new je(`Unsupported input rank by biasAdd: ${e.rank}`)}function Aa(i,e,t){return Pt(()=>(t==null&&(t=Hl()),Bi(t),Hn(i,Ia(i.rank,e,t))))}function du(i,e=1){if(e!==1)throw new Zt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return jf(i)}function Qh(i){return Pt(()=>rr(i,Hn(Ro(i),1)))}function Ga(i,e,t,r){return Pt(()=>K2(i,e,t,r))}function ls(i){return Pt(()=>{const e=Hn(.5,St(.2,i));return Ja(e,0,1)})}function Zh(i,e,t=!1){return t?i():e()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const ho=["fanIn","fanOut","fanAvg"],$h=["normal","uniform","truncatedNormal"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function iy(i){mi(ho,"FanMode",i)}function tf(i){mi($h,"Distribution",i)}class il extends Id{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Lo extends il{apply(e,t){return eo(e,t)}}Lo.className="Zeros",Nn(Lo);class pu extends il{apply(e,t){return Nh(e,t)}}pu.className="Ones",Nn(pu);class $m extends il{constructor(e){if(super(),typeof e!="object")throw new je(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new je(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return Pt(()=>St(xs(this.value),Nh(e,t)))}getConfig(){return{value:this.value}}}$m.className="Constant",Nn($m);class rl extends il{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Mp(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}rl.className="RandomUniform",Nn(rl);class jm extends il{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Zt(`randomNormal does not support dType ${t}.`);return Vr(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}jm.className="RandomNormal",Nn(jm);class ry extends il{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Zt(`truncatedNormal does not support dType ${t}.`);return Gd(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}ry.className="TruncatedNormal",Nn(ry);class pA extends il{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return Pt(()=>{if(e.length!==2||e[0]!==e[1])throw new je("Identity matrix initializer can only be used for 2D square matrices.");return St(this.gain,G1(e[0]))})}getConfig(){return{gain:this.gain}}}pA.className="Identity",Nn(pA);function RR(i,e="channelsLast"){let t,r;if(Bi(e),i.length===2)t=i[0],r=i[1];else if([3,4,5].indexOf(i.length)!==-1){if(e==="channelsFirst"){const s=ia(i,2);t=i[1]*s,r=i[0]*s}else if(e==="channelsLast"){const s=ia(i,0,i.length-2);t=i[i.length-2]*s,r=i[i.length-1]*s}}else{const s=ia(i);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class Kl extends il{constructor(e){if(super(),e.scale<0)throw new je(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,iy(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,tf(this.distribution),this.seed=e.seed}apply(e,t){const r=RR(e),s=r[0],o=r[1];let l=this.scale;if(this.mode==="fanIn"?l/=Math.max(1,s):this.mode==="fanOut"?l/=Math.max(1,o):l/=Math.max(1,(s+o)/2),this.distribution==="normal"){const c=Math.sqrt(l);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Zt(`${this.getClassName()} does not support dType ${t}.`);return Gd(e,0,c,t,this.seed)}else{const c=Math.sqrt(3*l);return Mp(e,-c,c,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Kl.className="VarianceScaling",Nn(Kl);class lw extends Kl{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}lw.className="GlorotUniform",Nn(lw);class cw extends Kl{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}cw.className="GlorotNormal",Nn(cw);class uw extends Kl{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}uw.className="HeNormal",Nn(uw);class hw extends Kl{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}hw.className="HeUniform",Nn(hw);class dw extends Kl{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}dw.className="LeCunNormal",Nn(dw);class pw extends Kl{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Kl.className}}pw.className="LeCunNormal",Nn(pw);class TI extends il{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Zt("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return Pt(()=>{if(e.length<2)throw new Zt("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const r=e[0]>e[1]?[e[1],e[0]]:e,s=Vr(r,0,1,"float32");let o=Ov.gramSchmidt(s);return e[0]>e[1]&&(o=Yr(o)),St(this.gain,o)})}getConfig(){return{gain:this.gain,seed:this.seed}}}TI.className="Orthogonal",Nn(TI);const MI={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function _I(i,e={}){return Mr(i,Gl.getMap().classNameMap,e,"initializer")}function Sa(i){return tr(i)}function va(i){if(typeof i=="string"){const e=i in MI?MI[i]:i;if(e==="GlorotNormal")return new cw;if(e==="GlorotUniform")return new lw;if(e==="HeNormal")return new uw;if(e==="HeUniform")return new hw;if(e==="LeCunNormal")return new dw;if(e==="LeCunUniform")return new pw;{const t={};return t.className=e,t.config={},_I(t)}}else return i instanceof il?i:_I(i)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function fw(i){return Array.isArray(i)&&Array.isArray(i[0])}function sy(i){return i.length===0?[]:Array.isArray(i[0])?i:[i]}function kr(i){let e;if(Array.isArray(i)){if(i.length!==1)throw new je(`Expected Tensor length to be 1; got ${i.length}`);e=i[0]}else e=i;return e}function Ds(i){if(Array.isArray(i)&&Array.isArray(i[0])){if(i.length===1)return i=i,i[0];throw new je(`Expected exactly 1 Shape; got ${i.length}`)}else return i}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ay(i){let e=0;for(const t of i)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const RI="Variable";class BR{constructor(e,t="float32",r=RI,s=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=Ze(),r=r??RI,this.originalName=Cn(r),this.name=Zn(this.originalName),this.trainable_=s,this.constraint=o,this.val=z2(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),kR(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function kR(i,e){if(i.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(i.shape)+" vs. "+JSON.stringify(e.shape))}function mw(i){return i.map(e=>e.read())}function gw(i){i.forEach(e=>{e[0].write(e[1])})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class po{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Yu{constructor(e,t,r,s,o,l,c){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=o,this.outputTensorIndex=c,this.id=Ze(),l!=null&&(this.originalName=Cn(l),this.name=Zn(this.originalName)),this.rank=t.length}}let LR=0;class oy{constructor(e,t){this.callArgs=t,this.id=LR++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let DR=0;class cs extends Id{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=DR++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=Jt(r)+"_"+Xn(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),r=[o].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new bn(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new je(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Rn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Rn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Qt(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Qt(`Layer ${this.name} is not connected, no input to return.`);return Rn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Qt(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Qt(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Rn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=Vn(e),this.inputSpec==null||this.inputSpec.length===0)return;const t=Vn(this.inputSpec);if(e.length!==t.length)throw new je(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let r=0;r<e.length;r++){const s=e[r],o=t[r];if(o==null)continue;const l=s.rank;if(o.ndim!=null&&l!==o.ndim)throw new je(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${l}`);if(o.maxNDim!=null&&l>o.maxNDim)throw new je(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${l}`);if(o.minNDim!=null&&l<o.minNDim)throw new je(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${l}.`);if(o.dtype!=null&&s.dtype!==o.dtype)throw new je(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${s.dtype}.`);if(o.axes){const c=s.shape;for(const h in o.axes){const p=Number(h),f=o.axes[h],g=p>=0?c[p]:c[c.length+p];if(f!=null&&[f,null].indexOf(g)===-1)throw new je(`Input ${r} is incompatible with layer ${this.name}: expected axis ${p} of input shape to have value ${f} but got shape ${c}.`)}}if(o.shape!=null)for(let c=0;c<o.shape.length;++c){const h=o.shape[c],p=s.shape[c];if(h!=null&&p!=null&&h!==p)throw new je(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${s.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=Vn(e);let s=!0;for(const l of r)if(!(l instanceof Yu)){s=!1;break}let o=!0;for(const l of r)if(l instanceof Yu){o=!1;break}if(s===o)throw new je("Arguments to apply() must be all SymbolicTensors or all Tensors");return da(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const l=[];for(const c of Vn(e))l.push(c.shape);this.build(Rn(l)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let l=this.call(e,t);const c=Vn(l),h=[];for(let p of c)r.indexOf(p)!==-1&&(p=p.clone()),h.push(p);if(l=Rn(h),this.activityRegularizer!=null)throw new Zt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}else{const l=NR(e),c=this.computeOutputShape(l);let h;const p=FR(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?l[0]:l),c!=null&&c.length>0&&Array.isArray(c[0])?h=c.map((f,g)=>new Yu(p,f,this,Vn(e),t,this.name,g)):h=new Yu(p,c,this,Vn(e),t,this.name),this.addInboundNode(e,h,null,null,l,c,t),this._refCount++,this.activityRegularizer!=null)throw new Zt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return h}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Qt(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Qt(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new bn(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return ay(this.weights)}build(e){this.built=!0}getWeights(e=!1){return mw(e?this.trainableWeights:this.weights)}setWeights(e){Pt(()=>{const t=this.weights;if(t.length!==e.length)throw new je(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=mw(t);for(let o=0;o<s.length;++o){const l=s[o],c=t[o],h=e[o];if(!S(l.shape,h.shape))throw new je(`Layer weight shape ${l.shape} not compatible with provided weight shape ${h.shape}`);r.push([c,h])}gw(r)})}addWeight(e,t,r,s,o,l,c,h){if(this._addedWeightNames.indexOf(e)!==-1)throw new je(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=h!=null?h():va("zeros"));const p=s.apply(t,r),f=new BR(p,r,e,l,c);return p.dispose(),o!=null&&this.addLoss(()=>o.apply(f.read())),l==null&&(l=!0),l?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Vn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}addInboundNode(e,t,r,s,o,l,c=null){const h=Vn(e);t=Vn(t),r=Vn(r),s=Vn(s),o=sy(o),l=sy(l);const p=[],f=[],g=[];for(const v of h)p.push(v.sourceLayer),f.push(v.nodeIndex),g.push(v.tensorIndex);new oy({outboundLayer:this,inboundLayers:p,nodeIndices:f,tensorIndices:g,inputTensors:h,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:o,outputShapes:l},c);for(let v=0;v<t.length;v++)t[v].sourceLayer=this,t[v].nodeIndex=this.inboundNodes.length-1,t[v].tensorIndex=v}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function NR(i){i=Vn(i);const e=[];for(const t of i)e.push(t.shape);return Rn(e)}function FR(i){return"float32"}function BI(i,e,t){if((e==null||t!=null&&t>0)&&(e=i.sourceLayer,t=i.nodeIndex),e.inboundNodes.length===0)return[i];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let o=0;o<r.inboundLayers.length;o++){const l=r.inputTensors[o],c=r.inboundLayers[o],h=r.nodeIndices[o],p=BI(l,c,h);for(const f of p)s.indexOf(f)===-1&&s.push(f)}return s}}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class fA extends cs{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Xn("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new je("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new je("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new je("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new Yu(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new oy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new je(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}fA.className="InputLayer",Nn(fA);function PR(i){if(i.batchShape==null&&i.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(i.batchShape!=null&&i.shape!=null)throw new je("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=i.batchShape;i.shape!=null&&e==null&&(e=[null].concat(i.shape));let t=i.dtype;return t==null&&(t="float32"),new fA({batchInputShape:e,name:i.name,dtype:t,sparse:i.sparse}).inboundNodes[0].outputTensors[0]}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function OR(i,e){if(i.dtype==null||i.dtype===e.dtype)return e;try{return wi(e,i.dtype)}catch{throw new je(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${i.name}' (${i.dtype}).`)}}class Zd{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Zd)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=OR(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new je(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Yu){if(this.id2Value[e.id]==null)throw new je(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new je(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Yu){if(this.id2Value[e.id]==null)throw new je(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new je(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Hr(this.id2Mask)}}const ly=new Kn,cy=new Kn;function GR(i){ly!=null&&ly.setMaxEntries(i),cy!=null&&cy.setMaxEntries(i)}function mA(i,e,t,r){const s=t==null?!1:t.training,o=Array.isArray(i),l=o?i:[i],c=l.map(R=>R.name),h=[],p=e.names();for(const R of c)p.indexOf(R)!==-1?h.push(e.getValue(R)):h.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const f=c.join(",")+"|"+e.names().sort().join(",");let g=ly.get(f),v;if(g==null){const R=UR(l,e);g=R.sorted,v=R.recipientCounts,ly.put(f,g),cy.put(f,v)}v={},s||Object.assign(v,cy.get(f));const w=new Zd(e);for(let R=0;R<g.length;++R){if(r!=null){const rt=Of().numTensors;rt>r.maxNumTensors&&(r.maxNumTensors=rt),rt<r.minNumTensors&&(r.minNumTensors=rt)}const P=g[R],z=P.sourceLayer;if(z instanceof fA)continue;const G=[],X=[],fe=[];let ge=!1;for(const rt of P.inputs){const pt=w.getValue(rt),Gt=w.getMask(rt);G.push(pt),X.push(Gt),Gt!=null&&(ge=!0),s||(v[rt.name]--,v[rt.name]===0&&!e.hasKey(rt)&&c.indexOf(rt.name)===-1&&!pt.isDisposed&&rt.sourceLayer.stateful!==!0&&fe.push(pt))}ge&&(t=t||{},t.mask=X[0]);const be=Vn(z.apply(G,t));let He=null;z.supportsMasking&&(He=z.computeMask(G,X));const Je=zR(P),$e=Array.isArray(Je)?Je:[Je];for(let rt=0;rt<$e.length;++rt){w.hasKey($e[rt])||w.add($e[rt],be[rt],Array.isArray(He)?He[0]:He);const pt=c.indexOf($e[rt].name);pt!==-1&&(h[pt]=be[rt])}s||Hr(fe)}return w.disposeMasks(),o?h:h[0]}function UR(i,e){C(i!=null&&i.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(i.length===1){const s=kI(i[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const o of i){const{sorted:l,recipientMap:c}=kI(o,e);for(const h of l)s.has(h.name)||(t.push(h),s.add(h.name));for(const h in c)r[h]==null&&(r[h]=new Set),c[h].forEach(p=>r[h].add(p))}}return{sorted:t,recipientCounts:VR(r)}}function VR(i){const e={};for(const t in i)e[t]=i[t].size;return e}function kI(i,e){const t=new Set,r=[],s={};for(const c of e.names())t.add(c);const o=[],l=[];for(o.push(i);o.length>0;){const c=o[o.length-1];if(t.has(c.name)){o.pop();continue}const h=l[l.length-1]===o.length-1;if(c.inputs.length===0||h)o.pop(),r.push(c),t.add(c.name),h&&l.pop();else{l.push(o.length-1);for(const p of c.inputs)s[p.name]==null&&(s[p.name]=new Set),s[p.name].add(c.name),!t.has(p.name)&&o.push(p)}}return{sorted:r,recipientMap:s}}function zR(i){let e;if(i.sourceLayer.inboundNodes.length===1)e=i.sourceLayer.output;else{let t=null;for(let r=0;r<i.sourceLayer.inboundNodes.length;++r)for(const s of i.sourceLayer.inboundNodes[r].outputTensors)if(s.id===i.id){t=r;break}e=i.sourceLayer.getOutputAt(t)}return e}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Ye().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,GR);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Aw(i,e){return Pt(()=>ko(Ji(St(i,i),e,!0)))}class gA extends Id{getConfig(){return{}}}class LI extends gA{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Pt(()=>{const t=Aw(e,this.axis),r=Ja(t,0,this.maxValue);return St(e,rr(r,Hn(Es(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}LI.className="MaxNorm",Nn(LI);class DI extends gA{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Pt(()=>rr(e,Hn(Es(),Aw(e,this.axis))))}getConfig(){return{axis:this.axis}}}DI.className="UnitNorm",Nn(DI);class NI extends gA{apply(e){return Vu(e)}}NI.className="NonNeg",Nn(NI);class FI extends gA{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Pt(()=>{const t=Aw(e,this.axis),r=Hn(St(this.rate,Ja(t,this.minValue,this.maxValue)),St(1-this.rate,t));return St(e,rr(r,Hn(Es(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}FI.className="MinMaxNorm",Nn(FI);const PI={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function fo(i){return tr(i)}function OI(i,e={}){return Mr(i,Gl.getMap().classNameMap,e,"constraint")}function mo(i){if(i==null)return null;if(typeof i=="string"){const e={className:i in PI?PI[i]:i,config:{}};return OI(e)}else return i instanceof gA?i:OI(i)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/async function nf(i){if(i==null)return;const e=[],t=[],r=[];for(const s in i){const o=i[s];if(typeof o!="number"){const l=o;e.push(l.data()),t.push(s),r.push(l)}}if(e.length>0){const s=await Promise.all(e);for(let o=0;o<s.length;++o)i[t[o]]=s[o][0];Hr(r)}}function GI(i){if(i!=null)for(const e in i){const t=i[e];typeof t!="number"&&t.dispose()}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var UI;(function(i){i[i.SILENT=0]="SILENT",i[i.VERBOSE=1]="VERBOSE"})(UI||(UI={}));const WR=125;class AA{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class HR{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class KR extends AA{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const o=t[s];if(typeof o=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+o*r;else{let l;s in this.totals?l=this.totals[s]:this.totals[s]=0;const c=Pt(()=>Hn(this.totals[s],St(o,r)));this.totals[s]=c,l!=null&&l.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:Pt(()=>{const s=St(rr(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),bl(t[r])}))}}class XR extends AA{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const o in this.history){const l=this.history[o];for(let c=0;c<l.length;++c)if(typeof l[c]!="number"){const h=l[c];e.push(h.data()),t.push(o),r.push(c)}}const s=await Promise.all(e);for(let o=0;o<s.length;++o)this.history[t[o]][r[o]].dispose(),this.history[t[o]][r[o]]=s[o][0]}}class QR extends AA{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Bm,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=WR),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");we(this.yieldEvery)&&(this.maybeWait=Os(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await nf(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await nf(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await nf(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await nf(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await nf(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):we(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await nf(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await nf(e),await this.trainEnd(e))}}function VI(i,e){return i==null&&(i={}),i instanceof AA?[i]:Array.isArray(i)&&i[0]instanceof AA?i:Vn(i).map(t=>new QR(t,e))}class Bc{constructor(){}static registerCallbackConstructor(e,t){C(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Bc.checkForDuplicate(t),Bc.constructors[e]==null&&(Bc.constructors[e]=[]),Bc.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Bc.constructors)Bc.constructors[+t].forEach(r=>{if(r===e)throw new je("Duplicate callback constructor.")})}static clear(){Bc.constructors={}}static createCallbacks(e){const t=[];for(const r in Bc.constructors){const s=+r;e>=s&&t.push(...Bc.constructors[s])}return t.map(r=>new r)}}Bc.constructors={};function zI(i,e,t,r,s,o,l,c,h){const p=new XR,f=[new KR,...Bc.createCallbacks(e)];i!=null&&f.push(...i),f.push(p);const g=new HR(f);return g.setParams({epochs:t,initialEpoch:r,samples:s,steps:o,batchSize:l,verbose:e,doValidation:c,metrics:h}),{callbackList:g,history:p}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jh(i,e={},t=!1){return Mr(i,Gl.getMap().classNameMap,e,"layer",t)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function uy(i,e){return Pt(()=>{i.dtype!=="float32"&&(i=wi(i,"float32"));const t=Ji(Zr(i),e,!0),r=Cp(t.shape,Es()),s=ko(Yc(t,r));return rr(i,s)})}function hy(i,e){return Pt(()=>Na(Zr(mr(e,i)),-1))}function vw(i,e){return Pt(()=>Na(Ro(mr(e,i)),-1))}function yw(i,e){return Pt(()=>{const t=mr(i,e),r=Ja(Ro(i),Es(),Number.MAX_VALUE),s=Ro(rr(t,r));return St(100,Na(s,-1))})}function ZR(i,e){return Pt(()=>{const t=Ja(e,Es(),Number.MAX_VALUE),r=Ec(Hn(1,t)),s=Ja(i,Es(),Number.MAX_VALUE),o=Ec(Hn(1,s));return Na(Zr(mr(r,o)),-1)})}function $R(i,e){return Pt(()=>{const t=Yc(0,mr(1,St(i,e)));return Na(Zr(t),-1)})}function jR(i,e){return Pt(()=>{const t=Yc(0,mr(1,St(i,e)));return Na(t,-1)})}function YR(i,e){return Pt(()=>{const t=Ji(St(i,e),-1),r=wc(St(mr(1,i),e),-1);return Yc(0,Hn(1,mr(r,t)))})}function JR(i,e){return Pt(()=>{const t=Math.log(2),r=mr(e,i),s=mr(Hn(r,wp(St(-2,r))),t);return Na(s,-1)})}function vA(i,e,t=!1){return Pt(()=>{if(t)e=S0(e);else{const r=Ji(e,e.shape.length-1,!0);e=rr(e,r)}return e=Ja(e,Es(),1-Es()),La(Ji(St(wi(i,"float32"),Ec(e)),e.shape.length-1))})}function dy(i,e,t=!1){return Pt(()=>{const r=wi(qf(qe(i)),"int32");e=Ja(e,Es(),1-Es());const s=e.shape,o=kt(a1(r,s[s.length-1]),s);return vA(o,e,t)})}function qR(i,e){if(!S(i.shape,e.shape))throw new je(`logits and labels must have the same shape, but got shapes ${JSON.stringify(i.shape)} and ${JSON.stringify(e.shape)}`);return Pt(()=>{const t=Vu(e),r=La(Ro(e));return Hn(mr(t,St(e,i)),c0($c(r)))})}function py(i,e){return Pt(()=>{let t;return t=Ja(e,Es(),1-Es()),t=Ec(rr(t,mr(1,t))),Na(qR(i,t),-1)})}function eB(i,e){return Pt(()=>{const t=Ja(i,Es(),1),r=Ja(e,Es(),1);return Ji(St(i,Ec(rr(t,r))),-1)})}function tB(i,e){return Pt(()=>{const t=Ec(Hn(Es(),e));return Na(mr(e,St(i,t)),-1)})}function WI(i,e){return Pt(()=>{const t=uy(i,-1),r=uy(e,-1),s=St(t,r);return La(Ji(s,-1))})}const fy={meanSquaredError:hy,meanAbsoluteError:vw,meanAbsolutePercentageError:yw,meanSquaredLogarithmicError:ZR,squaredHinge:$R,hinge:jR,categoricalHinge:YR,logcosh:JR,categoricalCrossentropy:vA,sparseCategoricalCrossentropy:dy,binaryCrossentropy:py,kullbackLeiblerDivergence:eB,poisson:tB,cosineProximity:WI};function bw(i){if(typeof i=="string"){if(i in fy)return fy[i];let e=`Unknown loss ${i}`;throw i.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${i}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new je(e)}else return i}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function HI(i,e){return Pt(()=>{const t=St(.5,Co(e)),r=qp(Cl(e,t),i.dtype);return Na(Cc(i,r),-1)})}function KI(i,e){return Pt(()=>qp(Cc(yp(i,-1),yp(e,-1)),"float32"))}function nB(i,e){return Pt(()=>wi(Ji(jc(Cc(i,1),Cc(e,1))),"float32"))}function iB(i,e){return Pt(()=>wi(Ji(jc(Cc(i,0),Cc(e,1))),"float32"))}function rB(i,e){return Pt(()=>{const t=nB(i,e),r=iB(i,e),s=Hn(t,r);return wi(el(Cl(s,0),rr(t,s),0),"float32")})}function sB(i,e){return py(i,e)}function aB(i,e){return i.rank===e.rank&&(i=eu(i,[i.rank-1])),e=yp(e,-1),e.dtype!==i.dtype&&(e=wi(e,i.dtype)),wi(Cc(i,e),"float32")}const oB=hy,lB=hy,cB=vw,uB=vw,hB=yw,dB=yw,XI=vA,pB=WI,QI=dy,my={binaryAccuracy:HI,categoricalAccuracy:KI,precision:rB,categoricalCrossentropy:XI,sparseCategoricalCrossentropy:QI,mse:oB,MSE:lB,mae:cB,MAE:uB,mape:hB,MAPE:dB,cosine:pB};function fB(i){if(typeof i=="string"&&i in my)return my[i];if(typeof i!="string"&&i!=null)return i;throw new je(`Unknown metric ${i}`)}function gy(i){if(li(i!==null,`Unknown LossOrMetricFn ${i}`),typeof i=="string")return i;{let e;for(const t of Object.keys(fy))if(fy[t]===i){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(my))if(my[t]===i){e=t;break}return e!==void 0?e:i.name}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function mB(i){const e={Adagrad:()=>uo.adagrad(.01),Adadelta:()=>uo.adadelta(1,.95,Es()),Adam:()=>uo.adam(.001,.9,.999,Es()),Adamax:()=>uo.adamax(.002,.9,.999,Es(),0),RMSProp:()=>uo.rmsprop(.001,.9,0,Es()),SGD:()=>uo.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,i in e)return e[i]();throw new je(`Unknown Optimizer ${i}`)}/**
* @license
* Copyright 2019 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const ZI=1*1024*1024;function $I(i,e,t=!1){if(i==null||typeof i!="object"||Object.getPrototypeOf(i)!==Object.prototype||!xw(i))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(i);r.length>ZI&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${ZI}.`)}}function xw(i){if(i===null)return!0;if(typeof i=="object")if(Object.getPrototypeOf(i)===Object.prototype){const e=Object.keys(i);for(const t of e)if(typeof t!="string"||!xw(i[t]))return!1;return!0}else if(Array.isArray(i)){for(const e of i)if(!xw(e))return!1;return!0}else return!1;else{const e=typeof i;return e==="string"||e==="number"||e==="boolean"}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function gB(i,e,t,r=console.log){const s=vB(i),o=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(f=>Math.floor(e*f)));let l;if(!s){o.push("Receives inputs"),l=[];for(const f in i.nodesByDepth)l.push(...i.nodesByDepth[f])}r("_".repeat(e)),Ay(o,t,r),r("=".repeat(e));const c=i.layers;for(let f=0;f<c.length;++f)s?yB(c[f],t,r):bB(c[f],t,l,r),r((f===c.length-1?"=":"_").repeat(e));i.checkTrainableWeightsConsistency();const h=AB(i),p=ay(i.nonTrainableWeights);r(`Total params: ${h+p}`),r(`Trainable params: ${h}`),r(`Non-trainable params: ${p}`),r("_".repeat(e))}function AB(i){let e;return i.collectedTrainableWeights!=null?e=ay(i.collectedTrainableWeights):e=ay(i.trainableWeights),e}function vB(i){let e=!0;const t=[],r=[];for(const s in i.nodesByDepth)t.push(i.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of i.layers){let o=!1;for(const l of s.inboundNodes)if(r.indexOf(l)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Ay(i,e,t=console.log){let r="";for(let s=0;s<i.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=i[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function yB(i,e,t){let r,s;try{s=i.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(i.outputShape)}catch{r="multiple"}const o=i.name,l=i.getClassName(),c=[`${o} (${l})`,s,r,i.countParams().toString()];Ay(c,e,t)}function bB(i,e,t,r){let s,o;try{o=i.inboundNodes.map(g=>JSON.stringify(g.inputShapes)).join(",")}catch{o="multiple"}try{s=JSON.stringify(i.outputShape)}catch{s="multiple"}const l=[];for(const g of i.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(g)===-1))for(let v=0;v<g.inboundLayers.length;++v){const w=g.inboundLayers[v].name,R=g.nodeIndices[v],P=g.tensorIndices[v];l.push(`${w}[${R}][${P}]`)}const c=i.name,h=i.getClassName(),p=l.length===0?"":l[0],f=[`${c} (${h})`,o,s,i.countParams().toString(),p];Ay(f,e,r);for(let g=1;g<l.length;++g)Ay(["","","","",l[g]],e,r)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jI(i,e,t){return(i==="inboundNodes"||i==="outputLayers"||i==="inputLayers")&&e===0&&typeof t=="string"}function Cw(i,e){if(i===null)return null;if(typeof i=="string")return Ei(i);if(typeof i=="number"||typeof i=="boolean")return i;if(i instanceof Array){const t=[],r=i.length;for(let s=0;s<r;++s){const o=i[s];jI(e,s,o)?t.push(o):t.push(Cw(o,e))}return t}else{const t={};for(const r of Object.keys(i)){const s=i[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const o=Ei(r);t[o]=Cw(s,o)}}return t}}function ww(i,e){if(i==null)return null;if(typeof i=="string")return Jt(i);if(typeof i=="number"||typeof i=="boolean")return i;if(i instanceof Array){const t=[],r=i.length;for(let s=0;s<r;++s){const o=i[s];jI(e,s,o)?t.push(o):t.push(ww(o,e))}return t}else{const t={};for(const r of Object.keys(i)){const s=i[r],o=Jt(r);(r==="name"||r==="className")&&typeof s=="string"?t[o]=s:t[o]=ww(s,r)}return t}}/** @license See the LICENSE file. */const YI="3.21.0";/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class fu extends cs{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const X=this.getClassName().toLowerCase();this.name=Xn(X)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],qn(this.inputs).length!==this.inputs.length)throw new je(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(X=>X.name)}`);qn(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(X=>X.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const X of this.outputs){const fe=X.sourceLayer,ge=X.nodeIndex,be=X.tensorIndex;this.outputLayers.push(fe),this.outputLayersNodeIndices.push(ge),this.outputLayersTensorIndices.push(be)}for(const X of this.inputs){const fe=X.sourceLayer,ge=X.nodeIndex,be=X.tensorIndex;li(ge===0,"input layer has >1 nodes"),li(be===0,"input layer has >1 tensors"),this.inputLayers.push(fe),this.inputLayersNodeIndices.push(ge),this.inputLayersTensorIndices.push(be)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let X=0;X<this.inputLayers.length;X++){const fe=this.inputLayers[X];if(!(fe instanceof fA))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${X} (0-based) originates from layer type ${fe.getClassName()}.`);this.inputNames.push(fe.name),this.feedInputShapes.push(fe.batchInputShape),this.feedInputNames.push(fe.name)}for(const X of this.outputLayers)this.outputNames.push(X.name);this.internalInputShapes=this.inputs.map(X=>X.shape),this.internalOutputShapes=this.outputs.map(X=>X.shape);const t={},r={},s={},o={},l={},c=[],h=(X,fe,ge,be,He,Je)=>{(be==null||He==null||Je==null)&&(be=X.sourceLayer,He=X.nodeIndex,Je=X.tensorIndex);const $e=be.inboundNodes[He];if(ge.indexOf($e)!==-1)throw new bn(`The tensor ${X.name} at layer "${be.name}" is part of a cycle.`);if(fe.indexOf($e)!==-1)return;this.containerNodes.add(fu.nodeKey(be,He)),be.id in l||(l[be.id]=Object.keys(l).length),ge.indexOf($e)===-1&&ge.push($e);const rt=$e.inboundLayers.length;for(let pt=0;pt<rt;pt++){const Gt=$e.inputTensors[pt],zt=$e.inboundLayers[pt],Kt=$e.nodeIndices[pt],tn=$e.tensorIndices[pt];h(Gt,fe,ge,zt,Kt,tn)}for(fe.push($e);ge.indexOf($e)>=0;)ge.splice(ge.indexOf($e),1);c.push($e)},p=[],f=[];for(const X of this.outputs)h(X,p,f);const g=c.slice().reverse();for(const X of g){r[X.id]=X,X.id in t||(t[X.id]=0);let fe=t[X.id];const ge=s[X.outboundLayer.id]==null?0:s[X.outboundLayer.id];fe=Math.max(fe,ge),s[X.outboundLayer.id]=fe,o[X.outboundLayer.id]=X.outboundLayer,t[X.id]=fe;for(let be=0;be<X.inboundLayers.length;be++){const He=X.inboundLayers[be],Je=X.nodeIndices[be],$e=He.inboundNodes[Je],rt=t[$e.id]==null?0:t[$e.id];t[$e.id]=Math.max(fe+1,rt),r[$e.id]=$e}}const v={};for(const X in t){const fe=t[X];fe in v||(v[fe]=[]),v[fe].push(r[X])}const w={};for(const X in s){const fe=s[X];fe in w||(w[fe]=[]),w[fe].push(o[X])}let R=Object.keys(w).map(X=>parseInt(X,10)).sort(Tn);this.layers=[];for(const X of R){const fe=w[X];fe.sort((ge,be)=>{const He=l[ge.id],Je=l[be.id];return He<Je?-1:He>Je?1:0});for(const ge of fe)ge instanceof fu&&this.internalContainerRefs.push(ge),this.layers.push(ge)}this.layersByDepth=w,R=Object.keys(v).map(X=>parseInt(X,10)).sort(Tn);const P=this.inputs.slice(),z=[];for(const X of R)for(const fe of v[X]){const ge=fe.outboundLayer;if(ge!=null){for(const be of fe.inputTensors)if(P.indexOf(be)===-1)throw new bn(`Graph disconnected: cannot obtain value for tensor ${be} at layer "${ge.name}". The following previous layers were accessed without issue: ${z}`);for(const be of fe.outputTensors)P.push(be);z.push(ge.name)}}this.nodesByDepth=v;const G=this.layers.map(X=>X.name);for(const X of G){const fe=G.filter(ge=>ge===X).length;if(fe!==1)throw new bn(`The name "${X}" is used ${fe} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(G))}this.outboundNodes=[],this.inboundNodes=[],new oy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(X=>null),outputMasks:this.outputs.map(X=>null),inputShapes:this.inputs.map(X=>X.shape),outputShapes:this.outputs.map(X=>X.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new je("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;for(const l of this.layers)for(const c of l.weights){if(r[c.originalName]!=null)throw new je(`Duplicate weight name: ${c.originalName}`);r[c.originalName]=c,s++}const o=[];for(const l in e){let c=l;if(r[l]==null){const h=l.split("/");c=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(r[c]!=null)o.push([r[c],e[l]]);else if(t)throw new je(`Provided weight data has no target variable: ${l}`);delete r[c]}if(t){const l=[];for(const c in r)l.push(c);if(l.length>0)throw new je(`${l.length} of ${s} weights are not set: ${l}`)}gw(o)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${YI}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=ww(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return Pt(()=>{e=Vn(e);const r=new Zd;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return mA(this.outputs,r,t)})}computeMask(e,t){return Pt(()=>{e=Vn(e);let r;return t==null?r=xi(null,e.length):r=Vn(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=sy(e);if(t.length!==this.inputLayers.length)throw new je(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let c=0;c<t.length;c++){const h=this.inputLayers[c],p=t[c],f=h.name+"_0_0";r[f]=p}const s=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Tn);if(s.length>1)for(const c of s){const h=this.nodesByDepth[c];for(const p of h){const f=p.outboundLayer;if(this.inputLayers.map(P=>P.id).indexOf(f.id)!==-1)continue;const g=[];for(let P=0;P<p.inboundLayers.length;P++){const z=p.inboundLayers[P],G=p.nodeIndices[P],X=p.tensorIndices[P],fe=`${z.name}_${G}_${X}`,ge=r[fe];g.push(ge)}const v=f.computeOutputShape(Rn(g)),w=sy(v),R=f.inboundNodes.indexOf(p);for(let P=0;P<w.length;P++){const z=`${f.name}_${R}_${P}`;r[z]=w[P]}}}const o=[],l=[];for(let c=0;c<this.outputLayers.length;c++){const h=this.outputLayers[c],p=this.outputLayersNodeIndices[c],f=this.outputLayersTensorIndices[c],g=`${h.name}_${p}_${f}`;l.push(g)}for(let c=0;c<l.length;c++){const h=l[c];li(h in r),o.push(r[h])}return Rn(o)}runInternalGraph(e,t){t==null&&(t=xi(null,e.length));const r={};for(let h=0;h<this.inputs.length;++h){const p=this.inputs[h],f=e[h],g=t[h];r[p.id]=[f,g]}const s=Object.keys(this.nodesByDepth).map(h=>parseInt(h,10)).sort(Tn);for(const h of s){const p=this.nodesByDepth[h];for(const f of p){const g=f.outboundLayer,v=f.inputTensors,w=f.outputTensors,R=new Array;for(const P of v)P.id in r&&R.push(r[P.id]);if(R.length===v.length){let P={},z,G,X,fe;if(f.callArgs!=null&&(P=f.callArgs),R.length===1){const[ge,be]=R[0];P.mask==null&&(P.mask=be),X=Vn(g.call(ge,P)),fe=Vn(g.computeMask(ge,be)),z=[ge],G=[be]}else z=R.map(ge=>ge[0]),G=R.map(ge=>ge[1]),P.mask==null&&(P.mask=G),X=Vn(g.call(z,P)),fe=Vn(g.computeMask(z,G));if(g.activityRegularizer)throw new Zt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let ge=0;ge<w.length;++ge){const be=w[ge],He=X[ge],Je=fe[ge];r[be.id]=[He,Je]}}}}const o=[],l=[],c=[];for(const h of this.outputs){li(h.id in r,`Could not compute output ${h.name} : ${h.id}`);const[p,f]=r[h.id];c.push(p.shape),o.push(p),l.push(f)}return[o,l,c]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof fu?1:0;for(let o=0;o<s.inboundNodes.length;o++){const l=fu.nodeKey(s,o);this.containerNodes.has(l)&&(t[l]=r,r+=1)}}return t}getLayer(e,t){if(t!=null){if(this.layers.length<=t)throw new je(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}else if(e==null)throw new je("Provide either a layer name or layer index");for(const r of this.layers)if(r.name===e)return r;throw new je(`No such layer: ${e}`)}calculateLosses(){return Pt(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=fu.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const l of this.layers){const c=l.getClassName(),h=l.getConfig(),p=[];for(let g=0;g<l.inboundNodes.length;g++){const v=l.inboundNodes[g],w=fu.nodeKey(l,g);let R={};if(this.containerNodes.has(w)){if(v.callArgs)try{JSON.stringify(v.callArgs),R=v.callArgs}catch{console.warn(`Layer ${l.name} was passed non-serializable keyword arguments: ${v.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),R={}}if(v.inboundLayers.length>0){const P=[];for(let z=0;z<v.inboundLayers.length;z++){const G=v.inboundLayers[z],X=v.nodeIndices[z],fe=v.tensorIndices[z],ge=fu.nodeKey(G,X);let be=t[ge];be==null&&(be=0),P.push([G.name,be,fe,R])}p.push(P)}}}const f={};f.name=l.name,f.className=c,f.config=h,f.inboundNodes=p,r.push(f)}e.layers=r;const s=[];for(let l=0;l<this.inputLayers.length;l++){const c=this.inputLayers[l],h=this.inputLayersNodeIndices[l],p=fu.nodeKey(c,h);if(!this.containerNodes.has(p))continue;let f=t[p];f==null&&(f=0);const g=this.inputLayersTensorIndices[l];s.push([c.name,f,g])}e.inputLayers=s;const o=[];for(let l=0;l<this.outputLayers.length;l++){const c=this.outputLayers[l],h=this.outputLayersNodeIndices[l],p=fu.nodeKey(c,h);if(!this.containerNodes.has(p))continue;let f=t[p];f==null&&(f=0);const g=this.outputLayersTensorIndices[l];o.push([c.name,f,g])}return e.outputLayers=o,e}static fromConfig(e,t,r={},s=!1){const o={},l={};function c(z,G){z.name in l?l[z.name].push(G):l[z.name]=[G]}function h(z,G){const X=[];let fe;for(const ge of G){const be=ge[0],He=ge[1],Je=ge[2];if(fe=ge[3]==null?{}:ge[3],!(be in o)){c(z,G);return}const $e=o[be];if($e.inboundNodes.length<=He){c(z,G);return}const rt=$e.inboundNodes[He];X.push(rt.outputTensors[Je])}X.length>0&&z.apply(Rn(X),fe)}function p(z){const G=z.name,X=jh(z,t.customObjects!=null?t.customObjects:{});X.setFastWeightInitDuringBuild(s),o[G]=X,z.inboundNodes.forEach(fe=>{if(!(fe instanceof Array))throw new je(`Corrupted configuration, expected array for nodeData: ${fe}`);c(X,fe)})}const f=t.name,g=t.layers;for(const z of g)p(z);for(;!$i(l);)for(const z of g){const G=o[z.name];if(G.name in l){const X=l[G.name];delete l[G.name];for(const fe of X)h(G,fe)}}const v=[],w=[],R=t.inputLayers;for(const z of R){const G=z[0],X=z[1],fe=z[2];li(G in o);const ge=o[G].inboundNodes[X].outputTensors;v.push(ge[fe])}const P=t.outputLayers;for(const z of P){const G=z[0],X=z[1],fe=z[2];li(G in o);const ge=o[G].inboundNodes[X].outputTensors;w.push(ge[fe])}return new e({inputs:v,outputs:w,name:f})}get stateful(){if(this._stateful)throw new je("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Pt(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function xB(i,e,t){const r=e.length;if(i==null||Array.isArray(i)&&i.length===0)return e.map(s=>null);if(r===1)return Array.isArray(i)&&i.length===1?i:typeof i=="object"&&e[0]in i?[i[e[0]]]:[i];if(Array.isArray(i)){if(i.length!==r)throw new Error(`Provided ${t} is an array of ${i.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return i}else if(typeof i=="object"&&Object.keys(i).length>0&&typeof i[Object.keys(i)[0]]=="object"){const s=[];return e.forEach(o=>{o in i?s.push(i[o]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(i)}`)}function JI(i,e){return xB(i,e,"classWeight")}async function qI(i,e,t,r){if(e!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(t!=null){const s=Pt(()=>{if(i.shape.length===1)return _h(i);if(i.shape.length===2){if(i.shape[1]>1)return yp(i,1);if(i.shape[1]===1)return kt(i,[i.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${i.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${i.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await s.data());Hr(s);const l=[];return o.forEach(c=>{if(t[c]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${c} exists in the data but not in classWeight`);l.push(t[c])}),tl(l,"float32")}else return null}function CB(i,e){return St(i,e)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const wB=32;function eS(i,e){let t,r;const s=e;t=s.xs,r=s.ys,C(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=tS("input",i.inputNames,t),l=tS("output",i.outputNames,r),c=o[0].shape[0];C(o.length===i.inputs.length,()=>`LayersModel has ${i.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(i.inputNames)})`),C(l.length===i.outputs.length,()=>`LayersModel has ${i.outputs.length} outputs, but the dataset provides ${l.length} outputs.  (Expected output keys: ${JSON.stringify(i.outputNames)})`);for(let h=0;h<o.length;h++)C(o[h].shape[0]===c,()=>`Batch size mismatch: input ${i.inputNames[h]} has ${o[h].shape[0]}; expected  ${c} based on input ${i.inputNames[0]}.`);for(let h=0;h<l.length;h++)C(l[h].shape[0]===c,()=>`Batch size mismatch: output ${i.outputNames[h]} has ${l[h].shape[0]}; expected  ${c} based on input ${i.inputNames[0]}.`);return{xs:o,ys:l}}function tS(i,e,t){if(t instanceof ua)return[t];if(Array.isArray(t))return C(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${i} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new je(`The feature data generated by the dataset lacks the required ${i} key '${s}'.`);r.push(t[s])}return r}}function EB(i){if(i.length===3)throw new Zt("Validation with sample weights is not implemented yet.");return{xs:i[0],ys:i[1]}}async function IB(i,e,t){const r=t.batchesPerEpoch!=null;if(C(i.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),C(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),C(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),C(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),C(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),i.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");i.isTraining=!0;try{const s=t.validationData!=null;let o,l;if(s)if(nS(t.validationData))C(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const z=EB(t.validationData);o=z.xs,l=z.ys}const c=i.makeTrainFunction(),h=i.getDedupedMetricsNames();let p;s?p=h.slice().concat(h.map(z=>"val_"+z)):p=h.slice();const f=VI(t.callbacks,t.yieldEvery),g=t.verbose==null?1:t.verbose,{callbackList:v,history:w}=zI(f,g,t.epochs,null,null,SB(e,t),null,s,p);v.setModel(i),i.history=w,await v.onTrainBegin(),i.stopTraining_=!1;let R=t.initialEpoch==null?0:t.initialEpoch,P=await e.iterator();for(;R<t.epochs;){const z={};await v.onEpochBegin(R);let G=0,X=0;for(r||(P=await e.iterator());!r||G<t.batchesPerEpoch;){const fe=await P.next();if(r&&fe.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${G} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(fe.value!=null){const{xs:ge,ys:be}=eS(i,fe.value),He={};He.batch=X,He.size=ge[0].shape[0],await v.onBatchBegin(X,He);const Je=[];if(t.classWeight!=null){const pt=JI(t.classWeight,i.outputNames);for(let Gt=0;Gt<pt.length;++Gt)Je.push(await qI(be[Gt],null,pt[Gt]))}const $e=ge.concat(be).concat(Je),rt=c($e);Hr($e);for(let pt=0;pt<h.length;++pt){const Gt=h[pt],zt=rt[pt];He[Gt]=zt,bl(zt)}await v.onBatchEnd(X,He),GI(He),X++,G++}if(r?G>=t.batchesPerEpoch:fe.done){if(s){let ge;nS(t.validationData)?ge=Vn(await i.evaluateDataset(t.validationData,{batches:t.validationBatches})):ge=Vn(i.evaluate(o,l,{batchSize:t.validationBatchSize==null?wB:t.validationBatchSize,verbose:0}));for(let be=0;be<i.metricsNames.length;++be)z[`val_${i.metricsNames[be]}`]=ge[be]}break}if(i.stopTraining_)break}if(await v.onEpochEnd(R,z),R++,i.stopTraining_)break}return await v.onTrainEnd(),await i.history.syncData(),i.history}finally{i.isTraining=!1}}function SB(i,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(i.size)&&(t=i.size),t}function nS(i){return typeof i.iterator=="function"}function TB(i){return typeof i.next=="function"}async function MB(i,e,t){t=t||{};const r=t.batches!=null,s=i.testFunction;let o=[];if(t.verbose>0)throw new Zt("Verbose mode is not implemented yet.");C(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const l=TB(e)?e:await e.iterator();let c=0,h=0;for(;!r||h<t.batches;){const p=await l.next();if(o=Pt(()=>{if(p.value){const{xs:f,ys:g}=eS(i,p.value),v=f.concat(g),w=Pt(()=>s(v));if(Hr(v),h===0)for(let P=0;P<w.length;++P)o.push(xs(0));const R=v[0].shape[0];for(let P=0;P<w.length;++P){const z=w[P],G=o[P];o[P]=Pt(()=>Hn(o[P],St(R,z))),h>0&&Hr(G)}Hr(w),c+=R,++h}return o}),p.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let p=0;p<o.length;++p){const f=o[p];o[p]=rr(o[p],c),Hr(f)}return Rn(o)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Ew(i){C(i>0&&Number.isInteger(i),()=>`batchSize is required to be a positive integer, but got ${i}`)}function yA(i,e,t){return i==null?[null]:Array.isArray(i)?i.map(r=>un(r,e,t-e)):un(i,e,t-e)}function Iw(i,e){return Pt(()=>i==null?null:Array.isArray(i)?i.map(t=>Iw(t,e)):is(i,e.dtype==="int32"?e:wi(e,"int32")))}function Sw(i,e){const t=[];let r=0,s=null;for(;r<i;)s=r+e,s>=i&&(s=i),t.push([r,s]),r=s;return t}async function _B(i,e,t,r,s,o,l,c,h,p,f,g,v,w,R){s==null&&(s=32),o==null&&(o=1),f==null&&(f=!0),v==null&&(v=0);let P=!1;if(h!=null&&p!=null&&(P=!0),R!=null&&(P=!0,w==null))throw new je("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const z=i.checkNumSamples(t,s,w,"steps_per_epoch");let G;z!=null&&(G=os(0,z)),l==null&&(l=1);const{callbackList:X,history:fe}=zI(c,l,o,v,z,w,s,P,g);X.setModel(i),i.history=fe,await X.onTrainBegin(),i.stopTraining_=!1;for(let ge=v;ge<o;++ge){await X.onEpochBegin(ge);const be={};if(w!=null)throw new Zt("stepsPerEpoch mode is not implemented yet.");{if(f==="batch")throw new Zt("batch shuffling is not implemneted yet");f&&Z(G);const He=tl(G),Je=Sw(z,s);for(let $e=0;$e<Je.length;++$e){const rt={};if(await X.onBatchBegin($e,rt),Pt(()=>{const pt=Je[$e][0],Gt=Je[$e][1],zt=un(He,pt,Gt-pt);rt.batch=$e,rt.size=Gt-pt;const Kt=Iw(t,zt),tn=e(Kt);for(let qt=0;qt<r.length;++qt){const sn=r[qt],xn=tn[qt];rt[sn]=xn,bl(xn)}if($e===Je.length-1&&P){const qt=i.testLoop(h,p,s);for(let sn=0;sn<r.length;++sn){const xn=r[sn],dn=qt[sn];bl(dn),be["val_"+xn]=dn}}}),await X.onBatchEnd($e,rt),GI(rt),i.stopTraining_)break}He.dispose()}if(await X.onEpochEnd(ge,be),i.stopTraining_)break}return await X.onTrainEnd(),await i.history.syncData(),i.history}async function RB(i,e,t,r={}){if(i.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");i.isTraining=!0;let s,o,l,c,h,p,f,g,v;try{const w=r.batchSize==null?32:r.batchSize;Ew(w);const R=!1,P=await i.standardizeUserData(e,t,r.sampleWeight,r.classWeight,R,w);s=P[0],o=P[1],v=P[2];let z=!1,G;if(r.validationData!=null&&r.validationData.length>0){if(z=!0,r.validationData.length===2)h=r.validationData[0],p=r.validationData[1];else throw r.validationData.length===3?new Zt("validationData including sample weights is not supported yet."):new je(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const $e=!0,rt=await i.standardizeUserData(h,p,null,null,$e,w);f=rt[0],g=rt[1],G=f.concat(g)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){z=!0;const $e=Math.floor(s[0].shape[0]*(1-r.validationSplit)),rt=s[0].shape[0];f=yA(s,$e,rt),l=s,s=yA(s,0,$e),g=yA(o,$e,rt),c=o,o=yA(o,0,$e),G=f.concat(g)}else r.validationSteps!=null&&(z=!0);const X=s.concat(o).concat(v);i.checkTrainableWeightsConsistency();const fe=i.makeTrainFunction(),ge=i.getDedupedMetricsNames();let be,He;z?(i.makeTestFunction(),be=i.testFunction,He=ge.slice().concat(ge.map($e=>"val_"+$e))):(be=null,G=[],He=ge.slice());const Je=VI(r.callbacks,r.yieldEvery);return await _B(i,fe,X,ge,w,r.epochs,r.verbose,Je,be,G,r.shuffle,He,r.initialEpoch,null,null)}finally{i.isTraining=!1,mu(s,e),mu(o,t),mu(l,e),mu(c,t),mu(f,h),mu(g,p),v!=null&&Hr(v)}}function iS(i){const e=[];i instanceof ua&&(i=[i]);for(let t=0;t<i.length;++t){const r=i[t];if(r.rank===1)e.push(ef(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function mu(i,e){if(i==null)return;const t=[];if(e instanceof ua)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const o=e[s];t.push(o.id)}const r=[];if(i instanceof ua)t.indexOf(i.id)===-1&&r.push(i);else if(Array.isArray(i))i.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(i!=null)for(const s in i){const o=i[s];t.indexOf(o.id)===-1&&r.push(o)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function BB(i){return i instanceof ua}function Tw(i){return Array.isArray(i)}function rS(i){return!BB(i)&&!Tw(i)}function sS(i,e,t,r=!0,s=""){if(e==null||e.length===0){if(i!=null){let l=!1;if(Tw(i)&&i.length>0)l=!0;else if(rS(i)){for(const c in i)if(i.hasOwnProperty(c)){l=!0;break}}else l=!0;if(l)throw new je(`Error when checking model ${s} expected no data, but got ${i}`)}return[]}if(i==null)return e.map(l=>null);let o;if(rS(i)){i=i,o=[];for(const l of e){if(i[l]==null)throw new je(`No data provided for "${l}". Need data for each key in: ${e}`);o.push(i[l])}}else if(Tw(i)){if(i=i,i.length!==e.length)throw new je(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${i}`);o=i}else{if(i=i,e.length>1)throw new je(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${i.shape}`);o=[i]}if(o=iS(o),t!=null)for(let l=0;l<e.length;++l){if(t[l]==null)continue;const c=o[l];if(c.shape.length!==t[l].length)throw new je(`Error when checking ${s}: expected ${e[l]} to have ${t[l].length} dimension(s). but got array with shape ${c.shape}`);for(let h=0;h<t[l].length;++h){if(h===0&&!r)continue;const p=c.shape[h],f=t[l][h];if(f!=null&&f>=0&&p!==f)throw new je(`${s} expected a batch of elements where each example has shape [${t[l].slice(1,t[l].length)}] (i.e.,tensor shape [*,${t[l].slice(1,t[l].length)}]) but the ${s} received an input with ${c.shape[0]} examples, each with shape [${c.shape.slice(1,c.shape.length)}] (tensor shape [${c.shape}])`)}}return o}function kB(i,e,t){const r=qn(i.map(o=>o.shape[0]));r.sort();const s=qn(e.map(o=>o.shape[0]));if(s.sort(),r.length>1)throw new je(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(i.map(o=>o.shape))}`);if(s.length>1)throw new je(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(r.length>0&&s.length>0&&!S(r,s))throw new je(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function LB(i,e,t){const r=[hy,py,vA];for(let s=0;s<i.length;++s){const o=i[s],l=e[s],c=t[s];if(l!=null){if(l===vA&&o.shape[o.shape.length-1]===1)throw new je(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(l)!==-1){const h=o.shape.slice(1),p=c.slice(1);for(let f=0;f<h.length;++f){const g=h[f],v=p[f];if(v!=null&&g!==v)throw new je(`A target Tensor with shape ${o.shape} was passed for an output of shape ${c}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function aS(i,e,t,r=!0,s=""){let o;if(Array.isArray(i)){if(i.length!==e.length)throw new je(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${i.length} Tensors(s).`);o=i}else{if(e.length>1)throw new je(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(i.shape)}.`);o=[i]}if(t!=null)for(let l=0;l<e.length;++l){if(t[l]==null)continue;const c=o[l];if(c.shape.length!==t[l].length)throw new je(`Error when checking ${s}: expected ${e[l]} to have ${t[l].length} dimension(s), but got array with shape ${JSON.stringify(c.shape)}`);for(let h=0;h<t[l].length;++h){if(h===0&&!r)continue;const p=c.shape[h],f=t[l][h];if(f!=null&&f!==p)throw new je(`Error when checking ${s}: expected ${e[l]} to have shape ${JSON.stringify(t[l])} but got array with shape ${JSON.stringify(c.shape)}.`)}}}function DB(i,e){if(i==null||Array.isArray(i)&&i.length===0)return e.map(r=>[]);let t;if(typeof i=="string"||typeof i=="function")t=[i];else if(Array.isArray(i)||typeof i=="object")t=i;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${i}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let o=t.hasOwnProperty(s)?t[s]:[];Array.isArray(o)||(o=[o]),r.push(o)}return r}}const NB="layers-model";class Ym extends fu{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new je("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");gB(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=mB(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof wl))throw new je("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const l in e.loss)if(this.outputNames.indexOf(l)===-1)throw new je(`Unknown entry in loss dictionary: "${l}". Only expected the following keys: ${this.outputNames}`);for(const l of this.outputNames)e.loss[l]==null&&console.warn(`Output "${l}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${l} during training`),t.push(bw(e.loss[l]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new je(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(l=>bw(l))}else{const l=bw(e.loss);this.outputs.forEach(c=>{t.push(l)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let l=0;l<this.outputs.length;++l){const c=this.internalOutputShapes[l],h=this.outputNames[l];this.feedOutputNames.push(h),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[l])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],da("loss",()=>{for(let l=0;l<this.outputs.length;++l){if(r.indexOf(l)!==-1)continue;const c=this.lossFunctions[l];this.outputs.length>1&&(this.metricsTensors.push([c,l]),this.metricsNames.push(this.outputNames[l]+"_loss"))}});const s=DB(e.metrics,this.outputNames),o=(l,c,h)=>{this.outputNames.length>1&&(c=this.outputNames[l]+"_"+c),this.metricsNames.push(c),this.metricsTensors.push([h,l])};da("metric",()=>{for(let l=0;l<this.outputs.length;++l){if(r.indexOf(l)!==-1)continue;const c=s[l];(h=>{const p="";let f,g,v;for(const w of h){if(typeof w=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(w)!==-1){const P=this.internalOutputShapes[l];P[P.length-1]===1||this.lossFunctions[l]===py?["accuracy","acc"].indexOf(w)!==-1?g=HI:["crossentropy","ce"].indexOf(w)!==-1&&(g=sB):this.lossFunctions[l]===dy?["accuracy","acc"].indexOf(w)!==-1?g=aB:["crossentropy","ce"].indexOf(w)!==-1&&(g=QI):["accuracy","acc"].indexOf(w)!==-1?g=KI:["crossentropy","ce"].indexOf(w)!==-1&&(g=XI);let z;["accuracy","acc"].indexOf(w)!==-1?z="acc":["crossentropy","ce"].indexOf(w)!==-1&&(z="ce"),v=g,f=p+z}else v=fB(w),f=p+gy(w);let R;da(f,()=>{R=v}),o(l,f,R)}})(c)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;Ew(s);const o=!0,l=this.standardizeUserDataXY(e,t,o,s);try{const c=l[0].concat(l[1]);this.makeTestFunction();const h=this.testFunction,p=this.testLoop(h,c,s,r.verbose,r.steps);return Rn(p)}finally{mu(l[0],e),mu(l[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),MB(this,e,t)}checkNumSamples(e,t,r,s="steps"){let o;if(r!=null){if(o=null,t!=null)throw new je(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new je(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new je("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],o=this.retrieveSymbolicTensors(s),l=new Zd;if(e instanceof ua&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new je(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let h=0;h<this.inputs.length;++h)l.add(this.inputs[h],e[h])}else for(const h of this.inputs){const p=e[h.name];if(p==null)throw new je(`No value is provided for the model's input ${h.name}`);l.add(h,p)}const c=mA(o,l);return r?c:c[0]}retrieveSymbolicTensors(e){const t=xi(null,e.length);let r=e.length;for(const s of this.layers){const o=Array.isArray(s.output)?s.output:[s.output],l=o.map(c=>c.name);for(let c=0;c<e.length;++c){const h=l.indexOf(e[c]);if(h!==-1&&(t[c]=o[h],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((o,l)=>{o==null&&s.push(e[l])}),new je(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return Pt(()=>{const s=this.checkNumSamples(e);if(r)throw new Zt("Verbose predictLoop() is not implemented yet.");const o=Sw(s,t),l=this.outputs.map(c=>[]);for(let c=0;c<o.length;++c)Pt(()=>{const h=o[c][0],p=o[c][1],f=yA(e,h,p),g=[];if(Array.isArray(f))for(let w=0;w<f.length;++w)g.push({key:this.inputs[w],value:f[w]});else g.push({key:this.inputs[0],value:f});const v=new Zd(g);return mA(this.outputs,v)}).forEach((h,p)=>l[p].push(h));return Rn(l.map(c=>Jo(c,0)))})}predict(e,t={}){const r=iS(e);aS(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return Ew(s),this.predictLoop(r,s)}finally{mu(r,e)}}predictOnBatch(e){aS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new bn("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let l=0;l<this.feedOutputShapes.length;++l){const c=this.feedOutputShapes[l];this.feedLossFns[l]===dy?o.push(c.slice(0,c.length-1).concat([1])):o.push(c)}if(e=sS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=sS(t,this.feedOutputNames,o,!1,"target"),kB(e,t),LB(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new je(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,o=!0,l){const[c,h]=this.standardizeUserDataXY(e,t,o,l);if(r!=null)throw new Error("sample weight is not supported yet.");let p=null;if(s!=null){const f=JI(s,this.outputNames);p=[];for(let g=0;g<f.length;++g)p.push(await qI(h[g],null,f[g]))}return[c,h,p]}testLoop(e,t,r,s=0,o){return Pt(()=>{const l=this.checkNumSamples(t,r,o,"steps"),c=[];if(s>0)throw new Zt("Verbose mode is not implemented yet.");if(o!=null)throw new Zt("steps mode in testLoop() is not implemented yet");{const h=Sw(l,r),p=tl(os(0,l));for(let f=0;f<h.length;++f){const g=h[f][0],v=h[f][1],w=un(p,g,v-g),R=Iw(t,w),P=e(R);if(f===0)for(let z=0;z<P.length;++z)c.push(xs(0));for(let z=0;z<P.length;++z){const G=P[z];c[z]=Hn(c[z],St(v-g,G))}}for(let f=0;f<c.length;++f)c[f]=rr(c[f],l)}return c})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let o=s;if(pn(e,s)>1){const l=pn(e.slice(0,r),s);o+=`_${l}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),l=[],c=()=>{const f=[];for(let R=0;R<this.inputs.length;++R)f.push({key:this.inputs[R],value:r[R]});const g=new Zd(f),v=mA(this.outputs,g,{training:!0});let w;for(let R=0;R<this.lossFunctions.length;++R){const P=this.lossFunctions[R];let z=P(s[R],v[R]);o[R]!=null&&(z=CB(z,o[R]));const G=Na(z);t.push(G),R===0?w=z:w=Hn(w,z)}for(let R=0;R<this.metricsTensors.length;++R){let P;if(this.outputs.length>1&&R<this.outputs.length)P=t[R];else{const z=this.metricsTensors[R][0],G=this.metricsTensors[R][1];P=Na(z(s[G],v[G]))}bl(P),l.push(P)}return w=Na(w),this.calculateLosses().forEach(R=>{w=Hn(w,R)}),w},h=this.collectedTrainableWeights.map(f=>f.read()),p=!0;return[this.optimizer_.minimize(c,p,h)].concat(l)}}makeTestFunction(){this.testFunction=e=>Pt(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),l=[];for(let p=0;p<this.inputs.length;++p)l.push({key:this.inputs[p],value:s[p]});const c=new Zd(l),h=mA(this.outputs,c);for(let p=0;p<this.lossFunctions.length;++p){const f=this.lossFunctions[p],g=Na(f(o[p],h[p]));p===0?r=g:r=Hn(r,g),t.push(r)}for(let p=0;p<this.metricsTensors.length;++p){const f=this.metricsTensors[p][0],g=this.metricsTensors[p][1],v=Na(f(o[g],h[g]));t.push(v)}return t})}async fit(e,t,r={}){return RB(this,e,t,r)}async fitDataset(e,t){return IB(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],o=r[1],l=this.makeTrainFunction()(s.concat(o)),c=[];for(const h of l){const p=await h.data();c.push(p[0])}return Hr(l),mu(r[0],e),mu(r[1],t),Rn(c)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,o=this.getWeights(r);for(let l=0;l<s.length;++l)r&&!s[l].trainable||t.push({name:s[l].originalName,tensor:o[l]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=Of().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Of().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Jt(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Jt(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=Jt(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Jt(gy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Jt(gy(e)));{const e={};for(const t in this.metrics)e[t]=Jt(gy(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Cw(e.optimizer_config),r=jh(t);let s;if(typeof e.loss=="string")s=Ei(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(l=>Ei(l));else if(e.loss!=null){s={};for(const l in e.loss)s[l]=Ei(e.loss[l])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(l=>Ei(l));else if(e.metrics!=null){o={};for(const l in e.metrics)o[l]=Ei(e.metrics[l])}this.compile({loss:s,metrics:o,optimizer:r})}async save(e,t){if(typeof e=="string"){const c=Cb(e);if(c.length===0)throw new je(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new je(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new je("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await e1(this.getNamedWeights(t)),s=!1,o=null,l={modelTopology:this.toJSON(o,s),format:NB,generatedBy:`TensorFlow.js tfjs-layers v${YI}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:h,specs:p}=await e1(await this.optimizer.getWeights(),c);r.specs.push(...p),r.data=t1([r.data,h])}return this.userDefinedMetadata!=null&&($I(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=r.data,l.weightSpecs=r.specs,e.save(l)}setUserDefinedMetadata(e){$I(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Ym.className="Model",Nn(Ym);class oS extends Ym{}oS.className="Functional",Nn(oS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class bA extends Ym{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Xn("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(t=>t<0))throw new je(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof bA||e instanceof Ym;let r;if(t){if(r=e,r.outputs.length!==1)throw new je("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new je("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new je("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=PR({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new je(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new je("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=BI(this.outputs[0])}this.inboundNodes=[],new oy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:xi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ds(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ym({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new bn("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new bn("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new bn("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new bn("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let o,l={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new je("Legacy serialization format not supported yet.");o=t}else C(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,l=t;const c=new e(l);if(!(c instanceof bA))throw new Zt(`Sequential.fromConfig called on non-Sequential input: ${c}`);for(const h of o){const p=jh(h,void 0,s);s&&p.setFastWeightInitDuringBuild(!0),c.add(p)}return c}set stopTraining(e){if(this.model==null)throw new je("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new je("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}bA.className="Sequential",Nn(bA);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let El=class extends Id{getConfig(){return{}}};class lS extends El{apply(e,t=1){return du(e,t)}}lS.className="elu",Nn(lS);class cS extends El{apply(e){return hv(e)}}cS.className="selu",Nn(cS);class uS extends El{apply(e){return Vu(e)}}uS.className="relu",Nn(uS);class hS extends El{apply(e){return Pt(()=>tm(6,Vu(e)))}}hS.className="relu6",Nn(hS);class dS extends El{apply(e){return e}}dS.className="linear",Nn(dS);class pS extends El{apply(e){return xp(e)}}pS.className="sigmoid",Nn(pS);class fS extends El{apply(e){return ls(e)}}fS.className="hardSigmoid",Nn(fS);class mS extends El{apply(e){return wp(e)}}mS.className="softplus",Nn(mS);class gS extends El{apply(e){return Qh(e)}}gS.className="softsign",Nn(gS);class AS extends El{apply(e){return w1(e)}}AS.className="tanh",Nn(AS);let Mw=class extends El{apply(i,e=-1){return S0(i,e)}};Mw.className="softmax",Nn(Mw);class vS extends El{apply(e,t=-1){return em(e,t)}}vS.className="logSoftmax",Nn(vS);class yS extends El{apply(e,t=1){return Pt(()=>St(xp(St(e,t)),e))}}yS.className="swish",Nn(yS);class bS extends El{apply(e){return Pt(()=>St(e,w1(wp(e))))}}bS.className="mish",Nn(bS);function $d(i){return i.getClassName()}function _w(i,e={}){return Mr(i,Gl.getMap().classNameMap,e,"activation")}function jd(i){if(i==null){const e={};return e.className="linear",e.config={},_w(e)}if(typeof i=="string"){const e={};return e.className=i,e.config={},_w(e)}else return i instanceof El?i:_w(i)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function FB(i){if(i!=null&&typeof i!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${i}`)}class xS extends Id{}class CS extends xS{constructor(e){super(),FB(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Pt(()=>{let t=eo([1]);return this.hasL1&&(t=Hn(t,Ji(St(this.l1,Ro(e))))),this.hasL2&&(t=Hn(t,Ji(St(this.l2,Zr(e))))),kt(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}CS.className="L1L2",Nn(CS);const wS={l1l2:"L1L2"};function Zs(i){return tr(i)}function ES(i,e={}){return Mr(i,Gl.getMap().classNameMap,e,"regularizer")}function ya(i){if(i==null)return null;if(typeof i=="string"){const e={className:i in wS?wS[i]:i,config:{}};return ES(e)}else return i instanceof xS?i:ES(i)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class IS extends cs{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=kr(e);let r=Vu(e);return this.maxValue!=null&&(r=Ja(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}IS.className="ReLU",Nn(IS);class SS extends cs{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=kr(e);return l0(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}SS.className="LeakyReLU",Nn(SS);class TS extends cs{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=va(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=ya(e.alphaRegularizer),this.alphaConstraint=mo(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new je(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ds(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new po({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=kr(e),lm(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Sa(this.alphaInitializer),alphaRegularizer:Zs(this.alphaRegularizer),alphaConstraint:fo(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}TS.className="PReLU",Nn(TS);let MS=class extends cs{constructor(i){if(super(i??{}),this.DEFAULT_ALPHA=1,i==null&&(i={}),i.alpha!=null&&i.alpha!==this.DEFAULT_ALPHA)throw new Zt(`Non-default alpha value (${i.alpha}) is not supported by the ELU layer yet.`);this.alpha=i.alpha==null?this.DEFAULT_ALPHA:i.alpha}call(i,e){const t=kr(i);return jf(t)}computeOutputShape(i){return i}getConfig(){const i={alpha:this.alpha},e=super.getConfig();return Object.assign(i,e),i}};MS.className="ELU",Nn(MS);class _S extends cs{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=kr(e);return St(r,wi(Cl(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}_S.className="ThresholdedReLU",Nn(_S);class RS extends cs{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Mw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){const r=kr(e);return this.softmax(r,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}RS.className="Softmax",Nn(RS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Jm(i,e,t){if(typeof i=="number")return xi(i,e);if(i.length!==e)throw new je(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${i.length} elements.`);for(let r=0;r<e;++r){const s=i[r];if(!Ms(s))throw new je(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(i)} including a non-integer number ${s}`)}return i}function gu(i,e,t,r,s=1){if(i==null)return i;const o=e+(e-1)*(s-1);let l;return t==="same"?l=i:l=i-o+1,Math.floor((l+r-1)/r)}function Ju(i,e,t,r){if(i==null)return null;if(r==="valid")i=i*e+nl([t-e,0]);else if(r==="same")i=i*e;else throw new je(`Unsupport padding mode: ${r}.`);return i}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Rw(i,e){return Pt(()=>(Bi(e),e==="channelsFirst"?Yr(i,[0,2,3,1]):i))}function BS(i,e){return Pt(()=>(Bi(e),e==="channelsFirst"?Yr(i,[0,2,3,4,1]):i))}function PB(i,e,t,r=1,s="valid",o,l=1){return Pt(()=>{if(o==null&&(o=Hl()),Bi(o),i.shape.length!==3)throw new je(`The input of a conv1dWithBias operation should be 3, but is ${i.shape.length} instead.`);if(e.shape.length!==3)throw new je(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new je(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(o==="channelsFirst"&&(i=Yr(i,[0,2,1])),s==="causal")throw new Zt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let c=_1(i,e,r,s==="same"?"same":"valid","NWC",l);return t!=null&&(c=Aa(c,t)),c})}function kS(i,e,t,r=[1,1],s="valid",o,l,c=null){return Pt(()=>{if(o==null&&(o=Hl()),Bi(o),i.rank!==3&&i.rank!==4)throw new je(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${i.rank}.`);if(e.rank!==3&&e.rank!==4)throw new je(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${i.rank}.`);let h=Rw(i,o);if(s==="causal")throw new Zt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return h=Mm({x:h,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:l,dataFormat:"NHWC",bias:t,activation:c}),o==="channelsFirst"&&(h=Yr(h,[0,3,1,2])),h})}function OB(i,e,t,r=[1,1,1],s="valid",o,l){return Pt(()=>{if(o==null&&(o=Hl()),Bi(o),i.rank!==4&&i.rank!==5)throw new je(`conv3dWithBias expects input to be of rank 4 or 5, but received ${i.rank}.`);if(e.rank!==4&&e.rank!==5)throw new je(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${i.rank}.`);let c=BS(i,o);if(s==="causal")throw new Zt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return c=Lx(c,e,r,s==="same"?"same":"valid","NDHWC",l),t!=null&&(c=Aa(c,t)),o==="channelsFirst"&&(c=Yr(c,[0,4,1,2,3])),c})}class vy extends cs{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",vy.verifyArgs(t),this.rank=e,ki(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Zt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Jm(t.kernelSize,e,"kernelSize"),this.strides=Jm(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,zi(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Bi(this.dataFormat),this.activation=jd(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=va(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=mo(t.biasConstraint),this.biasRegularizer=ya(t.biasRegularizer),this.activityRegularizer=ya(t.activityRegularizer),this.dilationRate=Jm(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new je(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new je(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new je(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(li("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!wr(e.kernelSize,"number",1,3))throw new je(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:$d(this.activation),useBias:this.useBias,biasInitializer:Sa(this.biasInitializer),biasRegularizer:Zs(this.biasRegularizer),activityRegularizer:Zs(this.activityRegularizer),biasConstraint:fo(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class qm extends vy{constructor(e,t){super(e,t),this.kernel=null,qm.verifyArgs(t),this.filters=t.filters,ki(this.filters,"filters"),this.kernelInitializer=va(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=mo(t.kernelConstraint),this.kernelRegularizer=ya(t.kernelRegularizer)}build(e){e=Ds(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new je(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return Pt(()=>{e=kr(e);let r;const s=this.bias==null?null:this.bias.read(),o=Ts(this.activation.getClassName());if(o!=null&&this.rank===2)r=kS(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)r=PB(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=kS(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=OB(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Zt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=Ds(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<r.length;++o){const l=gu(r[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(l)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:Sa(this.kernelInitializer),kernelRegularizer:Zs(this.kernelRegularizer),kernelConstraint:fo(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new je(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class xA extends qm{constructor(e){super(2,e),xA.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!wr(e.kernelSize,"number",1,2))throw new je(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}xA.className="Conv2D",Nn(xA);class CA extends qm{constructor(e){super(3,e),CA.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new je(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}CA.className="Conv3D",Nn(CA);class LS extends xA{constructor(e){if(super(e),this.inputSpec=[new po({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new je(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ds(e),e.length!==4)throw new je("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new je("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new po({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return Pt(()=>{let r=kr(e);if(r.shape.length!==4)throw new je(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,o=s[0];let l,c;this.dataFormat==="channelsFirst"?(l=2,c=3):(l=1,c=2);const h=s[l],p=s[c],f=this.kernelSize[0],g=this.kernelSize[1],v=this.strides[0],w=this.strides[1],R=Ju(h,v,f,this.padding),P=Ju(p,w,g,this.padding),z=[o,R,P,this.filters];this.dataFormat!=="channelsLast"&&(r=Yr(r,[0,2,3,1]));let G=R1(r,this.kernel.read(),z,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(G=Yr(G,[0,3,1,2])),this.bias!=null&&(G=Aa(G,this.bias.read(),this.dataFormat)),this.activation!=null&&(G=this.activation.apply(G)),G})}computeOutputShape(e){e=Ds(e);const t=e.slice();let r,s,o;this.dataFormat==="channelsFirst"?(r=1,s=2,o=3):(r=3,s=1,o=2);const l=this.kernelSize[0],c=this.kernelSize[1],h=this.strides[0],p=this.strides[1];return t[r]=this.filters,t[s]=Ju(t[s],h,l,this.padding),t[o]=Ju(t[o],p,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}LS.className="Conv2DTranspose",Nn(LS);class DS extends CA{constructor(e){if(super(e),this.inputSpec=[new po({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new je(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ds(e),e.length!==5)throw new je("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new je("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new po({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return Pt(()=>{let r=kr(e);if(r.shape.length!==5)throw new je(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,o=s[0];let l,c,h;this.dataFormat==="channelsFirst"?(h=2,l=3,c=4):(h=1,l=2,c=3);const p=s[h],f=s[l],g=s[c],v=this.kernelSize[0],w=this.kernelSize[1],R=this.kernelSize[2],P=this.strides[0],z=this.strides[1],G=this.strides[2],X=Ju(p,P,v,this.padding),fe=Ju(f,z,w,this.padding),ge=Ju(g,G,R,this.padding),be=[o,X,fe,ge,this.filters];this.dataFormat!=="channelsLast"&&(r=Yr(r,[0,2,3,4,1]));let He=k1(r,this.kernel.read(),be,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(He=Yr(He,[0,4,1,2,3])),this.bias!==null&&(He=Aa(He,this.bias.read(),this.dataFormat)),this.activation!==null&&(He=this.activation.apply(He)),He})}computeOutputShape(e){e=Ds(e);const t=e.slice();let r,s,o,l;this.dataFormat==="channelsFirst"?(r=1,s=2,o=3,l=4):(r=4,s=1,o=2,l=3);const c=this.kernelSize[0],h=this.kernelSize[1],p=this.kernelSize[2],f=this.strides[0],g=this.strides[1],v=this.strides[2];return t[r]=this.filters,t[s]=Ju(t[s],f,c,this.padding),t[o]=Ju(t[o],g,h,this.padding),t[l]=Ju(t[l],v,p,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}DS.className="Conv3DTranspose",Nn(DS);class NS extends qm{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new je("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new je("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new je(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=va(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=ya(t.depthwiseRegularizer),this.depthwiseConstraint=mo(t.depthwiseConstraint),this.pointwiseInitializer=va(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=ya(t.pointwiseRegularizer),this.pointwiseConstraint=mo(t.pointwiseConstraint)}build(e){if(e=Ds(e),e.length<this.rank+2)throw new je(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new je(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),o=[];for(let c=0;c<this.rank;++c)o.push(1);o.push(r*this.depthMultiplier,this.filters);const l=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,l,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,l,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,l,this.biasConstraint):this.bias=null,this.inputSpec=[new po({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return Pt(()=>{e=kr(e);let r;if(this.rank===1)throw new Zt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Yr(e,[0,2,3,1])),r=Bp(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Aa(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Yr(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Sa(this.depthwiseInitializer),e.pointwiseInitializer=Sa(this.pointwiseInitializer),e.depthwiseRegularizer=Zs(this.depthwiseRegularizer),e.pointwiseRegularizer=Zs(this.pointwiseRegularizer),e.depthwiseConstraint=fo(this.depthwiseConstraint),e.pointwiseConstraint=fo(this.pointwiseConstraint),e}}NS.className="SeparableConv";class FS extends NS{constructor(e){super(2,e)}}FS.className="SeparableConv2D",Nn(FS);class yy extends qm{constructor(e){super(1,e),yy.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!wr(e.kernelSize,"number",1,1))throw new je(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}yy.className="Conv1D",Nn(yy);class PS extends cs{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Pt(()=>{if(e=kr(e),this.dataFormat==="channelsLast"){const r=In(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return In(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=In(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return In(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}PS.className="Cropping2D",Nn(PS);class OS extends cs{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bi(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Ki(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return Pt(()=>{let r=kr(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=Yr(r,[0,2,3,1]);const o=this.size[0]*s[2],l=this.size[1]*s[3],c=this.interpolation==="nearest"?Xu.resizeNearestNeighbor(r,[o,l]):Xu.resizeBilinear(r,[o,l]);return Yr(c,[0,3,1,2])}else{const o=this.size[0]*s[1],l=this.size[1]*s[2];return this.interpolation==="nearest"?Xu.resizeNearestNeighbor(r,[o,l]):Xu.resizeBilinear(r,[o,l])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}OS.className="UpSampling2D",Nn(OS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function GB(i,e,t=[1,1],r="valid",s,o){return Pt(()=>{s==null&&(s=Hl()),Bi(s);let l=Rw(i,s);if(i.rank!==4)throw new je(`Input for depthwiseConv2d is required to be 4-D, but is instead ${i.rank}-D`);if(e.rank!==4)throw new je(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return l=r0(l,e,t,r==="same"?"same":"valid","NHWC",o),s==="channelsFirst"&&(l=Yr(l,[0,3,1,2])),l})}class GS extends vy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=va(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=mo(e.depthwiseConstraint),this.depthwiseRegularizer=ya(e.depthwiseRegularizer)}build(e){if(e=Ds(e),e.length<4)throw new je(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new je(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Pt(()=>{e=kr(e);let r=GB(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Aa(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=Ds(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=gu(t,this.kernelSize[0],this.padding,this.strides[0]),l=gu(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,o,l]:[e[0],o,l,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Sa(this.depthwiseInitializer),e.depthwiseRegularizer=Zs(this.depthwiseRegularizer),e.depthwiseConstraint=fo(this.depthwiseRegularizer),e}}GS.className="DepthwiseConv2D",Nn(GS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function US(i,e,t,r){if(Array.isArray(i)){if(e!=null||t!=null)throw new je("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=i.slice(i.length-r,i.length),i=i.slice(0,i.length-r)),i.length>1&&(e=i.slice(1,i.length)),i=i[0]}function s(o){return o==null||Array.isArray(o)?o:[o]}return e=s(e),t=s(t),{inputs:i,initialState:e,constants:t}}function VS(i,e,t,r=!1,s,o,l=!1,c=!1){return Pt(()=>{const h=e.shape.length;if(h<3)throw new je(`Input should be at least 3D, but is ${h}D.`);const p=[1,0].concat(os(2,h));if(e=Yr(e,p),o!=null)throw new Zt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");l&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=wi(wi(s,"bool"),"float32"),s.rank===h-1&&(s=xl(s,-1)),s=Yr(s,p)),r&&(e=zu(e,0),s!=null&&(s=zu(s,0)));const f=[];let g,v=t;const w=e.shape[0],R=Ud(e);let P;s!=null&&(P=Ud(s));for(let G=0;G<w;++G){const X=R[G],fe=Pt(()=>i(X,v));if(s==null)g=fe[0],v=fe[1];else{const ge=Pt(()=>{const be=P[G],He=mr(Co(be),be),Je=Hn(St(fe[0],be),St(v[0],He)),$e=v.map((rt,pt)=>Hn(St(fe[1][pt],be),St(rt,He)));return{output:Je,newStates:$e}});g=ge.output,v=ge.newStates}c&&f.push(g)}let z;return c&&(z=Vl(f,1)),[g,z,v]})}class Yd extends cs{constructor(e){super(e);let t;if(e.cell==null)throw new je("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Lw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new je("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new po({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return os(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){fw(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const o=[];for(const l of t)o.push([e[0],l]);return[s].concat(o)}else return s}computeMask(e,t){return Pt(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(o=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Zt("Constants support is not implemented in RNN yet.");fw(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new po({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!S(this.stateSpec.map(l=>l.shape[l.shape.length-1]),o))throw new je(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(l=>new po({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Pt(()=>{if(!this.stateful)throw new Qt("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new je("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>eo([r,s])):this.states_=[eo([r,this.cell.stateSize])];else if(e==null)Hr(this.states_),this.keptStates!=null&&(Hr(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>eo([r,s])):this.states_[0]=eo([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new je(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Hr(this.states_);for(let s=0;s<this.states_.length;++s){const o=e[s],l=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,c=[r,l];if(!S(o.shape,c))throw new je(`State ${s} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${o.shape}`);this.states_[s]=o}}this.states_=this.states_.map(s=>bl(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const o=US(e,r,s,this.numConstants);e=o.inputs,r=o.initialState,s=o.constants;let l=[],c=[];if(r!=null){t.initialState=r,l=l.concat(r),this.stateSpec=[];for(const h of r)this.stateSpec.push(new po({shape:h.shape}));c=c.concat(this.stateSpec)}if(s!=null&&(t.constants=s,l=l.concat(s),this.numConstants=s.length),l[0]instanceof Yu){const h=[e].concat(l),p=this.inputSpec.concat(c),f=this.inputSpec;this.inputSpec=p;const g=super.apply(h,t);return this.inputSpec=f,g}else return super.apply(e,t)}call(e,t){return Pt(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let o=t==null?null:t.initialState;e=kr(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const l=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==l)throw new je(`RNN Layer has ${l} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const c={training:s},h=VS((w,R)=>{const P=this.cell.call([w].concat(R),c);return[P[0],P.slice(1)]},e,o,this.goBackwards,r,null,this.unroll,this.returnSequences),p=h[0],f=h[1],g=h[2];this.stateful&&this.resetStates(g,s);const v=this.returnSequences?f:p;return this.returnState?[v].concat(g):v})}getInitialState(e){return Pt(()=>{let t=eo(e.shape);return t=Ji(t,[1,2]),t=ef(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?Ur(t,[1,r]):t):this.cell.stateSize>1?[Ur(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Yd.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}static fromConfig(e,t,r={}){const s=t.cell,o=jh(s,r);return new e(Object.assign(t,{cell:o}))}}Yd.className="RNN",Nn(Yd);class by extends cs{}class Bw extends by{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ki(this.units,"units"),this.activation=jd(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=va(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=va(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=va(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ya(e.kernelRegularizer),this.recurrentRegularizer=ya(e.recurrentRegularizer),this.biasRegularizer=ya(e.biasRegularizer),this.kernelConstraint=mo(e.kernelConstraint),this.recurrentConstraint=mo(e.recurrentConstraint),this.biasConstraint=mo(e.biasConstraint),this.dropout=Oa([1,nl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Oa([1,nl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ds(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Pt(()=>{if(e=e,e.length!==2)throw new je(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Jd({ones:()=>Co(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Jd({ones:()=>Co(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let o;const l=this.dropoutMask,c=this.recurrentDropoutMask;l!=null?o=Nr(St(e,l),this.kernel.read()):o=Nr(e,this.kernel.read()),this.bias!=null&&(o=Aa(o,this.bias.read())),c!=null&&(r=St(r,c));let h=Hn(o,Nr(r,this.recurrentKernel.read()));return this.activation!=null&&(h=this.activation.apply(h)),[h,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$d(this.activation),useBias:this.useBias,kernelInitializer:Sa(this.kernelInitializer),recurrentInitializer:Sa(this.recurrentInitializer),biasInitializer:Sa(this.biasInitializer),kernelRegularizer:Zs(this.kernelRegularizer),recurrentRegularizer:Zs(this.recurrentRegularizer),biasRegularizer:Zs(this.biasRegularizer),activityRegularizer:Zs(this.activityRegularizer),kernelConstraint:fo(this.kernelConstraint),recurrentConstraint:fo(this.recurrentConstraint),biasConstraint:fo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}Bw.className="SimpleRNNCell",Nn(Bw);class zS extends Yd{constructor(e){e.cell=new Bw(e),super(e)}call(e,t){return Pt(()=>{this.cell.dropoutMask!=null&&(Hr(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Hr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return new e(t)}}zS.className="SimpleRNN",Nn(zS);class kw extends by{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new je("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ki(this.units,"units"),this.activation=jd(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=jd(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=va(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=va(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=va(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=ya(e.kernelRegularizer),this.recurrentRegularizer=ya(e.recurrentRegularizer),this.biasRegularizer=ya(e.biasRegularizer),this.kernelConstraint=mo(e.kernelConstraint),this.recurrentConstraint=mo(e.recurrentConstraint),this.biasConstraint=mo(e.biasConstraint),this.dropout=Oa([1,nl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Oa([1,nl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ds(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Pt(()=>{if(e=e,e.length!==2)throw new je(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Jd({ones:()=>Co(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Jd({ones:()=>Co(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,l=this.recurrentDropoutMask;let c,h,p;0<this.dropout&&this.dropout<1&&(e=St(e,o[0]));let f=Nr(e,this.kernel.read());this.useBias&&(f=Aa(f,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=St(s,l[0]));const g=this.recurrentKernel.read(),[v,w]=Ho(g,[2*this.units,this.units],g.rank-1),R=Nr(s,v),[P,z,G]=Ho(f,3,f.rank-1),[X,fe]=Ho(R,2,R.rank-1);c=this.recurrentActivation.apply(Hn(P,X)),h=this.recurrentActivation.apply(Hn(z,fe));const ge=Nr(St(h,s),w);p=this.activation.apply(Hn(G,ge));const be=Hn(St(c,s),St(Hn(1,La(c)),p));return[be,be]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$d(this.activation),recurrentActivation:$d(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sa(this.kernelInitializer),recurrentInitializer:Sa(this.recurrentInitializer),biasInitializer:Sa(this.biasInitializer),kernelRegularizer:Zs(this.kernelRegularizer),recurrentRegularizer:Zs(this.recurrentRegularizer),biasRegularizer:Zs(this.biasRegularizer),activityRegularizer:Zs(this.activityRegularizer),kernelConstraint:fo(this.kernelConstraint),recurrentConstraint:fo(this.recurrentConstraint),biasConstraint:fo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}kw.className="GRUCell",Nn(kw);class WS extends Yd{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new kw(e),super(e)}call(e,t){return Pt(()=>{this.cell.dropoutMask!=null&&(Hr(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Hr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}WS.className="GRU",Nn(WS);class xy extends by{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ki(this.units,"units"),this.activation=jd(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=jd(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=va(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=va(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=va(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=ya(e.kernelRegularizer),this.recurrentRegularizer=ya(e.recurrentRegularizer),this.biasRegularizer=ya(e.biasRegularizer),this.kernelConstraint=mo(e.kernelConstraint),this.recurrentConstraint=mo(e.recurrentConstraint),this.biasConstraint=mo(e.biasConstraint),this.dropout=Oa([1,nl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Oa([1,nl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ds(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,l=this.units;s=new(t=class extends il{apply(c,h){const p=o.apply([l]),f=new pu().apply([l]),g=o.apply([l*2]);return _r(_r(p,f),g)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Pt(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new je(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Jd({ones:()=>Co(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Jd({ones:()=>Co(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=this.recurrentDropoutMask;let h,p,f,g;0<this.dropout&&this.dropout<1&&(e=St(e,l[0]));let v=Nr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=St(s,c[0])),v=Hn(v,Nr(s,this.recurrentKernel.read())),this.useBias&&(v=Aa(v,this.bias.read()));const[w,R,P,z]=Ho(v,4,v.rank-1);h=this.recurrentActivation.apply(w),p=this.recurrentActivation.apply(R),f=Hn(St(p,o),St(h,this.activation.apply(P))),g=this.recurrentActivation.apply(z);const G=St(g,this.activation.apply(f));return[G,G,f]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$d(this.activation),recurrentActivation:$d(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sa(this.kernelInitializer),recurrentInitializer:Sa(this.recurrentInitializer),biasInitializer:Sa(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Zs(this.kernelRegularizer),recurrentRegularizer:Zs(this.recurrentRegularizer),biasRegularizer:Zs(this.biasRegularizer),activityRegularizer:Zs(this.activityRegularizer),kernelConstraint:fo(this.kernelConstraint),recurrentConstraint:fo(this.recurrentConstraint),biasConstraint:fo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}xy.className="LSTMCell",Nn(xy);class HS extends Yd{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new xy(e),super(e)}call(e,t){return Pt(()=>{this.cell.dropoutMask!=null&&(Hr(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Hr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}HS.className="LSTM",Nn(HS);class Lw extends by{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Pt(()=>{e=e;let r=e.slice(1);const s=[];for(const c of this.cells.slice().reverse())Array.isArray(c.stateSize)?s.push(r.splice(0,c.stateSize.length)):s.push(r.splice(0,1));s.reverse();const o=[];let l;for(let c=0;c<this.cells.length;++c){const h=this.cells[c];r=s[c],c===0?l=[e[0]].concat(r):l=[l[0]].concat(r),l=h.call(l,t),o.push(l.slice(1))}r=[];for(const c of o.slice().reverse())r.push(...c);return[l[0]].concat(r)})}build(e){fw(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{da(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=s=>({className:s.getClassName(),config:s.getConfig()}),r={cells:this.cells.map(t)};return Object.assign({},e,r)}static fromConfig(e,t,r={}){const s=[];for(const o of t.cells)s.push(jh(o,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return mw(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,o=e.splice(s);for(let l=0;l<r.weights.length;++l)t.push([r.weights[l],o[l]])}gw(t)}}Lw.className="StackedRNNCells",Nn(Lw);function Jd(i){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:o}=i,l=()=>o!=null?o(e(),t):Ga(e(),t),c=()=>Zh(l,e,r);return!s||s<=1?bl(c().clone()):Array(s).fill(void 0).map(c).map(h=>bl(h.clone()))}/**
* @license
* Copyright 2020 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var UB=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};class KS extends Yd{constructor(e){if(e.unroll)throw new Zt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Zt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new po({ndim:5})]}call(e,t){return Pt(()=>{if(this.cell.dropoutMask!=null&&(Hr(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Hr(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new je("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Pt(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),o=[s[0],...s.slice(2)],l=eo(o);return Array.isArray(t)?Array(t.length).fill(l):[l]})}resetStates(e,t=!1){Pt(()=>{if(!this.stateful)throw new Qt("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),o=[s[0],...s.slice(2)];if(r[0]==null)throw new je("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>eo(o)):this.states_=[eo(o)];else if(e==null)Hr(this.states_),this.keptStates!=null&&(Hr(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>eo(o)):this.states_[0]=eo(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new je(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Hr(this.states_);for(let l=0;l<this.states_.length;++l){const c=e[l],h=o;if(!S(c.shape,h))throw new je(`State ${l} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>bl(l.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:o,strides:l,dilationRate:c}=this.cell,h=t==="channelsFirst",p=e[h?3:2],f=e[h?4:3],g=gu(p,s[0],o,l[0],c[0]),v=gu(f,s[1],o,l[1],c[1]);return[...e.slice(0,2),...h?[r,g,v]:[g,v,r]]}}KS.className="ConvRNN2D";class Dw extends xy{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:o,dataFormat:l,dilationRate:c}=e;super(Object.assign({},e,{units:t})),this.filters=t,ki(this.filters,"filters"),this.kernelSize=Jm(r,2,"kernelSize"),this.kernelSize.forEach(h=>ki(h,"kernelSize")),this.strides=Jm(s||1,2,"strides"),this.strides.forEach(h=>ki(h,"strides")),this.padding=o||"valid",zi(this.padding),this.dataFormat=l||"channelsLast",Bi(this.dataFormat),this.dilationRate=Jm(c||1,2,"dilationRate"),this.dilationRate.forEach(h=>ki(h,"dilationRate"))}build(e){var t;e=Ds(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new je(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],o=4,l=this.kernelSize.concat([s,this.filters*o]);this.kernel=this.addWeight("kernel",l,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const c=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",c,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let h;if(this.unitForgetBias){const p=this.biasInitializer,f=this.filters;h=new(t=class extends il{apply(g,v){const w=p.apply([f]),R=Nh([f]),P=p.apply([f*2]);return or([w,R,P])}},t.className="CustomInit",t)}else h=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,h,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Pt(()=>{if(e.length!==3)throw new je(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],o=e[1],l=e[2],c=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Jd({ones:()=>Co(s),rate:this.dropout,training:r,count:c,dropoutFunc:this.dropoutFunc}));const h=this.dropoutMask,p=(zn,Gn,$n)=>!Gn||!Gn[$n]?zn:St(Gn[$n],zn);let f=p(s,h,0),g=p(s,h,1),v=p(s,h,2),w=p(s,h,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Jd({ones:()=>Co(o),rate:this.recurrentDropout,training:r,count:c,dropoutFunc:this.dropoutFunc}));const R=this.recurrentDropoutMask;let P=p(o,R,0),z=p(o,R,1),G=p(o,R,2),X=p(o,R,3);const fe=3,[ge,be,He,Je]=Ho(this.kernel.read(),c,fe),[$e,rt,pt,Gt]=this.useBias?Ho(this.bias.read(),c):[null,null,null,null];f=this.inputConv(f,ge,$e,this.padding),g=this.inputConv(g,be,rt,this.padding),v=this.inputConv(v,He,pt,this.padding),w=this.inputConv(w,Je,Gt,this.padding);const[zt,Kt,tn,qt]=Ho(this.recurrentKernel.read(),c,fe);P=this.recurrentConv(P,zt),z=this.recurrentConv(z,Kt),G=this.recurrentConv(G,tn),X=this.recurrentConv(X,qt);const sn=this.recurrentActivation.apply(Hn(f,P)),xn=this.recurrentActivation.apply(Hn(g,z)),dn=Hn(St(xn,l),St(sn,this.activation.apply(Hn(v,G)))),Mn=St(this.recurrentActivation.apply(Hn(w,X)),this.activation.apply(dn));return[Mn,Mn,dn]})}getConfig(){const e=super.getConfig(),t=UB(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}inputConv(e,t,r,s){const o=Zc(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Aa(o,r,this.dataFormat):o}recurrentConv(e,t){return Zc(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Dw.className="ConvLSTM2DCell",Nn(Dw);class XS extends KS{constructor(e){const t=new Dw(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}XS.className="ConvLSTM2D",Nn(XS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Nw extends cs{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,o=this.getNoiseShape(r);return Zh(()=>Ga(r,this.rate,o,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Nw.className="Dropout",Nn(Nw);class QS extends Nw{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}QS.className="SpatialDropout1D",Nn(QS);class ZS extends cs{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,ki(this.units,"units"),this.activation=jd(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=va(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=va(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=mo(e.kernelConstraint),this.biasConstraint=mo(e.biasConstraint),this.kernelRegularizer=ya(e.kernelRegularizer),this.biasRegularizer=ya(e.biasRegularizer),this.activityRegularizer=ya(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ds(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ds(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e),s=Ts(this.activation.getClassName());let o;return s!=null?o=Nr(r,this.kernel.read(),s,this.bias?this.bias.read():null):(o=Nr(r,this.kernel.read()),this.bias!=null&&(o=Aa(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:$d(this.activation),useBias:this.useBias,kernelInitializer:Sa(this.kernelInitializer),biasInitializer:Sa(this.biasInitializer),kernelRegularizer:Zs(this.kernelRegularizer),biasRegularizer:Zs(this.biasRegularizer),activityRegularizer:Zs(this.activityRegularizer),kernelConstraint:fo(this.kernelConstraint),biasConstraint:fo(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}ZS.className="Dense",Nn(ZS);class $S extends cs{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ds(e);for(const t of e.slice(1))if(t==null)throw new je(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ia(e,1)]}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);let r=kr(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let o=2;o<r.rank;++o)s.push(o);s.push(1),r=Yr(r,s)}return jt(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}$S.className="Flatten",Nn($S);class jS extends cs{constructor(e){super(e),this.supportsMasking=!0,this.activation=jd(e.activation)}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e);return this.activation.apply(r)})}getConfig(){const e={activation:$d(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}jS.className="Activation",Nn(jS);class YS extends cs{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Pt(()=>(e=kr(e),ow(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}YS.className="RepeatVector",Nn(YS);class JS extends cs{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let o=1,l=null;for(let h=0;h<s.length;++h){const p=s[h];if(this.isUnknown(p))if(l===null)l=h;else throw new je("Can only specifiy one unknown dimension.");else o*=p}const c=ia(e);if(l!==null){if(o===0||c%o!==0)throw new je(r);s[l]=c/o}else if(c!==o)throw new je(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e),s=r.shape,o=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return kt(r,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}JS.className="Reshape",Nn(JS);class qS extends cs{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=os(1,e.dims.length+1);if(!S(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new po({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ds(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return Yr(kr(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}qS.className="Permute",Nn(qS);class e3 extends cs{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=kr(e),s=-1;return jg(qc(r,this.maskValue),s)}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e),s=-1,o=!0,l=jg(qc(r,this.maskValue),s,o);return St(r,wi(l,r.dtype))})}}e3.className="Masking",Nn(e3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class t3 extends cs{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Vn(e.inputLength))}this.inputDim=e.inputDim,ki(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ki(this.outputDim,"outputDim"),this.embeddingsInitializer=va(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=ya(e.embeddingsRegularizer),this.activityRegularizer=ya(e.activityRegularizer),this.embeddingsConstraint=mo(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Pt(()=>this.maskZero?(e=kr(e),qc(e,ns(e))):null)}computeOutputShape(e){if(e=Ds(e),this.inputLength==null)return[...e,this.outputDim];const t=Vn(this.inputLength);if(t.length!==e.length-1)throw new je(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const o=t[s],l=e[s+1];if(o!=null&&l!=null&&o!==l)throw new je(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[r]=l),r++}}return[e[0],...t,this.outputDim]}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);let r=kr(e);r.dtype!=="int32"&&(r=qp(r,"int32"));const s=is(this.embeddings.read(),kt(r,[r.size]));return kt(s,Ds(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Sa(this.embeddingsInitializer),embeddingsRegularizer:Zs(this.embeddingsRegularizer),activityRegularizer:Zs(this.activityRegularizer),embeddingsConstraint:fo(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}t3.className="Embedding",Nn(t3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class rf extends cs{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Zt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const o=e[e.length-t.length+s],l=t[s];if(o==null||l==null||o<0||l<0)r.push(null);else if(o===1)r.push(l);else if(l===1)r.push(o);else{if(o!==l)throw new je("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(o)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ds(e)]),e=e,e.length<2)throw new je(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=qn(t),t.length>1)throw new je(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const l=e[o]==null?null:e[o].slice(1);r=this.computeElementwiseOpOutputShape(r,l)}const s=e.map(o=>o.length);e.indexOf(null)===-1&&qn(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Pt(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(o=>o.rank);if(s.indexOf(null)===-1){const o=nl(s);for(let l of e){const c=l.rank;for(let h=0;h<o-c;++h)l=ef(l,1);r.push(l)}return this.mergeFunction(r)}else{let o=!1;for(const h of e){const p=h.rank;if(p==null){const f=h.shape,g=f[0],v=f.slice(1).concat([g]);let w=kt(h,[g].concat(ia(f.slice(1))));w=Yr(w,[1,0]),w=kt(w,v),r.push(w),o=!0}else if(p>1){const f=os(1,p).concat([0]);r.push(Yr(h,f)),o=!0}else r.push(h)}let l=this.mergeFunction(r);const c=l.rank;if(o){if(c==null){const h=l.shape,p=h.length,f=h[p-1],g=[f].concat(h.slice(0,h.length-1));l=kt(Yr(kt(l,[-1,f]),[1,0]),g)}else if(c>1){const h=[c-1].concat(os(0,c-1));l=Yr(l,h)}}return l}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const o=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=qn(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return Pt(()=>{if(t==null)return null;if(!Array.isArray(t))throw new je("`mask` should be an Array");if(!Array.isArray(e))throw new je("`inputs` should be an Array");if(t.length!==e.length)throw new je(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:xl(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=jc(r,t[s]);return r})}}class n3 extends rf{constructor(e){super(e)}mergeFunction(e){return Pt(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Hn(t,e[r]);return t})}}n3.className="Add",Nn(n3);class i3 extends rf{constructor(e){super(e)}mergeFunction(e){return Pt(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=St(t,e[r]);return t})}}i3.className="Multiply",Nn(i3);class r3 extends rf{constructor(e){super(e)}mergeFunction(e){return Pt(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=Hn(t,e[r]);return St(1/e.length,t)})}}r3.className="Average",Nn(r3);class s3 extends rf{constructor(e){super(e)}mergeFunction(e){return Pt(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Yc(t,e[r]);return t})}}s3.className="Maximum",Nn(s3);class a3 extends rf{constructor(e){super(e)}mergeFunction(e){return Pt(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=tm(t,e[r]);return t})}}a3.className="Minimum",Nn(a3);class o3 extends rf{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new je("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const o=e[s].slice();o.splice(this.axis,1);let l=!1;for(const c of r)if(S(c,o)){l=!0;break}l||r.push(o)}if(r.length>1)throw new je("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Pt(()=>or(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new je("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const o of t.slice(1)){if(r[s]==null||o[s]==null){r[s]=null;break}r[s]+=o[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new je("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new je("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new je(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Pt(()=>{let r=!0;if(t.forEach(l=>{if(l!=null){r=!1;return}}),r)return null;const s=[];for(let l=0;l<e.length;++l)t[l]==null?s.push(wi(Co(e[l]),"bool")):t[l].rank<e[l].rank?s.push(xl(t[l],-1)):s.push(t[l]);const o=Jo(s,this.axis);return y1(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}o3.className="Concatenate",Nn(o3);function wA(i,e){for(;i<0;)i+=e;return i}function VB(i,e,t){if(i.shape.length>3||e.shape.length>3)throw new Zt("batchDot is not implemented for tensors of 4D or higher rank yet");if(C(i.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${i.shape.length}`),C(i.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),i.dtype==="complex64"||e.dtype==="complex64")throw new Zt("batchDot is not implemented for complex64-type Tensors yet.");const r=i.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const o=t;return Pt(()=>{let l;if(r>s){l=r-s;const h=[];for(let p=0;p<l;++p)h.push(1);e=kt(e,e.shape.concat(h))}else if(s>r){l=s-r;const h=[];for(let p=0;p<l;++p)h.push(1);i=kt(i,i.shape.concat(h))}else l=0;let c;if(i.shape.length===2&&e.shape.length===2)o[0]===o[1]?c=Ji(St(i,e),o[0]):c=Ji(St(Yr(i,[1,0]),e),o[1]);else{const h=o[0]!==i.shape.length-1,p=o[1]===e.shape.length-1;c=bs(i,e,h,p)}if(l>0){let h;r>s?h=r+s-3:h=r-1;const p=[];for(let f=h;f<h+l;++f)p.push(f);c=eu(c,p)}return c.shape.length===1&&(c=xl(c,1)),c})}class l3 extends rf{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){C(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new Zt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new je(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new je(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((o,l)=>wA(o,e[l].shape.length)):s=[wA(this.axes,t.shape.length),wA(this.axes,r.shape.length)],this.normalize&&(t=uy(t,s[0]),r=uy(r,s[1])),VB(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[wA(this.axes,e.length),wA(this.axes,t.length)],r}computeOutputShape(e){C(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new Zt("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const o=t.concat(r);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}l3.className="Dot",Nn(l3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class c3 extends cs{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e);return Zh(()=>Hn(Vr(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}c3.className="GaussianNoise",Nn(c3);class u3 extends cs{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Pt(()=>{this.invokeCallHook(e,t);const r=kr(e);return this.rate>0&&this.rate<1?Zh(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return St(r,Vr(r.shape,1,s))},()=>r,t.training||!1):r})}}u3.className="GaussianDropout",Nn(u3);class h3 extends cs{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||kr(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Pt(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Zh(()=>{const s=kr(e),o=1.6732632423543772,l=1.0507009873554805,c=-o*l;let h=Fu(Mp(r),this.rate);h=qp(h,"float32");const p=((1-this.rate)*(1+this.rate*c**2))**-.5,f=-p*c*this.rate,g=Hn(St(s,h),St(Hn(h,-1),c));return Hn(St(g,p),f)},()=>kr(e),t.training||!1)}return e})}}h3.className="AlphaDropout",Nn(h3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function EA(i,e,t,r,s,o=.001){let l;if(i.rank===2)l=xx(i,e,t,r,s,o);else if(i.rank===3)l=wx(i,e,t,r,s,o);else if(i.rank===4)l=Ix(i,e,t,r,s,o);else throw new Zt(`batchNormalization is not implemented for array of rank ${i.rank} yet`);return l}function zB(i,e,t,r,s=.001){return Pt(()=>{const o=Jc(i,r),l=o.mean,c=o.variance;return[EA(i,l,c,t,e,s),l,c]})}function WB(i,e,t,r,s=.001){return Pt(()=>{const o=Jc(i,r),l=o.mean,c=o.variance,h=[];for(const w of os(0,i.rank))r.indexOf(w)!==-1?h.push(1):h.push(i.shape[w]);const p=kt(l,h),f=kt(c,h),g=e==null?null:kt(e,h),v=t==null?null:kt(t,h);return[EA(i,p,f,v,g,s),l,c]})}function HB(i,e,t,r,s=.001){return S(r.slice().sort(),os(0,i.rank-1))?zB(i,e,t,r,s):WB(i,e,t,r,s)}class d3 extends cs{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=va(e.betaInitializer||"zeros"),this.gammaInitializer=va(e.gammaInitializer||"ones"),this.movingMeanInitializer=va(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=va(e.movingVarianceInitializer||"ones"),this.betaConstraint=mo(e.betaConstraint),this.gammaConstraint=mo(e.gammaConstraint),this.betaRegularizer=ya(e.betaRegularizer),this.gammaRegularizer=ya(e.gammaRegularizer)}build(e){e=Ds(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new je(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new po({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Pt(()=>{const r=t.training==null?!1:t.training,s=kr(e),o=s.shape,l=o.length,c=os(0,l),h=this.axis>=0?this.axis:this.axis+l;c.splice(h,1);const p=xi(1,l);p[h]=o[h];const f=c.slice();f.sort();const g=!S(f,os(0,l).slice(0,l-1)),v=()=>{if(g){const G=kt(this.movingMean.read(),p),X=kt(this.movingVariance.read(),p),fe=this.center?kt(this.beta.read(),p):null,ge=this.scale?kt(this.gamma.read(),p):null;return EA(s,G,X,fe,ge,this.epsilon)}else return EA(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return v();const[w,R,P]=HB(s,this.gamma.read(),this.beta.read(),c,this.epsilon),z=(G,X,fe)=>{Pt(()=>{const ge=1-fe,be=G.read(),He=St(mr(be,X),ge);G.write(mr(be,He))})};return z(this.movingMean,R,this.momentum),z(this.movingVariance,P,this.momentum),w})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sa(this.betaInitializer),gammaInitializer:Sa(this.gammaInitializer),movingMeanInitializer:Sa(this.movingMeanInitializer),movingVarianceInitializer:Sa(this.movingVarianceInitializer),betaRegularizer:Zs(this.betaRegularizer),gammaRegularizer:Zs(this.gammaRegularizer),betaConstraint:fo(this.betaConstraint),gammaConstraint:fo(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}d3.className="BatchNormalization",Nn(d3);class p3 extends cs{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=va(e.betaInitializer||"zeros"),this.gammaInitializer=va(e.gammaInitializer||"ones"),this.betaRegularizer=ya(e.betaRegularizer),this.gammaRegularizer=ya(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ds(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==qn(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(o=>e[o]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=kr(e),s=r.shape,o=s.length;return Pt(()=>{let{mean:l,variance:c}=Jc(r,this.axis,!0);const h=xi(1,o);for(const R of this.axis)h[R]=s[R];const p=R=>R!=null&&R.shape.length!==o?kt(R,h):R;let f=this.scale?p(this.gamma.read()):null,g=this.center?p(this.beta.read()):null;const v=[],w=[];for(let R=0;R<o;++R)this.axis.indexOf(R)!==-1?(v.push(s[R]),w.push(1)):(v.push(1),w.push(s[R]));return l=Ul(l,v),c=Ul(c,v),f!=null&&(f=Ul(f,w)),g!=null&&(g=Ul(g,w)),EA(r,l,c,g,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sa(this.betaInitializer),gammaInitializer:Sa(this.gammaInitializer),betaRegularizer:Zs(this.betaRegularizer),gammaRegularizer:Zs(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}p3.className="LayerNormalization",Nn(p3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function KB(i,e,t){return Pt(()=>{if(i.rank!==4)throw new je(`temporalPadding expects input tensor to be 4-D, but received a ${i.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new je("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Hl()),t!=="channelsLast"&&t!=="channelsFirst")throw new je(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],Ou(i,r)})}class f3 extends cs{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Hl():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new je(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new je(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new je(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new po({ndim:4})]}computeOutputShape(e){e=Ds(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return Pt(()=>KB(kr(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}f3.className="ZeroPadding2D",Nn(f3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Cy(i,e,t,r,s,o){return Pt(()=>{Bi(s),ar(o),zi(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=Hl()),o==null&&(o="max"),i=Rw(i,s);let l;const c=r==="same"?"same":"valid";return o==="max"?l=p0(i,e,t,c):l=C1(i,e,t,c),s==="channelsFirst"&&(l=Yr(l,[0,3,1,2])),l})}function m3(i,e,t,r,s,o){return Pt(()=>{Bi(s),ar(o),zi(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=Hl()),o==null&&(o="max"),i=BS(i,s);let l;const c=r==="same"?"same":"valid";return o==="max"?l=M2(i,e,t,c):l=xI(i,e,t,c),s==="channelsFirst"&&(l=Yr(l,[0,4,1,2,3])),l})}class g3 extends cs{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new je(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ki(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new je(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ki(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,zi(this.padding),this.inputSpec=[new po({ndim:3})]}computeOutputShape(e){e=Ds(e);const t=gu(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Pt(()=>{this.invokeCallHook(e,t),e=ef(kr(e),2);const r=this.poolingFunction(kr(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return eu(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class A3 extends g3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),Cy(e,t,r,s,o,"max")}}A3.className="MaxPooling1D",Nn(A3);class v3 extends g3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),Cy(e,t,r,s,o,"avg")}}v3.className="AveragePooling1D",Nn(v3);class y3 extends cs{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new je(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ki(this.poolSize,"poolSize"),ki(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bi(this.dataFormat),zi(this.padding),this.inputSpec=[new po({ndim:4})]}computeOutputShape(e){e=Ds(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=gu(t,this.poolSize[0],this.padding,this.strides[0]),r=gu(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return Pt(()=>(this.invokeCallHook(e,t),this.poolingFunction(kr(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class b3 extends y3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),Cy(e,t,r,s,o,"max")}}b3.className="MaxPooling2D",Nn(b3);class x3 extends y3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),Cy(e,t,r,s,o,"avg")}}x3.className="AveragePooling2D",Nn(x3);class C3 extends cs{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new je(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ki(this.poolSize,"poolSize"),ki(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bi(this.dataFormat),zi(this.padding),this.inputSpec=[new po({ndim:5})]}computeOutputShape(e){e=Ds(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=gu(t,this.poolSize[0],this.padding,this.strides[0]),r=gu(r,this.poolSize[1],this.padding,this.strides[1]),s=gu(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return Pt(()=>(this.invokeCallHook(e,t),this.poolingFunction(kr(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class w3 extends C3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),m3(e,t,r,s,o,"max")}}w3.className="MaxPooling3D",Nn(w3);class E3 extends C3{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return Bi(o),zi(s),m3(e,t,r,s,o,"avg")}}E3.className="AveragePooling3D",Nn(E3);class I3 extends cs{constructor(e){super(e),this.inputSpec=[new po({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Zt}}class S3 extends I3{constructor(e){super(e||{})}call(e,t){return Pt(()=>{const r=kr(e);return Na(r,1)})}}S3.className="GlobalAveragePooling1D",Nn(S3);class T3 extends I3{constructor(e){super(e||{})}call(e,t){return Pt(()=>{const r=kr(e);return wc(r,1)})}}T3.className="GlobalMaxPooling1D",Nn(T3);class M3 extends cs{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Bi(this.dataFormat),this.inputSpec=[new po({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Zt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class _3 extends M3{call(e,t){return Pt(()=>{const r=kr(e);return this.dataFormat==="channelsLast"?Na(r,[1,2]):Na(r,[2,3])})}}_3.className="GlobalAveragePooling2D",Nn(_3);class R3 extends M3{call(e,t){return Pt(()=>{const r=kr(e);return this.dataFormat==="channelsLast"?wc(r,[1,2]):wc(r,[2,3])})}}R3.className="GlobalMaxPooling2D",Nn(R3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class B3 extends cs{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,o=jh(s,r);delete t.layer;const l={layer:o};return Object.assign(l,t),new e(l)}}class k3 extends B3{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ds(e),e.length<3)throw new je(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ds(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return Pt(()=>(e=kr(e),VS((r,s)=>[kr(this.layer.call(r,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}k3.className="TimeDistributed",Nn(k3);function XB(i){mi(_n,"BidirectionalMergeMode",i)}const QB="concat";class L3 extends B3{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=jh(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=jh(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?QB:e.mergeMode,XB(this.mergeMode),e.weights)throw new Zt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,o;return this.returnState&&(o=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(o).concat(o.slice()):[r].concat(o).concat(o.slice()):Rn(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const o=US(e,r,s,this.numConstants);if(e=o.inputs,r=o.initialState,s=o.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const l=[],c=[];if(r!=null){const p=r.length;if(p%2>0)throw new je("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,l.push(...r);const f=r.map(g=>new po({shape:g.shape}));this.forwardLayer.stateSpec=f.slice(0,p/2),this.backwardLayer.stateSpec=f.slice(p/2),c.push(...f)}if(s!=null)throw new Zt("Support for constants in Bidirectional layers is not implemented yet.");const h=l[0]instanceof Yu;for(const p of l)if(p instanceof Yu!==h)throw new je("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(h){const p=[e].concat(l),f=this.inputSpec.concat(c),g=this.inputSpec;this.inputSpec=f;const v=super.apply(p,t);return this.inputSpec=g,v}else return super.apply(e,t)}call(e,t){return Pt(()=>{const r=t.initialState;let s,o;if(r==null)s=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const h=r.slice(0,r.length/2),p=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:h})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:p}))}let l;this.returnState&&(Array.isArray(s)&&(l=s.slice(1).concat(o.slice(1))),s=s[0],o=o[0]),this.returnSequences&&(o=zu(o,1));let c;return this.mergeMode==="concat"?c=or([s,o]):this.mergeMode==="sum"?c=Hn(s,o):this.mergeMode==="ave"?c=St(.5,Hn(s,o)):this.mergeMode==="mul"?c=St(s,o):this.mergeMode==null&&(c=[s,o]),this.returnState?this.mergeMode==null?c.concat(l):[c].concat(l):c})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){da(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),da(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=jh(t.layer);if(delete t.layer,t.numConstants!=null)throw new Zt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}L3.className="Bidirectional",Nn(L3);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class D3 extends cs{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Pt(()=>(e=kr(e),e.dtype!=="float32"&&(e=qp(e,"float32")),Hn(St(e,this.scale),this.offset)))}}D3.className="Rescaling",Nn(D3);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Ye().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,i=>{i&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var N3;(function(i){i[i.DT_INVALID=0]="DT_INVALID",i[i.DT_FLOAT=1]="DT_FLOAT",i[i.DT_DOUBLE=2]="DT_DOUBLE",i[i.DT_INT32=3]="DT_INT32",i[i.DT_UINT8=4]="DT_UINT8",i[i.DT_INT16=5]="DT_INT16",i[i.DT_INT8=6]="DT_INT8",i[i.DT_STRING=7]="DT_STRING",i[i.DT_COMPLEX64=8]="DT_COMPLEX64",i[i.DT_INT64=9]="DT_INT64",i[i.DT_BOOL=10]="DT_BOOL",i[i.DT_QINT8=11]="DT_QINT8",i[i.DT_QUINT8=12]="DT_QUINT8",i[i.DT_QINT32=13]="DT_QINT32",i[i.DT_BFLOAT16=14]="DT_BFLOAT16",i[i.DT_QINT16=15]="DT_QINT16",i[i.DT_QUINT16=16]="DT_QUINT16",i[i.DT_UINT16=17]="DT_UINT16",i[i.DT_COMPLEX128=18]="DT_COMPLEX128",i[i.DT_HALF=19]="DT_HALF",i[i.DT_RESOURCE=20]="DT_RESOURCE",i[i.DT_VARIANT=21]="DT_VARIANT",i[i.DT_UINT32=22]="DT_UINT32",i[i.DT_UINT64=23]="DT_UINT64",i[i.DT_FLOAT_REF=101]="DT_FLOAT_REF",i[i.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",i[i.DT_INT32_REF=103]="DT_INT32_REF",i[i.DT_UINT8_REF=104]="DT_UINT8_REF",i[i.DT_INT16_REF=105]="DT_INT16_REF",i[i.DT_INT8_REF=106]="DT_INT8_REF",i[i.DT_STRING_REF=107]="DT_STRING_REF",i[i.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",i[i.DT_INT64_REF=109]="DT_INT64_REF",i[i.DT_BOOL_REF=110]="DT_BOOL_REF",i[i.DT_QINT8_REF=111]="DT_QINT8_REF",i[i.DT_QUINT8_REF=112]="DT_QUINT8_REF",i[i.DT_QINT32_REF=113]="DT_QINT32_REF",i[i.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",i[i.DT_QINT16_REF=115]="DT_QINT16_REF",i[i.DT_QUINT16_REF=116]="DT_QUINT16_REF",i[i.DT_UINT16_REF=117]="DT_UINT16_REF",i[i.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",i[i.DT_HALF_REF=119]="DT_HALF_REF",i[i.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",i[i.DT_VARIANT_REF=121]="DT_VARIANT_REF",i[i.DT_UINT32_REF=122]="DT_UINT32_REF",i[i.DT_UINT64_REF=123]="DT_UINT64_REF"})(N3||(N3={}));var F3;(function(i){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(i.CheckpointFormatVersion||(i.CheckpointFormatVersion={}))})(F3||(F3={}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var P3;(function(i){i[i.FAIL=0]="FAIL",i[i.SHORTEST=1]="SHORTEST",i[i.LONGEST=2]="LONGEST"})(P3||(P3={}));/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ni(i,e){Array.isArray(i)||(i=[i]),i.forEach(t=>{t!=null&&C(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZB=bv;class wy extends Te{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new xe(this,ea())}nextDataId(){return wy.nextDataId++}write(e,t,r){this.firstUse&&(this.firstUse=!1,Ye().get("IS_NODE")&&Ao(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&de(r[0])){const o=r.map(l=>Go(l));s=this.write(o,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,o){this.data.set(e,{values:t,dtype:s,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),o=this.readSync(r.imag.dataId);return _c(s,o)}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Pl(s));return dr(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dr(e.shape,e.dtype,t)}makeOutput(e,t,r){return ea().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ao();return e(),{kernelMs:ao()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ni([e],"where");const t=this.readSync(e.dataId);return ZB(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}wy.nextDataId=0;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $B(i){const e=new Float32Array(i.length);for(let t=0;t<i.length;++t)e[t]=Math.abs(i[t]);return e}const jB={kernelName:Nt,backendName:"cpu",kernelFunc:i=>{const{x:e}=i.inputs,t=i.backend;Ni(e,"abs");let r=new Float32Array(b(e.shape));const s=t.data.get(e.dataId).values;return r=$B(s),t.makeOutput(r,e.shape,e.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function to(i){return(e,t,r,s,o)=>{const l=Ir(e,t),c=l.length,h=ze(l),p=b(l),f=W(o,p),g=e.length,v=t.length,w=ze(e),R=ze(t),P=ku(e,l),z=ku(t,l);if(P.length+z.length===0)for(let G=0;G<f.length;++G)f[G]=i(r[G%r.length],s[G%s.length]);else for(let G=0;G<f.length;++G){const X=Wn(G,c,h),fe=X.slice(-g);P.forEach(Je=>fe[Je]=0);const ge=yn(fe,g,w),be=X.slice(-v);z.forEach(Je=>be[Je]=0);const He=yn(be,v,R);f[G]=i(r[ge],s[He])}return[f,l]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xl(i){const{inputs:e,backend:t}=i,{real:r,imag:s}=e,o=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=t.makeTensorInfo(r.shape,"complex64"),h=t.data.get(c.dataId);return h.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",o),imag:t.makeTensorInfo(s.shape,"float32",l)},c}const YB={kernelName:Dr,backendName:"cpu",kernelFunc:Xl};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ey(i,e,t="float32"){if(t==="complex64"){const s=Ey(i,e,"float32"),o=Ey(i,e,"float32");return Xl({inputs:{real:s,imag:o},backend:i})}const r=fn(b(e),t);return i.makeTensorInfo(e,t,r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qu(i){const{inputs:e,backend:t}=i,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const JB={kernelName:_e,backendName:"cpu",kernelFunc:qu};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sf(i){const{inputs:e,backend:t}=i,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,o=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,o)}const qB={kernelName:up,backendName:"cpu",kernelFunc:sf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ek(i,e,t,r){if(r==="int32"){const s=Int32Array.from(i);return[e,"int32",s]}if(r==="bool"){const s=nc([0],t),[o,l]=to((c,h)=>c!==h?1:0)(e,[],i,s,"bool");return[l,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function qd(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{dtype:o}=r;if(o==="complex64"){if(s.dtype==="complex64")return qu({inputs:{x:s},backend:t});const f=Ey(t,s.shape,s.dtype),g=qd({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),v=Xl({inputs:{real:g,imag:f},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),v}if(s.dtype==="complex64"){const f=sf({inputs:{input:s},backend:t}),g=qd({inputs:{x:f},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(f),g}if(!ve(s.dtype,o)){const f=qu({inputs:{x:s},backend:t});return{dataId:f.dataId,shape:f.shape,dtype:o}}const l=t.data.get(s.dataId).values,[c,h,p]=ek(l,s.shape,s.dtype,o);return t.makeTensorInfo(c,h,p)}const tk={kernelName:_s,backendName:"cpu",kernelFunc:qd};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wo(i,e,t,r){return t==null?({inputs:s,backend:o})=>{const{a:l,b:c}=s,h=o;Ni([l,c],i);const p=h.data.get(l.dataId).values,f=h.data.get(c.dataId).values,g=l.dtype==="string"?Rc(p):p,v=l.dtype==="string"?Rc(f):f,w=r||l.dtype,[R,P]=e(l.shape,c.shape,g,v,w);return h.makeTensorInfo(P,w,R)}:({inputs:s,backend:o})=>{const{a:l,b:c}=s,h=o;if(l.dtype==="complex64"||c.dtype==="complex64"){const p=qd({inputs:{x:l},backend:h,attrs:{dtype:"complex64"}}),f=h.data.get(p.dataId),g=f.complexTensorInfos.real,v=f.complexTensorInfos.imag,w=h.data.get(g.dataId).values,R=h.data.get(v.dataId).values,P=qd({inputs:{x:c},backend:h,attrs:{dtype:"complex64"}}),z=h.data.get(P.dataId),G=z.complexTensorInfos.real,X=z.complexTensorInfos.imag,fe=h.data.get(G.dataId).values,ge=h.data.get(X.dataId).values,[be,He,Je]=t(l.shape,c.shape,w,R,fe,ge),$e=h.makeTensorInfo(Je,"float32",be),rt=h.makeTensorInfo(Je,"float32",He),pt=Xl({inputs:{real:$e,imag:rt},backend:h});return h.disposeIntermediateTensorInfo(p),h.disposeIntermediateTensorInfo(P),h.disposeIntermediateTensorInfo($e),h.disposeIntermediateTensorInfo(rt),pt}else{const p=h.data.get(l.dataId).values,f=h.data.get(c.dataId).values,g=r||l.dtype,[v,w]=e(l.shape,c.shape,p,f,g);return h.makeTensorInfo(w,g,v)}}}function Fw(i){return(e,t,r,s,o,l)=>{const c=Ir(e,t),h=b(c),p=c.length,f=ze(c),g=W("float32",h),v=W("float32",h),w=ku(e,c),R=ku(t,c),P=_c(r,s),z=_c(o,l),G=e.length,X=ze(e),fe=t.length,ge=ze(t);if(w.length+R.length===0)for(let be=0;be<g.length;be++){const He=be%P.length,Je=be%z.length,$e=i(P[He*2],P[He*2+1],z[Je*2],z[Je*2+1]);g[be]=$e.real,v[be]=$e.imag}else for(let be=0;be<g.length;be++){const He=Wn(be,p,f),Je=He.slice(-G);w.forEach(zt=>Je[zt]=0);const $e=yn(Je,G,X),rt=He.slice(-fe);R.forEach(zt=>rt[zt]=0);const pt=yn(rt,fe,ge),Gt=i(P[$e*2],P[$e*2+1],z[pt*2],z[pt*2+1]);g[be]=Gt.real,v[be]=Gt.imag}return[g,v,c]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nk=to((i,e)=>i+e),ik=Fw((i,e,t,r)=>({real:i+t,imag:e+r})),eg=wo(We,nk,ik),rk={kernelName:We,backendName:"cpu",kernelFunc:eg};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O3(i,e,t,r,s){const o=b(r),l=fn(s,t);for(let c=0;c<i.length;c++){const h=i[c];if(h<0)throw new Error("Input x must be non-negative!");h>=s||(o>0?l[h]+=e[c]:l[h]+=1)}return l}function sk(i,e,t,r=!1){const s=i.shape[0],o=i.shape[1],l=dr([s,t],e.dtype);for(let c=0;c<s;c++)for(let h=0;h<o;h++){const p=i.get(c,h);if(p<0)throw new Error("Input x must be non-negative!");p>=t||(r?l.set(1,c,p):e.size>0?l.set(l.get(c,p)+e.get(c,h),c,p):l.set(l.get(c,p)+1,c,p))}return l}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tg(i){return(e,t,r)=>{const s=W(t,e.length);for(let o=0;o<e.length;++o)s[o]=i(e[o],r);return s}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ns(i,e,t){return({inputs:r,attrs:s,backend:o})=>{const{x:l}=r;if(Ni(l,i),l.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");const c=o,h=c.data.get(l.dataId).values,p=b(l.shape),f=t||l.dtype,g=U(f,p);for(let v=0;v<p;++v)g[v]=e(h[v],s);return c.makeTensorInfo(l.shape,f,g)}}function ng(i,e,t){return({inputs:r,attrs:s,backend:o})=>{const{x:l}=r;if(Ni(l,i),l.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");const c=o,h=c.data.get(l.dataId).values,p=t||l.dtype,f=e(h,p,s);return c.makeTensorInfo(l.shape,p,f)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ak=tg(i=>Math.ceil(i)),ok=ng(Fs,ak),lk={kernelName:Fs,backendName:"cpu",kernelFunc:ok};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ck(i,e,t,r){const s=U(t,b(e));if(r&&t!=="string"){let o=0;i.forEach(l=>{const c=b(l.shape);s.set(l.vals,o),o+=c})}else{let o=0;i.forEach(l=>{const c=t==="string"?Rc(l.vals):l.vals;let h=0;for(let p=0;p<l.shape[0];++p){const f=p*e[1]+o;for(let g=0;g<l.shape[1];++g)s[f+g]=c[h++]}o+=l.shape[1]})}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uk=to((i,e)=>i===e?1:0),G3=wo(ir,uk,null,"bool"),hk={kernelName:ir,backendName:"cpu",kernelFunc:G3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dk=tg(i=>Math.exp(i)),U3=ng(us,dk,"float32"),pk={kernelName:us,backendName:"cpu",kernelFunc:U3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fk=tg(i=>Math.expm1(i)),mk=ng(pr,fk),gk={kernelName:pr,backendName:"cpu",kernelFunc:mk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ak=tg(i=>Math.floor(i)),vk=ng(di,Ak),yk={kernelName:di,backendName:"cpu",kernelFunc:vk};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bk(i,e,t,r,s,o,l,c,h){const p=dr([r,o],t);for(let f=0;f<r;f++){const g=[];let v=0;for(let w=0;w<s;w++){const R=i[f*s+w];v+=R*l[w],g.push(R)}if(v<0||v>=h/o)throw new Error(`Invalid indices: ${g} does not index into ${c}`);for(let w=0;w<o;w++)p.values[f*o+w]=e.get(...e.indexToLoc(v*o+w))}return p}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xk(i,e,t){const r=dr(t,i.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),l=o[0],c=o[2],h=e.locToIndex([l,c]);o[2]=e.values[h];const p=i.locToIndex(o);0<=p&&p<i.values.length&&(r.values[s]=i.values[p])}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ck=to((i,e)=>i>e?1:0),wk=wo(ce,Ck,null,"bool"),Ek={kernelName:ce,backendName:"cpu",kernelFunc:wk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ik=to((i,e)=>i>=e?1:0),Sk=wo(Ce,Ik,null,"bool"),Tk={kernelName:Ce,backendName:"cpu",kernelFunc:Sk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mk=to((i,e)=>i<e?1:0),_k=wo(rn,Mk,null,"bool"),Rk={kernelName:rn,backendName:"cpu",kernelFunc:_k};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bk=to((i,e)=>i<=e?1:0),kk=wo(Bn,Bk,null,"bool"),Lk={kernelName:Bn,backendName:"cpu",kernelFunc:kk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dk(i,e,t){const r=(e-i)/(t-1),s=fn(t,"float32");s[0]=i;for(let o=1;o<s.length;o++)s[o]=s[o-1]+r;return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Nk=tg(i=>Math.log(i)),Fk=ng(Ii,Nk),Pk={kernelName:Ii,backendName:"cpu",kernelFunc:Fk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ok(i,e,t,r){const s=W(r,b(t));for(let o=0;o<s.length;++o){const l=o*e;let c=i[l];for(let h=0;h<e;++h){const p=i[l+h];(Number.isNaN(p)||p>c)&&(c=p)}s[o]=c}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gk=to((i,e)=>Math.max(i,e)),Uk=wo(Ys,Gk),Vk={kernelName:Ys,backendName:"cpu",kernelFunc:Uk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zk=to((i,e)=>Math.min(i,e)),Wk=wo(dl,zk),Hk={kernelName:dl,backendName:"cpu",kernelFunc:Wk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const V3=to((i,e)=>i*e),Kk=Fw((i,e,t,r)=>({real:i*t-e*r,imag:i*r+e*t})),Iy=wo(fl,V3,Kk),Xk={kernelName:fl,backendName:"cpu",kernelFunc:Iy};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qk(i,e,t){const r=Ya(-1,t);return V3([],e,r,i,t)}function Zk(i){const{inputs:e,backend:t}=i,{x:r}=e;Ni(r,"neg");const s=t.data.get(r.dataId).values,[o,l]=Qk(s,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,o)}const $k={kernelName:_l,backendName:"cpu",kernelFunc:Zk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jk=to((i,e)=>i!==e?1:0),Yk=wo(Rl,jk,null,"bool"),Jk={kernelName:Rl,backendName:"cpu",kernelFunc:Yk};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z3(i,e,t,r,s){const o=e.length,l=b(e),c=ze(e),h=ze(s),p=W(t,b(s));for(let f=0;f<l;++f){const g=Wn(f,o,c),v=new Array(g.length);for(let R=0;R<v.length;R++)v[R]=g[r[R]];const w=yn(v,o,h);p[w]=i[f]}return p}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Il(i){const{inputs:e,attrs:t,backend:r}=i,{x:s}=e,{perm:o}=t;Ni(s,"transpose");const l=s.shape.length,c=new Array(l);for(let f=0;f<c.length;f++)c[f]=s.shape[o[f]];const h=r.data.get(s.dataId).values,p=z3(h,s.shape,s.dtype,o,c);return{dataId:r.write(p,c,s.dtype),shape:c,dtype:s.dtype}}const qk={kernelName:ma,backendName:"cpu",kernelFunc:Il};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eL(i,e,t,r){const[s,o]=Xa(i,r),l=Uo(e,"int32"),c=fn(b(s),l),h=b(o);for(let p=0;p<c.length;++p){const f=p*h;let g=1;for(let v=0;v<h;++v)g*=t[f+v];c[p]=g}return{outVals:c,outShape:s,outDtype:l}}function tL(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;Ni(s,"prod");const c=s.shape.length,h=J(o,s.shape),p=ha(h,c);let f=h,g=s;const v=[];p!=null&&(g=Il({inputs:{x:s},backend:t,attrs:{perm:p}}),v.push(g),f=wa(f.length,c));const w=t.data.get(g.dataId).values,{outVals:R,outShape:P,outDtype:z}=eL(g.shape,g.dtype,w,f);let G=P;return l&&(G=Da(P,h)),v.forEach(X=>t.disposeIntermediateTensorInfo(X)),t.makeTensorInfo(G,z,R)}const nL={kernelName:od,backendName:"cpu",kernelFunc:tL};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iL(i,e,t){i.forEach((r,s)=>{if(r<0||r>=t){const o=Wn(s,e.length,ze(e)).join(",");throw new Error(`indices[${o}] = ${r} is not in [0, ${t})`)}})}function rL(i,e){for(let t=0;t<i.length;++t){const r=i[t],s=t===i.length-1?e:i[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let o=1;o<r.length;++o)if(r[o-1]>r[o])throw new Error("Ragged splits must be sorted in ascending order")}}function sL(i,e,t,r){const s=[];let o=0;const l=e.length-1+t.length,c=new Array(l).fill(null).map(()=>[0]);rL(t,r);let h=1;for(let p=0;p<e.length-1;++p){h*=e[p];const f=e[p+1];for(let g=1;g<h+1;++g)c[p].push(g*f)}for(let p=0;p<i.length;++p){let f=i[p],g=i[p]+1;for(let v=0;v<t.length;++v){const w=t[v],R=v+e.length-1;if(R>=0){const P=c[R],z=P[P.length-1]-w[f];for(let G=f;G<g;++G)c[R].push(w[G+1]+z)}f=w[f],g=w[g]}g!==f&&(s.push([f,g]),o+=g-f)}return{outSplits:c,valueSlices:s,numValues:o}}function aL(i){const e=[];for(let t=0;t<i.length;++t){const r=i[t].length,s=U("int32",r);e.push(s),i[t].forEach((o,l)=>s[l]=o)}return e}function W3(i,e){const t=i.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<i.length;r++)t[e-1]*=i[r];return t}function oL(i,e,t,r,s,o){const l=W3(e,2)[1],c=W3(o,2)[1];let h=0;for(const p of t)for(let f=p[0];f<p[1];++f){for(let g=0;g<r;++g)s[h*c+g]=i[f*l+g];++h}}function lL(i,e,t,r,s){const o=e.slice();o[0]=s;const l=U(t,b(o)),c=i.length,h=c===0?0:c/e[0];return oL(i,e,r,h,l,o),[l,o]}function cL(i,e,t,r,s,o,l,c){if(i.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const h=e[0][0]-1;if(iL(o,l,h),r.length===0)throw new Error("params.rank must be nonzero");const p=r[0],{outSplits:f,valueSlices:g,numValues:v}=sL(o,l,i,p),w=aL(f),R=lL(t,r,s,g,v);return[w,R[0],R[1]]}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var kc=Wl;let uL=class KE{constructor(e,t,r,s,o,l,c,h,p,f){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=o,this.defaultValue=l,this.defaultValueShape=c,this.rowPartitionValues=h,this.rowPartitionValuesShapes=p,this.rowPartitionTypes=K0(f),this.raggedRank=X0(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===kc.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===kc.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case kc.VALUE_ROWIDS:return KE.getMaxWidthValueRowID(t);case kc.ROW_SPLITS:return KE.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${kc[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const o=e[s+1]-e[s];o>r&&(r=o)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],o=0;for(let l=1;l<t;++l){const c=e[l];c!==s&&(s=c,o=Math.max(l-r,o),r=l)}return Math.max(t-r,o)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return K3(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;Q0(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Kh(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let l=1;l<=this.raggedRank;++l)o[l]<0&&(o[l]=this.getMaxWidth(l));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),o=[];let l=0;for(let c=0;c<s;++c,l+=t)o.push(l);for(let c=s;c<e;++c)o.push(-1);return C(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,r,s){const o=e.length,l=[];for(let c=0;c<o-1;++c){const h=e[c+1]-e[c];let p=Math.min(s,h),f=t[c];f===-1&&(p=0);for(let g=0;g<p;++g)l.push(f),f+=r;for(let g=0;g<h-p;++g)l.push(-1)}if(o>0&&l.length!==e[o-1])throw new Error("Invalid row split size.");return l}calculateOutputIndexValueRowID(e,t,r,s){const o=e.length,l=[];if(o===0)return[];let c=0,h=e[0];if(h>=t.length)throw new Error(`Got currentValueRowId=${h}, which is not less than ${t.length}`);let p=t[h];l.push(p);for(let f=1;f<o;++f){const g=e[f];if(g===h)p>=0&&(++c,c<s?p+=r:p=-1);else{if(c=0,h=g,g>=t.length)throw new Error(`Got nextValueRowId=${g} which is not less than ${t.length}`);p=t[g]}l.push(p)}if(l.length!==e.length)throw new Error("Invalid row ids.");return l}calculateOutputIndex(e,t,r,s){const o=this.getRowPartitionTensor(e),l=this.getRowPartitionTypeByDimension(e);switch(l){case kc.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,r,s);case kc.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,r,s);default:throw new Error(`Unsupported partition type: ${kc[l]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case kc.FIRST_DIM_SIZE:return e[0];case kc.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case kc.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${kc[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*t[l+1];const s=K3(t,!1),o=U(this.valuesDType,b(s));if(r[0]*t[0]>0){let l=this.calculateFirstParentOutputIndex(e,r[0],t[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],t[c]);this.setOutput(this.raggedRank,l,o,s)}return[s,o]}setOutput(e,t,r,s){if(r.length===0)return;const o=this.values,l=r;let c=s.slice();c=c.slice(e+1);const h=b(c),p=t.length;let f=this.defaultValue;if(f.length!==h&&f.length!==1){const R=this.defaultValueShape;Pt(()=>{const P=kt(f,R);f=kh(P,c).dataSync()})}let g=0,v=0,w=0;for(let R=0;R<=p;++R){let P=R<p?t[R]:-1;if(P===w){++w;continue}if(v<w){const z=o.subarray(g*h),G=l.subarray(v*h),X=(w-v)*h;H3(G,z,X)}if(R>=p){const z=r.length;P=Math.floor(z/h)}if(P>w)if(this.defaultValue.length===1)l.subarray(w*h,P*h).fill(this.defaultValue[0]),w=P;else for(;P>w;){const z=l.slice(w*h);H3(z,f,h),++w}P<0?(g=R+1,v=w):(g=R,v=w,w=v+1)}}};function H3(i,e,t){for(let r=0;r<t;r++)i[r]=e[r]}function K3(i,e){const t=[];for(let r of i){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function hL(i,e,t,r,s,o,l,c,h,p){return new uL(i,e,t,r,s,o,l,c,h,p).compute()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dL(i,e,t,r){const s=i===e,o=i<e&&t<0,l=e<i&&t>1;if(s||o||l)return fn(0,r);const c=Math.abs(Math.ceil((e-i)/t)),h=fn(c,r);e<i&&t===1&&(t=-1),h[0]=i;for(let p=1;p<h.length;p++)h[p]=h[p-1]+t;return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pL=tg(i=>1/Math.sqrt(i)),fL=ng(Za,pL),mL={kernelName:Za,backendName:"cpu",kernelFunc:fL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IA(i,e,t,r,s,o,l,c,h,p){const f=[r/s,s],g=i.values,v=e.values;if(r===0)return dr(t,e.dtype);const w=dr(f,e.dtype);typeof h=="string"||typeof h=="number"?w.values.fill(h):typeof h=="boolean"&&w.values.fill(+h);for(let R=0;R<o;R++){const P=[];let z=0;for(let G=0;G<l;G++){const X=g[R*l+G];P.push(X),z+=X*c[G]}if(z<0||z>=r/s)throw new Error(`Invalid indices: ${P} does not index into ${t}`);for(let G=0;G<s;G++)p?w.values[z*s+G]+=v[R*s+G]:w.values[z*s+G]=e.rank===0?v[0]:v[R*s+G]}return w}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X3=Ns(fh,i=>1/(1+Math.exp(-i))),gL={kernelName:fh,backendName:"cpu",kernelFunc:X3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AL(i,e,t,r,s){const o=Uf(r,e,t),l=b(t),c=ze(r);if(o){const g=Vf(e,c);return s==="string"?i.slice(g,g+l):i.subarray(g,g+l)}const h=s==="string"?Rc(i):i,p=dr(r,s,h),f=dr(t,s);for(let g=0;g<f.size;++g){const v=f.indexToLoc(g),w=v.map((R,P)=>R+e[P]);f.set(p.get(...w),...v)}return s==="string"?Jp(f.values):f.values}function af(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{begin:o,size:l}=r;Ni(s,"slice");const[c,h]=zf(s,o,l);Qg(s,c,h);const p=t.data.get(s.dataId).values,f=AL(p,c,h,s.shape,s.dtype);return t.makeTensorInfo(h,s.dtype,f)}const vL={kernelName:mc,backendName:"cpu",kernelFunc:af};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yL(i,e,t,r,s,o,l){const c=e[0],h=o[0],p=new Array(h),f=new Array(c),g=e[1];if(h===0){if(c!==0)throw new Error(ou(c));const z=U(t,0),G=U(s,0);return[z,[0,g],G,p,f]}let v=!0,w=0;const R=new Array(h).fill(0);for(let z=0;z<c;++z){const G=i[z*g];if(G<0)throw new Error(sA(z,G));if(G>=h)throw new Error(Pm(z,G,h));++R[G],v=v&&G>=w,w=G}let P=!0;for(let z=0;z<h;++z){const G=R[z]===0;p[z]=G,P=P&&!G,R[z]=Math.max(R[z],1),z>0&&(R[z]+=R[z-1])}if(P&&v){const z=i,G=r;for(let X=0;X<c;++X)f[X]=X;return[z,[c,g],G,p,f]}else{const z=R[h-1],G=U(t,z*g),X=U(s,z),fe=new Array(h).fill(0);for(let ge=0;ge<c;++ge){const be=i[ge*g],He=fe[be],Je=(be===0?0:R[be-1])+He;fe[be]++;for(let $e=0;$e<g;++$e)G[Je*g+$e]=i[ge*g+$e];X[Je]=r[ge],f[ge]=Je}for(let ge=0;ge<h;++ge)if(fe[ge]===0){const be=ge===0?0:R[ge-1];G[be*g+0]=ge;for(let He=1;He<g;++He)G[be*g+He]=0;X[be]=l}return[G,[z,g],X,p,f]}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bL(i,e,t,r,s){const o=b(r),l=e[0],c=s.length,h=[];let p=1,f=-1;for(let P=0;P<c;++P){const z=s[P];if(z===-1){if(f!==-1)throw new Error(Om(f,P));f=P,h.push(1)}else{if(z<0)throw new Error(lu(P,z));p*=z,h.push(z)}}if(f!==-1){if(p<=0)throw new Error(Gm());const P=Math.trunc(o/p);if(p*P!==o)throw new Error(aA(r,h));h[f]=P}if(b(h)!==o)throw new Error(cu(r,h));const g=r.length,v=[];if(g>0){v[g-1]=1;for(let P=g-2;P>=0;--P)v[P]=v[P+1]*r[P+1]}const w=[];if(c>0){w[c-1]=1;for(let P=c-2;P>=0;--P)w[P]=w[P+1]*h[P+1]}const R=U(t,l*c);for(let P=0;P<l;++P){let z=0;for(let G=0;G<g;++G)z+=i[P*g+G]*v[G];for(let G=0;G<c;++G)R[P*c+G]=Math.trunc(z/w[G]),z%=w[G]}return[R,[l,c],h]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q3(i,e,t,r,s,o=!1,l=0){const c=r.length,h=[e[0],i.length/e[0]],p=h[1],f=c>0?s[c-1]+1:0;if(f<0)throw new Error(Yp());const g=e.slice();g[0]=f;const v=g.reduce((X,fe)=>X*fe,1),w=U(t,v);if(c===0)return f>0&&w.fill(l),[w,g];if(f<=0)throw new Error(Yp());let R=0,P=1,z=0,G=s[R];for(;;){let X=0;if(P<c){if(X=s[P],G===X){++P;continue}if(G>=X)throw new Error(Um())}if(G<0||G>=f)throw new Error(uu(G,f));G>z&&w.fill(l,z*p,G*p);for(let fe=R;fe<P;++fe){const ge=r[fe];if(ge<0||ge>=h[0])throw new Error(Vm(fe,r[fe],h[0]));for(let be=0;be<p;be++)w[G*p+be]+=i[ge*p+be]}if(o)for(let fe=0;fe<p;fe++)w[G*p+fe]/=P-R;if(R=P,++P,z=G+1,G=X,P>c)break}return z<f&&w.fill(l,z*p,f*p),[w,g]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xL=Ns(gh,i=>Math.sqrt(i)),CL={kernelName:gh,backendName:"cpu",kernelFunc:xL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wL=to((i,e)=>{const t=i-e;return t*t}),EL=wo(hs,wL),IL={kernelName:hs,backendName:"cpu",kernelFunc:EL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SL(i,e,t,r){const s=dr(i,e.dtype);for(let o=0;o<s.size;o++){const l=s.indexToLoc(o),c=new Array(l.length);for(let h=0;h<c.length;h++)c[h]=l[h]*t[h]+r[h];s.set(e.get(...c),...l)}return s}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let TL=class{constructor(i,e,t,r,s,o){this.separator=Go(i),this.nGramWidths=e,this.leftPad=Go(t),this.rightPad=Go(r),this.padWidth=s,this.preserveShort=o}getPadWidth(i){return Math.min(this.padWidth<0?i-1:this.padWidth,i-1)}getNumNGrams(i,e){const t=this.getPadWidth(e);return Math.max(0,i+2*t-e+1)}createNGrams(i,e,t,r,s,o){for(let l=0;l<s;++l){const c=this.getPadWidth(o),h=Math.max(0,c-l),p=Math.max(0,c-(s-(l+1))),f=o-(h+p),g=e+(h>0?0:l-c);let v=0;v+=h*this.leftPad.length;for(let G=0;G<f;++G)v+=i[g+G].length;v+=p*this.rightPad.length;const w=h+p+f-1;v+=w*this.separator.length,t[r+l]=new Uint8Array(v);const R=t[r+l];let P=0;const z=G=>G.forEach(X=>R[P++]=X);for(let G=0;G<h;++G)z(this.leftPad),z(this.separator);for(let G=0;G<f-1;++G)z(i[g+G]),z(this.separator);if(f>0){z(i[g+f-1]);for(let G=0;G<p;++G)z(this.separator),z(this.rightPad)}else{for(let G=0;G<p-1;++G)z(this.rightPad),z(this.separator);z(this.rightPad)}}}compute(i,e){const t=i.length,r=e.length;if(r>0){let c=e[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let h=1;h<r;++h){let p=e[h]>=c;if(p=p&&e[h]<=t,!p)throw new Error(`Invalid split value ${e[h]}, must be in [${c}, ${t}]`);c=e[h]}if(c!==t)throw new Error(`Last split value must be data size. Expected ${t}, got ${c}`)}const s=r-1,o=U("int32",r);if(t===0||r===0){const c=new Array(t);for(let h=0;h<=s;++h)o[h]=0;return[c,o]}o[0]=0;for(let c=1;c<=s;++c){const h=e[c]-e[c-1];let p=0;this.nGramWidths.forEach(f=>{p+=this.getNumNGrams(h,f)}),this.preserveShort&&h>0&&p===0&&(p=1),o[c]=o[c-1]+p}const l=new Array(o[s]);for(let c=0;c<s;++c){const h=e[c];let p=o[c];if(this.nGramWidths.forEach(f=>{const g=e[c+1]-e[c],v=this.getNumNGrams(g,f);this.createNGrams(i,h,l,p,v,f),p+=v}),this.preserveShort&&p===o[c]){const f=e[c+1]-e[c];if(f===0)continue;const g=f+2*this.padWidth,v=1;this.createNGrams(i,h,l,p,v,g)}}return[l,o]}};function ML(i,e,t,r,s,o,l,c){return new TL(t,r,s,o,l,c).compute(i,e)}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _L(i,e,t,r){if(!i.length)return;if(e.length===0){for(let o=0;o<i.length;++o)r.push(i.subarray(o,o+1));return}if(e.length===1){const o=e[0];let l=i.indexOf(o);for(;l!==-1;){const c=i.subarray(0,l);(!t||c.length!==0)&&r.push(c),i=i.subarray(l+1),l=i.indexOf(o)}(!t||i.length!==0)&&r.push(i);return}let s=0;for(let o=0;o<i.length+1;o++)if(o===i.length||e.indexOf(i[o])!==-1){const l=i.subarray(s,o);(!t||l.length!==0)&&r.push(l),s=o+1}}function RL(i,e,t){const r=i.length,s=[];let o=0,l=0;const c=new Array(r);for(let v=0;v<r;++v){const w=s.length;_L(i[v],e,t,s);const R=s.length-w;c[v]=R,o+=R,l=Math.max(l,R)}const h=U("int32",o*2),p=new Array(o),f=[r,l];let g=0;for(let v=0;v<r;++v)for(let w=0;w<c[v];++w)h[g*2]=v,h[g*2+1]=w,p[g]=s[g],++g;return[h,p,f]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BL(i,e){const t=U("int32",i.length);for(let r=0;r<i.length;++r)t[r]=xa(i[r]).modulo(e).getLowBitsUnsigned();return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kL=to((i,e)=>i-e),LL=Fw((i,e,t,r)=>({real:i-t,imag:e-r})),Pw=wo(vh,kL,LL),DL={kernelName:vh,backendName:"cpu",kernelFunc:Pw};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NL(i,e){const t=new Array(i.rank);for(let s=0;s<t.length;s++)t[s]=i.shape[s]*e[s];const r=dr(t,i.dtype);for(let s=0;s<r.values.length;++s){const o=r.indexToLoc(s),l=new Array(i.rank);for(let h=0;h<l.length;h++)l[h]=o[h]%i.shape[h];const c=i.locToIndex(l);r.values[s]=i.values[c]}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SA=(i,e)=>{const t=e.value-i.value;return t===0?i.index-e.index:t};function Z3(i,e,t=0,r=i.length-1){for(;r>t;){if(r-t>600){const c=r-t+1,h=e-t+1,p=Math.log(c),f=.5*Math.exp(2*p/3),g=.5*Math.sqrt(p*f*(c-f)/c)*Math.sign(h-c/2),v=Math.max(t,Math.floor(e-h*f/c+g)),w=Math.min(r,Math.floor(e+(c-h)*f/c+g));Z3(i,e,v,w)}const s=i[e];let o=t,l=r;for(B(i,t,e),SA(i[r],s)>0&&B(i,t,r);o<l;){for(B(i,o,l),o++,l--;SA(i[o],s)<0;)o=o+1;for(;SA(i[l],s)>0;)l=l-1}SA(i[t],s)===0?B(i,t,l):(l=l+1,B(i,l,r)),l<=e&&(t=l+1),e<=l&&(r=l-1)}}function FL(i,e,t,r,s){const o=e[e.length-1],[l,c]=[i.length/o,o],h=W(t,l*r),p=W("int32",l*r);for(let g=0;g<l;g++){const v=g*c,w=i.subarray(v,v+c);let R=new Array(w.length);w.forEach((X,fe)=>R[fe]={value:X,index:fe}),r<R.length&&(Z3(R,r),R=R.slice(0,r)),s&&R.sort(SA);const P=g*r,z=h.subarray(P,P+r),G=p.subarray(P,P+r);for(let X=0;X<r;X++)z[X]=R[X].value,G[X]=R[X].index}const f=e.slice();return f[f.length-1]=r,[dr(f,t,h),dr(f,"int32",p)]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PL(i,e,t,r){const s=J(e,t)[0],o=[1,t[0],1];for(let R=0;R<s;R++)o[0]*=t[R];o[1]=t[s];for(let R=s+1;R<t.length;R++)o[2]*=t[R];const l={},c=new Int32Array(t[s]),h=new Ss(o,r,i),p=[],f=o[0]===1&&o[2]===1;for(let R=0;R<t[s];R++){let P;if(f)P=i[R].toString();else{const z=[];for(let G=0;G<o[0];G++)for(let X=0;X<o[2];X++)z.push(h.get(G,R,X));P=z.join(",")}if(l[P]!==void 0)c[R]=l[P];else{const z=Object.keys(l).length;l[P]=z,c[R]=z,p.push(R)}}const g=o.slice();g[1]=Object.keys(l).length;const v=new Ss(g,r);p.forEach((R,P)=>{for(let z=0;z<o[0];z++)for(let G=0;G<o[2];G++)v.set(h.get(z,R,G),z,P,G)});const w=t.slice();return w[s]=g[1],{outputValues:v.values,outputShape:w,indices:c}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/o1("cpu",()=>new wy,1);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $3=Ns(An,i=>i>=0?i:Math.exp(i)-1),OL={kernelName:An,backendName:"cpu",kernelFunc:$3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j3(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{alpha:o}=r;Ni([s],"leakyRelu");const l=b(s.shape),c=t.data.get(s.dataId).values,h=W("float32",l);for(let p=0;p<c.length;p++)h[p]=c[p]<0?o*c[p]:c[p];return t.makeTensorInfo(s.shape,"float32",h)}const GL={kernelName:Lt,backendName:"cpu",kernelFunc:j3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UL=to((i,e)=>i<0?e*i:i);function Y3(i){const{inputs:e,backend:t}=i,{x:r,alpha:s}=e;Ni([r,s],"prelu");const o=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,[c,h]=UL(r.shape,s.shape,o,l,"float32");return t.makeTensorInfo(h,"float32",c)}const VL={kernelName:ad,backendName:"cpu",kernelFunc:Y3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const J3=Ns(ch,i=>Math.max(0,i)),zL={kernelName:ch,backendName:"cpu",kernelFunc:J3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const q3=Ns(Eu,i=>Math.min(Math.max(0,i),6)),WL={kernelName:Eu,backendName:"cpu",kernelFunc:q3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sy(i,e,t,r,s){if(t==="linear")return qu({inputs:{x:e},backend:i});if(t==="relu")return J3({inputs:{x:e},backend:i});if(t==="elu")return $3({inputs:{x:e},backend:i});if(t==="relu6")return q3({inputs:{x:e},backend:i});if(t==="prelu")return Y3({inputs:{x:e,alpha:r},backend:i});if(t==="leakyrelu")return j3({inputs:{x:e},backend:i,attrs:{alpha:s}});if(t==="sigmoid")return X3({inputs:{x:e},backend:i});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ra(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{shape:o}=r,l=b(s.shape),c=V(o,l),h=b(c);C(l===h,()=>`The new shape (${c}) has ${h} elements and the old shape (${s.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const p=t.data.get(s.dataId);if(p.complexTensorInfos!=null){const f=p.complexTensorInfos.real,g=p.complexTensorInfos.imag;f.shape=c,g.shape=c}return{dataId:s.dataId,shape:c,dtype:s.dtype}}const HL={kernelName:ld,backendName:"cpu",kernelFunc:ra};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eT(i){const{inputs:e,backend:t,attrs:r}=i,{a:s,b:o}=e,{transposeA:l,transposeB:c}=r;Ni([s,o],"matMul");const h=s.shape.length,p=o.shape.length,f=l?s.shape[h-2]:s.shape[h-1],g=c?o.shape[p-1]:o.shape[p-2],v=l?s.shape[h-1]:s.shape[h-2],w=c?o.shape[p-2]:o.shape[p-1],R=s.shape.slice(0,-2),P=o.shape.slice(0,-2),z=b(R),G=b(P),X=Ir(s.shape.slice(0,-2),o.shape.slice(0,-2)).concat([v,w]);C(f===g,()=>`Error in matMul: inner shapes (${f}) and (${g}) of Tensors with shapes ${s.shape} and ${o.shape} and transposeA=${l} and transposeB=${c} must match.`);const fe=l?[z,f,v]:[z,v,f],ge=c?[G,w,g]:[G,g,w],be=ra({inputs:{x:s},backend:t,attrs:{shape:fe}}),He=ra({inputs:{x:o},backend:t,attrs:{shape:ge}}),Je=l?be.shape[1]:be.shape[2],$e=l?be.shape[2]:be.shape[1],rt=c?He.shape[1]:He.shape[2],pt=Math.max(z,G),Gt=t.data.get(be.dataId).values,zt=t.data.get(He.dataId).values,Kt=ze(be.shape),tn=ze(He.shape),[qt,sn,xn]=l?[Kt[0],1,Kt[1]]:[Kt[0],Kt[1],1],[dn,Mn,zn]=c?[1,tn[1],tn[0]]:[tn[1],1,tn[0]],Gn=$e*rt,$n=dr([pt,$e,rt],be.dtype),ei=$n.values,si=t.blockSize;for(let ci=0;ci<pt;ci++)for(let Qi=0;Qi<$e;Qi+=si)for(let Di=0;Di<rt;Di+=si)for(let Zi=0;Zi<Je;Zi+=si){const xr=Math.min(Qi+si,$e),Lr=Math.min(Di+si,rt),Rr=Math.min(Zi+si,Je);for(let gs=Qi;gs<xr;gs++)for(let Gs=Di;Gs<Lr;Gs++){let $s=0;for(let Us=Zi;Us<Rr;Us++){const js=Math.min(ci,z-1)*qt,ba=Math.min(ci,G-1)*zn,Ta=Gt[js+gs*sn+Us*xn],vu=zt[Us*dn+Gs*Mn+ba];$s+=Ta*vu}ei[ci*Gn+(gs*rt+Gs)]+=$s}}return t.disposeIntermediateTensorInfo(be),t.disposeIntermediateTensorInfo(He),t.makeTensorInfo(X,$n.dtype,$n.values)}const KL={kernelName:hi,backendName:"cpu",kernelFunc:eT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XL(i){const{inputs:e,backend:t,attrs:r}=i,{a:s,b:o,bias:l,preluActivationWeights:c}=e,{transposeA:h,transposeB:p,activation:f,leakyreluAlpha:g}=r;let v,w,R;const P=[];v=eT({inputs:{a:s,b:o},attrs:{transposeA:h,transposeB:p},backend:t}),l&&(w=eg({inputs:{a:v,b:l},backend:t}),P.push(v),v=w),f&&(R=Sy(t,v,f,c,g),P.push(v),v=R);for(const z of P)t.disposeIntermediateTensorInfo(z);return v}const QL={kernelName:ec,backendName:"cpu",kernelFunc:XL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZL=Ns(De,i=>Math.acos(i)),$L={kernelName:De,backendName:"cpu",kernelFunc:ZL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jL=Ns(Re,i=>Math.acosh(i)),YL={kernelName:Re,backendName:"cpu",kernelFunc:jL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JL(i){const{inputs:e,backend:t}=i,r=e;Ni(e,"addN");const s=r.map(c=>t.data.get(c.dataId).values),o=dr(r[0].shape,r[0].dtype),l=o.values;for(let c=0;c<r.length;c++){const h=s[c];for(let p=0;p<l.length;p++)l[p]+=h[p]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const qL={kernelName:Oe,backendName:"cpu",kernelFunc:JL};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;Ni(s,"all");const c=J(o,s.shape);let h=c;const p=ha(h,s.shape.length);let f=s;p!=null&&(f=Il({inputs:{x:s},backend:t,attrs:{perm:p}}),h=wa(h.length,s.shape.length)),co("all",h,f.shape.length);const[g,v]=Xa(f.shape,h),w=b(v),R=fn(b(g),f.dtype),P=t.data.get(f.dataId).values;for(let G=0;G<R.length;++G){const X=G*w;let fe=P[X];for(let ge=0;ge<w;++ge){const be=P[X+ge];fe=fe&&be}R[G]=fe}p!=null&&t.disposeIntermediateTensorInfo(f);const z=t.makeTensorInfo(g,f.dtype,R);if(l){const G=Da(g,c),X=ra({inputs:{x:z},backend:t,attrs:{shape:G}});return t.disposeIntermediateTensorInfo(z),X}return z}const tD={kernelName:Qe,backendName:"cpu",kernelFunc:eD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;Ni(s,"any");const c=J(o,s.shape);let h=c;const p=ha(h,s.shape.length);let f=s;p!=null&&(f=Il({inputs:{x:s},backend:t,attrs:{perm:p}}),h=wa(h.length,s.shape.length)),co("any",h,f.shape.length);const[g,v]=Xa(f.shape,h),w=b(v),R=fn(b(g),f.dtype),P=t.data.get(f.dataId).values;for(let G=0;G<R.length;++G){const X=G*w;let fe=P[X];for(let ge=0;ge<w;++ge){const be=P[X+ge];fe=fe||be}R[G]=fe}p!=null&&t.disposeIntermediateTensorInfo(f);const z=t.makeTensorInfo(g,f.dtype,R);if(l){const G=Da(g,c),X=ra({inputs:{x:z},backend:t,attrs:{shape:G}});return t.disposeIntermediateTensorInfo(z),X}return z}const iD={kernelName:Ke,backendName:"cpu",kernelFunc:nD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o}=r;Ni(s,"argMax");let l=J(o,s.shape);const c=ha(l,s.shape.length);let h=s;const p=[];c!=null&&(h=Il({inputs:{x:s},backend:t,attrs:{perm:c}}),p.push(h),l=wa(l.length,h.shape.length)),l=[l[0]],co("argMax",l,h.shape.length);const[f,g]=Xa(h.shape,l),v=b(f),w=fn(v,"int32"),R=b(g),P=t.data.get(h.dataId).values;for(let z=0;z<w.length;++z){const G=z*R;let X=P[G],fe=0;for(let ge=0;ge<R;++ge){const be=P[G+ge];be>X&&(X=be,fe=ge)}w[z]=fe}return p.forEach(z=>t.disposeIntermediateTensorInfo(z)),t.makeTensorInfo(f,"int32",w)}const sD={kernelName:vt,backendName:"cpu",kernelFunc:rD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o}=r;Ni(s,"argMin");let l=J(o,s.shape);const c=ha(l,s.shape.length);let h=s;const p=[];c!=null&&(h=Il({inputs:{x:s},backend:t,attrs:{perm:c}}),p.push(h),l=wa(l.length,h.shape.length)),l=[l[0]],co("argMin",l,h.shape.length);const[f,g]=Xa(h.shape,l),v=b(f),w=fn(v,"int32"),R=b(g),P=t.data.get(h.dataId).values;for(let z=0;z<w.length;++z){const G=z*R;let X=P[G],fe=0;for(let ge=0;ge<R;++ge){const be=P[G+ge];be<X&&(X=be,fe=ge)}w[z]=fe}return p.forEach(z=>t.disposeIntermediateTensorInfo(z)),t.makeTensorInfo(f,"int32",w)}const oD={kernelName:ct,backendName:"cpu",kernelFunc:aD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lD=Ns(Ct,i=>Math.asin(i)),cD={kernelName:Ct,backendName:"cpu",kernelFunc:lD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uD=Ns(Yt,i=>Math.asinh(i)),hD={kernelName:Yt,backendName:"cpu",kernelFunc:uD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dD=Ns(me,i=>Math.atan(i)),pD={kernelName:me,backendName:"cpu",kernelFunc:dD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fD=to((i,e)=>Math.atan2(i,e)),mD=wo(ae,fD),gD={kernelName:ae,backendName:"cpu",kernelFunc:mD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AD=Ns(ee,i=>Math.atanh(i)),vD={kernelName:ee,backendName:"cpu",kernelFunc:AD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ow(i,e,t,r,s,o){const l=s.strideHeight,c=s.strideWidth,h=s.dilationHeight,p=s.dilationWidth,f=s.effectiveFilterHeight,g=s.effectiveFilterWidth,v=s.padInfo.top,w=s.padInfo.left,R=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,P=dr(s.outShape,t),z=P.values,G=s.outShape[1]*s.outShape[2]*s.outShape[3],X=s.outShape[2]*s.outShape[3],fe=s.outShape[3];for(let ge=0;ge<s.batchSize;++ge){const be=ge*G,He=ge*r[0];for(let Je=0;Je<s.inChannels;++Je)for(let $e=0;$e<s.outHeight;++$e){const rt=$e*l-v,pt=Math.max(0,rt),Gt=Math.min(s.inHeight,f+rt),zt=be+$e*X;for(let Kt=0;Kt<s.outWidth;++Kt){const tn=Kt*c-w,qt=Math.max(0,tn),sn=Math.min(s.inWidth,g+tn);let xn=R,dn=0,Mn=0;for(let Gn=pt;Gn<Gt;Gn+=h){const $n=He+Gn*r[1];for(let ei=qt;ei<sn;ei+=p){const si=$n+ei*r[2],ci=i[si+Je];o==="max"&&ci>xn?xn=ci:o==="avg"&&(dn+=ci,Mn++)}if(isNaN(xn))break}const zn=zt+Kt*fe+Je;z[zn]=o==="avg"?dn/Mn:xn}}}return P}function tT(i,e,t,r,s=!1,o=!1){const l=dr(r.outShape,"int32"),c=r.strideHeight,h=r.strideWidth,p=r.dilationHeight,f=r.dilationWidth,g=r.effectiveFilterHeight,v=r.effectiveFilterWidth,w=r.padInfo.top,R=r.padInfo.left,P=dr(e,t,i);for(let z=0;z<r.batchSize;++z)for(let G=0;G<r.inChannels;++G)for(let X=0;X<r.outHeight;++X){const fe=X*c-w;let ge=fe;for(;ge<0;)ge+=p;const be=Math.min(r.inHeight,g+fe);for(let He=0;He<r.outWidth;++He){const Je=He*h-R;let $e=Je;for(;$e<0;)$e+=f;const rt=Math.min(r.inWidth,v+Je);let pt=Number.NEGATIVE_INFINITY,Gt=-1;for(let zt=ge;zt<be;zt+=p){const Kt=zt-fe;for(let tn=$e;tn<rt;tn+=f){const qt=tn-Je,sn=P.get(z,zt,tn,G);sn>pt&&(pt=sn,s?Gt=o?((z*r.inHeight+zt)*r.inWidth+tn)*r.inChannels+G:(zt*r.inWidth+tn)*r.inChannels+G:Gt=Kt*v+qt)}}l.set(Gt,z,X,He,G)}}return l}function nT(i,e,t,r,s,o){const l=s.strideDepth,c=s.strideHeight,h=s.strideWidth,p=s.dilationDepth,f=s.dilationHeight,g=s.dilationWidth,v=s.effectiveFilterDepth,w=s.effectiveFilterHeight,R=s.effectiveFilterWidth,P=s.padInfo.front,z=s.padInfo.top,G=s.padInfo.left,X=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,fe=dr(s.outShape,t),ge=fe.values,be=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],He=s.outShape[2]*s.outShape[3]*s.outShape[4],Je=s.outShape[3]*s.outShape[4],$e=s.outShape[4];for(let rt=0;rt<s.batchSize;++rt){const pt=rt*be,Gt=rt*r[0];for(let zt=0;zt<s.inChannels;++zt)for(let Kt=0;Kt<s.outDepth;++Kt){const tn=Kt*l-P;let qt=tn;for(;qt<0;)qt+=p;const sn=Math.min(s.inDepth,v+tn),xn=pt+Kt*He;for(let dn=0;dn<s.outHeight;++dn){const Mn=dn*c-z;let zn=Mn;for(;zn<0;)zn+=f;const Gn=Math.min(s.inHeight,w+Mn),$n=xn+dn*Je;for(let ei=0;ei<s.outWidth;++ei){const si=ei*h-G;let ci=si;for(;ci<0;)ci+=g;const Qi=Math.min(s.inWidth,R+si),Di=$n+ei*$e;let Zi=X,xr=0,Lr=0;for(let gs=qt;gs<sn;gs+=p){const Gs=Gt+gs*r[1];for(let $s=zn;$s<Gn;$s+=f){const Us=Gs+$s*r[2];for(let js=ci;js<Qi;js+=g){const ba=Us+js*r[3],Ta=i[ba+zt];if(o==="max"&&Ta>Zi?Zi=Ta:o==="avg"&&(xr+=Ta,Lr++),isNaN(Zi))break}if(isNaN(Zi))break}if(isNaN(Zi))break}const Rr=Di+zt;ge[Rr]=o==="avg"?xr/Lr:Zi}}}}return fe}function yD(i,e){const t=dr(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,g=e.effectiveFilterWidth,v=e.padInfo.front,w=e.padInfo.top,R=e.padInfo.left;for(let P=0;P<e.batchSize;++P)for(let z=0;z<e.inChannels;++z)for(let G=0;G<e.outDepth;++G){const X=G*r-v;let fe=X;for(;fe<0;)fe+=l;const ge=Math.min(e.inDepth,p+X);for(let be=0;be<e.outHeight;++be){const He=be*s-w;let Je=He;for(;Je<0;)Je+=c;const $e=Math.min(e.inHeight,f+He);for(let rt=0;rt<e.outWidth;++rt){const pt=rt*o-R;let Gt=pt;for(;Gt<0;)Gt+=h;const zt=Math.min(e.inWidth,g+pt);let Kt=Number.NEGATIVE_INFINITY,tn=-1;for(let qt=fe;qt<ge;qt+=l){const sn=qt-X;for(let xn=Je;xn<$e;xn+=c){const dn=xn-He;for(let Mn=Gt;Mn<zt;Mn+=h){const zn=Mn-pt,Gn=i.get(P,qt,xn,Mn,z);Gn>=Kt&&(Kt=Gn,tn=sn*f*g+dn*f+zn)}}}t.set(tn,P,G,be,rt,z)}}}return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e;Ni(s,"avgPool");const{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=r,p=1;C(Bo(l,p),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const f=ac(s.shape,o,l,p,c,h);let g;if(f.filterWidth===1&&f.filterHeight===1&&S(f.inShape,f.outShape))g=qu({inputs:{x:s},backend:t});else{const v=t.data.get(s.dataId).values,w=ze(s.shape),R=Ow(v,s.shape,s.dtype,w,f,"avg");g=t.makeTensorInfo(f.outShape,s.dtype,R.values)}return g}const xD={kernelName:Ue,backendName:"cpu",kernelFunc:bD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:h,dataFormat:p}=r;Ni(s,"avgPool3d");const f=Lu(s.shape,o,l,1,c,h,p),g=t.data.get(s.dataId).values,v=nT(g,s.shape,s.dtype,ze(s.shape),f,"avg");return t.makeTensorInfo(v.shape,"float32",v.values)}const wD={kernelName:ft,backendName:"cpu",kernelFunc:CD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ED(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=r;Ni([s,o],"avgPool3DGrad");const f=Lu(o.shape,l,c,1,h,p),g=f.strideDepth,v=f.strideHeight,w=f.strideWidth,R=f.filterDepth,P=f.filterHeight,z=f.filterWidth,G=f.dilationDepth,X=f.dilationHeight,fe=f.dilationWidth,ge=f.effectiveFilterDepth,be=f.effectiveFilterHeight,He=f.effectiveFilterWidth,Je=ge-1-f.padInfo.front,$e=He-1-f.padInfo.left,rt=be-1-f.padInfo.top,pt=dr(o.shape,"float32"),Gt=1/(R*P*z),zt=t.bufferSync(s);for(let Kt=0;Kt<f.batchSize;++Kt)for(let tn=0;tn<f.inChannels;++tn)for(let qt=0;qt<f.inDepth;++qt)for(let sn=0;sn<f.inHeight;++sn)for(let xn=0;xn<f.inWidth;++xn){const dn=qt-Je,Mn=sn-rt,zn=xn-$e;let Gn=0;for(let $n=0;$n<ge;$n+=G){const ei=(dn+$n)/g;if(!(ei<0||ei>=f.outDepth||Math.floor(ei)!==ei))for(let si=0;si<be;si+=X){const ci=(Mn+si)/v;if(!(ci<0||ci>=f.outHeight||Math.floor(ci)!==ci))for(let Qi=0;Qi<He;Qi+=fe){const Di=(zn+Qi)/w;if(Di<0||Di>=f.outWidth||Math.floor(Di)!==Di)continue;const Zi=zt.get(Kt,ei,ci,Di,tn);Gn+=Zi}}}pt.set(Gn*Gt,Kt,qt,sn,xn,tn)}return t.makeTensorInfo(pt.shape,pt.dtype,pt.values)}const ID={kernelName:Ft,backendName:"cpu",kernelFunc:ED};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SD(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,l=o;Ni([s,o],"avgPoolGrad");const{filterSize:c,strides:h,pad:p}=r,f=ac(l.shape,c,h,1,p),g=f.strideHeight,v=f.strideWidth,w=f.filterHeight,R=f.filterWidth,P=f.dilationHeight,z=f.dilationWidth,G=f.effectiveFilterHeight,X=f.effectiveFilterWidth,fe=X-1-f.padInfo.left,ge=G-1-f.padInfo.top,be=dr(l.shape,"float32"),He=1/(w*R),Je=t.data.get(s.dataId).values,$e=dr(s.shape,"float32",Je);for(let rt=0;rt<f.batchSize;++rt)for(let pt=0;pt<f.inChannels;++pt)for(let Gt=0;Gt<f.inHeight;++Gt)for(let zt=0;zt<f.inWidth;++zt){const Kt=Gt-ge,tn=zt-fe;let qt=0;for(let sn=0;sn<G;sn+=P){const xn=(Kt+sn)/g;if(!(xn<0||xn>=f.outHeight||Math.floor(xn)!==xn))for(let dn=0;dn<X;dn+=z){const Mn=(tn+dn)/v;if(Mn<0||Mn>=f.outWidth||Math.floor(Mn)!==Mn)continue;const zn=$e.get(rt,xn,Mn,pt);qt+=zn}}be.set(qt*He,rt,Gt,zt,pt)}return t.makeTensorInfo(be.shape,be.dtype,be.values)}const TD={kernelName:ht,backendName:"cpu",kernelFunc:SD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,scale:o,offset:l,mean:c,variance:h}=e;C(c.shape.length===h.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(l==null||c.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(o==null||c.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ni([s,c,h,o,l],"batchNorm");let{varianceEpsilon:p}=r;p==null&&(p=.001);const f=t.data.get(s.dataId).values,g=t.data.get(c.dataId).values,v=t.data.get(h.dataId).values,w=o?t.data.get(o.dataId).values:new Float32Array([1]),R=l?t.data.get(l.dataId).values:new Float32Array([0]),P=new Float32Array(f.length),z=R.length,G=w.length,X=v.length,fe=g.length;let ge=0,be=0,He=0,Je=0;for(let $e=0;$e<f.length;++$e)P[$e]=R[ge++]+(f[$e]-g[be++])*w[He++]/Math.sqrt(v[Je++]+p),ge>=z&&(ge=0),be>=fe&&(be=0),He>=G&&(He=0),Je>=X&&(Je=0);return t.makeTensorInfo(s.shape,s.dtype,P)}const _D={kernelName:zs,backendName:"cpu",kernelFunc:MD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockShape:o,crops:l}=r;Ni([s],"batchToSpaceND");const c=o.reduce((G,X)=>G*X),h=Kd(s.shape,o,c),p=Xd(h.length,o.length),f=Xh(s.shape,o,c),g=Z0(l,o.length),v=km(f,l,o.length),w=ra({inputs:{x:s},backend:t,attrs:{shape:h}}),R=Il({inputs:{x:w},backend:t,attrs:{perm:p}}),P=ra({inputs:{x:R},backend:t,attrs:{shape:f}}),z=af({inputs:{x:P},backend:t,attrs:{begin:g,size:v}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),z}const BD={kernelName:bi,backendName:"cpu",kernelFunc:RD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,weights:o}=e,{size:l}=r,c=t.data.get(s.dataId).values,h=t.data.get(o.dataId).values,p=O3(c,h,o.dtype,o.shape,l);return t.makeTensorInfo([l],o.dtype,p)}const LD={kernelName:ri,backendName:"cpu",kernelFunc:kD};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DD(i){const{inputs:e,backend:t}=i,{s0:r,s1:s}=e,o=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=Ir(Array.from(o),Array.from(l));return t.makeTensorInfo([c.length],"int32",Int32Array.from(c))}const ND={kernelName:lr,backendName:"cpu",kernelFunc:DD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FD=Ns(Vs,(i,e)=>{const t=e;return i>t.clipValueMax?t.clipValueMax:i<t.clipValueMin?t.clipValueMin:i}),PD={kernelName:Vs,backendName:"cpu",kernelFunc:FD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OD={kernelName:ti,backendName:"cpu",kernelFunc:i=>{const{x:e}=i.inputs,t=i.backend,r=new Float32Array(b(e.shape)),s=t.data.get(e.dataId),o=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=t.data.get(o.dataId).values,h=t.data.get(l.dataId).values;for(let p=0;p<c.length;p++){const f=c[p],g=h[p];r[p]=Math.hypot(f,g)}return t.makeOutput(r,e.shape,"float32")}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ig(i){const{inputs:e,backend:t}=i,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,o=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,o)}const GD={kernelName:At,backendName:"cpu",kernelFunc:ig};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rg(i){const{inputs:e,backend:t,attrs:r}=i,{axis:s}=r,o=J(s,e[0].shape)[0],l=e.map(P=>P.shape);cc(l,o);let c=Tc(e.map(P=>P.shape),o);if(b(c)===0)return t.makeTensorInfo(c,e[0].dtype,[]);const h=e.filter(P=>b(P.shape)>0);if(h.length===1)return qu({inputs:{x:h[0]},backend:t});if(h[0].dtype==="complex64"){const P=h.map(ge=>sf({inputs:{input:ge},backend:t})),z=h.map(ge=>ig({inputs:{input:ge},backend:t})),G=rg({inputs:P,backend:t,attrs:{axis:o}}),X=rg({inputs:z,backend:t,attrs:{axis:o}}),fe=Xl({inputs:{real:G,imag:X},backend:t});return P.forEach(ge=>t.disposeIntermediateTensorInfo(ge)),z.forEach(ge=>t.disposeIntermediateTensorInfo(ge)),t.disposeIntermediateTensorInfo(G),t.disposeIntermediateTensorInfo(X),fe}const p=h.map(P=>{const z=[-1,b(P.shape.slice(o))];return ra({inputs:{x:P},backend:t,attrs:{shape:z}})}),f=p.map(P=>({vals:t.data.get(P.dataId).values,shape:P.shape}));c=Tc(p.map(P=>P.shape),1);const g=p[0].shape[0]===1,v=ck(f,c,e[0].dtype,g),w=Tc(h.map(P=>P.shape),o),R=t.makeTensorInfo(w,e[0].dtype,v);return p.forEach(P=>t.disposeIntermediateTensorInfo(P)),R}const UD={kernelName:hn,backendName:"cpu",kernelFunc:rg};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iT(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f}=r;Ni([s,o],"conv2d");const g=Du(h),v=xo(s.shape,o.shape,l,p,c,f,!1,g),w=v.filterHeight,R=v.filterWidth,P=v.dilationHeight,z=v.dilationWidth,G=v.padInfo.left,X=v.padInfo.top,fe=v.dataFormat==="channelsLast",ge=new Ss(v.outShape,s.dtype),be=ze(s.shape),He=ze(o.shape),Je=be[0],$e=fe?be[1]:be[2],rt=fe?be[2]:1,pt=fe?1:be[1],Gt=ge.strides[0],zt=fe?ge.strides[1]:ge.strides[2],Kt=fe?ge.strides[2]:1,tn=fe?1:ge.strides[1],qt=t.data.get(s.dataId).values,sn=t.data.get(o.dataId).values,xn=ge.values;for(let dn=0;dn<v.batchSize;++dn){const Mn=dn*Je,zn=dn*Gt;for(let Gn=0;Gn<v.outHeight;++Gn){const $n=zn+Gn*zt,ei=Gn*v.strideHeight-X;for(let si=0;si<w;++si){const ci=ei+si*P;if(ci<0||ci>=v.inHeight)continue;const Qi=si*He[0],Di=Mn+ci*$e;for(let Zi=0;Zi<v.outWidth;++Zi){const xr=$n+Zi*Kt,Lr=Zi*v.strideWidth-G;for(let Rr=0;Rr<R;++Rr){const gs=Lr+Rr*z;if(gs<0||gs>=v.inWidth)continue;const Gs=Qi+Rr*He[1],$s=Di+gs*rt;let Us=Gs;for(let js=0;js<v.inChannels;++js){const ba=qt[$s+js*pt];for(let Ta=0;Ta<v.outChannels;++Ta)xn[xr+Ta*tn]+=ba*sn[Us+Ta];Us+=v.outChannels}}}}}}return t.makeTensorInfo(ge.shape,ge.dtype,xn)}const VD={kernelName:On,backendName:"cpu",kernelFunc:iT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,pad:c,dataFormat:h,dimRoundingMode:p,filterShape:f}=r;Ni([s,o],"conv2dBackpropFilter");const g=Du(h),v=xo(s.shape,f,l,1,c,p,!1,g),{strideHeight:w,strideWidth:R,filterHeight:P,filterWidth:z}=v,G=v.dataFormat==="channelsLast",X=new Ss(v.filterShape,"float32"),fe=v.padInfo.left,ge=v.padInfo.top,be=t.data.get(s.dataId).values,He=t.data.get(o.dataId).values,Je=new Ss(s.shape,s.dtype,be),$e=new Ss(o.shape,o.dtype,He);for(let rt=0;rt<P;++rt){const pt=Math.max(0,Math.ceil((ge-rt)/w)),Gt=Math.min(v.outHeight,(v.inHeight+ge-rt)/w);for(let zt=0;zt<z;++zt){const Kt=Math.max(0,Math.ceil((fe-zt)/R)),tn=Math.min(v.outWidth,(v.inWidth+fe-zt)/R);for(let qt=0;qt<v.inChannels;++qt)for(let sn=0;sn<v.outChannels;++sn){let xn=0;for(let dn=0;dn<v.batchSize;++dn)for(let Mn=pt;Mn<Gt;++Mn){const zn=rt+Mn*w-ge;for(let Gn=Kt;Gn<tn;++Gn){const $n=zt+Gn*R-fe;G?xn+=Je.get(dn,zn,$n,qt)*$e.get(dn,Mn,Gn,sn):xn+=Je.get(dn,qt,zn,$n)*$e.get(dn,sn,Mn,Gn)}}X.set(xn,rt,zt,qt,sn)}}}return t.makeTensorInfo(X.shape,X.dtype,X.values)}const WD={kernelName:Oi,backendName:"cpu",kernelFunc:zD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HD(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{inputShape:l,strides:c,pad:h,dataFormat:p,dimRoundingMode:f}=r;Ni([s,o],"conv2dBackpropInput");const g=ze(o.shape),v=ze(s.shape);let w=Du(p);const R=xo(l,o.shape,c,1,h,f,!1,w),P=new Ss(R.inShape,"float32"),z=P.values,G=t.data.get(s.dataId).values,X=t.data.get(o.dataId).values,[fe,ge,be]=g,{batchSize:He,filterHeight:Je,filterWidth:$e,inChannels:rt,inHeight:pt,inWidth:Gt,outChannels:zt,outHeight:Kt,outWidth:tn,strideHeight:qt,strideWidth:sn}=R;w=R.dataFormat;const xn=Je-1-R.padInfo.top,dn=$e-1-R.padInfo.left,Mn=w==="channelsLast",zn=P.strides[0],Gn=Mn?P.strides[1]:P.strides[2],$n=Mn?P.strides[2]:1,ei=Mn?1:P.strides[1],si=v[0],ci=Mn?v[1]:v[2],Qi=Mn?v[2]:1,Di=Mn?1:v[1];for(let Zi=0;Zi<He;++Zi)for(let xr=0;xr<rt;++xr)for(let Lr=0;Lr<pt;++Lr){const Rr=Lr-xn,gs=Math.max(0,Math.ceil(Rr/qt)),Gs=Math.min(Kt,(Je+Rr)/qt);for(let $s=0;$s<Gt;++$s){const Us=$s-dn,js=Math.max(0,Math.ceil(Us/sn)),ba=Math.min(tn,($e+Us)/sn);let Ta=0;for(let xt=gs;xt<Gs;++xt){const ke=xt*qt-Rr;for(let lt=js;lt<ba;++lt){const bt=lt*sn-Us,gt=si*Zi+ci*xt+Qi*lt,an=fe*(Je-1-ke)+ge*($e-1-bt)+be*xr;for(let Wt=0;Wt<zt;++Wt){const jn=G[gt+Di*Wt],Wi=X[an+Wt];Ta+=jn*Wi}}}const vu=zn*Zi+Gn*Lr+$n*$s+ei*xr;z[vu]=Ta}}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const KD={kernelName:Yn,backendName:"cpu",kernelFunc:HD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dilations:h}=r;Ni([s,o],"conv3d");const p=Bh(s.shape,o.shape,l,h,c),{filterDepth:f,filterHeight:g,filterWidth:v,dilationDepth:w,dilationHeight:R,dilationWidth:P,padInfo:z}=p,G=z.front,X=z.left,fe=z.top,ge=new Ss(p.outShape,s.dtype),be=t.data.get(s.dataId).values,He=t.data.get(o.dataId).values,Je=ge.values,$e=ze(s.shape),rt=ze(o.shape);for(let pt=0;pt<p.batchSize;++pt){const Gt=pt*$e[0],zt=pt*ge.strides[0];for(let Kt=0;Kt<p.outDepth;++Kt){const tn=zt+Kt*ge.strides[1],qt=Kt*p.strideDepth-G;for(let sn=0;sn<f;++sn){const xn=qt+sn*w;if(xn<0||xn>=p.inDepth)continue;const dn=sn*rt[0],Mn=Gt+xn*$e[1];for(let zn=0;zn<p.outHeight;++zn){const Gn=tn+zn*ge.strides[2],$n=zn*p.strideHeight-fe;for(let ei=0;ei<g;++ei){const si=$n+ei*R;if(si<0||si>=p.inHeight)continue;const ci=dn+ei*rt[1],Qi=Mn+si*$e[2];for(let Di=0;Di<p.outWidth;++Di){const Zi=Gn+Di*p.outChannels,xr=Di*p.strideWidth-X;for(let Lr=0;Lr<v;++Lr){const Rr=xr+Lr*P;if(Rr<0||Rr>=p.inWidth)continue;const gs=ci+Lr*rt[2],Gs=Qi+Rr*p.inChannels;let $s=gs;for(let Us=0;Us<p.inChannels;++Us){const js=be[Gs+Us];for(let ba=0;ba<p.outChannels;++ba)Je[Zi+ba]+=js*He[$s+ba];$s+=p.outChannels}}}}}}}}return t.makeTensorInfo(ge.shape,ge.dtype,ge.values)}const QD={kernelName:Gi,backendName:"cpu",kernelFunc:XD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZD(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,pad:c,filterShape:h}=r;Ni([s,o],"conv3dBackpropFilterV2");const p=ze(s.shape),f=ze(o.shape),g=Bh(s.shape,h,l,1,c),v=g.strideDepth,w=g.strideHeight,R=g.strideWidth,P=g.filterDepth,z=g.filterHeight,G=g.filterWidth,X=new Ss(g.filterShape,"float32"),fe=X.values,[ge,be,He,Je]=X.strides,$e=t.data.get(o.dataId).values,[rt,pt,Gt,zt]=f,Kt=t.data.get(s.dataId).values,[tn,qt,sn,xn]=p,dn=g.padInfo.front,Mn=g.padInfo.left,zn=g.padInfo.top;for(let Gn=0;Gn<P;++Gn){const $n=Math.max(0,Math.ceil((dn-Gn)/v)),ei=Math.min(g.outDepth,(g.inDepth+dn-Gn)/v),si=Gn*ge;for(let ci=0;ci<z;++ci){const Qi=Math.max(0,Math.ceil((zn-ci)/w)),Di=Math.min(g.outHeight,(g.inHeight+zn-ci)/w),Zi=ci*be+si;for(let xr=0;xr<G;++xr){const Lr=Math.max(0,Math.ceil((Mn-xr)/R)),Rr=Math.min(g.outWidth,(g.inWidth+Mn-xr)/R),gs=xr*He+Zi;for(let Gs=0;Gs<g.inChannels;++Gs){const $s=Gs*Je+gs;for(let Us=0;Us<g.outChannels;++Us){let js=0;for(let ba=0;ba<g.batchSize;++ba){const Ta=ba*tn,vu=ba*rt;for(let xt=$n;xt<ei;++xt){const ke=(Gn+xt*v-dn)*qt+Ta,lt=xt*pt+vu;for(let bt=Qi;bt<Di;++bt){const gt=(ci+bt*w-zn)*sn+ke,an=bt*Gt+lt;for(let Wt=Lr;Wt<Rr;++Wt){const jn=(xr+Wt*R-Mn)*xn+gt,Wi=Wt*zt+an;js+=Kt[jn+Gs]*$e[Wi+Us]}}}}fe[$s+Us]=js}}}}}return t.makeTensorInfo(X.shape,X.dtype,X.values)}const $D={kernelName:nr,backendName:"cpu",kernelFunc:ZD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jD(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{pad:l,strides:c,inputShape:h}=r;Ni([s],"conv3dBackpropInputV2");const p=ze(s.shape),f=ze(o.shape),g=Bh(h,o.shape,c,1,l),v=new Ss(g.inShape,"float32"),w=v.values,[R,P,z,G]=v.strides,X=t.data.get(s.dataId).values,[fe,ge,be,He]=p,Je=t.data.get(o.dataId).values,[$e,rt,pt,Gt]=f,{batchSize:zt,filterDepth:Kt,filterHeight:tn,filterWidth:qt,inChannels:sn,inDepth:xn,inHeight:dn,inWidth:Mn,outChannels:zn,outDepth:Gn,outHeight:$n,outWidth:ei,strideDepth:si,strideHeight:ci,strideWidth:Qi}=g,Di=Kt-1-g.padInfo.front,Zi=tn-1-g.padInfo.top,xr=qt-1-g.padInfo.left;for(let Lr=0;Lr<zt;++Lr)for(let Rr=0;Rr<sn;++Rr)for(let gs=0;gs<xn;++gs){const Gs=gs-Di,$s=Math.max(0,Math.ceil(Gs/si)),Us=Math.min(Gn,(Kt+Gs)/si);for(let js=0;js<dn;++js){const ba=js-Zi,Ta=Math.max(0,Math.ceil(ba/ci)),vu=Math.min($n,(tn+ba)/ci);for(let xt=0;xt<Mn;++xt){const ke=xt-xr,lt=Math.max(0,Math.ceil(ke/Qi)),bt=Math.min(ei,(qt+ke)/Qi);let gt=0;for(let an=$s;an<Us;++an){const Wt=an*si-Gs;for(let jn=Ta;jn<vu;++jn){const Wi=jn*ci-ba;for(let Yi=lt;Yi<bt;++Yi){const nn=Yi*Qi-ke,yr=fe*Lr+ge*an+be*jn+He*Yi,rs=$e*(Kt-1-Wt)+rt*(tn-1-Wi)+pt*(qt-1-nn)+Gt*Rr;for(let Eo=0;Eo<zn;++Eo){const go=X[yr+Eo],jy=Je[rs+Eo];gt+=go*jy}}}}w[R*Lr+P*gs+z*js+G*xt+Rr]=gt}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const YD={kernelName:cr,backendName:"cpu",kernelFunc:jD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JD=Ns(Xr,i=>Math.cos(i)),qD={kernelName:Xr,backendName:"cpu",kernelFunc:JD};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eN=Ns(Fr,i=>Math.cosh(i)),tN={kernelName:Fr,backendName:"cpu",kernelFunc:eN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nN(i){const{inputs:e,backend:t,attrs:r}=i,{image:s,boxes:o,boxInd:l}=e,{cropSize:c,method:h,extrapolationValue:p}=r,[f,g,v,w]=s.shape,R=o.shape[0],[P,z]=c,G=dr([R,P,z,w],"float32"),X=t.data.get(o.dataId).values,fe=t.data.get(l.dataId).values,ge=t.data.get(s.dataId).values,be=ze(s.shape),He=ze(G.shape);for(let Je=0;Je<R;Je++){const $e=Je*4,rt=X[$e],pt=X[$e+1],Gt=X[$e+2],zt=X[$e+3],Kt=fe[Je];if(Kt>=f)continue;const tn=P>1?(Gt-rt)*(g-1)/(P-1):0,qt=z>1?(zt-pt)*(v-1)/(z-1):0;for(let sn=0;sn<P;sn++){const xn=P>1?rt*(g-1)+sn*tn:.5*(rt+Gt)*(g-1);if(xn<0||xn>g-1){for(let dn=0;dn<z;dn++)for(let Mn=0;Mn<w;Mn++){const zn=Mn+dn*He[2]+sn*He[1]+Je*He[0];G.values[zn]=p}continue}if(h==="bilinear"){const dn=Math.floor(xn),Mn=Math.ceil(xn),zn=xn-dn;for(let Gn=0;Gn<z;Gn++){const $n=z>1?pt*(v-1)+Gn*qt:.5*(pt+zt)*(v-1);if($n<0||$n>v-1){for(let Qi=0;Qi<w;Qi++){const Di=Qi+Gn*He[2]+sn*He[1]+Je*He[0];G.values[Di]=p}continue}const ei=Math.floor($n),si=Math.ceil($n),ci=$n-ei;for(let Qi=0;Qi<w;Qi++){let Di=Qi+ei*be[2]+dn*be[1]+Kt*be[0];const Zi=ge[Di];Di=Qi+si*be[2]+dn*be[1]+Kt*be[0];const xr=ge[Di];Di=Qi+ei*be[2]+Mn*be[1]+Kt*be[0];const Lr=ge[Di];Di=Qi+si*be[2]+Mn*be[1]+Kt*be[0];const Rr=ge[Di],gs=Zi+(xr-Zi)*ci,Gs=Lr+(Rr-Lr)*ci;Di=Qi+Gn*He[2]+sn*He[1]+Je*He[0],G.values[Di]=gs+(Gs-gs)*zn}}}else for(let dn=0;dn<z;++dn){const Mn=z>1?pt*(v-1)+dn*qt:.5*(pt+zt)*(v-1);if(Mn<0||Mn>v-1){for(let $n=0;$n<w;$n++){const ei=$n+dn*He[2]+sn*He[1]+Je*He[0];G.values[ei]=p}continue}const zn=Math.round(Mn),Gn=Math.round(xn);for(let $n=0;$n<w;$n++){const ei=$n+zn*be[2]+Gn*be[1]+Kt*be[0],si=$n+dn*He[2]+sn*He[1]+Je*He[0];G.values[si]=ge[ei]}}}}return t.makeTensorInfo(G.shape,G.dtype,G.values)}const iN={kernelName:vr,backendName:"cpu",kernelFunc:nN};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,exclusive:l,reverse:c}=r;Ni(s,"cumprod");const h=ha([o],s.shape.length);let p=s;h!=null&&(p=Il({inputs:{x:s},backend:t,attrs:{perm:h}}));const f=wa(1,s.shape.length)[0];if(f!==p.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${p.shape.length-1} but got axis=${f}`);const g=Uo(p.dtype,"int32"),v=Rt(b(p.shape),g),w=t.data.get(p.dataId).values,R=p.shape[p.shape.length-1],P=c?(G,X)=>G+R-X-1:(G,X)=>G+X;for(let G=0;G<w.length;G+=R)for(let X=0;X<R;X++){const fe=P(G,X);if(X===0)v[fe]=l?1:w[fe];else{const ge=P(G,X-1);v[fe]=l?w[ge]*v[ge]:w[fe]*v[ge]}}const z=t.makeTensorInfo(p.shape,g,v);if(h!=null){const G=Nu(h),X=Il({inputs:{x:z},backend:t,attrs:{perm:G}});return t.disposeIntermediateTensorInfo(z),t.disposeIntermediateTensorInfo(p),X}return z}const sN={kernelName:$r,backendName:"cpu",kernelFunc:rN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,exclusive:l,reverse:c}=r;Ni(s,"cumsum");const h=ha([o],s.shape.length);let p=s;h!=null&&(p=Il({inputs:{x:s},backend:t,attrs:{perm:h}}));const f=wa(1,s.shape.length)[0];if(f!==p.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${p.shape.length-1} but got axis=${f}`);const g=Uo(p.dtype,"int32"),v=fn(b(p.shape),g),w=t.data.get(p.dataId).values,R=p.shape[p.shape.length-1],P=c?(G,X)=>G+R-X-1:(G,X)=>G+X;for(let G=0;G<w.length;G+=R)for(let X=0;X<R;X++){const fe=P(G,X);if(X===0)v[fe]=l?0:w[fe];else{const ge=P(G,X-1);v[fe]=l?w[ge]+v[ge]:w[fe]+v[ge]}}const z=t.makeTensorInfo(p.shape,g,v);if(h!=null){const G=Nu(h),X=Il({inputs:{x:z},backend:t,attrs:{perm:G}});return t.disposeIntermediateTensorInfo(z),t.disposeIntermediateTensorInfo(p),X}return z}const oN={kernelName:ws,backendName:"cpu",kernelFunc:aN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,weights:o}=e,{size:l,binaryOutput:c}=r;if(s.shape.length===1){const h=t.data.get(s.dataId).values,p=t.data.get(o.dataId).values,f=O3(h,p,o.dtype,o.shape,l);return t.makeTensorInfo([l],o.dtype,f)}else if(s.shape.length===2){const h=t.bufferSync(s),p=t.bufferSync(o),f=sk(h,p,l,c);return t.makeTensorInfo(f.shape,o.dtype,f.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const cN={kernelName:As,backendName:"cpu",kernelFunc:lN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockSize:o,dataFormat:l}=r;C(l==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${l}`);const c=s.shape[0],h=s.shape[1],p=s.shape[2],f=s.shape[3],g=h*o,v=p*o,w=f/(o*o),R=t.data.get(s.dataId).values,P=new Float32Array(c*g*v*w);let z=0;for(let G=0;G<c;++G)for(let X=0;X<g;++X){const fe=Math.floor(X/o),ge=X%o;for(let be=0;be<v;++be){const He=Math.floor(be/o),Je=be%o,$e=(ge*o+Je)*w;for(let rt=0;rt<w;++rt){const pt=rt+$e+f*(He+p*(fe+h*G));P[z++]=R[pt]}}}return t.makeTensorInfo([c,g,v,w],s.dtype,P)}const hN={kernelName:vs,backendName:"cpu",kernelFunc:uN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rT(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:p}=r;Ni([s,o],"depthwiseConv2DNative");const f=ze(s.shape),g=ze(o.shape);let v=h;v==null&&(v=[1,1]),C(Bo(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const w=xo(s.shape,o.shape,l,v,c,p,!0),{filterHeight:R,filterWidth:P,dilationHeight:z,dilationWidth:G,padInfo:X}=w,fe=X.left,ge=X.top,be=w.outChannels/w.inChannels,He=new Ss(w.outShape,s.dtype),Je=t.data.get(s.dataId).values,$e=t.data.get(o.dataId).values,rt=He.values;for(let pt=0;pt<w.batchSize;++pt){const Gt=pt*f[0],zt=pt*He.strides[0];for(let Kt=0;Kt<w.outHeight;++Kt){const tn=zt+Kt*He.strides[1],qt=Kt*w.strideHeight-ge;for(let sn=0;sn<R;++sn){const xn=qt+sn*z;if(xn<0||xn>=w.inHeight)continue;const dn=sn*g[0],Mn=Gt+xn*f[1];for(let zn=0;zn<w.outWidth;++zn){const Gn=tn+zn*He.strides[2],$n=zn*w.strideWidth-fe;for(let ei=0;ei<P;++ei){const si=$n+ei*G;if(si<0||si>=w.inWidth)continue;const ci=dn+ei*g[1],Qi=Mn+si*w.inChannels;let Di=Gn,Zi=ci;for(let xr=0;xr<w.inChannels;++xr){const Lr=Je[Qi+xr];for(let Rr=0;Rr<be;++Rr)rt[Di+Rr]+=Lr*$e[Zi+Rr];Di+=be,Zi+=be}}}}}}return t.makeTensorInfo(He.shape,He.dtype,He.values)}const dN={kernelName:Ge,backendName:"cpu",kernelFunc:rT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,dilations:c,pad:h,dimRoundingMode:p,filterShape:f}=r;Ni([s,o],"depthwiseConv2dNativeBackpropFilter");const g=xo(s.shape,f,l,c,h,p,!0),{strideHeight:v,strideWidth:w,filterHeight:R,filterWidth:P}=g,z=new Ss(g.filterShape,"float32"),G=g.padInfo.left,X=g.padInfo.top,fe=g.outChannels/g.inChannels,ge=t.data.get(s.dataId).values,be=new Ss(s.shape,s.dtype,ge),He=t.data.get(o.dataId).values,Je=new Ss(o.shape,o.dtype,He);for(let $e=0;$e<R;++$e){const rt=Math.max(0,Math.ceil((X-$e)/v)),pt=Math.min(g.outHeight,(g.inHeight+X-$e)/v);for(let Gt=0;Gt<P;++Gt){const zt=Math.max(0,Math.ceil((G-Gt)/w)),Kt=Math.min(g.outWidth,(g.inWidth+G-Gt)/w);for(let tn=0;tn<g.outChannels;++tn){const qt=Math.trunc(tn/fe),sn=tn%fe;let xn=0;for(let dn=0;dn<g.batchSize;++dn)for(let Mn=rt;Mn<pt;++Mn){const zn=$e+Mn*v-X;for(let Gn=zt;Gn<Kt;++Gn){const $n=Gt+Gn*w-G;xn+=be.get(dn,zn,$n,qt)*Je.get(dn,Mn,Gn,tn)}}z.set(xn,$e,Gt,qt,sn)}}}return t.makeTensorInfo(z.shape,z.dtype,z.values)}const fN={kernelName:st,backendName:"cpu",kernelFunc:pN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mN(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{strides:l,dilations:c,pad:h,dimRoundingMode:p,inputShape:f}=r;Ni([s,o],"depthwiseConv2DNativeBackpropInput");const g=ze(s.shape),v=ze(o.shape),w=xo(f,o.shape,l,c,h,p,!0),R=new Ss(w.inShape,"float32"),P=R.values,[z,G,X]=R.strides,fe=t.data.get(s.dataId).values,[ge,be,He]=g,Je=t.data.get(o.dataId).values,[$e,rt,pt]=v,{batchSize:Gt,filterHeight:zt,filterWidth:Kt,inChannels:tn,inHeight:qt,inWidth:sn,outChannels:xn,outHeight:dn,outWidth:Mn,strideHeight:zn,strideWidth:Gn}=w,$n=zt-1-w.padInfo.top,ei=Kt-1-w.padInfo.left,si=xn/tn;for(let ci=0;ci<Gt;++ci)for(let Qi=0;Qi<tn;++Qi)for(let Di=0;Di<qt;++Di){const Zi=Di-$n,xr=Math.max(0,Math.ceil(Zi/zn)),Lr=Math.min(dn,(zt+Zi)/zn);for(let Rr=0;Rr<sn;++Rr){const gs=Rr-ei,Gs=Math.max(0,Math.ceil(gs/Gn)),$s=Math.min(Mn,(Kt+gs)/Gn);let Us=0;for(let js=xr;js<Lr;++js){const ba=js*zn-Zi;for(let Ta=Gs;Ta<$s;++Ta){const vu=Ta*Gn-gs,xt=ge*ci+be*js+He*Ta,ke=$e*(zt-1-ba)+rt*(Kt-1-vu)+pt*Qi;for(let lt=0;lt<si;++lt){const bt=Qi*si+lt,gt=fe[xt+bt],an=Je[ke+lt];Us+=gt*an}}}P[z*ci+G*Di+X*Rr+Qi]=Us}}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const gN={kernelName:wt,backendName:"cpu",kernelFunc:mN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AN(i){const{inputs:e,backend:t}=i,{x:r}=e,s=b(r.shape),o=t.data.get(r.dataId).values,l=dr([s,s],r.dtype),c=l.values;for(let p=0;p<o.length;p++)c[p*s+p]=o[p];const h=[...r.shape,...r.shape];return t.makeTensorInfo(h,l.dtype,l.values)}const vN={kernelName:en,backendName:"cpu",kernelFunc:AN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yN={kernelName:Xt,backendName:"cpu",kernelFunc:({inputs:i,backend:e,attrs:t})=>{const{x:r,filter:s}=i,{strides:o,pad:l,dilations:c}=t,h=e,p=h.data.get(r.dataId).values,f=r.shape.length,g=h.data.get(s.dataId).values,v=s.shape.length,{batchSize:w,inHeight:R,inWidth:P,inChannels:z,outHeight:G,outWidth:X,padInfo:fe,strideHeight:ge,strideWidth:be,filterHeight:He,filterWidth:Je,dilationHeight:$e,dilationWidth:rt,outShape:pt}=Wf(r.shape,s.shape,o,l,"NHWC",c),Gt=b(pt),zt=pt.length,Kt=U(r.dtype,Gt);for(let tn=0;tn<w;++tn)for(let qt=0;qt<G;++qt){const sn=qt*ge-fe.top;for(let xn=0;xn<X;++xn){const dn=xn*be-fe.left;for(let Mn=0;Mn<z;++Mn){let zn=Number.MIN_SAFE_INTEGER;for(let $n=0;$n<He;++$n){const ei=sn+$n*$e;if(ei>=0&&ei<R)for(let si=0;si<Je;++si){const ci=dn+si*rt;if(ci>=0&&ci<P){const Qi=yn([tn,ei,ci,Mn],f,ze(r.shape)),Di=yn([$n,si,Mn],v,ze(s.shape)),Zi=p[Qi]+g[Di];Zi>zn&&(zn=Zi)}}}const Gn=yn([tn,qt,xn,Mn],zt,ze(pt));Kt[Gn]=zn}}}return{dataId:h.write(nc(Kt,r.dtype),pt,r.dtype),shape:pt,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bN={kernelName:Fn,backendName:"cpu",kernelFunc:({inputs:i,backend:e,attrs:t})=>{const{x:r,filter:s,dy:o}=i,{strides:l,pad:c,dilations:h}=t,p=e,f=Tt(r.shape,p.data.get(r.dataId).values),g=Tt(s.shape,p.data.get(s.dataId).values),{batchSize:v,inHeight:w,inWidth:R,inChannels:P,outHeight:z,outWidth:G,padInfo:X,strideHeight:fe,strideWidth:ge,filterHeight:be,filterWidth:He,dilationHeight:Je,dilationWidth:$e,outShape:rt}=Wf(r.shape,s.shape,l,c,"NHWC",h);C(o.rank===rt.length,()=>`Error in ${Fn}, dy must have the same rank as output ${rt.length}, but got ${o.rank}`);const pt=Tt(rt,p.data.get(o.dataId).values),Gt=cn(s.shape,s.dtype);for(let zt=0;zt<v;++zt)for(let Kt=0;Kt<z;++Kt){const tn=Kt*fe-X.top;for(let qt=0;qt<G;++qt){const sn=qt*ge-X.left;for(let xn=0;xn<P;++xn){let dn=Number.MIN_SAFE_INTEGER,Mn=0,zn=0;for(let Gn=0;Gn<be;++Gn){const $n=tn+Gn*Je;if($n>=0&&$n<w)for(let ei=0;ei<He;++ei){const si=sn+ei*$e;if(si>=0&&si<R){const ci=f[zt][$n][si][xn]+g[Gn][ei][xn];ci>dn&&(dn=ci,Mn=Gn,zn=ei)}}}Gt[Mn][zn][xn]+=pt[zt][Kt][qt][xn]}}}return{dataId:p.write(nc(Gt,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xN={kernelName:En,backendName:"cpu",kernelFunc:({inputs:i,backend:e,attrs:t})=>{const{x:r,filter:s,dy:o}=i,{strides:l,pad:c,dilations:h}=t,p=e,f=Tt(r.shape,p.data.get(r.dataId).values),g=Tt(s.shape,p.data.get(s.dataId).values),{batchSize:v,inHeight:w,inWidth:R,inChannels:P,outHeight:z,outWidth:G,padInfo:X,strideHeight:fe,strideWidth:ge,filterHeight:be,filterWidth:He,dilationHeight:Je,dilationWidth:$e,outShape:rt}=Wf(r.shape,s.shape,l,c,"NHWC",h);C(o.rank===rt.length,()=>`Error in ${En}, dy must have the same rank as output ${rt.length}, but got ${o.rank}`);const pt=Tt(rt,p.data.get(o.dataId).values),Gt=cn(r.shape,r.dtype);for(let zt=0;zt<v;++zt)for(let Kt=0;Kt<z;++Kt){const tn=Kt*fe-X.top;for(let qt=0;qt<G;++qt){const sn=qt*ge-X.left;for(let xn=0;xn<P;++xn){let dn=Number.MIN_SAFE_INTEGER,Mn=tn<0?0:tn,zn=sn<0?0:sn;for(let Gn=0;Gn<be;++Gn){const $n=tn+Gn*Je;if($n>=0&&$n<w)for(let ei=0;ei<He;++ei){const si=sn+ei*$e;if(si>=0&&si<R){const ci=f[zt][$n][si][xn]+g[Gn][ei][xn];ci>dn&&(dn=ci,Mn=$n,zn=si)}}}Gt[zt][Mn][zn][xn]+=pt[zt][Kt][qt][xn]}}}return{dataId:p.write(nc(Gt,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TA(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;Ni(s,"sum");let c;s.dtype==="bool"?c=qd({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):c=qu({inputs:{x:s},backend:t});const h=c.shape.length,p=J(o,c.shape),f=ha(p,h);let g=p,v=c;f!=null&&(v=Il({inputs:{x:c},backend:t,attrs:{perm:f}}),g=wa(g.length,h)),co("sum",g,v.shape.length);const[w,R]=Xa(v.shape,g),P=Uo(v.dtype,"int32");let z=Ey(t,w,P);const G=b(R),X=t.data.get(z.dataId).values,fe=t.data.get(v.dataId).values;for(let ge=0;ge<X.length;++ge){const be=ge*G;let He=0;for(let Je=0;Je<G;++Je)He+=fe[be+Je];X[ge]=He}if(l){const ge=Da(z.shape,p),be=z;z=ra({inputs:{x:z},backend:t,attrs:{shape:ge}}),t.disposeIntermediateTensorInfo(be)}return t.disposeIntermediateTensorInfo(c),f!=null&&t.disposeIntermediateTensorInfo(v),z}const CN={kernelName:hd,backendName:"cpu",kernelFunc:TA};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wN(i){const{inputs:e,backend:t,attrs:r}=i,{equation:s}=r,o=e,{allDims:l,summedDims:c,idDims:h}=Qd(s,o.length);nA(l.length,h,o);const{path:p,steps:f}=iA(c,h),g=f.length;let v=null,w=l.length;const R=[];for(let P=0;P<g;++P){for(const z of f[P]){const{permutationIndices:G,expandDims:X}=jp(w,h[z]);let fe;rA(G)?fe=o[z]:(fe=Il({inputs:{x:o[z]},backend:t,attrs:{perm:G}}),R.push(fe));const ge=fe.shape.slice();for(let be=0;be<X.length;++be)ge.splice(X[be],0,1);S(fe.shape,ge)||(fe=ra({inputs:{x:fe},backend:t,attrs:{shape:ge}}),R.push(fe)),v===null?v=fe:(v=Iy({inputs:{a:fe,b:v},backend:t}),R.push(v))}P<g-1&&(p[P]>=0&&(v=TA({inputs:{x:v},backend:t,attrs:{axis:p[P]-(l.length-w),keepDims:!1}}),R.push(v)),w--)}for(const P of R)P!==v&&t.disposeIntermediateTensorInfo(P);return v}const EN={kernelName:vi,backendName:"cpu",kernelFunc:wN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IN(i){const{inputs:e,backend:t}=i,{dy:r,y:s}=e;Ni([r,s],"eluGrad");const o=new Float32Array(b(s.shape)),l=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values;for(let h=0;h<l.length;++h){const p=l[h];p>=1?o[h]=c[h]:o[h]=c[h]*(p+1)}return t.makeTensorInfo(s.shape,"float32",o)}const SN={kernelName:Ui,backendName:"cpu",kernelFunc:IN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TN=Xp,MN=$0,_N=Lm,RN=j0,BN=Dm,kN=Nm,LN=Ns(Hi,i=>{const e=Math.sign(i),t=Math.abs(i),r=1/(1+TN*t);return e*(1-((((kN*r+BN)*r+RN)*r+_N)*r+MN)*r*Math.exp(-t*t))}),DN={kernelName:Hi,backendName:"cpu",kernelFunc:LN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ty(i){const{inputs:e,backend:t,attrs:r}=i,{input:s}=e,{dim:o}=r,l=s.shape.length,c=s.shape.slice();let h=o;return o<0&&(C(-(l+1)<=o,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),h=l+o+1),c.splice(h,0,1),ra({inputs:{x:s},backend:t,attrs:{shape:c}})}const NN={kernelName:Tr,backendName:"cpu",kernelFunc:Ty};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FN=to((i,e)=>i/e),Gw=wo(Ci,FN),Uw={kernelName:Ci,backendName:"cpu",kernelFunc:Gw};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sT(i,e,t){const r=i.shape,s=r[0],o=r[1],l=t.data.get(i.dataId),c=l.complexTensorInfos.real,h=l.complexTensorInfos.imag,p=[s,o],f=b(p),g=W("float32",f),v=W("float32",f);for(let z=0;z<s;z++){const G=af({inputs:{x:c},backend:t,attrs:{begin:[z,0],size:[1,o]}}),X=af({inputs:{x:h},backend:t,attrs:{begin:[z,0],size:[1,o]}}),fe=Xl({inputs:{real:G,imag:X},backend:t}),{real:ge,imag:be}=PN(fe,e,t),He=_c(ge,be);for(let Je=0;Je<o;Je++){const $e=$p(He,Je);g[z*o+Je]=$e.real,v[z*o+Je]=$e.imag}t.disposeIntermediateTensorInfo(G),t.disposeIntermediateTensorInfo(X),t.disposeIntermediateTensorInfo(fe)}const w=t.makeTensorInfo(p,"float32",g),R=t.makeTensorInfo(p,"float32",v),P=Xl({inputs:{real:w,imag:R},backend:t});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),P}function PN(i,e,t){const r=b(i.shape),s=t.data.get(i.dataId),o=t.data.get(s.complexTensorInfos.real.dataId).values,l=t.data.get(s.complexTensorInfos.imag.dataId).values;if(ON(r)){const c=Vw(o,l,r,e,t),h=[i.shape[0],i.shape[1]];if(e){const p=t.makeTensorInfo(h,"float32",c.real),f=t.makeTensorInfo(h,"float32",c.imag),g=t.makeTensorInfo([],"float32",Ya(r,"float32")),v=qu({inputs:{x:g},backend:t}),w=Uw.kernelFunc({inputs:{a:p,b:g},backend:t}),R=Uw.kernelFunc({inputs:{a:f,b:v},backend:t}),P=t.data.get(w.dataId).values,z=t.data.get(R.dataId).values;return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),{real:P,imag:z}}return c}else{const c=_c(o,l),h=GN(c,r,e);return Y0(h)}}function ON(i){return(i&i-1)===0}function Vw(i,e,t,r,s){if(t===1)return{real:i,imag:e};const o=_c(i,e),l=t/2,c=Qp(o),h=c.real,p=c.imag,f=[h.length],g=s.makeTensorInfo(f,"float32",h),v=s.makeTensorInfo(f,"float32",p),w=Xl({inputs:{real:g,imag:v},backend:s}),R=Zp(o),P=R.real,z=R.imag,G=[P.length],X=s.makeTensorInfo(G,"float32",P),fe=s.makeTensorInfo(G,"float32",z),ge=Xl({inputs:{real:X,imag:fe},backend:s}),be=Vw(h,p,l,r,s),He=be.real,Je=be.imag,$e=[He.length],rt=s.makeTensorInfo($e,"float32",He),pt=s.makeTensorInfo($e,"float32",Je),Gt=Xl({inputs:{real:rt,imag:pt},backend:s}),zt=Vw(P,z,l,r,s),Kt=zt.real,tn=zt.imag,qt=[Kt.length],sn=s.makeTensorInfo(qt,"float32",Kt),xn=s.makeTensorInfo(qt,"float32",tn),dn=Xl({inputs:{real:sn,imag:xn},backend:s}),Mn=q0(t,r),zn=[Mn.real.length],Gn=s.makeTensorInfo(zn,"float32",Mn.real),$n=s.makeTensorInfo(zn,"float32",Mn.imag),ei=Xl({inputs:{real:Gn,imag:$n},backend:s}),si=Iy({inputs:{a:ei,b:dn},backend:s}),ci=eg({inputs:{a:Gt,b:si},backend:s}),Qi=Pw({inputs:{a:Gt,b:si},backend:s}),Di=sf({inputs:{input:ci},backend:s}),Zi=sf({inputs:{input:Qi},backend:s}),xr=ig({inputs:{input:ci},backend:s}),Lr=ig({inputs:{input:Qi},backend:s}),Rr=rg({inputs:[Di,Zi],backend:s,attrs:{axis:0}}),gs=rg({inputs:[xr,Lr],backend:s,attrs:{axis:0}}),Gs=s.data.get(Rr.dataId).values,$s=s.data.get(gs.dataId).values;return s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(w),s.disposeIntermediateTensorInfo(X),s.disposeIntermediateTensorInfo(fe),s.disposeIntermediateTensorInfo(ge),s.disposeIntermediateTensorInfo(rt),s.disposeIntermediateTensorInfo(pt),s.disposeIntermediateTensorInfo(Gt),s.disposeIntermediateTensorInfo(sn),s.disposeIntermediateTensorInfo(xn),s.disposeIntermediateTensorInfo(dn),s.disposeIntermediateTensorInfo(Gn),s.disposeIntermediateTensorInfo($n),s.disposeIntermediateTensorInfo(ei),s.disposeIntermediateTensorInfo(si),s.disposeIntermediateTensorInfo(ci),s.disposeIntermediateTensorInfo(Qi),s.disposeIntermediateTensorInfo(Di),s.disposeIntermediateTensorInfo(xr),s.disposeIntermediateTensorInfo(Zi),s.disposeIntermediateTensorInfo(Lr),s.disposeIntermediateTensorInfo(Rr),s.disposeIntermediateTensorInfo(gs),{real:Gs,imag:$s}}function GN(i,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let o=0,l=0;for(let c=0;c<e;c++){const h=Gv(s*c,e,t),p=$p(i,c);o+=p.real*h.real-p.imag*h.imag,l+=p.real*h.imag+p.imag*h.real}t&&(o/=e,l/=e),J0(r,o,l,s)}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UN(i){const{inputs:e,backend:t}=i,{input:r}=e,s=b(r.shape),o=r.shape[r.shape.length-1],l=s/o,c=ra({inputs:{x:r},backend:t,attrs:{shape:[l,o]}}),h=sT(c,!1,t),p=ra({inputs:{x:h},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),p}const VN={kernelName:Pr,backendName:"cpu",kernelFunc:UN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zw(i){const{backend:e,attrs:t}=i,{shape:r,value:s,dtype:o}=t,l=o||he(s),c=U(l,b(r));return WN(c,s),e.makeTensorInfo(r,l,c)}const zN={kernelName:Rs,backendName:"cpu",kernelFunc:zw};function WN(i,e,t){i.fill(e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HN={kernelName:fa,backendName:"cpu",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{image:r}=i,s=t,o=W(r.dtype,b(r.shape)),[l,c,h,p]=r.shape,f=s.data.get(r.dataId).values;for(let g=0;g<l;g++){const v=g*h*c*p;for(let w=0;w<c;w++){const R=w*(h*p);for(let P=0;P<h;P++){const z=P*p;for(let G=0;G<p;G++){const X=Math.round(h-P-1),fe=v+R+z+G;let ge=f[fe];if(X>=0&&X<h){const be=X*p,He=v+R+be+G;ge=f[He]}o[fe]=ge}}}}return{dataId:s.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KN=to((i,e)=>Math.floor(i/e)),XN=wo(Cr,KN,null,"int32"),QN={kernelName:Cr,backendName:"cpu",kernelFunc:XN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o,bias:l,preluActivationWeights:c}=e,{strides:h,pad:p,dataFormat:f,dilations:g,dimRoundingMode:v,activation:w,leakyreluAlpha:R}=r;let P=iT({inputs:{x:s,filter:o},backend:t,attrs:{strides:h,pad:p,dataFormat:f,dilations:g,dimRoundingMode:v}});if(l){const z=P;if(f==="NCHW"&&l.shape.length===1&&l.shape[0]!==1){const G=ra({inputs:{x:l},backend:t,attrs:{shape:[l.shape[0],1,1]}});P=eg({inputs:{a:P,b:G},backend:t}),t.disposeIntermediateTensorInfo(G)}else P=eg({inputs:{a:P,b:l},backend:t});t.disposeIntermediateTensorInfo(z)}if(w){const z=P;if(f==="NCHW"&&w==="prelu"&&c.shape.length===1&&c.shape[0]!==1){const G=ra({inputs:{x:c},backend:t,attrs:{shape:[c.shape[0],1,1]}});P=Sy(t,P,w,G,R),t.disposeIntermediateTensorInfo(G)}else P=Sy(t,P,w,c,R);t.disposeIntermediateTensorInfo(z)}return P}const $N={kernelName:Tu,backendName:"cpu",kernelFunc:ZN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jN(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o,bias:l,preluActivationWeights:c}=e,{strides:h,pad:p,dataFormat:f,dilations:g,dimRoundingMode:v,activation:w,leakyreluAlpha:R}=r;let P=rT({inputs:{x:s,filter:o},backend:t,attrs:{strides:h,pad:p,dataFormat:f,dilations:g,dimRoundingMode:v}});if(l){const z=P;P=eg({inputs:{a:P,b:l},backend:t}),t.disposeIntermediateTensorInfo(z)}if(w){const z=P;P=Sy(t,P,w,c,R),t.disposeIntermediateTensorInfo(z)}return P}const YN={kernelName:gc,backendName:"cpu",kernelFunc:jN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JN(i){const{inputs:e,backend:t}=i,{params:r,indices:s}=e,o=b(r.shape),l=s.shape,c=l[l.length-1],[h,p,f,g]=Kg(r,s);if(p===0)return t.makeTensorInfo(h,r.dtype,[]);const v=t.data.get(s.dataId).values,w=t.bufferSync(r),R=bk(v,w,r.dtype,p,c,f,g,r.shape,o);return t.makeTensorInfo(h,r.dtype,R.values)}const qN={kernelName:ie,backendName:"cpu",kernelFunc:JN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,indices:o}=e,{axis:l,batchDims:c}=r;Ni([s,o],"gatherV2");const h=J(l,s.shape)[0],p=t.data.get(o.dataId).values,f=s.shape[h];for(let ge=0;ge<p.length;++ge){const be=p[ge];C(be<=f-1&&be>=0,()=>`GatherV2: the index value ${be} is not in [0, ${f-1}]`)}let g=c;c==null&&(g=0);const v=b(o.shape),w=oA(s,o,h,g),R=ra({inputs:{x:s},backend:t,attrs:{shape:[w.batchSize,w.outerSize,w.dimSize,w.sliceSize]}}),P=ra({inputs:{x:o},backend:t,attrs:{shape:[w.batchSize,v/w.batchSize]}}),z=[w.batchSize,w.outerSize,v/w.batchSize,w.sliceSize],G=t.bufferSync(P),X=t.bufferSync(R),fe=xk(X,G,z);return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),t.makeTensorInfo(w.outputShape,fe.dtype,fe.values)}const tF={kernelName:zr,backendName:"cpu",kernelFunc:eF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nF(i){const{inputs:e,backend:t}=i,{input:r}=e,s=b(r.shape),o=r.shape[r.shape.length-1],l=s/o,c=ra({inputs:{x:r},backend:t,attrs:{shape:[l,o]}}),h=sT(c,!0,t),p=ra({inputs:{x:h},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),p}const iF={kernelName:Xe,backendName:"cpu",kernelFunc:nF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rF=Ns(It,i=>Number.isFinite(i)?1:0,"bool"),sF={kernelName:It,backendName:"cpu",kernelFunc:rF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aF=Ns(Sn,i=>Math.abs(i)===1/0?1:0,"bool"),oF={kernelName:Sn,backendName:"cpu",kernelFunc:aF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lF=Ns(vn,i=>Number.isNaN(i)?1:0,"bool"),cF={kernelName:vn,backendName:"cpu",kernelFunc:lF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uF(i){const{backend:e,attrs:t}=i,{start:r,stop:s,num:o}=t,l=Dk(r,s,o);return e.makeTensorInfo([l.length],"float32",l)}const hF={kernelName:fi,backendName:"cpu",kernelFunc:uF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dF=Ns(Vi,i=>Math.log1p(i)),pF={kernelName:Vi,backendName:"cpu",kernelFunc:dF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fF=to((i,e)=>i&&e),mF=wo(br,fF,null,"bool"),gF={kernelName:br,backendName:"cpu",kernelFunc:mF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AF=Ns(ur,i=>i?0:1,"bool"),vF={kernelName:ur,backendName:"cpu",kernelFunc:AF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yF=to((i,e)=>i||e),bF=wo(er,yF,null,"bool"),xF={kernelName:er,backendName:"cpu",kernelFunc:bF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{depthRadius:o,bias:l,alpha:c,beta:h}=r;Ni(s,"LRN");const p=s.shape[3],f=p-1,g=t.data.get(s.dataId).values,v=b(s.shape),w=new Float32Array(v);function R(P){const z=P%p;let G=P-z+Math.max(0,z-o);const X=P-z+Math.min(z+o,f);let fe=0;for(;G<=X;G++){const ge=g[G];fe+=ge*ge}return fe}for(let P=0;P<v;P++){const z=R(P),G=g[P]*Math.pow(l+c*z,-h);w[P]=G}return t.makeTensorInfo(s.shape,s.dtype,w)}const wF={kernelName:Qr,backendName:"cpu",kernelFunc:CF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,y:o,dy:l}=e,{depthRadius:c,bias:h,alpha:p,beta:f}=r;Ni(l,"LRNGrad");const g=b(l.shape),v=l.shape[3],w=t.data.get(l.dataId).values,R=t.data.get(s.dataId).values,P=t.data.get(o.dataId).values,z=new Float32Array(g),G=g;for(let X=0;X<G;X++){const fe=X%v,ge=X-fe+Math.max(0,fe-c),be=X-fe+Math.min(v,fe+c+1);let He=0;for(let Je=ge;Je<be;Je++)He+=Math.pow(R[Je],2);He=p*He+h;for(let Je=ge;Je<be;Je++){let $e=-2*p*f*R[Je]*P[X]/He;X===Je&&($e+=Math.pow(He,-f)),$e*=w[X],z[Je]+=$e}}return t.makeTensorInfo(l.shape,s.dtype,z)}const IF={kernelName:gr,backendName:"cpu",kernelFunc:EF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aT(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{reductionIndices:o,keepDims:l}=r,c=t;let h=s.shape;const p=h.length,f=J(o,h);let g=f;const v=ha(g,p);let w=c.data.get(s.dataId).values;if(v!=null){const ge=new Array(p);for(let be=0;be<ge.length;be++)ge[be]=h[v[be]];w=z3(w,h,s.dtype,v,ge),g=wa(g.length,p),h=ge}Ni(s,"max"),co("max",g,p);const[R,P]=Xa(h,g),z=b(P),G=Ok(w,z,R,s.dtype),X=c.write(G,R,s.dtype);let fe=R;return l&&(fe=Da(R,f)),{dataId:X,shape:fe,dtype:s.dtype}}const SF={kernelName:Is,backendName:"cpu",kernelFunc:aT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e;Ni(s,"maxPool");const{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=r,p=1;C(Bo(l,p),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const f=ac(s.shape,o,l,p,c,h);let g;if(f.filterWidth===1&&f.filterHeight===1&&S(f.inShape,f.outShape))g=qu({inputs:{x:s},backend:t});else{const v=t.data.get(s.dataId).values,w=ze(s.shape),R=Ow(v,s.shape,s.dtype,w,f,"max");g=t.makeTensorInfo(f.outShape,s.dtype,R.values)}return g}const MF={kernelName:Ps,backendName:"cpu",kernelFunc:TF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _F(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:h,dataFormat:p}=r;Ni(s,"maxPool3d");const f=Lu(s.shape,o,l,1,c,h,p),g=t.data.get(s.dataId).values,v=nT(g,s.shape,s.dtype,ze(s.shape),f,"max");return t.makeTensorInfo(v.shape,"float32",v.values)}const RF={kernelName:Va,backendName:"cpu",kernelFunc:_F};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BF(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=r;Ni([s,o],"maxPool3DGrad");const f=Lu(o.shape,l,c,1,h,p),g=t.bufferSync(o),v=yD(g,f),w=f.strideDepth,R=f.strideHeight,P=f.strideWidth,z=f.dilationDepth,G=f.dilationHeight,X=f.dilationWidth,fe=f.effectiveFilterDepth,ge=f.effectiveFilterHeight,be=f.effectiveFilterWidth,He=fe-1-f.padInfo.front,Je=be-1-f.padInfo.left,$e=ge-1-f.padInfo.top,rt=dr(o.shape,"float32"),pt=t.bufferSync(s);for(let Gt=0;Gt<f.batchSize;++Gt)for(let zt=0;zt<f.inChannels;++zt)for(let Kt=0;Kt<f.inDepth;++Kt)for(let tn=0;tn<f.inHeight;++tn)for(let qt=0;qt<f.inWidth;++qt){const sn=Kt-He,xn=tn-$e,dn=qt-Je;let Mn=0;for(let zn=0;zn<fe;zn+=z){const Gn=(sn+zn)/w;if(!(Gn<0||Gn>=f.outDepth||Math.floor(Gn)!==Gn))for(let $n=0;$n<ge;$n+=G){const ei=(xn+$n)/R;if(!(ei<0||ei>=f.outHeight||Math.floor(ei)!==ei))for(let si=0;si<be;si+=X){const ci=(dn+si)/P;if(ci<0||ci>=f.outWidth||Math.floor(ci)!==ci)continue;const Qi=fe*ge*be-1-v.get(Gt,Gn,ei,ci,zt),Di=zn*ge*be+$n*be+si,Zi=Qi===Di?1:0;if(Zi===0)continue;const xr=pt.get(Gt,Gn,ei,ci,zt);Mn+=xr*Zi}}}rt.set(Mn,Gt,Kt,tn,qt,zt)}return t.makeTensorInfo(rt.shape,rt.dtype,rt.values)}const kF={kernelName:Bs,backendName:"cpu",kernelFunc:BF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LF(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o,output:l}=e,c=o;Ni([o,l],"maxPoolGrad");const{filterSize:h,strides:p,pad:f,dimRoundingMode:g}=r,v=ac(c.shape,h,p,1,f,g),w=t.data.get(c.dataId).values,R=dr(v.outShape,c.dtype,tT(w,c.shape,c.dtype,v).values),P=v.strideHeight,z=v.strideWidth,G=v.dilationHeight,X=v.dilationWidth,fe=v.effectiveFilterHeight,ge=v.effectiveFilterWidth,be=ge-1-v.padInfo.left,He=fe-1-v.padInfo.top,Je=dr(c.shape,"float32"),$e=t.data.get(s.dataId).values,rt=dr(s.shape,"float32",$e);for(let pt=0;pt<v.batchSize;++pt)for(let Gt=0;Gt<v.inChannels;++Gt)for(let zt=0;zt<v.inHeight;++zt)for(let Kt=0;Kt<v.inWidth;++Kt){const tn=zt-He,qt=Kt-be;let sn=0;for(let xn=0;xn<fe;xn+=G){const dn=(tn+xn)/P;if(!(dn<0||dn>=v.outHeight||Math.floor(dn)!==dn))for(let Mn=0;Mn<ge;Mn+=X){const zn=(qt+Mn)/z;if(zn<0||zn>=v.outWidth||Math.floor(zn)!==zn)continue;const Gn=fe*ge-1-R.get(pt,dn,zn,Gt),$n=xn*ge+Mn,ei=Gn===$n?1:0;if(ei===0)continue;const si=rt.get(pt,dn,zn,Gt);sn+=si*ei}}Je.set(sn,pt,zt,Kt,Gt)}return t.makeTensorInfo(Je.shape,Je.dtype,Je.values)}const DF={kernelName:Ua,backendName:"cpu",kernelFunc:LF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NF(i,e,t,r,s){const o=ze(e),l=Ow(i,e,t,o,s,"max"),c=tT(i,e,t,s,!0,r);return[l.values,c.values]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FF={kernelName:no,backendName:"cpu",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{x:r}=i,{filterSize:s,strides:o,pad:l,includeBatchInIndex:c}=e,h=t;Ni(r,"MaxPoolWithArgmax");const p=h.data.get(r.dataId).values,f=ac(r.shape,s,o,[1,1],l),[g,v]=NF(p,r.shape,r.dtype,c,f),w=h.write(g,f.outShape,r.dtype),R=h.write(v,f.outShape,r.dtype);return[{dataId:w,shape:f.outShape,dtype:r.dtype},{dataId:R,shape:f.outShape,dtype:"int32"}]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r,c=J(o,s.shape),h=Xa(s.shape,c)[1],p=b(h),f=[],g=t.makeTensorInfo([],"float32",new Float32Array([p]));f.push(g);const v=qd({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});f.push(v);const w=Gw({inputs:{a:v,b:g},backend:t});f.push(w);const R=TA({inputs:{x:w},backend:t,attrs:{axis:o,keepDims:l}});return f.forEach(P=>t.disposeIntermediateTensorInfo(P)),R}const OF={kernelName:Tl,backendName:"cpu",kernelFunc:PF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;Ni(s,"min");const c=J(o,s.shape);let h=c;const p=ha(h,s.shape.length);let f=s;p!=null&&(f=Il({inputs:{x:s},backend:t,attrs:{perm:p}}),h=wa(h.length,s.shape.length)),co("min",h,f.shape.length);const[g,v]=Xa(f.shape,h),w=b(v),R=fn(b(g),f.dtype),P=t.data.get(f.dataId).values;for(let G=0;G<R.length;++G){const X=G*w;let fe=P[X];for(let ge=0;ge<w;++ge){const be=P[X+ge];(Number.isNaN(be)||be<fe)&&(fe=be)}R[G]=fe}p!=null&&t.disposeIntermediateTensorInfo(f);const z=t.makeTensorInfo(g,f.dtype,R);if(l){const G=Da(g,c),X=ra({inputs:{x:z},backend:t,attrs:{shape:G}});return t.disposeIntermediateTensorInfo(z),X}return z}const UF={kernelName:Fo,backendName:"cpu",kernelFunc:GF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VF(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{paddings:o,mode:l}=r;Ni(s,"mirrorPad");const c=o.map((X,fe)=>X[0]+s.shape[fe]+X[1]),h=o.map(X=>X[0]),p=o.map((X,fe)=>X[0]+s.shape[fe]),f=l==="reflect"?0:1,g=t.data.get(s.dataId).values,v=s.shape.length,w=ze(s.shape),R=b(c),P=c.length,z=ze(c),G=W(s.dtype,R);for(let X=0;X<R;X++){let fe=Wn(X,P,z);for(let be=0;be<P;be++)fe[be]<h[be]?fe[be]=h[be]*2-fe[be]-f:fe[be]>=p[be]&&(fe[be]=(p[be]-1)*2-fe[be]+f);fe=fe.map((be,He)=>be-h[He]);const ge=yn(fe,v,w);G[X]=g[ge]}return{dataId:t.write(G,c,s.dtype),shape:c,dtype:s.dtype}}const zF={kernelName:Ml,backendName:"cpu",kernelFunc:VF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WF=to((i,e)=>{const t=i%e;return i<0&&e<0||i>=0&&e>=0?t:(t+e)%e}),HF=wo(pl,WF),KF={kernelName:pl,backendName:"cpu",kernelFunc:HF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oT(i){const{inputs:e,backend:t,attrs:r}=i,{logits:s}=e,{dim:o}=r,l=s.shape.length;let c=o;if(c===-1&&(c=l-1),c!==l-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${l} and dim was ${c}`);const h=J([c],s.shape),p=aT({inputs:{x:s},backend:t,attrs:{reductionIndices:h,keepDims:!1}}),f=Da(p.shape,h),g=ra({inputs:{x:p},backend:t,attrs:{shape:f}}),v=Pw({inputs:{a:s,b:g},backend:t}),w=U3({inputs:{x:v},backend:t}),R=TA({inputs:{x:w},backend:t,attrs:{axis:h,keepDims:!1}}),P=ra({inputs:{x:R},backend:t,attrs:{shape:f}}),z=Gw({inputs:{a:w,b:P},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),z}const XF={kernelName:fd,backendName:"cpu",kernelFunc:oT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QF(i){const{inputs:e,backend:t,attrs:r}=i,{logits:s}=e,{numSamples:o,seed:l,normalized:c}=r;Ni(s,"multinomial");const h=c?s:oT({inputs:{logits:s},backend:t,attrs:{dim:-1}}),p=h.shape[0],f=h.shape[1],g=t.data.get(h.dataId).values,v=[p,o],w=fn(b(v),"int32");for(let R=0;R<p;++R){const P=R*f,z=new Float32Array(f-1);z[0]=g[P];for(let fe=1;fe<z.length;++fe)z[fe]=z[fe-1]+g[P+fe];const G=mm.alea(l.toString()),X=R*o;for(let fe=0;fe<o;++fe){const ge=G();w[X+fe]=z.length;for(let be=0;be<z.length;be++)if(ge<z[be]){w[X+fe]=be;break}}}return c||t.disposeIntermediateTensorInfo(h),t.makeTensorInfo(v,"int32",w)}const ZF={kernelName:fc,backendName:"cpu",kernelFunc:QF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $F=Gh;function jF(i){const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h}=r;Ni(s,"NonMaxSuppression");const p=t.data.get(s.dataId).values,f=t.data.get(o.dataId).values,{selectedIndices:g}=$F(p,f,l,c,h);return t.makeTensorInfo([g.length],"int32",new Int32Array(g))}const YF={kernelName:$l,backendName:"cpu",kernelFunc:jF};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JF=Uh;function qF(i){const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:p}=r;Ni(s,"NonMaxSuppressionPadded");const f=t.data.get(s.dataId).values,g=t.data.get(o.dataId).values,{selectedIndices:v,validOutputs:w}=JF(f,g,l,c,h,p);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([],"int32",new Int32Array([w]))]}const e4={kernelName:jl,backendName:"cpu",kernelFunc:qF};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const t4=Vh;function n4(i){const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h,softNmsSigma:p}=r;Ni(s,"NonMaxSuppressionWithScore");const f=t.data.get(s.dataId).values,g=t.data.get(o.dataId).values,v=l,w=c,R=h,P=p,{selectedIndices:z,selectedScores:G}=t4(f,g,v,w,R,P);return[t.makeTensorInfo([z.length],"int32",new Int32Array(z)),t.makeTensorInfo([G.length],"float32",new Float32Array(G))]}const i4={kernelName:Js,backendName:"cpu",kernelFunc:n4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r4(i){const{inputs:e,backend:t,attrs:r}=i,{indices:s}=e,{dtype:o,depth:l,onValue:c,offValue:h}=r;Ni(s,"oneHot");const p=b(s.shape),f=new Float32Array(p*l);f.fill(h);const g=t.data.get(s.dataId).values;for(let v=0;v<p;++v)g[v]>=0&&g[v]<l&&(f[v*l+g[v]]=c);return t.makeTensorInfo([...s.shape,l],o,f)}const s4={kernelName:rd,backendName:"cpu",kernelFunc:r4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function My(i){const{inputs:e,backend:t}=i,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=sf({inputs:{input:r},backend:t}),o=My({inputs:{x:s},backend:t}),l=ig({inputs:{input:r},backend:t}),c=My({inputs:{x:l},backend:t}),h=Xl({inputs:{real:o,imag:c},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),h}else return zw({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const a4={kernelName:Gc,backendName:"cpu",kernelFunc:My};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lT(i){const{inputs:e,backend:t}=i,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=sf({inputs:{input:r},backend:t}),o=lT({inputs:{x:s},backend:t}),l=ig({inputs:{input:r},backend:t}),c=My({inputs:{x:l},backend:t}),h=Xl({inputs:{real:o,imag:c},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),h}else return zw({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const o4={kernelName:id,backendName:"cpu",kernelFunc:lT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cT(i){const{inputs:e,backend:t,attrs:r}=i,{axis:s}=r;if(e.length===1)return Ty({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const o=e[0].shape,l=e[0].dtype;e.forEach(f=>{F(o,f.shape,"All tensors passed to stack must have matching shapes"),C(l===f.dtype,()=>"All tensors passed to stack must have matching dtypes")});const c=[],h=e.map(f=>{const g=Ty({inputs:{input:f},backend:t,attrs:{dim:s}});return c.push(g),g}),p=rg({inputs:h,backend:t,attrs:{axis:s}});return c.forEach(f=>t.disposeIntermediateTensorInfo(f)),p}const l4={kernelName:sd,backendName:"cpu",kernelFunc:cT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c4(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{paddings:o,constantValue:l}=r;Ni(s,"pad");const c=o.map((G,X)=>G[0]+s.shape[X]+G[1]),h=o.map(G=>G[0]),p=t.data.get(s.dataId).values,f=b(s.shape),g=s.shape.length,v=ze(s.shape),w=b(c),R=c.length,P=ze(c),z=W(s.dtype,w);l!==0&&z.fill(l);for(let G=0;G<f;G++){const X=Wn(G,g,v).map((ge,be)=>ge+h[be]),fe=yn(X,R,P);z[fe]=p[G]}return{dataId:t.write(z,c,s.dtype),shape:c,dtype:s.dtype}}const uT={kernelName:oh,backendName:"cpu",kernelFunc:c4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const u4=to((i,e)=>Math.pow(i,e)),h4=wo(Yl,u4),d4={kernelName:Yl,backendName:"cpu",kernelFunc:h4};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function p4(i){const{inputs:e,backend:t,attrs:r}=i,{paramsNestedSplits:s,paramsDenseValues:o,indices:l}=e,c=s.map(z=>t.data.get(z.dataId).values),h=s.map(z=>z.shape),p=t.data.get(o.dataId).values,f=t.data.get(l.dataId).values,[g,v,w]=cL(c,h,p,o.shape,o.dtype,f,l.shape),R=g.map(z=>t.makeTensorInfo([z.length],"int32",z)),P=t.makeTensorInfo(w,o.dtype,v);return R.concat([P])}const f4={kernelName:Cf,backendName:"cpu",kernelFunc:p4};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m4(i){const{inputs:e,backend:t,attrs:r}=i,{shape:s,values:o,defaultValue:l,rowPartitionTensors:c}=e,{rowPartitionTypes:h}=r,p=t.data.get(s.dataId).values,f=t.data.get(o.dataId).values,g=t.data.get(l.dataId).values,v=c.map(z=>t.data.get(z.dataId).values),w=c.map(z=>z.shape),[R,P]=hL(p,s.shape,f,o.shape,o.dtype,g,l.shape,v,w,h);return t.makeTensorInfo(R,o.dtype,P)}const g4={kernelName:wf,backendName:"cpu",kernelFunc:m4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A4(i){const{backend:e,attrs:t}=i,{start:r,stop:s,dtype:o,step:l}=t,c=dL(r,s,l,o);return e.makeTensorInfo([c.length],o,c)}const v4={kernelName:cp,backendName:"cpu",kernelFunc:A4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y4=Ns(lh,i=>1/i),b4={kernelName:lh,backendName:"cpu",kernelFunc:y4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x4(i){const{inputs:e,backend:t,attrs:r}=i,{images:s}=e,{alignCorners:o,halfPixelCenters:l,size:c}=r;Ni(s,"resizeBilinear");const h=ze(s.shape),[p,f]=c,[g,v,w,R]=s.shape,P=t.data.get(s.dataId).values,z=new Float32Array(b([g,p,f,R])),G=[o&&p>1?v-1:v,o&&f>1?w-1:w],X=[o&&p>1?p-1:p,o&&f>1?f-1:f];let fe=0;const ge=G[0]/X[0],be=G[1]/X[1];for(let He=0;He<g;He++)for(let Je=0;Je<p;Je++){let $e;l?$e=ge*(Je+.5)-.5:$e=ge*Je;const rt=Math.max(0,Math.floor($e)),pt=$e-rt,Gt=Math.min(v-1,Math.ceil($e)),zt=He*h[0]+rt*h[1],Kt=He*h[0]+Gt*h[1];for(let tn=0;tn<f;tn++){let qt;l?qt=be*(tn+.5)-.5:qt=be*tn;const sn=Math.max(0,Math.floor(qt)),xn=qt-sn,dn=Math.min(w-1,Math.ceil(qt)),Mn=zt+sn*h[2],zn=Kt+sn*h[2],Gn=zt+dn*h[2],$n=Kt+dn*h[2];for(let ei=0;ei<R;ei++){const si=P[Mn+ei],ci=P[zn+ei],Qi=P[Gn+ei],Di=P[$n+ei],Zi=si+(Qi-si)*xn,xr=ci+(Di-ci)*xn,Lr=Zi+(xr-Zi)*pt;z[fe++]=Lr}}}return t.makeTensorInfo([g,p,f,R],"float32",z)}const C4={kernelName:io,backendName:"cpu",kernelFunc:x4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w4(i){const{inputs:e,backend:t,attrs:r}=i,{images:s,dy:o}=e,{alignCorners:l}=r;Ni([o,s],"resizeBilinearGrad");const c=ze(s.shape),[h,p,f,g]=s.shape,[,v,w]=o.shape,R=new Float32Array(h*p*f*g),P=[l&&v>1?p-1:p,l&&w>1?f-1:f],z=[l&&v>1?v-1:v,l&&w>1?w-1:w],G=P[0]/z[0],X=P[1]/z[1],fe=t.data.get(o.dataId).values;let ge=0;for(let be=0;be<h;be++){const He=be*c[0];for(let Je=0;Je<v;Je++){const $e=Je*G,rt=Math.floor($e),pt=Math.min(Math.ceil($e),p-1),Gt=He+rt*c[1],zt=He+pt*c[1],Kt=$e-rt,tn=1-Kt;for(let qt=0;qt<w;qt++){const sn=qt*X,xn=Math.floor(sn),dn=Math.min(Math.ceil(sn),f-1),Mn=sn-xn,zn=1-Mn,Gn=Gt+xn*c[2],$n=Gt+dn*c[2],ei=zt+xn*c[2],si=zt+dn*c[2],ci=tn*zn,Qi=tn*Mn,Di=Kt*zn,Zi=Kt*Mn;for(let xr=0;xr<g;xr++){const Lr=fe[ge++];R[Gn+xr]+=Lr*ci,R[$n+xr]+=Lr*Qi,R[ei+xr]+=Lr*Di,R[si+xr]+=Lr*Zi}}}}return t.makeTensorInfo([h,f,p,g],"float32",R)}const E4={kernelName:za,backendName:"cpu",kernelFunc:w4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I4(i){const{inputs:e,backend:t,attrs:r}=i,{images:s}=e,{alignCorners:o,halfPixelCenters:l,size:c}=r;Ni(s,"resizeNearestNeighbor");const h=ze(s.shape),[p,f]=c,[g,v,w,R]=s.shape,P=t.data.get(s.dataId).values,z=new Float32Array(g*p*f*R),G=[o&&p>1?v-1:v,o&&f>1?w-1:w],X=[o&&p>1?p-1:p,o&&f>1?f-1:f],fe=G[0]/X[0],ge=G[1]/X[1];let be=0;for(let He=0;He<g;He++){const Je=He*h[0];for(let $e=0;$e<p;$e++){const rt=l?fe*($e+.5):fe*$e;let pt=Math.min(v-1,o?Math.round(rt):Math.floor(rt));l&&(pt=Math.max(0,pt));const Gt=Je+pt*h[1];for(let zt=0;zt<f;zt++){const Kt=l?ge*(zt+.5):ge*zt;let tn=Math.min(w-1,o?Math.round(Kt):Math.floor(Kt));l&&(tn=Math.max(0,tn));const qt=Gt+tn*h[2];for(let sn=0;sn<R;sn++){const xn=P[qt+sn];z[be++]=xn}}}}return t.makeTensorInfo([g,p,f,R],s.dtype,z)}const S4={kernelName:Cu,backendName:"cpu",kernelFunc:I4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T4(i){const{inputs:e,backend:t,attrs:r}=i,{images:s,dy:o}=e,{alignCorners:l}=r;Ni([o,s],"resizeNearestNeighborGrad");const c=ze(s.shape),h=ze(o.shape),[p,f,g,v]=s.shape,[,w,R]=o.shape,P=new Float32Array(p*f*g*v),z=t.data.get(o.dataId).values,G=[l&&w>1?f-1:f,l&&R>1?g-1:g],X=[l&&w>1?w-1:w,l&&R>1?R-1:R],fe=G[0]/X[0],ge=G[1]/X[1],be=1/fe,He=1/ge,Je=Math.ceil(be)*2+2,$e=Math.ceil(He)*2+2;for(let rt=0;rt<p;rt++){const pt=rt*c[0];for(let Gt=0;Gt<f;Gt++){const zt=pt+Gt*c[1],Kt=Math.floor(Gt*be),tn=Math.floor(Kt-Je/2);for(let qt=0;qt<g;qt++){const sn=zt+qt*c[2],xn=Math.floor(qt*He),dn=Math.floor(xn-$e/2);for(let Mn=0;Mn<v;Mn++){let zn=0;for(let Gn=0;Gn<Je;Gn++){const $n=Gn+tn;if($n<0||$n>=w)continue;const ei=pt+$n*h[1],si=$n*fe,ci=Math.min(f-1,l?Math.round(si):Math.floor(si));if(Gt===ci)for(let Qi=0;Qi<$e;Qi++){const Di=Qi+dn;if(Di<0||Di>=R)continue;const Zi=ei+Di*h[2],xr=Di*ge,Lr=Math.min(g-1,l?Math.round(xr):Math.floor(xr));qt===Lr&&(zn+=z[Zi+Mn])}}P[sn+Mn]=zn}}}}return t.makeTensorInfo(s.shape,s.dtype,P)}const M4={kernelName:wu,backendName:"cpu",kernelFunc:T4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _4(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{dims:o}=r;Ni(s,"reverse");const l=s.shape.length,c=J(o,s.shape);if(l===0)return qu({inputs:{x:s},backend:t});const h=new Ss(s.shape,s.dtype),p=t.bufferSync(s);for(let f=0;f<h.size;f++){const g=h.indexToLoc(f),v=g.slice();c.forEach(w=>v[w]=s.shape[w]-1-v[w]),h.set(p.get(...v),...g)}return t.makeTensorInfo(h.shape,h.dtype,h.values)}const R4={kernelName:Bl,backendName:"cpu",kernelFunc:_4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const B4={kernelName:Si,backendName:"cpu",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{image:r}=i,{radians:s,fillValue:o,center:l}=e,c=t,h=W(r.dtype,b(r.shape)),[p,f,g,v]=r.shape,[w,R]=Hp(l,f,g),P=255,z=Math.sin(s),G=Math.cos(s),X=c.data.get(r.dataId).values;for(let fe=0;fe<p;fe++){const ge=fe*g*f*v;for(let be=0;be<f;be++){const He=be*(g*v);for(let Je=0;Je<g;Je++){const $e=Je*v;for(let rt=0;rt<v;rt++){const pt=[p,be,Je,rt],Gt=pt[2],zt=pt[1];let Kt=(Gt-w)*G-(zt-R)*z,tn=(Gt-w)*z+(zt-R)*G;Kt=Math.round(Kt+w),tn=Math.round(tn+R);let qt=o;if(typeof o!="number"&&(rt===3?qt=P:qt=o[rt]),Kt>=0&&Kt<g&&tn>=0&&tn<f){const xn=tn*(g*v),dn=Kt*v,Mn=ge+xn+dn+rt;qt=X[Mn]}const sn=ge+He+$e+rt;h[sn]=qt}}}}return{dataId:c.write(h,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const k4=Ns(Jl,i=>{const e=Math.floor(i);return i-e<.5?Math.floor(i):i-e>.5?Math.ceil(i):e%2===0?e:e+1}),L4={kernelName:Jl,backendName:"cpu",kernelFunc:k4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D4(i){const{inputs:e,backend:t,attrs:r}=i,{indices:s,updates:o}=e,{shape:l}=r,{sliceRank:c,numUpdates:h,sliceSize:p,strides:f,outputSize:g}=vp(o,s,l),v=!0,w=t.bufferSync(s),R=t.bufferSync(o),P=IA(w,R,l,g,p,h,c,f,0,v);return t.makeTensorInfo(l,P.dtype,P.values)}const N4={kernelName:aa,backendName:"cpu",kernelFunc:D4};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F4(i,e){let t=0,r=i.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),i[s]<e?t=s+1:r=s;return r}function P4(i,e){let t=0,r=i.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),i[s]<=e?t=s+1:r=s;return r}function O4(i,e,t,r,s,o){const l=U("int32",t*s);for(let c=0;c<t;++c){const h=i.slice(c*r,(c+1)*r),p=c*s;for(let f=0;f<s;++f)l[p+f]=o==="left"?F4(h,e[f+p]):P4(h,e[f+p])}return l}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G4(i){const{inputs:e,backend:t,attrs:r}=i,{sortedSequence:s,values:o}=e,{side:l}=r,c=t.data.get(s.dataId).values,h=t.data.get(o.dataId).values,p=O4(c,h,s.shape[0],s.shape[1],o.shape[1],l);return t.makeTensorInfo(o.shape,"int32",p)}const U4={kernelName:cd,backendName:"cpu",kernelFunc:G4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V4(i){const{inputs:e,backend:t}=i,{condition:r,t:s,e:o}=e;Ni([r,s,o],"select");const l=r.shape.length,c=t.data.get(r.dataId).values,h=t.data.get(s.dataId).values,p=t.data.get(o.dataId).values,f=Uo(s.dtype,o.dtype),g=fn(b(s.shape),f);let v=0;const w=l===0||l>1||s.shape.length===1?1:b(s.shape.slice(1));for(let R=0;R<c.length;R++)for(let P=0;P<w;P++)c[R]===1?g[v++]=h[R]:g[v++]=p[R];return t.makeTensorInfo(s.shape,f,g)}const z4={kernelName:ud,backendName:"cpu",kernelFunc:V4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W4=Kp,H4=Zu,K4=Ns(uh,i=>i>=0?H4*i:W4*(Math.exp(i)-1)),X4={kernelName:uh,backendName:"cpu",kernelFunc:K4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Q4=Ns(ph,i=>i<0?-1:i>0?1:0),Z4={kernelName:ph,backendName:"cpu",kernelFunc:Q4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $4=Ns(hh,i=>Math.sin(i)),j4={kernelName:hh,backendName:"cpu",kernelFunc:$4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y4=Ns(dh,i=>Math.sinh(i)),J4={kernelName:dh,backendName:"cpu",kernelFunc:Y4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hT=Math.log(11920928955078125e-23)+2,q4=Ns(mh,i=>{const e=i>-hT,t=i<hT,r=Math.exp(i);let s;return t?s=r:e?s=i:s=Math.log(1+r),s}),eP={kernelName:mh,backendName:"cpu",kernelFunc:q4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockShape:o,paddings:l}=r;Ni([s],"spaceToBatchND");const c=b(o),h=[[0,0]];h.push(...l);for(let z=1+o.length;z<s.shape.length;++z)h.push([0,0]);const p=uT.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:h,constantValue:0}}),f=Kd(p.shape,o,c,!1),g=Xd(f.length,o.length,!1),v=Xh(p.shape,o,c,!1),w=ra({inputs:{x:p},backend:t,attrs:{shape:f}}),R=Il({inputs:{x:w},backend:t,attrs:{perm:g}}),P=ra({inputs:{x:R},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),P}const nP={kernelName:dd,backendName:"cpu",kernelFunc:tP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iP(i){const{inputs:e,backend:t}=i,{indices:r,values:s,denseShape:o,defaultValue:l}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const c=t.data.get(r.dataId).values,h=t.data.get(s.dataId).values,p=t.data.get(o.dataId).values,f=t.data.get(l.dataId).values[0],[g,v,w,R,P]=yL(c,r.shape,r.dtype,h,s.dtype,p,f);return[t.makeTensorInfo(v,r.dtype,g),t.makeTensorInfo([v[0]],s.dtype,w),t.makeTensorInfo([R.length],"bool",new Uint8Array(R.map(z=>Number(z)))),t.makeTensorInfo([P.length],r.dtype,new Int32Array(P))]}const rP={kernelName:md,backendName:"cpu",kernelFunc:iP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sP(i){const{inputs:e,backend:t}=i,{inputIndices:r,inputShape:s,newShape:o}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const l=Array.from(t.data.get(s.dataId).values),c=t.data.get(r.dataId).values,h=Array.from(t.data.get(o.dataId).values),[p,f,g]=bL(c,r.shape,r.dtype,l,h);return[t.makeTensorInfo(f,r.dtype,p),t.makeTensorInfo([g.length],o.dtype,new Int32Array(g))]}const aP={kernelName:hp,backendName:"cpu",kernelFunc:sP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oP(i){const{inputs:e,backend:t}=i,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const l=t.data.get(r.dataId).values,c=t.data.get(s.dataId).values,h=t.data.get(o.dataId).values,[p,f]=Q3(l,r.shape,r.dtype,c,h,!0);return t.makeTensorInfo(f,r.dtype,p)}const lP={kernelName:Ah,backendName:"cpu",kernelFunc:oP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cP(i){const{inputs:e,backend:t}=i,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const l=t.data.get(r.dataId).values,c=t.data.get(s.dataId).values,h=t.data.get(o.dataId).values,[p,f]=Q3(l,r.shape,r.dtype,c,h);return t.makeTensorInfo(f,r.dtype,p)}const uP={kernelName:Ef,backendName:"cpu",kernelFunc:cP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hP(i){const{inputs:e,backend:t,attrs:r}=i,{sparseIndices:s,sparseValues:o,defaultValue:l}=e,{outputShape:c}=r,{sliceRank:h,numUpdates:p,sliceSize:f,strides:g,outputSize:v}=vp(o,s,c),w=!1,R=t.bufferSync(s);let P;switch(o.dtype){case"bool":{const z=t.bufferSync(o),G=!!t.data.get(l.dataId).values[0];P=IA(R,z,c,v,f,p,h,g,G,w);break}case"float32":{const z=t.bufferSync(o),G=t.data.get(l.dataId).values[0];P=IA(R,z,c,v,f,p,h,g,G,w);break}case"int32":{const z=t.bufferSync(o),G=t.data.get(l.dataId).values[0];P=IA(R,z,c,v,f,p,h,g,G,w);break}case"string":{const z=t.bufferSync(o),G=Pl(t.data.get(l.dataId).values[0]);P=IA(R,z,c,v,f,p,h,g,G,w);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(c,P.dtype,P.values)}const dP={kernelName:kl,backendName:"cpu",kernelFunc:hP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{numOrSizeSplits:o,axis:l}=r,c=J(l,s.shape)[0],h=Fm(s,o,c),p=new Array(s.shape.length).fill(0),f=s.shape.slice();return h.map(g=>{const v=[...f];v[c]=g;const w=af({inputs:{x:s},backend:t,attrs:{begin:p,size:v}});return p[c]+=g,w})}const fP={kernelName:pd,backendName:"cpu",kernelFunc:pP};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mP={kernelName:dp,backendName:"cpu",kernelFunc:({inputs:i,backend:e})=>{const{x:t}=i,r=e;Ni(t,"square");const s=r.data.get(t.dataId).values,o=new Float32Array(s.length);for(let l=0;l<s.length;++l){const c=s[l];o[l]=c*c}return{dataId:r.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gP=Ns(Uc,(i,e)=>{const t=e;return isNaN(i)?NaN:i>0?1:t.alpha}),AP={kernelName:Uc,backendName:"cpu",kernelFunc:gP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{begin:o,end:l,strides:c,beginMask:h,endMask:p,ellipsisMask:f,newAxisMask:g,shrinkAxisMask:v}=r;Ni(s,"stridedSlice");const{finalShapeSparse:w,finalShape:R,isIdentity:P,sliceDim0:z,isSimpleSlice:G,begin:X,end:fe,strides:ge}=$g(s.shape,o,l,c,h,p,f,g,v);let be;if(P)be=ra({inputs:{x:s},backend:t,attrs:{shape:R}});else if(z||G){C(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const He=Zg(X,fe,ge),Je=af({inputs:{x:s},backend:t,attrs:{begin:X,size:He}});be=ra({inputs:{x:Je},backend:t,attrs:{shape:R}}),t.disposeIntermediateTensorInfo(Je)}else{const He=t.bufferSync(s),Je=SL(w,He,ge,X);be=t.makeTensorInfo(R,Je.dtype,Je.values)}return be}const yP={kernelName:kn,backendName:"cpu",kernelFunc:vP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bP(i){const{inputs:e,backend:t,attrs:r}=i,{separator:s,nGramWidths:o,leftPad:l,rightPad:c,padWidth:h,preserveShortSequences:p}=r,{data:f,dataSplits:g}=e,v=t.data.get(f.dataId).values,w=t.data.get(g.dataId).values,[R,P]=ML(v,w,s,o,l,c,h,p);return[t.makeTensorInfo([R.length],"string",R),t.makeTensorInfo(g.shape,"int32",P)]}const xP={kernelName:ro,backendName:"cpu",kernelFunc:bP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CP(i){const{inputs:e,backend:t,attrs:r}=i,{skipEmpty:s}=r,{input:o,delimiter:l}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const c=t.data.get(o.dataId).values,h=t.data.get(l.dataId).values[0],[p,f,g]=RL(c,h,s),v=f.length;return[t.makeTensorInfo([v,2],"int32",p),t.makeTensorInfo([v],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(g))]}const wP={kernelName:gd,backendName:"cpu",kernelFunc:CP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EP(i){const{inputs:e,backend:t,attrs:r}=i,{numBuckets:s}=r,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const l=t.data.get(o.dataId).values,c=BL(l,s);return t.makeTensorInfo(o.shape,"int32",c)}const IP={kernelName:pp,backendName:"cpu",kernelFunc:EP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SP=Ns(Ll,i=>Math.tan(i)),TP={kernelName:Ll,backendName:"cpu",kernelFunc:SP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MP=Ns(ql,i=>Math.tanh(i)),_P={kernelName:ql,backendName:"cpu",kernelFunc:MP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{reps:o}=r;Ni(s,"tile");const l=NL(t.bufferSync(s),o);return t.makeTensorInfo(l.shape,l.dtype,l.values)}const BP={kernelName:ml,backendName:"cpu",kernelFunc:RP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{k:o,sorted:l}=r;Ni(s,"topk");const c=t.data.get(s.dataId).values,[h,p]=FL(c,s.shape,s.dtype,o,l);return[t.makeTensorInfo(h.shape,h.dtype,h.values),t.makeTensorInfo(p.shape,p.dtype,p.values)]}const LP={kernelName:Iu,backendName:"cpu",kernelFunc:kP};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DP(i){const{inputs:e,attrs:t,backend:r}=i,{image:s,transforms:o}=e,{interpolation:l,fillMode:c,fillValue:h,outputShape:p}=t,[f,g,v,w]=s.shape,[R,P]=p??[g,v],z=[f,R,P,w],G=ze(s.shape),X=G[0],fe=G[1],ge=G[2],be=ze(z),He=be[0],Je=be[1],$e=be[2],rt=W(s.dtype,b(z));rt.fill(h);const pt=r.data.get(s.dataId).values,Gt=r.data.get(o.dataId).values;for(let zt=0;zt<f;++zt){const Kt=o.shape[0]===1?Gt:Gt.subarray(zt*8,zt*8+8);for(let tn=0;tn<R;++tn)for(let qt=0;qt<P;++qt)for(let sn=0;sn<w;++sn){let xn;const dn=Kt[6]*qt+Kt[7]*tn+1;if(dn===0)continue;const Mn=(Kt[0]*qt+Kt[1]*tn+Kt[2])/dn,zn=(Kt[3]*qt+Kt[4]*tn+Kt[5])/dn,Gn=dT(Mn,v,c),$n=dT(zn,g,c);switch(l){case"nearest":xn=UP(pt,g,v,X,fe,ge,zt,$n,Gn,sn,h);break;case"bilinear":xn=VP(pt,g,v,X,fe,ge,zt,$n,Gn,sn,h);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${l}`)}const ei=zt*He+tn*Je+qt*$e+sn;rt[ei]=xn}return r.makeTensorInfo(z,s.dtype,rt)}return{dataId:r.write(rt,z,s.dtype),shape:s.shape,dtype:s.dtype}}const NP={kernelName:yh,backendName:"cpu",kernelFunc:DP};function dT(i,e,t){switch(t){case"reflect":return FP(i,e);case"wrap":return PP(i,e);case"nearest":return GP(i,e);case"constant":default:return OP(i)}}function FP(i,e){let t=i;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return te(0,t,e-1)}function PP(i,e){let t=i;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return te(0,t,e-1)}function OP(i,e){return i}function GP(i,e){return te(0,i,e-1)}function MA(i,e,t,r,s,o,l,c,h,p,f){const g=l*r+c*s+h*o+p;return 0<=c&&c<e&&0<=h&&h<t?i[g]:f}function UP(i,e,t,r,s,o,l,c,h,p,f){const g=Math.round(c),v=Math.round(h);return MA(i,e,t,r,s,o,l,g,v,p,f)}function VP(i,e,t,r,s,o,l,c,h,p,f){const g=Math.floor(c),v=Math.floor(h),w=g+1,R=v+1,P=(R-h)*MA(i,e,t,r,s,o,l,g,v,p,f)+(h-v)*MA(i,e,t,r,s,o,l,g,R,p,f),z=(R-h)*MA(i,e,t,r,s,o,l,w,v,p,f)+(h-v)*MA(i,e,t,r,s,o,l,w,R,p,f);return(w-c)*P+(c-g)*z}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zP(i){const{inputs:e,attrs:t,backend:r}=i,{axis:s}=t,{x:o}=e;Ni(o,"unique");const l=r.data.get(o.dataId).values,{outputValues:c,outputShape:h,indices:p}=PL(l,s,o.shape,o.dtype);return[r.makeTensorInfo(h,o.dtype,c),r.makeTensorInfo([p.length],"int32",p)]}const WP={kernelName:Ad,backendName:"cpu",kernelFunc:zP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HP(i){const{inputs:e,backend:t,attrs:r}=i,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const l=s.shape.length,c=s.shape[o],h=new Array(l-1);let p=0;for(let w=0;w<l;w++)w!==o&&(h[p++]=s.shape[w]);const f=new Array(l).fill(0),g=s.shape.slice();g[o]=1;const v=new Array(c);for(let w=0;w<v.length;w++){f[o]=w;const R=af({inputs:{x:s},backend:t,attrs:{begin:f,size:g}});v[w]=ra({inputs:{x:R},backend:t,attrs:{shape:h}}),t.disposeIntermediateTensorInfo(R)}return v}const KP={kernelName:oa,backendName:"cpu",kernelFunc:HP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XP(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,segmentIds:o}=e,{numSegments:l}=r;Ni(s,"unsortedSegmentSum");const c=s.shape.length,h=o.shape.length,p=[],f=[],g=c-h;let v=o;for(let R=0;R<g;++R){const P=Ty({inputs:{input:v},backend:t,attrs:{dim:R+1}});v=P,f.push(P)}for(let R=0;R<l;++R){const P=Ya(R,"int32"),z=t.makeTensorInfo([],"int32",P),G=G3({inputs:{a:z,b:v},backend:t}),X=qd({inputs:{x:G},backend:t,attrs:{dtype:"float32"}}),fe=Iy({inputs:{a:X,b:s},backend:t}),ge=TA({inputs:{x:fe},backend:t,attrs:{axis:0,keepDims:!1}});p.push(ge),f.push(z),f.push(G),f.push(X),f.push(fe),f.push(ge)}const w=cT({inputs:p,backend:t,attrs:{axis:0}});return f.forEach(R=>t.disposeIntermediateTensorInfo(R)),w}const QP={kernelName:Io,backendName:"cpu",kernelFunc:XP};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZP=[QL,jB,$L,YL,rk,qL,tD,iD,sD,oD,cD,hD,pD,gD,vD,xD,wD,ID,TD,KL,_D,BD,LD,ND,tk,lk,PD,YB,OD,UD,VD,WD,KD,QD,$D,YD,qD,tN,iN,sN,oN,cN,hN,dN,fN,gN,vN,yN,bN,xN,EN,OL,SN,hk,DN,pk,NN,gk,VN,zN,HN,yk,QN,$N,YN,qN,tF,Ek,Tk,JB,iF,GD,sF,oF,cF,GL,Rk,Lk,hF,Pk,pF,gF,vF,xF,wF,IF,SF,Vk,MF,RF,kF,DF,FF,OF,UF,Hk,zF,KF,ZF,Xk,$k,YF,e4,i4,Jk,s4,o4,l4,uT,d4,VL,nL,f4,g4,v4,qB,Uw,b4,zL,WL,HL,C4,E4,S4,M4,R4,B4,L4,mL,N4,U4,z4,X4,gL,Z4,j4,J4,vL,XF,eP,nP,rP,aP,lP,uP,dP,fP,CL,mP,IL,AP,yP,xP,wP,IP,DL,CN,TP,_P,BP,LP,NP,qk,WP,KP,QP,a4];for(const i of ZP)so(i);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const of={},_y={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $P(i,e){of[i]=e}function Au(i,e){if(!(i in of)||e!=null){const r=YP(i,e);if(r!==null)of[i]=r;else return console.log("Could not get context for WebGL version",i),null}const t=of[i];return t==null||t.isContextLost()?(delete of[i],Au(i)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),of[i])}function jP(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function YP(i,e){if(i!==1&&i!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??jP(i);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete of[i]},!1),Ye().getBool("SOFTWARE_WEBGL_ENABLED")&&(_y.failIfMajorPerformanceCaveat=!1),i===1?t.getContext("webgl",_y)||t.getContext("experimental-webgl",_y):t.getContext("webgl2",_y)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var _A;(function(i){i[i.DENSE=0]="DENSE",i[i.SHARED_BATCH=1]="SHARED_BATCH"})(_A||(_A={}));var hc;(function(i){i[i.RENDER=0]="RENDER",i[i.UPLOAD=1]="UPLOAD",i[i.PIXELS=2]="PIXELS",i[i.DOWNLOAD=3]="DOWNLOAD"})(hc||(hc={}));var Do;(function(i){i[i.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",i[i.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",i[i.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",i[i.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",i[i.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Do||(Do={}));function RA(i,e){return[e,i]}function JP(i,e){return i*e}function Ry(i){const e=b(i),t=Math.ceil(e/4);return O(t)}function sg(i,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(i/2))]}function qP(i,e){const[t,r]=sg(i,e);return t*r*4}function Ww(i,e){const t=i;let r,s,o,l,c,h,p,f,g,v;return Ye().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,o=t.RGBA16F,l=t.RGBA32F,c=t.RED,p=4,f=1,g=t.HALF_FLOAT,v=t.FLOAT,h=t.RGBA8):(r=i.RGBA,s=i.RGBA,o=i.RGBA,l=t.RGBA,c=i.RGBA,p=4,f=4,g=e!=null?e.HALF_FLOAT_OES:null,v=i.FLOAT,h=i.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:l,textureFormatFloat:c,downloadTextureFormat:h,downloadUnpackNumChannels:p,defaultNumChannels:f,textureTypeHalfFloat:g,textureTypeFloat:v}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pi(i,e){const t=e();return Ye().getBool("DEBUG")&&e5(i),t}function e5(i){const e=i.getError();if(e!==i.NO_ERROR)throw new Error("WebGL Error: "+r5(i,e))}const t5=596e-10,n5=65504;function i5(i){return!!(Ye().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||i===0||t5<Math.abs(i)&&Math.abs(i)<n5)}function r5(i,e){switch(e){case i.NO_ERROR:return"NO_ERROR";case i.INVALID_ENUM:return"INVALID_ENUM";case i.INVALID_VALUE:return"INVALID_VALUE";case i.INVALID_OPERATION:return"INVALID_OPERATION";case i.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case i.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case i.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function By(i,e){return Yh(i,()=>i.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function s5(i,e){const t=Yh(i,()=>i.createShader(i.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Pi(i,()=>i.shaderSource(t,e)),Pi(i,()=>i.compileShader(t)),i.getShaderParameter(t,i.COMPILE_STATUS)===!1)throw console.log(i.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function a5(i,e){const t=Yh(i,()=>i.createShader(i.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Pi(i,()=>i.shaderSource(t,e)),Pi(i,()=>i.compileShader(t)),Ye().get("ENGINE_COMPILE_ONLY"))return t;if(i.getShaderParameter(t,i.COMPILE_STATUS)===!1)throw pT(e,i.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const o5=/ERROR: [0-9]+:([0-9]+):/g;function pT(i,e){const t=o5.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(i);return}const r=+t[1],s=i.split(`
`),o=s.length.toString().length+2,l=s.map((g,v)=>_((v+1).toString(),o)+g);let c=0;for(let g=0;g<l.length;g++)c=Math.max(l[g].length,c);const h=l.slice(0,r-1),p=l.slice(r-1,r),f=l.slice(r);console.log(h.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${_(p[0],c)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function l5(i){return Yh(i,()=>i.createProgram(),"Unable to create WebGLProgram.")}function c5(i,e){if(Pi(i,()=>i.linkProgram(e)),!Ye().get("ENGINE_COMPILE_ONLY")&&i.getProgramParameter(e,i.LINK_STATUS)===!1)throw console.log(i.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Hw(i,e){if(Pi(i,()=>i.validateProgram(e)),i.getProgramParameter(e,i.VALIDATE_STATUS)===!1)throw console.log(i.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function u5(i,e){const t=Yh(i,()=>i.createBuffer(),"Unable to create WebGLBuffer");return Pi(i,()=>i.bindBuffer(i.ARRAY_BUFFER,t)),Pi(i,()=>i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW)),t}function h5(i,e){const t=Yh(i,()=>i.createBuffer(),"Unable to create WebGLBuffer");return Pi(i,()=>i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t)),Pi(i,()=>i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,i.STATIC_DRAW)),t}function d5(i){return Yh(i,()=>i.createTexture(),"Unable to create WebGLTexture.")}function p5(i,e){const t=Ye().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(i<=0||e<=0){const r=`[${i}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(i>t||e>t){const r=`[${i}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function f5(i){return Yh(i,()=>i.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function fT(i,e,t,r,s,o,l){const c=i.getAttribLocation(e,t);return c===-1?!1:(Pi(i,()=>i.bindBuffer(i.ARRAY_BUFFER,r)),Pi(i,()=>i.vertexAttribPointer(c,s,i.FLOAT,!1,o,l)),Pi(i,()=>i.enableVertexAttribArray(c)),!0)}function m5(i,e,t){b5(i,t),Pi(i,()=>i.activeTexture(i.TEXTURE0+t)),Pi(i,()=>i.bindTexture(i.TEXTURE_2D,e))}function g5(i,e,t){return Yh(i,()=>i.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function A5(i,e,t){return i.getUniformLocation(e,t)}function v5(i,e,t,r){Pi(i,()=>m5(i,e,r)),Pi(i,()=>i.uniform1i(t,r))}function Kw(i,e,t){Pi(i,()=>i.bindFramebuffer(i.FRAMEBUFFER,t)),Pi(i,()=>i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0))}function mT(i,e){Pi(i,()=>i.bindFramebuffer(i.FRAMEBUFFER,e)),Pi(i,()=>i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null,0))}function ky(i){const e=i.checkFramebufferStatus(i.FRAMEBUFFER);if(e!==i.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+y5(i,e))}function y5(i,e){switch(e){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Yh(i,e,t){const r=Pi(i,()=>e());if(r==null)throw new Error(t);return r}function b5(i,e){const t=i.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+i.TEXTURE0;if(r<i.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function ag(i,e=2){return b(i.slice(0,i.length-e))}function og(i){if(i.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[i.length>1?i[i.length-2]:1,i[i.length-1]]}function Xw(i){let e=[1,1,1];return i.length===0||i.length===1&&i[0]===1||(e=[ag(i),...og(i)]),e}function x5(i,e=!1){let t=Ye().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Ye().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&Ye().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,i=i.map((c,h)=>h>=i.length-2?E(i[h]):i[h]),i.length===1&&(i=[2,i[0]])),i.length!==2&&(i=Y(i).newShape);let s=b(i),o=null;i.length<=1&&s<=t?o=[1,s]:i.length===2&&i[0]<=t&&i[1]<=t?o=i:i.length===3&&i[0]*i[1]<=t&&i[2]<=t?o=[i[0]*i[1],i[2]]:i.length===3&&i[0]<=t&&i[1]*i[2]<=t?o=[i[0],i[1]*i[2]]:i.length===4&&i[0]*i[1]*i[2]<=t&&i[3]<=t?o=[i[0]*i[1]*i[2],i[3]]:i.length===4&&i[0]<=t&&i[1]*i[2]*i[3]<=t&&(o=[i[0],i[1]*i[2]*i[3]]);const l=o!=null&&Math.max(...o)>r&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||l)if(e){const c=ag(i);let h=2,p=2;i.length&&([h,p]=og(i)),s=c*(h/2)*(p/2),o=O(s).map(f=>f*2)}else o=O(s);return o}function Ly(i){return i%2===0}function Dy(i,e){if(i=i.slice(-2),e=e.slice(-2),S(i,e)||!i.length||!e.length||i[0]===0||i[1]===0||e[0]===0||e[1]===0)return!0;if(i.length!==e.length){const t=i.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Ly(t)&&Ly(r)&&(i[0]===1||e[0]===1))return!0}return i[1]===e[1]&&Ly(i[0])&&Ly(e[0])}let Qw,Zw;function C5(i){if(Qw==null){const e=Au(i);Qw=e.getParameter(e.MAX_TEXTURE_SIZE)}return Qw}function w5(i){if(Zw==null){const e=Au(i);Zw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Zw)}function E5(i){if(i===0)return 0;let e;const t=Au(i);return Lc(t,"EXT_disjoint_timer_query_webgl2")&&i===2?e=2:Lc(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Lc(i,e){return i.getExtension(e)!=null}function gT(i){try{if(Au(i)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function I5(i){if(i===0)return!1;const e=Au(i);if(i===1){if(!Lc(e,"OES_texture_float"))return!1}else if(!Lc(e,"EXT_color_buffer_float"))return!1;return $w(e)}function S5(i){if(i===0)return!1;const e=Au(i);if(i===1){if(!Lc(e,"OES_texture_float")||!Lc(e,"WEBGL_color_buffer_float"))return!1}else{if(Lc(e,"EXT_color_buffer_float"))return $w(e);const t="EXT_color_buffer_half_float";if(Lc(e,t)){const r=e.getExtension(t);return T5(e,r)}return!1}return $w(e)}function $w(i){const e=Ww(i),t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);const r=1,s=1;i.texImage2D(i.TEXTURE_2D,0,e.internalFormatFloat,r,s,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,o),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const l=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;return i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteTexture(t),i.deleteFramebuffer(o),l}function T5(i,e){const t=Ww(i,e),r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);const s=1,o=1;i.texImage2D(i.TEXTURE_2D,0,t.internalFormatHalfFloat,s,o,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const l=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,l),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0);const c=i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE;return i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteTexture(r),i.deleteFramebuffer(l),c}function M5(i){return i!==2?!1:Au(i).fenceSync!=null}function BA(i,e){Array.isArray(i)||(i=[i]),i.forEach(t=>{t!=null&&C(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xi=Ye();Xi.registerFlag("HAS_WEBGL",()=>Xi.getNumber("WEBGL_VERSION")>0),Xi.registerFlag("WEBGL_VERSION",()=>gT(2)?2:gT(1)?1:0),Xi.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),Xi.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Xi.get("WEBGL_VERSION")===2),Xi.registerFlag("WEBGL_CPU_FORWARD",()=>!0),Xi.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),Xi.registerFlag("WEBGL_PACK",()=>Xi.getBool("HAS_WEBGL")),Xi.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_CLIP",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_PACK_REDUCE",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_LAZILY_UNPACK",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_CONV_IM2COL",()=>Xi.getBool("WEBGL_PACK")),Xi.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>C5(Xi.getNumber("WEBGL_VERSION"))),Xi.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>w5(Xi.getNumber("WEBGL_VERSION"))),Xi.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const i=Xi.getNumber("WEBGL_VERSION");return i===0?0:E5(i)}),Xi.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Xi.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Kc()),Xi.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>I5(Xi.getNumber("WEBGL_VERSION"))),Xi.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Xi.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Xi.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),Xi.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>S5(Xi.getNumber("WEBGL_VERSION"))),Xi.registerFlag("WEBGL_FENCE_API_ENABLED",()=>M5(Xi.getNumber("WEBGL_VERSION"))),Xi.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Xi.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),Xi.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,i=>{if(i<0&&i!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${i}.`)}),Xi.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Kc()?1:-1,i=>{if(i<0&&i!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${i}.`)}),Xi.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),Xi.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),Xi.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),Xi.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),Xi.registerFlag("WEBGL_EXP_CONV",()=>!1),Xi.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Xi.getBool("IS_TEST")),Xi.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),Xi.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),Xi.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sl(){let i,e,t,r,s,o,l,c,h,p;return Ye().getNumber("WEBGL_VERSION")===2?(i="#version 300 es",e="in",t="out",r="in",s="texture",o="outputColor",l="out vec4 outputColor;",c=Ye().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",h="",p=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(i="",e="attribute",t="varying",r="varying",s="texture2D",o="gl_FragColor",l="",c=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,h=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,p=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:i,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:o,defineOutput:l,defineSpecialNaN:c,defineSpecialInf:h,defineRound:p}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lf(i,e,t="index"){const r=ze(e);return r.map((s,o)=>{const l=`int ${i[o]} = ${t} / ${s}`,c=o===r.length-1?`int ${i[o+1]} = ${t} - ${i[o]} * ${s}`:`index -= ${i[o]} * ${s}`;return`${l}; ${c};`}).join("")}function Ny(i,e,t="index"){const r=ze(e);return r.map((s,o)=>{const l=`int ${i[o]} = ${t} / outShapeStrides[${o}]`,c=o===r.length-1?`int ${i[o+1]} = ${t} - ${i[o]} * outShapeStrides[${o}]`:`index -= ${i[o]} * outShapeStrides[${o}]`;return`${l}; ${c};`}).join("")}function _5(i,e){const t=i.length,r=i.map(o=>`${e}[${o}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let o=t-3;o>=0;--o)s[o]=`(${s[o+1]} * ${r[o+1]})`;return s}function R5(i,e,t="index"){const r=i.map((o,l)=>l),s=_5(r,e);return s.map((o,l)=>{const c=`int ${i[l]} = ${t} / ${s[l]}`,h=l===s.length-1?`int ${i[l+1]} = ${t} - ${i[l]} * ${s[l]}`:`index -= ${i[l]} * ${s[l]}`;return`${c}; ${h};`}).join("")}function jw(i){const e=ze(i).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Yw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const AT=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{getBroadcastDims:vT}=tC;function B5(i,e,t){const r=[];if(i.forEach(v=>{const w=b(v.shapeInfo.logicalShape);if(v.shapeInfo.isUniform?r.push(`uniform float ${v.name}${w>1?`[${w}]`:""};`):(r.push(`uniform sampler2D ${v.name};`),r.push(`uniform int offset${v.name};`)),t.enableShapeUniforms){const{uniformShape:R}=Jw(t.packedInputs,v.shapeInfo.logicalShape,v.shapeInfo.texShape);switch(R.length){case 1:r.push(`uniform int ${v.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${v.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${v.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${v.name}Shape;`);break}r.push(`uniform ivec2 ${v.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(v=>{r.push(`uniform ${v.type} ${v.name}${v.arrayIndex?`[${v.arrayIndex}]`:""};`)});const s=r.join(`
`),o=i.map(v=>k5(v,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),l=e.texShape,c=sl(),h=N5(c);let p,f,g=O5(c);return e.isPacked?(p=L5(e.logicalShape,l,t.enableShapeUniforms),f=P5(c)):(p=D5(e.logicalShape,l,t.enableShapeUniforms),f=F5(c)),t.packedInputs&&(g+=z5),[g,h,f,s,p,o,t.userCode].join(`
`)}function lg(i,e=!1){const t=i.shapeInfo.logicalShape;switch(t.length){case 0:return eO(i,e);case 1:return nO(i,e);case 2:return rO(i,e);case 3:return aO(i,e);case 4:return lO(i,e);case 5:return cO(i);case 6:return uO(i);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function yT(i,e){switch(i.shapeInfo.logicalShape.length){case 0:return q5(i);case 1:return tO(i,e);case 2:return iO(i,e);case 3:return sO(i,e);default:return oO(i,e)}}function k5(i,e,t=!1,r){let s="";t?s+=yT(i,r):s+=lg(i,r);const o=i.shapeInfo.logicalShape,l=e.logicalShape;return o.length<=l.length&&(t?s+=hO(i,e):s+=dO(i,e)),s}function L5(i,e,t){switch(i.length){case 0:return bT();case 1:return W5(i,e,t);case 2:return Y5(i,e,t);case 3:return K5(i,e,t);default:return Q5(i,e,t)}}function D5(i,e,t){switch(i.length){case 0:return bT();case 1:return H5(i,e,t);case 2:return J5(i,e,t);case 3:return X5(i,e,t);case 4:return Z5(i,e,t);case 5:return $5(i,e);case 6:return j5(i,e);default:throw new Error(`${i.length}-D output sampling is not yet supported`)}}function N5(i){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${i.texture2D}(textureSampler, uv).r;
    }
  `}function F5(i){return`
    void setOutput(float val) {
      ${i.output} = vec4(val, 0, 0, 0);
    }
  `}function P5(i){return`
    void setOutput(vec4 val) {
      ${i.output} = val;
    }
  `}function O5(i){return`${i.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${i.varyingFs} vec2 resultUV;
    ${i.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${i.defineSpecialNaN}
    ${i.defineSpecialInf}
    ${i.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${G5}
    ${U5}
    ${V5}
  `}const G5=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,U5=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,V5=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,z5=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function bT(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function W5(i,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function H5(i,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function K5(i,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(i[2]/2),o=s*Math.ceil(i[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function X5(i,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ny(["r","c","d"],i)}
    return ivec3(r, c, d);
  }
`;const r=lf(["r","c","d"],i);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function Q5(i,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(i[i.length-1]/2),o=s*Math.ceil(i[i.length-2]/2);let l=o,c="",h="b, r, c";for(let p=2;p<i.length-1;p++)l*=i[i.length-p-1],c=`
      int b${p} = index / ${l};
      index -= b${p} * ${l};
    `+c,h=`b${p}, `+h;return`
    ivec${i.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${c}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${i.length}(${h});
    }
  `}function Z5(i,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ny(["r","c","d","d2"],i)}
      return ivec4(r, c, d, d2);
    }
  `;const r=lf(["r","c","d","d2"],i);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function $5(i,e){const t=lf(["r","c","d","d2","d3"],i);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function j5(i,e){const t=lf(["r","c","d","d2","d3","d4"],i);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Y5(i,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(S(i,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(i[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function J5(i,e,t){return S(i,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:i[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:i[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${i[1]};
      int c = index - r * ${i[1]};
      return ivec2(r, c);
    }
  `}function cf(i){return`offset${i}`}function q5(i){const e=i.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=sl();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function eO(i,e){const t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(i.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,o]=i.shapeInfo.texShape;if(s===1&&o===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const l=cf(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${l});
      return sampleTexture(${t}, uv);
    }
  `;const[c,h]=i.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${c}, ${h}, ${l});
      return sampleTexture(${t}, uv);
    }
  `}function tO(i,e){const t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=i.shapeInfo.texShape,o=sl();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${l[0]}, ${l[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function nO(i,e){const t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(i.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${cg(i)}
      }
    `;const s=i.shapeInfo.texShape,o=s[0],l=s[1];if(l===1&&o===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const c=cf(t);return l===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${c}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${c}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${c}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${c}) + 0.5) / ${l}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${c});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${o}, ${l}, index + ${c});
      return sampleTexture(${t}, uv);
    }
  `}function iO(i,e){const t=i.shapeInfo.logicalShape,r=i.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=i.shapeInfo.texShape,l=o[0],c=o[1],h=sl();if(o!=null&&S(t,o))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${h.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${c}.0, ${l}.0);

        return ${h.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${h.texture2D}(${r}, uv);
    }
  `;const p=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],f=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${f}, ${p[0]}, ${p[1]}, row, col);
      return ${h.texture2D}(${r}, uv);
    }
  `}function rO(i,e){const t=i.shapeInfo.logicalShape,r=i.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=i.shapeInfo.texShape;if(o!=null&&S(t,o)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const v=o[0],w=o[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${w}.0, ${v}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:l,keptDims:c}=Y(t),h=l;if(h.length<t.length){const v=ug(i,h),w=["row","col"];return`
      ${lg(v,e)}
      float ${s}(int row, int col) {
        return ${s}(${hg(w,c)});
      }
    `}if(i.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${cg(i)}
      }
    `;const p=o[0],f=o[1],g=cf(r);return f===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${g}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${g}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `:p===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${g}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${g}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${f}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${g};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${g};
    vec2 uv = uvFromFlat(${p}, ${f}, index);
    return sampleTexture(${r}, uv);
  }
`}function sO(i,e){const t=i.shapeInfo.logicalShape,r=i.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=i.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const v=t.slice(1),w=[1,2],R=ug(i,v),P=["b","row","col"];return`
        ${yT(R,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${hg(P,w)});
        }
      `}const c=sl();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `;const h=l[0],p=l[1],f=Math.ceil(t[2]/2),g=f*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${h}, ${p}, ${g}, ${f}, b, row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `}function aO(i,e){const t=i.shapeInfo.logicalShape,r=i.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[1]*t[2],l=t[2],{newShape:c,keptDims:h}=Y(t),p=c;if(p.length<t.length){const P=ug(i,p),z=["row","col","depth"];return`
        ${lg(P,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${hg(z,h)});
        }
      `}if(i.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${l}, 1)));
        ${cg(i)}
      }
    `;const f=i.shapeInfo.texShape,g=f[0],v=f[1],w=i.shapeInfo.flatOffset;if(v===o&&w==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${l}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${v}.0, ${g}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(v===l&&w==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${v}.0, ${g}.0);
      return sampleTexture(${r}, uv);
    }
  `;const R=cf(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${R};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${l} + depth + ${R};
        vec2 uv = uvFromFlat(${g}, ${v}, index);
        return sampleTexture(${r}, uv);
      }
  `}function oO(i,e){const t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=sl();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const o=i.shapeInfo.logicalShape,l=o.length,c=i.shapeInfo.texShape,h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],p=h[0],f=h[1],g=Math.ceil(o[l-1]/2);let v=g*Math.ceil(o[l-2]/2),w="int b, int row, int col",R=`b * ${v} + (row / 2) * ${g} + (col / 2)`;for(let P=2;P<l-1;P++)w=`int b${P}, `+w,v*=o[l-P-1],R=`b${P} * ${v} + `+R;return`
    vec4 ${r}(${w}) {
      int index = ${R};
      int texR = index / ${f};
      int texC = index - texR * ${f};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}, ${p});
      return ${s.texture2D}(${t}, uv);
    }
  `}function lO(i,e){const t=i.shapeInfo.logicalShape,r=i.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[3],l=t[2]*o,c=t[1]*l,{newShape:h,keptDims:p}=Y(t);if(h.length<t.length){const X=ug(i,h),fe=["row","col","depth","depth2"];return`
      ${lg(X,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${hg(fe,p)});
      }
    `}if(i.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${c}, ${l}, ${o}, 1)));
        ${cg(i)}
      }
    `;const f=i.shapeInfo.flatOffset,g=i.shapeInfo.texShape,v=g[0],w=g[1],R=`int stride2 = ${r}Shape[3];`,P=`int stride1 = ${r}Shape[2] * stride2;`,z=`int stride0 = ${r}Shape[1] * stride1;`;if(w===c&&f==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${R}
        ${P}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${l}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${w}.0, ${v}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(w===o&&f==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${w}.0, ${v}.0);
        return sampleTexture(${r}, uv);
      }
    `;const G=cf(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${R}
      ${P}
      ${z}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${G});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${v}, ${w}, index + ${G});
      return sampleTexture(${r}, uv);
    }
  `}function cO(i){const e=i.shapeInfo.logicalShape,t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],o=e[3]*s,l=e[2]*o,c=e[1]*l,{newShape:h,keptDims:p}=Y(e);if(h.length<e.length){const P=ug(i,h),z=["row","col","depth","depth2","depth3"];return`
      ${lg(P)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${hg(z,p)});
      }
    `}if(i.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${o}, ${s})) +
          depth3;
        ${cg(i)}
      }
    `;const f=i.shapeInfo.flatOffset,g=i.shapeInfo.texShape,v=g[0],w=g[1];if(w===c&&f==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${l}, ${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${w}.0, ${v}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(w===s&&f==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${w}.0, ${v}.0);
        return sampleTexture(${t}, uv);
      }
    `;const R=cf(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${o} +
          depth2 * ${s} + depth3 + ${R};
      vec2 uv = uvFromFlat(${v}, ${w}, index);
      return sampleTexture(${t}, uv);
    }
  `}function uO(i){const e=i.shapeInfo.logicalShape,t=i.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:o}=Y(e);if(s.length<e.length){const z=ug(i,s),G=["row","col","depth","depth2","depth3","depth4"];return`
      ${lg(z)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${hg(G,o)});
      }
    `}const l=e[5],c=e[4]*l,h=e[3]*c,p=e[2]*h,f=e[1]*p;if(i.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${f}, ${p}, ${h}, ${c})) +
          dot(
            vec2(depth3, depth4),
            vec2(${l}, 1)));
        ${cg(i)}
      }
    `;const g=i.shapeInfo.flatOffset,v=i.shapeInfo.texShape,w=v[0],R=v[1];if(R===f&&g==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${p}, ${h}, ${c}, ${l})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${R}.0, ${w}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(R===l&&g==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${R}.0, ${w}.0);
        return sampleTexture(${t}, uv);
      }
    `;const P=cf(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${f} + col * ${p} + depth * ${h} +
          depth2 * ${c} + depth3 * ${l} + depth4 + ${P};
      vec2 uv = uvFromFlat(${w}, ${R}, index);
      return sampleTexture(${t}, uv);
    }
  `}function cg(i){const e=i.name,t=b(i.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function hO(i,e){const t=i.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",o=i.shapeInfo.logicalShape.length,l=e.logicalShape.length,c=vT(i.shapeInfo.logicalShape,e.logicalShape),h=sa(l),p=l-o;let f;const g=["x","y","z","w","u","v"];o===0?f="":l<2&&c.length>=1?f="coords = 0;":f=c.map(z=>`coords.${g[z+p]} = 0;`).join(`
`);let v="";l<2&&o>0?v="coords":v=i.shapeInfo.logicalShape.map((z,G)=>`coords.${g[G+p]}`).join(", ");let w="return outputValue;";const R=b(i.shapeInfo.logicalShape)===1,P=b(e.logicalShape)===1;if(o===1&&!R&&!P)w=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(R&&!P)l===1?w=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:w=`
        return vec4(outputValue.x);
      `;else if(c.length){const z=o-2,G=o-1;c.indexOf(z)>-1&&c.indexOf(G)>-1?w="return vec4(outputValue.x);":c.indexOf(z)>-1?w="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(G)>-1&&(w="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${h} coords = getOutputCoords();
      ${f}
      vec4 outputValue = get${r}(${v});
      ${w}
    }
  `}function dO(i,e){const t=i.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",o=e.texShape,l=i.shapeInfo.texShape,c=i.shapeInfo.logicalShape.length,h=e.logicalShape.length;if(!i.shapeInfo.isUniform&&c===h&&i.shapeInfo.flatOffset==null&&S(l,o))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const p=sa(h),f=vT(i.shapeInfo.logicalShape,e.logicalShape),g=h-c;let v;const w=["x","y","z","w","u","v"];c===0?v="":h<2&&f.length>=1?v="coords = 0;":v=f.map(P=>`coords.${w[P+g]} = 0;`).join(`
`);let R="";return h<2&&c>0?R="coords":R=i.shapeInfo.logicalShape.map((P,z)=>`coords.${w[z+g]}`).join(", "),`
    float ${s}() {
      ${p} coords = getOutputCoords();
      ${v}
      return get${r}(${R});
    }
  `}function sa(i){if(i<=1)return"int";if(i===2)return"ivec2";if(i===3)return"ivec3";if(i===4)return"ivec4";if(i===5)return"ivec5";if(i===6)return"ivec6";throw Error(`GPU for rank ${i} is not yet supported`)}function Jw(i,e,t){const{newShape:r,keptDims:s}=Y(e),o=e.length,l=i&&o===3&&e[0]===1,c=l?e.slice(1):r,h=!i&&o>1&&!S(e,t)&&r.length<o||l;return{useSqueezeShape:h,uniformShape:h?c:e,keptDims:s}}function ug(i,e){const t=JSON.parse(JSON.stringify(i));return t.shapeInfo.logicalShape=e,t}function hg(i,e){return e.map(t=>i[t]).join(", ")}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pO(i,e,t,r){const s=t.map((f,g)=>{const v={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(v.flatOffset=f.texData.slice.flatOffset),{name:e.variableNames[g],shapeInfo:v}}),o=s.map(f=>f.shapeInfo),l={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=B5(s,l,e),h=a5(i.gl,c),p=i.createProgram(h);return Ye().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:h,source:c,webGLProgram:p,inShapeInfos:o,outShapeInfo:l,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:h,source:c,webGLProgram:p,inShapeInfos:o,outShapeInfo:l},xT(i,e,p))}function xT(i,e,t){const r={},s={},o={},l=[];let c,h,p,f=null,g=null;g=i.getUniformLocation(t,"NAN",!1),Ye().getNumber("WEBGL_VERSION")===1&&(f=i.getUniformLocation(t,"INFINITY",!1));const v=!1;for(let w=0;w<e.variableNames.length;w++){const R=e.variableNames[w];r[R]=i.getUniformLocation(t,R,v),r[`offset${R}`]=i.getUniformLocation(t,`offset${R}`,v),e.enableShapeUniforms&&(s[`${R}Shape`]=i.getUniformLocation(t,`${R}Shape`,v),o[`${R}TexShape`]=i.getUniformLocation(t,`${R}TexShape`,v))}return e.enableShapeUniforms&&(c=i.getUniformLocation(t,"outShape",v),p=i.getUniformLocation(t,"outShapeStrides",v),h=i.getUniformLocation(t,"outTexShape",v)),e.customUniforms&&e.customUniforms.forEach((w,R)=>{l[R]=i.getUniformLocation(t,w.name,v)}),{uniformLocations:r,customUniformLocations:l,infLoc:f,nanLoc:g,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:c,outShapeStridesLocation:p,outTexShapeLocation:h}}function CT(i,e){if(i.length!==e.length)throw Error(`Binary was compiled with ${i.length} inputs, but was executed with ${e.length} inputs`);i.forEach((t,r)=>{const s=t.logicalShape,o=e[r],l=o.shape;if(!S(s,l))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${l} must match`);if(t.isUniform&&o.isUniform)return;const c=t.texShape,h=o.isUniform?null:o.texData.texShape;if(!S(c,h))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${c} and ${h} must match`)})}function fO(i,e,t,r,s){e.program.enableShapeUniforms||(CT(e.inShapeInfos,t),CT([e.outShapeInfo],[r]));const o=r.texData.texture,l=r.texData.texShape;r.texData.isPacked?i.setOutputPackedMatrixTexture(o.texture,l[0],l[1]):i.setOutputMatrixTexture(o.texture,l[0],l[1]),i.setProgram(e.webGLProgram),Ye().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&i.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&i.gl.uniform1f(e.nanLoc,NaN),t.forEach((h,p)=>{const f=e.program.variableNames[p],g=e.uniformLocations[f],v=e.uniformLocations[`offset${f}`],w=e.inShapesLocations[`${f}Shape`],R=e.inTexShapesLocations[`${f}TexShape`];if(w){const{uniformShape:P}=Jw(e.program.packedInputs,h.shape,h.texData.texShape);switch(P.length){case 1:i.gl.uniform1iv(w,new Int32Array(P));break;case 2:i.gl.uniform2iv(w,new Int32Array(P));break;case 3:i.gl.uniform3iv(w,new Int32Array(P));break;case 4:i.gl.uniform4iv(w,new Int32Array(P));break}}if(R&&i.gl.uniform2i(R,h.texData.texShape[0],h.texData.texShape[1]),g!=null){if(h.isUniform){if(b(h.shape)<2)i.gl.uniform1f(g,h.uniformValues[0]);else{let P=h.uniformValues;P instanceof Float32Array||(P=new Float32Array(P)),i.gl.uniform1fv(g,P)}return}h.texData.slice!=null&&v!=null&&i.gl.uniform1i(v,h.texData.slice.flatOffset),i.setInputMatrixTexture(h.texData.texture.texture,g,p)}});const c=e.outShapeLocation;if(c)switch(r.shape.length){case 1:i.gl.uniform1iv(c,new Int32Array(r.shape));break;case 2:i.gl.uniform2iv(c,new Int32Array(r.shape));break;case 3:i.gl.uniform3iv(c,new Int32Array(r.shape));break;case 4:i.gl.uniform4iv(c,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const h=ze(r.shape);switch(r.shape.length){case 2:i.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(h));break;case 3:i.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(h));break;case 4:i.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(h));break}}e.outTexShapeLocation&&i.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s&&e.program.customUniforms.forEach((h,p)=>{const f=e.customUniformLocations[p],g=s[p];if(h.type==="float")i.gl.uniform1fv(f,g);else if(h.type==="vec2")i.gl.uniform2fv(f,g);else if(h.type==="vec3")i.gl.uniform3fv(f,g);else if(h.type==="vec4")i.gl.uniform4fv(f,g);else if(h.type==="int")i.gl.uniform1iv(f,g);else if(h.type==="ivec2")i.gl.uniform2iv(f,g);else if(h.type==="ivec3")i.gl.uniform3iv(f,g);else if(h.type==="ivec4")i.gl.uniform4iv(f,g);else throw Error(`uniform type ${h.type} is not supported yet.`)}),i.executeProgram()}function mO(i,e,t){let r="";e.concat(t).forEach(l=>{const c=l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0;if(i.enableShapeUniforms&&!l.isUniform){const h=l.texData.texShape,{useSqueezeShape:p,uniformShape:f,keptDims:g}=Jw(i.packedInputs,l.shape,h);let v="",w="",R="";if(f.length===1&&i.packedInputs){const be=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)];v=`${be[0]>1}_${be[1]>1}`}else if(f.length===2&&!i.packedInputs)w=`${f[0]>1}_${f[1]>1}`;else if(f.length>2&&!i.packedInputs){const be=ze(f);R=`${be[0]===h[1]}_${be[be.length-1]===h[1]}`}const P=l.shape.length,z=f.length===2&&S(l.shape,h),G=b(l.shape)===1,X=ku(l.shape,t.shape),fe=!i.packedInputs&&P===t.shape.length&&S(h,t.texData.texShape),ge=i.packedInputs||f.length>2?"":`${h[0]>1}_${h[1]>1}`;r+=`${P}_${fe}_${p?g:""}_${f.length}_${G}_${X}_${z}_${v}_${w}_${R}_${ge}_${c}`}else{const h=l.isUniform?"uniform":l.texData.texShape;r+=`${l.shape}_${h}_${c}`}});const s=i.userCode;let o=i.constructor.name;return o+="_"+r+"_"+s+`${Ye().getNumber("WEBGL_VERSION")}`,o}function al(i){return Ye().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&i<=4}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gO{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=_A.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=sl();this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ny(["r","c","d"],e):lf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AO{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=_A.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=sl();this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ny(["r","c","d"],e):lf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vO{constructor(e){this.variableNames=["A"],this.outTexUsage=hc.DOWNLOAD;const t=sl();this.outputShape=e,this.userCode=`
      ${AT}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class yO{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=hc.DOWNLOAD;const t=sl();this.outputShape=e,this.userCode=`
      ${AT}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bO{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=sl();this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length);let s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?Yw():jw(e)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${r.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${r.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class xO{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=sl();this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length);let s="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){const h=l*2+c;s+=`
          localCoords = coords;
          if(localCoords[2] + ${c} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${c};
          if (localCoords[1] + ${l} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${l};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${h}] = values[0];
            } else if (offset == 1) {
              result[${h}] = values[1];
            } else if (offset == 2) {
              result[${h}] = values[2];
            } else {
              result[${h}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Yw():jw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${o};
        }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CO(i){const e=sl(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return s5(i,t)}function wO(i){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return u5(i,e)}function EO(i){const e=new Uint16Array([0,1,2,2,1,3]);return h5(i,e)}function kA(i,e,t,r,s,o){p5(e,t);const l=d5(i),c=i.TEXTURE_2D;return Pi(i,()=>i.bindTexture(c,l)),Pi(i,()=>i.texParameteri(c,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE)),Pi(i,()=>i.texParameteri(c,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),Pi(i,()=>i.texParameteri(c,i.TEXTURE_MIN_FILTER,i.NEAREST)),Pi(i,()=>i.texParameteri(c,i.TEXTURE_MAG_FILTER,i.NEAREST)),Ye().getNumber("WEBGL_VERSION")===1?Pi(i,()=>i.texImage2D(c,0,r,e,t,0,s,o,null)):Pi(i,()=>i.texStorage2D(c,1,r,e,t)),Pi(i,()=>i.bindTexture(i.TEXTURE_2D,null)),{texture:l,texShape:[t,e]}}function wT(i){return i.internalFormatFloat}function IO(i,e,t,r){const[s,o]=RA(e,t);return kA(i,s,o,wT(r),r.textureFormatFloat,i.FLOAT)}function ET(i){return i.internalFormatHalfFloat}function SO(i,e,t,r){const[s,o]=RA(e,t);return kA(i,s,o,ET(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function IT(i){return i.downloadTextureFormat}function TO(i,e,t,r){const[s,o]=RA(e,t);return kA(i,s,o,IT(r),i.RGBA,i.UNSIGNED_BYTE)}function ST(i){return i.internalFormatPackedFloat}function MO(i,e,t,r){const[s,o]=sg(e,t);return kA(i,s,o,ST(r),i.RGBA,i.FLOAT)}function TT(i){return i.internalFormatPackedHalfFloat}function _O(i,e,t,r){const[s,o]=sg(e,t);return kA(i,s,o,TT(r),i.RGBA,r.textureTypeHalfFloat)}function RO(i,e,t){return Pi(i,()=>i.bindBuffer(i.ARRAY_BUFFER,t)),fT(i,e,"clipSpacePos",t,3,20,0)&&fT(i,e,"uv",t,2,20,12)}function BO(i,e,t,r,s,o){Pi(i,()=>i.bindTexture(i.TEXTURE_2D,e));let l,c,h;s instanceof Uint8Array?(l=new Uint8Array(t*r*4),c=i.UNSIGNED_BYTE,h=i.RGBA):(l=new Float32Array(t*r*4),c=i.FLOAT,h=o.internalFormatPackedFloat),l.set(s),Ye().getNumber("WEBGL_VERSION")===2?Pi(i,()=>i.texSubImage2D(i.TEXTURE_2D,0,0,0,t,r,i.RGBA,c,l)):Pi(i,()=>i.texImage2D(i.TEXTURE_2D,0,h,t,r,0,i.RGBA,c,l)),Pi(i,()=>i.bindTexture(i.TEXTURE_2D,null))}function kO(i,e,t){Pi(i,()=>i.bindTexture(i.TEXTURE_2D,e)),t.data instanceof Uint8Array?Ye().getNumber("WEBGL_VERSION")===2?Pi(i,()=>i.texSubImage2D(i.TEXTURE_2D,0,0,0,t.width,t.height,i.RGBA,i.UNSIGNED_BYTE,t.data)):Pi(i,()=>i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,t.data)):Ye().getNumber("WEBGL_VERSION")===2?Pi(i,()=>i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,t)):Pi(i,()=>i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)),Pi(i,()=>i.bindTexture(i.TEXTURE_2D,null))}function LO(i,e,t,r){const s=i.createBuffer();Pi(i,()=>i.bindBuffer(i.PIXEL_PACK_BUFFER,s));const o=4*4*e*t;return Pi(i,()=>i.bufferData(i.PIXEL_PACK_BUFFER,o,i.STREAM_READ)),Pi(i,()=>i.readPixels(0,0,t,e,i.RGBA,i.FLOAT,0)),Pi(i,()=>i.bindBuffer(i.PIXEL_PACK_BUFFER,null)),s}function DO(i,e,t){const r=i,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function NO(i,e,t,r){const[s,o]=RA(e,t),l=4,c=new Uint8Array(JP(e*t,l));return Pi(i,()=>i.readPixels(0,0,s,o,r.downloadTextureFormat,i.UNSIGNED_BYTE,c)),new Float32Array(c.buffer)}function FO(i,e,t,r,s,o,l,c){const h=i,p=new Float32Array(qP(o,l));return h.bindBuffer(h.PIXEL_PACK_BUFFER,e),h.getBufferSubData(h.PIXEL_PACK_BUFFER,0,p),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),p}function PO(i,e,t){const r=new Float32Array(e*t*4);return Pi(i,()=>i.readPixels(0,0,t,e,i.RGBA,i.FLOAT,r)),r}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class qw{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=Ye().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,$P(t,e)):this.gl=Au(t);let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Ye().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",l="OES_texture_half_float";if(this.textureFloatExtension=By(this.gl,o),Lc(this.gl,l))this.textureHalfFloatExtension=By(this.gl,l);else if(Ye().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Lc(this.gl,s))this.colorBufferHalfFloatExtension=By(this.gl,s);else if(Ye().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Lc(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Lc(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=wO(this.gl),this.indexBuffer=EO(this.gl),this.framebuffer=f5(this.gl),this.textureConfig=Ww(this.gl,this.textureHalfFloatExtension)}get debug(){return Ye().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Pi(e,()=>e.finish()),Pi(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Pi(e,()=>e.deleteFramebuffer(this.framebuffer)),Pi(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Pi(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Pi(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),IO(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),SO(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),TO(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),kO(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),BO(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),_O(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),MO(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(mT(this.gl,this.framebuffer),this.outputTexture=null),Pi(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>NO(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,o,l){return FO(this.gl,e,t,r,s,o,l,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return DO(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=LO(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(Ye().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const l=s.clientWaitSync(o,0,0);return l===s.ALREADY_SIGNALED||l===s.CONDITION_SATISFIED},t=o}else Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>PO(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=CO(t));const r=l5(t);return Pi(t,()=>t.attachShader(r,this.vertexShader)),Pi(t,()=>t.attachShader(r,e)),c5(t,r),this.debug&&Hw(t,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=RO(t,this.program,this.vertexBuffer)),r}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Pi(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Hw(this.gl,this.program),Pi(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?g5(this.gl,e,t):A5(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Pi(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),v5(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,o]=sg(t,r);this.setOutputMatrixTextureDriver(e,s,o)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Hw(this.gl,this.program),ky(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),Pi(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Pi(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=By(this.gl,Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await D(()=>this.disposed||this.isQueryAvailable(e,Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=OO(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in Ye().platform&&(r=Ye().platform.setTimeoutCustom.bind(Ye().platform)),D(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Kw(this.gl,e,this.framebuffer),this.debug&&ky(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Kw(this.gl,this.outputTexture,this.framebuffer),this.debug&&ky(this.gl)):mT(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;Kw(s,e,this.framebuffer),this.debug&&ky(s),this.outputTexture=e,Pi(s,()=>s.viewport(0,0,t,r)),Pi(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Pi(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function OO(i){let e=0;for(;e<i.length&&i[e]();++e);return e-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GO(i){const e=new Float32Array(i.length);for(let t=0;t<i.length;++t)e[t]=Math.abs(i[t]);return e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dc(i){return(e,t,r,s,o)=>{const l=Ir(e,t),c=l.length,h=ze(l),p=b(l),f=W(o,p),g=e.length,v=t.length,w=ze(e),R=ze(t),P=ku(e,l),z=ku(t,l);if(P.length+z.length===0)for(let G=0;G<f.length;++G)f[G]=i(r[G%r.length],s[G%s.length]);else for(let G=0;G<f.length;++G){const X=Wn(G,c,h),fe=X.slice(-g);P.forEach(Je=>fe[Je]=0);const ge=yn(fe,g,w),be=X.slice(-v);z.forEach(Je=>be[Je]=0);const He=yn(be,v,R);f[G]=i(r[ge],s[He])}return[f,l]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UO(i,e,t,r){if(r==="int32"){const s=Int32Array.from(i);return[e,"int32",s]}if(r==="bool"){const s=nc([0],t),[o,l]=dc((c,h)=>c!==h?1:0)(e,[],i,s,"bool");return[l,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VO=dc((i,e)=>i+e);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zO(i,e,t,r,s){const o=b(r),l=fn(s,t);for(let c=0;c<i.length;c++){const h=i[c];if(h<0)throw new Error("Input x must be non-negative!");h>=s||(o>0?l[h]+=e[c]:l[h]+=1)}return l}function WO(i,e,t,r=!1){const s=i.shape[0],o=i.shape[1],l=dr([s,t],e.dtype);for(let c=0;c<s;c++)for(let h=0;h<o;h++){const p=i.get(c,h);if(p<0)throw new Error("Input x must be non-negative!");p>=t||(r?l.set(1,c,p):e.size>0?l.set(l.get(c,p)+e.get(c,h),c,p):l.set(l.get(c,p)+1,c,p))}return l}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ep(i){return(e,t,r)=>{const s=W(t,e.length);for(let o=0;o<e.length;++o)s[o]=i(e[o],r);return s}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HO=ep(i=>Math.ceil(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KO(i,e,t,r){const s=U(t,b(e));if(r&&t!=="string"){let o=0;i.forEach(l=>{const c=b(l.shape);s.set(l.vals,o),o+=c})}else{let o=0;i.forEach(l=>{const c=t==="string"?Rc(l.vals):l.vals;let h=0;for(let p=0;p<l.shape[0];++p){const f=p*e[1]+o;for(let g=0;g<l.shape[1];++g)s[f+g]=c[h++]}o+=l.shape[1]})}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XO=dc((i,e)=>i===e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QO=ep(i=>Math.exp(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZO=ep(i=>Math.expm1(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $O=ep(i=>Math.floor(i));/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jO(i,e,t,r,s,o,l,c,h){const p=dr([r,o],t);for(let f=0;f<r;f++){const g=[];let v=0;for(let w=0;w<s;w++){const R=i[f*s+w];v+=R*l[w],g.push(R)}if(v<0||v>=h/o)throw new Error(`Invalid indices: ${g} does not index into ${c}`);for(let w=0;w<o;w++)p.values[f*o+w]=e.get(...e.indexToLoc(v*o+w))}return p}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YO(i,e,t){const r=dr(t,i.dtype);for(let s=0;s<r.size;++s){const o=r.indexToLoc(s).slice(),l=o[0],c=o[2],h=e.locToIndex([l,c]);o[2]=e.values[h];const p=i.locToIndex(o);0<=p&&p<i.values.length&&(r.values[s]=i.values[p])}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JO=dc((i,e)=>i>e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qO=dc((i,e)=>i>=e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eG=dc((i,e)=>i<e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tG=dc((i,e)=>i<=e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nG(i,e,t){const r=(e-i)/(t-1),s=fn(t,"float32");s[0]=i;for(let o=1;o<s.length;o++)s[o]=s[o-1]+r;return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iG=ep(i=>Math.log(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rG(i,e,t,r){const s=W(r,b(t));for(let o=0;o<s.length;++o){const l=o*e;let c=i[l];for(let h=0;h<e;++h){const p=i[l+h];(Number.isNaN(p)||p>c)&&(c=p)}s[o]=c}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sG=dc((i,e)=>Math.max(i,e));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aG=dc((i,e)=>Math.min(i,e));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MT=dc((i,e)=>i*e);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oG(i,e,t){const r=Ya(-1,t);return MT([],e,r,i,t)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lG=dc((i,e)=>i!==e?1:0);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cG(i,e,t,r,s){const o=e.length,l=b(e),c=ze(e),h=ze(s),p=W(t,b(s));for(let f=0;f<l;++f){const g=Wn(f,o,c),v=new Array(g.length);for(let R=0;R<v.length;R++)v[R]=g[r[R]];const w=yn(v,o,h);p[w]=i[f]}return p}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uG(i,e,t,r){const[s,o]=Xa(i,r),l=Uo(e,"int32"),c=fn(b(s),l),h=b(o);for(let p=0;p<c.length;++p){const f=p*h;let g=1;for(let v=0;v<h;++v)g*=t[f+v];c[p]=g}return{outVals:c,outShape:s,outDtype:l}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hG(i,e,t){i.forEach((r,s)=>{if(r<0||r>=t){const o=Wn(s,e.length,ze(e)).join(",");throw new Error(`indices[${o}] = ${r} is not in [0, ${t})`)}})}function dG(i,e){for(let t=0;t<i.length;++t){const r=i[t],s=t===i.length-1?e:i[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let o=1;o<r.length;++o)if(r[o-1]>r[o])throw new Error("Ragged splits must be sorted in ascending order")}}function pG(i,e,t,r){const s=[];let o=0;const l=e.length-1+t.length,c=new Array(l).fill(null).map(()=>[0]);dG(t,r);let h=1;for(let p=0;p<e.length-1;++p){h*=e[p];const f=e[p+1];for(let g=1;g<h+1;++g)c[p].push(g*f)}for(let p=0;p<i.length;++p){let f=i[p],g=i[p]+1;for(let v=0;v<t.length;++v){const w=t[v],R=v+e.length-1;if(R>=0){const P=c[R],z=P[P.length-1]-w[f];for(let G=f;G<g;++G)c[R].push(w[G+1]+z)}f=w[f],g=w[g]}g!==f&&(s.push([f,g]),o+=g-f)}return{outSplits:c,valueSlices:s,numValues:o}}function fG(i){const e=[];for(let t=0;t<i.length;++t){const r=i[t].length,s=U("int32",r);e.push(s),i[t].forEach((o,l)=>s[l]=o)}return e}function _T(i,e){const t=i.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<i.length;r++)t[e-1]*=i[r];return t}function mG(i,e,t,r,s,o){const l=_T(e,2)[1],c=_T(o,2)[1];let h=0;for(const p of t)for(let f=p[0];f<p[1];++f){for(let g=0;g<r;++g)s[h*c+g]=i[f*l+g];++h}}function gG(i,e,t,r,s){const o=e.slice();o[0]=s;const l=U(t,b(o)),c=i.length,h=c===0?0:c/e[0];return mG(i,e,r,h,l,o),[l,o]}function AG(i,e,t,r,s,o,l,c){if(i.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const h=e[0][0]-1;if(hG(o,l,h),r.length===0)throw new Error("params.rank must be nonzero");const p=r[0],{outSplits:f,valueSlices:g,numValues:v}=pG(o,l,i,p),w=fG(f),R=gG(t,r,s,g,v);return[w,R[0],R[1]]}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Dc=Wl;class Fy{constructor(e,t,r,s,o,l,c,h,p,f){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=o,this.defaultValue=l,this.defaultValueShape=c,this.rowPartitionValues=h,this.rowPartitionValuesShapes=p,this.rowPartitionTypes=K0(f),this.raggedRank=X0(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Dc.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Dc.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Dc.VALUE_ROWIDS:return Fy.getMaxWidthValueRowID(t);case Dc.ROW_SPLITS:return Fy.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Dc[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const o=e[s+1]-e[s];o>r&&(r=o)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],o=0;for(let l=1;l<t;++l){const c=e[l];c!==s&&(s=c,o=Math.max(l-r,o),r=l)}return Math.max(t-r,o)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return BT(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;Q0(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Kh(this.raggedRank,s,t);o[0]<0&&(o[0]=e);for(let l=1;l<=this.raggedRank;++l)o[l]<0&&(o[l]=this.getMaxWidth(l));return o}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),o=[];let l=0;for(let c=0;c<s;++c,l+=t)o.push(l);for(let c=s;c<e;++c)o.push(-1);return C(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,r,s){const o=e.length,l=[];for(let c=0;c<o-1;++c){const h=e[c+1]-e[c];let p=Math.min(s,h),f=t[c];f===-1&&(p=0);for(let g=0;g<p;++g)l.push(f),f+=r;for(let g=0;g<h-p;++g)l.push(-1)}if(o>0&&l.length!==e[o-1])throw new Error("Invalid row split size.");return l}calculateOutputIndexValueRowID(e,t,r,s){const o=e.length,l=[];if(o===0)return[];let c=0,h=e[0];if(h>=t.length)throw new Error(`Got currentValueRowId=${h}, which is not less than ${t.length}`);let p=t[h];l.push(p);for(let f=1;f<o;++f){const g=e[f];if(g===h)p>=0&&(++c,c<s?p+=r:p=-1);else{if(c=0,h=g,g>=t.length)throw new Error(`Got nextValueRowId=${g} which is not less than ${t.length}`);p=t[g]}l.push(p)}if(l.length!==e.length)throw new Error("Invalid row ids.");return l}calculateOutputIndex(e,t,r,s){const o=this.getRowPartitionTensor(e),l=this.getRowPartitionTypeByDimension(e);switch(l){case Dc.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,r,s);case Dc.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,r,s);default:throw new Error(`Unsupported partition type: ${Dc[l]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Dc.FIRST_DIM_SIZE:return e[0];case Dc.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Dc.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Dc[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*t[l+1];const s=BT(t,!1),o=U(this.valuesDType,b(s));if(r[0]*t[0]>0){let l=this.calculateFirstParentOutputIndex(e,r[0],t[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],t[c]);this.setOutput(this.raggedRank,l,o,s)}return[s,o]}setOutput(e,t,r,s){if(r.length===0)return;const o=this.values,l=r;let c=s.slice();c=c.slice(e+1);const h=b(c),p=t.length;let f=this.defaultValue;if(f.length!==h&&f.length!==1){const R=this.defaultValueShape;Pt(()=>{const P=kt(f,R);f=kh(P,c).dataSync()})}let g=0,v=0,w=0;for(let R=0;R<=p;++R){let P=R<p?t[R]:-1;if(P===w){++w;continue}if(v<w){const z=o.subarray(g*h),G=l.subarray(v*h),X=(w-v)*h;RT(G,z,X)}if(R>=p){const z=r.length;P=Math.floor(z/h)}if(P>w)if(this.defaultValue.length===1)l.subarray(w*h,P*h).fill(this.defaultValue[0]),w=P;else for(;P>w;){const z=l.slice(w*h);RT(z,f,h),++w}P<0?(g=R+1,v=w):(g=R,v=w,w=v+1)}}}function RT(i,e,t){for(let r=0;r<t;r++)i[r]=e[r]}function BT(i,e){const t=[];for(let r of i){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function vG(i,e,t,r,s,o,l,c,h,p){return new Fy(i,e,t,r,s,o,l,c,h,p).compute()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yG(i,e,t,r){const s=i===e,o=i<e&&t<0,l=e<i&&t>1;if(s||o||l)return fn(0,r);const c=Math.abs(Math.ceil((e-i)/t)),h=fn(c,r);e<i&&t===1&&(t=-1),h[0]=i;for(let p=1;p<h.length;p++)h[p]=h[p-1]+t;return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bG=ep(i=>1/Math.sqrt(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xG(i,e,t,r,s,o,l,c,h,p){const f=[r/s,s],g=i.values,v=e.values;if(r===0)return dr(t,e.dtype);const w=dr(f,e.dtype);typeof h=="string"||typeof h=="number"?w.values.fill(h):typeof h=="boolean"&&w.values.fill(+h);for(let R=0;R<o;R++){const P=[];let z=0;for(let G=0;G<l;G++){const X=g[R*l+G];P.push(X),z+=X*c[G]}if(z<0||z>=r/s)throw new Error(`Invalid indices: ${P} does not index into ${t}`);for(let G=0;G<s;G++)p?w.values[z*s+G]+=v[R*s+G]:w.values[z*s+G]=e.rank===0?v[0]:v[R*s+G]}return w}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CG=ep(i=>1/(1+Math.exp(-i)));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wG(i,e,t,r,s){const o=Uf(r,e,t),l=b(t),c=ze(r);if(o){const g=Vf(e,c);return s==="string"?i.slice(g,g+l):i.subarray(g,g+l)}const h=s==="string"?Rc(i):i,p=dr(r,s,h),f=dr(t,s);for(let g=0;g<f.size;++g){const v=f.indexToLoc(g),w=v.map((R,P)=>R+e[P]);f.set(p.get(...w),...v)}return s==="string"?Jp(f.values):f.values}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EG(i,e,t,r,s,o,l){const c=e[0],h=o[0],p=new Array(h),f=new Array(c),g=e[1];if(h===0){if(c!==0)throw new Error(ou(c));const z=U(t,0),G=U(s,0);return[z,[0,g],G,p,f]}let v=!0,w=0;const R=new Array(h).fill(0);for(let z=0;z<c;++z){const G=i[z*g];if(G<0)throw new Error(sA(z,G));if(G>=h)throw new Error(Pm(z,G,h));++R[G],v=v&&G>=w,w=G}let P=!0;for(let z=0;z<h;++z){const G=R[z]===0;p[z]=G,P=P&&!G,R[z]=Math.max(R[z],1),z>0&&(R[z]+=R[z-1])}if(P&&v){const z=i,G=r;for(let X=0;X<c;++X)f[X]=X;return[z,[c,g],G,p,f]}else{const z=R[h-1],G=U(t,z*g),X=U(s,z),fe=new Array(h).fill(0);for(let ge=0;ge<c;++ge){const be=i[ge*g],He=fe[be],Je=(be===0?0:R[be-1])+He;fe[be]++;for(let $e=0;$e<g;++$e)G[Je*g+$e]=i[ge*g+$e];X[Je]=r[ge],f[ge]=Je}for(let ge=0;ge<h;++ge)if(fe[ge]===0){const be=ge===0?0:R[ge-1];G[be*g+0]=ge;for(let He=1;He<g;++He)G[be*g+He]=0;X[be]=l}return[G,[z,g],X,p,f]}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IG(i,e,t,r,s){const o=b(r),l=e[0],c=s.length,h=[];let p=1,f=-1;for(let P=0;P<c;++P){const z=s[P];if(z===-1){if(f!==-1)throw new Error(Om(f,P));f=P,h.push(1)}else{if(z<0)throw new Error(lu(P,z));p*=z,h.push(z)}}if(f!==-1){if(p<=0)throw new Error(Gm());const P=Math.trunc(o/p);if(p*P!==o)throw new Error(aA(r,h));h[f]=P}if(b(h)!==o)throw new Error(cu(r,h));const g=r.length,v=[];if(g>0){v[g-1]=1;for(let P=g-2;P>=0;--P)v[P]=v[P+1]*r[P+1]}const w=[];if(c>0){w[c-1]=1;for(let P=c-2;P>=0;--P)w[P]=w[P+1]*h[P+1]}const R=U(t,l*c);for(let P=0;P<l;++P){let z=0;for(let G=0;G<g;++G)z+=i[P*g+G]*v[G];for(let G=0;G<c;++G)R[P*c+G]=Math.trunc(z/w[G]),z%=w[G]}return[R,[l,c],h]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SG(i,e,t,r,s,o=!1,l=0){const c=r.length,h=[e[0],i.length/e[0]],p=h[1],f=c>0?s[c-1]+1:0;if(f<0)throw new Error(Yp());const g=e.slice();g[0]=f;const v=g.reduce((X,fe)=>X*fe,1),w=U(t,v);if(c===0)return f>0&&w.fill(l),[w,g];if(f<=0)throw new Error(Yp());let R=0,P=1,z=0,G=s[R];for(;;){let X=0;if(P<c){if(X=s[P],G===X){++P;continue}if(G>=X)throw new Error(Um())}if(G<0||G>=f)throw new Error(uu(G,f));G>z&&w.fill(l,z*p,G*p);for(let fe=R;fe<P;++fe){const ge=r[fe];if(ge<0||ge>=h[0])throw new Error(Vm(fe,r[fe],h[0]));for(let be=0;be<p;be++)w[G*p+be]+=i[ge*p+be]}if(o)for(let fe=0;fe<p;fe++)w[G*p+fe]/=P-R;if(R=P,++P,z=G+1,G=X,P>c)break}return z<f&&w.fill(l,z*p,f*p),[w,g]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TG=ep(i=>Math.sqrt(i));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MG=dc((i,e)=>{const t=i-e;return t*t});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _G(i,e,t,r){const s=dr(i,e.dtype);for(let o=0;o<s.size;o++){const l=s.indexToLoc(o),c=new Array(l.length);for(let h=0;h<c.length;h++)c[h]=l[h]*t[h]+r[h];s.set(e.get(...c),...l)}return s}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class RG{constructor(e,t,r,s,o,l){this.separator=Go(e),this.nGramWidths=t,this.leftPad=Go(r),this.rightPad=Go(s),this.padWidth=o,this.preserveShort=l}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,o,l){for(let c=0;c<o;++c){const h=this.getPadWidth(l),p=Math.max(0,h-c),f=Math.max(0,h-(o-(c+1))),g=l-(p+f),v=t+(p>0?0:c-h);let w=0;w+=p*this.leftPad.length;for(let X=0;X<g;++X)w+=e[v+X].length;w+=f*this.rightPad.length;const R=p+f+g-1;w+=R*this.separator.length,r[s+c]=new Uint8Array(w);const P=r[s+c];let z=0;const G=X=>X.forEach(fe=>P[z++]=fe);for(let X=0;X<p;++X)G(this.leftPad),G(this.separator);for(let X=0;X<g-1;++X)G(e[v+X]),G(this.separator);if(g>0){G(e[v+g-1]);for(let X=0;X<f;++X)G(this.separator),G(this.rightPad)}else{for(let X=0;X<f-1;++X)G(this.rightPad),G(this.separator);G(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let h=t[0];if(h!==0)throw new Error(`First split value must be 0, got ${h}`);for(let p=1;p<s;++p){let f=t[p]>=h;if(f=f&&t[p]<=r,!f)throw new Error(`Invalid split value ${t[p]}, must be in [${h}, ${r}]`);h=t[p]}if(h!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${h}`)}const o=s-1,l=U("int32",s);if(r===0||s===0){const h=new Array(r);for(let p=0;p<=o;++p)l[p]=0;return[h,l]}l[0]=0;for(let h=1;h<=o;++h){const p=t[h]-t[h-1];let f=0;this.nGramWidths.forEach(g=>{f+=this.getNumNGrams(p,g)}),this.preserveShort&&p>0&&f===0&&(f=1),l[h]=l[h-1]+f}const c=new Array(l[o]);for(let h=0;h<o;++h){const p=t[h];let f=l[h];if(this.nGramWidths.forEach(g=>{const v=t[h+1]-t[h],w=this.getNumNGrams(v,g);this.createNGrams(e,p,c,f,w,g),f+=w}),this.preserveShort&&f===l[h]){const g=t[h+1]-t[h];if(g===0)continue;const v=g+2*this.padWidth,w=1;this.createNGrams(e,p,c,f,w,v)}}return[c,l]}}function BG(i,e,t,r,s,o,l,c){return new RG(t,r,s,o,l,c).compute(i,e)}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kG(i,e,t,r){if(!i.length)return;if(e.length===0){for(let o=0;o<i.length;++o)r.push(i.subarray(o,o+1));return}if(e.length===1){const o=e[0];let l=i.indexOf(o);for(;l!==-1;){const c=i.subarray(0,l);(!t||c.length!==0)&&r.push(c),i=i.subarray(l+1),l=i.indexOf(o)}(!t||i.length!==0)&&r.push(i);return}let s=0;for(let o=0;o<i.length+1;o++)if(o===i.length||e.indexOf(i[o])!==-1){const l=i.subarray(s,o);(!t||l.length!==0)&&r.push(l),s=o+1}}function LG(i,e,t){const r=i.length,s=[];let o=0,l=0;const c=new Array(r);for(let v=0;v<r;++v){const w=s.length;kG(i[v],e,t,s);const R=s.length-w;c[v]=R,o+=R,l=Math.max(l,R)}const h=U("int32",o*2),p=new Array(o),f=[r,l];let g=0;for(let v=0;v<r;++v)for(let w=0;w<c[v];++w)h[g*2]=v,h[g*2+1]=w,p[g]=s[g],++g;return[h,p,f]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DG(i,e){const t=U("int32",i.length);for(let r=0;r<i.length;++r)t[r]=xa(i[r]).modulo(e).getLowBitsUnsigned();return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NG=dc((i,e)=>i-e);/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FG(i,e){const t=new Array(i.rank);for(let s=0;s<t.length;s++)t[s]=i.shape[s]*e[s];const r=dr(t,i.dtype);for(let s=0;s<r.values.length;++s){const o=r.indexToLoc(s),l=new Array(i.rank);for(let h=0;h<l.length;h++)l[h]=o[h]%i.shape[h];const c=i.locToIndex(l);r.values[s]=i.values[c]}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LA=(i,e)=>{const t=e.value-i.value;return t===0?i.index-e.index:t};function kT(i,e,t=0,r=i.length-1){for(;r>t;){if(r-t>600){const c=r-t+1,h=e-t+1,p=Math.log(c),f=.5*Math.exp(2*p/3),g=.5*Math.sqrt(p*f*(c-f)/c)*Math.sign(h-c/2),v=Math.max(t,Math.floor(e-h*f/c+g)),w=Math.min(r,Math.floor(e+(c-h)*f/c+g));kT(i,e,v,w)}const s=i[e];let o=t,l=r;for(B(i,t,e),LA(i[r],s)>0&&B(i,t,r);o<l;){for(B(i,o,l),o++,l--;LA(i[o],s)<0;)o=o+1;for(;LA(i[l],s)>0;)l=l-1}LA(i[t],s)===0?B(i,t,l):(l=l+1,B(i,l,r)),l<=e&&(t=l+1),e<=l&&(r=l-1)}}function PG(i,e,t,r,s){const o=e[e.length-1],[l,c]=[i.length/o,o],h=W(t,l*r),p=W("int32",l*r);for(let g=0;g<l;g++){const v=g*c,w=i.subarray(v,v+c);let R=new Array(w.length);w.forEach((X,fe)=>R[fe]={value:X,index:fe}),r<R.length&&(kT(R,r),R=R.slice(0,r)),s&&R.sort(LA);const P=g*r,z=h.subarray(P,P+r),G=p.subarray(P,P+r);for(let X=0;X<r;X++)z[X]=R[X].value,G[X]=R[X].index}const f=e.slice();return f[f.length-1]=r,[dr(f,t,h),dr(f,"int32",p)]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OG(i,e,t,r){const s=J(e,t)[0],o=[1,t[0],1];for(let R=0;R<s;R++)o[0]*=t[R];o[1]=t[s];for(let R=s+1;R<t.length;R++)o[2]*=t[R];const l={},c=new Int32Array(t[s]),h=new Ss(o,r,i),p=[],f=o[0]===1&&o[2]===1;for(let R=0;R<t[s];R++){let P;if(f)P=i[R].toString();else{const z=[];for(let G=0;G<o[0];G++)for(let X=0;X<o[2];X++)z.push(h.get(G,R,X));P=z.join(",")}if(l[P]!==void 0)c[R]=l[P];else{const z=Object.keys(l).length;l[P]=z,c[R]=z,p.push(R)}}const g=o.slice();g[1]=Object.keys(l).length;const v=new Ss(g,r);p.forEach((R,P)=>{for(let z=0;z<o[0];z++)for(let G=0;G<o[2];G++)v.set(h.get(z,R,G),z,P,G)});const w=t.slice();return w[s]=g[1],{outputValues:v.values,outputShape:w,indices:c}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GG=Object.freeze(Object.defineProperty({__proto__:null,addImpl:VO,bincountImpl:zO,bincountReduceImpl:WO,castImpl:UO,ceilImpl:HO,concatImpl:KO,equalImpl:XO,expImpl:QO,expm1Impl:ZO,floorImpl:$O,gatherNdImpl:jO,gatherV2Impl:YO,greaterEqualImpl:qO,greaterImpl:JO,lessEqualImpl:tG,lessImpl:eG,linSpaceImpl:nG,logImpl:iG,maxImpl:rG,maximumImpl:sG,minimumImpl:aG,multiplyImpl:MT,negImpl:oG,notEqualImpl:lG,prodImpl:uG,raggedGatherImpl:AG,raggedTensorToTensorImpl:vG,rangeImpl:yG,rsqrtImpl:bG,scatterImpl:xG,sigmoidImpl:CG,simpleAbsImpl:GO,sliceImpl:wG,sparseFillEmptyRowsImpl:EG,sparseReshapeImpl:IG,sparseSegmentReductionImpl:SG,sqrtImpl:TG,squaredDifferenceImpl:MG,stridedSliceImpl:_G,stringNGramsImpl:BG,stringSplitImpl:LG,stringToHashBucketFastImpl:DG,subImpl:NG,tileImpl:FG,topKImpl:PG,transposeImpl:cG,uniqueImpl:OG},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{addImpl:UG,bincountImpl:LT,bincountReduceImpl:VG,castImpl:zG,ceilImpl:WG,concatImpl:HG,equalImpl:KG,expImpl:XG,expm1Impl:QG,floorImpl:ZG,gatherNdImpl:$G,gatherV2Impl:jG,greaterImpl:YG,greaterEqualImpl:JG,lessImpl:qG,lessEqualImpl:e9,linSpaceImpl:t9,logImpl:n9,maxImpl:i9,maximumImpl:r9,minimumImpl:s9,multiplyImpl:a9,negImpl:o9,notEqualImpl:l9,prodImpl:c9,raggedGatherImpl:u9,raggedTensorToTensorImpl:h9,rangeImpl:d9,rsqrtImpl:p9,scatterImpl:f9,sigmoidImpl:m9,simpleAbsImpl:DT,sliceImpl:g9,sparseFillEmptyRowsImpl:A9,sparseReshapeImpl:v9,sparseSegmentReductionImpl:NT,sqrtImpl:y9,stridedSliceImpl:b9,stringNGramsImpl:x9,stringSplitImpl:C9,stringToHashBucketFastImpl:w9,subImpl:E9,tileImpl:I9,topKImpl:S9,transposeImpl:eE,uniqueImpl:T9}=GG;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FT(i,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${i}.${t}`)}function ol(i,e){return e===1?[i]:FT(i,e)}function M9(i,e){if(i===1)return"rc";let t="";for(let r=0;r<i;r++)t+=e[r],r<i-1&&(t+=",");return t}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class _9{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=al(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=ol("rc",this.rank),r=sa(this.rank),s=this.getOutOfBoundsCondition(t),o=this.getSetup(t),l=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${l}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let o=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let l=2;l<this.rank;l++)o=`${e[e.length-1-l]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PT{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length);let r="";for(let s=0;s<4;s++){let o="thisRC = rc;";s%2===1&&(o+="thisRC.z += 1;"),s>1&&(o+="thisRC.y += 1;"),r+=`
        ${o}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${R9(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Yw():jw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function R9(i,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?R5(["r","c","d"],"inputShape"):lf(["r","c","d"],i)}
      return ivec3(r, c, d);
    }
  `}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class B9{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,r){const s=GT(t,r),o=UT(e,s,r);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const l=OT(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=l,this.log();const h=this.freeTextures[o].shift();return this.usedTextures[o].push(h),h}let c;return s===Do.PACKED_2X2_FLOAT32?c=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Do.PACKED_2X2_FLOAT16?c=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Do.UNPACKED_FLOAT32?c=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Do.UNPACKED_FLOAT16?c=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Do.PACKED_4X1_UNSIGNED_BYTE&&(c=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(c),this.numUsedTextures++,this._numBytesAllocated+=l,this.log(),c}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const o=GT(r,s),l=UT(t,o,s);l in this.freeTextures||(this.freeTextures[l]=[]);const c=OT(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,s),h=Ye().get("WEBGL_DELETE_TEXTURE_THRESHOLD");h!==-1&&this._numBytesAllocated>h?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=c):(this.freeTextures[l].push(e),this.numFreeTextures++,this._numBytesFree+=c),this.numUsedTextures--;const p=this.usedTextures[l],f=p.indexOf(e);if(f<0)throw new Error("Cannot release a texture that was never provided by this texture manager");p.splice(f,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function k9(i,e){const t=i;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F||e===i.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function OT(i,e,t,r,s){const o=L9(e,r);let l;if(s){const[h,p]=sg(i[0],i[1]);l=h*p}else{const[h,p]=RA(i[0],i[1]);l=h*p}const c=k9(t,o);return l*c}function L9(i,e){switch(i){case Do.PACKED_2X2_FLOAT32:return ST(e);case Do.PACKED_2X2_FLOAT16:return TT(e);case Do.UNPACKED_FLOAT32:return wT(e);case Do.UNPACKED_FLOAT16:return ET(e);case Do.PACKED_4X1_UNSIGNED_BYTE:return IT(e);default:throw new Error(`Unknown physical texture type ${i}`)}}function D9(i){return Ye().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?i?Do.PACKED_2X2_FLOAT32:Do.UNPACKED_FLOAT32:i?Do.PACKED_2X2_FLOAT16:Do.UNPACKED_FLOAT16}function GT(i,e){if(i===hc.UPLOAD)return Do.PACKED_2X2_FLOAT32;if(i===hc.RENDER||i==null)return D9(e);if(i===hc.DOWNLOAD||i===hc.PIXELS)return Do.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${i}`)}function UT(i,e,t){return`${i[0]}_${i[1]}_${e}_${t}`}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Jh{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Nc="if (isnan(x)) return x;",N9="return x;",VT="return abs(x);",F9="return (x >= 0.0) ? x : (exp(x) - 1.0);",P9=Nc+`
  return (x < 0.0) ? 0.0 : x;
`,O9=Nc+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,dg="return x;",G9="return 1.0 / (1.0 + exp(-1.0 * x));";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const U9="return x;",V9=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,z9=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W9=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,H9="return 1.0 / (1.0 + exp(-1.0 * x));";class uf{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class K9{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length);const t=e.length,r=ol("rc",t),s=sa(t),o=M9(t,r),l=r.slice(-2),c=t<=1?"rc":`vec2(${l.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${c}));
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X9=bv,Q9=1e-7,Z9=1e-4,tE={};function $9(i){return i in tE||(tE[i]={}),tE[i]}const j9=Ye().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Y9=600;function J9(){return Ye().global.screen==null?1024:Ye().global.screen.height*Ye().global.screen.width*window.devicePixelRatio*Y9/1024/1024}class Py extends Te{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Ye().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof qw)t=e;else{const r=Au(Ye().getNumber("WEBGL_VERSION"),e);t=new qw(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Au(Ye().getNumber("WEBGL_VERSION"));t=new qw(r),this.binaryCache=$9(Ye().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new B9(this.gpgpu),this.numMBBeforeWarning=J9(),this.texData=new xe(this,ea())}nextDataId(){return Py.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,r){if((Ye().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ye().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:hc.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,o){if(Ye().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:hc.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:o,slice:l,shape:c,isPacked:h}=t;if(l!=null){let v;h?v=new uf(c,dg):v=new Jh(c,dg);const w=this.runWebGLProgram(v,[{dataId:e,shape:c,dtype:s}],s),R=this.readSync(w.dataId);return this.disposeIntermediateTensorInfo(w),R}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const p=this.activeTimers!=null;let f;p&&(f=ao());let g;if(s==="complex64"){const v=this.readSync(o.real.dataId),w=this.readSync(o.imag.dataId);g=_c(v,w)}else g=this.getValuesFromTexture(e);return p&&(this.downloadWaitMs+=ao()-f),this.convertAndCacheOnCPU(e,g)}async read(e){if(this.pendingRead.has(e)){const R=this.pendingRead.get(e);return new Promise(P=>R.push(P))}const t=this.texData.get(e),{values:r,shape:s,slice:o,dtype:l,complexTensorInfos:c,isPacked:h}=t;if(o!=null){let R;h?R=new uf(s,dg):R=new Jh(s,dg);const P=this.runWebGLProgram(R,[{dataId:e,shape:s,dtype:l}],l),z=this.read(P.dataId);return this.disposeIntermediateTensorInfo(P),z}if(r!=null)return this.convertAndCacheOnCPU(e);if(Ye().getBool("DEBUG")&&!Ye().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ye().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let p=null,f;if(l!=="complex64"&&Ye().get("WEBGL_BUFFER_SUPPORTED")){f=this.decode(e);const R=this.texData.get(f.dataId);p=this.gpgpu.createBufferFromTexture(R.texture.texture,...Ry(s))}this.pendingRead.set(e,[]),l!=="complex64"&&await this.gpgpu.createAndWaitForFence();let g;if(l==="complex64"){const R=await Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]),P=R[0],z=R[1];g=_c(P,z)}else if(p==null)g=this.getValuesFromTexture(e);else{const R=b(s);g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,R)}if(f!=null&&this.disposeIntermediateTensorInfo(f),p!=null){const R=this.gpgpu.gl;Pi(R,()=>R.deleteBuffer(p))}const v=this.convertAndCacheOnCPU(e,g),w=this.pendingRead.get(e);return this.pendingRead.delete(e),w.forEach(R=>R(v)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ea().removeDataId(e,this),this.pendingDeletes--),v}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:o,slice:l,dtype:c,isPacked:h,texture:p}=r;if(c==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(l!=null){let w;h?w=new uf(o,dg):w=new Jh(o,dg);const R=this.runWebGLProgram(w,[{dataId:e,shape:o,dtype:c}],c),P=this.readToGPU(R,t);return this.disposeIntermediateTensorInfo(R),P}if(p==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const f=this.decode(e,t.customTexShape),g=ea().makeTensorFromTensorInfo(f),v=this.texData.get(f.dataId);return Object.assign({tensorRef:g},v.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Pl(s));return dr(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dr(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!i5(r))throw Ye().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),o=b(t);if(Ye().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const v=this.decode(e),w=this.texData.get(v.dataId),R=this.gpgpu.downloadMatrixFromPackedTexture(w.texture.texture,...Ry(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(v),R}const l=Ye().getBool("WEBGL_PACK")&&s===!0,c=l?Xw(t):t,h=l?new yO(c):new vO(c),p=this.runWebGLProgram(h,[{shape:c,dtype:r,dataId:e}],"float32"),f=this.texData.get(p.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(p),g}timerAvailable(){return Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const o=M(this.activeTimers.map(h=>h.query)).filter(h=>h!=null),l=M(this.activeTimers.map(h=>h.name)).filter(h=>h!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const h=await Promise.all(o);c.kernelMs=H(h),c.getExtraProfileInfo=()=>h.map((p,f)=>({name:l[f],ms:p})).map(p=>`${p.name}: ${p.ms}`).join(", ")}else c.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,c})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ao(),endMs:null}}endTimer(e){return Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ao(),e)}async getQueryTime(e){if(Ye().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:o,isPacked:l,slice:c}=this.texData.get(e),h=c&&c.origDataId||e,p=this.dataRefCount.get(h);p>1?this.dataRefCount.set(h,p-1):(this.dataRefCount.delete(h),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,o,l)));const f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=j9){return Ye().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&b(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ao("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return X9(e.shape,t)}packedUnaryOp(e,t,r){const s=new uf(e.shape,t),o=this.compileAndRun(s,[e],r);return ea().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=DT(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(Ye().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,VT,e.dtype);const t=new Jh(e.shape,VT),r=this.compileAndRun(t,[e]);return ea().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&de(r[0])){const o=r.map(l=>Go(l));s=this.write(o,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return ea().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new K9(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new _9(e.shape),r=!0;return this.runWebGLProgram(t,[e],e.dtype,null,r)}packedReshape(e,t){const r=[ag(e.shape),...og(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},o=[ag(t),...og(t)],l=new PT(o,r),c=!0,h=[r],p=this.runWebGLProgram(l,[s],e.dtype,h,c);return{dataId:p.dataId,shape:t,dtype:p.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:o,dtype:l}=r;if(t!=null){const v=b(o),w=t[0]*t[1]*4;C(v<=w,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const c=Xw(o);let h;s?h=new AO(c):h=new gO(c);const p=!0,f=[t??Ry(c)],g=this.runWebGLProgram(h,[{shape:c,dtype:l,dataId:e}],l,f,p,t);return{dtype:l,shape:o,dataId:g.dataId}}runWebGLProgram(e,t,r,s,o=!1,l){const c=this.makeTensorInfo(e.outputShape,r),h=this.texData.get(c.dataId);if(e.packedOutput&&(h.isPacked=!0),e.outPackingScheme===_A.DENSE){const G=l??Ry(e.outputShape);h.texShape=G.map(X=>X*2)}if(e.outTexUsage!=null&&(h.usage=e.outTexUsage),b(c.shape)===0)return h.values=W(c.dtype,0),c;const p=[],f=t.map(G=>{if(G.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let X=this.texData.get(G.dataId);if(X.texture==null){if(!e.packedInputs&&b(G.shape)<=Ye().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:G.shape,texData:null,isUniform:!0,uniformValues:X.values};e.packedInputs&&(X.isPacked=!0,X.shape=G.shape)}if(this.uploadToGPU(G.dataId),!!X.isPacked!=!!e.packedInputs)G=X.isPacked?this.unpackTensor(G):this.packTensor(G),p.push(G),X=this.texData.get(G.dataId);else if(X.isPacked&&!Dy(X.shape,G.shape)){const fe=G,ge=G.shape;G.shape=X.shape,G=this.packedReshape(G,ge),p.push(G),X=this.texData.get(G.dataId),fe.shape=ge}return{shape:G.shape,texData:X,isUniform:!1}});this.uploadToGPU(c.dataId);const g={shape:c.shape,texData:h,isUniform:!1},v=mO(e,f,g),w=this.getAndSaveBinary(v,()=>pO(this.gpgpu,e,f,g)),R=this.activeTimers!=null;let P;R&&(P=this.startTimer()),Ye().get("ENGINE_COMPILE_ONLY")||fO(this.gpgpu,w,f,g,s),p.forEach(G=>this.disposeIntermediateTensorInfo(G)),R&&(P=this.endTimer(P),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(P)}));const z=Ye().get("WEBGL_FLUSH_THRESHOLD");if(z>0){const G=ao();G-this.lastGlFlushTime>z&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=G)}if(!Ye().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&o===!1){const G=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),G}return c}compileAndRun(e,t,r,s,o=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Ye().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Pt(()=>{if(!Ye().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Ye().getBool("DEBUG");Ye().set("DEBUG",!1);const t=this.abs(xs(1e-8)).dataSync()[0];if(Ye().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Q9:Z9}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:o,texture:l,usage:c,isPacked:h}=t;if(l!=null)return;const p=this.activeTimers!=null;let f;p&&(f=ao());let g=t.texShape;if(g==null&&(g=x5(r,h),t.texShape=g),o!=null){const v=Xw(r);let w,R=g[1],P=g[0];const z=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(h||!z)&&([R,P]=sg(g[0],g[1])),h?w=new xO(v,z):w=new bO(v,z);const G=z?[P,R]:g,X=this.makeTensorInfo(G,s),fe=this.texData.get(X.dataId);z?fe.usage=hc.PIXELS:fe.usage=hc.UPLOAD,fe.texShape=G,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(X.dataId),R,P,o);const ge=[[P,R]],be=!0,He=this.runWebGLProgram(w,[X],s,ge,be),Je=this.texData.get(He.dataId);t.texShape=Je.texShape,t.isPacked=Je.isPacked,t.usage=Je.usage,Ye().get("ENGINE_COMPILE_ONLY")?this.disposeData(He.dataId):(t.texture=Je.texture,t.values=null,this.texData.delete(He.dataId)),this.disposeIntermediateTensorInfo(X),p&&(this.uploadWaitMs+=ao()-f)}else{const v=this.acquireTexture(g,c,s,h);t.texture=v}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return this.releaseGPUData(e),t!=null&&(r.values=q9(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*Se(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(o){throw o}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Bm(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(pT(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:r,infLoc:s,nanLoc:o,inShapesLocations:l,inTexShapesLocations:c,outShapeLocation:h,outShapeStridesLocation:p,outTexShapeLocation:f}=xT(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=o,e.inShapesLocations=l,e.inTexShapesLocations=c,e.outShapeLocation=h,e.outShapeStridesLocation=p,e.outTexShapeLocation=f}}}Py.nextDataId=0;function q9(i,e){if(e==="float32"||e==="complex64")return i;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(i.length):new Uint8Array(i.length);for(let r=0;r<t.length;++r)t[r]=Math.round(i[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Xc()&&o1("webgl",()=>new Py,2);/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nE=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class pg{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=Ir(t,r),this.enableShapeUniforms=al(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DA=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class NA{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ir(t,r);const o=this.outputShape.length;this.enableShapeUniforms=al(o);let l="";if(s)if(o===0||b(this.outputShape)===1)l=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(l=`
          ${sa(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?l+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:l+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=ol("coords",o);this.enableShapeUniforms?l+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:l+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${l}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ql(i){const{inputs:e,backend:t}=i,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const e8={kernelName:_e,backendName:"webgl",kernelFunc:Ql};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tp(i){const{inputs:e,backend:t}=i,{real:r,imag:s}=e,o=t.makeTensorInfo(r.shape,"complex64"),l=t.texData.get(o.dataId),c=Ql({inputs:{x:r},backend:t}),h=Ql({inputs:{x:s},backend:t});return l.complexTensorInfos={real:c,imag:h},o}const t8={kernelName:Dr,backendName:"webgl",kernelFunc:tp};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zT="return (a < 0.) ? b * a : a;",WT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function n8(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{alpha:o}=r,l=t.makeTensorInfo([],"float32",Ya(o,"float32")),c=Ye().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new NA(WT,s.shape,l.shape):new pg(zT,s.shape,l.shape),h=t.runWebGLProgram(c,[s,l],"float32");return t.disposeIntermediateTensorInfo(l),h}const i8={kernelName:Lt,backendName:"webgl",kernelFunc:n8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HT="return (a < 0.) ? b * a : a;",KT=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function r8(i){const{inputs:e,backend:t}=i,{x:r,alpha:s}=e,o=Ye().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new NA(KT,r.shape,s.shape):new pg(HT,r.shape,s.shape);return t.runWebGLProgram(o,[r,s],"float32")}const s8={kernelName:ad,backendName:"webgl",kernelFunc:r8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fg="if (isnan(x)) return x;";function ms({opSnippet:i,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:o})=>{const{x:l}=s,c=o,h=r||l.dtype;if(c.shouldExecuteOnCPU([l])&&t!=null){const g=c.texData.get(l.dataId),v=t(g.values,h);return c.makeTensorInfo(l.shape,h,v)}const p=Ye().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let f;return p?f=new uf(l.shape,e):f=new Jh(l.shape,i),c.runWebGLProgram(f,[l],h)}}function No({opSnippet:i,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:o}){return({inputs:l,backend:c})=>{const{a:h,b:p}=l,f=c;if(r&&h.dtype==="complex64"){const R=f.texData.get(h.dataId),P=f.texData.get(p.dataId),[z,G]=[[R.complexTensorInfos.real,P.complexTensorInfos.real],[R.complexTensorInfos.imag,P.complexTensorInfos.imag]].map(fe=>{const[ge,be]=fe,He={dataId:ge.dataId,dtype:ge.dtype,shape:h.shape},Je={dataId:be.dataId,dtype:be.dtype,shape:p.shape},$e=new pg(i,h.shape,p.shape);return f.runWebGLProgram($e,[He,Je],Uo(ge.dtype,be.dtype))}),X=tp({inputs:{real:z,imag:G},backend:f});return f.disposeIntermediateTensorInfo(z),f.disposeIntermediateTensorInfo(G),X}const g=o||Uo(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||f.shouldExecuteOnCPU([h,p]))&&s!=null){const R=f.texData.get(h.dataId).values,P=f.texData.get(p.dataId).values,z=h.dtype==="string"?Rc(R):R,G=h.dtype==="string"?Rc(P):P,[X,fe]=s(h.shape,p.shape,z,G,g),ge=f.makeTensorInfo(fe,g),be=f.texData.get(ge.dataId);return be.values=X,ge}const v=Ye().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let w;return v?w=new NA(e,h.shape,p.shape,t):w=new pg(i,h.shape,p.shape),f.runWebGLProgram(w,[h,p],g)}}function FA(i,e=!1){if(i==="linear")return e?U9:N9;if(i==="relu")return e?z9:P9;if(i==="elu")return e?V9:F9;if(i==="relu6")return e?W9:O9;if(i==="prelu")return e?KT:HT;if(i==="leakyrelu")return e?WT:zT;if(i==="sigmoid")return e?H9:G9;throw new Error(`Activation ${i} has not been implemented for the WebGL backend.`)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class XT{constructor(e,t,r,s=!1,o=!1,l=!1,c=null,h=!1,p=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=al(this.outputShape.length);const f=s?e[1]:e[2],g=Math.ceil(f/2),v=s?"i * 2, rc.y":"rc.y, i * 2",w=o?"rc.z, i * 2":"i * 2, rc.z",R=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],P=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let z="",G="";c&&(h?z=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${c}
        }`:p?z=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${c}
        }`:z=`vec4 activation(vec4 x) {
          ${c}
        }`,G="result = activation(result);");const X=l?"result += getBiasAtOutCoords();":"";l&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),p&&this.variableNames.push("leakyreluAlpha");let fe="rc.x",ge="rc.x";e[0]<t[0]?fe=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(ge=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`
      ${z}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${g}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${g}; i++) {
          int batchA = ${fe};
          int batchB = ${ge};
          vec4 a = getMatrixA(batchA, ${v});
          vec4 b = getMatrixB(batchB, ${w});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${R[0]} * ${P[0]});
          result += (${R[1]} * ${P[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${X}

        ${G}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QT={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class ZT{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ir(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $T="return a * b;";function iE(i){const{inputs:e,backend:t}=i,{a:r,b:s}=e,o=Uo(r.dtype,s.dtype);if(r.dtype==="complex64"){const c=t.texData.get(r.dataId),h=t.texData.get(s.dataId),p=new ZT(QT.REAL,r.shape,s.shape),f=new ZT(QT.IMAG,r.shape,s.shape),g=[{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:h.complexTensorInfos.real.dataId,dtype:h.complexTensorInfos.real.dtype,shape:s.shape},{dataId:h.complexTensorInfos.imag.dataId,dtype:h.complexTensorInfos.imag.dtype,shape:s.shape}],v=t.runWebGLProgram(p,g,"float32"),w=t.runWebGLProgram(f,g,"float32"),R=tp({inputs:{real:v,imag:w},backend:t});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),R}if(t.shouldExecuteOnCPU([r,s])){const c=t.texData.get(r.dataId),h=t.texData.get(s.dataId),[p,f]=a9(r.shape,s.shape,c.values,h.values,o),g=t.makeTensorInfo(f,o),v=t.texData.get(g.dataId);return v.values=p,g}let l;return Ye().getBool("WEBGL_PACK_BINARY_OPERATIONS")?l=new NA($T,r.shape,s.shape):l=new pg($T,r.shape,s.shape),t.runWebGLProgram(l,[r,s],o)}const a8={kernelName:fl,backendName:"webgl",kernelFunc:iE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function o8(i,e,t){const r=[ag(i.shape),...og(i.shape)],s={dtype:i.dtype,shape:r,dataId:i.dataId},o=[ag(e),...og(e)],l=new PT(o,r),c=!0,h=[r],p=t.runWebGLProgram(l,[s],i.dtype,h,c);return{dataId:p.dataId,shape:e,dtype:p.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yi(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{shape:o}=r,l=t,c=b(s.shape),h=V(o,c),p=b(h);C(c===p,()=>`The new shape (${h}) has ${p} elements and the old shape (${s.shape}) has ${c} elements. The new shape and old shape must have the same number of elements.`);const f=l.texData.get(s.dataId);return f.isPacked&&!Dy(s.shape,h)&&!(f.texture!==null&&Dy(f.shape,h))?o8(s,h,l):(l.incRef(s.dataId),{dataId:s.dataId,shape:h,dtype:s.dtype})}const l8={kernelName:ld,backendName:"webgl",kernelFunc:yi};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jT{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:o,outSize:l}=e;this.outputShape=[s,l];const c=Math.floor(r/4)*4,h=r%4;let p="sumValue += dot(values, ones);";if(t!=null){const g=1/t;p=`sumValue += dot(values * ${I(g)?g.toPrecision(2):g}, ones);`}let f="";o%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${c};
        if (${h===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${p}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${p}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${p}
        }
        setOutput(sumValue);
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class c8{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:o,outSize:l}=e;this.outputShape=[s,l];let c="0.0",h="";t==="prod"?c="1.0":t==="min"?(c="1.0 / 1e-20",h="min"):t==="max"&&(c="-1.0 / 1e-20",h="max");let p=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?p="sumValue":t==="prod"?p="prodValue":t==="all"?p="allValue":t==="any"&&(p="anyValue");const f=Math.floor(r/4)*4,g=r%4;let v=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${h}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${h}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,w="vec4";t==="all"?(c="1.0",v=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,w="bvec4"):t==="any"&&(c="0.0",v=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,w="bvec4");let R="";o%r>0&&(R=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${c};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${R}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${c});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${f}; i += 4) {
          int inIdx = inOffset + i;
          ${w} values = ${w}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${v}
        }

        int inIdx = inOffset + ${f};
        if (${g===1}) {
          ${w} values = ${w}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${v}
        } else if (${g===2}) {
          ${w} values = ${w}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${v}
        } else if (${g===3}) {
          ${w} values = ${w}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${v}
        }
        setOutput(${p});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u8(i){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:i[1],r=Wp(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function hf(i,e,t,r){const s=u8(i.shape);let o=i;for(let l=0;l<s.length;l++){const{inSize:c,windowSize:h,outSize:p}=s[l];let f,g;t==="mean"?f=l===0?new jT({windowSize:h,inSize:c,batchSize:i.shape[0],outSize:p},c):new jT({windowSize:h,inSize:c,batchSize:i.shape[0],outSize:p}):f=new c8({windowSize:h,inSize:c,batchSize:i.shape[0],outSize:p},t),g=o,o=r.runWebGLProgram(f,[o],e),g.dataId!==i.dataId&&r.disposeIntermediateTensorInfo(g)}return o}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class h8{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let l=0;l<r.length;l++)r[l]=e[t[l]];this.outputShape=r,this.rank=r.length;const s=sa(this.rank),o=d8(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function d8(i){const e=i.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<i.length;s++)r[i[s]]=t[s];return r.join()}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class p8{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let f=0;f<r.length;f++)r[f]=e[t[f]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=sa(this.rank),o=FT("rc",this.rank),l=new Array(this.rank);for(let f=0;f<t.length;f++)l[t[f]]=o[f];const c=`vec2(${l.slice(-2).join()})`,h=`++${o[this.rank-1]} < ${r[this.rank-1]}`,p=`getChannel(getA(${l.join()}), ${c})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${p};
      if(${h}) {
        result[1] = ${p};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${p};
        if(${h}) {
          result[3] = ${p};
        }
      }
      setOutput(result);
    }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oy(i,e,t){const r=Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p8(i.shape,e):new h8(i.shape,e);return t.runWebGLProgram(r,[i],i.dtype)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f8(i,e,t,r){const s=e,o=i.shape.length,l=J(s,i.shape);let c=l;const h=ha(c,o),p=h!=null;let f=i;p&&(f=Oy(i,h,r),c=wa(c.length,o)),co("sum",c,o);const[g,v]=Xa(f.shape,c);let w=g;t&&(w=Da(g,l));const R=b(v),P=b(i.shape)/R,z=yi({inputs:{x:f},attrs:{shape:[P,R]},backend:r}),G=Fi(i.dtype),X=hf(z,G,"sum",r),fe=yi({inputs:{x:X},attrs:{shape:w},backend:r});return r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(X),p&&r.disposeIntermediateTensorInfo(f),fe}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gy(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r;return f8(s,o,l,t)}const m8={kernelName:hd,backendName:"webgl",kernelFunc:Gy};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ll(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{perm:o}=r,l=t,c=s.shape.length,h=new Array(c);for(let f=0;f<h.length;f++)h[f]=s.shape[o[f]];let p;if(l.shouldExecuteOnCPU([s])){const f=l.texData.get(s.dataId).values,g=eE(f,s.shape,s.dtype,o,h);p=l.makeTensorInfo(h,s.dtype);const v=l.texData.get(p.dataId);v.values=g}else p=Oy(s,o,l);return p}const g8={kernelName:ma,backendName:"webgl",kernelFunc:ll};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YT=1e3;function Uy({a:i,b:e,transposeA:t,transposeB:r,backend:s,bias:o=null,preluActivationWeights:l=null,leakyreluAlpha:c=0,activation:h=null}){const p=i.shape.length,f=e.shape.length,g=t?i.shape[p-2]:i.shape[p-1],v=r?e.shape[f-1]:e.shape[f-2],w=t?i.shape[p-1]:i.shape[p-2],R=r?e.shape[f-2]:e.shape[f-1],P=i.shape.slice(0,-2),z=e.shape.slice(0,-2),G=b(P),X=b(z),fe=Ir(i.shape.slice(0,-2),e.shape.slice(0,-2)).concat([w,R]);C(g===v,()=>`Error in matMul: inner shapes (${g}) and (${v}) of Tensors with shapes ${i.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const ge=t?[G,g,w]:[G,w,g],be=r?[X,R,v]:[X,v,R],He=yi({inputs:{x:i},backend:s,attrs:{shape:ge}}),Je=yi({inputs:{x:e},backend:s,attrs:{shape:be}}),$e=[He,Je],rt=Math.max(G,X),pt=t?He.shape[1]:He.shape[2],Gt=o!=null,zt=l!=null,Kt=h==="leakyrelu",tn=h!=null?FA(h,!0):null,qt=Gt||zt||Kt||tn!=null;let sn;if((w===1||R===1)&&pt>YT&&qt===!1){let dn=He,Mn=Je;t&&(dn=ll({inputs:{x:He},backend:s,attrs:{perm:[0,2,1]}}),$e.push(dn)),r&&(Mn=ll({inputs:{x:Je},backend:s,attrs:{perm:[0,2,1]}}),$e.push(Mn));const zn=R!==1,Gn=R===1;let $n=dn;zn&&($n=yi({inputs:{x:dn},backend:s,attrs:{shape:[rt,pt,1]}}),$e.push($n));const ei=R===1?2:1;let si=Mn;Gn&&(si=yi({inputs:{x:Mn},backend:s,attrs:{shape:[rt,1,pt]}}),$e.push(si));const ci=iE({inputs:{a:$n,b:si},backend:s});sn=Gy({inputs:{x:ci},backend:s,attrs:{axis:ei,keepDims:!0}}),$e.push(ci)}else{const dn=Uo(i.dtype,e.dtype),Mn=new XT(ge,be,[rt,w,R],t,r,Gt,tn,zt,Kt),zn=[He,Je];if(o!=null&&zn.push(o),zt&&zn.push(l),Kt){const Gn=s.makeTensorInfo([],"float32",Ya(c,"float32"));zn.push(Gn),$e.push(Gn)}sn=s.runWebGLProgram(Mn,zn,dn)}const xn=yi({inputs:{x:sn},backend:s,attrs:{shape:fe}});$e.push(sn);for(const dn of $e)s.disposeIntermediateTensorInfo(dn);return xn}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A8(i){const{inputs:e,backend:t,attrs:r}=i,{a:s,b:o,bias:l,preluActivationWeights:c}=e,{transposeA:h,transposeB:p,activation:f,leakyreluAlpha:g}=r;return Uy({a:s,b:o,transposeA:h,transposeB:p,backend:t,bias:l,preluActivationWeights:c,leakyreluAlpha:g,activation:f})}const v8={kernelName:ec,backendName:"webgl",kernelFunc:A8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JT="return abs(x);";function y8(i){const{inputs:e,backend:t}=i,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const o=t.texData.get(r.dataId),l=DT(o.values);return t.makeTensorInfo(r.shape,r.dtype,l)}let s;return Ye().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new uf(r.shape,JT):s=new Jh(r.shape,JT),t.runWebGLProgram(s,[r],r.dtype)}const b8={kernelName:Nt,backendName:"webgl",kernelFunc:y8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const x8=Nc+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,C8=ms({opSnippet:x8}),w8={kernelName:De,backendName:"webgl",kernelFunc:C8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const E8=Nc+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,I8=ms({opSnippet:E8}),S8={kernelName:Re,backendName:"webgl",kernelFunc:I8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qT="return a + b;",T8=No({opSnippet:qT,packedOpSnippet:qT,supportsComplex:!0,cpuKernelImpl:UG}),M8={kernelName:We,backendName:"webgl",kernelFunc:T8};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class _8{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,l)=>`T${l}`);const r=[];this.variableNames.forEach(o=>{r.push(`float v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class R8{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,l)=>`T${l}`);const r=[];this.variableNames.forEach(o=>{r.push(`vec4 v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vy(i){const{inputs:e,backend:t}=i,r=e;if(r.length===1)return Ql({inputs:{x:r[0]},backend:t});if(r.length>Ye().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(r.length/2),h=Vy({inputs:r.slice(0,c),backend:t}),p=Vy({inputs:r.slice(c),backend:t});return Vy({inputs:[h,p],backend:t})}const s=r.map(c=>c.dtype).reduce((c,h)=>Uo(c,h)),o=r.map(c=>c.shape),l=Ye().getBool("WEBGL_PACK")?new R8(r[0].shape,o):new _8(r[0].shape,o);return t.runWebGLProgram(l,r,s)}const B8={kernelName:Oe,backendName:"webgl",kernelFunc:Vy};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k8(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r,c=s.shape.length,h=J(o,s.shape);let p=h;const f=ha(p,c);let g=s;f!=null&&(g=ll({inputs:{x:s},backend:t,attrs:{perm:f}}),p=wa(p.length,c)),co("all",p,c);const[v,w]=Xa(g.shape,p),R=b(w),P=yi({inputs:{x:g},backend:t,attrs:{shape:[-1,R]}}),z=hf(P,P.dtype,"all",t);let G;if(l){const X=Da(v,h);G=yi({inputs:{x:z},backend:t,attrs:{shape:X}})}else G=yi({inputs:{x:z},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(P),t.disposeIntermediateTensorInfo(z),f!=null&&t.disposeIntermediateTensorInfo(g),G}const L8={kernelName:Qe,backendName:"webgl",kernelFunc:k8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D8(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r,c=s.shape.length,h=J(o,s.shape);let p=h;const f=ha(p,c);let g=s;f!=null&&(g=ll({inputs:{x:s},backend:t,attrs:{perm:f}}),p=wa(p.length,c)),co("any",p,c);const[v,w]=Xa(g.shape,p),R=b(w),P=yi({inputs:{x:g},backend:t,attrs:{shape:[-1,R]}}),z=hf(P,P.dtype,"any",t);let G;if(l){const X=Da(v,h);G=yi({inputs:{x:z},backend:t,attrs:{shape:X}})}else G=yi({inputs:{x:z},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(P),t.disposeIntermediateTensorInfo(z),f!=null&&t.disposeIntermediateTensorInfo(g),G}const N8={kernelName:Ke,backendName:"webgl",kernelFunc:D8};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class F8{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:o,outSize:l}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[o,l];const c=t==="max"?">":"<",h=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${h};
          float candidate = getA(batch, inIdx);
          if (candidate ${c} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class P8{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],l=Math.ceil(o/t);this.outputShape=e.slice(0,-1),l>1&&this.outputShape.push(l),s||this.variableNames.push("bestIndicesA");const c=this.outputShape,h=c.length,p=sa(h),f=ol("coords",h);let g,v;if(l===1){v=h+1;const $e=sa(v);g=`
        ${$e} sourceLocR = ${$e}(${f.join()}, 0);
        ++${f[h-1]};
        ${$e} sourceLocG = ${$e}(${f.join()}, 0);
        ++${f[h-2]};
        ${$e} sourceLocA = ${$e}(${f.join()}, 0);
        --${f[h-1]};
        ${$e} sourceLocB = ${$e}(${f.join()}, 0);
        --${f[h-2]};`}else v=h,g=`
        ${p} sourceLocR = coords;
        ++${f[h-1]};
        ${p} sourceLocG = coords;
        ++${f[h-2]};
        ${p} sourceLocA = coords;
        --${f[h-1]};
        ${p} sourceLocB = coords;
        --${f[h-2]};`;const w=["x","y","z","w","u","v"].slice(0,v),R="."+w[v-1],P=w.map($e=>"int "+$e),z=ol("sourceLocR",v-1).concat("inIdx.r"),G=ol("sourceLocG",v-1).concat("inIdx.g"),X=ol("sourceLocB",v-1).concat("inIdx.b"),fe=ol("sourceLocA",v-1).concat("inIdx.a"),ge=r==="max"?"greaterThan":"lessThan",be=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${z.join()}),
                             getBestIndicesAChannel(${G.join()}),
                             getBestIndicesAChannel(${X.join()}),
                             getBestIndicesAChannel(${fe.join()})));`,He=`vec4(
            getAChannel(${z.join()}),
            hasNextCol ? getAChannel(${G.join()}) : 0.,
            hasNextRow ? getAChannel(${X.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${fe.join()}) : 0.)`,Je=s?"":`
      float getBestIndicesAChannel(${P.join()}) {
        return getChannel(getBestIndicesA(${w.join()}),
                                          vec2(${w.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${P.join()}) {
        return getChannel(getA(${w.join()}),
                               vec2(${w.slice(-2).join()}));
      }
      ${Je}
      void main() {
        ${p} coords = getOutputCoords();
        bool hasNextCol = ${f[h-1]} < ${c[h-1]-1};
        bool hasNextRow = ${f[h-2]} < ${c[h-2]-1};
        ${g}
        ivec4 srcIdx = ivec4(sourceLocR${R}, sourceLocG${R},
          sourceLocB${R}, sourceLocA${R}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${He};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${be}
          vec4 candidate = ${He};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${ge}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eM(i,e,t,r=null){let s=e.shape[0],o=e.shape[1];r!=null&&(s=r.shape[0],o=r.shape[1]);const l=Wp(o),c={windowSize:l,inSize:o,batchSize:s,outSize:Math.ceil(o/l)},h=new F8(c,t,r==null),p=[e];r!=null&&p.push(r);const f=i.runWebGLProgram(h,p,"int32");if(f.shape[1]===1)return f;const g=eM(i,e,t,f);return i.disposeIntermediateTensorInfo(f),g}function tM(i,e,t,r=null){const s=r!=null?r.shape:e.shape,o=s[s.length-1],l=Wp(o),c=new P8(s,l,t,r==null),h=r==null?[e]:[e,r],p=i.runWebGLProgram(c,h,"int32");if(p.shape.length===e.shape.length){const f=tM(i,e,t,p);return i.disposeIntermediateTensorInfo(p),f}return p}function nM(i,e,t,r){const s=[t];if(co("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!Ye().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],l=i.texData.get(e.dataId),c=l!==null&&l.isPacked;let h=e;c&&(h=i.unpackTensor(e),o.push(h));const[p,f]=Xa(h.shape,s),g=b(f),v=yi({inputs:{x:h},backend:i,attrs:{shape:[-1,g]}});o.push(v);const w=eM(i,v,r);o.push(w);const R=yi({inputs:{x:w},backend:i,attrs:{shape:p}});return o.forEach(P=>i.disposeIntermediateTensorInfo(P)),R}return tM(i,e,r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O8(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o}=r;let l=J(o,s.shape);const c=ha(l,s.shape.length);let h=s;const p=[];c!=null&&(h=ll({inputs:{x:s},backend:t,attrs:{perm:c}}),p.push(h),l=wa(l.length,h.shape.length)),co("argMax",[l[0]],h.shape.length);const f=nM(t,h,l[0],"max");return p.forEach(g=>t.disposeIntermediateTensorInfo(g)),f}const G8={kernelName:vt,backendName:"webgl",kernelFunc:O8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U8(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o}=r;let l=J(o,s.shape);const c=ha(l,s.shape.length);let h=s;const p=[];c!=null&&(h=ll({inputs:{x:s},backend:t,attrs:{perm:c}}),p.push(h),l=wa(l.length,h.shape.length)),co("argMin",[l[0]],h.shape.length);const f=nM(t,h,l[0],"min");return p.forEach(g=>t.disposeIntermediateTensorInfo(g)),f}const V8={kernelName:ct,backendName:"webgl",kernelFunc:U8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const z8=Nc+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,W8=ms({opSnippet:z8}),H8={kernelName:Ct,backendName:"webgl",kernelFunc:W8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const K8=Nc+"return log(x + sqrt(x * x + 1.0));",X8=ms({opSnippet:K8}),Q8={kernelName:Yt,backendName:"webgl",kernelFunc:X8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Z8=Nc+`
  return atan(x);
`,$8=ms({opSnippet:Z8}),j8={kernelName:me,backendName:"webgl",kernelFunc:$8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y8=nE+`
  return atan(a, b);
`,J8=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+DA+`
  return result;
`,q8=No({opSnippet:Y8,packedOpSnippet:J8}),eU={kernelName:ae,backendName:"webgl",kernelFunc:q8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tU=Nc+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,nU=ms({opSnippet:tU}),iU={kernelName:ee,backendName:"webgl",kernelFunc:nU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PA{constructor(e,t,r,s=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,c=e.strideHeight,h=e.strideWidth,p=e.dilationHeight,f=e.dilationWidth,g=e.effectiveFilterHeight,v=e.effectiveFilterWidth,w=e.padInfo.top,R=e.padInfo.left;this.outputShape=e.outShape;const P=t==="avg",z=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,G=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let X="0.0";if(P||(X="-1.0 / 1e-20"),r){const $e=">=";this.userCode=`
        const ivec2 strides = ivec2(${c}, ${h});
        const ivec2 pads = ivec2(${w}, ${R});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${g};
              wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${v};
                wC += ${f}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$e} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?o?z:G:`wR * ${v} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const fe="max";let ge=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(ge="avgValue / count");const be=Math.floor(l/4)*4,He=l%4,Je=`
      if (${P}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${fe}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${c}, ${h});
      const ivec2 pads = ivec2(${w}, ${R});
      const float initializationValue = ${X};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${X});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${g};
            wR += ${p}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${be}; wC += 4) {
            int xC = xCCorner + wC * ${f};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${f}, d),
              getValue(batch, xR, xC + 2 * ${f}, d),
              getValue(batch, xR, xC + 3 * ${f}, d)
            );

            ${Je}
          }

          int xC = xCCorner + ${be};
          if (${He===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${Je}
          } else if (${He===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${f}, d),
              initializationValue,
              initializationValue
            );

            ${Je}
          } else if (${He===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${f}, d),
              getValue(batch, xR, xC + 2 * ${f}, d),
              initializationValue
            );

            ${Je}
          }
        }
        setOutput(${ge});
      }
    `}}class rE{constructor(e,t,r,s=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,c=e.strideDepth,h=e.strideHeight,p=e.strideWidth,f=e.dilationDepth,g=e.dilationHeight,v=e.dilationWidth,w=e.effectiveFilterDepth,R=e.effectiveFilterHeight,P=e.effectiveFilterWidth,z=e.padInfo.front,G=e.padInfo.top,X=e.padInfo.left;this.outputShape=e.outShape;const fe=t==="avg";let ge="0.0";if(fe||(ge="-1.0 / 1e-20"),r){const pt=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${c}, ${h}, ${p});
        const ivec3 pads = ivec3(${z}, ${G}, ${X});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${w};
              wD += ${f}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${R};
                wR += ${g}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${P};
                  wC += ${v}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${pt} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${R} * ${P} +
                      wR * ${P} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const be="max";let He=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(He="avgValue / count");const Je=Math.floor(l/4)*4,$e=l%4,rt=`
      if (${fe}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${be}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${c}, ${h}, ${p});
      const ivec3 pads = ivec3(${z}, ${G}, ${X});
      const float initializationValue = ${ge};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${ge});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${w};
            wD += ${f}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${R};
            wR += ${g}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Je}; wC += 4) {
              int xC = xCCorner + wC * ${v};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${v}, ch),
                getValue(batch, xD, xR, xC + 2 * ${v}, ch),
                getValue(batch, xD, xR, xC + 3 * ${v}, ch)
              );

              ${rt}
            }

            int xC = xCCorner + ${Je};
            if (${$e===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${rt}
            } else if (${$e===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${v}, ch),
                initializationValue,
                initializationValue
              );

              ${rt}
            } else if (${$e===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${v}, ch),
                getValue(batch, xD, xR, xC + 2 * ${v}, ch),
                initializationValue
              );

              ${rt}
            }
          }
          setOutput(${He});
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rU(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e;BA(s,"avgPool");const{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=r,p=1;C(Bo(l,p),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const f=ac(s.shape,o,l,p,c,h);if(f.filterWidth===1&&f.filterHeight===1&&S(f.inShape,f.outShape))return Ql({inputs:{x:s},backend:t});const g=new PA(f,"avg",!1);return t.runWebGLProgram(g,[s],"float32")}const sU={kernelName:Ue,backendName:"webgl",kernelFunc:rU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aU(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:h,dataFormat:p}=r,f=[1,1,1],g=Lu(s.shape,o,l,f,c,h,p),v=new rE(g,"avg",!1);return t.runWebGLProgram(v,[s],"float32")}const oU={kernelName:ft,backendName:"webgl",kernelFunc:aU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=h-1-e.padInfo.top,g=p-1-e.padInfo.left,v=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${f}, ${g});
      const float avgMultiplier = float(${v});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${p};
            wC+= ${c}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class cU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,o=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,p=e.dilationHeight,f=e.dilationWidth,g=e.effectiveFilterDepth,v=e.effectiveFilterHeight,w=e.effectiveFilterWidth,R=g-1-e.padInfo.front,P=v-1-e.padInfo.top,z=w-1-e.padInfo.left,G=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${R}, ${P}, ${z});
      const float avgMultiplier = float(${G});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${h}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${v};
              wR += ${p}) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${w};
                wC += ${f}) {
              float dyC = float(dyCCorner + wC) / ${c}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uU(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,l=o,{filterSize:c,strides:h,pad:p,dimRoundingMode:f}=r,g=[1,1,1],v=Lu(l.shape,c,h,g,p,f),w=new cU(v);return t.runWebGLProgram(w,[s],l.dtype)}const hU={kernelName:Ft,backendName:"webgl",kernelFunc:uU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dU(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,l=o;BA([s,o],"avgPoolGrad");const{filterSize:c,strides:h,pad:p}=r,f=ac(l.shape,c,h,1,p),g=new lU(f);return t.runWebGLProgram(g,[s],l.dtype)}const pU={kernelName:ht,backendName:"webgl",kernelFunc:dU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fU(i){const{inputs:e,backend:t,attrs:r}=i,{a:s,b:o}=e,{transposeA:l,transposeB:c}=r;return Uy({a:s,b:o,transposeA:l,transposeB:c,backend:t})}const mU={kernelName:hi,backendName:"webgl",kernelFunc:fU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gU{constructor(e,t,r,s,o,l){this.outputShape=[],this.variableNames=["x","mean","variance"],Ir(e,t),Ir(e,r);let c="0.0";s!=null&&(Ir(e,s),this.variableNames.push("offset"),c="getOffsetAtOutCoords()");let h="1.0";o!=null&&(Ir(e,o),this.variableNames.push("scale"),h="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${c};
        float scale = ${h};
        float inv = scale * inversesqrt(variance + float(${l}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AU{constructor(e,t,r,s,o,l){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ir(e,t),Ir(e,r);let c="vec4(0.0)";s!=null&&(Ir(e,s),this.variableNames.push("offset"),c="getOffsetAtOutCoords()");let h="vec4(1.0)";o!=null&&(Ir(e,o),this.variableNames.push("scale"),h="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${c};
        vec4 scale = ${h};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${l}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vU={kernelName:zs,backendName:"webgl",kernelFunc:({inputs:i,backend:e,attrs:t})=>{const{x:r,mean:s,variance:o,offset:l,scale:c}=i;C(s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C(l==null||s.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C(c==null||s.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:h}=t;h==null&&(h=.001);const p=[r,s,o];let f=null;l!=null&&(f=l.shape,p.push(l));let g=null;c!=null&&(g=c.shape,p.push(c));const v=Ye().getBool("WEBGL_PACK_NORMALIZATION")?new AU(r.shape,s.shape,o.shape,f,g,h):new gU(r.shape,s.shape,o.shape,f,g,h);return e.runWebGLProgram(v,p,p[0].dtype)}};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class yU{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=sa(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=bU(this.rank);let s;const o=e.map((l,c)=>`sourceLoc.${sE[c]} = start[${c}] + coords.${sE[c]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const sE=["x","y","z","w","u","v"];function bU(i){if(i===1)return"sourceLoc";if(i<=6)return sE.slice(0,i).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${i} is not yet supported`)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class xU{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=sa(this.rank),r=ol("coords",this.rank),s=ol("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,l=`getChannel(getSource(${s.join()}), ${o})`,c=`
      result.x = ${l};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${l};
        --${s[this.rank-1]};
      }
    `,h=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${l};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${l};
        }
      }
    `,p=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((f,g)=>`start[${g}]`).join()});`:e.map((f,g)=>`${s[g]} = ${r[g]} + start[${g}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${p}
        vec4 result = vec4(0.);
        ${c}
        ${h}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CU(i,e,t,r){const s=r.texData.get(i.dataId),o=r.makeTensorInfo(t,i.dtype),l=r.texData.get(o.dataId);Object.assign(l,s),l.refCount=1,l.shape=t,l.dtype=i.dtype;let c=Vf(e,ze(i.shape));s.slice&&(c+=s.slice.flatOffset),l.slice={flatOffset:c,origDataId:s.slice&&s.slice.origDataId||i.dataId};const h=r.dataRefCount.get(l.slice.origDataId)||1;return r.dataRefCount.set(l.slice.origDataId,h+1),o}function mg(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{begin:o,size:l}=r,[c,h]=zf(s,o,l);if(Qg(s,c,h),b(h)===0)return t.makeTensorInfo(h,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const g=t.texData.get(s.dataId),v=g9(g.values,c,h,s.shape,s.dtype);return t.makeTensorInfo(h,s.dtype,v)}const{isPacked:p}=t.texData.get(s.dataId),f=Uf(s.shape,c,h);if(p||!f){const g=Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xU(h):new yU(h),v=[c];return t.runWebGLProgram(g,[s],s.dtype,v)}return t.uploadToGPU(s.dataId),CU(s,c,h,t)}const wU={kernelName:mc,backendName:"webgl",kernelFunc:mg};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EU={kernelName:bi,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockShape:o,crops:l}=r;C(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const c=o.reduce((X,fe)=>X*fe),h=Kd(s.shape,o,c),p=Xd(h.length,o.length),f=Xh(s.shape,o,c),g=Z0(l,o.length),v=km(f,l,o.length),w=[],R=yi({inputs:{x:s},backend:t,attrs:{shape:h}}),P=ll({inputs:{x:R},backend:t,attrs:{perm:p}}),z=yi({inputs:{x:P},backend:t,attrs:{shape:f}}),G=mg({inputs:{x:z},backend:t,attrs:{begin:g,size:v}});return w.push(R),w.push(P),w.push(z),w.forEach(X=>t.disposeIntermediateTensorInfo(X)),G}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IU(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,weights:o}=e,{size:l}=r,c=t.readSync(s.dataId),h=t.readSync(o.dataId),p=LT(c,h,o.dtype,o.shape,l);return t.makeTensorInfo([l],o.dtype,p)}const SU={kernelName:ri,backendName:"webgl",kernelFunc:IU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TU(i){const{inputs:e,backend:t}=i,{s0:r,s1:s}=e,o=t.readSync(r.dataId),l=t.readSync(s.dataId),c=Ir(Array.from(o),Array.from(l));return t.makeTensorInfo([c.length],"int32",Int32Array.from(c))}const MU={kernelName:lr,backendName:"webgl",kernelFunc:TU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iM=No({opSnippet:"return float(a != b);",cpuKernelImpl:l9,dtype:"bool"}),_U={kernelName:Rl,backendName:"webgl",kernelFunc:iM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OA(i){const{inputs:e,backend:t}=i,{input:r}=e,s=t.texData.get(r.dataId);return Ql({inputs:{x:s.complexTensorInfos.real},backend:t})}const RU={kernelName:up,backendName:"webgl",kernelFunc:OA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BU="return float(int(x));";function kU(i,e){const t=new Jh(i.shape,BU),r=e.runWebGLProgram(t,[i],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aE(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{dtype:o}=r;if(o==="complex64"){if(s.dtype==="complex64")return Ql({inputs:{x:s},backend:t});const l=eo(s.shape),c=aE({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),h=tp({inputs:{real:c,imag:l},backend:t});return l.dispose(),t.disposeIntermediateTensorInfo(c),h}if(s.dtype==="complex64"){const l=OA({inputs:{input:s},backend:t}),c=aE({inputs:{x:l},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(l),c}if(!ve(s.dtype,o)){const l=Ql({inputs:{x:s},backend:t});return{dataId:l.dataId,shape:l.shape,dtype:o}}if(t.shouldExecuteOnCPU([s])){const l=t.texData.get(s.dataId).values,[c,h,p]=zG(l,s.shape,s.dtype,o);return t.makeTensorInfo(c,h,p)}if(o==="int32")return kU(s,t);if(o==="bool"){const l=t.makeTensorInfo([],"bool",W("bool",1)),c=iM({inputs:{a:s,b:l},backend:t});return t.disposeIntermediateTensorInfo(l),c}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}const LU={kernelName:_s,backendName:"webgl",kernelFunc:aE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rM="return ceil(x);",DU=ms({opSnippet:rM,packedOpSnippet:rM,cpuKernelImpl:WG}),NU={kernelName:Fs,backendName:"webgl",kernelFunc:DU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class FU{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OU(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{clipValueMin:o,clipValueMax:l}=r;let c;Ye().getBool("WEBGL_PACK_CLIP")?c=new PU(s.shape):c=new FU(s.shape);const h=[[o],[l]];return t.runWebGLProgram(c,[s],s.dtype,h)}const GU={kernelName:Vs,backendName:"webgl",kernelFunc:OU};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class UU{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sM(i,e){return{dataId:e.dataId,dtype:e.dtype,shape:i.shape}}function VU(i){const{inputs:e,backend:t}=i,{x:r}=e,s=t.texData.get(r.dataId),o=new UU(r.shape),l=[sM(r,s.complexTensorInfos.real),sM(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(o,l,l[0].dtype)}const zU={kernelName:ti,backendName:"webgl",kernelFunc:VU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class WU{constructor(e){this.outputShape=[],this.outputShape=Tc(e,1),this.variableNames=e.map((l,c)=>`T${c}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let l=1;l<t.length;l++)t[l]=t[l-1]+e[l][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let l=1;l<t.length;l++){const c=t[l-1];r.push(`else if (yC < ${t[l]}) setOutput(getT${l}(yR, yC-${c}));`)}const s=t.length,o=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HU{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Tc(e,t);const r=this.outputShape,s=r.length,o=sa(s),l=ol("coords",s),c=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((P,z)=>`T${z}`);const h=new Array(e.length-1);h[0]=e[0][t];for(let P=1;P<h.length;P++)h[P]=h[P-1]+e[P][t];const p=c[t],f=c.slice(-2),g=c.join();let v=`if (${p} < ${h[0]}) {
        return getChannel(
            getT0(${g}), vec2(${f.join()}));
        }`;for(let P=1;P<h.length;P++){const z=h[P-1];v+=`
        if (${p} < ${h[P]}  && ${p} >= ${h[P-1]}) {
          return getChannel(
            getT${P}(${zy(c,p,z)}),
            vec2(${zy(f,p,z)}));
        }`}const w=h.length,R=h[h.length-1];v+=`
        return getChannel(
          getT${w}(${zy(c,p,R)}),
          vec2(${zy(f,p,R)}));`,this.userCode=`
      float getValue(${c.map(P=>"int "+P)}) {
        ${v}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${l}), 0., 0., 0.);

        ${l[s-1]} = ${l[s-1]} + 1;
        if (${l[s-1]} < ${r[s-1]}) {
          result.g = getValue(${l});
        }

        ${l[s-2]} = ${l[s-2]} + 1;
        if (${l[s-2]} < ${r[s-2]}) {
          result.a = getValue(${l});
        }

        ${l[s-1]} = ${l[s-1]} - 1;
        if (${l[s-2]} < ${r[s-2]} &&
            ${l[s-1]} < ${r[s-1]}) {
          result.b = getValue(${l});
        }
        setOutput(result);
      }
    `}}function zy(i,e,t){const r=i.indexOf(e);return i.map((s,o)=>o===r?`${s} - ${t}`:s).join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wy(i){const{inputs:e,backend:t}=i,{input:r}=e,s=t.texData.get(r.dataId);return Ql({inputs:{x:s.complexTensorInfos.imag},backend:t})}const KU={kernelName:At,backendName:"webgl",kernelFunc:Wy};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GA(i,e,t){const r=i[0].dtype;if(r==="complex64"){const g=i.map(z=>OA({inputs:{input:z},backend:t})),v=i.map(z=>Wy({inputs:{input:z},backend:t})),w=GA(g,e,t),R=GA(v,e,t),P=tp({inputs:{real:w,imag:R},backend:t});return g.forEach(z=>t.disposeIntermediateTensorInfo(z)),v.forEach(z=>t.disposeIntermediateTensorInfo(z)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),P}let s=t.shouldExecuteOnCPU(i);if(r==="string"&&(s=!0),s){const g=i.map(X=>{const fe=[-1,b(X.shape.slice(e))];return yi({inputs:{x:X},backend:t,attrs:{shape:fe}})}),v=g.map(X=>({vals:t.readSync(X.dataId),shape:X.shape})),w=Tc(g.map(X=>X.shape),1),R=g[0].shape[0]===1,P=HG(v,w,r,R),z=Tc(i.map(X=>X.shape),e),G=t.makeTensorInfo(z,r,P);return g.forEach(X=>t.disposeIntermediateTensorInfo(X)),G}const o=Ye().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>o){const g=[];for(let w=0;w<i.length;w+=o){const R=i.slice(w,w+o);g.push(GA(R,e,t))}const v=GA(g,e,t);for(const w of g)t.disposeIntermediateTensorInfo(w);return v}if(Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1){const g=new HU(i.map(v=>v.shape),e);return t.runWebGLProgram(g,i,r)}const{tensors2D:l,outShape:c}=XU(i,e,t),h=new WU(l.map(g=>g.shape)),p=t.runWebGLProgram(h,l,r);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const f=yi({inputs:{x:p},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(p),f}function XU(i,e,t){const r=Tc(i.map(s=>s.shape),e);return{tensors2D:i.map(s=>yi({inputs:{x:s},attrs:{shape:[-1,b(s.shape.slice(e))]},backend:t})),outShape:r}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aM(i){const{inputs:e,backend:t,attrs:r}=i,{axis:s}=r,o=J(s,e[0].shape)[0],l=e.map(p=>p.shape);cc(l,o);const c=Tc(e.map(p=>p.shape),o);if(b(c)===0)return t.makeTensorInfo(c,e[0].dtype,[]);const h=e.filter(p=>b(p.shape)>0);return h.length===1?Ql({inputs:{x:h[0]},backend:t}):GA(h,o,t)}const QU={kernelName:hn,backendName:"webgl",kernelFunc:aM};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class oM{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const l=e.padInfo.top,c=e.padInfo.left,h=e.strideHeight,p=e.strideWidth,f=e.dilationHeight,g=e.dilationWidth,v=e.filterHeight,w=e.filterWidth,R=Math.floor(e.inChannels/4)*4,P=e.inChannels%4,z=e.dataFormat==="channelsLast",G=z?1:2,X=z?2:3,fe=z?3:1;let ge="",be="";r&&(s?ge=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?ge=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:ge=`
          float activation(float x) {
            ${r}
          }
        `,be="result = activation(result);");const He=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${ge}

      const ivec2 strides = ivec2(${h}, ${p});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${fe}];

        ivec2 xRCCorner =
            ivec2(coords[${G}], coords[${X}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${v}; wR++) {
          int xR = xRCorner + wR * ${f};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC++) {
            int xC = xCCorner + wC * ${g};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${R}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${z}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${P===1}) {

              if (${z}) {
                dotProd +=
                    getX(batch, xR, xC, ${R}) *
                    getW(wR, wC, ${R}, d2);
              } else {
                dotProd +=
                    getX(batch, ${R}, xR, xC) *
                    getW(wR, wC, ${R}, d2);
              }

            } else if (${P===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${R}, d2),
                getW(wR, wC, ${R} + 1, d2)
              );

              if (${z}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${R}),
                  getX(batch, xR, xC, ${R} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${R}, xR, xC),
                  getX(batch, ${R} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${P===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${R}, d2),
                getW(wR, wC, ${R} + 1, d2),
                getW(wR, wC, ${R} + 2, d2)
              );

              if (${z}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${R}),
                  getX(batch, xR, xC, ${R} + 1),
                  getX(batch, xR, xC, ${R} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${R}, xR, xC),
                  getX(batch, ${R} + 1, xR, xC),
                  getX(batch, ${R} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${He}
        ${be}
        setOutput(result);
      }
    `}}class ZU{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,o=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,p=e.dilationHeight,f=e.dilationWidth,g=e.filterDepth,v=e.filterHeight,w=e.filterWidth,R=Math.floor(e.inChannels/4)*4,P=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${l}, ${c});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${g}; wF++) {
          int xF = xFCorner + wF * ${h};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${v}; wR++) {
            int xR = xRCorner + wR * ${p};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${w}; wC++) {
              int xC = xCCorner + wC * ${f};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${R}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${P===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${R}) *
                  getW(wF, wR, wC, ${R}, d2);
              } else if (${P===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${R}),
                  getX(batch, xF, xR, xC, ${R} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${R}, d2),
                  getW(wF, wR, wC, ${R} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${P===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${R}),
                  getX(batch, xF, xR, xC, ${R} + 1),
                  getX(batch, xF, xR, xC, ${R} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${R}, d2),
                  getW(wF, wR, wC, ${R} + 1, d2),
                  getW(wF, wR, wC, ${R} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lM{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=al(this.outputShape.length);const l=e.padInfo.left,c=e.strideWidth,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,g=f;let v=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let z=0;z<f;z++)v+=`
           vec4 xTexelC${z*2};
           int xTexelC${z*2}Ready;
           vec4 xTexelC${z*2+1};
           int xTexelC${z*2+1}Ready;
           vec4 xC${z};`;v+=`
     for (int r = 0; r < ${p}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let z=0;z<f;z++)v+=`
           xTexelC${z*2} = vec4(0.0);
           xTexelC${z*2}Ready = 0;
           xTexelC${z*2+1} = vec4(0.0);
           xTexelC${z*2+1}Ready = 0;
           xC${z} = vec4(0.0);`;v+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let z=0;z<(g+1)/2;z++){const G=z*2;if(v+=`
           xC = xCCorner + ${G*h};
           `,c===1){if(G<f&&(l%2===1?(v+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G}Ready == 0) {
                   xTexelC${G} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${G}.zw = vec2(0.0);
                   }
                   xTexelC${G}Ready = 1;
                 }
               `,h===1&&G>0?v+=`
                 xC${G} = vec4(xTexelC${G-2}.zw, xTexelC${G}.xy);
                 `:v+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${G} = vec4(previous.zw, xTexelC${G}.xy);
                   } else {
                     xC${G} = vec4(0.0, 0.0, xTexelC${G}.xy);
                   }
                   `):v+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${G}Ready == 0) {
                   xTexelC${G} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${G}.zw = vec2(0.0);
                   }
                   xTexelC${G}Ready = 1;
                 }

                 xC${G} = xTexelC${G};
                 `,G+1<f)){const X=l%2===0?E(h):h;h%2===0&&l%2===1||h%2!==0&&l%2!==1?(v+=`
                   xCOffset = xC + imod(pads[1], 2) + ${X};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                     xTexelC${G+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${G+1}.zw = vec2(0.0);
                     }
                     xTexelC${G+1}Ready = 1;
                   }
                   `,h>1?v+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${G+1} = vec4(previous.zw, xTexelC${G+1}.xy);
                     } else {
                      xC${G+1} = vec4(0.0, 0.0, xTexelC${G+1}.xy);
                     }
                     `:v+=`
                     xC${G+1} = vec4(xTexelC${G}.zw, xTexelC${G+1}.xy);
                     `):X===1?v+=`
                     xC${G+1} = xTexelC${G};
                     `:v+=`
                     xCOffset = xC + ${X};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                       xTexelC${G+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${G+1}.zw = vec2(0.0);
                       }
                       xTexelC${G+1}Ready = 1;
                     }

                     xC${G+1} = xTexelC${G+1};
                     `}}else G<f&&(l%2===1?(v+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G}Ready == 0) {
                   xTexelC${G} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${G}.zw = vec2(0.0);
                   }
                   xTexelC${G}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${G+1}Ready == 0) {
                   xTexelC${G+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${G+1}.zw = vec2(0.0);
                   }
                   xTexelC${G+1}Ready = 1;
                 }

                 xC${G} = vec4(xTexelC${G}.zw, xTexelC${G+1}.zw);
               `,G+1<f&&(v+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${G+1} = vec4(xTexelC${G+1}.xy, final.xy);
                 `)):(v+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${G}Ready == 0) {
                   xTexelC${G} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${G}.zw = vec2(0.0);
                   }
                   xTexelC${G}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${G+1}Ready == 0) {
                   xTexelC${G+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${G+1}.zw = vec2(0.);
                   }
                   xTexelC${G+1}Ready = 1;
                 }

                 xC${G} = vec4(
                   xTexelC${G}.xy, xTexelC${G+1}.xy);
               `,G+1<f&&(v+=`
                   xC${G+1} = vec4(xTexelC${G}.zw, xTexelC${G+1}.zw);
                 `)));G<f&&(v+=`
             wTexel = getW(r, ${G}, d1, d2);
             dotProd += xC${G}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${G}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,G+1<f&&(v+=`
               wTexel = getW(r, ${G+1}, d1, d2);
               dotProd += xC${G+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${G+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}v+=`
     }
   `,v+=`
     }
   `,v+=`
     }
   `;let w="",R="";r&&(s?w=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:o?w=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:w=`vec4 activation(vec4 x) {
           ${r}
         }`,R="result = activation(result);");const P=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${w}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${v}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${P}
         ${R}
         setOutput(result);
       }
     `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class $U{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=al(this.outputShape.length);const{dataFormat:r}=t,s=sl(),o=r==="channelsLast",l=o?1:2,c=o?2:3,h=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let p="";for(let f=0;f<=1;f++)for(let g=0;g<=1;g++)p+=`
          blockIndex = rc.z + ${g};
          pos = rc.y + ${f};

          ${h}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${l}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${c}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${f*2+g}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${f*2+g}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${p}

        ${s.output} = result;
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hy(i,e){const t=i.length;return t>=3?e?[...i.slice(0,-3),i[t-3]*i[t-2],i[t-1]]:[...i.slice(0,-3),i[t-3],i[t-2]*i[t-1]]:!e&&t===1&&i[0]>1?[i[0],1]:null}function cM({x:i,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}){const h=i.shape,p=r.texData.get(i.dataId),f=t.inChannels,g=h[0]*h[1]*h[2],v=t.outChannels,w=t.dataFormat==="channelsLast",R=!1,P=!1;let z;const G=[];if(o!=null){const X=Hy(o.shape,w);X!=null&&(o=yi({inputs:{x:o},backend:r,attrs:{shape:X}}),G.push(o))}if(s!=null){const X=Hy(s.shape,w);X!=null&&(s=yi({inputs:{x:s},backend:r,attrs:{shape:X}}),G.push(s))}if(!((g===1||v===1)&&f>YT)&&p.isPacked&&w&&p.texture!=null&&h[2]%2!==0&&S(p.shape.slice(-3),h.slice(-3))){const X=h[0]*h[1]*(h[2]+1),fe={dataId:i.dataId,shape:[1,X,t.inChannels],dtype:i.dtype},ge=p.shape;p.shape=p.shape.slice(),p.shape[p.shape.length-2]++,C(Dy(p.shape,fe.shape),()=>`packed reshape ${p.shape} to ${fe.shape} isn't free`);const be=yi({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});G.push(be);const He=Uy({a:fe,b:be,backend:r,transposeA:R,transposeB:P,bias:s,activation:c,preluActivationWeights:o,leakyreluAlpha:l}),Je=r.texData.get(He.dataId);C(Je.isPacked,()=>"batchMatMul result is expected to be packed"),p.shape=ge,Je.shape=t.outShape,z=Ql({inputs:{x:He},backend:r}),z.shape=t.outShape,G.push(He)}else{const X=t.outHeight*t.outWidth,fe=yi({inputs:{x:i},backend:r,attrs:{shape:w?[t.batchSize,X,t.inChannels]:[t.batchSize,t.inChannels,X]}}),ge=yi({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),be=Uy({a:w?fe:ge,b:w?ge:fe,transposeA:!w,transposeB:P,backend:r,bias:s,activation:c,preluActivationWeights:o,leakyreluAlpha:l});z=yi({inputs:{x:be},backend:r,attrs:{shape:t.outShape}}),G.push(fe),G.push(ge),G.push(be)}for(const X of G)r.disposeIntermediateTensorInfo(X);return z}function uM({x:i,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}){const{filterWidth:h,filterHeight:p,inChannels:f,outWidth:g,outHeight:v,dataFormat:w}=t,R=w==="channelsLast",P=h*p*f,z=v*g,G=[t.batchSize,P,z],X=!0,fe=!1,ge=[];if(o!=null){const dn=Hy(o.shape,R);dn!=null&&(o=yi({inputs:{x:o},backend:r,attrs:{shape:dn}}),ge.push(o))}if(s!=null){const dn=Hy(s.shape,R);dn!=null&&(s=yi({inputs:{x:s},backend:r,attrs:{shape:dn}}),ge.push(s))}const be=yi({inputs:{x:e},backend:r,attrs:{shape:[1,P,b(e.shape)/P]}});ge.push(be);const He=new $U(G,t),Je=[i.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],$e=r.runWebGLProgram(He,[i],"float32",Je),rt=yi({inputs:{x:$e},backend:r,attrs:{shape:G}});ge.push($e),ge.push(rt);const pt=s!=null,Gt=o!=null,zt=c==="leakyrelu",Kt=c?FA(c,!0):null,tn=new XT(R?rt.shape:be.shape,R?be.shape:rt.shape,R?[t.batchSize,z,t.outChannels]:[t.batchSize,t.outChannels,z],X,fe,pt,Kt,Gt,zt),qt=R?[rt,be]:[be,rt];if(s&&qt.push(s),Gt&&qt.push(o),zt){const dn=r.makeTensorInfo([],"float32",Ya(l,"float32"));qt.push(dn),ge.push(dn)}const sn=r.runWebGLProgram(tn,qt,"float32"),xn=yi({inputs:{x:sn},backend:r,attrs:{shape:t.outShape}});ge.push(sn);for(const dn of ge)r.disposeIntermediateTensorInfo(dn);return xn}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jU(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f}=r,g=Du(h),v=xo(s.shape,o.shape,l,p,c,f,!1,g);let w;if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))w=cM({x:s,filter:o,convInfo:v,backend:t});else if(v.strideWidth<=2&&g==="channelsLast"&&Ye().getBool("WEBGL_EXP_CONV")){const P=new lM(v),z=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]];w=t.runWebGLProgram(P,[s,o],"float32",z)}else if(Ye().getBool("WEBGL_CONV_IM2COL"))w=uM({x:s,filter:o,convInfo:v,backend:t});else{const P=new oM(v);w=t.runWebGLProgram(P,[s,o],"float32")}const R=yi({inputs:{x:w},backend:t,attrs:{shape:v.outShape}});return t.disposeIntermediateTensorInfo(w),R}const YU={kernelName:On,backendName:"webgl",kernelFunc:jU};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class JU{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,l=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${l}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qU{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dataFormat==="channelsLast",c=t-1-e.padInfo.top,h=r-1-e.padInfo.left,p=l?1:2,f=l?2:3,g=l?3:1;this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${g}];

        ivec2 dyCorner = ivec2(coords[${p}], coords[${f}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${l}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class e6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,o=e.padInfo.front,l=e.padInfo.top,c=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${l};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${c};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class t6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,o=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=t-1-e.padInfo.front,p=r-1-e.padInfo.top,f=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${c}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function n6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,pad:c,dataFormat:h,dimRoundingMode:p,filterShape:f}=r,g=Du(h),v=xo(s.shape,f,l,1,c,p,!1,g),w=new JU(v);return t.runWebGLProgram(w,[s,o],"float32")}const i6={kernelName:Oi,backendName:"webgl",kernelFunc:n6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r6(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{inputShape:l,strides:c,pad:h,dataFormat:p,dimRoundingMode:f}=r,g=Du(p),v=xo(l,o.shape,c,1,h,f,!1,g),w=new qU(v);return t.runWebGLProgram(w,[s,o],"float32")}const s6={kernelName:Yn,backendName:"webgl",kernelFunc:r6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dilations:h}=r,p=Bh(s.shape,o.shape,l,h,c),f=new ZU(p);return t.runWebGLProgram(f,[s,o],"float32")}const o6={kernelName:Gi,backendName:"webgl",kernelFunc:a6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,pad:c,filterShape:h}=r,p=Bh(s.shape,h,l,1,c),f=new e6(p);return t.runWebGLProgram(f,[s,o],"float32")}const c6={kernelName:nr,backendName:"webgl",kernelFunc:l6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u6(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{pad:l,strides:c,inputShape:h}=r,p=Bh(h,o.shape,c,1,l),f=new t6(p);return t.runWebGLProgram(f,[s,o],"float32")}const h6={kernelName:cr,backendName:"webgl",kernelFunc:u6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const d6=fg+`
  return cos(x);
`,p6=ms({opSnippet:d6}),f6={kernelName:Xr,backendName:"webgl",kernelFunc:p6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m6=ms({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),g6={kernelName:Fr,backendName:"webgl",kernelFunc:m6};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class A6{constructor(e,t,r,s,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[l,c,h,p]=e,[f]=t,[g,v]=r;this.outputShape=[f,g,v,p];const w=s==="bilinear"?1:0,[R,P]=[`${c-1}.0`,`${h-1}.0`],[z,G,X]=g>1?[`${(c-1)/(g-1)}`,"(y2-y1) * height_ratio",`y1*${R} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${R}`],[fe,ge,be]=v>1?[`${(h-1)/(v-1)}`,"(x2-x1) * width_ratio",`x1*${P} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${P}`];this.userCode=`
      const float height_ratio = float(${z});
      const float width_ratio = float(${fe});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${l}) {
          return;
        }

        float height_scale = ${G};
        float width_scale = ${ge};

        float in_y = ${X};
        if( in_y < 0.0 || in_y > ${R} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${be};
        if( in_x < 0.0 || in_x > ${P} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${w} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v6={kernelName:vr,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{image:s,boxes:o,boxInd:l}=e,{cropSize:c,method:h,extrapolationValue:p}=r,f=new A6(s.shape,o.shape,c,h,p);return t.runWebGLProgram(f,[s,o,l],"float32")}};var UA;(function(i){i.Prod="*",i.Sum="+"})(UA||(UA={}));class hM{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,l=this.op===UA.Prod?"1.0":"0.0",c=r?l:`getX(${dM(o,"coords",this.op)})`,h=this.outputShape[this.outputShape.length-1];let p="",f="";r?(p=s?`end != ${h-1}`:"end != 0",f=s?"end + 1":"end - 1"):(p=s?`end + pow2 < ${h}`:"end >= pow2",f=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${sa(o)} coords = getOutputCoords();
        int end = ${pM(o,"coords",this.op)};
        float val = ${c};
        int pow2 = int(pow(2.0, index));
        if (${p}) {
          int idx = ${f};
          ${pM(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${dM(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function dM(i,e,t){if(i===1)return`${e}`;if(i===2)return`${e}.x, ${e}.y`;if(i===3)return`${e}.x, ${e}.y, ${e}.z`;if(i===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${i} is not yet supported`)}function pM(i,e,t){if(i===1)return`${e}`;if(i===2)return`${e}.y`;if(i===3)return`${e}.z`;if(i===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${i} is not yet supported`)}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fM(i,e,t,r,s,o){const l=e.shape.length,c=ha([r],l);let h=e;c!=null&&(h=ll({inputs:{x:e},backend:t,attrs:{perm:c}}));const p=wa(1,l)[0];if(p!==l-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const f=h.shape[p];let g=Ql({inputs:{x:h},backend:t});for(let v=0;v<=Math.ceil(Math.log2(f))-1;v++){const w=new hM(i,h.shape,!1,o),R=[[v]],P=g;g=t.runWebGLProgram(w,[g],g.dtype,R),t.disposeIntermediateTensorInfo(P)}if(s){const v=new hM(i,h.shape,s,o),w=g;g=t.runWebGLProgram(v,[g],g.dtype),t.disposeIntermediateTensorInfo(w)}if(c!=null){const v=Nu(c),w=ll({inputs:{x:g},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(h),w}return g}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,exclusive:l,reverse:c}=r;return fM(UA.Prod,s,t,o,l,c)}const b6={kernelName:$r,backendName:"webgl",kernelFunc:y6};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,exclusive:l,reverse:c}=r;return fM(UA.Sum,s,t,o,l,c)}const C6={kernelName:ws,backendName:"webgl",kernelFunc:x6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,weights:o}=e,{size:l,binaryOutput:c}=r;if(s.shape.length===1){const h=t.readSync(s.dataId),p=t.readSync(o.dataId),f=LT(h,p,o.dtype,o.shape,l);return t.makeTensorInfo([l],o.dtype,f)}else if(s.shape.length===2){const h=t.bufferSync(s),p=t.bufferSync(o),f=VG(h,p,l,c);return t.makeTensorInfo(f.shape,o.dtype,f.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const E6={kernelName:As,backendName:"webgl",kernelFunc:w6};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class I6{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockSize:o,dataFormat:l}=r,c=s.shape[0],h=l==="NHWC"?s.shape[1]:s.shape[2],p=l==="NHWC"?s.shape[2]:s.shape[3],f=l==="NHWC"?s.shape[3]:s.shape[1],g=h*o,v=p*o,w=f/(o*o),R=l==="NHWC"?[c,g,v,w]:[c,w,g,v],P=new I6(R,o,l);return t.runWebGLProgram(P,[s],s.dtype)}const T6={kernelName:vs,backendName:"webgl",kernelFunc:S6};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mM{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=al(this.outputShape.length);const l=e.filterHeight,c=e.filterWidth,h=e.outChannels/e.inChannels;let p="",f="";r&&(s?p=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?p=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`
          float activation(float x) {
            ${r}
          }
        `,f="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${h};
        int q = d2 - d1 * ${h};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${l}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${c}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${g}
        ${f}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gM{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=al(this.outputShape.length);const l=e.outChannels/e.inChannels,c=e.padInfo.left,h=e.strideWidth,p=e.dilationWidth,f=e.filterHeight,g=e.filterWidth,v=g;let w=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let G=0;G<g;G++)w+=`
          vec4 xTexelC${G*2};
          int xTexelC${G*2}Ready;
          vec4 xTexelC${G*2+1};
          int xTexelC${G*2+1}Ready;
          vec4 xC${G};`;w+=`
    for (int r = 0; r < ${f}; r++) {
      `;for(let G=0;G<g;G++)w+=`
          xTexelC${G*2} = vec4(0.0);
          xTexelC${G*2}Ready = 0;
          xTexelC${G*2+1} = vec4(0.0);
          xTexelC${G*2+1}Ready = 0;
          xC${G} = vec4(0.0);`;w+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let G=0;G<(v+1)/2;G++){const X=G*2;if(w+=`
          xC = xCCorner + ${X*p};
          `,h===1){if(X<g&&(c%2===1?(w+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }
              `,p===1&&X>0?w+=`
                xC${X} = vec4(xTexelC${X-2}.zw, xTexelC${X}.xy);
                `:w+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${X} = vec4(previous.zw, xTexelC${X}.xy);
                  } else {
                    xC${X} = vec4(0.0, 0.0, xTexelC${X}.xy);
                  }
                  `):w+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                xC${X} = xTexelC${X};
                `,X+1<g)){const fe=c%2===0?E(p):p;p%2===0&&c%2===1||p%2!==0&&c%2!==1?(w+=`
                  xCOffset = xC + imod(pads[1], 2) + ${fe};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                    xTexelC${X+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${X+1}.zw = vec2(0.0);
                    }
                    xTexelC${X+1}Ready = 1;
                  }
                  `,p>1?w+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${X+1} = vec4(previous.zw, xTexelC${X+1}.xy);
                    } else {
                     xC${X+1} = vec4(0.0, 0.0, xTexelC${X+1}.xy);
                    }
                    `:w+=`
                    xC${X+1} = vec4(xTexelC${X}.zw, xTexelC${X+1}.xy);
                    `):fe===1?w+=`
                    xC${X+1} = xTexelC${X};
                    `:w+=`
                    xCOffset = xC + ${fe};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                      xTexelC${X+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${X+1}.zw = vec2(0.0);
                      }
                      xTexelC${X+1}Ready = 1;
                    }

                    xC${X+1} = xTexelC${X+1};
                    `}}else X<g&&(c%2===1?(w+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${X+1}Ready == 0) {
                  xTexelC${X+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${X+1}.zw = vec2(0.0);
                  }
                  xTexelC${X+1}Ready = 1;
                }

                xC${X} = vec4(xTexelC${X}.zw, xTexelC${X+1}.zw);
              `,X+1<g&&(w+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${X+1} = vec4(xTexelC${X+1}.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                  xTexelC${X+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X+1}.zw = vec2(0.);
                  }
                  xTexelC${X+1}Ready = 1;
                }

                xC${X} = vec4(
                  xTexelC${X}.xy, xTexelC${X+1}.xy);
              `,X+1<g&&(w+=`
                  xC${X+1} = vec4(xTexelC${X}.zw, xTexelC${X+1}.zw);
                `)));X<g&&(w+=`
            wTexel = getW(r, ${X}, d1, q);
            dotProd += xC${X} * vec4(wTexel.xz, wTexel.xz);
          `,X+1<g&&(w+=`
              wTexel = getW(r, ${X+1}, d1, q);
              dotProd += xC${X+1} * vec4(wTexel.xz, wTexel.xz);
            `))}w+=`
    }
  `,w+=`
      }
    `;let R="",P="";r&&(s?R=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?R=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:R=`vec4 activation(vec4 x) {
          ${r}
        }`,P="result = activation(result);");const z=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${R}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${w}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${z}
        ${P}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:p}=r;let f=h;f==null&&(f=[1,1]),C(Bo(l,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const g=xo(s.shape,o.shape,l,f,c,p,!0);let v;Ye().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1?v=new gM(g):v=new mM(g);const w=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]];return t.runWebGLProgram(v,[s,o],"float32",w)}const _6={kernelName:Ge,backendName:"webgl",kernelFunc:M6};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class R6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${l} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class B6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=t-1-e.padInfo.top,c=r-1-e.padInfo.left,h=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${h}; dm++) {
              int d2 = d1 * ${h} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,dy:o}=e,{strides:l,dilations:c,pad:h,dimRoundingMode:p,filterShape:f}=r,g=xo(s.shape,f,l,c,h,p,!0),v=new R6(g);return t.runWebGLProgram(v,[s,o],"float32")}const L6={kernelName:st,backendName:"webgl",kernelFunc:k6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D6(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,filter:o}=e,{strides:l,dilations:c,pad:h,dimRoundingMode:p,inputShape:f}=r,g=xo(f,o.shape,l,c,h,p,!0),v=new B6(g);return t.runWebGLProgram(v,[s,o],"float32")}const N6={kernelName:wt,backendName:"webgl",kernelFunc:D6};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class F6{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P6(i){const{inputs:e,backend:t}=i,{x:r}=e,s=[...r.shape,...r.shape],o=b(r.shape),l=yi({inputs:{x:r},backend:t,attrs:{shape:[o]}}),c=new F6(o),h=t.runWebGLProgram(c,[l],l.dtype),p=yi({inputs:{x:h},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),p}const O6={kernelName:en,backendName:"webgl",kernelFunc:P6};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class G6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:o,strideWidth:l,filterHeight:c,filterWidth:h,dilationHeight:p,dilationWidth:f}=e,{top:g,left:v}=s;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${l});
      const ivec2 pads = ivec2(${g}, ${v});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${c}; h++) {
          int hIn = hBeg + h * ${p};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${h}; w++) {
              int wIn = wBeg + w * ${f};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U6(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o}=e,{strides:l,pad:c,dilations:h}=r,p=Wf(s.shape,o.shape,l,c,"NHWC",h);let f;const g=new G6(p);f=t.runWebGLProgram(g,[s,o],"float32");const v=yi({inputs:{x:f},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(f),v}const V6={kernelName:Xt,backendName:"webgl",kernelFunc:U6};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z6(i){const{inputs:e,backend:t,attrs:r}=i,{equation:s}=r,o=e,{allDims:l,summedDims:c,idDims:h}=Qd(s,o.length);nA(l.length,h,o);const{path:p,steps:f}=iA(c,h),g=f.length;let v=null,w=l.length;const R=[];for(let P=0;P<g;++P){for(const z of f[P]){const{permutationIndices:G,expandDims:X}=jp(w,h[z]);let fe;rA(G)?fe=o[z]:(fe=ll({inputs:{x:o[z]},backend:t,attrs:{perm:G}}),R.push(fe));const ge=fe.shape.slice();for(let be=0;be<X.length;++be)ge.splice(X[be],0,1);S(fe.shape,ge)||(fe=yi({inputs:{x:fe},backend:t,attrs:{shape:ge}}),R.push(fe)),v===null?v=fe:(v=iE({inputs:{a:fe,b:v},backend:t}),R.push(v))}P<g-1&&(p[P]>=0&&(v=Gy({inputs:{x:v},backend:t,attrs:{axis:p[P]-(l.length-w),keepDims:!1}}),R.push(v)),w--)}for(const P of R)P!==v&&t.disposeIntermediateTensorInfo(P);return v}const W6={kernelName:vi,backendName:"webgl",kernelFunc:z6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const H6=ms({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),K6={kernelName:An,backendName:"webgl",kernelFunc:H6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X6="return (b >= 1.0) ? a : a * (b + 1.0);",Q6=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Z6={kernelName:Ui,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t}=i,{dy:r,y:s}=e,o=Ye().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new NA(Q6,r.shape,s.shape):new pg(X6,r.shape,s.shape);return t.runWebGLProgram(o,[r,s],r.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $6=No({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:KG}),j6={kernelName:ir,backendName:"webgl",kernelFunc:$6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y6=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Xp};
  float a1 = ${$0};
  float a2 = ${Lm};
  float a3 = ${j0};
  float a4 = ${Dm};
  float a5 = ${Nm};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,J6=ms({opSnippet:Y6}),q6={kernelName:Hi,backendName:"webgl",kernelFunc:J6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eV=fg+`
  return exp(x);
`,AM=ms({opSnippet:eV,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:XG,dtype:"float32"}),tV={kernelName:us,backendName:"webgl",kernelFunc:AM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oE(i){const{inputs:e,attrs:t,backend:r}=i,{dim:s}=t,{input:o}=e,l=o.shape.length,c=o.shape.slice();let h=s;return s<0&&(C(-(l+1)<=s,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),h=l+s+1),c.splice(h,0,1),yi({inputs:{x:o},backend:r,attrs:{shape:c}})}const nV={kernelName:Tr,backendName:"webgl",kernelFunc:oE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vM="return exp(x) - 1.0;",iV=ms({opSnippet:vM,packedOpSnippet:vM,cpuKernelImpl:QG}),rV={kernelName:pr,backendName:"webgl",kernelFunc:iV};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class yM{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const o=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,l=r?`${s}.0`:"1.0";let c;if(e==="real")c="return real * expR - imag * expI;";else if(e==="imag")c="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${c}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${l};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bM(i,e,t){const r=t.texData.get(i.dataId),s=b(i.shape),o=i.shape[i.shape.length-1],l=s/o,c=yi({inputs:{x:i},backend:t,attrs:{shape:[l,o]}}),h=c.shape,p=new yM("real",h,e),f=new yM("imag",h,e),g=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:h},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:h}],v=t.runWebGLProgram(p,g,"float32"),w=t.runWebGLProgram(f,g,"float32"),R=tp({inputs:{real:v,imag:w},backend:t});t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w);const P=yi({inputs:{x:R},backend:t,attrs:{shape:i.shape}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(R),P}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sV(i){const{inputs:e,backend:t}=i,{input:r}=e;return bM(r,!1,t)}const aV={kernelName:Pr,backendName:"webgl",kernelFunc:sV};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class oV{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VA(i){const{backend:e,attrs:t}=i,{shape:r,value:s}=t;let{dtype:o}=t;if(o=o||he(s),o==="string"){const l=U(o,b(r));return l.fill(s),e.makeTensorInfo(r,o,l)}else{const l=new oV(r,s),c=[[s]];return e.runWebGLProgram(l,[],o,c)}}const lV={kernelName:Rs,backendName:"webgl",kernelFunc:VA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class cV{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uV={kernelName:fa,backendName:"webgl",kernelFunc:({inputs:i,backend:e})=>{const{image:t}=i,r=e,s=new cV(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xM="return floor(x);",hV=ms({opSnippet:xM,packedOpSnippet:xM,cpuKernelImpl:ZG}),dV={kernelName:di,backendName:"webgl",kernelFunc:hV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pV=No({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),fV={kernelName:Cr,backendName:"webgl",kernelFunc:pV};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mV{constructor(e){this.variableNames=["A"];const t=sl(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gV{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=sl(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AV={kernelName:Su,backendName:"webgl",kernelFunc:vV};let gg,lE=Ye().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function vV(i){const{inputs:e,backend:t,attrs:r}=i;let{pixels:s}=e;const{numChannels:o}=r,l=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,c=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[h,p]=l?[s.videoWidth,s.videoHeight]:[s.width,s.height],f=[p,h],g=[p,h,o];if(c||l){const P=Ye().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(gg==null||P!==lE)&&(lE=P,gg=document.createElement("canvas").getContext("2d",{willReadFrequently:lE})),gg.canvas.width=h,gg.canvas.height=p,gg.drawImage(s,0,0,h,p),s=gg.canvas}const v=t.makeTensorInfo(f,"int32");t.texData.get(v.dataId).usage=hc.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(v.dataId),s);const w=Ye().getBool("WEBGL_PACK")?new gV(g):new mV(g),R=t.runWebGLProgram(w,[v],"int32");return t.disposeData(v.dataId),R}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yV(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o,bias:l,preluActivationWeights:c}=e,{strides:h,pad:p,dataFormat:f,dilations:g,dimRoundingMode:v,activation:w,leakyreluAlpha:R}=r,P=Du(f),z=xo(s.shape,o.shape,h,g,p,v,!1,P);let G;const X=[],fe=l!=null,ge=c!=null,be=w==="leakyrelu",He=()=>{const $e=[s,o],rt=(pt,Gt)=>{if(Gt==="NCHW"&&pt.shape.length===1&&pt.shape[0]!==1){const zt=yi({inputs:{x:pt},backend:t,attrs:{shape:[pt.shape[0],1,1]}});return X.push(zt),zt}return pt};if(fe&&$e.push(rt(l,f)),ge&&$e.push(rt(c,f)),be){const pt=t.makeTensorInfo([],"float32",Ya(R,"float32"));$e.push(pt),X.push(pt)}return $e};if(z.filterHeight===1&&z.filterWidth===1&&z.dilationHeight===1&&z.dilationWidth===1&&z.strideHeight===1&&z.strideWidth===1&&(z.padInfo.type==="SAME"||z.padInfo.type==="VALID"))G=cM({x:s,filter:o,convInfo:z,backend:t,bias:l,activation:w,preluActivationWeights:c,leakyreluAlpha:R});else if(z.strideWidth<=2&&P==="channelsLast"&&Ye().getBool("WEBGL_EXP_CONV")){const $e=w?FA(w,!0):null,rt=new lM(z,fe,$e,ge,be),pt=[[z.padInfo.top,z.padInfo.left],[z.strideHeight,z.strideWidth],[z.dilationHeight,z.dilationWidth],[z.inHeight,z.inWidth]],Gt=He();G=t.runWebGLProgram(rt,Gt,"float32",pt)}else if(Ye().getBool("WEBGL_CONV_IM2COL"))G=uM({x:s,filter:o,convInfo:z,backend:t,bias:l,activation:w,preluActivationWeights:c,leakyreluAlpha:R});else{const $e=w?FA(w,!1):null,rt=new oM(z,fe,$e,ge,be),pt=He();G=t.runWebGLProgram(rt,pt,"float32")}const Je=yi({inputs:{x:G},backend:t,attrs:{shape:z.outShape}});return X.push(G),X.forEach($e=>t.disposeIntermediateTensorInfo($e)),Je}const bV={kernelName:Tu,backendName:"webgl",kernelFunc:yV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xV(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,filter:o,bias:l,preluActivationWeights:c}=e,{strides:h,pad:p,dilations:f,dimRoundingMode:g,activation:v,leakyreluAlpha:w}=r,R=[];let P=f;P==null&&(P=[1,1]),C(Bo(h,P),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${h} and dilations '${P}'`);const z=xo(s.shape,o.shape,h,P,p,g,!0),G=Ye().getBool("WEBGL_PACK_DEPTHWISECONV")&&z.strideWidth<=2&&z.outChannels/z.inChannels===1,X=v?FA(v,G):null,fe=[s,o],ge=l!=null,be=c!=null,He=v==="leakyrelu";if(ge&&fe.push(l),be&&fe.push(c),He){const pt=t.makeTensorInfo([],"float32",Ya(w,"float32"));fe.push(pt),R.push(pt)}let Je;G?Je=new gM(z,ge,X,be,He):Je=new mM(z,ge,X,be,He);const $e=[[z.padInfo.top,z.padInfo.left],[z.strideHeight,z.strideWidth],[z.dilationHeight,z.dilationWidth],[z.inHeight,z.inWidth]],rt=t.runWebGLProgram(Je,fe,"float32",$e);return R.forEach(pt=>t.disposeIntermediateTensorInfo(pt)),rt}const CV={kernelName:gc,backendName:"webgl",kernelFunc:xV};class wV{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const o=sa(r.length);let l=`
    int index;`;for(let c=0;c<this.sliceDim;c++)l+=`
          index = round(getIndices(coords[0], ${c}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[c]};
          flattenIndex += index * ${this.strides[c]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${l}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EV(i){const{inputs:e,backend:t}=i,{params:r,indices:s}=e,o=s.shape,l=o[o.length-1],c=b(r.shape),[h,p,f,g]=Kg(r,s),v=yi({inputs:{x:s},backend:t,attrs:{shape:[p,l]}}),w=yi({inputs:{x:r},backend:t,attrs:{shape:[b(r.shape)/f,f]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const G=t.readSync(s.dataId),X=t.bufferSync(r),fe=$G(G,X,r.dtype,p,l,f,g,r.shape,c);return t.makeTensorInfo(h,r.dtype,fe.values)}const R=new wV(l,g,[p,f],r.shape),P=t.runWebGLProgram(R,[w,v],w.dtype),z=yi({inputs:{x:P},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(P),z}const IV={kernelName:ie,backendName:"webgl",kernelFunc:EV};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class SV{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=sa(this.rank),s=TV(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function TV(i,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<i.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CM(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,indices:o}=e,{axis:l,batchDims:c}=r,h=J(l,s.shape)[0];if(Ye().get("DEBUG")){const X=t.readSync(o.dataId),fe=s.shape[h];for(let ge=0;ge<X.length;++ge){const be=X[ge];C(be<=fe-1&&be>=0,()=>`GatherV2: the index value ${be} is not in [0, ${fe-1}]`)}}const p=oA(s,o,h,c),f=b(o.shape),g=[],v=yi({inputs:{x:s},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),w=yi({inputs:{x:o},backend:t,attrs:{shape:[p.batchSize,f/p.batchSize]}});g.push(v),g.push(w);const R=[p.batchSize,p.outerSize,f/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([s,o])||s.dtype==="string"){const X=t.bufferSync(w),fe=t.bufferSync(v),ge=jG(fe,X,R);return g.forEach(be=>t.disposeIntermediateTensorInfo(be)),t.makeTensorInfo(p.outputShape,ge.dtype,ge.values)}const P=new SV(v.shape,R),z=t.runWebGLProgram(P,[v,w],v.dtype);g.push(z);const G=yi({inputs:{x:z},backend:t,attrs:{shape:p.outputShape}});return g.forEach(X=>t.disposeIntermediateTensorInfo(X)),G}const MV={kernelName:zr,backendName:"webgl",kernelFunc:CM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _V=No({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:YG,dtype:"bool"}),RV={kernelName:ce,backendName:"webgl",kernelFunc:_V};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BV=No({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:JG}),kV={kernelName:Ce,backendName:"webgl",kernelFunc:BV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LV(i){const{inputs:e,backend:t}=i,{input:r}=e;return bM(r,!0,t)}const DV={kernelName:Xe,backendName:"webgl",kernelFunc:LV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NV=ms({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),FV={kernelName:It,backendName:"webgl",kernelFunc:NV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PV=ms({opSnippet:"return float(isinf(x));",dtype:"bool"}),OV={kernelName:Sn,backendName:"webgl",kernelFunc:PV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GV=ms({opSnippet:"return float(isnan(x));",dtype:"bool"}),UV={kernelName:vn,backendName:"webgl",kernelFunc:GV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VV=No({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:qG,dtype:"bool"}),zV={kernelName:rn,backendName:"webgl",kernelFunc:VV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WV=No({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:e9,dtype:"bool"}),HV={kernelName:Bn,backendName:"webgl",kernelFunc:WV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KV(i){const{backend:e,attrs:t}=i,{start:r,stop:s,num:o}=t,l=t9(r,s,o);return e.makeTensorInfo([l.length],"float32",l)}const XV={kernelName:fi,backendName:"webgl",kernelFunc:KV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QV=fg+`
  return x < 0.0 ? 0./0. : log(x);
`,ZV=ms({opSnippet:QV,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:n9}),$V={kernelName:Ii,backendName:"webgl",kernelFunc:ZV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jV=fg+`
  return log(1.0 + x);
`,YV=ms({opSnippet:jV}),JV={kernelName:Vi,backendName:"webgl",kernelFunc:YV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qV=No({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),ez={kernelName:br,backendName:"webgl",kernelFunc:qV};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tz=ms({opSnippet:"return float(!(x >= 1.0));"}),nz={kernelName:ur,backendName:"webgl",kernelFunc:tz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iz=No({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),rz={kernelName:er,backendName:"webgl",kernelFunc:iz};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sz{constructor(e,t,r,s,o){this.variableNames=["x"],this.outputShape=[];const l=t,c=e[3]-1;this.outputShape=e;let h;const p=`float(${r}) + float(${s}) * sum`;o===.5?h=`inversesqrt(${p})`:o===1?h=`1.0/(${p})`:h=`exp(log(${p}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${l}; j <= ${l}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${c}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${h};
        setOutput(val);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class az{constructor(e,t,r,s,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const l=t,c=e[3]-1;this.outputShape=e;let h;const p=`float(${r}) + float(${s}) * sum`;o===.5?h=`inversesqrt(${p})`:o===1?h=`1.0/(${p})`:h=`exp(log(${p}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${l};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${l}; j <= ${l}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${c}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${h};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oz={kernelName:Qr,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{depthRadius:o,bias:l,alpha:c,beta:h}=r,p=Ye().getBool("WEBGL_PACK_NORMALIZATION")?new az(s.shape,o,l,c,h):new sz(s.shape,o,l,c,h);return t.runWebGLProgram(p,[s],s.dtype)}};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lz{constructor(e,t,r,s,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${o})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cz={kernelName:gr,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{x:s,y:o,dy:l}=e,{depthRadius:c,bias:h,alpha:p,beta:f}=r,g=new lz(s.shape,c,h,p,f);return t.runWebGLProgram(g,[s,o,l],s.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uz(i,e,t,r){const s=b(e),o=b(i.shape)/s,l=yi({inputs:{x:i},attrs:{shape:[o,s]},backend:r}),c=hf(l,i.dtype,"max",r),h=yi({inputs:{x:c},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(c),h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wM(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{reductionIndices:o,keepDims:l}=r,c=s.shape.length,h=J(o,s.shape);let p=h;const f=ha(p,c),g=f!=null,v=t.shouldExecuteOnCPU([s]);let w=s;if(g){if(v){const X=t.texData.get(w.dataId).values,fe=new Array(c);for(let He=0;He<fe.length;He++)fe[He]=s.shape[f[He]];const ge=eE(X,s.shape,s.dtype,f,fe);w=t.makeTensorInfo(fe,s.dtype);const be=t.texData.get(w.dataId);be.values=ge}else w=Oy(s,f,t);p=wa(p.length,c)}co("max",p,c);const[R,P]=Xa(w.shape,p);let z=R;l&&(z=Da(R,h));let G;if(v){const X=t.texData.get(w.dataId).values,fe=i9(X,b(P),z,s.dtype);G=t.makeTensorInfo(z,s.dtype);const ge=t.texData.get(G.dataId);ge.values=fe}else G=uz(w,P,z,t);return g&&t.disposeIntermediateTensorInfo(w),G}const hz={kernelName:Is,backendName:"webgl",kernelFunc:wM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dz=nE+`
  return max(a, b);
`,pz=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+DA+`
  return result;
`,fz=No({opSnippet:dz,packedOpSnippet:pz,cpuKernelImpl:r9}),mz={kernelName:Ys,backendName:"webgl",kernelFunc:fz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gz(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e;BA(s,"maxPool");const{filterSize:o,strides:l,pad:c,dimRoundingMode:h}=r,p=1;C(Bo(l,p),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const f=ac(s.shape,o,l,p,c,h);if(f.filterWidth===1&&f.filterHeight===1&&S(f.inShape,f.outShape))return Ql({inputs:{x:s},backend:t});const g=new PA(f,"max",!1);return t.runWebGLProgram(g,[s],s.dtype)}const Az={kernelName:Ps,backendName:"webgl",kernelFunc:gz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vz(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{filterSize:o,strides:l,pad:c,dataFormat:h,dimRoundingMode:p}=r,f=[1,1,1],g=Lu(s.shape,o,l,f,c,p,h),v=new rE(g,"max",!1);return t.runWebGLProgram(v,[s],s.dtype)}const yz={kernelName:Va,backendName:"webgl",kernelFunc:vz};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bz{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.top,h=l-1-e.padInfo.left,p=o*l-1;this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${p} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${l} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class xz{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=h-1-e.padInfo.front,v=p-1-e.padInfo.top,w=f-1-e.padInfo.left,R=h*p*f-1;this.userCode=`
      const ivec3 pads = ivec3(${g}, ${v}, ${w});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${R} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${p} * ${f} +
                  wR * ${f} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cz(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o}=e,l=o,{filterSize:c,strides:h,pad:p,dimRoundingMode:f}=r,g=[1,1,1],v=Lu(l.shape,c,h,g,p,f),w=new rE(v,"max",!0),R=t.runWebGLProgram(w,[l],l.dtype),P=new xz(v),z=t.runWebGLProgram(P,[s,R],l.dtype);return t.disposeIntermediateTensorInfo(R),z}const wz={kernelName:Bs,backendName:"webgl",kernelFunc:Cz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ez(i){const{inputs:e,backend:t,attrs:r}=i,{dy:s,input:o,output:l}=e,c=o;BA([o,l],"maxPoolGrad");const{filterSize:h,strides:p,pad:f,dimRoundingMode:g}=r,v=ac(c.shape,h,p,1,f,g),w=!0,R=new PA(v,"max",w),P=t.runWebGLProgram(R,[c],c.dtype),z=new bz(v),G=t.runWebGLProgram(z,[s,P],c.dtype);return t.disposeIntermediateTensorInfo(P),G}const Iz={kernelName:Ua,backendName:"webgl",kernelFunc:Ez};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sz(i,e,t,r){let s=new PA(t,"max",!1);const o=r.runWebGLProgram(s,[i],"float32");s=new PA(t,"max",!0,!0,e);const l=r.runWebGLProgram(s,[i],"float32");return[o,l]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Tz={kernelName:no,backendName:"webgl",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{x:r}=i,{filterSize:s,strides:o,pad:l,includeBatchInIndex:c}=e,h=t;C(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const p=[1,1];C(Bo(o,p),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const f=ac(r.shape,s,o,p,l),[g,v]=Sz(r,c,f,h);return[g,v]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mz(i,e,t,r){const s=b(e),o=b(i.shape)/s,l=yi({inputs:{x:i},attrs:{shape:[o,s]},backend:r}),c=hf(l,"float32","mean",r),h=yi({inputs:{x:c},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(c),h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _z={kernelName:Tl,backendName:"webgl",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{x:r}=i,{keepDims:s,axis:o}=e,l=t,c=r.shape.length,h=J(o,r.shape);let p=h;const f=ha(p,c),g=f!=null,v=l.shouldExecuteOnCPU([r]),w=[];let R=r;if(g){if(v){const fe=l.texData.get(R.dataId).values,ge=new Array(c);for(let Je=0;Je<ge.length;Je++)ge[Je]=r.shape[f[Je]];const be=eE(fe,r.shape,r.dtype,f,ge);R=l.makeTensorInfo(ge,r.dtype);const He=l.texData.get(R.dataId);He.values=be}else R=Oy(r,f,l);w.push(R),p=wa(p.length,c)}co("sum",p,c);const[P,z]=Xa(R.shape,p);let G=P;s&&(G=Da(P,h));const X=Mz(R,z,G,l);for(const fe of w)l.disposeIntermediateTensorInfo(fe);return X}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rz(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r,c=s.shape.length,h=J(o,s.shape);let p=h;const f=ha(p,c);let g=s;f!=null&&(g=ll({inputs:{x:s},backend:t,attrs:{perm:f}}),p=wa(p.length,s.shape.length)),co("min",p,c);const[v,w]=Xa(g.shape,p),R=b(w),P=yi({inputs:{x:g},backend:t,attrs:{shape:[-1,R]}}),z=hf(P,P.dtype,"min",t);let G;if(l){const X=Da(v,h);G=yi({inputs:{x:z},backend:t,attrs:{shape:X}})}else G=yi({inputs:{x:z},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(P),t.disposeIntermediateTensorInfo(z),f!=null&&t.disposeIntermediateTensorInfo(g),G}const Bz={kernelName:Fo,backendName:"webgl",kernelFunc:Rz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kz=nE+`
  return min(a, b);
`,Lz=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+DA+`
  return result;
`,Dz=No({opSnippet:kz,packedOpSnippet:Lz,cpuKernelImpl:s9}),Nz={kernelName:dl,backendName:"webgl",kernelFunc:Dz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Fz{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((f,g)=>f[0]+e[g]+f[1]);const s=e.length,o=sa(s),l=t.map(f=>f[0]).join(","),c=t.map((f,g)=>f[0]+e[g]).join(","),h=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),p=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${l};
        int end = ${c};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${p};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${p};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${l});
      ${o} end = ${o}(${c});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${p};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${p};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${h}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Pz{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((R,P)=>R[0]+e[P]+R[1]);const s=e.length,o=sa(s),l=t.map(R=>R[0]).join(","),c=t.map((R,P)=>R[0]+e[P]).join(","),h=ol("rc",s),p=ol("source",s),f=`${h[s-1]} < ${this.outputShape[s-1]}`,g=s===1?"source":`vec2(${p.slice(-2).join()})`,v=r==="reflect"?0:1;let w="";if(s===1){const R=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${v};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${v};
        }
        source -= start;
      `;w=`
        ${o} rc = outputLoc;
        ${R}
        result[0] = getChannel(getX(${p.join()}), ${g});
        ${h[s-1]} += 1;
        if(${f}) {
          ${R}
          result[1] = getChannel(getX(${p.join()}), ${g});
        }
      `}else{const R=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${v}) +
                gte * ((end - 1) * 2 - source + ${v});
        source -= start;
      `;w=`
        ${o} rc = outputLoc;
        ${R}
        result[0] = getChannel(getX(${p.join()}), ${g});
        ${h[s-1]} += 1;
        if(${f}) {
          ${R}
          result[1] = getChannel(getX(${p.join()}), ${g});
        }
        rc = outputLoc;
        ${h[s-2]} += 1;
        if(${h[s-2]} < ${this.outputShape[s-2]}) {
          ${R}
          result[2] = getChannel(getX(${p.join()}), ${g});
          ${h[s-1]} += 1;
          if(${f}) {
            ${R}
            result[3] = getChannel(getX(${p.join()}), ${g});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${l});
      const ${o} end = ${o}(${c});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${w}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Oz={kernelName:Ml,backendName:"webgl",kernelFunc:({inputs:i,backend:e,attrs:t})=>{const{x:r}=i,{paddings:s,mode:o}=t,l=Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pz(r.shape,s,o):new Fz(r.shape,s,o);return e.runWebGLProgram(l,[r],r.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gz=`if (b == 0.0) return NAN;
  return mod(a, b);`,Uz=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+DA+`
  return result;
`,Vz=No({opSnippet:Gz,packedOpSnippet:Uz}),zz={kernelName:pl,backendName:"webgl",kernelFunc:Vz};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Wz{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EM=No({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),Hz={kernelName:Ci,backendName:"webgl",kernelFunc:EM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IM="return a - b;",SM=No({opSnippet:IM,packedOpSnippet:IM,supportsComplex:!0,cpuKernelImpl:E9}),Kz={kernelName:vh,backendName:"webgl",kernelFunc:SM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TM(i){const{inputs:e,backend:t,attrs:r}=i,{logits:s}=e,{dim:o}=r,l=J([o],s.shape),c=wM({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=Da(c.shape,l),p=yi({inputs:{x:c},backend:t,attrs:{shape:h}}),f=SM({inputs:{a:s,b:p},backend:t}),g=AM({inputs:{x:f},backend:t}),v=Gy({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),w=yi({inputs:{x:v},backend:t,attrs:{shape:h}}),R=EM({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),R}const Xz={kernelName:fd,backendName:"webgl",kernelFunc:TM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qz(i){const{inputs:e,backend:t,attrs:r}=i,{logits:s}=e,{numSamples:o,seed:l,normalized:c}=r,h=c?s:TM({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),p=h.shape[0],f=h.shape[1],g=new Wz(p,f,o),v=[[l]],w=t.runWebGLProgram(g,[h],"int32",v);return c||t.disposeIntermediateTensorInfo(h),w}const Zz={kernelName:fc,backendName:"webgl",kernelFunc:Qz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $z=Nc+`
  return -x;
`,jz=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Yz(i){const{inputs:e,backend:t}=i,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId),[l,c]=o9(o.values,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,l)}let s;return Ye().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new uf(r.shape,jz):s=new Jh(r.shape,$z),t.runWebGLProgram(s,[r],r.dtype)}const Jz={kernelName:_l,backendName:"webgl",kernelFunc:Yz};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qz=Gh;function eW(i){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h}=r,p=t.readSync(s.dataId),f=t.readSync(o.dataId),{selectedIndices:g}=qz(p,f,l,c,h);return t.makeTensorInfo([g.length],"int32",new Int32Array(g))}const tW={kernelName:$l,backendName:"webgl",kernelFunc:eW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nW=Uh;function iW(i){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:p}=r,f=t.readSync(s.dataId),g=t.readSync(o.dataId),{selectedIndices:v,validOutputs:w}=nW(f,g,l,c,h,p);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([],"int32",new Int32Array([w]))]}const rW={kernelName:jl,backendName:"webgl",kernelFunc:iW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sW=Vh;function aW(i){Ao("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=i,{boxes:s,scores:o}=e,{maxOutputSize:l,iouThreshold:c,scoreThreshold:h,softNmsSigma:p}=r,f=t.readSync(s.dataId),g=t.readSync(o.dataId),v=l,w=c,R=h,P=p,{selectedIndices:z,selectedScores:G}=sW(f,g,v,w,R,P);return[t.makeTensorInfo([z.length],"int32",new Int32Array(z)),t.makeTensorInfo([G.length],"float32",new Float32Array(G))]}const oW={kernelName:Js,backendName:"webgl",kernelFunc:aW};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lW{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cW={kernelName:rd,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{indices:s}=e,{dtype:o,depth:l,onValue:c,offValue:h}=r,p=b(s.shape),f=new lW(p,l,c,h),g=yi({inputs:{x:s},backend:t,attrs:{shape:[p]}}),v=t.runWebGLProgram(f,[g],o);t.disposeIntermediateTensorInfo(g);const w=[...s.shape,l],R=yi({inputs:{x:v},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(v),R}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ky(i){const{inputs:e,backend:t}=i,{x:r}=e;if(r.dtype==="complex64"){const s=OA({inputs:{input:r},backend:t}),o=Ky({inputs:{x:s},backend:t}),l=Wy({inputs:{input:r},backend:t}),c=Ky({inputs:{x:l},backend:t}),h=tp({inputs:{real:o,imag:c},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),h}else return VA({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const uW={kernelName:Gc,backendName:"webgl",kernelFunc:Ky};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MM(i){const{inputs:e,backend:t}=i,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=OA({inputs:{input:r},backend:t}),o=MM({inputs:{x:s},backend:t}),l=Wy({inputs:{input:r},backend:t}),c=Ky({inputs:{x:l},backend:t}),h=tp({inputs:{real:o,imag:c},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),h}else return VA({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const hW={kernelName:id,backendName:"webgl",kernelFunc:MM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dW(i){const{inputs:e,backend:t,attrs:r}=i,{axis:s}=r;if(e.length===1)return oE({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const o=e[0].shape,l=e[0].dtype;e.forEach(f=>{F(o,f.shape,"All tensors passed to stack must have matching shapes"),C(l===f.dtype,()=>"All tensors passed to stack must have matching dtypes")});const c=[],h=e.map(f=>{const g=oE({inputs:{input:f},backend:t,attrs:{dim:s}});return c.push(g),g}),p=aM({inputs:h,backend:t,attrs:{axis:s}});return c.forEach(f=>t.disposeIntermediateTensorInfo(f)),p}const pW={kernelName:sd,backendName:"webgl",kernelFunc:dW};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fW{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((p,f)=>p[0]+e[f]+p[1]);const s=e.length,o=sa(s),l=t.map(p=>p[0]).join(","),c=t.map((p,f)=>p[0]+e[f]).join(","),h=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${l};
        int end = ${c};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${l});
      ${o} end = ${o}(${c});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${h}));
        }
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mW{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((P,z)=>P[0]+e[z]+P[1]);const s=e.length,o=sa(s),l=t.map(P=>P[0]).join(","),c=t.map((P,z)=>P[0]+e[z]).join(","),h=ol("rc",s),p=ol("source",s),f=`${h[s-1]} < ${this.outputShape[s-1]}`,g=s===1?"source":`vec2(${p.slice(-2).join()})`,v=[`${o} rc = outputLoc;`,`${h[s-1]} += 1;
       if(${f}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${h[s-2]} += 1;
       if(${h[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${h[s-1]} += 1;
         if(${f}) {`],w=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let R="";for(let P=0,z=s===1?2:4;P<z;P++)R+=`
        ${v[P]}
        if (${w}) {
          result[${P}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${P}] = getChannel(getX(${p.join()}), ${g});
        }
      `;R+=s===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${l});
      const ${o} end = ${o}(${c});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${R}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _M=i=>{const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{paddings:o,constantValue:l}=r;if(b(s.shape)===0){const p=o.map((f,g)=>f[0]+s.shape[g]+f[1]);return VA({backend:t,attrs:{shape:p,value:l,dtype:s.dtype}})}const c=Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mW(s.shape,o,l):new fW(s.shape,o,l),h=[[l]];return t.runWebGLProgram(c,[s],s.dtype,h)},gW={kernelName:oh,backendName:"webgl",kernelFunc:_M};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AW=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,vW=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+DA+`
  return result;
`,yW=No({opSnippet:AW,packedOpSnippet:vW}),bW={kernelName:Yl,backendName:"webgl",kernelFunc:yW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xW(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{axis:o,keepDims:l}=r,c=s.shape.length,h=[],p=J(o,s.shape);let f=p;const g=ha(f,c);let v=s;g!=null&&(v=ll({inputs:{x:s},backend:t,attrs:{perm:g}}),f=wa(f.length,c),h.push(v)),co("prod",f,c);let w;if(t.shouldExecuteOnCPU([v])){const R=t.texData.get(v.dataId).values,{outVals:P,outShape:z,outDtype:G}=c9(v.shape,v.dtype,R,f);w=t.makeTensorInfo(z,G,P)}else{const[R,P]=Xa(v.shape,f),z=b(P),G=yi({inputs:{x:v},backend:t,attrs:{shape:[-1,z]}}),X=Fi(s.dtype),fe=hf(G,X,"prod",t);w=yi({inputs:{x:fe},backend:t,attrs:{shape:R}}),h.push(G),h.push(fe)}if(l){h.push(w);const R=Da(w.shape,p);w=yi({inputs:{x:w},backend:t,attrs:{shape:R}})}return h.forEach(R=>t.disposeIntermediateTensorInfo(R)),w}const CW={kernelName:od,backendName:"webgl",kernelFunc:xW};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wW(i){const{inputs:e,backend:t,attrs:r}=i,{paramsNestedSplits:s,paramsDenseValues:o,indices:l}=e,{outputRaggedRank:c}=r,h=s.map(G=>t.readSync(G.dataId)),p=s.map(G=>G.shape),f=t.readSync(o.dataId),g=t.readSync(l.dataId),[v,w,R]=u9(h,p,f,o.shape,o.dtype,g,l.shape,c),P=v.map(G=>t.makeTensorInfo([G.length],"int32",G)),z=t.makeTensorInfo(R,o.dtype,w);return P.concat([z])}const EW={kernelName:Cf,backendName:"webgl",kernelFunc:wW};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IW(i){const{inputs:e,backend:t,attrs:r}=i,{shape:s,values:o,defaultValue:l,rowPartitionTensors:c}=e,{rowPartitionTypes:h}=r,p=t.readSync(s.dataId),f=t.readSync(o.dataId),g=t.readSync(l.dataId),v=c.map(z=>t.readSync(z.dataId)),w=c.map(z=>z.shape),[R,P]=h9(p,s.shape,f,o.shape,o.dtype,g,l.shape,v,w,h);return t.makeTensorInfo(R,o.dtype,P)}const SW={kernelName:wf,backendName:"webgl",kernelFunc:IW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RM=i=>{const{backend:e,attrs:t}=i,{start:r,stop:s,step:o,dtype:l}=t,c=d9(r,s,o,l);return e.makeTensorInfo([c.length],l,c)},TW={kernelName:cp,backendName:"webgl",kernelFunc:RM};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MW=ms({opSnippet:"return 1.0 / x;"}),_W={kernelName:lh,backendName:"webgl",kernelFunc:MW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RW=Nc+`
  return (x < 0.0) ? 0.0 : x;
`,BW=ms({opSnippet:RW,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),kW={kernelName:ch,backendName:"webgl",kernelFunc:BW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LW=Nc+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,DW=ms({opSnippet:LW,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),NW={kernelName:Eu,backendName:"webgl",kernelFunc:DW};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class FW{constructor(e,t,r,s,o){this.variableNames=["A"],this.outputShape=[];const[l,c,h,p]=e;this.outputShape=[l,t,r,p];const f=[s&&t>1?c-1:c,s&&r>1?h-1:h],g=[s&&t>1?t-1:t,s&&r>1?r-1:r];let v;o?v="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":v="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${f[0]/g[0]},
          ${f[1]/g[1]});
      const vec2 inputShapeRC = vec2(${c}.0, ${h}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${v};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PW{constructor(e,t,r,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,c,h,p]=e;this.outputShape=[l,t,r,p];const f=[s&&t>1?c-1:c,s&&r>1?h-1:h],g=[s&&t>1?t-1:t,s&&r>1?r-1:r];let v;o?v="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":v="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${f[0]/g[0]},
          ${f[1]/g[1]},
          ${f[1]/g[1]});
      const vec3 inputShapeRC = vec3(${c}.0, ${h}.0,
                                     ${h}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${v};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${p-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OW(i){const{inputs:e,backend:t,attrs:r}=i,{images:s}=e,{alignCorners:o,halfPixelCenters:l,size:c}=r,[h,p]=c,f=Ye().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new PW(s.shape,h,p,o,l):new FW(s.shape,h,p,o,l);return t.runWebGLProgram(f,[s],"float32")}const GW={kernelName:io,backendName:"webgl",kernelFunc:OW};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class UW{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,o]=t,[,l,c]=e,h=[r&&l>1?s-1:s,r&&c>1?o-1:o],p=[r&&l>1?l-1:l,r&&c>1?c-1:c],f=h[0]/p[0],g=h[1]/p[1],v=1/f,w=1/g,R=Math.ceil(v)*2+2,P=Math.ceil(w)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${f});
        const float widthScale = float(${g});

        const float invHeightScale = float(${v});
        const float invWidthScale = float(${w});

        const int winHeight = int(${R});
        const int winWidth = int(${P});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${c}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VW(i){const{inputs:e,backend:t,attrs:r}=i,{images:s,dy:o}=e,{alignCorners:l}=r,c=new UW(o.shape,s.shape,l);return t.runWebGLProgram(c,[o],o.dtype)}const zW={kernelName:za,backendName:"webgl",kernelFunc:VW};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class WW{constructor(e,t,r,s,o){this.variableNames=["A"],this.outputShape=[];const[l,c,h,p]=e;this.outputShape=[l,t,r,p];const f=[s&&t>1?c-1:c,s&&r>1?h-1:h],g=[s&&t>1?t-1:t,s&&r>1?r-1:r],v=s?"0.5":"0.0";let w;o?w="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":w="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${f[0]/g[0]},
          ${f[1]/g[1]});
      const vec2 inputShapeRC = vec2(${c}.0, ${h}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${w};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${v})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HW{constructor(e,t,r,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,c,h,p]=e;this.outputShape=[l,t,r,p];const f=[s&&t>1?c-1:c,s&&r>1?h-1:h],g=[s&&t>1?t-1:t,s&&r>1?r-1:r],v=s?"0.5":"0.0";let w;o?w="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":w="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${f[0]/g[0]},
          ${f[1]/g[1]},
          ${f[1]/g[1]});
      const vec3 inputShapeRC = vec3(${c}.0, ${h}.0,
                                     ${h}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${w};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${v})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${p-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KW(i){const{inputs:e,backend:t,attrs:r}=i,{images:s}=e,{alignCorners:o,halfPixelCenters:l,size:c}=r,[h,p]=c,f=Ye().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new HW(s.shape,h,p,o,l):new WW(s.shape,h,p,o,l);return t.runWebGLProgram(f,[s],s.dtype)}const XW={kernelName:Cu,backendName:"webgl",kernelFunc:KW};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class QW{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,o]=t,[,l,c]=e,h=[r&&l>1?s-1:s,r&&c>1?o-1:o],p=[r&&l>1?l-1:l,r&&c>1?c-1:c],f=h[0]/p[0],g=h[1]/p[1],v=1/f,w=1/g,R=Math.ceil(v)*2+2,P=Math.ceil(w)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${f});
        const float widthScale = float(${g});

        const float invHeightScale = float(${v});
        const float invWidthScale = float(${w});

        const int winHeight = int(${R});
        const int winWidth = int(${P});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${c}) {
              continue;
            }

            float sourceFracRow =
              float(${h[0]}) *
                (float(dyR) / float(${p[0]}));

            float sourceFracCol =
                float(${h[1]}) *
                  (float(dyC) / float(${p[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZW(i){const{inputs:e,backend:t,attrs:r}=i,{images:s,dy:o}=e,{alignCorners:l}=r,c=new QW(o.shape,s.shape,l);return t.runWebGLProgram(c,[o],o.dtype)}const $W={kernelName:wu,backendName:"webgl",kernelFunc:ZW};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jW{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=c=>t.indexOf(c)!==-1&&e[c]!==1?`${e[c]} - coords[${c}] - 1`:`coords[${c}]`,o=e.map((c,h)=>s(h)).join(","),l=sa(r);this.userCode=`
      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class YW{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=ol("rc",r),o=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,l=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,c=sa(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${c} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${h(s.slice())};
          if(${o}){
            result.g = ${p(s.slice())};
          }
          if(${l}) {
            result.b = ${f(s.slice())};
            if(${o}) {
              result.a = ${g(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function h(R){return v(R)}function p(R){return R[r-1]="("+R[r-1]+" + 1)",v(R)}function f(R){return R[r-2]="("+R[r-2]+" + 1)",v(R)}function g(R){return R[r-1]="("+R[r-1]+" + 1)",R[r-2]="("+R[r-2]+" + 1)",v(R)}function v(R){const P=e.map((X,fe)=>w(fe,R)),z=P.join(","),G=P.slice(-2).join(",");return`getChannel(getX(${z}), vec2(${G}))`}function w(R,P){return t.indexOf(R)!==-1&&e[R]!==1?`${e[R]} - ${P[R]} - 1`:`${P[R]}`}}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JW(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{dims:o}=r,l=s.shape.length,c=J(o,s.shape);if(l===0)return Ql({inputs:{x:s},backend:t});const h=Ye().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YW(s.shape,c):new jW(s.shape,c);return t.runWebGLProgram(h,[s],s.dtype)}const qW={kernelName:Bl,backendName:"webgl",kernelFunc:JW};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class e7{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const t7={kernelName:Si,backendName:"webgl",kernelFunc:({inputs:i,attrs:e,backend:t})=>{const{image:r}=i,{radians:s,fillValue:o,center:l}=e,c=t,h=new e7(r.shape,o),[p,f]=Hp(l,r.shape[1],r.shape[2]),g=[[p,f,Math.sin(s),Math.cos(s)]];return c.runWebGLProgram(h,[r],r.dtype,g)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const n7=ms({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),i7={kernelName:Jl,backendName:"webgl",kernelFunc:n7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const r7=ms({opSnippet:"return inversesqrt(x);",cpuKernelImpl:p9}),s7={kernelName:Za,backendName:"webgl",kernelFunc:r7};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class BM{constructor(e,t,r,s,o,l,c=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=l;const h=sa(o.length),p=sa(l.length);let f="";r===1?f="i":r===2&&(f="i, j");const g=`getIndices(${f})`;let v="";s===1?v="i":s===2&&(v="i, coords[1]");const w=`getUpdates(${v})`,R=t>1?"strides[j]":"strides";this.userCode=`
        ${h} strides = ${h}(${o});

        void main() {
          ${p} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${g});
              flattenedIndex += index * ${R};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${w};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a7(i){const{inputs:e,backend:t,attrs:r}=i,{indices:s,updates:o}=e,{shape:l}=r,{sliceRank:c,numUpdates:h,sliceSize:p,strides:f,outputSize:g}=vp(o,s,l),v=[g/p,p];if(g===0)return t.makeTensorInfo(l,s.dtype);const w=yi({inputs:{x:s},backend:t,attrs:{shape:[h,c]}}),R=yi({inputs:{x:o},backend:t,attrs:{shape:[h,p]}}),P=t.makeTensorInfo([],"float32",new Float32Array([0])),z=new BM(h,c,w.shape.length,R.shape.length,f,v),G=t.runWebGLProgram(z,[R,w,P],R.dtype),X=yi({inputs:{x:G},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(G),t.disposeIntermediateTensorInfo(P),X}const o7={kernelName:aa,backendName:"webgl",kernelFunc:a7};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class l7{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const o="while (left < right) {",l=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,c=Ye().getNumber("WEBGL_VERSION")===2?o:l,h=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${c}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${h} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c7(i){const{inputs:e,backend:t,attrs:r}=i,{sortedSequence:s,values:o}=e,{side:l}=r,c=new l7(s.shape[0],s.shape[1],o.shape[1],l),h=[[s.shape[1]]];return t.runWebGLProgram(c,[s,o],"int32",h)}const u7={kernelName:cd,backendName:"webgl",kernelFunc:c7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class h7{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,o;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)o="resRC",s="resRC";else{const c=["resRC.x","resRC.y","resRC.z","resRC.w"],h=[],p=[];for(let f=0;f<t.length;f++)p.push(`${c[f]}`),f<e&&h.push(`${c[f]}`);s=h.join(),o=p.join()}const l=sa(r);this.userCode=`
      void main() {
        ${l} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function d7(i){const{inputs:e,backend:t}=i,{condition:r,t:s,e:o}=e,l=new h7(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(l,[r,s,o],Uo(s.dtype,o.dtype))}const p7={kernelName:ud,backendName:"webgl",kernelFunc:d7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const f7=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Kp};
  float scale = ${Zu};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,m7=ms({opSnippet:f7}),g7={kernelName:uh,backendName:"webgl",kernelFunc:m7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const A7=fg+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,v7=ms({opSnippet:A7,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:m9}),y7={kernelName:fh,backendName:"webgl",kernelFunc:v7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const b7=ms({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),x7={kernelName:ph,backendName:"webgl",kernelFunc:b7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const C7=fg+`
  return sin(x);
`,w7=ms({opSnippet:C7}),E7={kernelName:hh,backendName:"webgl",kernelFunc:w7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const I7=ms({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),S7={kernelName:dh,backendName:"webgl",kernelFunc:I7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const T7=ms({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),M7={kernelName:mh,backendName:"webgl",kernelFunc:T7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _7={kernelName:dd,backendName:"webgl",kernelFunc:i=>{const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{blockShape:o,paddings:l}=r;C(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const c=o.reduce((G,X)=>G*X),h=[[0,0]];h.push(...l);for(let G=1+o.length;G<s.shape.length;++G)h.push([0,0]);const p=[],f=_M({inputs:{x:s},backend:t,attrs:{paddings:h,constantValue:0}}),g=Kd(f.shape,o,c,!1),v=Xd(g.length,o.length,!1),w=Xh(f.shape,o,c,!1),R=yi({inputs:{x:f},backend:t,attrs:{shape:g}}),P=ll({inputs:{x:R},backend:t,attrs:{perm:v}}),z=yi({inputs:{x:P},backend:t,attrs:{shape:w}});return p.push(f),p.push(R),p.push(P),p.forEach(G=>t.disposeIntermediateTensorInfo(G)),z}};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R7(i){const{inputs:e,backend:t}=i,{indices:r,values:s,denseShape:o,defaultValue:l}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const c=t.readSync(r.dataId),h=t.readSync(s.dataId),p=t.readSync(o.dataId),f=t.readSync(l.dataId)[0],[g,v,w,R,P]=A9(c,r.shape,r.dtype,h,s.dtype,p,f);return[t.makeTensorInfo(v,r.dtype,g),t.makeTensorInfo([v[0]],s.dtype,w),t.makeTensorInfo([R.length],"bool",new Uint8Array(R.map(z=>Number(z)))),t.makeTensorInfo([P.length],r.dtype,new Int32Array(P))]}const B7={kernelName:md,backendName:"webgl",kernelFunc:R7};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k7(i){const{inputs:e,backend:t}=i,{inputIndices:r,inputShape:s,newShape:o}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const l=Array.from(t.readSync(s.dataId)),c=t.readSync(r.dataId),h=Array.from(t.readSync(o.dataId)),[p,f,g]=v9(c,r.shape,r.dtype,l,h);return[t.makeTensorInfo(f,r.dtype,p),t.makeTensorInfo([g.length],o.dtype,new Int32Array(g))]}const L7={kernelName:hp,backendName:"webgl",kernelFunc:k7};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D7(i){const{inputs:e,backend:t}=i,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const l=t.readSync(r.dataId),c=t.readSync(s.dataId),h=t.readSync(o.dataId),[p,f]=NT(l,r.shape,r.dtype,c,h,!0);return t.makeTensorInfo(f,r.dtype,p)}const N7={kernelName:Ah,backendName:"webgl",kernelFunc:D7};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F7(i){const{inputs:e,backend:t}=i,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const l=t.readSync(r.dataId),c=t.readSync(s.dataId),h=t.readSync(o.dataId),[p,f]=NT(l,r.shape,r.dtype,c,h);return t.makeTensorInfo(f,r.dtype,p)}const P7={kernelName:Ef,backendName:"webgl",kernelFunc:F7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O7(i){const{inputs:e,backend:t,attrs:r}=i,{sparseIndices:s,sparseValues:o,defaultValue:l}=e,{outputShape:c}=r,{sliceRank:h,numUpdates:p,sliceSize:f,strides:g,outputSize:v}=vp(o,s,c),w=!1;if(o.dtype==="string"){const G=t.bufferSync(s),X=t.bufferSync(o),fe=Pl(t.readSync(l.dataId)[0]),ge=f9(G,X,c,v,f,p,h,g,fe,w);return t.makeTensorInfo(c,ge.dtype,ge.values)}const R=new BM(p,h,s.shape.length,o.shape.length,g,[v,1],w),P=t.runWebGLProgram(R,[o,s,l],o.dtype),z=yi({inputs:{x:P},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(P),z}const G7={kernelName:kl,backendName:"webgl",kernelFunc:O7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U7(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{numOrSizeSplits:o,axis:l}=r,c=J(l,s.shape)[0],h=Fm(s,o,c),p=s.shape.length,f=new Array(p).fill(0),g=s.shape.slice();return h.map(v=>{const w=[...g];w[c]=v;const R=mg({inputs:{x:s},backend:t,attrs:{begin:f,size:w}});return f[c]+=v,R})}const V7={kernelName:pd,backendName:"webgl",kernelFunc:U7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kM="return sqrt(x);",z7=ms({opSnippet:kM,packedOpSnippet:kM,cpuKernelImpl:y9}),W7={kernelName:gh,backendName:"webgl",kernelFunc:z7};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const H7=ms({opSnippet:"return x * x;"}),K7={kernelName:dp,backendName:"webgl",kernelFunc:H7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LM="return (a - b) * (a - b);",X7=No({opSnippet:LM,packedOpSnippet:LM}),Q7={kernelName:hs,backendName:"webgl",kernelFunc:X7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z7({inputs:i,attrs:e,backend:t}){const{x:r}=i,s=Nc+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Jh(r.shape,s);return t.runWebGLProgram(o,[r],r.dtype)}const $7={kernelName:Uc,backendName:"webgl",kernelFunc:Z7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class j7{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,o=sa(r.length),l=sa(r.length);let c="";if(s===1)c="coords * strides + begin";else{let h=0;c=r.map((p,f)=>(h++,r.length===1?`coords * strides[${f}] + begin[${f}]`:`coords[${h-1}] * strides[${f}] + begin[${f}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${c}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y7(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{begin:o,end:l,strides:c,beginMask:h,endMask:p,ellipsisMask:f,newAxisMask:g,shrinkAxisMask:v}=r,{finalShapeSparse:w,finalShape:R,isIdentity:P,sliceDim0:z,isSimpleSlice:G,begin:X,end:fe,strides:ge}=$g(s.shape,o,l,c,h,p,f,g,v);let be;if(P)be=yi({inputs:{x:s},backend:t,attrs:{shape:R}});else if(z||G){C(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const Je=Zg(X,fe,ge),$e=mg({inputs:{x:s},backend:t,attrs:{begin:X,size:Je}});be=yi({inputs:{x:$e},backend:t,attrs:{shape:R}}),t.disposeIntermediateTensorInfo($e)}else if(t.shouldExecuteOnCPU([s])){const Je=t.readSync(s.dataId),$e=dr(s.shape,s.dtype,Je),rt=b9(w,$e,ge,X);be=t.makeTensorInfo(R,s.dtype,rt.values)}else{const Je=new j7(X,ge,w);be=t.runWebGLProgram(Je,[s],s.dtype)}const He=yi({inputs:{x:be},backend:t,attrs:{shape:R}});return t.disposeIntermediateTensorInfo(be),He}const J7={kernelName:kn,backendName:"webgl",kernelFunc:Y7};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q7(i){const{inputs:e,backend:t,attrs:r}=i,{separator:s,nGramWidths:o,leftPad:l,rightPad:c,padWidth:h,preserveShortSequences:p}=r,{data:f,dataSplits:g}=e,v=t.readSync(f.dataId),w=t.readSync(g.dataId),[R,P]=x9(v,w,s,o,l,c,h,p);return[t.makeTensorInfo([R.length],"string",R),t.makeTensorInfo(g.shape,"int32",P)]}const eH={kernelName:ro,backendName:"webgl",kernelFunc:q7};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tH(i){const{inputs:e,backend:t,attrs:r}=i,{skipEmpty:s}=r,{input:o,delimiter:l}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const c=t.readSync(o.dataId),h=t.readSync(l.dataId)[0],[p,f,g]=C9(c,h,s),v=f.length;return[t.makeTensorInfo([v,2],"int32",p),t.makeTensorInfo([v],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(g))]}const nH={kernelName:gd,backendName:"webgl",kernelFunc:tH};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iH(i){const{inputs:e,backend:t,attrs:r}=i,{numBuckets:s}=r,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const l=t.readSync(o.dataId),c=w9(l,s);return t.makeTensorInfo(o.shape,"int32",c)}const rH={kernelName:pp,backendName:"webgl",kernelFunc:iH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sH=ms({opSnippet:"return tan(x);"}),aH={kernelName:Ll,backendName:"webgl",kernelFunc:sH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oH=ms({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),lH={kernelName:ql,backendName:"webgl",kernelFunc:oH};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class cH{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let l=0;l<r.length;l++)r[l]=e[l]*t[l];this.outputShape=r,this.rank=r.length;const s=sa(this.rank),o=uH(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function uH(i){const e=i.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${i[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<i.length;s++)r.push(`imod(${t[s]}, ${i[s]})`);return r.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DM(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{reps:o}=r;if(s.dtype==="string"||s.shape.length>5){const c=t.readSync(s.dataId),h=s.dtype==="string"?c.map(g=>Pl(g)):c,p=dr(s.shape,s.dtype,h),f=I9(p,o);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const l=new cH(s.shape,o);return t.runWebGLProgram(l,[s],s.dtype)}const hH={kernelName:ml,backendName:"webgl",kernelFunc:DM};class dH{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class pH{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function df(i,e){e!==null&&i.disposeIntermediateTensorInfo(e)}function NM(i){let e=1;for(;e<i;)e*=2;return e}function fH(i){const{inputs:e,backend:t,attrs:r}=i,{x:s}=e,{k:o,sorted:l}=r,c=Ye().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),h=Ye().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),p=s.shape,f=p[p.length-1];if(t.shouldExecuteOnCPU([s])||f<c||o>h){const rt=t.readSync(s.dataId),[pt,Gt]=S9(rt,p,s.dtype,o,l);return[t.makeTensorInfo(pt.shape,pt.dtype,pt.values),t.makeTensorInfo(Gt.shape,Gt.dtype,Gt.values)]}if(o===0)return p[p.length-1]=0,[t.makeTensorInfo(p,s.dtype,[]),t.makeTensorInfo(p,"int32",[])];if(f===1)return[s,VA({attrs:{shape:p,dtype:"int32",value:0},backend:t})];const g=t.texData.get(s.dataId),v=g!==null&&g.isPacked,w=v?t.unpackTensor(s):s,R=b(p)/f,P=yi({inputs:{x:w},attrs:{shape:[R,f]},backend:t});v&&df(t,w);const z=NM(o),G=NM(f);let X=null;const fe=()=>X===null?[P,P]:[P,X],ge=(rt,pt,Gt)=>{const zt=fe(),Kt=new dH(Gt),tn=[[f],[X===null?1:0],[Number.NEGATIVE_INFINITY],[rt],[pt]],qt=X;X=t.runWebGLProgram(Kt,zt,"int32",tn),df(t,qt)};for(let rt=1;rt<z;rt*=2){const pt=rt*2;for(let Gt=rt;Gt>=1;Gt/=2)ge(pt,Gt,[R,G])}for(let rt=G;rt>z;rt/=2){const pt=fe(),Gt=new pH([R,rt/2]),zt=[[f],[X===null?1:0],[z]],Kt=X;X=t.runWebGLProgram(Gt,pt,"int32",zt),df(t,Kt);const tn=z/2,qt=tn*2;for(let sn=tn;sn>=1;sn/=2)ge(qt,sn,X.shape)}let be=X;X=mg({inputs:{x:X},backend:t,attrs:{begin:0,size:[R,o]}}),df(t,be);let He=CM({inputs:{x:P,indices:X},backend:t,attrs:{axis:1,batchDims:1}});df(t,P);const Je=p.slice(0,-1);Je.push(o),be=X,X=yi({inputs:{x:X},attrs:{shape:Je},backend:t}),df(t,be);const $e=He;return He=yi({inputs:{x:He},attrs:{shape:Je},backend:t}),df(t,$e),[He,X]}const mH={kernelName:Iu,backendName:"webgl",kernelFunc:fH};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gH{constructor(e,t,r,s,o,l){this.variableNames=["Image","Transforms"],this.outputShape=l;const c=r==="nearest"?1:2;let h;switch(s){case"constant":h=1;break;case"reflect":h=2;break;case"wrap":h=3;break;case"nearest":h=4;break;default:h=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${h} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${h} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${h} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${c} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AH(i){const{inputs:e,backend:t,attrs:r}=i,{image:s,transforms:o}=e,{interpolation:l,fillMode:c,fillValue:h,outputShape:p}=r,[f,g,v,w]=s.shape,[R,P]=p??[g,v],z=[f,R,P,w],G=new gH(g,v,l,c,h,z);return t.runWebGLProgram(G,[s,o],"float32")}const vH={kernelName:yh,backendName:"webgl",kernelFunc:AH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yH(i){const{inputs:e,attrs:t,backend:r}=i,{axis:s}=t,{x:o}=e;BA(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const l=r.readSync(o.dataId),{outputValues:c,outputShape:h,indices:p}=T9(l,s,o.shape,o.dtype);return[r.makeTensorInfo(h,o.dtype,c),r.makeTensorInfo([p.length],"int32",p)]}const bH={kernelName:Ad,backendName:"webgl",kernelFunc:yH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xH(i){const{inputs:e,backend:t,attrs:r}=i,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const l=s,c=l.shape.length,h=s.shape[o],p=new Array(c-1);let f=0;for(let P=0;P<c;P++)P!==o&&(p[f++]=l.shape[P]);const g=[],v=new Array(c).fill(0),w=l.shape.slice();w[o]=1;const R=new Array(h);for(let P=0;P<R.length;P++){v[o]=P;const z=mg({inputs:{x:l},backend:t,attrs:{begin:v,size:w}}),G=yi({inputs:{x:z},backend:t,attrs:{shape:p}});R[P]=G,g.push(z)}return g.forEach(P=>t.disposeIntermediateTensorInfo(P)),R}const CH={kernelName:oa,backendName:"webgl",kernelFunc:xH};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wH{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,o=e.inSize,l=e.numSegments,c=l*Math.ceil(o/r);this.outputShape=[s,c];const h="0.0",p="sumValue",f=Math.floor(r/4)*4,g=r%4,v=`
        sumValue += dot(values, segFilter);
    `;let w="";o%r>0&&(w=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let R="";o%r>0&&(R=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${h};

      float getValue(int batch, int inIdx) {
        ${w}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${R}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${l})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${l})));

        float sumValue = 0.0;

        for (int i = 0; i < ${f}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${v}
        }

        int inIdx = inOffset + ${f};
        if (${g===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${v}
        } else if (${g===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${v}
        } else if (${g===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${v}
        }
        setOutput(${p});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EH(i){const{inputs:e,backend:t,attrs:r}=i,{x:s,segmentIds:o}=e,{numSegments:l}=r,c=s.shape.length,h=[];let p=0;const f=ha([p],c);let g=s;f!=null&&(g=ll({inputs:{x:s},backend:t,attrs:{perm:f}}),h.push(g),p=wa(1,c)[0]);const v=$u(g.shape,p,l),w=b([g.shape[p]]),R=yi({inputs:{x:g},backend:t,attrs:{shape:[-1,w]}});h.push(R);const P=Fi(s.dtype),z=(ge,be,He,Je,$e)=>{const rt=ge.shape[0],pt=ge.shape[1],Gt=Wv(pt,$e),zt={windowSize:Gt,inSize:pt,batchSize:rt,numSegments:$e},Kt=new wH(zt,be),tn=t.compileAndRun(Kt,[ge,He],Je);if(h.push(tn),tn.shape[1]===$e)return tn;const qt=RM({backend:t,attrs:{start:0,stop:$e,step:1,dtype:"float32"}}),sn=DM({inputs:{x:qt},backend:t,attrs:{reps:[pt/Gt]}});return h.push(qt),h.push(sn),z(tn,be,sn,Je,$e)},G=z(R,"unsortedSegmentSum",o,P,l),X=yi({inputs:{x:G},backend:t,attrs:{shape:v}});let fe=X;if(f!=null){h.push(X);const ge=Nu(f);fe=ll({inputs:{x:fe},backend:t,attrs:{perm:ge}})}return h.forEach(ge=>t.disposeIntermediateTensorInfo(ge)),fe}const IH={kernelName:Io,backendName:"webgl",kernelFunc:EH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SH=[v8,b8,w8,S8,M8,B8,L8,N8,G8,V8,H8,Q8,j8,eU,iU,sU,oU,hU,pU,mU,vU,EU,SU,MU,LU,NU,GU,t8,zU,QU,YU,i6,s6,o6,c6,h6,f6,g6,v6,b6,C6,E6,T6,_6,L6,N6,O6,V6,W6,K6,Z6,j6,q6,tV,nV,rV,aV,lV,uV,dV,fV,AV,bV,CV,IV,MV,RV,kV,e8,DV,KU,FV,OV,UV,i8,zV,HV,XV,$V,JV,ez,nz,rz,oz,cz,hz,mz,Az,yz,wz,Iz,Tz,_z,Bz,Nz,Oz,zz,Zz,a8,Jz,tW,rW,oW,_U,cW,hW,pW,gW,bW,s8,CW,EW,SW,TW,RU,Hz,_W,kW,NW,l8,GW,zW,XW,$W,qW,t7,i7,s7,o7,u7,p7,g7,y7,x7,E7,S7,wU,Xz,M7,_7,B7,L7,N7,P7,G7,V7,W7,K7,Q7,$7,J7,eH,nH,rH,Kz,m8,aH,lH,hH,mH,vH,g8,bH,CH,IH,uW];for(const i of SH)so(i);const FM="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIEd0e2NvbnN0cnVjdG9yKGU9W10sbj1RdCl7aWYodGhpcy5kYXRhPWUsdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9bix0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKGUpe3RoaXMuZGF0YS5wdXNoKGUpLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBlPXRoaXMuZGF0YVswXSxuPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPW4sdGhpcy5fZG93bigwKSksZX1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAoZSl7Y29uc3R7ZGF0YTpuLGNvbXBhcmU6dH09dGhpcyxzPW5bZV07Zm9yKDtlPjA7KXtjb25zdCByPWUtMT4+MSxpPW5bcl07aWYodChzLGkpPj0wKWJyZWFrO25bZV09aSxlPXJ9bltlXT1zfV9kb3duKGUpe2NvbnN0e2RhdGE6bixjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPW5bZV07Zm9yKDtlPHM7KXtsZXQgaT0oZTw8MSkrMSxoPW5baV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChuW2xdLGgpPDAmJihpPWwsaD1uW2xdKSx0KGgscik+PTApYnJlYWs7bltlXT1oLGU9aX1uW2VdPXJ9fWZ1bmN0aW9uIFF0KG8sZSl7cmV0dXJuIG88ZT8tMTpvPmU/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTplLHYyOm59PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl7bGV0IHI9KGVbc11ebltzXSk+Pj4wO3QrPVd0KHIpfXJldHVybiB0fSxXdD1vPT57dmFyIGU9by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gZT0oZT4+MiY4NTg5OTM0NTkpKyhlJjg1ODk5MzQ1OSksZT0oZT4+NCkrZSYyNTI2NDUxMzUsZT0oZT4+OCkrZSYxNjcxMTkzNSxlPShlPj4xNikrZSY2NTUzNSxlfSx1dD0xLE50PW89Pntjb25zdHtrZXl3aWR0aDplLGtleWhlaWdodDpuLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgoZSxuKSxNPU1hdGguZmxvb3IoZS8yKSx6PU1hdGguZmxvb3Iobi8yKSxFPVtdO2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtjb25zdCBWPXJbdl0ucXVlcnlwb2ludC5zY2FsZSxKPXJbdl0ua2V5cG9pbnQuc2NhbGU7Sj09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3QgTj1WL0o7RS5wdXNoKE4qbSl9RS5zb3J0KCh2LFYpPT52LVYpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLGI9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLEY9cSpiLFg9RipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtjb25zdCBWPXJbdl0ucXVlcnlwb2ludCxKPXJbdl0ua2V5cG9pbnQse3g6Tix5OkIsc2NhbGU6JCxhbmdsZTpDfT1adCh7cXVlcnlwb2ludDpWLGtleXBvaW50Okosa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6eixzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZihOPGh8fE4+PWl8fEI8dXx8Qj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8JDxhfHwkPj1qKXtjW3ZdPSExO2NvbnRpbnVlfWxldCBVPXEqKE4taCkvKGktaCksd3Q9YiooQi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKCQtYSkvKGotYSk7cFt2XT17YmluWDpVLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBydD1NYXRoLmZsb29yKFUtLjUpLGl0PU1hdGguZmxvb3Iod3QtLjUpLGx0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKHJ0PDB8fHJ0KzE+PXF8fGl0PDB8fGl0KzE+PWJ8fGx0PDB8fGx0KzE+PWcpe2Nbdl09ITE7Y29udGludWV9Zm9yKGxldCBodD0wO2h0PDI7aHQrKyl7bGV0IGt0PXJ0K2h0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCBobj1pdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgdW49KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBjbj1sdCtSdDtjb25zdCB2dD1rdCtobipxK3VuKkYrY24qWDtTW3Z0XT09PXZvaWQgMCYmKFNbdnRdPTApLFNbdnRdKz0xfX19fWNbdl09ITB9bGV0IGQ9MCxQPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2godj0+e1Nbdl0+ZCYmKGQ9U1t2XSxQPXYpfSksZDwzKXJldHVybltdO2NvbnN0IE89TWF0aC5mbG9vcihQJVglRiVxKSxUPU1hdGguZmxvb3IoKFAtTyklWCVGL3EpLEQ9TWF0aC5mbG9vcigoUC1PLVQqcSklWC9GKSxZPU1hdGguZmxvb3IoKFAtTy1UKnEtRCpGKS9YKSxHPVtdO2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtpZighY1t2XSljb250aW51ZTtjb25zdCBWPXBbdl07aWYoTWF0aC5hYnMoVi5iaW5YLShPKy41KSk+PXV0fHxNYXRoLmFicyhWLmJpblktKFQrLjUpKT49dXR8fE1hdGguYWJzKFYuYmluU2NhbGUtKFkrLjUpKT49dXQpY29udGludWU7Y29uc3QgJD1NYXRoLmFicyhWLmJpbkFuZ2xlLShEKy41KSk7TWF0aC5taW4oJCxmLSQpPj11dHx8Ry5wdXNoKHJbdl0pfXJldHVybiBHfSxadD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDplLGtleWNlbnRlclg6bixrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLWUuYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL2Uuc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSplLngrdVsxXSplLnksdVsyXSplLngrdVszXSplLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKm4rdVsxXSp0K2cseTp1WzJdKm4rdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0seHQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBjdChvKXtyZXR1cm4geHQuY2FsbChvKS5lbmRzV2l0aCgiQXJyYXldIil9ZnVuY3Rpb24gQXQobyl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFjdChvKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IGJlIGFuIGFycmF5Iik7aWYoby5sZW5ndGg9PT0wKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3Qgbm90IGJlIGVtcHR5Iik7dmFyIG49ZS5mcm9tSW5kZXgsdD1uPT09dm9pZCAwPzA6bixzPWUudG9JbmRleCxyPXM9PT12b2lkIDA/by5sZW5ndGg6cztpZih0PDB8fHQ+PW8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcih0KSl0aHJvdyBuZXcgRXJyb3IoImZyb21JbmRleCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciBzbWFsbGVyIHRoYW4gbGVuZ3RoIik7aWYocjw9dHx8cj5vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIocikpdGhyb3cgbmV3IEVycm9yKCJ0b0luZGV4IG11c3QgYmUgYW4gaW50ZWdlciBncmVhdGVyIHRoYW4gZnJvbUluZGV4IGFuZCBhdCBtb3N0IGVxdWFsIHRvIGxlbmd0aCIpO2Zvcih2YXIgaT1vW3RdLGg9dCsxO2g8cjtoKyspb1toXT5pJiYoaT1vW2hdKTtyZXR1cm4gaX1mdW5jdGlvbiB0ZShvKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIWN0KG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgbj1lLmZyb21JbmRleCx0PW49PT12b2lkIDA/MDpuLHM9ZS50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihjdChvKSl7aWYoby5sZW5ndGg9PT0wKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3Qgbm90IGJlIGVtcHR5Iil9ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IGJlIGFuIGFycmF5Iik7dmFyIG47aWYoZS5vdXRwdXQhPT12b2lkIDApe2lmKCFjdChlLm91dHB1dCkpdGhyb3cgbmV3IFR5cGVFcnJvcigib3V0cHV0IG9wdGlvbiBtdXN0IGJlIGFuIGFycmF5IGlmIHNwZWNpZmllZCIpO249ZS5vdXRwdXR9ZWxzZSBuPW5ldyBBcnJheShvLmxlbmd0aCk7dmFyIHQ9dGUobykscz1BdChvKTtpZih0PT09cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigibWluaW11bSBhbmQgbWF4aW11bSBpbnB1dCB2YWx1ZXMgYXJlIGVxdWFsLiBDYW5ub3QgcmVzY2FsZSBhIGNvbnN0YW50IGFycmF5Iik7dmFyIHI9ZS5taW4saT1yPT09dm9pZCAwP2UuYXV0b01pbk1heD90OjA6cixoPWUubWF4LGw9aD09PXZvaWQgMD9lLmF1dG9NaW5NYXg/czoxOmg7aWYoaT49bCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigibWluIG9wdGlvbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXggb3B0aW9uIik7Zm9yKHZhciB1PShsLWkpLyhzLXQpLGY9MDtmPG8ubGVuZ3RoO2YrKyluW2ZdPShvW2ZdLXQpKnUraTtyZXR1cm4gbn1jb25zdCBmdD0iICIucmVwZWF0KDIpLF90PSIgIi5yZXBlYXQoNCk7ZnVuY3Rpb24gZWUoKXtyZXR1cm4genQodGhpcyl9ZnVuY3Rpb24genQobyxlPXt9KXtjb25zdHttYXhSb3dzOm49MTUsbWF4Q29sdW1uczp0PTEwLG1heE51bVNpemU6cz04fT1lO3JldHVybmAke28uY29uc3RydWN0b3IubmFtZX0gewoke2Z0fVsKJHtfdH0ke25lKG8sbix0LHMpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gbmUobyxlLG4sdCl7Y29uc3R7cm93czpzLGNvbHVtbnM6cn09byxpPU1hdGgubWluKHMsZSksaD1NYXRoLm1pbihyLG4pLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7bGV0IGY9W107Zm9yKGxldCBnPTA7ZzxoO2crKylmLnB1c2goc2Uoby5nZXQodSxnKSx0KSk7bC5wdXNoKGAke2Yuam9pbigiICIpfWApfXJldHVybiBoIT09ciYmKGxbbC5sZW5ndGgtMV0rPWAgLi4uICR7ci1ufSBtb3JlIGNvbHVtbnNgKSxpIT09cyYmbC5wdXNoKGAuLi4gJHtzLWV9IG1vcmUgcm93c2ApLGwuam9pbihgCiR7X3R9YCl9ZnVuY3Rpb24gc2UobyxlKXtjb25zdCBuPVN0cmluZyhvKTtpZihuLmxlbmd0aDw9ZSlyZXR1cm4gbi5wYWRFbmQoZSwiICIpO2NvbnN0IHQ9by50b1ByZWNpc2lvbihlLTIpO2lmKHQubGVuZ3RoPD1lKXJldHVybiB0O2NvbnN0IHM9by50b0V4cG9uZW50aWFsKGUtMikscj1zLmluZGV4T2YoImUiKSxpPXMuc2xpY2Uocik7cmV0dXJuIHMuc2xpY2UoMCxlLWkubGVuZ3RoKStpfWZ1bmN0aW9uIG9lKG8sZSl7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1lLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgZSh0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgZSh0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxlLG4pe2xldCB0PW4/by5yb3dzOm8ucm93cy0xO2lmKGU8MHx8ZT50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gVyhvLGUsbil7bGV0IHQ9bj9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYoZTwwfHxlPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiBBKG8sZSl7aWYoZS50bzFEQXJyYXkmJihlPWUudG8xREFycmF5KCkpLGUubGVuZ3RoIT09by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJ2ZWN0b3Igc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2YgY29sdW1ucyIpO3JldHVybiBlfWZ1bmN0aW9uIHR0KG8sZSl7aWYoZS50bzFEQXJyYXkmJihlPWUudG8xREFycmF5KCkpLGUubGVuZ3RoIT09by5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJ2ZWN0b3Igc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2Ygcm93cyIpO3JldHVybiBlfWZ1bmN0aW9uIHJlKG8sZSxuKXtyZXR1cm57cm93OmllKG8sZSksY29sdW1uOmxlKG8sbil9fWZ1bmN0aW9uIGllKG8sZSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSBmb3Igcm93IGluZGljZXMiKTtpZihlLnNvbWUodD0+dDwwfHx0Pj1vLnJvd3MpKXRocm93IG5ldyBSYW5nZUVycm9yKCJyb3cgaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIik7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSl8fChlPUFycmF5LmZyb20oZSkpLGV9ZnVuY3Rpb24gbGUobyxlKXtpZih0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5leHBlY3RlZCB0eXBlIGZvciBjb2x1bW4gaW5kaWNlcyIpO2lmKGUuc29tZSh0PT50PDB8fHQ+PW8uY29sdW1ucykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoImNvbHVtbiBpbmRpY2VzIGFyZSBvdXQgb2YgcmFuZ2UiKTtyZXR1cm4gQXJyYXkuaXNBcnJheShlKXx8KGU9QXJyYXkuZnJvbShlKSksZX1mdW5jdGlvbiBGdChvLGUsbix0LHMpe2lmKGFyZ3VtZW50cy5sZW5ndGghPT01KXRocm93IG5ldyBSYW5nZUVycm9yKCJleHBlY3RlZCA0IGFyZ3VtZW50cyIpO2lmKGF0KCJzdGFydFJvdyIsZSksYXQoImVuZFJvdyIsbiksYXQoInN0YXJ0Q29sdW1uIix0KSxhdCgiZW5kQ29sdW1uIixzKSxlPm58fHQ+c3x8ZTwwfHxlPj1vLnJvd3N8fG48MHx8bj49by5yb3dzfHx0PDB8fHQ+PW8uY29sdW1uc3x8czwwfHxzPj1vLmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIlN1Ym1hdHJpeCBpbmRpY2VzIGFyZSBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiBndChvLGU9MCl7bGV0IG49W107Zm9yKGxldCB0PTA7dDxvO3QrKyluLnB1c2goZSk7cmV0dXJuIG59ZnVuY3Rpb24gYXQobyxlKXtpZih0eXBlb2YgZSE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcihgJHtvfSBtdXN0IGJlIGEgbnVtYmVyYCl9ZnVuY3Rpb24gZXQobyl7aWYoby5pc0VtcHR5KCkpdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBtYXRyaXggaGFzIG5vIGVsZW1lbnRzIHRvIGluZGV4Iil9ZnVuY3Rpb24gaGUobyl7bGV0IGU9Z3Qoby5yb3dzKTtmb3IobGV0IG49MDtuPG8ucm93czsrK24pZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KWVbbl0rPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gdWUobyl7bGV0IGU9Z3Qoby5jb2x1bW5zKTtmb3IobGV0IG49MDtuPG8ucm93czsrK24pZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KWVbdF0rPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gY2Uobyl7bGV0IGU9MDtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWUrPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gZmUobyl7bGV0IGU9Z3Qoby5yb3dzLDEpO2ZvcihsZXQgbj0wO248by5yb3dzOysrbilmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3QpZVtuXSo9by5nZXQobix0KTtyZXR1cm4gZX1mdW5jdGlvbiBnZShvKXtsZXQgZT1ndChvLmNvbHVtbnMsMSk7Zm9yKGxldCBuPTA7bjxvLnJvd3M7KytuKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCllW3RdKj1vLmdldChuLHQpO3JldHVybiBlfWZ1bmN0aW9uIGFlKG8pe2xldCBlPTE7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyllKj1vLmdldChuLHQpO3JldHVybiBlfWZ1bmN0aW9uIG1lKG8sZSxuKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPVtdO2ZvcihsZXQgaT0wO2k8dDtpKyspe2xldCBoPTAsbD0wLHU9MDtmb3IobGV0IGY9MDtmPHM7ZisrKXU9by5nZXQoaSxmKS1uW2ldLGgrPXUsbCs9dSp1O2U/ci5wdXNoKChsLWgqaC9zKS8ocy0xKSk6ci5wdXNoKChsLWgqaC9zKS9zKX1yZXR1cm4gcn1mdW5jdGlvbiB3ZShvLGUsbil7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHM7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7Zjx0O2YrKyl1PW8uZ2V0KGYsaSktbltpXSxoKz11LGwrPXUqdTtlP3IucHVzaCgobC1oKmgvdCkvKHQtMSkpOnIucHVzaCgobC1oKmgvdCkvdCl9cmV0dXJuIHJ9ZnVuY3Rpb24gcGUobyxlLG4pe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9dCpzO2xldCBpPTAsaD0wLGw9MDtmb3IobGV0IHU9MDt1PHQ7dSsrKWZvcihsZXQgZj0wO2Y8cztmKyspbD1vLmdldCh1LGYpLW4saSs9bCxoKz1sKmw7cmV0dXJuIGU/KGgtaSppL3IpLyhyLTEpOihoLWkqaS9yKS9yfWZ1bmN0aW9uIGRlKG8sZSl7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChuLHQsby5nZXQobix0KS1lW25dKX1mdW5jdGlvbiB5ZShvLGUpe2ZvcihsZXQgbj0wO248by5yb3dzO24rKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQobix0LG8uZ2V0KG4sdCktZVt0XSl9ZnVuY3Rpb24gTWUobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpLWUpfWZ1bmN0aW9uIEVlKG8pe2NvbnN0IGU9W107Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKXtsZXQgdD0wO2ZvcihsZXQgcz0wO3M8by5jb2x1bW5zO3MrKyl0Kz1NYXRoLnBvdyhvLmdldChuLHMpLDIpLyhvLmNvbHVtbnMtMSk7ZS5wdXNoKE1hdGguc3FydCh0KSl9cmV0dXJuIGV9ZnVuY3Rpb24gU2UobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpL2Vbbl0pfWZ1bmN0aW9uIGplKG8pe2NvbnN0IGU9W107Zm9yKGxldCBuPTA7bjxvLmNvbHVtbnM7bisrKXtsZXQgdD0wO2ZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyl0Kz1NYXRoLnBvdyhvLmdldChzLG4pLDIpLyhvLnJvd3MtMSk7ZS5wdXNoKE1hdGguc3FydCh0KSl9cmV0dXJuIGV9ZnVuY3Rpb24ga2UobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpL2VbdF0pfWZ1bmN0aW9uIGJlKG8pe2NvbnN0IGU9by5zaXplLTE7bGV0IG49MDtmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0KyspZm9yKGxldCBzPTA7czxvLnJvd3M7cysrKW4rPU1hdGgucG93KG8uZ2V0KHMsdCksMikvZTtyZXR1cm4gTWF0aC5zcXJ0KG4pfWZ1bmN0aW9uIEllKG8sZSl7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChuLHQsby5nZXQobix0KS9lKX1jbGFzcyBfe3N0YXRpYyBmcm9tMURBcnJheShlLG4sdCl7aWYoZSpuIT09dC5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoImRhdGEgbGVuZ3RoIGRvZXMgbm90IG1hdGNoIGdpdmVuIGRpbWVuc2lvbnMiKTtsZXQgcj1uZXcgSShlLG4pO2ZvcihsZXQgaT0wO2k8ZTtpKyspZm9yKGxldCBoPTA7aDxuO2grKylyLnNldChpLGgsdFtpKm4raF0pO3JldHVybiByfXN0YXRpYyByb3dWZWN0b3IoZSl7bGV0IG49bmV3IEkoMSxlLmxlbmd0aCk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspbi5zZXQoMCx0LGVbdF0pO3JldHVybiBufXN0YXRpYyBjb2x1bW5WZWN0b3IoZSl7bGV0IG49bmV3IEkoZS5sZW5ndGgsMSk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspbi5zZXQodCwwLGVbdF0pO3JldHVybiBufXN0YXRpYyB6ZXJvcyhlLG4pe3JldHVybiBuZXcgSShlLG4pfXN0YXRpYyBvbmVzKGUsbil7cmV0dXJuIG5ldyBJKGUsbikuZmlsbCgxKX1zdGF0aWMgcmFuZChlLG4sdD17fSl7aWYodHlwZW9mIHQhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHtyYW5kb206cz1NYXRoLnJhbmRvbX09dDtsZXQgcj1uZXcgSShlLG4pO2ZvcihsZXQgaT0wO2k8ZTtpKyspZm9yKGxldCBoPTA7aDxuO2grKylyLnNldChpLGgscygpKTtyZXR1cm4gcn1zdGF0aWMgcmFuZEludChlLG4sdD17fSl7aWYodHlwZW9mIHQhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46cz0wLG1heDpyPTFlMyxyYW5kb206aT1NYXRoLnJhbmRvbX09dDtpZighTnVtYmVyLmlzSW50ZWdlcihzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhbiBpbnRlZ2VyIik7aWYoIU51bWJlci5pc0ludGVnZXIocikpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKHM+PXIpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgaD1yLXMsbD1uZXcgSShlLG4pO2ZvcihsZXQgdT0wO3U8ZTt1KyspZm9yKGxldCBmPTA7ZjxuO2YrKyl7bGV0IGc9cytNYXRoLnJvdW5kKGkoKSpoKTtsLnNldCh1LGYsZyl9cmV0dXJuIGx9c3RhdGljIGV5ZShlLG4sdCl7bj09PXZvaWQgMCYmKG49ZSksdD09PXZvaWQgMCYmKHQ9MSk7bGV0IHM9TWF0aC5taW4oZSxuKSxyPXRoaXMuemVyb3MoZSxuKTtmb3IobGV0IGk9MDtpPHM7aSsrKXIuc2V0KGksaSx0KTtyZXR1cm4gcn1zdGF0aWMgZGlhZyhlLG4sdCl7bGV0IHM9ZS5sZW5ndGg7bj09PXZvaWQgMCYmKG49cyksdD09PXZvaWQgMCYmKHQ9bik7bGV0IHI9TWF0aC5taW4ocyxuLHQpLGk9dGhpcy56ZXJvcyhuLHQpO2ZvcihsZXQgaD0wO2g8cjtoKyspaS5zZXQoaCxoLGVbaF0pO3JldHVybiBpfXN0YXRpYyBtaW4oZSxuKXtlPXRoaXMuY2hlY2tNYXRyaXgoZSksbj10aGlzLmNoZWNrTWF0cml4KG4pO2xldCB0PWUucm93cyxzPWUuY29sdW1ucyxyPW5ldyBJKHQscyk7Zm9yKGxldCBpPTA7aTx0O2krKylmb3IobGV0IGg9MDtoPHM7aCsrKXIuc2V0KGksaCxNYXRoLm1pbihlLmdldChpLGgpLG4uZ2V0KGksaCkpKTtyZXR1cm4gcn1zdGF0aWMgbWF4KGUsbil7ZT10aGlzLmNoZWNrTWF0cml4KGUpLG49dGhpcy5jaGVja01hdHJpeChuKTtsZXQgdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgdGhpcyh0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5tYXgoZS5nZXQoaSxoKSxuLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIGNoZWNrTWF0cml4KGUpe3JldHVybiBfLmlzTWF0cml4KGUpP2U6bmV3IEkoZSl9c3RhdGljIGlzTWF0cml4KGUpe3JldHVybiBlIT1udWxsJiZlLmtsYXNzPT09Ik1hdHJpeCJ9Z2V0IHNpemUoKXtyZXR1cm4gdGhpcy5yb3dzKnRoaXMuY29sdW1uc31hcHBseShlKXtpZih0eXBlb2YgZSE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24iKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUuY2FsbCh0aGlzLG4sdCk7cmV0dXJuIHRoaXN9dG8xREFycmF5KCl7bGV0IGU9W107Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllLnB1c2godGhpcy5nZXQobix0KSk7cmV0dXJuIGV9dG8yREFycmF5KCl7bGV0IGU9W107Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKXtlLnB1c2goW10pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllW25dLnB1c2godGhpcy5nZXQobix0KSl9cmV0dXJuIGV9dG9KU09OKCl7cmV0dXJuIHRoaXMudG8yREFycmF5KCl9aXNSb3dWZWN0b3IoKXtyZXR1cm4gdGhpcy5yb3dzPT09MX1pc0NvbHVtblZlY3Rvcigpe3JldHVybiB0aGlzLmNvbHVtbnM9PT0xfWlzVmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF8fHRoaXMuY29sdW1ucz09PTF9aXNTcXVhcmUoKXtyZXR1cm4gdGhpcy5yb3dzPT09dGhpcy5jb2x1bW5zfWlzRW1wdHkoKXtyZXR1cm4gdGhpcy5yb3dzPT09MHx8dGhpcy5jb2x1bW5zPT09MH1pc1N5bW1ldHJpYygpe2lmKHRoaXMuaXNTcXVhcmUoKSl7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgbj0wO248PWU7bisrKWlmKHRoaXMuZ2V0KGUsbikhPT10aGlzLmdldChuLGUpKXJldHVybiExO3JldHVybiEwfXJldHVybiExfWlzRWNoZWxvbkZvcm0oKXtsZXQgZT0wLG49MCx0PS0xLHM9ITAscj0hMTtmb3IoO2U8dGhpcy5yb3dzJiZzOyl7Zm9yKG49MCxyPSExO248dGhpcy5jb2x1bW5zJiZyPT09ITE7KXRoaXMuZ2V0KGUsbik9PT0wP24rKzp0aGlzLmdldChlLG4pPT09MSYmbj50PyhyPSEwLHQ9bik6KHM9ITEscj0hMCk7ZSsrfXJldHVybiBzfWlzUmVkdWNlZEVjaGVsb25Gb3JtKCl7bGV0IGU9MCxuPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtlPHRoaXMucm93cyYmczspe2ZvcihuPTAscj0hMTtuPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChlLG4pPT09MD9uKys6dGhpcy5nZXQoZSxuKT09PTEmJm4+dD8ocj0hMCx0PW4pOihzPSExLHI9ITApO2ZvcihsZXQgaT1uKzE7aTx0aGlzLnJvd3M7aSsrKXRoaXMuZ2V0KGUsaSkhPT0wJiYocz0hMSk7ZSsrfXJldHVybiBzfWVjaGVsb25Gb3JtKCl7bGV0IGU9dGhpcy5jbG9uZSgpLG49MCx0PTA7Zm9yKDtuPGUucm93cyYmdDxlLmNvbHVtbnM7KXtsZXQgcz1uO2ZvcihsZXQgcj1uO3I8ZS5yb3dzO3IrKyllLmdldChyLHQpPmUuZ2V0KHMsdCkmJihzPXIpO2lmKGUuZ2V0KHMsdCk9PT0wKXQrKztlbHNle2Uuc3dhcFJvd3MobixzKTtsZXQgcj1lLmdldChuLHQpO2ZvcihsZXQgaT10O2k8ZS5jb2x1bW5zO2krKyllLnNldChuLGksZS5nZXQobixpKS9yKTtmb3IobGV0IGk9bisxO2k8ZS5yb3dzO2krKyl7bGV0IGg9ZS5nZXQoaSx0KS9lLmdldChuLHQpO2Uuc2V0KGksdCwwKTtmb3IobGV0IGw9dCsxO2w8ZS5jb2x1bW5zO2wrKyllLnNldChpLGwsZS5nZXQoaSxsKS1lLmdldChuLGwpKmgpfW4rKyx0Kyt9fXJldHVybiBlfXJlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBlPXRoaXMuZWNoZWxvbkZvcm0oKSxuPWUuY29sdW1ucyx0PWUucm93cyxzPXQtMTtmb3IoO3M+PTA7KWlmKGUubWF4Um93KHMpPT09MClzLS07ZWxzZXtsZXQgcj0wLGk9ITE7Zm9yKDtyPHQmJmk9PT0hMTspZS5nZXQocyxyKT09PTE/aT0hMDpyKys7Zm9yKGxldCBoPTA7aDxzO2grKyl7bGV0IGw9ZS5nZXQoaCxyKTtmb3IobGV0IHU9cjt1PG47dSsrKXtsZXQgZj1lLmdldChoLHUpLWwqZS5nZXQocyx1KTtlLnNldChoLHUsZil9fXMtLX1yZXR1cm4gZX1zZXQoKXt0aHJvdyBuZXcgRXJyb3IoInNldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfWdldCgpe3Rocm93IG5ldyBFcnJvcigiZ2V0IG1ldGhvZCBpcyB1bmltcGxlbWVudGVkIil9cmVwZWF0KGU9e30pe2lmKHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cm93czpuPTEsY29sdW1uczp0PTF9PWU7aWYoIU51bWJlci5pc0ludGVnZXIobil8fG48PTApdGhyb3cgbmV3IFR5cGVFcnJvcigicm93cyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHQpfHx0PD0wKXRocm93IG5ldyBUeXBlRXJyb3IoImNvbHVtbnMgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtsZXQgcz1uZXcgSSh0aGlzLnJvd3Mqbix0aGlzLmNvbHVtbnMqdCk7Zm9yKGxldCByPTA7cjxuO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXMuc2V0U3ViTWF0cml4KHRoaXMsdGhpcy5yb3dzKnIsdGhpcy5jb2x1bW5zKmkpO3JldHVybiBzfWZpbGwoZSl7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZSk7cmV0dXJuIHRoaXN9bmVnKCl7cmV0dXJuIHRoaXMubXVsUygtMSl9Z2V0Um93KGUpe1EodGhpcyxlKTtsZXQgbj1bXTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufWdldFJvd1ZlY3RvcihlKXtyZXR1cm4gSS5yb3dWZWN0b3IodGhpcy5nZXRSb3coZSkpfXNldFJvdyhlLG4pe1EodGhpcyxlKSxuPUEodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG5bdF0pO3JldHVybiB0aGlzfXN3YXBSb3dzKGUsbil7USh0aGlzLGUpLFEodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspe2xldCBzPXRoaXMuZ2V0KGUsdCk7dGhpcy5zZXQoZSx0LHRoaXMuZ2V0KG4sdCkpLHRoaXMuc2V0KG4sdCxzKX1yZXR1cm4gdGhpc31nZXRDb2x1bW4oZSl7Vyh0aGlzLGUpO2xldCBuPVtdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyluLnB1c2godGhpcy5nZXQodCxlKSk7cmV0dXJuIG59Z2V0Q29sdW1uVmVjdG9yKGUpe3JldHVybiBJLmNvbHVtblZlY3Rvcih0aGlzLmdldENvbHVtbihlKSl9c2V0Q29sdW1uKGUsbil7Vyh0aGlzLGUpLG49dHQodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspdGhpcy5zZXQodCxlLG5bdF0pO3JldHVybiB0aGlzfXN3YXBDb2x1bW5zKGUsbil7Vyh0aGlzLGUpLFcodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0Kyspe2xldCBzPXRoaXMuZ2V0KHQsZSk7dGhpcy5zZXQodCxlLHRoaXMuZ2V0KHQsbikpLHRoaXMuc2V0KHQsbixzKX1yZXR1cm4gdGhpc31hZGRSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KStlW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KS1lW3RdKTtyZXR1cm4gdGhpc31tdWxSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplW3RdKTtyZXR1cm4gdGhpc31kaXZSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KS9lW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3IoZSl7ZT10dCh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQobix0LHRoaXMuZ2V0KG4sdCkrZVtuXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKGUpe2U9dHQodGhpcyxlKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KG4sdCx0aGlzLmdldChuLHQpLWVbbl0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihlKXtlPXR0KHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplW25dKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3IoZSl7ZT10dCh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQobix0LHRoaXMuZ2V0KG4sdCkvZVtuXSk7cmV0dXJuIHRoaXN9bXVsUm93KGUsbil7USh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4oZSxuKXtXKHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsZSx0aGlzLmdldCh0LGUpKm4pO3JldHVybiB0aGlzfW1heCgpe2lmKHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuZ2V0KG4sdCk+ZSYmKGU9dGhpcy5nZXQobix0KSk7cmV0dXJuIGV9bWF4SW5kZXgoKXtldCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLDApLG49WzAsMF07Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldCh0LHMpPmUmJihlPXRoaXMuZ2V0KHQscyksblswXT10LG5bMV09cyk7cmV0dXJuIG59bWluKCl7aWYodGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLDApO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQobix0KTxlJiYoZT10aGlzLmdldChuLHQpKTtyZXR1cm4gZX1taW5JbmRleCgpe2V0KHRoaXMpO2xldCBlPXRoaXMuZ2V0KDAsMCksbj1bMCwwXTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSxuWzBdPXQsblsxXT1zKTtyZXR1cm4gbn1tYXhSb3coZSl7aWYoUSh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoZSwwKTtmb3IobGV0IHQ9MTt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQoZSx0KT5uJiYobj10aGlzLmdldChlLHQpKTtyZXR1cm4gbn1tYXhSb3dJbmRleChlKXtRKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoZSwwKSx0PVtlLDBdO2ZvcihsZXQgcz0xO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldChlLHMpPm4mJihuPXRoaXMuZ2V0KGUscyksdFsxXT1zKTtyZXR1cm4gdH1taW5Sb3coZSl7aWYoUSh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoZSwwKTtmb3IobGV0IHQ9MTt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQoZSx0KTxuJiYobj10aGlzLmdldChlLHQpKTtyZXR1cm4gbn1taW5Sb3dJbmRleChlKXtRKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoZSwwKSx0PVtlLDBdO2ZvcihsZXQgcz0xO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldChlLHMpPG4mJihuPXRoaXMuZ2V0KGUscyksdFsxXT1zKTtyZXR1cm4gdH1tYXhDb2x1bW4oZSl7aWYoVyh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoMCxlKTtmb3IobGV0IHQ9MTt0PHRoaXMucm93czt0KyspdGhpcy5nZXQodCxlKT5uJiYobj10aGlzLmdldCh0LGUpKTtyZXR1cm4gbn1tYXhDb2x1bW5JbmRleChlKXtXKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCxlKSx0PVswLGVdO2ZvcihsZXQgcz0xO3M8dGhpcy5yb3dzO3MrKyl0aGlzLmdldChzLGUpPm4mJihuPXRoaXMuZ2V0KHMsZSksdFswXT1zKTtyZXR1cm4gdH1taW5Db2x1bW4oZSl7aWYoVyh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoMCxlKTtmb3IobGV0IHQ9MTt0PHRoaXMucm93czt0KyspdGhpcy5nZXQodCxlKTxuJiYobj10aGlzLmdldCh0LGUpKTtyZXR1cm4gbn1taW5Db2x1bW5JbmRleChlKXtXKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCxlKSx0PVswLGVdO2ZvcihsZXQgcz0xO3M8dGhpcy5yb3dzO3MrKyl0aGlzLmdldChzLGUpPG4mJihuPXRoaXMuZ2V0KHMsZSksdFswXT1zKTtyZXR1cm4gdH1kaWFnKCl7bGV0IGU9TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksbj1bXTtmb3IobGV0IHQ9MDt0PGU7dCsrKW4ucHVzaCh0aGlzLmdldCh0LHQpKTtyZXR1cm4gbn1ub3JtKGU9ImZyb2Jlbml1cyIpe2xldCBuPTA7aWYoZT09PSJtYXgiKXJldHVybiB0aGlzLm1heCgpO2lmKGU9PT0iZnJvYmVuaXVzIil7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyluPW4rdGhpcy5nZXQodCxzKSp0aGlzLmdldCh0LHMpO3JldHVybiBNYXRoLnNxcnQobil9ZWxzZSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgdW5rbm93biBub3JtIHR5cGU6ICR7ZX1gKX1jdW11bGF0aXZlU3VtKCl7bGV0IGU9MDtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUrPXRoaXMuZ2V0KG4sdCksdGhpcy5zZXQobix0LGUpO3JldHVybiB0aGlzfWRvdChlKXtfLmlzTWF0cml4KGUpJiYoZT1lLnRvMURBcnJheSgpKTtsZXQgbj10aGlzLnRvMURBcnJheSgpO2lmKG4ubGVuZ3RoIT09ZS5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoInZlY3RvcnMgZG8gbm90IGhhdmUgdGhlIHNhbWUgc2l6ZSIpO2xldCB0PTA7Zm9yKGxldCBzPTA7czxuLmxlbmd0aDtzKyspdCs9bltzXSplW3NdO3JldHVybiB0fW1tdWwoZSl7ZT1JLmNoZWNrTWF0cml4KGUpO2xldCBuPXRoaXMucm93cyx0PXRoaXMuY29sdW1ucyxzPWUuY29sdW1ucyxyPW5ldyBJKG4scyksaT1uZXcgRmxvYXQ2NEFycmF5KHQpO2ZvcihsZXQgaD0wO2g8cztoKyspe2ZvcihsZXQgbD0wO2w8dDtsKyspaVtsXT1lLmdldChsLGgpO2ZvcihsZXQgbD0wO2w8bjtsKyspe2xldCB1PTA7Zm9yKGxldCBmPTA7Zjx0O2YrKyl1Kz10aGlzLmdldChsLGYpKmlbZl07ci5zZXQobCxoLHUpfX1yZXR1cm4gcn1zdHJhc3NlbjJ4MihlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49bmV3IEkoMiwyKTtjb25zdCB0PXRoaXMuZ2V0KDAsMCkscz1lLmdldCgwLDApLHI9dGhpcy5nZXQoMCwxKSxpPWUuZ2V0KDAsMSksaD10aGlzLmdldCgxLDApLGw9ZS5nZXQoMSwwKSx1PXRoaXMuZ2V0KDEsMSksZj1lLmdldCgxLDEpLGc9KHQrdSkqKHMrZiksYT0oaCt1KSpzLGo9dCooaS1mKSx3PXUqKGwtcykseT0odCtyKSpmLG09KGgtdCkqKHMraSksTT0oci11KSoobCtmKSx6PWcrdy15K00sRT1qK3ksaz1hK3csUj1nLWEraittO3JldHVybiBuLnNldCgwLDAseiksbi5zZXQoMCwxLEUpLG4uc2V0KDEsMCxrKSxuLnNldCgxLDEsUiksbn1zdHJhc3NlbjN4MyhlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49bmV3IEkoMywzKTtjb25zdCB0PXRoaXMuZ2V0KDAsMCkscz10aGlzLmdldCgwLDEpLHI9dGhpcy5nZXQoMCwyKSxpPXRoaXMuZ2V0KDEsMCksaD10aGlzLmdldCgxLDEpLGw9dGhpcy5nZXQoMSwyKSx1PXRoaXMuZ2V0KDIsMCksZj10aGlzLmdldCgyLDEpLGc9dGhpcy5nZXQoMiwyKSxhPWUuZ2V0KDAsMCksaj1lLmdldCgwLDEpLHc9ZS5nZXQoMCwyKSx5PWUuZ2V0KDEsMCksbT1lLmdldCgxLDEpLE09ZS5nZXQoMSwyKSx6PWUuZ2V0KDIsMCksRT1lLmdldCgyLDEpLGs9ZS5nZXQoMiwyKSxSPSh0K3Mrci1pLWgtZi1nKSptLHE9KHQtaSkqKC1qK20pLGI9aCooLWErait5LW0tTS16K2spLEY9KC10K2kraCkqKGEtaittKSxYPShpK2gpKigtYStqKSxjPXQqYSxwPSgtdCt1K2YpKihhLXcrTSksUz0oLXQrdSkqKHctTSksZD0odStmKSooLWErdyksUD0odCtzK3ItaC1sLXUtZikqTSxPPWYqKC1hK3creS1tLU0teitFKSxUPSgtcitmK2cpKihtK3otRSksRD0oci1nKSoobS1FKSxZPXIqeixHPShmK2cpKigteitFKSx2PSgtcitoK2wpKihNK3otayksVj0oci1sKSooTS1rKSxKPShoK2wpKigteitrKSxOPXMqeSxCPWwqRSwkPWkqdyxDPXUqaixVPWcqayx3dD1jK1krTixwdD1SK0YrWCtjK1QrWStHLGR0PWMrcCtkK1ArWSt2K0oscnQ9cStiK0YrYytZK3YrVixpdD1xK0YrWCtjK0IsbHQ9WSt2K1YrSiskLGp0PWMrcCtTK08rVCtEK1ksaHQ9VCtEK1krRytDLGt0PWMrcCtTK2QrVTtyZXR1cm4gbi5zZXQoMCwwLHd0KSxuLnNldCgwLDEscHQpLG4uc2V0KDAsMixkdCksbi5zZXQoMSwwLHJ0KSxuLnNldCgxLDEsaXQpLG4uc2V0KDEsMixsdCksbi5zZXQoMiwwLGp0KSxuLnNldCgyLDEsaHQpLG4uc2V0KDIsMixrdCksbn1tbXVsU3RyYXNzZW4oZSl7ZT1JLmNoZWNrTWF0cml4KGUpO2xldCBuPXRoaXMuY2xvbmUoKSx0PW4ucm93cyxzPW4uY29sdW1ucyxyPWUucm93cyxpPWUuY29sdW1ucztzIT09ciYmY29uc29sZS53YXJuKGBNdWx0aXBseWluZyAke3R9IHggJHtzfSBhbmQgJHtyfSB4ICR7aX0gbWF0cml4OiBkaW1lbnNpb25zIGRvIG5vdCBtYXRjaC5gKTtmdW5jdGlvbiBoKGcsYSxqKXtsZXQgdz1nLnJvd3MseT1nLmNvbHVtbnM7aWYodz09PWEmJnk9PT1qKXJldHVybiBnO3tsZXQgbT1fLnplcm9zKGEsaik7cmV0dXJuIG09bS5zZXRTdWJNYXRyaXgoZywwLDApLG19fWxldCBsPU1hdGgubWF4KHQsciksdT1NYXRoLm1heChzLGkpO249aChuLGwsdSksZT1oKGUsbCx1KTtmdW5jdGlvbiBmKGcsYSxqLHcpe2lmKGo8PTUxMnx8dzw9NTEyKXJldHVybiBnLm1tdWwoYSk7aiUyPT09MSYmdyUyPT09MT8oZz1oKGcsaisxLHcrMSksYT1oKGEsaisxLHcrMSkpOmolMj09PTE/KGc9aChnLGorMSx3KSxhPWgoYSxqKzEsdykpOnclMj09PTEmJihnPWgoZyxqLHcrMSksYT1oKGEsaix3KzEpKTtsZXQgeT1wYXJzZUludChnLnJvd3MvMiwxMCksbT1wYXJzZUludChnLmNvbHVtbnMvMiwxMCksTT1nLnN1Yk1hdHJpeCgwLHktMSwwLG0tMSksej1hLnN1Yk1hdHJpeCgwLHktMSwwLG0tMSksRT1nLnN1Yk1hdHJpeCgwLHktMSxtLGcuY29sdW1ucy0xKSxrPWEuc3ViTWF0cml4KDAseS0xLG0sYS5jb2x1bW5zLTEpLFI9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSwwLG0tMSkscT1hLnN1Yk1hdHJpeCh5LGEucm93cy0xLDAsbS0xKSxiPWcuc3ViTWF0cml4KHksZy5yb3dzLTEsbSxnLmNvbHVtbnMtMSksRj1hLnN1Yk1hdHJpeCh5LGEucm93cy0xLG0sYS5jb2x1bW5zLTEpLFg9ZihfLmFkZChNLGIpLF8uYWRkKHosRikseSxtKSxjPWYoXy5hZGQoUixiKSx6LHksbSkscD1mKE0sXy5zdWIoayxGKSx5LG0pLFM9ZihiLF8uc3ViKHEseikseSxtKSxkPWYoXy5hZGQoTSxFKSxGLHksbSksUD1mKF8uc3ViKFIsTSksXy5hZGQoeixrKSx5LG0pLE89ZihfLnN1YihFLGIpLF8uYWRkKHEsRikseSxtKSxUPV8uYWRkKFgsUyk7VC5zdWIoZCksVC5hZGQoTyk7bGV0IEQ9Xy5hZGQocCxkKSxZPV8uYWRkKGMsUyksRz1fLnN1YihYLGMpO0cuYWRkKHApLEcuYWRkKFApO2xldCB2PV8uemVyb3MoMipULnJvd3MsMipULmNvbHVtbnMpO3JldHVybiB2PXYuc2V0U3ViTWF0cml4KFQsMCwwKSx2PXYuc2V0U3ViTWF0cml4KEQsVC5yb3dzLDApLHY9di5zZXRTdWJNYXRyaXgoWSwwLFQuY29sdW1ucyksdj12LnNldFN1Yk1hdHJpeChHLFQucm93cyxULmNvbHVtbnMpLHYuc3ViTWF0cml4KDAsai0xLDAsdy0xKX1yZXR1cm4gZihuLGUsbCx1KX1zY2FsZVJvd3MoZT17fSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46bj0wLG1heDp0PTF9PWU7aWYoIU51bWJlci5pc0Zpbml0ZShuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhIG51bWJlciIpO2lmKCFOdW1iZXIuaXNGaW5pdGUodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYSBudW1iZXIiKTtpZihuPj10KXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IHM9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCByPTA7cjx0aGlzLnJvd3M7cisrKXtjb25zdCBpPXRoaXMuZ2V0Um93KHIpO2kubGVuZ3RoPjAmJnF0KGkse21pbjpuLG1heDp0LG91dHB1dDppfSkscy5zZXRSb3cocixpKX1yZXR1cm4gc31zY2FsZUNvbHVtbnMoZT17fSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46bj0wLG1heDp0PTF9PWU7aWYoIU51bWJlci5pc0Zpbml0ZShuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhIG51bWJlciIpO2lmKCFOdW1iZXIuaXNGaW5pdGUodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYSBudW1iZXIiKTtpZihuPj10KXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IHM9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXtjb25zdCBpPXRoaXMuZ2V0Q29sdW1uKHIpO2kubGVuZ3RoJiZxdChpLHttaW46bixtYXg6dCxvdXRwdXQ6aX0pLHMuc2V0Q29sdW1uKHIsaSl9cmV0dXJuIHN9ZmxpcFJvd3MoKXtjb25zdCBlPU1hdGguY2VpbCh0aGlzLmNvbHVtbnMvMik7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8ZTt0Kyspe2xldCBzPXRoaXMuZ2V0KG4sdCkscj10aGlzLmdldChuLHRoaXMuY29sdW1ucy0xLXQpO3RoaXMuc2V0KG4sdCxyKSx0aGlzLnNldChuLHRoaXMuY29sdW1ucy0xLXQscyl9cmV0dXJuIHRoaXN9ZmxpcENvbHVtbnMoKXtjb25zdCBlPU1hdGguY2VpbCh0aGlzLnJvd3MvMik7Zm9yKGxldCBuPTA7bjx0aGlzLmNvbHVtbnM7bisrKWZvcihsZXQgdD0wO3Q8ZTt0Kyspe2xldCBzPXRoaXMuZ2V0KHQsbikscj10aGlzLmdldCh0aGlzLnJvd3MtMS10LG4pO3RoaXMuc2V0KHQsbixyKSx0aGlzLnNldCh0aGlzLnJvd3MtMS10LG4scyl9cmV0dXJuIHRoaXN9a3JvbmVja2VyUHJvZHVjdChlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9ZS5yb3dzLHI9ZS5jb2x1bW5zLGk9bmV3IEkobipzLHQqcik7Zm9yKGxldCBoPTA7aDxuO2grKylmb3IobGV0IGw9MDtsPHQ7bCsrKWZvcihsZXQgdT0wO3U8czt1KyspZm9yKGxldCBmPTA7ZjxyO2YrKylpLnNldChzKmgrdSxyKmwrZix0aGlzLmdldChoLGwpKmUuZ2V0KHUsZikpO3JldHVybiBpfXRyYW5zcG9zZSgpe2xldCBlPW5ldyBJKHRoaXMuY29sdW1ucyx0aGlzLnJvd3MpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZS5zZXQodCxuLHRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfXNvcnRSb3dzKGU9VHQpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKyl0aGlzLnNldFJvdyhuLHRoaXMuZ2V0Um93KG4pLnNvcnQoZSkpO3JldHVybiB0aGlzfXNvcnRDb2x1bW5zKGU9VHQpe2ZvcihsZXQgbj0wO248dGhpcy5jb2x1bW5zO24rKyl0aGlzLnNldENvbHVtbihuLHRoaXMuZ2V0Q29sdW1uKG4pLnNvcnQoZSkpO3JldHVybiB0aGlzfXN1Yk1hdHJpeChlLG4sdCxzKXtGdCh0aGlzLGUsbix0LHMpO2xldCByPW5ldyBJKG4tZSsxLHMtdCsxKTtmb3IobGV0IGk9ZTtpPD1uO2krKylmb3IobGV0IGg9dDtoPD1zO2grKylyLnNldChpLWUsaC10LHRoaXMuZ2V0KGksaCkpO3JldHVybiByfXN1Yk1hdHJpeFJvdyhlLG4sdCl7aWYobj09PXZvaWQgMCYmKG49MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5jb2x1bW5zLTEpLG4+dHx8bjwwfHxuPj10aGlzLmNvbHVtbnN8fHQ8MHx8dD49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgSShlLmxlbmd0aCx0LW4rMSk7Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKyspZm9yKGxldCBpPW47aTw9dDtpKyspe2lmKGVbcl08MHx8ZVtyXT49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKGBSb3cgaW5kZXggb3V0IG9mIHJhbmdlOiAke2Vbcl19YCk7cy5zZXQocixpLW4sdGhpcy5nZXQoZVtyXSxpKSl9cmV0dXJuIHN9c3ViTWF0cml4Q29sdW1uKGUsbix0KXtpZihuPT09dm9pZCAwJiYobj0wKSx0PT09dm9pZCAwJiYodD10aGlzLnJvd3MtMSksbj50fHxuPDB8fG4+PXRoaXMucm93c3x8dDwwfHx0Pj10aGlzLnJvd3MpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkFyZ3VtZW50IG91dCBvZiByYW5nZSIpO2xldCBzPW5ldyBJKHQtbisxLGUubGVuZ3RoKTtmb3IobGV0IHI9MDtyPGUubGVuZ3RoO3IrKylmb3IobGV0IGk9bjtpPD10O2krKyl7aWYoZVtyXTwwfHxlW3JdPj10aGlzLmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoYENvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2U6ICR7ZVtyXX1gKTtzLnNldChpLW4scix0aGlzLmdldChpLGVbcl0pKX1yZXR1cm4gc31zZXRTdWJNYXRyaXgoZSxuLHQpe2lmKGU9SS5jaGVja01hdHJpeChlKSxlLmlzRW1wdHkoKSlyZXR1cm4gdGhpcztsZXQgcz1uK2Uucm93cy0xLHI9dCtlLmNvbHVtbnMtMTtGdCh0aGlzLG4scyx0LHIpO2ZvcihsZXQgaT0wO2k8ZS5yb3dzO2krKylmb3IobGV0IGg9MDtoPGUuY29sdW1ucztoKyspdGhpcy5zZXQobitpLHQraCxlLmdldChpLGgpKTtyZXR1cm4gdGhpc31zZWxlY3Rpb24oZSxuKXtsZXQgdD1yZSh0aGlzLGUsbikscz1uZXcgSShlLmxlbmd0aCxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjx0LnJvdy5sZW5ndGg7cisrKXtsZXQgaT10LnJvd1tyXTtmb3IobGV0IGg9MDtoPHQuY29sdW1uLmxlbmd0aDtoKyspe2xldCBsPXQuY29sdW1uW2hdO3Muc2V0KHIsaCx0aGlzLmdldChpLGwpKX19cmV0dXJuIHN9dHJhY2UoKXtsZXQgZT1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxuPTA7Zm9yKGxldCB0PTA7dDxlO3QrKyluKz10aGlzLmdldCh0LHQpO3JldHVybiBufWNsb25lKCl7bGV0IGU9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllLnNldChuLHQsdGhpcy5nZXQobix0KSk7cmV0dXJuIGV9c3VtKGUpe3N3aXRjaChlKXtjYXNlInJvdyI6cmV0dXJuIGhlKHRoaXMpO2Nhc2UiY29sdW1uIjpyZXR1cm4gdWUodGhpcyk7Y2FzZSB2b2lkIDA6cmV0dXJuIGNlKHRoaXMpO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX1wcm9kdWN0KGUpe3N3aXRjaChlKXtjYXNlInJvdyI6cmV0dXJuIGZlKHRoaXMpO2Nhc2UiY29sdW1uIjpyZXR1cm4gZ2UodGhpcyk7Y2FzZSB2b2lkIDA6cmV0dXJuIGFlKHRoaXMpO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX1tZWFuKGUpe2NvbnN0IG49dGhpcy5zdW0oZSk7c3dpdGNoKGUpe2Nhc2Uicm93Ijp7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKW5bdF0vPXRoaXMuY29sdW1ucztyZXR1cm4gbn1jYXNlImNvbHVtbiI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluW3RdLz10aGlzLnJvd3M7cmV0dXJuIG59Y2FzZSB2b2lkIDA6cmV0dXJuIG4vdGhpcy5zaXplO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX12YXJpYW5jZShlLG49e30pe2lmKHR5cGVvZiBlPT0ib2JqZWN0IiYmKG49ZSxlPXZvaWQgMCksdHlwZW9mIG4hPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHt1bmJpYXNlZDp0PSEwLG1lYW46cz10aGlzLm1lYW4oZSl9PW47aWYodHlwZW9mIHQhPSJib29sZWFuIil0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmJpYXNlZCBtdXN0IGJlIGEgYm9vbGVhbiIpO3N3aXRjaChlKXtjYXNlInJvdyI6e2lmKCFBcnJheS5pc0FycmF5KHMpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBtZSh0aGlzLHQscyl9Y2FzZSJjb2x1bW4iOntpZighQXJyYXkuaXNBcnJheShzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gd2UodGhpcyx0LHMpfWNhc2Ugdm9pZCAwOntpZih0eXBlb2YgcyE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGEgbnVtYmVyIik7cmV0dXJuIHBlKHRoaXMsdCxzKX1kZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7ZX1gKX19c3RhbmRhcmREZXZpYXRpb24oZSxuKXt0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApO2NvbnN0IHQ9dGhpcy52YXJpYW5jZShlLG4pO2lmKGU9PT12b2lkIDApcmV0dXJuIE1hdGguc3FydCh0KTtmb3IobGV0IHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdPU1hdGguc3FydCh0W3NdKTtyZXR1cm4gdH1jZW50ZXIoZSxuPXt9KXtpZih0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApLHR5cGVvZiBuIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7Y2VudGVyOnQ9dGhpcy5tZWFuKGUpfT1uO3N3aXRjaChlKXtjYXNlInJvdyI6e2lmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGRlKHRoaXMsdCksdGhpc31jYXNlImNvbHVtbiI6e2lmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHllKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGEgbnVtYmVyIik7cmV0dXJuIE1lKHRoaXMsdCksdGhpc31kZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7ZX1gKX19c2NhbGUoZSxuPXt9KXtpZih0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApLHR5cGVvZiBuIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7bGV0IHQ9bi5zY2FsZTtzd2l0Y2goZSl7Y2FzZSJyb3ciOntpZih0PT09dm9pZCAwKXQ9RWUodGhpcyk7ZWxzZSBpZighQXJyYXkuaXNBcnJheSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIFNlKHRoaXMsdCksdGhpc31jYXNlImNvbHVtbiI6e2lmKHQ9PT12b2lkIDApdD1qZSh0aGlzKTtlbHNlIGlmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4ga2UodGhpcyx0KSx0aGlzfWNhc2Ugdm9pZCAwOntpZih0PT09dm9pZCAwKXQ9YmUodGhpcyk7ZWxzZSBpZih0eXBlb2YgdCE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBJZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke2V9YCl9fXRvU3RyaW5nKGUpe3JldHVybiB6dCh0aGlzLGUpfX1fLnByb3RvdHlwZS5rbGFzcz0iTWF0cml4Iix0eXBlb2YgU3ltYm9sPCJ1IiYmKF8ucHJvdG90eXBlW1N5bWJvbC5mb3IoIm5vZGVqcy51dGlsLmluc3BlY3QuY3VzdG9tIildPWVlKTtmdW5jdGlvbiBUdChvLGUpe3JldHVybiBvLWV9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgSSBleHRlbmRzIF97Y29uc3RydWN0b3IoZSxuKXtpZihzdXBlcigpLEkuaXNNYXRyaXgoZSkpcmV0dXJuIGUuY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWZvcihsZXQgdD0wO3Q8ZTt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShuKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoQXJyYXkuaXNBcnJheShlKSl7Y29uc3QgdD1lO2lmKGU9dC5sZW5ndGgsbj1lP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxlO3MrKyl7aWYodFtzXS5sZW5ndGghPT1uKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPWUsdGhpcy5jb2x1bW5zPW59c2V0KGUsbix0KXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dPXQsdGhpc31nZXQoZSxuKXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dfXJlbW92ZVJvdyhlKXtyZXR1cm4gUSh0aGlzLGUpLHRoaXMuZGF0YS5zcGxpY2UoZSwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3coZSxuKXtyZXR1cm4gbj09PXZvaWQgMCYmKG49ZSxlPXRoaXMucm93cyksUSh0aGlzLGUsITApLG49RmxvYXQ2NEFycmF5LmZyb20oQSh0aGlzLG4pKSx0aGlzLmRhdGEuc3BsaWNlKGUsMCxuKSx0aGlzLnJvd3MrPTEsdGhpc31yZW1vdmVDb2x1bW4oZSl7Vyh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKyl7Y29uc3QgdD1uZXcgRmxvYXQ2NEFycmF5KHRoaXMuY29sdW1ucy0xKTtmb3IobGV0IHM9MDtzPGU7cysrKXRbc109dGhpcy5kYXRhW25dW3NdO2ZvcihsZXQgcz1lKzE7czx0aGlzLmNvbHVtbnM7cysrKXRbcy0xXT10aGlzLmRhdGFbbl1bc107dGhpcy5kYXRhW25dPXR9cmV0dXJuIHRoaXMuY29sdW1ucy09MSx0aGlzfWFkZENvbHVtbihlLG4pe3R5cGVvZiBuPiJ1IiYmKG49ZSxlPXRoaXMuY29sdW1ucyksVyh0aGlzLGUsITApLG49dHQodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0Kyspe2NvbnN0IHM9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMrMSk7bGV0IHI9MDtmb3IoO3I8ZTtyKyspc1tyXT10aGlzLmRhdGFbdF1bcl07Zm9yKHNbcisrXT1uW3RdO3I8dGhpcy5jb2x1bW5zKzE7cisrKXNbcl09dGhpcy5kYXRhW3RdW3ItMV07dGhpcy5kYXRhW3RdPXN9cmV0dXJuIHRoaXMuY29sdW1ucys9MSx0aGlzfX1vZShfLEkpO2NsYXNzIG50IGV4dGVuZHMgX3tjb25zdHJ1Y3RvcihlKXtzdXBlcigpLHRoaXMuZGF0YT1lLHRoaXMucm93cz1lLmxlbmd0aCx0aGlzLmNvbHVtbnM9ZVswXS5sZW5ndGh9c2V0KGUsbix0KXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dPXQsdGhpc31nZXQoZSxuKXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dfX1jbGFzcyBSZXtjb25zdHJ1Y3RvcihlKXtlPW50LmNoZWNrTWF0cml4KGUpO2xldCBuPWUuY2xvbmUoKSx0PW4ucm93cyxzPW4uY29sdW1ucyxyPW5ldyBGbG9hdDY0QXJyYXkodCksaT0xLGgsbCx1LGYsZyxhLGosdyx5O2ZvcihoPTA7aDx0O2grKylyW2hdPWg7Zm9yKHc9bmV3IEZsb2F0NjRBcnJheSh0KSxsPTA7bDxzO2wrKyl7Zm9yKGg9MDtoPHQ7aCsrKXdbaF09bi5nZXQoaCxsKTtmb3IoaD0wO2g8dDtoKyspe2Zvcih5PU1hdGgubWluKGgsbCksZz0wLHU9MDt1PHk7dSsrKWcrPW4uZ2V0KGgsdSkqd1t1XTt3W2hdLT1nLG4uc2V0KGgsbCx3W2hdKX1mb3IoZj1sLGg9bCsxO2g8dDtoKyspTWF0aC5hYnMod1toXSk+TWF0aC5hYnMod1tmXSkmJihmPWgpO2lmKGYhPT1sKXtmb3IodT0wO3U8czt1KyspYT1uLmdldChmLHUpLG4uc2V0KGYsdSxuLmdldChsLHUpKSxuLnNldChsLHUsYSk7aj1yW2ZdLHJbZl09cltsXSxyW2xdPWosaT0taX1pZihsPHQmJm4uZ2V0KGwsbCkhPT0wKWZvcihoPWwrMTtoPHQ7aCsrKW4uc2V0KGgsbCxuLmdldChoLGwpL24uZ2V0KGwsbCkpfXRoaXMuTFU9bix0aGlzLnBpdm90VmVjdG9yPXIsdGhpcy5waXZvdFNpZ249aX1pc1Npbmd1bGFyKCl7bGV0IGU9dGhpcy5MVSxuPWUuY29sdW1ucztmb3IobGV0IHQ9MDt0PG47dCsrKWlmKGUuZ2V0KHQsdCk9PT0wKXJldHVybiEwO3JldHVybiExfXNvbHZlKGUpe2U9SS5jaGVja01hdHJpeChlKTtsZXQgbj10aGlzLkxVO2lmKG4ucm93cyE9PWUucm93cyl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgbWF0cml4IGRpbWVuc2lvbnMiKTtpZih0aGlzLmlzU2luZ3VsYXIoKSl0aHJvdyBuZXcgRXJyb3IoIkxVIG1hdHJpeCBpcyBzaW5ndWxhciIpO2xldCBzPWUuY29sdW1ucyxyPWUuc3ViTWF0cml4Um93KHRoaXMucGl2b3RWZWN0b3IsMCxzLTEpLGk9bi5jb2x1bW5zLGgsbCx1O2Zvcih1PTA7dTxpO3UrKylmb3IoaD11KzE7aDxpO2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSpuLmdldChoLHUpKTtmb3IodT1pLTE7dT49MDt1LS0pe2ZvcihsPTA7bDxzO2wrKylyLnNldCh1LGwsci5nZXQodSxsKS9uLmdldCh1LHUpKTtmb3IoaD0wO2g8dTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqbi5nZXQoaCx1KSl9cmV0dXJuIHJ9Z2V0IGRldGVybWluYW50KCl7bGV0IGU9dGhpcy5MVTtpZighZS5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgc3F1YXJlIik7bGV0IG49dGhpcy5waXZvdFNpZ24sdD1lLmNvbHVtbnM7Zm9yKGxldCBzPTA7czx0O3MrKyluKj1lLmdldChzLHMpO3JldHVybiBufWdldCBsb3dlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLkxVLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KTtmb3IobGV0IHI9MDtyPG47cisrKWZvcihsZXQgaT0wO2k8dDtpKyspcj5pP3Muc2V0KHIsaSxlLmdldChyLGkpKTpyPT09aT9zLnNldChyLGksMSk6cy5zZXQocixpLDApO3JldHVybiBzfWdldCB1cHBlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLkxVLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KTtmb3IobGV0IHI9MDtyPG47cisrKWZvcihsZXQgaT0wO2k8dDtpKyspcjw9aT9zLnNldChyLGksZS5nZXQocixpKSk6cy5zZXQocixpLDApO3JldHVybiBzfWdldCBwaXZvdFBlcm11dGF0aW9uVmVjdG9yKCl7cmV0dXJuIEFycmF5LmZyb20odGhpcy5waXZvdFZlY3Rvcil9fWZ1bmN0aW9uIFoobyxlKXtsZXQgbj0wO3JldHVybiBNYXRoLmFicyhvKT5NYXRoLmFicyhlKT8obj1lL28sTWF0aC5hYnMobykqTWF0aC5zcXJ0KDErbipuKSk6ZSE9PTA/KG49by9lLE1hdGguYWJzKGUpKk1hdGguc3FydCgxK24qbikpOjB9Y2xhc3MgdmV7Y29uc3RydWN0b3IoZSl7ZT1udC5jaGVja01hdHJpeChlKTtsZXQgbj1lLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHMpLGksaCxsLHU7Zm9yKGw9MDtsPHM7bCsrKXtsZXQgZj0wO2ZvcihpPWw7aTx0O2krKylmPVooZixuLmdldChpLGwpKTtpZihmIT09MCl7Zm9yKG4uZ2V0KGwsbCk8MCYmKGY9LWYpLGk9bDtpPHQ7aSsrKW4uc2V0KGksbCxuLmdldChpLGwpL2YpO2ZvcihuLnNldChsLGwsbi5nZXQobCxsKSsxKSxoPWwrMTtoPHM7aCsrKXtmb3IodT0wLGk9bDtpPHQ7aSsrKXUrPW4uZ2V0KGksbCkqbi5nZXQoaSxoKTtmb3IodT0tdS9uLmdldChsLGwpLGk9bDtpPHQ7aSsrKW4uc2V0KGksaCxuLmdldChpLGgpK3Uqbi5nZXQoaSxsKSl9fXJbbF09LWZ9dGhpcy5RUj1uLHRoaXMuUmRpYWc9cn1zb2x2ZShlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49dGhpcy5RUix0PW4ucm93cztpZihlLnJvd3MhPT10KXRocm93IG5ldyBFcnJvcigiTWF0cml4IHJvdyBkaW1lbnNpb25zIG11c3QgYWdyZWUiKTtpZighdGhpcy5pc0Z1bGxSYW5rKCkpdGhyb3cgbmV3IEVycm9yKCJNYXRyaXggaXMgcmFuayBkZWZpY2llbnQiKTtsZXQgcz1lLmNvbHVtbnMscj1lLmNsb25lKCksaT1uLmNvbHVtbnMsaCxsLHUsZjtmb3IodT0wO3U8aTt1KyspZm9yKGw9MDtsPHM7bCsrKXtmb3IoZj0wLGg9dTtoPHQ7aCsrKWYrPW4uZ2V0KGgsdSkqci5nZXQoaCxsKTtmb3IoZj0tZi9uLmdldCh1LHUpLGg9dTtoPHQ7aCsrKXIuc2V0KGgsbCxyLmdldChoLGwpK2Yqbi5nZXQoaCx1KSl9Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvdGhpcy5SZGlhZ1t1XSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKm4uZ2V0KGgsdSkpfXJldHVybiByLnN1Yk1hdHJpeCgwLGktMSwwLHMtMSl9aXNGdWxsUmFuaygpe2xldCBlPXRoaXMuUVIuY29sdW1ucztmb3IobGV0IG49MDtuPGU7bisrKWlmKHRoaXMuUmRpYWdbbl09PT0wKXJldHVybiExO3JldHVybiEwfWdldCB1cHBlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLlFSLG49ZS5jb2x1bW5zLHQ9bmV3IEkobixuKSxzLHI7Zm9yKHM9MDtzPG47cysrKWZvcihyPTA7cjxuO3IrKylzPHI/dC5zZXQocyxyLGUuZ2V0KHMscikpOnM9PT1yP3Quc2V0KHMscix0aGlzLlJkaWFnW3NdKTp0LnNldChzLHIsMCk7cmV0dXJuIHR9Z2V0IG9ydGhvZ29uYWxNYXRyaXgoKXtsZXQgZT10aGlzLlFSLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KSxyLGksaCxsO2ZvcihoPXQtMTtoPj0wO2gtLSl7Zm9yKHI9MDtyPG47cisrKXMuc2V0KHIsaCwwKTtmb3Iocy5zZXQoaCxoLDEpLGk9aDtpPHQ7aSsrKWlmKGUuZ2V0KGgsaCkhPT0wKXtmb3IobD0wLHI9aDtyPG47cisrKWwrPWUuZ2V0KHIsaCkqcy5nZXQocixpKTtmb3IobD0tbC9lLmdldChoLGgpLHI9aDtyPG47cisrKXMuc2V0KHIsaSxzLmdldChyLGkpK2wqZS5nZXQocixoKSl9fXJldHVybiBzfX1jbGFzcyBEdHtjb25zdHJ1Y3RvcihlLG49e30pe2lmKGU9bnQuY2hlY2tNYXRyaXgoZSksZS5pc0VtcHR5KCkpdGhyb3cgbmV3IEVycm9yKCJNYXRyaXggbXVzdCBiZSBub24tZW1wdHkiKTtsZXQgdD1lLnJvd3Mscz1lLmNvbHVtbnM7Y29uc3R7Y29tcHV0ZUxlZnRTaW5ndWxhclZlY3RvcnM6cj0hMCxjb21wdXRlUmlnaHRTaW5ndWxhclZlY3RvcnM6aT0hMCxhdXRvVHJhbnNwb3NlOmg9ITF9PW47bGV0IGw9Qm9vbGVhbihyKSx1PUJvb2xlYW4oaSksZj0hMSxnO2lmKHQ8cylpZighaClnPWUuY2xvbmUoKSxjb25zb2xlLndhcm4oIkNvbXB1dGluZyBTVkQgb24gYSBtYXRyaXggd2l0aCBtb3JlIGNvbHVtbnMgdGhhbiByb3dzLiBDb25zaWRlciBlbmFibGluZyBhdXRvVHJhbnNwb3NlIik7ZWxzZXtnPWUudHJhbnNwb3NlKCksdD1nLnJvd3Mscz1nLmNvbHVtbnMsZj0hMDtsZXQgYz1sO2w9dSx1PWN9ZWxzZSBnPWUuY2xvbmUoKTtsZXQgYT1NYXRoLm1pbih0LHMpLGo9TWF0aC5taW4odCsxLHMpLHc9bmV3IEZsb2F0NjRBcnJheShqKSx5PW5ldyBJKHQsYSksbT1uZXcgSShzLHMpLE09bmV3IEZsb2F0NjRBcnJheShzKSx6PW5ldyBGbG9hdDY0QXJyYXkodCksRT1uZXcgRmxvYXQ2NEFycmF5KGopO2ZvcihsZXQgYz0wO2M8ajtjKyspRVtjXT1jO2xldCBrPU1hdGgubWluKHQtMSxzKSxSPU1hdGgubWF4KDAsTWF0aC5taW4ocy0yLHQpKSxxPU1hdGgubWF4KGssUik7Zm9yKGxldCBjPTA7YzxxO2MrKyl7aWYoYzxrKXt3W2NdPTA7Zm9yKGxldCBwPWM7cDx0O3ArKyl3W2NdPVood1tjXSxnLmdldChwLGMpKTtpZih3W2NdIT09MCl7Zy5nZXQoYyxjKTwwJiYod1tjXT0td1tjXSk7Zm9yKGxldCBwPWM7cDx0O3ArKylnLnNldChwLGMsZy5nZXQocCxjKS93W2NdKTtnLnNldChjLGMsZy5nZXQoYyxjKSsxKX13W2NdPS13W2NdfWZvcihsZXQgcD1jKzE7cDxzO3ArKyl7aWYoYzxrJiZ3W2NdIT09MCl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPWcuZ2V0KGQsYykqZy5nZXQoZCxwKTtTPS1TL2cuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKylnLnNldChkLHAsZy5nZXQoZCxwKStTKmcuZ2V0KGQsYykpfU1bcF09Zy5nZXQoYyxwKX1pZihsJiZjPGspZm9yKGxldCBwPWM7cDx0O3ArKyl5LnNldChwLGMsZy5nZXQocCxjKSk7aWYoYzxSKXtNW2NdPTA7Zm9yKGxldCBwPWMrMTtwPHM7cCsrKU1bY109WihNW2NdLE1bcF0pO2lmKE1bY10hPT0wKXtNW2MrMV08MCYmKE1bY109MC1NW2NdKTtmb3IobGV0IHA9YysxO3A8cztwKyspTVtwXS89TVtjXTtNW2MrMV0rPTF9aWYoTVtjXT0tTVtjXSxjKzE8dCYmTVtjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDx0O3ArKyl6W3BdPTA7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKWZvcihsZXQgUz1jKzE7UzxzO1MrKyl6W3BdKz1NW1NdKmcuZ2V0KHAsUyk7Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0tTVtwXS9NW2MrMV07Zm9yKGxldCBkPWMrMTtkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqeltkXSl9fWlmKHUpZm9yKGxldCBwPWMrMTtwPHM7cCsrKW0uc2V0KHAsYyxNW3BdKX19bGV0IGI9TWF0aC5taW4ocyx0KzEpO2lmKGs8cyYmKHdba109Zy5nZXQoayxrKSksdDxiJiYod1tiLTFdPTApLFIrMTxiJiYoTVtSXT1nLmdldChSLGItMSkpLE1bYi0xXT0wLGwpe2ZvcihsZXQgYz1rO2M8YTtjKyspe2ZvcihsZXQgcD0wO3A8dDtwKyspeS5zZXQocCxjLDApO3kuc2V0KGMsYywxKX1mb3IobGV0IGM9ay0xO2M+PTA7Yy0tKWlmKHdbY10hPT0wKXtmb3IobGV0IHA9YysxO3A8YTtwKyspe2xldCBTPTA7Zm9yKGxldCBkPWM7ZDx0O2QrKylTKz15LmdldChkLGMpKnkuZ2V0KGQscCk7Uz0tUy95LmdldChjLGMpO2ZvcihsZXQgZD1jO2Q8dDtkKyspeS5zZXQoZCxwLHkuZ2V0KGQscCkrUyp5LmdldChkLGMpKX1mb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYywteS5nZXQocCxjKSk7eS5zZXQoYyxjLDEreS5nZXQoYyxjKSk7Zm9yKGxldCBwPTA7cDxjLTE7cCsrKXkuc2V0KHAsYywwKX1lbHNle2ZvcihsZXQgcD0wO3A8dDtwKyspeS5zZXQocCxjLDApO3kuc2V0KGMsYywxKX19aWYodSlmb3IobGV0IGM9cy0xO2M+PTA7Yy0tKXtpZihjPFImJk1bY10hPT0wKWZvcihsZXQgcD1jKzE7cDxzO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YysxO2Q8cztkKyspUys9bS5nZXQoZCxjKSptLmdldChkLHApO1M9LVMvbS5nZXQoYysxLGMpO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKyltLnNldChkLHAsbS5nZXQoZCxwKStTKm0uZ2V0KGQsYykpfWZvcihsZXQgcD0wO3A8cztwKyspbS5zZXQocCxjLDApO20uc2V0KGMsYywxKX1sZXQgRj1iLTEsWD1OdW1iZXIuRVBTSUxPTjtmb3IoO2I+MDspe2xldCBjLHA7Zm9yKGM9Yi0yO2M+PS0xJiZjIT09LTE7Yy0tKXtjb25zdCBTPU51bWJlci5NSU5fVkFMVUUrWCpNYXRoLmFicyh3W2NdK01hdGguYWJzKHdbYysxXSkpO2lmKE1hdGguYWJzKE1bY10pPD1TfHxOdW1iZXIuaXNOYU4oTVtjXSkpe01bY109MDticmVha319aWYoYz09PWItMilwPTQ7ZWxzZXtsZXQgUztmb3IoUz1iLTE7Uz49YyYmUyE9PWM7Uy0tKXtsZXQgZD0oUyE9PWI/TWF0aC5hYnMoTVtTXSk6MCkrKFMhPT1jKzE/TWF0aC5hYnMoTVtTLTFdKTowKTtpZihNYXRoLmFicyh3W1NdKTw9WCpkKXt3W1NdPTA7YnJlYWt9fVM9PT1jP3A9MzpTPT09Yi0xP3A9MToocD0yLGM9Uyl9c3dpdGNoKGMrKyxwKXtjYXNlIDE6e2xldCBTPU1bYi0yXTtNW2ItMl09MDtmb3IobGV0IGQ9Yi0yO2Q+PWM7ZC0tKXtsZXQgUD1aKHdbZF0sUyksTz13W2RdL1AsVD1TL1A7aWYod1tkXT1QLGQhPT1jJiYoUz0tVCpNW2QtMV0sTVtkLTFdPU8qTVtkLTFdKSx1KWZvcihsZXQgRD0wO0Q8cztEKyspUD1PKm0uZ2V0KEQsZCkrVCptLmdldChELGItMSksbS5zZXQoRCxiLTEsLVQqbS5nZXQoRCxkKStPKm0uZ2V0KEQsYi0xKSksbS5zZXQoRCxkLFApfWJyZWFrfWNhc2UgMjp7bGV0IFM9TVtjLTFdO01bYy0xXT0wO2ZvcihsZXQgZD1jO2Q8YjtkKyspe2xldCBQPVood1tkXSxTKSxPPXdbZF0vUCxUPVMvUDtpZih3W2RdPVAsUz0tVCpNW2RdLE1bZF09TypNW2RdLGwpZm9yKGxldCBEPTA7RDx0O0QrKylQPU8qeS5nZXQoRCxkKStUKnkuZ2V0KEQsYy0xKSx5LnNldChELGMtMSwtVCp5LmdldChELGQpK08qeS5nZXQoRCxjLTEpKSx5LnNldChELGQsUCl9YnJlYWt9Y2FzZSAzOntjb25zdCBTPU1hdGgubWF4KE1hdGguYWJzKHdbYi0xXSksTWF0aC5hYnMod1tiLTJdKSxNYXRoLmFicyhNW2ItMl0pLE1hdGguYWJzKHdbY10pLE1hdGguYWJzKE1bY10pKSxkPXdbYi0xXS9TLFA9d1tiLTJdL1MsTz1NW2ItMl0vUyxUPXdbY10vUyxEPU1bY10vUyxZPSgoUCtkKSooUC1kKStPKk8pLzIsRz1kKk8qKGQqTyk7bGV0IHY9MDsoWSE9PTB8fEchPT0wKSYmKFk8MD92PTAtTWF0aC5zcXJ0KFkqWStHKTp2PU1hdGguc3FydChZKlkrRyksdj1HLyhZK3YpKTtsZXQgVj0oVCtkKSooVC1kKSt2LEo9VCpEO2ZvcihsZXQgTj1jO048Yi0xO04rKyl7bGV0IEI9WihWLEopO0I9PT0wJiYoQj1OdW1iZXIuTUlOX1ZBTFVFKTtsZXQgJD1WL0IsQz1KL0I7aWYoTiE9PWMmJihNW04tMV09QiksVj0kKndbTl0rQypNW05dLE1bTl09JCpNW05dLUMqd1tOXSxKPUMqd1tOKzFdLHdbTisxXT0kKndbTisxXSx1KWZvcihsZXQgVT0wO1U8cztVKyspQj0kKm0uZ2V0KFUsTikrQyptLmdldChVLE4rMSksbS5zZXQoVSxOKzEsLUMqbS5nZXQoVSxOKSskKm0uZ2V0KFUsTisxKSksbS5zZXQoVSxOLEIpO2lmKEI9WihWLEopLEI9PT0wJiYoQj1OdW1iZXIuTUlOX1ZBTFVFKSwkPVYvQixDPUovQix3W05dPUIsVj0kKk1bTl0rQyp3W04rMV0sd1tOKzFdPS1DKk1bTl0rJCp3W04rMV0sSj1DKk1bTisxXSxNW04rMV09JCpNW04rMV0sbCYmTjx0LTEpZm9yKGxldCBVPTA7VTx0O1UrKylCPSQqeS5nZXQoVSxOKStDKnkuZ2V0KFUsTisxKSx5LnNldChVLE4rMSwtQyp5LmdldChVLE4pKyQqeS5nZXQoVSxOKzEpKSx5LnNldChVLE4sQil9TVtiLTJdPVY7YnJlYWt9Y2FzZSA0OntpZih3W2NdPD0wJiYod1tjXT13W2NdPDA/LXdbY106MCx1KSlmb3IobGV0IFM9MDtTPD1GO1MrKyltLnNldChTLGMsLW0uZ2V0KFMsYykpO2Zvcig7YzxGJiYhKHdbY10+PXdbYysxXSk7KXtsZXQgUz13W2NdO2lmKHdbY109d1tjKzFdLHdbYysxXT1TLHUmJmM8cy0xKWZvcihsZXQgZD0wO2Q8cztkKyspUz1tLmdldChkLGMrMSksbS5zZXQoZCxjKzEsbS5nZXQoZCxjKSksbS5zZXQoZCxjLFMpO2lmKGwmJmM8dC0xKWZvcihsZXQgZD0wO2Q8dDtkKyspUz15LmdldChkLGMrMSkseS5zZXQoZCxjKzEseS5nZXQoZCxjKSkseS5zZXQoZCxjLFMpO2MrK31iLS07YnJlYWt9fX1pZihmKXtsZXQgYz1tO209eSx5PWN9dGhpcy5tPXQsdGhpcy5uPXMsdGhpcy5zPXcsdGhpcy5VPXksdGhpcy5WPW19c29sdmUoZSl7bGV0IG49ZSx0PXRoaXMudGhyZXNob2xkLHM9dGhpcy5zLmxlbmd0aCxyPUkuemVyb3MocyxzKTtmb3IobGV0IGE9MDthPHM7YSsrKU1hdGguYWJzKHRoaXMuc1thXSk8PXQ/ci5zZXQoYSxhLDApOnIuc2V0KGEsYSwxL3RoaXMuc1thXSk7bGV0IGk9dGhpcy5VLGg9dGhpcy5yaWdodFNpbmd1bGFyVmVjdG9ycyxsPWgubW11bChyKSx1PWgucm93cyxmPWkucm93cyxnPUkuemVyb3ModSxmKTtmb3IobGV0IGE9MDthPHU7YSsrKWZvcihsZXQgaj0wO2o8ZjtqKyspe2xldCB3PTA7Zm9yKGxldCB5PTA7eTxzO3krKyl3Kz1sLmdldChhLHkpKmkuZ2V0KGoseSk7Zy5zZXQoYSxqLHcpfXJldHVybiBnLm1tdWwobil9c29sdmVGb3JEaWFnb25hbChlKXtyZXR1cm4gdGhpcy5zb2x2ZShJLmRpYWcoZSkpfWludmVyc2UoKXtsZXQgZT10aGlzLlYsbj10aGlzLnRocmVzaG9sZCx0PWUucm93cyxzPWUuY29sdW1ucyxyPW5ldyBJKHQsdGhpcy5zLmxlbmd0aCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPHM7ZysrKU1hdGguYWJzKHRoaXMuc1tnXSk+biYmci5zZXQoZixnLGUuZ2V0KGYsZykvdGhpcy5zW2ddKTtsZXQgaT10aGlzLlUsaD1pLnJvd3MsbD1pLmNvbHVtbnMsdT1uZXcgSSh0LGgpO2ZvcihsZXQgZj0wO2Y8dDtmKyspZm9yKGxldCBnPTA7ZzxoO2crKyl7bGV0IGE9MDtmb3IobGV0IGo9MDtqPGw7aisrKWErPXIuZ2V0KGYsaikqaS5nZXQoZyxqKTt1LnNldChmLGcsYSl9cmV0dXJuIHV9Z2V0IGNvbmRpdGlvbigpe3JldHVybiB0aGlzLnNbMF0vdGhpcy5zW01hdGgubWluKHRoaXMubSx0aGlzLm4pLTFdfWdldCBub3JtMigpe3JldHVybiB0aGlzLnNbMF19Z2V0IHJhbmsoKXtsZXQgZT1NYXRoLm1heCh0aGlzLm0sdGhpcy5uKSp0aGlzLnNbMF0qTnVtYmVyLkVQU0lMT04sbj0wLHQ9dGhpcy5zO2ZvcihsZXQgcz0wLHI9dC5sZW5ndGg7czxyO3MrKyl0W3NdPmUmJm4rKztyZXR1cm4gbn1nZXQgZGlhZ29uYWwoKXtyZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnMpfWdldCB0aHJlc2hvbGQoKXtyZXR1cm4gTnVtYmVyLkVQU0lMT04vMipNYXRoLm1heCh0aGlzLm0sdGhpcy5uKSp0aGlzLnNbMF19Z2V0IGxlZnRTaW5ndWxhclZlY3RvcnMoKXtyZXR1cm4gdGhpcy5VfWdldCByaWdodFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlZ9Z2V0IGRpYWdvbmFsTWF0cml4KCl7cmV0dXJuIEkuZGlhZyh0aGlzLnMpfX1mdW5jdGlvbiBNdChvLGU9ITEpe3JldHVybiBvPW50LmNoZWNrTWF0cml4KG8pLGU/bmV3IER0KG8pLmludmVyc2UoKTpOZShvLEkuZXllKG8ucm93cykpfWZ1bmN0aW9uIE5lKG8sZSxuPSExKXtyZXR1cm4gbz1udC5jaGVja01hdHJpeChvKSxlPW50LmNoZWNrTWF0cml4KGUpLG4/bmV3IER0KG8pLnNvbHZlKGUpOm8uaXNTcXVhcmUoKT9uZXcgUmUobykuc29sdmUoZSk6bmV3IHZlKG8pLnNvbHZlKGUpfWNvbnN0IHFlPTEyMzQsX2U9KCk9Pih7c2VlZDpxZSxhcnJheVNodWZmbGUoZSl7Y29uc3R7YXJyOm4sc2FtcGxlU2l6ZTp0fT1lO2ZvcihsZXQgcz0wO3M8dDtzKyspe3RoaXMuc2VlZD0oMjE0MDEzKnRoaXMuc2VlZCsyNTMxMDExKSUtMjE0NzQ4MzY0ODtsZXQgcj10aGlzLnNlZWQ+PjE2JjMyNzY3O3I9ciVuLmxlbmd0aDtsZXQgaT1uW3NdO25bc109bltyXSxuW3JdPWl9fSxuZXh0SW50KGUpe3RoaXMuc2VlZD0oMjE0MDEzKnRoaXMuc2VlZCsyNTMxMDExKSUtMjE0NzQ4MzY0ODtsZXQgbj10aGlzLnNlZWQ+PjE2JjMyNzY3O3JldHVybiBuPW4lZSxufX0pLEs9KG8sZSxuKT0+KGVbMF0tb1swXSkqKG5bMV0tb1sxXSktKGVbMV0tb1sxXSkqKG5bMF0tb1swXSksemU9KG8sZSxuLHQscyxyLGksaCk9PiEoSyhvLGUsbik+MCE9SyhzLHIsaSk+MHx8SyhlLG4sdCk+MCE9SyhyLGksaCk+MHx8SyhuLHQsbyk+MCE9SyhpLGgscyk+MHx8Syh0LG8sZSk+MCE9SyhoLHMscik+MCksRmU9KG8sZSxuLHQscyxyKT0+SyhvLGUsbik+MD09Syh0LHMscik+MCxUZT1vPT57Y29uc3QgZT1vWzRdKm9bOF0tb1s1XSpvWzddLG49b1szXSpvWzhdLW9bNV0qb1s2XSx0PW9bM10qb1s3XS1vWzRdKm9bNl07cmV0dXJuIG9bMF0qZS1vWzFdKm4rb1syXSp0fSxQdD0obyxlKT0+e2NvbnN0IG49VGUobyk7aWYoTWF0aC5hYnMobik8PWUpcmV0dXJuIG51bGw7Y29uc3QgdD0xL247cmV0dXJuWyhvWzRdKm9bOF0tb1s1XSpvWzddKSp0LChvWzJdKm9bN10tb1sxXSpvWzhdKSp0LChvWzFdKm9bNV0tb1syXSpvWzRdKSp0LChvWzVdKm9bNl0tb1szXSpvWzhdKSp0LChvWzBdKm9bOF0tb1syXSpvWzZdKSp0LChvWzJdKm9bM10tb1swXSpvWzVdKSp0LChvWzNdKm9bN10tb1s0XSpvWzZdKSp0LChvWzFdKm9bNl0tb1swXSpvWzddKSp0LChvWzBdKm9bNF0tb1sxXSpvWzNdKSp0XX0sc3Q9KG8sZSk9Pntjb25zdCBuPWVbNl0qb1swXStlWzddKm9bMV0rZVs4XSx0PVtdO3JldHVybiB0WzBdPShlWzBdKm9bMF0rZVsxXSpvWzFdK2VbMl0pL24sdFsxXT0oZVszXSpvWzBdK2VbNF0qb1sxXStlWzVdKS9uLHR9LERlPShvLGUsbix0KT0+e2NvbnN0IHM9b3QoZSxvKSxyPW90KG4sbyksaT1vdCh0LG8pLGg9b3QoZSxuKSxsPW90KHQsbiksdT1tdChzLHIpLGY9bXQocixpKSxnPW10KHMsaSksYT1tdChoLGwpO3JldHVybiBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1pbih1LGYpLGcpLGEpfSxQZT0obyxlLG4sdCk9Pntjb25zdCBzPUsobyxlLG4pPD0wO3JldHVybiEoSyhlLG4sdCk8PTAhPT1zfHxLKG4sdCxvKTw9MCE9PXN8fEsodCxvLGUpPD0wIT09cyl9LG90PShvLGUpPT5bb1swXS1lWzBdLG9bMV0tZVsxXV0sbXQ9KG8sZSk9Pntjb25zdCBuPW9bMF0qZVsxXS1vWzFdKmVbMF07cmV0dXJuIE1hdGguYWJzKG4pKi41fSxYdD0obyxlKT0+e2NvbnN0e25vcm1Qb2ludHM6bixwYXJhbTp0fT1CdChvKSx7bm9ybVBvaW50czpzLHBhcmFtOnJ9PUJ0KGUpLGk9cy5sZW5ndGgsaD1bXSxsPVtdO2ZvcihsZXQgdT0wO3U8aTt1Kyspe2NvbnN0IGY9W25bdV1bMF0sblt1XVsxXSwxLDAsMCwwLC0oblt1XVswXSpzW3VdWzBdKSwtKG5bdV1bMV0qc1t1XVswXSldLGc9WzAsMCwwLG5bdV1bMF0sblt1XVsxXSwxLC0oblt1XVswXSpzW3VdWzFdKSwtKG5bdV1bMV0qc1t1XVsxXSldO2gucHVzaChmKSxoLnB1c2goZyksbC5wdXNoKFtzW3VdWzBdXSksbC5wdXNoKFtzW3VdWzFdXSl9dHJ5e2NvbnN0IHU9bmV3IEkoaCksZj1uZXcgSShsKSxnPXUudHJhbnNwb3NlKCksYT1nLm1tdWwodSksaj1nLm1tdWwoZikseT1NdChhKS5tbXVsKGopLnRvMURBcnJheSgpO3JldHVybiBYZSh5LHQscil9Y2F0Y2h7cmV0dXJuIG51bGx9fSxCdD1vPT57bGV0IGU9MCxuPTA7Zm9yKGxldCBsPTA7bDxvLmxlbmd0aDtsKyspZSs9b1tsXVswXSxuKz1vW2xdWzFdO2xldCB0PWUvby5sZW5ndGgscz1uL28ubGVuZ3RoLHI9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyl7Y29uc3QgdT1vW2xdWzBdLXQsZj1vW2xdWzFdLXM7cis9TWF0aC5zcXJ0KHUqdStmKmYpfWxldCBpPU1hdGguc3FydCgyKSpvLmxlbmd0aC9yO2NvbnN0IGg9W107Zm9yKGxldCBsPTA7bDxvLmxlbmd0aDtsKyspaC5wdXNoKFsob1tsXVswXS10KSppLChvW2xdWzFdLXMpKmldKTtyZXR1cm57bm9ybVBvaW50czpoLHBhcmFtOnttZWFuWDp0LG1lYW5ZOnMsczppfX19LFhlPShvLGUsbik9Pntjb25zdCB0PW4ucypuLm1lYW5YLHM9bi5zKm4ubWVhblkscj1bb1swXSt0Km9bNl0sb1sxXSt0Km9bN10sKG9bMF0rdCpvWzZdKSotZS5tZWFuWCsob1sxXSt0Km9bN10pKi1lLm1lYW5ZKyhvWzJdK3QpL2UucyxvWzNdK3Mqb1s2XSxvWzRdK3Mqb1s3XSwob1szXStzKm9bNl0pKi1lLm1lYW5YKyhvWzRdK3Mqb1s3XSkqLWUubWVhblkrKG9bNV0rcykvZS5zLG4ucypvWzZdLG4ucypvWzddLG4ucypvWzZdKi1lLm1lYW5YK24ucypvWzddKi1lLm1lYW5ZK24ucy9lLnNdO2ZvcihsZXQgaT0wO2k8OTtpKyspcltpXT1yW2ldL3JbOF07cmV0dXJuIHJ9LEJlPS4wMSxVZT0xMCxPZT0yMCxWZT0xMCxVdD1vPT57Y29uc3R7c3JjUG9pbnRzOmUsZHN0UG9pbnRzOm4sa2V5ZnJhbWU6dCxxdWlja01vZGU6c309byxyPVtbMCwwXSxbdC53aWR0aCwwXSxbdC53aWR0aCx0LmhlaWdodF0sWzAsdC5oZWlnaHRdXSxpPTQ7aWYoZS5sZW5ndGg8aSlyZXR1cm4gbnVsbDtjb25zdCBoPUJlLGw9MS8oaCpoKSx1PU1hdGgubWluKFVlLGUubGVuZ3RoKSxmPV9lKCksZz1bXTtmb3IobGV0IEU9MDtFPGUubGVuZ3RoO0UrKylnW0VdPUU7Zi5hcnJheVNodWZmbGUoe2FycjpnLHNhbXBsZVNpemU6Zy5sZW5ndGh9KTtjb25zdCBhPXM/VmU6T2Usaj1hKjI7bGV0IHc9MDtjb25zdCB5PVtdO2Zvcig7dzxqJiZ5Lmxlbmd0aDxhOyl7aWYodys9MSxmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTppfSksIXplKGVbZ1swXV0sZVtnWzFdXSxlW2dbMl1dLGVbZ1szXV0sbltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSkpY29udGludWU7Y29uc3QgRT1YdChbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0sW25bZ1swXV0sbltnWzFdXSxuW2dbMl1dLG5bZ1szXV1dKTtFIT09bnVsbCYmQ2Uoe0g6RSx0ZXN0UG9pbnRzOnJ9KSYmeS5wdXNoKEUpfWlmKHkubGVuZ3RoPT09MClyZXR1cm4gbnVsbDtjb25zdCBtPVtdO2ZvcihsZXQgRT0wO0U8eS5sZW5ndGg7RSsrKW0ucHVzaCh7SDp5W0VdLGNvc3Q6MH0pO2xldCBNPXU7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aCYmbS5sZW5ndGg+MjtFKz1NKXtNPU1hdGgubWluKHUsZS5sZW5ndGgtRSk7bGV0IGs9RStNO2ZvcihsZXQgUj0wO1I8bS5sZW5ndGg7UisrKWZvcihsZXQgcT1FO3E8aztxKyspe2NvbnN0IGI9WWUoe0g6bVtSXS5ILHNyY1BvaW50OmVbcV0sZHN0UG9pbnQ6bltxXSxvbmVPdmVyU2NhbGUyOmx9KTttW1JdLmNvc3QrPWJ9bS5zb3J0KChSLHEpPT5SLmNvc3QtcS5jb3N0KSxtLnNwbGljZSgtTWF0aC5mbG9vcigobS5sZW5ndGgrMSkvMikpfWxldCB6PW51bGw7Zm9yKGxldCBFPTA7RTxtLmxlbmd0aDtFKyspe2NvbnN0IGs9TGUoe2luSDptW0VdLkh9KTtpZigkZSh7SDprLHRlc3RQb2ludHM6cixrZXlmcmFtZTp0fSkpe3o9azticmVha319cmV0dXJuIHp9LCRlPSh7SDpvLHRlc3RQb2ludHM6ZSxrZXlmcmFtZTpufSk9Pntjb25zdCB0PVB0KG8sMWUtNSk7aWYodD09PW51bGwpcmV0dXJuITE7Y29uc3Qgcz1bXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKylzLnB1c2goc3QoZVtpXSx0KSk7cmV0dXJuIShEZShzWzBdLHNbMV0sc1syXSxzWzNdKTxuLndpZHRoKm4uaGVpZ2h0KjFlLTR8fCFQZShzWzBdLHNbMV0sc1syXSxzWzNdKSl9LExlPSh7aW5IOm99KT0+e2NvbnN0IGU9MS9vWzhdLG49W107Zm9yKGxldCB0PTA7dDw4O3QrKyluW3RdPW9bdF0qZTtyZXR1cm4gbls4XT0xLG59LFllPSh7SDpvLHNyY1BvaW50OmUsZHN0UG9pbnQ6bixvbmVPdmVyU2NhbGUyOnR9KT0+e2NvbnN0IHM9c3QoZSxvKSxyPVtzWzBdLW5bMF0sc1sxXS1uWzFdXTtyZXR1cm4gTWF0aC5sb2coMSsoclswXSpyWzBdK3JbMV0qclsxXSkqdCl9LENlPSh7SDpvLHRlc3RQb2ludHM6ZX0pPT57Y29uc3Qgbj1bXTtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluW3RdPXN0KGVbdF0sbyk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspe2NvbnN0IHM9dCxyPSh0KzEpJWUubGVuZ3RoLGk9KHQrMiklZS5sZW5ndGg7aWYoIUZlKGVbc10sZVtyXSxlW2ldLG5bc10sbltyXSxuW2ldKSlyZXR1cm4hMX1yZXR1cm4hMH0sT3Q9MyxWdD02LEhlPTgsJHQ9LjcsSmU9KHtrZXlmcmFtZTpvLHF1ZXJ5cG9pbnRzOmUscXVlcnl3aWR0aDpuLHF1ZXJ5aGVpZ2h0OnQsZGVidWdNb2RlOnN9KT0+e2xldCByPXt9O2NvbnN0IGk9W107Zm9yKGxldCBtPTA7bTxlLmxlbmd0aDttKyspe2NvbnN0IE09ZVttXSx6PU0ubWF4aW1hP28ubWF4aW1hUG9pbnRzOm8ubWluaW1hUG9pbnRzO2lmKHoubGVuZ3RoPT09MCljb250aW51ZTtjb25zdCBFPU0ubWF4aW1hP28ubWF4aW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZTpvLm1pbmltYVBvaW50c0NsdXN0ZXIucm9vdE5vZGUsaz1bXSxSPW5ldyBHdChbXSwoWCxjKT0+WC5kLWMuZCk7RXQoe25vZGU6RSxrZXlwb2ludHM6eixxdWVyeXBvaW50Ok0scXVldWU6UixrZXlwb2ludEluZGV4ZXM6ayxudW1Qb3A6MH0pO2xldCBxPS0xLGI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsRj1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtmb3IobGV0IFg9MDtYPGsubGVuZ3RoO1grKyl7Y29uc3QgYz16W2tbWF1dLHA9eXQoe3YxOmMuZGVzY3JpcHRvcnMsdjI6TS5kZXNjcmlwdG9yc30pO3A8Yj8oRj1iLGI9cCxxPWtbWF0pOnA8RiYmKEY9cCl9cSE9PS0xJiYoRj09PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSfHwxKmIvRjwkdCkmJmkucHVzaCh7cXVlcnlwb2ludDpNLGtleXBvaW50OnpbcV19KX1pZihzJiYoci5tYXRjaGVzPWkpLGkubGVuZ3RoPFZ0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGg9TnQoe2tleXdpZHRoOm8ud2lkdGgsa2V5aGVpZ2h0Om8uaGVpZ2h0LHF1ZXJ5d2lkdGg6bixxdWVyeWhlaWdodDp0LG1hdGNoZXM6aX0pO3MmJihyLmhvdWdoTWF0Y2hlcz1oKTtjb25zdCBsPVV0KHtzcmNQb2ludHM6aC5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6aC5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKGw9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHU9THQoe0g6bCxtYXRjaGVzOmgsdGhyZXNob2xkOk90fSk7aWYocyYmKHIuaW5saWVyTWF0Y2hlcz11KSx1Lmxlbmd0aDxWdClyZXR1cm57ZGVidWdFeHRyYTpyfTtjb25zdCBmPVB0KGwsMWUtNSksZz0xMCoxMCxhPVtdO2ZvcihsZXQgbT0wO208ZS5sZW5ndGg7bSsrKXtjb25zdCBNPWVbbV0sej1zdChbTS54LE0ueV0sZik7bGV0IEU9LTEsaz1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUixSPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2NvbnN0IHE9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7Zm9yKGxldCBiPTA7YjxxLmxlbmd0aDtiKyspe2NvbnN0IEY9cVtiXTtpZigoRi54LXpbMF0pKihGLngtelswXSkrKEYueS16WzFdKSooRi55LXpbMV0pPmcpY29udGludWU7Y29uc3QgYz15dCh7djE6Ri5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7YzxrPyhSPWssaz1jLEU9Yik6YzxSJiYoUj1jKX1FIT09LTEmJihSPT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqay9SPCR0KSYmYS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6cVtFXX0pfXMmJihyLm1hdGNoZXMyPWEpO2NvbnN0IGo9TnQoe2tleXdpZHRoOm8ud2lkdGgsa2V5aGVpZ2h0Om8uaGVpZ2h0LHF1ZXJ5d2lkdGg6bixxdWVyeWhlaWdodDp0LG1hdGNoZXM6YX0pO3MmJihyLmhvdWdoTWF0Y2hlczI9aik7Y29uc3Qgdz1VdCh7c3JjUG9pbnRzOmoubWFwKG09PlttLmtleXBvaW50LngsbS5rZXlwb2ludC55XSksZHN0UG9pbnRzOmoubWFwKG09PlttLnF1ZXJ5cG9pbnQueCxtLnF1ZXJ5cG9pbnQueV0pLGtleWZyYW1lOm99KTtpZih3PT09bnVsbClyZXR1cm57ZGVidWdFeHRyYTpyfTtjb25zdCB5PUx0KHtIOncsbWF0Y2hlczpqLHRocmVzaG9sZDpPdH0pO3JldHVybiBzJiYoci5pbmxpZXJNYXRjaGVzMj15KSx7SDp3LG1hdGNoZXM6eSxkZWJ1Z0V4dHJhOnJ9fSxFdD0oe25vZGU6byxrZXlwb2ludHM6ZSxxdWVyeXBvaW50Om4scXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pPT57aWYoby5sZWFmKXtmb3IobGV0IGw9MDtsPG8ucG9pbnRJbmRleGVzLmxlbmd0aDtsKyspcy5wdXNoKG8ucG9pbnRJbmRleGVzW2xdKTtyZXR1cm59Y29uc3QgaT1bXTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKyl7Y29uc3QgZj1vLmNoaWxkcmVuW2xdLmNlbnRlclBvaW50SW5kZXgsZz15dCh7djE6ZVtmXS5kZXNjcmlwdG9ycyx2MjpuLmRlc2NyaXB0b3JzfSk7aS5wdXNoKGcpfWxldCBoPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWg9TWF0aC5taW4oaCxpW2xdKTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdIT09aCYmdC5wdXNoKHtub2RlOm8uY2hpbGRyZW5bbF0sZDppW2xdfSk7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaVtsXT09PWgmJkV0KHtub2RlOm8uY2hpbGRyZW5bbF0sa2V5cG9pbnRzOmUscXVlcnlwb2ludDpuLHF1ZXVlOnQsa2V5cG9pbnRJbmRleGVzOnMsbnVtUG9wOnJ9KTtpZihyPEhlJiZ0Lmxlbmd0aD4wKXtjb25zdHtub2RlOmwsZDp1fT10LnBvcCgpO3IrPTEsRXQoe25vZGU6bCxrZXlwb2ludHM6ZSxxdWVyeXBvaW50Om4scXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pfX0sTHQ9bz0+e2NvbnN0e0g6ZSxtYXRjaGVzOm4sdGhyZXNob2xkOnR9PW8scz10KnQscj1bXTtmb3IobGV0IGk9MDtpPG4ubGVuZ3RoO2krKyl7Y29uc3QgaD1uW2ldLnF1ZXJ5cG9pbnQsbD1uW2ldLmtleXBvaW50LHU9c3QoW2wueCxsLnldLGUpOyh1WzBdLWgueCkqKHVbMF0taC54KSsodVsxXS1oLnkpKih1WzFdLWgueSk8PXMmJnIucHVzaChuW2ldKX1yZXR1cm4gcn07Y2xhc3MgS2V7Y29uc3RydWN0b3IoZSxuLHQ9ITEpe3RoaXMucXVlcnlXaWR0aD1lLHRoaXMucXVlcnlIZWlnaHQ9bix0aGlzLmRlYnVnTW9kZT10fW1hdGNoRGV0ZWN0aW9uKGUsbil7bGV0IHQ9e2ZyYW1lczpbXX0scz1udWxsO2ZvcihsZXQgbD0wO2w8ZS5sZW5ndGg7bCsrKXtjb25zdHtIOnUsbWF0Y2hlczpmLGRlYnVnRXh0cmE6Z309SmUoe2tleWZyYW1lOmVbbF0scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOnRoaXMucXVlcnlXaWR0aCxxdWVyeWhlaWdodDp0aGlzLnF1ZXJ5SGVpZ2h0LGRlYnVnTW9kZTp0aGlzLmRlYnVnTW9kZX0pO3QuZnJhbWVzLnB1c2goZyksdSYmKHM9PT1udWxsfHxzLm1hdGNoZXMubGVuZ3RoPGYubGVuZ3RoKSYmKHM9e2tleWZyYW1lSW5kZXg6bCxIOnUsbWF0Y2hlczpmfSl9aWYocz09PW51bGwpcmV0dXJue2tleWZyYW1lSW5kZXg6LTEsZGVidWdFeHRyYTp0fTtjb25zdCByPVtdLGk9W10saD1lW3Mua2V5ZnJhbWVJbmRleF07Zm9yKGxldCBsPTA7bDxzLm1hdGNoZXMubGVuZ3RoO2wrKyl7Y29uc3QgdT1zLm1hdGNoZXNbbF0ucXVlcnlwb2ludCxmPXMubWF0Y2hlc1tsXS5rZXlwb2ludDtyLnB1c2goe3g6dS54LHk6dS55fSksaS5wdXNoKHt4OihmLngrLjUpL2guc2NhbGUseTooZi55Ky41KS9oLnNjYWxlLHo6MH0pfXJldHVybntzY3JlZW5Db29yZHM6cix3b3JsZENvb3JkczppLGtleWZyYW1lSW5kZXg6cy5rZXlmcmFtZUluZGV4LGRlYnVnRXh0cmE6dH19fWNvbnN0IEdlPSh7c2NyZWVuQ29vcmRzOm8sd29ybGRDb29yZHM6ZSxwcm9qZWN0aW9uVHJhbnNmb3JtOm59KT0+e2NvbnN0IHQ9WHQoZS5tYXAobT0+W20ueCxtLnldKSxvLm1hcChtPT5bbS54LG0ueV0pKSxzPW5ldyBJKFtbdFswXSx0WzFdLHRbMl1dLFt0WzNdLHRbNF0sdFs1XV0sW3RbNl0sdFs3XSx0WzhdXV0pLHI9bmV3IEkobiksbD1NdChyKS5tbXVsKHMpLnRvMURBcnJheSgpLHU9TWF0aC5zcXJ0KGxbMF0qbFswXStsWzNdKmxbM10rbFs2XSpsWzZdKSxmPU1hdGguc3FydChsWzFdKmxbMV0rbFs0XSpsWzRdK2xbN10qbFs3XSksZz0odStmKS8yLGE9W107YVswXT1sWzBdL3UsYVszXT1sWzNdL3UsYVs2XT1sWzZdL3UsYVsxXT1sWzFdL2YsYVs0XT1sWzRdL2YsYVs3XT1sWzddL2YsYVsyXT1hWzNdKmFbN10tYVs2XSphWzRdLGFbNV09YVs2XSphWzFdLWFbMF0qYVs3XSxhWzhdPWFbMF0qYVs0XS1hWzFdKmFbM107Y29uc3Qgaj1NYXRoLnNxcnQoYVsyXSphWzJdK2FbNV0qYVs1XSthWzhdKmFbOF0pO2FbMl0vPWosYVs1XS89aixhWzhdLz1qO2NvbnN0IHc9W107cmV0dXJuIHdbMF09bFsyXS9nLHdbMV09bFs1XS9nLHdbMl09bFs4XS9nLFtbYVswXSxhWzFdLGFbMl0sd1swXV0sW2FbM10sYVs0XSxhWzVdLHdbMV1dLFthWzZdLGFbN10sYVs4XSx3WzJdXV19LFFlPShvLGUpPT5bW29bMF1bMF0qZVswXVswXStvWzBdWzJdKmVbMl1bMF0sb1swXVswXSplWzBdWzFdK29bMF1bMl0qZVsyXVsxXSxvWzBdWzBdKmVbMF1bMl0rb1swXVsyXSplWzJdWzJdLG9bMF1bMF0qZVswXVszXStvWzBdWzJdKmVbMl1bM11dLFtvWzFdWzFdKmVbMV1bMF0rb1sxXVsyXSplWzJdWzBdLG9bMV1bMV0qZVsxXVsxXStvWzFdWzJdKmVbMl1bMV0sb1sxXVsxXSplWzFdWzJdK29bMV1bMl0qZVsyXVsyXSxvWzFdWzFdKmVbMV1bM10rb1sxXVsyXSplWzJdWzNdXSxbZVsyXVswXSxlWzJdWzFdLGVbMl1bMl0sZVsyXVszXV1dLFl0PShvLGUsbix0KT0+e2NvbnN0IHM9b1swXVswXSplK29bMF1bMV0qbitvWzBdWzNdLHI9b1sxXVswXSplK29bMV1bMV0qbitvWzFdWzNdLGk9b1syXVswXSplK29bMl1bMV0qbitvWzJdWzNdO3JldHVybnt4OnMseTpyLHo6aX19LFdlPShvLGUsbix0KT0+e2NvbnN0e3g6cyx5OnIsejppfT1ZdChvLGUsbik7cmV0dXJue3g6cy9pLHk6ci9pfX0sWmU9NSx4ZT00LEN0PTEwLEFlPS4xLHRuPS45OTtsZXQgSD1bW10sW10sW11dLHg9W1tdLFtdXSxMPVtbXSxbXSxbXV07Y29uc3QgZW49KHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOm8scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmRzOm4sc2NyZWVuQ29vcmRzOnR9KT0+e2xldCBzPTAscj0wO2ZvcihsZXQgZz0wO2c8bi5sZW5ndGg7ZysrKXMrPW5bZ10ueCxyKz1uW2ddLnk7cy89bi5sZW5ndGgsci89bi5sZW5ndGg7Y29uc3QgaT1bXTtmb3IobGV0IGc9MDtnPG4ubGVuZ3RoO2crKylpLnB1c2goe3g6bltnXS54LXMseTpuW2ddLnktcix6Om5bZ10uen0pO2NvbnN0IGg9W1tdLFtdLFtdXTtmb3IobGV0IGc9MDtnPDM7ZysrKWZvcihsZXQgYT0wO2E8MzthKyspaFtnXVthXT1vW2ddW2FdO2hbMF1bM109b1swXVswXSpzK29bMF1bMV0qcitvWzBdWzNdLGhbMV1bM109b1sxXVswXSpzK29bMV1bMV0qcitvWzFdWzNdLGhbMl1bM109b1syXVswXSpzK29bMl1bMV0qcitvWzJdWzNdO2NvbnN0IGw9WzEsLjgsLjYsLjQsMF07bGV0IHU9aCxmPW51bGw7Zm9yKGxldCBnPTA7ZzxsLmxlbmd0aDtnKyspe2NvbnN0IGE9bm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06dSxwcm9qZWN0aW9uVHJhbnNmb3JtOmUsd29ybGRDb29yZHM6aSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOmxbZ119KTtpZih1PWEubW9kZWxWaWV3VHJhbnNmb3JtLGEuZXJyPFplKXtmPXU7YnJlYWt9fXJldHVybiBmPT09bnVsbD9udWxsOihmWzBdWzNdPWZbMF1bM10tZlswXVswXSpzLWZbMF1bMV0qcixmWzFdWzNdPWZbMV1bM10tZlsxXVswXSpzLWZbMV1bMV0qcixmWzJdWzNdPWZbMl1bM10tZlsyXVswXSpzLWZbMl1bMV0qcixmKX0sbm49KHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOm8scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmRzOm4sc2NyZWVuQ29vcmRzOnQsaW5saWVyUHJvYjpzfSk9Pntjb25zdCByPXM8MTtsZXQgaT1vLGg9MCxsPTAsdT1uZXcgQXJyYXkobi5sZW5ndGgpLGY9bmV3IEFycmF5KG4ubGVuZ3RoKSxnPW5ldyBBcnJheShuLmxlbmd0aCksYT1uZXcgQXJyYXkobi5sZW5ndGgpO2ZvcihsZXQgaj0wO2o8PUN0O2orKyl7Y29uc3Qgdz1RZShlLGkpO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKXtjb25zdCBrPVdlKHcsbltFXS54LG5bRV0ueSxuW0VdLnopLFI9dFtFXS54LWsueCxxPXRbRV0ueS1rLnk7Z1tFXT1SLGFbRV09cSx1W0VdPVIqUitxKnF9bGV0IHk7aWYobD0wLHIpe2NvbnN0IEU9TWF0aC5tYXgoMyxNYXRoLmZsb29yKG4ubGVuZ3RoKnMpLTEpO2ZvcihsZXQgaz0wO2s8bi5sZW5ndGg7aysrKWZba109dVtrXTtmLnNvcnQoKGssUik9PmstUikseT1NYXRoLm1heChmW0VdKnhlLDE2KTtmb3IobGV0IGs9MDtrPG4ubGVuZ3RoO2srKylmW2tdPnk/bCs9eS82OmwrPXkvNiooMS0oMS1mW2tdL3kpKigxLWZba10veSkqKDEtZltrXS95KSl9ZWxzZSBmb3IobGV0IEU9MDtFPG4ubGVuZ3RoO0UrKylsKz11W0VdO2lmKGwvPW4ubGVuZ3RoLGw8QWV8fGo+MCYmbC9oPnRufHxqPT09Q3QpYnJlYWs7aD1sO2NvbnN0IG09W10sTT1bXTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoO0UrKyl7aWYociYmdVtFXT55KWNvbnRpbnVlO2NvbnN0IGs9cm4oe21vZGVsVmlld1Byb2plY3Rpb25UcmFuc2Zvcm06dyxtb2RlbFZpZXdUcmFuc2Zvcm06aSxwcm9qZWN0aW9uVHJhbnNmb3JtOmUsd29ybGRDb29yZDpuW0VdfSk7aWYocil7Y29uc3QgUj0oMS11W0VdL3kpKigxLXVbRV0veSk7Zm9yKGxldCBxPTA7cTwyO3ErKylmb3IobGV0IGI9MDtiPDY7YisrKWtbcV1bYl0qPVI7bS5wdXNoKFtnW0VdKlJdKSxtLnB1c2goW2FbRV0qUl0pfWVsc2UgbS5wdXNoKFtnW0VdXSksbS5wdXNoKFthW0VdXSk7Zm9yKGxldCBSPTA7UjxrLmxlbmd0aDtSKyspTS5wdXNoKGtbUl0pfWNvbnN0IHo9b24oe2RVOm0sSl9VX1M6TX0pO2lmKHo9PT1udWxsKWJyZWFrO2k9c24oe21vZGVsVmlld1RyYW5zZm9ybTppLGRTOnp9KX1yZXR1cm57bW9kZWxWaWV3VHJhbnNmb3JtOmksZXJyOmx9fSxzbj0oe21vZGVsVmlld1RyYW5zZm9ybTpvLGRTOmV9KT0+e2xldCBuPWVbMF0qZVswXStlWzFdKmVbMV0rZVsyXSplWzJdLHQscyxyO248MWUtNj8odD0xLHM9MCxyPTAsbj0wKToobj1NYXRoLnNxcnQobiksdD1lWzBdL24scz1lWzFdL24scj1lWzJdL24pO2NvbnN0IGk9TWF0aC5jb3MobiksaD1NYXRoLnNpbihuKSxsPTEtaTtIWzBdWzBdPXQqdCpsK2ksSFswXVsxXT10KnMqbC1yKmgsSFswXVsyXT10KnIqbCtzKmgsSFswXVszXT1lWzNdLEhbMV1bMF09cyp0KmwrcipoLEhbMV1bMV09cypzKmwraSxIWzFdWzJdPXMqcipsLXQqaCxIWzFdWzNdPWVbNF0sSFsyXVswXT1yKnQqbC1zKmgsSFsyXVsxXT1yKnMqbCt0KmgsSFsyXVsyXT1yKnIqbCtpLEhbMl1bM109ZVs1XTtjb25zdCB1PVtbXSxbXSxbXV07Zm9yKGxldCBmPTA7ZjwzO2YrKyl7Zm9yKGxldCBnPTA7Zzw0O2crKyl1W2ZdW2ddPW9bZl1bMF0qSFswXVtnXStvW2ZdWzFdKkhbMV1bZ10rb1tmXVsyXSpIWzJdW2ddO3VbZl1bM10rPW9bZl1bM119cmV0dXJuIHV9LG9uPSh7ZFU6byxKX1VfUzplfSk9Pntjb25zdCBuPW5ldyBJKGUpLHQ9bmV3IEkobykscz1uLnRyYW5zcG9zZSgpLHI9cy5tbXVsKG4pLGk9cy5tbXVsKHQpO2xldCBoO3RyeXtoPU10KHIpfWNhdGNoe3JldHVybiBudWxsfXJldHVybiBoLm1tdWwoaSkudG8xREFycmF5KCl9LHJuPSh7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTpvLG1vZGVsVmlld1RyYW5zZm9ybTplLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOnR9KT0+e2NvbnN0IHM9ZSx7eDpyLHk6aSx6Omh9PXQsbD1ZdChvLHIsaSksdT1sLnoqbC56O3hbMF1bMF09blswXVswXSpsLnovdSx4WzBdWzFdPW5bMF1bMV0qbC56L3UseFswXVsyXT0oblswXVsyXSpsLnotblsyXVsyXSpsLngpL3UseFsxXVswXT1uWzFdWzBdKmwuei91LHhbMV1bMV09blsxXVsxXSpsLnovdSx4WzFdWzJdPShuWzFdWzJdKmwuei1uWzJdWzJdKmwueSkvdSxMWzBdWzBdPXNbMF1bMl0qaSxMWzBdWzFdPS1zWzBdWzJdKnIsTFswXVsyXT1zWzBdWzFdKnItc1swXVswXSppLExbMF1bM109c1swXVswXSxMWzBdWzRdPXNbMF1bMV0sTFswXVs1XT1zWzBdWzJdLExbMV1bMF09c1sxXVsyXSppLExbMV1bMV09LXNbMV1bMl0qcixMWzFdWzJdPXNbMV1bMV0qci1zWzFdWzBdKmksTFsxXVszXT1zWzFdWzBdLExbMV1bNF09c1sxXVsxXSxMWzFdWzVdPXNbMV1bMl0sTFsyXVswXT1zWzJdWzJdKmksTFsyXVsxXT0tc1syXVsyXSpyLExbMl1bMl09c1syXVsxXSpyLXNbMl1bMF0qaSxMWzJdWzNdPXNbMl1bMF0sTFsyXVs0XT1zWzJdWzFdLExbMl1bNV09c1syXVsyXTtjb25zdCBmPVtbXSxbXV07Zm9yKGxldCBnPTA7ZzwyO2crKylmb3IobGV0IGE9MDthPDY7YSsrKXtmW2ddW2FdPTA7Zm9yKGxldCBqPTA7ajwzO2orKylmW2ddW2FdKz14W2ddW2pdKkxbal1bYV19cmV0dXJuIGZ9O2NsYXNzIGxue2NvbnN0cnVjdG9yKGUpe3RoaXMucHJvamVjdGlvblRyYW5zZm9ybT1lfWVzdGltYXRlKHtzY3JlZW5Db29yZHM6ZSx3b3JsZENvb3JkczpufSl7cmV0dXJuIEdlKHtzY3JlZW5Db29yZHM6ZSx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9cmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06ZSx3b3JsZENvb3JkczpuLHNjcmVlbkNvb3Jkczp0fSl7cmV0dXJuIGVuKHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOmUsd29ybGRDb29yZHM6bixzY3JlZW5Db29yZHM6dCxwcm9qZWN0aW9uVHJhbnNmb3JtOnRoaXMucHJvamVjdGlvblRyYW5zZm9ybX0pfX1sZXQgSHQ9bnVsbCxKdD0hMSxLdD1udWxsLFN0PW51bGw7b25tZXNzYWdlPW89Pntjb25zdHtkYXRhOmV9PW87c3dpdGNoKGUudHlwZSl7Y2FzZSJzZXR1cCI6ZS5wcm9qZWN0aW9uVHJhbnNmb3JtLEh0PWUubWF0Y2hpbmdEYXRhTGlzdCxKdD1lLmRlYnVnTW9kZSxLdD1uZXcgS2UoZS5pbnB1dFdpZHRoLGUuaW5wdXRIZWlnaHQsSnQpLFN0PW5ldyBsbihlLnByb2plY3Rpb25UcmFuc2Zvcm0pO2JyZWFrO2Nhc2UibWF0Y2giOmNvbnN0IG49ZS50YXJnZXRJbmRleGVzO2xldCB0PS0xLHM9bnVsbCxyPW51bGw7Zm9yKGxldCBmPTA7ZjxuLmxlbmd0aDtmKyspe2NvbnN0IGc9bltmXSx7a2V5ZnJhbWVJbmRleDphLHNjcmVlbkNvb3JkczpqLHdvcmxkQ29vcmRzOncsZGVidWdFeHRyYTp5fT1LdC5tYXRjaERldGVjdGlvbihIdFtnXSxlLmZlYXR1cmVQb2ludHMpO2lmKHI9eSxhIT09LTEpe2NvbnN0IG09U3QuZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpqLHdvcmxkQ29vcmRzOnd9KTttJiYodD1nLHM9bSk7YnJlYWt9fXBvc3RNZXNzYWdlKHt0eXBlOiJtYXRjaERvbmUiLHRhcmdldEluZGV4OnQsbW9kZWxWaWV3VHJhbnNmb3JtOnMsZGVidWdFeHRyYTpyfSk7YnJlYWs7Y2FzZSJ0cmFja1VwZGF0ZSI6Y29uc3R7bW9kZWxWaWV3VHJhbnNmb3JtOmksd29ybGRDb29yZHM6aCxzY3JlZW5Db29yZHM6bH09ZSx1PVN0LnJlZmluZUVzdGltYXRlKHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOmksd29ybGRDb29yZHM6aCxzY3JlZW5Db29yZHM6bH0pO3Bvc3RNZXNzYWdlKHt0eXBlOiJ0cmFja1VwZGF0ZURvbmUiLG1vZGVsVmlld1RyYW5zZm9ybTp1fSk7YnJlYWs7Y2FzZSJkaXNwb3NlIjpjbG9zZSgpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG1lc3NhZ2UgdHlwZSAnJHtlLnR5cGV9J2ApfX19KSgpOwo=",PM=typeof window<"u"&&window.Blob&&new Blob([atob(FM)],{type:"text/javascript;charset=utf-8"});function TH(){const i=PM&&(window.URL||window.webkitURL).createObjectURL(PM);try{return i?new Worker(i):new Worker("data:application/javascript;base64,"+FM)}finally{i&&(window.URL||window.webkitURL).revokeObjectURL(i)}}const MH=(i,e)=>[[i[0][0]*e[0][0]+i[0][2]*e[2][0],i[0][0]*e[0][1]+i[0][2]*e[2][1],i[0][0]*e[0][2]+i[0][2]*e[2][2],i[0][0]*e[0][3]+i[0][2]*e[2][3]],[i[1][1]*e[1][0]+i[1][2]*e[2][0],i[1][1]*e[1][1]+i[1][2]*e[2][1],i[1][1]*e[1][2]+i[1][2]*e[2][2],i[1][1]*e[1][3]+i[1][2]*e[2][3]],[e[2][0],e[2][1],e[2][2],e[2][3]]],_H=(i,e,t,r)=>{const s=i[0][0]*e+i[0][1]*t+i[0][3],o=i[1][0]*e+i[1][1]*t+i[1][3],l=i[2][0]*e+i[2][1]*t+i[2][3];return{x:s,y:o,z:l}},RH=(i,e,t,r)=>{const{x:s,y:o,z:l}=_H(i,e,t);return{x:s/l,y:o/l}},BH=6,kH=1,LH=10,DH=1,NH=.8,FH=1,eh=1e3;class PH{constructor(e,t,r,s,o,l=!1){this.markerDimensions=e,this.trackingDataList=t,this.projectionTransform=r,this.debugMode=l,this.trackingKeyframeList=[];for(let h=0;h<t.length;h++)this.trackingKeyframeList.push(t[h][FH]);let c=0;for(let h=0;h<this.trackingKeyframeList.length;h++)c=Math.max(c,this.trackingKeyframeList[h].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let h=0;h<this.trackingKeyframeList.length;h++){const{featurePoints:p,imagePixels:f,imageProperties:g}=this._prebuild(this.trackingKeyframeList[h],c);this.featurePointsListT[h]=p,this.imagePixelsListT[h]=f,this.imagePropertiesListT[h]=g}this.kernelCaches={}}dummyRun(e){let t=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let r=0;r<this.featurePointsListT.length;r++)this.track(e,t,r)}track(e,t,r){let s={};const o=MH(this.projectionTransform,t),l=this._buildAdjustedModelViewTransform(o);this.markerDimensions[r][0],this.markerDimensions[r][1],this.trackingKeyframeList[r].width,this.trackingKeyframeList[r].height;const c=this.featurePointsListT[r],h=this.imagePixelsListT[r],p=this.imagePropertiesListT[r],f=this._computeProjection(l,e,r),{matchingPointsT:g,simT:v}=this._computeMatching(c,h,p,f),w=g.arraySync(),R=v.arraySync(),P=this.trackingKeyframeList[r],z=[],G=[],X=[];for(let fe=0;fe<w.length;fe++)if(R[fe]>NH&&fe<P.points.length){X.push(fe);const ge=RH(o,w[fe][0],w[fe][1]);G.push(ge),z.push({x:P.points[fe].x/P.scale,y:P.points[fe].y/P.scale,z:0})}return this.debugMode&&(s={projectedImage:f.arraySync(),matchingPoints:g.arraySync(),goodTrack:X,trackedPoints:G}),l.dispose(),f.dispose(),g.dispose(),v.dispose(),{worldCoords:z,screenCoords:G,debugExtra:s}}_computeMatching(e,t,r,s){const o=BH,l=o*2+1,c=LH*kH,h=DH,p=c*2+1,f=s.shape[0],g=s.shape[1],v=e.shape[0];if(!this.kernelCaches.computeMatching){const w={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[v,p*p],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int searchOffsetIndex = coords[1];

	    int markerWidth = int(getMarkerProperties(0));
	    int markerHeight = int(getMarkerProperties(1));
	    float markerScale = getMarkerProperties(2);

	    int searchOffsetX = imod(searchOffsetIndex, ${p}) * ${h};
	    int searchOffsetY = searchOffsetIndex / ${p} * ${h};

	    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);
	    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);

	    int sx = sCenterX + searchOffsetX - ${c};
	    int sy = sCenterY + searchOffsetY - ${c};

	    if (sx < ${o} || sx >= (${g} - ${o}) || sy < ${o} || sy >= (${f} - ${o})) {
	      setOutput(-2.);
	    } 
	    else {
	      float sumPoint = 0.;
	      float sumPointSquare = 0.;
	      float sumTemplate = 0.;
	      float sumTemplateSquare = 0.;
	      float sumPointTemplate = 0.;

	      for (int templateOffsetY = 0; templateOffsetY < ${l}; templateOffsetY++) {
		for (int templateOffsetX = 0; templateOffsetX < ${l}; templateOffsetX++) {
		  int fx2 = sCenterX + templateOffsetX - ${o};
		  int fy2 = sCenterY + templateOffsetY - ${o};

		  int sx2 = sx + templateOffsetX - ${o};
		  int sy2 = sy + templateOffsetY - ${o};

		  int markerPixelIndex = fy2 * markerWidth + fx2;
		  float markerPixel = getMarkerPixels(markerPixelIndex);
		  float targetPixel = getTargetPixels(sy2, sx2);

		  sumTemplate += markerPixel;
		  sumTemplateSquare += markerPixel * markerPixel;
		  sumPoint += targetPixel;
		  sumPointSquare += targetPixel * targetPixel;
		  sumPointTemplate += targetPixel * markerPixel;
		}
	      }

	      // Normalized cross-correlation
	      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)
	      float count = float(${l} * ${l});
	      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);
	      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);

	      if (pointVariance < 0.0000001) {
		setOutput(-3.);
	      } else if (templateVariance < 0.0000001) {
		//setOutput(sumTemplate);
		setOutput(-4.);
	      } else {
		sumPointTemplate -= sumPoint / count * sumTemplate;
		float sim = sumPointTemplate / pointVariance / templateVariance;  
		setOutput(sim);
	      }
	    }
	  }
	`},R={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[v,2],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float markerScale = getMarkerProperties(2);

	    int featureIndex = coords[0];

	    int maxIndex = int(getMaxIndex(featureIndex));
	    int searchLocationIndex = maxIndex / ${p*p};
	    int searchOffsetIndex = imod(maxIndex, ${p*p});

	    if (coords[1] == 0) {
	      int searchOffsetX = imod(searchOffsetIndex, ${p}) * ${h};
	      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ${c}) / markerScale);
	    }
	    else if (coords[1] == 1) {
	      int searchOffsetY = searchOffsetIndex / ${p} * ${h};
	      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ${c}) / markerScale);
	    }
	  }
	`},P={variableNames:["sims","maxIndex"],outputShape:[v],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();
	    int maxIndex = int(getMaxIndex(featureIndex));
	    setOutput(getSims(featureIndex, maxIndex));
	  }
	`};this.kernelCaches.computeMatching=[w,R,P]}return Pt(()=>{const w=this.kernelCaches.computeMatching,R=this._compileAndRun(w[0],[e,t,r,s]),P=R.argMax(1),z=this._compileAndRun(w[1],[e,r,P]),G=this._compileAndRun(w[2],[R,P]);return{matchingPointsT:z,simT:G}})}_computeProjection(e,t,r){const s=this.trackingKeyframeList[r].width,o=this.trackingKeyframeList[r].height,l=this.trackingKeyframeList[r].scale,c=s+"-"+o+"-"+l;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[c]){const h={variableNames:["M","pixel"],outputShape:[o,s],userCode:`
	  void main() {
	      ivec2 coords = getOutputCoords();

	      float m00 = getM(0, 0) * ${eh}.;
	      float m01 = getM(0, 1) * ${eh}.;
	      float m03 = getM(0, 3) * ${eh}.;
	      float m10 = getM(1, 0) * ${eh}.;
	      float m11 = getM(1, 1) * ${eh}.;
	      float m13 = getM(1, 3) * ${eh}.;
	      float m20 = getM(2, 0) * ${eh}.;
	      float m21 = getM(2, 1) * ${eh}.;
	      float m23 = getM(2, 3) * ${eh}.;

	      float y = float(coords[0]) / float(${l});
	      float x = float(coords[1]) / float(${l});
	      float uz = (x * m20) + (y * m21) + m23;
	      float oneOverUz = 1. / uz;

	      float ux = (x * m00) + (y * m01) + m03;
	      float uy = (x * m10) + (y * m11) + m13;

	      ux = floor(ux * oneOverUz + 0.5);
	      uy = floor(uy * oneOverUz + 0.5);
	      setOutput(getPixel(int(uy), int(ux)));
	    }
	`};this.kernelCaches.computeProjection[c]=h}return Pt(()=>{const h=this.kernelCaches.computeProjection[c];return this._compileAndRun(h,[e,t])})}_buildAdjustedModelViewTransform(e){return Pt(()=>{let t=[];for(let r=0;r<e.length;r++){t.push([]);for(let s=0;s<e[r].length;s++)t[r].push(e[r][s]/eh)}return Vo(t,[3,4])})}_prebuild(e,t){return Pt(()=>{const r=e.scale,s=[];for(let c=0;c<t;c++)c<e.points.length?s.push([e.points[c].x/r,e.points[c].y/r]):s.push([-1,-1]);const o=Vo(e.data,[e.width*e.height]),l=Vo([e.width,e.height,e.scale],[3]);return{featurePoints:Vo(s,[s.length,2],"float32"),imagePixels:o,imageProperties:l}})}_compileAndRun(e,t){const r=Bu().compileAndRun(e,t);return ea().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}}const Xy=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],pf=[];for(let i=0;i<Xy.length;i++){const e=Xy[i].sigma;for(let t=0;t<Xy[i].points.length;t++){const r=Xy[i].points[t];pf.push([e,r[0],r[1]])}}const cE={};function OH(i){const e=i.shape[1],t=i.shape[0],r="w"+e+"h"+t;if(!cE.hasOwnProperty(r)){const s={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0], coords[1]-2);
          sum += getP(coords[0], coords[1]-1) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0], coords[1]+1) * 4.;
          sum += getP(coords[0], coords[1]+2);
          setOutput(sum);
        }
      `},o={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0]-2, coords[1]);
          sum += getP(coords[0]-1, coords[1]) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0]+1, coords[1]) * 4.;
          sum += getP(coords[0]+2, coords[1]);
          sum /= 256.;
          setOutput(sum);
        }
      `};cE[r]=[s,o]}return cE[r]}const GH={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:i=>{const e=i.inputs.image,t=i.backend,[r,s]=OH(e),o=t.runWebGLProgram(r,[e],e.dtype),l=t.runWebGLProgram(s,[o],e.dtype);return t.disposeIntermediateTensorInfo(o),l}},Qy=7,OM=3,UH=OM*OM,uE=4,VH=(uE+1)*(uE+1)/uE,hE={};function zH(i){const e=i.shape[1],t=i.shape[0],r="w"+e+"h"+t;if(!hE.hasOwnProperty(r)){const s={variableNames:["image0","image1","image2"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();
    
          int y = coords[0];
          int x = coords[1];
    
          float value = getImage1(y, x);
    
          // Step 1: find local maxima/minima
          if (value * value < ${UH}.) {
            setOutput(0.);
            return;
          }
          if (y < ${Qy} || y > ${t-1-Qy}) {
            setOutput(0.);
            return;
          }
          if (x < ${Qy} || x > ${e-1-Qy}) {
            setOutput(0.);
            return;
          }
    
          bool isMax = true;
          bool isMin = true;
          for (int dy = -1; dy <= 1; dy++) {
            for (int dx = -1; dx <= 1; dx++) {
              float value0 = getImage0(y+dy, x+dx);
              float value1 = getImage1(y+dy, x+dx);
              float value2 = getImage2(y+dy, x+dx);
    
        if (value < value0 || value < value1 || value < value2) {
          isMax = false;
        }
        if (value > value0 || value > value1 || value > value2) {
          isMin = false;
        }
            }
          }
    
          if (!isMax && !isMin) {
            setOutput(0.);
            return;
          }
    
          // compute edge score and reject based on threshold
          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);
          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);
          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));
    
          float det = (dxx * dyy) - (dxy * dxy);
    
          if (abs(det) < 0.0001) { // determinant undefined. no solution
            setOutput(0.);
            return;
          }
    
          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;
    
          if (abs(edgeScore) >= ${VH} ) {
            setOutput(0.);
            return;
          }
          setOutput(getImage1(y,x));
        }
      `};hE[r]=s}return hE[r]}const WH={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:i=>{let{image0:e,image1:t,image2:r}=i.inputs;const s=i.backend,o=zH(t);return e=ea().runKernel("DownsampleBilinear",{image:e}),r=ea().runKernel("UpsampleBilinear",{image:r,targetImage:t}),s.runWebGLProgram(o,[e,t,r],t.dtype)}},zA=36,dE={};function HH(i){const e=i.shape[0];if(!dE.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[i.shape[0]],userCode:`
            void main() {
                int featureIndex = getOutputCoords();

                int maxIndex = 0;
                for (int i = 1; i < ${zA}; i++) {
                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {
                        maxIndex = i;
                    }
                }

                int prev = imod(maxIndex - 1 + ${zA}, ${zA});
                int next = imod(maxIndex + 1, ${zA});

                /**
                 * Fit a quatratic to 3 points. The system of equations is:
                 *
                 * y0 = A*x0^2 + B*x0 + C
                 * y1 = A*x1^2 + B*x1 + C
                 * y2 = A*x2^2 + B*x2 + C
                 *
                 * This system of equations is solved for A,B,C.
                 */
                float p10 = float(maxIndex - 1);
                float p11 = getHistogram(featureIndex, prev); 
                float p20 = float(maxIndex);
                float p21 = getHistogram(featureIndex, maxIndex); 
                float p30 = float(maxIndex + 1);
                float p31 = getHistogram(featureIndex, next); 

                float d1 = (p30-p20)*(p30-p10);
                float d2 = (p10-p20)*(p30-p10);
                float d3 = p10-p20;

                // If any of the denominators are zero then, just use maxIndex.
                    float fbin = float(maxIndex);
                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {
                float a = p10*p10;
                float b = p20*p20;

                // Solve for the coefficients A,B,C
                float A = ((p31-p21)/d1)-((p11-p21)/d2);
                float B = ((p11-p21)+(A*(b-a)))/d3;
                float C = p11-(A*a)-(B*p10);
                fbin = -B / (2. * A);
                }

                float an = 2.0 *${Math.PI} * (fbin + 0.5) / ${zA}. - ${Math.PI};
                setOutput(an);
            }
            `};dE[e]=t}return dE[e]}const KH={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:i=>{const{histograms:e}=i.inputs,t=i.backend,r=HH(e);return t.runWebGLProgram(r,[e],e.dtype)}},GM=7,pE={};function XH(i,e){const t=`${i}|${e.shape[0]}`;if(!pE.hasOwnProperty(t)){const r=[];for(let l=1;l<i;l++)r.push("image"+l);let s="float getPixel(int octave, int y, int x) {";for(let l=1;l<i;l++)s+=`
  if (octave == ${l}) {
	return getImage${l}(y, x);
  }
`;s+="}";const o={variableNames:[...r,"extrema","angles","freakPoints"],outputShape:[e.shape[0],pf.length],userCode:`
  ${s}
  void main() {
	ivec2 coords = getOutputCoords();
	int featureIndex = coords[0];
	int freakIndex = coords[1];

	float freakSigma = getFreakPoints(freakIndex, 0);
	float freakX = getFreakPoints(freakIndex, 1);
	float freakY = getFreakPoints(freakIndex, 2);

	int octave = int(getExtrema(featureIndex, 1));
	float inputY = getExtrema(featureIndex, 2);
	float inputX = getExtrema(featureIndex, 3);
	float inputAngle = getAngles(featureIndex);
	float cos = ${GM}. * cos(inputAngle);
	float sin = ${GM}. * sin(inputAngle);

	float yp = inputY + freakX * sin + freakY * cos;
	float xp = inputX + freakX * cos + freakY * -sin;

	int x0 = int(floor(xp));
	int x1 = x0 + 1;
	int y0 = int(floor(yp));
	int y1 = y0 + 1;

	float f1 = getPixel(octave, y0, x0);
	float f2 = getPixel(octave, y0, x1);
	float f3 = getPixel(octave, y1, x0);
	float f4 = getPixel(octave, y1, x1);

	float x1f = float(x1);
	float y1f = float(y1);
	float x0f = float(x0);
	float y0f = float(y0);

	// ratio for interpolation between four neighbouring points
	float value = (x1f - xp) * (y1f - yp) * f1
		+ (xp - x0f) * (y1f - yp) * f2
		+ (x1f - xp) * (yp - y0f) * f3
		+ (xp - x0f) * (yp - y0f) * f4;

	setOutput(value);
  }
`};pE[t]=o}return pE[t]}const QH={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:i=>{const{gaussianImagesT:e,prunedExtremas:t,prunedExtremasAngles:r,freakPointsT:s,pyramidImagesLength:o}=i.inputs,l=i.backend,c=XH(o,t);return l.runWebGLProgram(c,[...e,t,r,s],"float32")}},UM=(pf.length-1)*pf.length/2,ZH=Math.ceil(UM/8),fE={};function $H(i){const e=`${i.shape[0]}`;if(!fE.hasOwnProperty(e)){const t={variableNames:["freak","p"],outputShape:[i.shape[0],ZH],userCode:`
  void main() {
    ivec2 coords = getOutputCoords();
    int featureIndex = coords[0];
    int descIndex = coords[1] * 8;

    int sum = 0;
    for (int i = 0; i < 8; i++) {
      if (descIndex + i >= ${UM}) {
        continue;
      }

      int p1 = int(getP(descIndex + i, 0));
      int p2 = int(getP(descIndex + i, 1));

      float v1 = getFreak(featureIndex, p1);
      float v2 = getFreak(featureIndex, p2);

      if (v1 < v2 + 0.01) {
        sum += int(pow(2.0, float(7 - i)));
      }
    }
    setOutput(float(sum));
  }
`};fE[e]=t}return fE[e]}const jH={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:i=>{const{extremaFreaks:e,positionT:t}=i.inputs,{backend:r}=i,s=$H(e);return r.runWebGLProgram(s,[e,t],"int32")}},mE={};function YH(i,e){const t=`${i}|${e}`;if(!mE.hasOwnProperty(t)){const r=[];let s="float getPixel(int octave, int y, int x) {";for(let o=1;o<i;o++)r.push("image"+o),s+=`
				if (octave == ${o}) {
					return getImage${o}(y, x);
				}
			`;s+="}",mE[t]={variableNames:[...r,"extrema"],outputShape:[e,3,3],userCode:`
			${s}
		
			void main() {
				ivec3 coords = getOutputCoords();
				int featureIndex = coords[0];
				float score = getExtrema(featureIndex, 0);
				if (score == 0.0) {
					return;
				}
		
				int dy = coords[1]-1;
				int dx = coords[2]-1;
				int octave = int(getExtrema(featureIndex, 1));
				int y = int(getExtrema(featureIndex, 2));
				int x = int(getExtrema(featureIndex, 3));
				setOutput(getPixel(octave, y+dy, x+dx));
			}
			`}}return mE[t]}const JH={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:i=>{const{prunedExtremasList:e,dogPyramidImagesT:t}=i.inputs,r=i.backend,s=YH(t.length,e.length),o=Vo(e,[e.length,e[0].length],"int32");return r.runWebGLProgram(s,[...t.slice(1),o],t[0].dtype)}},qH=.159154943091895,Ag=36,gE={};function eK(i,e,t){const r=`${t}|${i.shape[0]}|${e.shape[0]}`;if(!gE.hasOwnProperty(r)){const s=[];for(let h=1;h<t;h++)s.push("image"+h);let o="float getPixel(int octave, int y, int x) {";for(let h=1;h<t;h++)o+=`
            if (octave == ${h}) {
                return getImage${h}(y, x);
            }
            `;o+="}";const l={variableNames:[...s,"extrema","radial"],outputShape:[i.shape[0],e.shape[0],2],userCode:`
                ${o}

                void main() {
                    ivec3 coords = getOutputCoords();
                    int featureIndex = coords[0];
                    int radialIndex = coords[1];
                    int propertyIndex = coords[2];

                    int radialY = int(getRadial(radialIndex, 0));
                    int radialX = int(getRadial(radialIndex, 1));
                    float radialW = getRadial(radialIndex, 2);

                    int octave = int(getExtrema(featureIndex, 1));
                    int y = int(getExtrema(featureIndex, 2));
                    int x = int(getExtrema(featureIndex, 3));

                    int xp = x + radialX;
                    int yp = y + radialY;

                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);
                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);

                    if (propertyIndex == 0) {
                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0
                    
                    float angle = atan(dy, dx) + ${Math.PI};
                    float fbin = angle * ${Ag}. * ${qH};
                    setOutput(fbin);
                    return;
                    }

                    if (propertyIndex == 1) {
                        float mag = sqrt(dx * dx + dy * dy);
                        float magnitude = radialW * mag;
                        setOutput(magnitude);
                        return;
                    }
                }

                `},c={variableNames:["fbinMag"],outputShape:[i.shape[0],Ag],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int featureIndex = coords[0];
                int binIndex = coords[1];

                float sum = 0.;
                for (int i = 0; i < ${e.shape[0]}; i++) {
                    float fbin = getFbinMag(featureIndex, i, 0);
                    int bin = int(floor(fbin - 0.5));
                    int b1 = imod(bin + ${Ag}, ${Ag});
                    int b2 = imod(bin + 1 + ${Ag}, ${Ag});

                    if (b1 == binIndex || b2 == binIndex) {
                        float magnitude = getFbinMag(featureIndex, i, 1);
                        float w2 = fbin - float(bin) - 0.5;
                        float w1 = w2 * -1. + 1.;

                        if (b1 == binIndex) {
                            sum += w1 * magnitude;
                        }
                        if (b2 == binIndex) {
                            sum += w2 * magnitude;
                        }
                    }
                }
                setOutput(sum);
            }
            `};gE[r]=[l,c]}return gE[r]}const tK={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:i=>{const{gaussianImagesT:e,prunedExtremasT:t,radialPropertiesT:r,pyramidImagesLength:s}=i.inputs,o=i.backend,[l,c]=eK(t,r,s),h=o.runWebGLProgram(l,[...e,t,r],r.dtype),p=o.runWebGLProgram(c,[h],r.dtype);return o.disposeIntermediateTensorInfo(h),p}},AE={};function nK(i){const e=i.shape[1],t=i.shape[0],r="w"+e+"h"+t;if(!AE.hasOwnProperty(r)){const s={variableNames:["p"],outputShape:[Math.floor(t/2),Math.floor(e/2)],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int y = coords[0] * 2;
                int x = coords[1] * 2;
        
                float sum = getP(y, x) * 0.25;
                sum += getP(y+1,x) * 0.25; 
                sum += getP(y, x+1) * 0.25; 
                sum += getP(y+1,x+1) * 0.25;
                setOutput(sum);
            }
            `};AE[r]=s}return AE[r]}const iK={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:i=>{const e=i.inputs.image,t=i.backend,r=nK(e);return t.runWebGLProgram(r,[e],e.dtype)}},rK={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:i=>{const{extremasResultT:e}=i.inputs,t=i.backend,r=e.shape[0],s=e.shape[1],o={variableNames:["extrema"],outputShape:[Math.floor(r/2),Math.floor(s/2)],userCode:`
		  void main() {
			ivec2 coords = getOutputCoords();
			int y = coords[0] * 2;
			int x = coords[1] * 2;
  
			float location = 0.0;
			float values = getExtrema(y, x);
  
			if (getExtrema(y+1, x) != 0.0) {
			  location = 1.0;
		  values = getExtrema(y+1, x);
			}
			else if (getExtrema(y, x+1) != 0.0) {
			  location = 2.0;
		  values = getExtrema(y, x+1);
			}
			else if (getExtrema(y+1, x+1) != 0.0) {
			  location = 3.0;
		  values = getExtrema(y+1, x+1);
			}
  
			if (values < 0.0) {
			  setOutput(location * -1000.0 + values);
			} else {
			  setOutput(location * 1000.0 + values);
			}
		  }
		`};return t.runWebGLProgram(o,[e],e.dtype)}},Zy=36,sK=5,vE={};function aK(i){const e=`h${i.shape[0]}`;if(!vE.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[i.shape[0],Zy],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();

                int featureIndex = coords[0];
                int binIndex = coords[1];

                int prevBin = imod(binIndex - 1 + ${Zy}, ${Zy});
                int nextBin = imod(binIndex + 1, ${Zy});
                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);

                setOutput(result);
            }
            `};vE[e]=t}return vE[e]}const oK={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:i=>{let{histograms:e}=i.inputs;const t=i.backend,r=aK(e);for(let s=0;s<sK;s++){const o=e;e=t.runWebGLProgram(r,[e],e.dtype),s>0&&t.disposeIntermediateTensorInfo(o)}return e}},yE={};function lK(i,e){const t=e.shape[1],r=e.shape[0],s="w"+t+"h"+r;if(!yE.hasOwnProperty(s)){const o={variableNames:["p"],outputShape:[r,t],userCode:`
              void main() {
                ivec2 coords = getOutputCoords();
                int j = coords[0];
                int i = coords[1];
        
                float sj = 0.5 * float(j) - 0.25; 
                float si = 0.5 * float(i) - 0.25;
        
                float sj0 = floor(sj);
                float sj1 = ceil(sj);
                float si0 = floor(si);
                float si1 = ceil(si);
        
                int sj0I = int(sj0);
                int sj1I = int(sj1);
                int si0I = int(si0);
                int si1I = int(si1);
        
                float sum = 0.0;
                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);
                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);
                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);
                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);
                setOutput(sum);
              }
            `};yE[s]=o}return yE[s]}const cK={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:i=>{const{image:e,targetImage:t}=i.inputs,r=i.backend,s=lK(e,t);return r.runWebGLProgram(s,[e],e.dtype)}};so(GH),so(WH),so(KH),so(QH),so(jH),so(JH),so(tK),so(iK),so(rK),so(oK),so(cK);const VM=8,uK=5,WA=10,hK=5,bE=3,dK=1.5;(pf.length-1)*pf.length/2;class zM{constructor(e,t,r=!1){this.debugMode=r,this.width=e,this.height=t;let s=0;for(;e>=VM&&t>=VM&&(e/=2,t/=2,s++,s!==uK););this.numOctaves=s,this.tensorCaches={},this.kernelCaches={}}detectImageData(e){const t=new Uint8ClampedArray(4*e.length);for(let s=0;s<e.length;s++)t[4*s]=e[s],t[4*s+1]=e[s],t[4*s+2]=e[s],t[4*s+3]=255;const r=new ImageData(t,this.width,this.height);return this.detect(r)}detect(e){let t=null;const r=[];for(let G=0;G<this.numOctaves;G++){let X,fe;G===0?X=this._applyFilter(e):X=this._downsampleBilinear(r[G-1][r[G-1].length-1]),fe=this._applyFilter(X),r.push([X,fe])}const s=[];for(let G=0;G<this.numOctaves;G++){let X=this._differenceImageBinomial(r[G][0],r[G][1]);s.push(X)}const o=[];for(let G=1;G<this.numOctaves-1;G++){const X=this._buildExtremas(s[G-1],s[G],s[G+1]);o.push(X)}const l=this._applyPrune(o),c=this._computeLocalization(l,s),h=this._computeOrientationHistograms(c,r),p=this._smoothHistograms(h),f=this._computeExtremaAngles(p),g=this._computeExtremaFreak(r,c,f),v=this._computeFreakDescriptors(g),w=c.arraySync(),R=f.arraySync(),P=v.arraySync();this.debugMode&&(t={pyramidImages:r.map(G=>G.map(X=>X.arraySync())),dogPyramidImages:s.map(G=>G?G.arraySync():null),extremasResults:o.map(G=>G.arraySync()),extremaAngles:f.arraySync(),prunedExtremas:l,localizedExtremas:c.arraySync()}),r.forEach(G=>G.forEach(X=>X.dispose())),s.forEach(G=>G&&G.dispose()),o.forEach(G=>G.dispose()),c.dispose(),h.dispose(),p.dispose(),f.dispose(),g.dispose(),v.dispose();const z=[];for(let G=0;G<w.length;G++){if(w[G][0]==0)continue;const X=[];for(let $e=0;$e<P[G].length;$e+=4){const rt=P[G][$e],pt=P[G][$e+1],Gt=P[G][$e+2],zt=P[G][$e+3];let Kt=rt*16777216+pt*65536+Gt*256+zt;X.push(Kt)}const fe=w[G][1],ge=w[G][2],be=w[G][3]*Math.pow(2,fe)+Math.pow(2,fe-1)-.5,He=ge*Math.pow(2,fe)+Math.pow(2,fe-1)-.5,Je=Math.pow(2,fe);z.push({maxima:w[G][0]>0,x:be,y:He,scale:Je,angle:R[G],descriptors:X})}return{featurePoints:z,debugExtra:t}}_computeFreakDescriptors(e){if(!this.tensorCaches.computeFreakDescriptors){const r=[],s=[];for(let c=0;c<e.shape[1];c++)for(let h=c+1;h<e.shape[1];h++)r.push(c),s.push(h);const o=Vo(r,[r.length]).cast("int32"),l=Vo(s,[s.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:bl(Vl([o,l],1))}}const{positionT:t}=this.tensorCaches.computeFreakDescriptors;return Pt(()=>ea().runKernel("ComputeFreakDescriptors",{extremaFreaks:e,positionT:t}))}_computeExtremaFreak(e,t,r){this.tensorCaches._computeExtremaFreak||Pt(()=>{const l=Vo(pf);this.tensorCaches._computeExtremaFreak={freakPointsT:bl(l)}});const{freakPointsT:s}=this.tensorCaches._computeExtremaFreak,o=[];for(let l=1;l<e.length;l++)o.push(e[l][1]);return Pt(()=>ea().runKernel("ComputeExtremaFreak",{gaussianImagesT:o,prunedExtremas:t,prunedExtremasAngles:r,freakPointsT:s,pyramidImagesLength:e.length}))}_computeExtremaAngles(e){return Pt(()=>ea().runKernel("ComputeExtremaAngles",{histograms:e}))}_computeOrientationHistograms(e,t){const r=[];for(let o=1;o<t.length;o++)r.push(t[o][1]);this.tensorCaches.orientationHistograms||Pt(()=>{const o=-1/(2*bE*bE),l=bE*dK,c=Math.ceil(l),h=[];for(let p=-c;p<=c;p++)for(let f=-c;f<=c;f++){const g=f*f+p*p;if(g<=l*l){const v=g*o;let w=(720+v*(720+v*(360+v*(120+v*(30+v*(6+v))))))*.0013888888;h.push([p,f,w])}}this.tensorCaches.orientationHistograms={radialPropertiesT:bl(Vo(h,[h.length,3]))}});const{radialPropertiesT:s}=this.tensorCaches.orientationHistograms;return Pt(()=>ea().runKernel("ComputeOrientationHistograms",{gaussianImagesT:r,prunedExtremasT:e,radialPropertiesT:s,pyramidImagesLength:t.length}))}_smoothHistograms(e){return Pt(()=>ea().runKernel("SmoothHistograms",{histograms:e}))}_computeLocalization(e,t){return Pt(()=>{const r=ea().runKernel("ComputeLocalization",{prunedExtremasList:e,dogPyramidImagesT:t}).arraySync(),s=[];for(let l=0;l<r.length;l++){s.push([]);for(let c=0;c<r[l].length;c++)s[l].push([])}const o=[];for(let l=0;l<e.length;l++)o[l]=[e[l][0],e[l][1],e[l][2],e[l][3]];for(let l=0;l<o.length;l++){if(o[l][0]===0)continue;const c=r[l],h=.5*(c[1][2]-c[1][0]),p=.5*(c[2][1]-c[0][1]),f=c[1][2]+c[1][0]-2*c[1][1],g=c[2][1]+c[0][1]-2*c[1][1],v=.25*(c[0][0]+c[2][2]-c[0][2]-c[2][0]),w=f*g-v*v,R=(g*-h+-v*-p)/w,P=(-v*-h+f*-p)/w,z=o[l][2]+P,G=o[l][3]+R;Math.abs(w)<1e-4||(o[l][2]=z,o[l][3]=G)}return Vo(o,[o.length,o[0].length],"float32")})}_applyPrune(e){const t=WA*WA,r=hK,s=[],o=[];for(let c=0;c<t;c++){o.push([]),s.push([]);for(let h=0;h<r;h++)o[c].push([0,0,0,0]),s[c].push(0)}Pt(()=>{for(let c=0;c<e.length;c++){const h=ea().runKernel("ExtremaReduction",{extremasResultT:e[c]}),p=c+1,f=h.arraySync(),g=h.shape[0],v=h.shape[1],w=v*2/WA,R=g*2/WA;for(let P=0;P<g;P++)for(let z=0;z<v;z++){const G=f[P][z];if(G==0)continue;const X=G%1e3,fe=Math.floor(Math.abs(G)/1e3),ge=z*2+(fe===2||fe===3?1:0),be=P*2+(fe===1||fe===3?1:0),He=Math.floor(ge/w),Je=Math.floor(be/R)*WA+He,$e=Math.abs(X);let rt=r;for(;rt>=1&&$e>s[Je][rt-1];)rt-=1;if(rt<r){for(let pt=r-1;pt>=rt+1;pt--)s[Je][pt]=s[Je][pt-1],o[Je][pt][0]=o[Je][pt-1][0],o[Je][pt][1]=o[Je][pt-1][1],o[Je][pt][2]=o[Je][pt-1][2],o[Je][pt][3]=o[Je][pt-1][3];s[Je][rt]=$e,o[Je][rt][0]=X,o[Je][rt][1]=p,o[Je][rt][2]=be,o[Je][rt][3]=ge}}}});const l=[];for(let c=0;c<t;c++)for(let h=0;h<r;h++)l.push(o[c][h]);return l}_buildExtremas(e,t,r){return Pt(()=>ea().runKernel("BuildExtremas",{image0:e,image1:t,image2:r}))}_differenceImageBinomial(e,t){return Pt(()=>e.sub(t))}_applyFilter(e){return Pt(()=>ea().runKernel("BinomialFilter",{image:e}))}_downsampleBilinear(e){return Pt(()=>ea().runKernel("DownsampleBilinear",{image:e}))}_compileAndRun(e,t){const r=Bu().compileAndRun(e,t);return ea().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}_runWebGLProgram(e,t,r){const s=Bu().runWebGLProgram(e,t,r);return ea().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}}class pK{constructor(e,t,r=!1){this.debugMode=r,this.width=e,this.height=t;let s=Math.min(e,t)/2,o=Math.pow(2,Math.round(Math.log(s)/Math.log(2)));this.cropSize=o,this.detector=new zM(o,o,r),this.kernelCaches={},this.lastRandomIndex=4}detect(e){const t=Math.floor(this.height/2-this.cropSize/2),r=Math.floor(this.width/2-this.cropSize/2),s=this._detect(e,r,t);return this.debugMode&&(s.debugExtra.crop={startX:r,startY:t,cropSize:this.cropSize}),s}detectMoving(e){const t=this.lastRandomIndex%3,r=Math.floor(this.lastRandomIndex/3);let s=Math.floor(this.height/2-this.cropSize+r*this.cropSize/2),o=Math.floor(this.width/2-this.cropSize+t*this.cropSize/2);return o<0&&(o=0),s<0&&(s=0),o>=this.width-this.cropSize&&(o=this.width-this.cropSize-1),s>=this.height-this.cropSize&&(s=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(e,o,s)}_detect(e,t,r){const s=e.slice([r,t],[this.cropSize,this.cropSize]),{featurePoints:o,debugExtra:l}=this.detector.detect(s);return o.forEach(c=>{c.x+=t,c.y+=r}),this.debugMode&&(l.projectedImage=s.arraySync()),s.dispose(),{featurePoints:o,debugExtra:l}}}const WM=({image:i,ratio:e})=>{const t=Math.round(i.width*e),r=Math.round(i.height*e),s=new Uint8Array(t*r);for(let o=0;o<t;o++){let l=Math.round(1*o/e),c=Math.round(1*(o+1)/e)-1;c>=i.width&&(c=i.width-1);for(let h=0;h<r;h++){let p=Math.round(1*h/e),f=Math.round(1*(h+1)/e)-1;f>=i.height&&(f=i.height-1);let g=0,v=0;for(let w=l;w<=c;w++)for(let R=p;R<=f;R++)g+=1*i.data[R*i.width+w],v+=1;s[h*t+o]=Math.floor(g/v)}}return{data:s,width:t,height:r}},fK=100,mK=i=>{const e=fK/Math.min(i.width,i.height),t=[];let r=e;for(;;)if(t.push(r),r*=Math.pow(2,1/3),r>=.95){r=1;break}t.push(r),t.reverse();const s=[];for(let o=0;o<t.length;o++)i.width*t[o],i.height*t[o],s.push(Object.assign(WM({image:i,ratio:t[o]}),{scale:t[o]}));return s},gK=i=>{const e=Math.min(i.width,i.height),t=[],r=[];t.push(256/e),t.push(128/e);for(let s=0;s<t.length;s++)r.push(Object.assign(WM({image:i,ratio:t[s]}),{scale:t[s]}));return r},AK=i=>{const{v1:e,v2:t}=i;let r=0;for(let s=0;s<e.length;s++){let o=(e[s]^t[s])>>>0;r+=vK(o)}return r},vK=i=>{var e=i-(i>>1&1431655765);return e=(e>>2&858993459)+(e&858993459),e=(e>>4)+e&252645135,e=(e>>8)+e&16711935,e=(e>>16)+e&65535,e},yK=1234,bK=()=>({seed:yK,arrayShuffle(i){const{arr:e,sampleSize:t}=i;for(let r=0;r<t;r++){this.seed=(214013*this.seed+2531011)%-2147483648;let s=this.seed>>16&32767;s=s%e.length;let o=e[r];e[r]=e[s],e[s]=o}},nextInt(i){this.seed=(214013*this.seed+2531011)%-2147483648;let e=this.seed>>16&32767;return e=e%i,e}}),xK=16,CK=128,xE=8,wK=i=>{const{points:e,pointIndexes:t,randomizer:r}=i,s=[];for(let h=0;h<t.length;h++)s.push(h);let o=Number.MAX_SAFE_INTEGER,l=-1;const c=[];for(let h=0;h<CK;h++){r.arrayShuffle({arr:s,sampleSize:xE});let p=0;const f=[];for(let g=0;g<t.length;g++){let v=Number.MAX_SAFE_INTEGER;for(let w=0;w<xE;w++){const R=t[s[w]],P=AK({v1:e[t[g]].descriptors,v2:e[R].descriptors});P<v&&(f[g]=s[w],v=P)}p+=v}c.push(f),p<o&&(o=p,l=h)}return c[l]},HM=({points:i})=>{const e=[];for(let r=0;r<i.length;r++)e.push(r);const t=bK();return{rootNode:KM({points:i,pointIndexes:e,centerPointIndex:null,randomizer:t})}},KM=i=>{const{points:e,pointIndexes:t,centerPointIndex:r,randomizer:s}=i;let o=!1;(t.length<=xE||t.length<=xK)&&(o=!0);const l={};if(!o){const h=wK({points:e,pointIndexes:t,randomizer:s});for(let p=0;p<h.length;p++)l[t[h[p]]]===void 0&&(l[t[h[p]]]=[]),l[t[h[p]]].push(t[p])}Object.keys(l).length===1&&(o=!0);const c={centerPointIndex:r};if(o){c.leaf=!0,c.pointIndexes=[];for(let h=0;h<t.length;h++)c.pointIndexes.push(t[h]);return c}return c.leaf=!1,c.children=[],Object.keys(l).forEach(h=>{c.children.push(KM({points:e,pointIndexes:l[h],centerPointIndex:h,randomizer:s}))}),c};var $y={},EK={get exports(){return $y},set exports(i){$y=i}};(function(i,e){(function(t,r){i.exports=r()})(la,function(){return function(t){var r={};function s(o){if(r[o])return r[o].exports;var l=r[o]={i:o,l:!1,exports:{}};return t[o].call(l.exports,l,l.exports,s),l.l=!0,l.exports}return s.m=t,s.c=r,s.d=function(o,l,c){s.o(o,l)||Object.defineProperty(o,l,{enumerable:!0,get:c})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,l){if(1&l&&(o=s(o)),8&l||4&l&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(s.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),2&l&&typeof o!="string")for(var h in o)s.d(c,h,function(p){return o[p]}.bind(null,h));return c},s.n=function(o){var l=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(l,"a",l),l},s.o=function(o,l){return Object.prototype.hasOwnProperty.call(o,l)},s.p="",s(s.s=0)}([function(t,r,s){s.r(r),s.d(r,"encode",function(){return tn}),s.d(r,"decode",function(){return xr}),s.d(r,"decodeAsync",function(){return ba}),s.d(r,"decodeArrayStream",function(){return Ta}),s.d(r,"decodeStream",function(){return vu}),s.d(r,"Decoder",function(){return Di}),s.d(r,"Encoder",function(){return zt}),s.d(r,"ExtensionCodec",function(){return rt}),s.d(r,"ExtData",function(){return P}),s.d(r,"EXT_TIMESTAMP",function(){return X}),s.d(r,"encodeDateToTimeSpec",function(){return ge}),s.d(r,"encodeTimeSpecToTimestamp",function(){return fe}),s.d(r,"decodeTimestampToTimeSpec",function(){return He}),s.d(r,"encodeTimestampExtension",function(){return be}),s.d(r,"decodeTimestampExtension",function(){return Je});var o=function(xt,ke){var lt=typeof Symbol=="function"&&xt[Symbol.iterator];if(!lt)return xt;var bt,gt,an=lt.call(xt),Wt=[];try{for(;(ke===void 0||ke-- >0)&&!(bt=an.next()).done;)Wt.push(bt.value)}catch(jn){gt={error:jn}}finally{try{bt&&!bt.done&&(lt=an.return)&&lt.call(an)}finally{if(gt)throw gt.error}}return Wt},l=function(){for(var xt=[],ke=0;ke<arguments.length;ke++)xt=xt.concat(o(arguments[ke]));return xt},c=typeof process<"u"&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function h(xt){for(var ke=xt.length,lt=0,bt=0;bt<ke;){var gt=xt.charCodeAt(bt++);if(4294967168&gt)if(!(4294965248&gt))lt+=2;else{if(gt>=55296&&gt<=56319&&bt<ke){var an=xt.charCodeAt(bt);(64512&an)==56320&&(++bt,gt=((1023&gt)<<10)+(1023&an)+65536)}lt+=4294901760&gt?4:3}else lt++}return lt}var p=c?new TextEncoder:void 0,f=typeof process<"u"?200:0,g=p!=null&&p.encodeInto?function(xt,ke,lt){p.encodeInto(xt,ke.subarray(lt))}:function(xt,ke,lt){ke.set(p.encode(xt),lt)};function v(xt,ke,lt){for(var bt=ke,gt=bt+lt,an=[],Wt="";bt<gt;){var jn=xt[bt++];if(!(128&jn))an.push(jn);else if((224&jn)==192){var Wi=63&xt[bt++];an.push((31&jn)<<6|Wi)}else if((240&jn)==224){Wi=63&xt[bt++];var Yi=63&xt[bt++];an.push((31&jn)<<12|Wi<<6|Yi)}else if((248&jn)==240){var nn=(7&jn)<<18|(Wi=63&xt[bt++])<<12|(Yi=63&xt[bt++])<<6|63&xt[bt++];nn>65535&&(nn-=65536,an.push(nn>>>10&1023|55296),nn=56320|1023&nn),an.push(nn)}else an.push(jn);an.length>=4096&&(Wt+=String.fromCharCode.apply(String,l(an)),an.length=0)}return an.length>0&&(Wt+=String.fromCharCode.apply(String,l(an))),Wt}var w=c?new TextDecoder:null,R=typeof process<"u"?200:0,P=function(xt,ke){this.type=xt,this.data=ke};function z(xt,ke,lt){var bt=Math.floor(lt/4294967296),gt=lt;xt.setUint32(ke,bt),xt.setUint32(ke+4,gt)}function G(xt,ke){return 4294967296*xt.getInt32(ke)+xt.getUint32(ke+4)}var X=-1;function fe(xt){var ke=xt.sec,lt=xt.nsec;if(ke>=0&&lt>=0&&ke<=17179869183){if(lt===0&&ke<=4294967295){var bt=new Uint8Array(4);return(Wt=new DataView(bt.buffer)).setUint32(0,ke),bt}var gt=ke/4294967296,an=4294967295&ke;return bt=new Uint8Array(8),(Wt=new DataView(bt.buffer)).setUint32(0,lt<<2|3&gt),Wt.setUint32(4,an),bt}var Wt;return bt=new Uint8Array(12),(Wt=new DataView(bt.buffer)).setUint32(0,lt),z(Wt,4,ke),bt}function ge(xt){var ke=xt.getTime(),lt=Math.floor(ke/1e3),bt=1e6*(ke-1e3*lt),gt=Math.floor(bt/1e9);return{sec:lt+gt,nsec:bt-1e9*gt}}function be(xt){return xt instanceof Date?fe(ge(xt)):null}function He(xt){var ke=new DataView(xt.buffer,xt.byteOffset,xt.byteLength);switch(xt.byteLength){case 4:return{sec:ke.getUint32(0),nsec:0};case 8:var lt=ke.getUint32(0);return{sec:4294967296*(3&lt)+ke.getUint32(4),nsec:lt>>>2};case 12:return{sec:G(ke,4),nsec:ke.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+xt.length)}}function Je(xt){var ke=He(xt);return new Date(1e3*ke.sec+ke.nsec/1e6)}var $e={type:X,encode:be,decode:Je},rt=function(){function xt(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register($e)}return xt.prototype.register=function(ke){var lt=ke.type,bt=ke.encode,gt=ke.decode;if(lt>=0)this.encoders[lt]=bt,this.decoders[lt]=gt;else{var an=1+lt;this.builtInEncoders[an]=bt,this.builtInDecoders[an]=gt}},xt.prototype.tryToEncode=function(ke,lt){for(var bt=0;bt<this.builtInEncoders.length;bt++)if((gt=this.builtInEncoders[bt])!=null&&(an=gt(ke,lt))!=null)return new P(-1-bt,an);for(bt=0;bt<this.encoders.length;bt++){var gt,an;if((gt=this.encoders[bt])!=null&&(an=gt(ke,lt))!=null)return new P(bt,an)}return ke instanceof P?ke:null},xt.prototype.decode=function(ke,lt,bt){var gt=lt<0?this.builtInDecoders[-1-lt]:this.decoders[lt];return gt?gt(ke,lt,bt):new P(lt,ke)},xt.defaultCodec=new xt,xt}();function pt(xt){return xt instanceof Uint8Array?xt:ArrayBuffer.isView(xt)?new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength):xt instanceof ArrayBuffer?new Uint8Array(xt):Uint8Array.from(xt)}var Gt=function(xt){var ke=typeof Symbol=="function"&&Symbol.iterator,lt=ke&&xt[ke],bt=0;if(lt)return lt.call(xt);if(xt&&typeof xt.length=="number")return{next:function(){return xt&&bt>=xt.length&&(xt=void 0),{value:xt&&xt[bt++],done:!xt}}};throw new TypeError(ke?"Object is not iterable.":"Symbol.iterator is not defined.")},zt=function(){function xt(ke,lt,bt,gt,an,Wt,jn){ke===void 0&&(ke=rt.defaultCodec),bt===void 0&&(bt=100),gt===void 0&&(gt=2048),an===void 0&&(an=!1),Wt===void 0&&(Wt=!1),jn===void 0&&(jn=!1),this.extensionCodec=ke,this.context=lt,this.maxDepth=bt,this.initialBufferSize=gt,this.sortKeys=an,this.forceFloat32=Wt,this.ignoreUndefined=jn,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return xt.prototype.encode=function(ke,lt){if(lt>this.maxDepth)throw new Error("Too deep objects in depth "+lt);ke==null?this.encodeNil():typeof ke=="boolean"?this.encodeBoolean(ke):typeof ke=="number"?this.encodeNumber(ke):typeof ke=="string"?this.encodeString(ke):this.encodeObject(ke,lt)},xt.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},xt.prototype.ensureBufferSizeToWrite=function(ke){var lt=this.pos+ke;this.view.byteLength<lt&&this.resizeBuffer(2*lt)},xt.prototype.resizeBuffer=function(ke){var lt=new ArrayBuffer(ke),bt=new Uint8Array(lt),gt=new DataView(lt);bt.set(this.bytes),this.view=gt,this.bytes=bt},xt.prototype.encodeNil=function(){this.writeU8(192)},xt.prototype.encodeBoolean=function(ke){ke===!1?this.writeU8(194):this.writeU8(195)},xt.prototype.encodeNumber=function(ke){Number.isSafeInteger(ke)?ke>=0?ke<128?this.writeU8(ke):ke<256?(this.writeU8(204),this.writeU8(ke)):ke<65536?(this.writeU8(205),this.writeU16(ke)):ke<4294967296?(this.writeU8(206),this.writeU32(ke)):(this.writeU8(207),this.writeU64(ke)):ke>=-32?this.writeU8(224|ke+32):ke>=-128?(this.writeU8(208),this.writeI8(ke)):ke>=-32768?(this.writeU8(209),this.writeI16(ke)):ke>=-2147483648?(this.writeU8(210),this.writeI32(ke)):(this.writeU8(211),this.writeI64(ke)):this.forceFloat32?(this.writeU8(202),this.writeF32(ke)):(this.writeU8(203),this.writeF64(ke))},xt.prototype.writeStringHeader=function(ke){if(ke<32)this.writeU8(160+ke);else if(ke<256)this.writeU8(217),this.writeU8(ke);else if(ke<65536)this.writeU8(218),this.writeU16(ke);else{if(!(ke<4294967296))throw new Error("Too long string: "+ke+" bytes in UTF-8");this.writeU8(219),this.writeU32(ke)}},xt.prototype.encodeString=function(ke){var lt=ke.length;if(c&&lt>f){var bt=h(ke);this.ensureBufferSizeToWrite(5+bt),this.writeStringHeader(bt),g(ke,this.bytes,this.pos),this.pos+=bt}else bt=h(ke),this.ensureBufferSizeToWrite(5+bt),this.writeStringHeader(bt),function(gt,an,Wt){for(var jn=gt.length,Wi=Wt,Yi=0;Yi<jn;){var nn=gt.charCodeAt(Yi++);if(4294967168&nn){if(!(4294965248&nn))an[Wi++]=nn>>6&31|192;else{if(nn>=55296&&nn<=56319&&Yi<jn){var yr=gt.charCodeAt(Yi);(64512&yr)==56320&&(++Yi,nn=((1023&nn)<<10)+(1023&yr)+65536)}4294901760&nn?(an[Wi++]=nn>>18&7|240,an[Wi++]=nn>>12&63|128,an[Wi++]=nn>>6&63|128):(an[Wi++]=nn>>12&15|224,an[Wi++]=nn>>6&63|128)}an[Wi++]=63&nn|128}else an[Wi++]=nn}}(ke,this.bytes,this.pos),this.pos+=bt},xt.prototype.encodeObject=function(ke,lt){var bt=this.extensionCodec.tryToEncode(ke,this.context);if(bt!=null)this.encodeExtension(bt);else if(Array.isArray(ke))this.encodeArray(ke,lt);else if(ArrayBuffer.isView(ke))this.encodeBinary(ke);else{if(typeof ke!="object")throw new Error("Unrecognized object: "+Object.prototype.toString.apply(ke));this.encodeMap(ke,lt)}},xt.prototype.encodeBinary=function(ke){var lt=ke.byteLength;if(lt<256)this.writeU8(196),this.writeU8(lt);else if(lt<65536)this.writeU8(197),this.writeU16(lt);else{if(!(lt<4294967296))throw new Error("Too large binary: "+lt);this.writeU8(198),this.writeU32(lt)}var bt=pt(ke);this.writeU8a(bt)},xt.prototype.encodeArray=function(ke,lt){var bt,gt,an=ke.length;if(an<16)this.writeU8(144+an);else if(an<65536)this.writeU8(220),this.writeU16(an);else{if(!(an<4294967296))throw new Error("Too large array: "+an);this.writeU8(221),this.writeU32(an)}try{for(var Wt=Gt(ke),jn=Wt.next();!jn.done;jn=Wt.next()){var Wi=jn.value;this.encode(Wi,lt+1)}}catch(Yi){bt={error:Yi}}finally{try{jn&&!jn.done&&(gt=Wt.return)&&gt.call(Wt)}finally{if(bt)throw bt.error}}},xt.prototype.countWithoutUndefined=function(ke,lt){var bt,gt,an=0;try{for(var Wt=Gt(lt),jn=Wt.next();!jn.done;jn=Wt.next())ke[jn.value]!==void 0&&an++}catch(Wi){bt={error:Wi}}finally{try{jn&&!jn.done&&(gt=Wt.return)&&gt.call(Wt)}finally{if(bt)throw bt.error}}return an},xt.prototype.encodeMap=function(ke,lt){var bt,gt,an=Object.keys(ke);this.sortKeys&&an.sort();var Wt=this.ignoreUndefined?this.countWithoutUndefined(ke,an):an.length;if(Wt<16)this.writeU8(128+Wt);else if(Wt<65536)this.writeU8(222),this.writeU16(Wt);else{if(!(Wt<4294967296))throw new Error("Too large map object: "+Wt);this.writeU8(223),this.writeU32(Wt)}try{for(var jn=Gt(an),Wi=jn.next();!Wi.done;Wi=jn.next()){var Yi=Wi.value,nn=ke[Yi];this.ignoreUndefined&&nn===void 0||(this.encodeString(Yi),this.encode(nn,lt+1))}}catch(yr){bt={error:yr}}finally{try{Wi&&!Wi.done&&(gt=jn.return)&&gt.call(jn)}finally{if(bt)throw bt.error}}},xt.prototype.encodeExtension=function(ke){var lt=ke.data.length;if(lt===1)this.writeU8(212);else if(lt===2)this.writeU8(213);else if(lt===4)this.writeU8(214);else if(lt===8)this.writeU8(215);else if(lt===16)this.writeU8(216);else if(lt<256)this.writeU8(199),this.writeU8(lt);else if(lt<65536)this.writeU8(200),this.writeU16(lt);else{if(!(lt<4294967296))throw new Error("Too large extension object: "+lt);this.writeU8(201),this.writeU32(lt)}this.writeI8(ke.type),this.writeU8a(ke.data)},xt.prototype.writeU8=function(ke){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,ke),this.pos++},xt.prototype.writeU8a=function(ke){var lt=ke.length;this.ensureBufferSizeToWrite(lt),this.bytes.set(ke,this.pos),this.pos+=lt},xt.prototype.writeI8=function(ke){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,ke),this.pos++},xt.prototype.writeU16=function(ke){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,ke),this.pos+=2},xt.prototype.writeI16=function(ke){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,ke),this.pos+=2},xt.prototype.writeU32=function(ke){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,ke),this.pos+=4},xt.prototype.writeI32=function(ke){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,ke),this.pos+=4},xt.prototype.writeF32=function(ke){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,ke),this.pos+=4},xt.prototype.writeF64=function(ke){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,ke),this.pos+=8},xt.prototype.writeU64=function(ke){this.ensureBufferSizeToWrite(8),function(lt,bt,gt){var an=gt/4294967296,Wt=gt;lt.setUint32(bt,an),lt.setUint32(bt+4,Wt)}(this.view,this.pos,ke),this.pos+=8},xt.prototype.writeI64=function(ke){this.ensureBufferSizeToWrite(8),z(this.view,this.pos,ke),this.pos+=8},xt}(),Kt={};function tn(xt,ke){ke===void 0&&(ke=Kt);var lt=new zt(ke.extensionCodec,ke.context,ke.maxDepth,ke.initialBufferSize,ke.sortKeys,ke.forceFloat32,ke.ignoreUndefined);return lt.encode(xt,1),lt.getUint8Array()}function qt(xt){return(xt<0?"-":"")+"0x"+Math.abs(xt).toString(16).padStart(2,"0")}var sn=function(){function xt(ke,lt){ke===void 0&&(ke=16),lt===void 0&&(lt=16),this.maxKeyLength=ke,this.maxLengthPerKey=lt,this.caches=[];for(var bt=0;bt<this.maxKeyLength;bt++)this.caches.push([])}return xt.prototype.canBeCached=function(ke){return ke>0&&ke<=this.maxKeyLength},xt.prototype.get=function(ke,lt,bt){var gt=this.caches[bt-1],an=gt.length;e:for(var Wt=0;Wt<an;Wt++){for(var jn=gt[Wt],Wi=jn.bytes,Yi=0;Yi<bt;Yi++)if(Wi[Yi]!==ke[lt+Yi])continue e;return jn.value}return null},xt.prototype.store=function(ke,lt){var bt=this.caches[ke.length-1],gt={bytes:ke,value:lt};bt.length>=this.maxLengthPerKey?bt[Math.random()*bt.length|0]=gt:bt.push(gt)},xt.prototype.decode=function(ke,lt,bt){var gt=this.get(ke,lt,bt);if(gt!=null)return gt;var an=v(ke,lt,bt),Wt=Uint8Array.prototype.slice.call(ke,lt,lt+bt);return this.store(Wt,an),an},xt}(),xn=function(xt,ke,lt,bt){return new(lt||(lt=Promise))(function(gt,an){function Wt(Yi){try{Wi(bt.next(Yi))}catch(nn){an(nn)}}function jn(Yi){try{Wi(bt.throw(Yi))}catch(nn){an(nn)}}function Wi(Yi){var nn;Yi.done?gt(Yi.value):(nn=Yi.value,nn instanceof lt?nn:new lt(function(yr){yr(nn)})).then(Wt,jn)}Wi((bt=bt.apply(xt,ke||[])).next())})},dn=function(xt,ke){var lt,bt,gt,an,Wt={label:0,sent:function(){if(1&gt[0])throw gt[1];return gt[1]},trys:[],ops:[]};return an={next:jn(0),throw:jn(1),return:jn(2)},typeof Symbol=="function"&&(an[Symbol.iterator]=function(){return this}),an;function jn(Wi){return function(Yi){return function(nn){if(lt)throw new TypeError("Generator is already executing.");for(;Wt;)try{if(lt=1,bt&&(gt=2&nn[0]?bt.return:nn[0]?bt.throw||((gt=bt.return)&&gt.call(bt),0):bt.next)&&!(gt=gt.call(bt,nn[1])).done)return gt;switch(bt=0,gt&&(nn=[2&nn[0],gt.value]),nn[0]){case 0:case 1:gt=nn;break;case 4:return Wt.label++,{value:nn[1],done:!1};case 5:Wt.label++,bt=nn[1],nn=[0];continue;case 7:nn=Wt.ops.pop(),Wt.trys.pop();continue;default:if(gt=Wt.trys,!((gt=gt.length>0&&gt[gt.length-1])||nn[0]!==6&&nn[0]!==2)){Wt=0;continue}if(nn[0]===3&&(!gt||nn[1]>gt[0]&&nn[1]<gt[3])){Wt.label=nn[1];break}if(nn[0]===6&&Wt.label<gt[1]){Wt.label=gt[1],gt=nn;break}if(gt&&Wt.label<gt[2]){Wt.label=gt[2],Wt.ops.push(nn);break}gt[2]&&Wt.ops.pop(),Wt.trys.pop();continue}nn=ke.call(xt,Wt)}catch(yr){nn=[6,yr],bt=0}finally{lt=gt=0}if(5&nn[0])throw nn[1];return{value:nn[0]?nn[1]:void 0,done:!0}}([Wi,Yi])}}},Mn=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ke,lt=xt[Symbol.asyncIterator];return lt?lt.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),ke={},bt("next"),bt("throw"),bt("return"),ke[Symbol.asyncIterator]=function(){return this},ke);function bt(gt){ke[gt]=xt[gt]&&function(an){return new Promise(function(Wt,jn){(function(Wi,Yi,nn,yr){Promise.resolve(yr).then(function(rs){Wi({value:rs,done:nn})},Yi)})(Wt,jn,(an=xt[gt](an)).done,an.value)})}}},zn=function(xt){return this instanceof zn?(this.v=xt,this):new zn(xt)},Gn=function(xt,ke,lt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var bt,gt=lt.apply(xt,ke||[]),an=[];return bt={},Wt("next"),Wt("throw"),Wt("return"),bt[Symbol.asyncIterator]=function(){return this},bt;function Wt(yr){gt[yr]&&(bt[yr]=function(rs){return new Promise(function(Eo,go){an.push([yr,rs,Eo,go])>1||jn(yr,rs)})})}function jn(yr,rs){try{(Eo=gt[yr](rs)).value instanceof zn?Promise.resolve(Eo.value.v).then(Wi,Yi):nn(an[0][2],Eo)}catch(go){nn(an[0][3],go)}var Eo}function Wi(yr){jn("next",yr)}function Yi(yr){jn("throw",yr)}function nn(yr,rs){yr(rs),an.shift(),an.length&&jn(an[0][0],an[0][1])}},$n=new DataView(new ArrayBuffer(0)),ei=new Uint8Array($n.buffer),si=function(){try{$n.getInt8(0)}catch(xt){return xt.constructor}throw new Error("never reached")}(),ci=new si("Insufficient data"),Qi=new sn,Di=function(){function xt(ke,lt,bt,gt,an,Wt,jn,Wi){ke===void 0&&(ke=rt.defaultCodec),bt===void 0&&(bt=4294967295),gt===void 0&&(gt=4294967295),an===void 0&&(an=4294967295),Wt===void 0&&(Wt=4294967295),jn===void 0&&(jn=4294967295),Wi===void 0&&(Wi=Qi),this.extensionCodec=ke,this.context=lt,this.maxStrLength=bt,this.maxBinLength=gt,this.maxArrayLength=an,this.maxMapLength=Wt,this.maxExtLength=jn,this.cachedKeyDecoder=Wi,this.totalPos=0,this.pos=0,this.view=$n,this.bytes=ei,this.headByte=-1,this.stack=[]}return xt.prototype.setBuffer=function(ke){this.bytes=pt(ke),this.view=function(lt){if(lt instanceof ArrayBuffer)return new DataView(lt);var bt=pt(lt);return new DataView(bt.buffer,bt.byteOffset,bt.byteLength)}(this.bytes),this.pos=0},xt.prototype.appendBuffer=function(ke){if(this.headByte!==-1||this.hasRemaining()){var lt=this.bytes.subarray(this.pos),bt=pt(ke),gt=new Uint8Array(lt.length+bt.length);gt.set(lt),gt.set(bt,lt.length),this.setBuffer(gt)}else this.setBuffer(ke)},xt.prototype.hasRemaining=function(ke){return ke===void 0&&(ke=1),this.view.byteLength-this.pos>=ke},xt.prototype.createNoExtraBytesError=function(ke){var lt=this.view,bt=this.pos;return new RangeError("Extra "+(lt.byteLength-bt)+" byte(s) found at buffer["+ke+"]")},xt.prototype.decodeSingleSync=function(){var ke=this.decodeSync();if(this.hasRemaining())throw this.createNoExtraBytesError(this.pos);return ke},xt.prototype.decodeSingleAsync=function(ke){var lt,bt,gt,an;return xn(this,void 0,void 0,function(){var Wt,jn,Wi,Yi,nn,yr,rs,Eo;return dn(this,function(go){switch(go.label){case 0:Wt=!1,go.label=1;case 1:go.trys.push([1,6,7,12]),lt=Mn(ke),go.label=2;case 2:return[4,lt.next()];case 3:if((bt=go.sent()).done)return[3,5];if(Wi=bt.value,Wt)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(Wi);try{jn=this.decodeSync(),Wt=!0}catch(jy){if(!(jy instanceof si))throw jy}this.totalPos+=this.pos,go.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Yi=go.sent(),gt={error:Yi},[3,12];case 7:return go.trys.push([7,,10,11]),bt&&!bt.done&&(an=lt.return)?[4,an.call(lt)]:[3,9];case 8:go.sent(),go.label=9;case 9:return[3,11];case 10:if(gt)throw gt.error;return[7];case 11:return[7];case 12:if(Wt){if(this.hasRemaining())throw this.createNoExtraBytesError(this.totalPos);return[2,jn]}throw yr=(nn=this).headByte,rs=nn.pos,Eo=nn.totalPos,new RangeError("Insufficient data in parcing "+qt(yr)+" at "+Eo+" ("+rs+" in the current buffer)")}})})},xt.prototype.decodeArrayStream=function(ke){return this.decodeMultiAsync(ke,!0)},xt.prototype.decodeStream=function(ke){return this.decodeMultiAsync(ke,!1)},xt.prototype.decodeMultiAsync=function(ke,lt){return Gn(this,arguments,function(){var bt,gt,an,Wt,jn,Wi,Yi,nn,yr;return dn(this,function(rs){switch(rs.label){case 0:bt=lt,gt=-1,rs.label=1;case 1:rs.trys.push([1,13,14,19]),an=Mn(ke),rs.label=2;case 2:return[4,zn(an.next())];case 3:if((Wt=rs.sent()).done)return[3,12];if(jn=Wt.value,lt&&gt===0)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(jn),bt&&(gt=this.readArraySize(),bt=!1,this.complete()),rs.label=4;case 4:rs.trys.push([4,9,,10]),rs.label=5;case 5:return[4,zn(this.decodeSync())];case 6:return[4,rs.sent()];case 7:return rs.sent(),--gt==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((Wi=rs.sent())instanceof si))throw Wi;return[3,10];case 10:this.totalPos+=this.pos,rs.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return Yi=rs.sent(),nn={error:Yi},[3,19];case 14:return rs.trys.push([14,,17,18]),Wt&&!Wt.done&&(yr=an.return)?[4,zn(yr.call(an))]:[3,16];case 15:rs.sent(),rs.label=16;case 16:return[3,18];case 17:if(nn)throw nn.error;return[7];case 18:return[7];case 19:return[2]}})})},xt.prototype.decodeSync=function(){e:for(;;){var ke=this.readHeadByte(),lt=void 0;if(ke>=224)lt=ke-256;else if(ke<192)if(ke<128)lt=ke;else if(ke<144){if((gt=ke-128)!==0){this.pushMapState(gt),this.complete();continue e}lt={}}else if(ke<160){if((gt=ke-144)!==0){this.pushArrayState(gt),this.complete();continue e}lt=[]}else{var bt=ke-160;lt=this.decodeUtf8String(bt,0)}else if(ke===192)lt=null;else if(ke===194)lt=!1;else if(ke===195)lt=!0;else if(ke===202)lt=this.readF32();else if(ke===203)lt=this.readF64();else if(ke===204)lt=this.readU8();else if(ke===205)lt=this.readU16();else if(ke===206)lt=this.readU32();else if(ke===207)lt=this.readU64();else if(ke===208)lt=this.readI8();else if(ke===209)lt=this.readI16();else if(ke===210)lt=this.readI32();else if(ke===211)lt=this.readI64();else if(ke===217)bt=this.lookU8(),lt=this.decodeUtf8String(bt,1);else if(ke===218)bt=this.lookU16(),lt=this.decodeUtf8String(bt,2);else if(ke===219)bt=this.lookU32(),lt=this.decodeUtf8String(bt,4);else if(ke===220){if((gt=this.readU16())!==0){this.pushArrayState(gt),this.complete();continue e}lt=[]}else if(ke===221){if((gt=this.readU32())!==0){this.pushArrayState(gt),this.complete();continue e}lt=[]}else if(ke===222){if((gt=this.readU16())!==0){this.pushMapState(gt),this.complete();continue e}lt={}}else if(ke===223){if((gt=this.readU32())!==0){this.pushMapState(gt),this.complete();continue e}lt={}}else if(ke===196){var gt=this.lookU8();lt=this.decodeBinary(gt,1)}else if(ke===197)gt=this.lookU16(),lt=this.decodeBinary(gt,2);else if(ke===198)gt=this.lookU32(),lt=this.decodeBinary(gt,4);else if(ke===212)lt=this.decodeExtension(1,0);else if(ke===213)lt=this.decodeExtension(2,0);else if(ke===214)lt=this.decodeExtension(4,0);else if(ke===215)lt=this.decodeExtension(8,0);else if(ke===216)lt=this.decodeExtension(16,0);else if(ke===199)gt=this.lookU8(),lt=this.decodeExtension(gt,1);else if(ke===200)gt=this.lookU16(),lt=this.decodeExtension(gt,2);else{if(ke!==201)throw new Error("Unrecognized type byte: "+qt(ke));gt=this.lookU32(),lt=this.decodeExtension(gt,4)}this.complete();for(var an=this.stack;an.length>0;){var Wt=an[an.length-1];if(Wt.type===0){if(Wt.array[Wt.position]=lt,Wt.position++,Wt.position!==Wt.size)continue e;an.pop(),lt=Wt.array}else{if(Wt.type===1){if(jn=void 0,(jn=typeof lt)!="string"&&jn!=="number")throw new Error("The type of key must be string or number but "+typeof lt);Wt.key=lt,Wt.type=2;continue e}if(Wt.map[Wt.key]=lt,Wt.readCount++,Wt.readCount!==Wt.size){Wt.key=null,Wt.type=1;continue e}an.pop(),lt=Wt.map}}return lt}var jn},xt.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},xt.prototype.complete=function(){this.headByte=-1},xt.prototype.readArraySize=function(){var ke=this.readHeadByte();switch(ke){case 220:return this.readU16();case 221:return this.readU32();default:if(ke<160)return ke-144;throw new Error("Unrecognized array type byte: "+qt(ke))}},xt.prototype.pushMapState=function(ke){if(ke>this.maxMapLength)throw new Error("Max length exceeded: map length ("+ke+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:ke,key:null,readCount:0,map:{}})},xt.prototype.pushArrayState=function(ke){if(ke>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+ke+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:ke,array:new Array(ke),position:0})},xt.prototype.decodeUtf8String=function(ke,lt){var bt;if(ke>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+ke+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+lt+ke)throw ci;var gt,an=this.pos+lt;return gt=this.stateIsMapKey()&&!((bt=this.cachedKeyDecoder)===null||bt===void 0)&&bt.canBeCached(ke)?this.cachedKeyDecoder.decode(this.bytes,an,ke):c&&ke>R?function(Wt,jn,Wi){var Yi=Wt.subarray(jn,jn+Wi);return w.decode(Yi)}(this.bytes,an,ke):v(this.bytes,an,ke),this.pos+=lt+ke,gt},xt.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===1},xt.prototype.decodeBinary=function(ke,lt){if(ke>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+ke+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(ke+lt))throw ci;var bt=this.pos+lt,gt=this.bytes.subarray(bt,bt+ke);return this.pos+=lt+ke,gt},xt.prototype.decodeExtension=function(ke,lt){if(ke>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+ke+") > maxExtLength ("+this.maxExtLength+")");var bt=this.view.getInt8(this.pos+lt),gt=this.decodeBinary(ke,lt+1);return this.extensionCodec.decode(gt,bt,this.context)},xt.prototype.lookU8=function(){return this.view.getUint8(this.pos)},xt.prototype.lookU16=function(){return this.view.getUint16(this.pos)},xt.prototype.lookU32=function(){return this.view.getUint32(this.pos)},xt.prototype.readU8=function(){var ke=this.view.getUint8(this.pos);return this.pos++,ke},xt.prototype.readI8=function(){var ke=this.view.getInt8(this.pos);return this.pos++,ke},xt.prototype.readU16=function(){var ke=this.view.getUint16(this.pos);return this.pos+=2,ke},xt.prototype.readI16=function(){var ke=this.view.getInt16(this.pos);return this.pos+=2,ke},xt.prototype.readU32=function(){var ke=this.view.getUint32(this.pos);return this.pos+=4,ke},xt.prototype.readI32=function(){var ke=this.view.getInt32(this.pos);return this.pos+=4,ke},xt.prototype.readU64=function(){var ke,lt,bt=(ke=this.view,lt=this.pos,4294967296*ke.getUint32(lt)+ke.getUint32(lt+4));return this.pos+=8,bt},xt.prototype.readI64=function(){var ke=G(this.view,this.pos);return this.pos+=8,ke},xt.prototype.readF32=function(){var ke=this.view.getFloat32(this.pos);return this.pos+=4,ke},xt.prototype.readF64=function(){var ke=this.view.getFloat64(this.pos);return this.pos+=8,ke},xt}(),Zi={};function xr(xt,ke){ke===void 0&&(ke=Zi);var lt=new Di(ke.extensionCodec,ke.context,ke.maxStrLength,ke.maxBinLength,ke.maxArrayLength,ke.maxMapLength,ke.maxExtLength);return lt.setBuffer(xt),lt.decodeSingleSync()}var Lr=function(xt,ke){var lt,bt,gt,an,Wt={label:0,sent:function(){if(1&gt[0])throw gt[1];return gt[1]},trys:[],ops:[]};return an={next:jn(0),throw:jn(1),return:jn(2)},typeof Symbol=="function"&&(an[Symbol.iterator]=function(){return this}),an;function jn(Wi){return function(Yi){return function(nn){if(lt)throw new TypeError("Generator is already executing.");for(;Wt;)try{if(lt=1,bt&&(gt=2&nn[0]?bt.return:nn[0]?bt.throw||((gt=bt.return)&&gt.call(bt),0):bt.next)&&!(gt=gt.call(bt,nn[1])).done)return gt;switch(bt=0,gt&&(nn=[2&nn[0],gt.value]),nn[0]){case 0:case 1:gt=nn;break;case 4:return Wt.label++,{value:nn[1],done:!1};case 5:Wt.label++,bt=nn[1],nn=[0];continue;case 7:nn=Wt.ops.pop(),Wt.trys.pop();continue;default:if(gt=Wt.trys,!((gt=gt.length>0&&gt[gt.length-1])||nn[0]!==6&&nn[0]!==2)){Wt=0;continue}if(nn[0]===3&&(!gt||nn[1]>gt[0]&&nn[1]<gt[3])){Wt.label=nn[1];break}if(nn[0]===6&&Wt.label<gt[1]){Wt.label=gt[1],gt=nn;break}if(gt&&Wt.label<gt[2]){Wt.label=gt[2],Wt.ops.push(nn);break}gt[2]&&Wt.ops.pop(),Wt.trys.pop();continue}nn=ke.call(xt,Wt)}catch(yr){nn=[6,yr],bt=0}finally{lt=gt=0}if(5&nn[0])throw nn[1];return{value:nn[0]?nn[1]:void 0,done:!0}}([Wi,Yi])}}},Rr=function(xt){return this instanceof Rr?(this.v=xt,this):new Rr(xt)},gs=function(xt,ke,lt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var bt,gt=lt.apply(xt,ke||[]),an=[];return bt={},Wt("next"),Wt("throw"),Wt("return"),bt[Symbol.asyncIterator]=function(){return this},bt;function Wt(yr){gt[yr]&&(bt[yr]=function(rs){return new Promise(function(Eo,go){an.push([yr,rs,Eo,go])>1||jn(yr,rs)})})}function jn(yr,rs){try{(Eo=gt[yr](rs)).value instanceof Rr?Promise.resolve(Eo.value.v).then(Wi,Yi):nn(an[0][2],Eo)}catch(go){nn(an[0][3],go)}var Eo}function Wi(yr){jn("next",yr)}function Yi(yr){jn("throw",yr)}function nn(yr,rs){yr(rs),an.shift(),an.length&&jn(an[0][0],an[0][1])}};function Gs(xt){if(xt==null)throw new Error("Assertion Failure: value must not be null nor undefined")}function $s(xt){return xt[Symbol.asyncIterator]!=null?xt:function(ke){return gs(this,arguments,function(){var lt,bt,gt,an;return Lr(this,function(Wt){switch(Wt.label){case 0:lt=ke.getReader(),Wt.label=1;case 1:Wt.trys.push([1,,9,10]),Wt.label=2;case 2:return[4,Rr(lt.read())];case 3:return bt=Wt.sent(),gt=bt.done,an=bt.value,gt?[4,Rr(void 0)]:[3,5];case 4:return[2,Wt.sent()];case 5:return Gs(an),[4,Rr(an)];case 6:return[4,Wt.sent()];case 7:return Wt.sent(),[3,2];case 8:return[3,10];case 9:return lt.releaseLock(),[7];case 10:return[2]}})})}(xt)}var Us=function(xt,ke,lt,bt){return new(lt||(lt=Promise))(function(gt,an){function Wt(Yi){try{Wi(bt.next(Yi))}catch(nn){an(nn)}}function jn(Yi){try{Wi(bt.throw(Yi))}catch(nn){an(nn)}}function Wi(Yi){var nn;Yi.done?gt(Yi.value):(nn=Yi.value,nn instanceof lt?nn:new lt(function(yr){yr(nn)})).then(Wt,jn)}Wi((bt=bt.apply(xt,ke||[])).next())})},js=function(xt,ke){var lt,bt,gt,an,Wt={label:0,sent:function(){if(1&gt[0])throw gt[1];return gt[1]},trys:[],ops:[]};return an={next:jn(0),throw:jn(1),return:jn(2)},typeof Symbol=="function"&&(an[Symbol.iterator]=function(){return this}),an;function jn(Wi){return function(Yi){return function(nn){if(lt)throw new TypeError("Generator is already executing.");for(;Wt;)try{if(lt=1,bt&&(gt=2&nn[0]?bt.return:nn[0]?bt.throw||((gt=bt.return)&&gt.call(bt),0):bt.next)&&!(gt=gt.call(bt,nn[1])).done)return gt;switch(bt=0,gt&&(nn=[2&nn[0],gt.value]),nn[0]){case 0:case 1:gt=nn;break;case 4:return Wt.label++,{value:nn[1],done:!1};case 5:Wt.label++,bt=nn[1],nn=[0];continue;case 7:nn=Wt.ops.pop(),Wt.trys.pop();continue;default:if(gt=Wt.trys,!((gt=gt.length>0&&gt[gt.length-1])||nn[0]!==6&&nn[0]!==2)){Wt=0;continue}if(nn[0]===3&&(!gt||nn[1]>gt[0]&&nn[1]<gt[3])){Wt.label=nn[1];break}if(nn[0]===6&&Wt.label<gt[1]){Wt.label=gt[1],gt=nn;break}if(gt&&Wt.label<gt[2]){Wt.label=gt[2],Wt.ops.push(nn);break}gt[2]&&Wt.ops.pop(),Wt.trys.pop();continue}nn=ke.call(xt,Wt)}catch(yr){nn=[6,yr],bt=0}finally{lt=gt=0}if(5&nn[0])throw nn[1];return{value:nn[0]?nn[1]:void 0,done:!0}}([Wi,Yi])}}};function ba(xt,ke){return ke===void 0&&(ke=Zi),Us(this,void 0,void 0,function(){var lt;return js(this,function(bt){return lt=$s(xt),[2,new Di(ke.extensionCodec,ke.context,ke.maxStrLength,ke.maxBinLength,ke.maxArrayLength,ke.maxMapLength,ke.maxExtLength).decodeSingleAsync(lt)]})})}function Ta(xt,ke){ke===void 0&&(ke=Zi);var lt=$s(xt);return new Di(ke.extensionCodec,ke.context,ke.maxStrLength,ke.maxBinLength,ke.maxArrayLength,ke.maxMapLength,ke.maxExtLength).decodeArrayStream(lt)}function vu(xt,ke){ke===void 0&&(ke=Zi);var lt=$s(xt);return new Di(ke.extensionCodec,ke.context,ke.maxStrLength,ke.maxBinLength,ke.maxArrayLength,ke.maxMapLength,ke.maxExtLength).decodeStream(lt)}}])})})(EK);const XM=2;class IK{constructor(){this.data=null}compileImageTargets(e,t){return new Promise(async(r,s)=>{const o=[];for(let p=0;p<e.length;p++){const f=e[p],g=this.createProcessCanvas(f).getContext("2d");g.drawImage(f,0,0,f.width,f.height);const v=g.getImageData(0,0,f.width,f.height),w=new Uint8Array(f.width*f.height);for(let P=0;P<w.length;P++){const z=P*4;w[P]=Math.floor((v.data[z]+v.data[z+1]+v.data[z+2])/3)}const R={data:w,height:f.height,width:f.width};o.push(R)}const l=50/o.length;let c=0;this.data=[];for(let p=0;p<o.length;p++){const f=o[p],g=mK(f),v=l/g.length,w=await SK(g,()=>{c+=v,t(c)});this.data.push({targetImage:f,imageList:g,matchingData:w})}for(let p=0;p<o.length;p++){const f=gK(o[p]);this.data[p].trackingImageList=f}const h=await this.compileTrack({progressCallback:t,targetImages:o,basePercent:50});for(let p=0;p<o.length;p++)this.data[p].trackingData=h[p];r(this.data)})}exportData(){const e=[];for(let t=0;t<this.data.length;t++)e.push({targetImage:{width:this.data[t].targetImage.width,height:this.data[t].targetImage.height},trackingData:this.data[t].trackingData,matchingData:this.data[t].matchingData});return $y.encode({v:XM,dataList:e})}importData(e){const t=$y.decode(new Uint8Array(e));if(!t.v||t.v!==XM)return console.error("Your compiled .mind might be outdated. Please recompile"),[];const{dataList:r}=t;this.data=[];for(let s=0;s<r.length;s++)this.data.push({targetImage:r[s].targetImage,trackingData:r[s].trackingData,matchingData:r[s].matchingData});return this.data}createProcessCanvas(e){console.warn("missing createProcessCanvas implementation")}compileTrack({progressCallback:e,targetImages:t,basePercent:r}){console.warn("missing compileTrack implementation")}}const SK=async(i,e)=>{const t=[];for(let r=0;r<i.length;r++){const s=i[r],o=new zM(s.width,s.height);await Bm(),Pt(()=>{const l=Vo(s.data,[s.data.length],"float32").reshape([s.height,s.width]),{featurePoints:c}=o.detect(l),h=c.filter(v=>v.maxima),p=c.filter(v=>!v.maxima),f=HM({points:h}),g=HM({points:p});t.push({maximaPoints:h,minimaPoints:p,maximaPointsCluster:f,minimaPointsCluster:g,width:s.width,height:s.height,scale:s.scale}),e(r)})}return t},QM="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",ZM=typeof window<"u"&&window.Blob&&new Blob([atob(QM)],{type:"text/javascript;charset=utf-8"});function TK(){const i=ZM&&(window.URL||window.webkitURL).createObjectURL(ZM);try{return i?new Worker(i):new Worker("data:application/javascript;base64,"+QM)}finally{i&&(window.URL||window.webkitURL).revokeObjectURL(i)}}class $M extends IK{createProcessCanvas(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}compileTrack({progressCallback:e,targetImages:t,basePercent:r}){return new Promise((s,o)=>{const l=new TK;l.onmessage=c=>{c.data.type==="progress"?e(r+c.data.percent*r/100):c.data.type==="compileDone"&&s(c.data.list)},l.postMessage({type:"compile",targetImages:t})})}}class MK{constructor(e,t){this.width=e,this.height=t,this.texShape=[t,e];const r=document.createElement("canvas").getContext("2d");r.canvas.width=e,r.canvas.height=t,this.context=r,this.program=this.buildProgram(e,t);const s=Bu();this.tempPixelHandle=s.makeTensorInfo(this.texShape,"float32"),s.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(e){return Pt(()=>{let t=Hb(e);return t=t.mean(2),t})}loadInput(e){this.context.drawImage(e,0,0,this.width,this.height);const t=Bu();return t.gpgpu.uploadPixelDataToTexture(t.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(e,t){const r=Ye().getNumber("WEBGL_VERSION")===2?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:`
	void main() {
	  ivec2 coords = getOutputCoords();
	  int texR = coords[0];
	  int texC = coords[1];
	  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${e}.0, ${t}.0);

	  vec4 values = ${r}(A, uv);
	  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);
	}
      `}}_compileAndRun(e,t){const r=Bu().compileAndRun(e,t);return ea().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}_runWebGLProgram(e,t,r){const s=Bu().runWebGLProgram(e,t,r);return ea().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}}const jM=(i,e)=>{const t=2*Math.PI*e*i;return t/(t+1)},YM=(i,e,t)=>i*e+(1-i)*t;class _K{constructor({minCutOff:e,beta:t}){this.minCutOff=e,this.beta=t,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(e,t){if(!this.initialized)return this.initialized=!0,this.xPrev=t,this.dxPrev=t.map(()=>0),this.tPrev=e,t;const{xPrev:r,tPrev:s,dxPrev:o}=this,l=e-s,c=jM(l,this.dCutOff),h=[],p=[],f=[];for(let g=0;g<t.length;g++){h[g]=(t[g]-r[g])/l,p[g]=YM(c,h[g],o[g]);const v=this.minCutOff+this.beta*Math.abs(p[g]),w=jM(l,v);f[g]=YM(w,t[g],r[g])}return this.xPrev=f,this.dxPrev=p,this.tPrev=e,f}}const CE={memory:Of,nextFrame:Bm},RK=.001,BK=1e3,kK=5,LK=5;class JM{constructor({inputWidth:e,inputHeight:t,onUpdate:r=null,debugMode:s=!1,maxTrack:o=1,warmupTolerance:l=null,missTolerance:c=null,filterMinCF:h=null,filterBeta:p=null}){this.inputWidth=e,this.inputHeight=t,this.maxTrack=o,this.filterMinCF=h===null?RK:h,this.filterBeta=p===null?BK:p,this.warmupTolerance=l===null?kK:l,this.missTolerance=c===null?LK:c,this.cropDetector=new pK(this.inputWidth,this.inputHeight,s),this.inputLoader=new MK(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=r,this.debugMode=s,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];const f=10,g=1e5,v=45*Math.PI/180,w=this.inputHeight/2/Math.tan(v/2);this.projectionTransform=[[w,0,this.inputWidth/2],[0,w,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:f,far:g}),this.worker=new TH,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=R=>{R.data.type==="matchDone"&&this.workerMatchDone!==null&&this.workerMatchDone(R.data),R.data.type==="trackUpdateDone"&&this.workerTrackDone!==null&&this.workerTrackDone(R.data)}}showTFStats(){console.log(CE.memory().numTensors),console.table(CE.memory())}addImageTargets(e){return new Promise(async(t,r)=>{const s=await(await fetch(e)).arrayBuffer(),o=this.addImageTargetsFromBuffer(s);t(o)})}addImageTargetsFromBuffer(e){const t=new $M().importData(e),r=[],s=[],o=[];for(let l=0;l<t.length;l++)s.push(t[l].matchingData),r.push(t[l].trackingData),o.push([t[l].targetImage.width,t[l].targetImage.height]);return this.tracker=new PH(o,r,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:s}),this.markerDimensions=o,{dimensions:o,matchingDataList:s,trackingDataList:r}}dispose(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}dummyRun(e){const t=this.inputLoader.loadInput(e);this.cropDetector.detect(t),this.tracker.dummyRun(t),t.dispose()}getProjectionMatrix(){return this.projectionMatrix}getWorldMatrix(e,t){return this._glModelViewMatrix(e,t)}async _detectAndMatch(e,t){const{featurePoints:r}=this.cropDetector.detectMoving(e),{targetIndex:s,modelViewTransform:o}=await this._workerMatch(r,t);return{targetIndex:s,modelViewTransform:o}}async _trackAndUpdate(e,t,r){const{worldCoords:s,screenCoords:o}=this.tracker.track(e,t,r);return s.length<4?null:await this._workerTrackUpdate(t,{worldCoords:s,screenCoords:o})}processVideo(e){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let t=0;t<this.markerDimensions.length;t++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new _K({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){const t=this.inputLoader.loadInput(e);if(this.trackingStates.reduce((r,s)=>r+(s.isTracking?1:0),0)<this.maxTrack){const r=[];for(let l=0;l<this.trackingStates.length;l++)this.trackingStates[l].isTracking!==!0&&(this.interestedTargetIndex!==-1&&this.interestedTargetIndex!==l||r.push(l));const{targetIndex:s,modelViewTransform:o}=await this._detectAndMatch(t,r);s!==-1&&(this.trackingStates[s].isTracking=!0,this.trackingStates[s].currentModelViewTransform=o)}for(let r=0;r<this.trackingStates.length;r++){const s=this.trackingStates[r];if(s.isTracking){let o=await this._trackAndUpdate(t,s.currentModelViewTransform,r);o===null?s.isTracking=!1:s.currentModelViewTransform=o}if(s.showing||s.isTracking&&(s.trackMiss=0,s.trackCount+=1,s.trackCount>this.warmupTolerance&&(s.showing=!0,s.trackingMatrix=null,s.filter.reset())),s.showing&&(s.isTracking?s.trackMiss=0:(s.trackCount=0,s.trackMiss+=1,s.trackMiss>this.missTolerance&&(s.showing=!1,s.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:r,worldMatrix:null})))),s.showing){const o=this._glModelViewMatrix(s.currentModelViewTransform,r);s.trackingMatrix=s.filter.filter(Date.now(),o);const l=[];for(let c=0;c<s.trackingMatrix.length;c++)l[c]=s.trackingMatrix[c];this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:r,worldMatrix:l})}}t.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await CE.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(e){const t=this.inputLoader.loadInput(e),{featurePoints:r,debugExtra:s}=await this.cropDetector.detect(t);return t.dispose(),{featurePoints:r,debugExtra:s}}async match(e,t){const{modelViewTransform:r,debugExtra:s}=await this._workerMatch(e,[t]);return{modelViewTransform:r,debugExtra:s}}async track(e,t,r){const s=this.inputLoader.loadInput(e),o=this.tracker.track(s,t,r);return s.dispose(),o}async trackUpdate(e,t){return t.worldCoords.length<4?null:await this._workerTrackUpdate(e,t)}_workerMatch(e,t){return new Promise(async(r,s)=>{this.workerMatchDone=o=>{r({targetIndex:o.targetIndex,modelViewTransform:o.modelViewTransform,debugExtra:o.debugExtra})},this.worker.postMessage({type:"match",featurePoints:e,targetIndexes:t})})}_workerTrackUpdate(e,t){return new Promise(async(r,s)=>{this.workerTrackDone=c=>{r(c.modelViewTransform)};const{worldCoords:o,screenCoords:l}=t;this.worker.postMessage({type:"trackUpdate",modelViewTransform:e,worldCoords:o,screenCoords:l})})}_glModelViewMatrix(e,t){const r=this.markerDimensions[t][1];return[e[0][0],-e[1][0],-e[2][0],0,-e[0][1],e[1][1],e[2][1],0,-e[0][2],e[1][2],e[2][2],0,e[0][1]*r+e[0][3],-(e[1][1]*r+e[1][3]),-(e[2][1]*r+e[2][3]),1]}_glProjectionMatrix({projectionTransform:e,width:t,height:r,near:s,far:o}){const l=[[2*e[0][0]/t,0,-(2*e[0][2]/t-1),0],[0,2*e[1][1]/r,-(2*e[1][2]/r-1),0],[0,0,-(o+s)/(o-s),-2*o*s/(o-s)],[0,0,-1,0]],c=[];for(let h=0;h<4;h++)for(let p=0;p<4;p++)c.push(l[p][h]);return c}}const DK=`<div class="mindar-ui-overlay mindar-ui-loading">
  <div class="loader"/>
</div>
`,NK=`<div class="mindar-ui-overlay mindar-ui-compatibility">
  <div class="content">
    <h1>Failed to launch :(</h1>
    <p>
      Looks like your device/browser is not compatible.
    </p>

    <br/>
    <br/>
    <p>
      Please try the following recommended browsers:
    </p>
    <p>
      For Android device - Chrome
    </p>
    <p>
      For iOS device - Safari
    </p>
  </div>
</div>
`,FK=`<div class="mindar-ui-overlay mindar-ui-scanning">
  <div class="scanning">
    <div class="inner">
      <div class="scanline"/>
    </div>
  </div>
</div>
`,PK=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}";class qM{constructor({uiLoading:e,uiScanning:t,uiError:r}){const s=document.createElement("style");s.innerText=PK,document.head.appendChild(s),e==="yes"?this.loadingModal=this._loadHTML(DK):e!=="no"&&(this.loadingModal=document.querySelector(e)),r==="yes"?this.compatibilityModal=this._loadHTML(NK):r!=="no"&&(this.compatibilityModal=document.querySelector(r)),t==="yes"?this.scanningMask=this._loadHTML(FK):t!=="no"&&(this.scanningMask=document.querySelector(t)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(e){const t=document.createElement("template");t.innerHTML=e.trim();const r=t.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(r),r}}window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE={Controller:JM,Compiler:$M,UI:qM},AFRAME.registerSystem("mindar-image-system",{container:null,video:null,processingImage:!1,init:function(){this.anchorEntities=[]},tick:function(){},setup:function({imageTargetSrc:i,maxTrack:e,showStats:t,uiLoading:r,uiScanning:s,uiError:o,missTolerance:l,warmupTolerance:c,filterMinCF:h,filterBeta:p}){this.imageTargetSrc=i,this.maxTrack=e,this.filterMinCF=h,this.filterBeta=p,this.missTolerance=l,this.warmupTolerance=c,this.showStats=t,this.ui=new qM({uiLoading:r,uiScanning:s,uiError:o})},registerAnchor:function(i,e){this.anchorEntities.push({el:i,targetIndex:e})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new Stats,this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position:absolute;top:0px;left:0px;z-index:999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(i){this.controller.interestedTargetIndex=i},stop:function(){this.pause(),this.video.srcObject.getTracks().forEach(function(i){i.stop()}),this.video.remove(),this.controller.dispose()},pause:function(i=!1){i||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.el.emit("arError",{error:"VIDEO_FAIL"}),this.ui.showCompatibility();return}navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(i=>{this.video.addEventListener("loadedmetadata",()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),this._startAR()}),this.video.srcObject=i}).catch(i=>{console.log("getUserMedia error",i),this.el.emit("arError",{error:"VIDEO_FAIL"})})},_startAR:async function(){const i=this.video;this.container,this.controller=new JM({inputWidth:i.videoWidth,inputHeight:i.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:t=>{if(t.type==="processDone")this.mainStats&&this.mainStats.update();else if(t.type==="updateMatrix"){const{targetIndex:r,worldMatrix:s}=t;for(let o=0;o<this.anchorEntities.length;o++)this.anchorEntities[o].targetIndex===r&&this.anchorEntities[o].el.updateWorldMatrix(s);this.anchorEntities.reduce((o,l)=>o||l.el.el.object3D.visible,!1)?this.ui.hideScanning():this.ui.showScanning()}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:e}=await this.controller.addImageTargets(this.imageTargetSrc);for(let t=0;t<this.anchorEntities.length;t++){const{el:r,targetIndex:s}=this.anchorEntities[t];s<e.length&&r.setupMarker(e[s])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const i=this.video,e=this.container;let t,r;const s=i.videoWidth/i.videoHeight,o=e.clientWidth/e.clientHeight;s>o?(r=e.clientHeight,t=r*s):(t=e.clientWidth,r=t/s);const l=this.controller.getProjectionMatrix(),c=2*Math.atan(1/l[5]/r*e.clientHeight)*180/Math.PI,h=l[14]/(l[10]-1),p=l[14]/(l[10]+1);l[5]/l[0];const f=e.clientWidth/e.clientHeight,g=e.getElementsByTagName("a-camera")[0].getObject3D("camera");g.fov=c,g.aspect=f,g.near=h,g.far=p,g.updateProjectionMatrix(),this.video.style.top=-(r-e.clientHeight)/2+"px",this.video.style.left=-(t-e.clientWidth)/2+"px",this.video.style.width=t+"px",this.video.style.height=r+"px"}}),AFRAME.registerComponent("mindar-image",{dependencies:["mindar-image-system"],schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"}},init:function(){const i=this.el.sceneEl.systems["mindar-image-system"];i.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:this.data.filterMinCF===-1?null:this.data.filterMinCF,filterBeta:this.data.filterBeta===-1?null:this.data.filterBeta,missTolerance:this.data.missTolerance===-1?null:this.data.missTolerance,warmupTolerance:this.data.warmupTolerance===-1?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",()=>{i.start()})},remove:function(){this.el.sceneEl.systems["mindar-image-system"].stop()}}),AFRAME.registerComponent("mindar-image-target",{dependencies:["mindar-image-system"],schema:{targetIndex:{type:"number"}},postMatrix:null,init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex),this.invisibleMatrix=new AFRAME.THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);const i=this.el.object3D;i.visible=!1,i.matrixAutoUpdate=!1},setupMarker([i,e]){const t=new AFRAME.THREE.Vector3,r=new AFRAME.THREE.Quaternion,s=new AFRAME.THREE.Vector3;t.x=i/2,t.y=i/2+(e-i)/2,s.x=i,s.y=i,s.z=i,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(t,r,s)},updateWorldMatrix(i){if(this.el.emit("targetUpdate"),!this.el.object3D.visible&&i!==null?this.el.emit("targetFound"):this.el.object3D.visible&&i===null&&this.el.emit("targetLost"),this.el.object3D.visible=i!==null,i===null){this.el.object3D.matrix=this.invisibleMatrix;return}var e=new AFRAME.THREE.Matrix4;e.elements=i,e.multiply(this.postMatrix),this.el.object3D.matrix=e}})})();const wZ=["mindar-image"],EZ=Oc("a-assets",null,[Oc("img",{id:"card",src:"https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.0.0/examples/image-tracking/assets/card-example/card.png",crossorigin:"anonymous"}),Oc("a-asset-item",{id:"avatarModel",src:"https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.0.0/examples/image-tracking/assets/card-example/softmind/scene.gltf",crossorigin:""})],-1),IZ=Oc("a-camera",{position:"0 0 0","look-controls":"enabled: false"},null,-1),SZ=Oc("a-entity",{"mindar-image-target":"targetIndex: 0"},[Oc("a-plane",{src:"#card",position:"0 0 0",height:"0.552",width:"1",rotation:"0 0 0"}),Oc("a-gltf-model",{rotation:"0 0 0 ",position:"0 0 0.1",scale:"0.005 0.005 0.005",src:"#avatarModel",animation:"property: position; to: 0 0.1 0.1; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"})],-1),TZ=[EZ,IZ,SZ],MZ={__name:"MindarVue",setup(T,{expose:Q}){const ue=ob(null);Q({sceneRef:ue});function xe(){return new URL("/ar-test/assets/targets-5215f3f2.mind",self.location).href}return(Te,Ne)=>(ER(),IR("a-scene",{ref_key:"sceneRef",ref:ue,"mindar-image":`imageTargetSrc: ${xe()}; autoStart: false; uiLoading: no; uiError: no; uiScanning: no;`,"color-space":"sRGB",embedded:"",renderer:"colorManagement: true, physicallyCorrectLights","vr-mode-ui":"enabled: false","device-orientation-permission-ui":"enabled: false"},TZ,8,wZ))}};const _Z={class:"app"},RZ={style:{height:"10vh"}},BZ={class:"container"},kZ={__name:"App",setup(T){const Q=ob(null),ue=ob("START");function xe(){console.log("awsdasd");const Ne=Q.value.sceneRef.systems["mindar-image-system"];ue.value=="START"?(Ne.start(),ue.value="STOP"):(Ne.stop(),ue.value="START")}return(Te,Ne)=>(ER(),IR("div",_Z,[Oc("div",RZ,[Oc("button",{onClick:Ne[0]||(Ne[0]=Z=>xe())},WK(ue.value),1)]),Oc("div",BZ,[ap(MZ,{ref_key:"mindarViewerRef",ref:Q},null,512)])]))}};const LZ=mZ();hZ(kZ).use(LZ).mount("#app");
